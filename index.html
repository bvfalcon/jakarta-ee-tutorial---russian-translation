<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<meta name="author" content="Jakarta Platform Team, https://projects.eclipse.org/projects/ee4j.jakartaee-platform">
<title>The Jakarta&#174; EE Tutorial</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
:not(pre)>code.nobreak{word-wrap:normal}
:not(pre)>code.nowrap{white-space:nowrap}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
td.tableblock>.content>:last-child.sidebarblock{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>The Jakarta&#174; EE Tutorial</h1>
<div class="details">
<span id="author" class="author">Jakarta Platform Team, https://projects.eclipse.org/projects/ee4j.jakartaee-platform</span><br>
<span id="email" class="email"><a href="https://accounts.eclipse.org/mailing-list/jakartaee-platform-dev" class="bare">https://accounts.eclipse.org/mailing-list/jakartaee-platform-dev</a></span><br>
<span id="revnumber"> Release 9,</span>
<span id="revdate">May 2021</span>
<br><span id="revremark">DRAFT</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#preface">Preface</a>
<ul class="sectlevel2">
<li><a href="#audience">Audience</a></li>
<li><a href="#before-you-read-this-book">Before You Read This Book</a></li>
<li><a href="#related-documentation">Related Documentation</a></li>
<li><a href="#conventions">Conventions</a></li>
<li><a href="#default-paths-and-file-names">Default Paths and File Names</a></li>
</ul>
</li>
<li><a href="#introduction">Part I: Introduction</a>
<ul class="sectlevel1">
<li><a href="#overview">Chapter 1. Overview</a>
<ul class="sectlevel2">
<li><a href="#introduction-to-jakarta-ee">Introduction to Jakarta EE</a></li>
<li><a href="#jakarta-ee-9-platform-highlights">Jakarta EE 9 Platform Highlights</a></li>
<li><a href="#jakarta-ee-application-model">Jakarta EE Application Model</a></li>
<li><a href="#distributed-multitiered-applications">Distributed Multitiered Applications</a></li>
<li><a href="#jakarta-ee-containers">Jakarta EE Containers</a></li>
<li><a href="#web-services-support">Web Services Support</a></li>
<li><a href="#jakarta-ee-application-assembly-and-deployment">Jakarta EE Application Assembly and Deployment</a></li>
<li><a href="#jakarta-ee-apis">Jakarta EE APIs</a></li>
<li><a href="#jakarta-ee-9-apis-in-the-java-platform-standard-edition-8">Jakarta EE 9 APIs in the Java Platform, Standard Edition 8</a></li>
<li><a href="#eclipse-glassfish-server-tools">Eclipse GlassFish Server Tools</a></li>
</ul>
</li>
<li><a href="#using-the-tutorial-examples">Chapter 2. Using the Tutorial Examples</a>
<ul class="sectlevel2">
<li><a href="#required-software">Required Software</a></li>
<li><a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a></li>
<li><a href="#starting-the-administration-console">Starting the Administration Console</a></li>
<li><a href="#starting-and-stopping-apache-derby">Starting and Stopping Apache Derby</a></li>
<li><a href="#building-the-examples">Building the Examples</a></li>
<li><a href="#tutorial-example-directory-structure">Tutorial Example Directory Structure</a></li>
<li><a href="#jakarta-ee-maven-archetypes-in-the-tutorial">Jakarta EE Maven Archetypes in the Tutorial</a></li>
<li><a href="#debugging-jakarta-ee-applications">Debugging Jakarta EE Applications</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#platform-basics">Part II: Platform Basics</a>
<ul class="sectlevel1">
<li><a href="#resource-creation">Chapter 3. Resource Creation</a>
<ul class="sectlevel2">
<li><a href="#resources-and-jndi-naming">Resources and JNDI Naming</a></li>
<li><a href="#datasource-objects-and-connection-pools">DataSource Objects and Connection Pools</a></li>
<li><a href="#creating-resources-administratively">Creating Resources Administratively</a></li>
</ul>
</li>
<li><a href="#injection">Chapter 4. Injection</a>
<ul class="sectlevel2">
<li><a href="#resource-injection">Resource Injection</a></li>
<li><a href="#dependency-injection">Dependency Injection</a></li>
<li><a href="#the-main-differences-between-resource-injection-and-dependency-injection">The Main Differences between Resource Injection and Dependency Injection</a></li>
</ul>
</li>
<li><a href="#packaging">Chapter 5. Packaging</a>
<ul class="sectlevel2">
<li><a href="#packaging-applications">Packaging Applications</a></li>
<li><a href="#packaging-enterprise-beans">Packaging Enterprise Beans</a></li>
<li><a href="#packaging-web-archives">Packaging Web Archives</a></li>
<li><a href="#packaging-resource-adapter-archives">Packaging Resource Adapter Archives</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#the-web-tier">Part III: The Web Tier</a>
<ul class="sectlevel1">
<li><a href="#getting-started-with-web-applications">Chapter 6. Getting Started with Web Applications</a>
<ul class="sectlevel2">
<li><a href="#web-applications">Web Applications</a></li>
<li><a href="#web-application-lifecycle">Web Application Lifecycle</a></li>
<li><a href="#a-web-module-that-uses-jakarta-faces-technology-the-hello1-example">A Web Module That Uses Jakarta Faces Technology: The hello1 Example</a></li>
<li><a href="#a-web-module-that-uses-jakarta-servlet-technology-the-hello2-example">A Web Module That Uses Jakarta Servlet Technology: The hello2 Example</a></li>
<li><a href="#configuring-web-applications">Configuring Web Applications</a></li>
<li><a href="#further-information-about-web-applications">Further Information about Web Applications</a></li>
</ul>
</li>
<li><a href="#jakarta-faces-technology">Chapter 7. Jakarta Faces Technology</a>
<ul class="sectlevel2">
<li><a href="#introduction-to-jakarta-faces-technology">Introduction to Jakarta Faces Technology</a></li>
<li><a href="#what-is-a-jakarta-faces-application">What Is a Jakarta Faces Application?</a></li>
<li><a href="#jakarta-faces-technology-benefits">Jakarta Faces Technology Benefits</a></li>
<li><a href="#a-simple-jakarta-faces-application">A Simple Jakarta Faces Application</a></li>
<li><a href="#user-interface-component-model">User Interface Component Model</a></li>
<li><a href="#navigation-model">Navigation Model</a></li>
<li><a href="#the-lifecycle-of-a-jakarta-faces-application">The Lifecycle of a Jakarta Faces Application</a></li>
<li><a href="#partial-processing-and-partial-rendering">Partial Processing and Partial Rendering</a></li>
<li><a href="#further-information-about-jakarta-faces-technology">Further Information about Jakarta Faces Technology</a></li>
</ul>
</li>
<li><a href="#introduction-to-facelets">Chapter 8. Introduction to Facelets</a>
<ul class="sectlevel2">
<li><a href="#what-is-facelets">What Is Facelets?</a></li>
<li><a href="#the-lifecycle-of-a-facelets-application">The Lifecycle of a Facelets Application</a></li>
<li><a href="#developing-a-simple-facelets-application-the-guessnumber-jsf-example-application">Developing a Simple Facelets Application: The guessnumber-jsf Example Application</a></li>
<li><a href="#using-facelets-templates">Using Facelets Templates</a></li>
<li><a href="#composite-components">Composite Components</a></li>
<li><a href="#web-resources">Web Resources</a></li>
<li><a href="#relocatable-resources">Relocatable Resources</a></li>
<li><a href="#resource-library-contracts">Resource Library Contracts</a></li>
<li><a href="#html5-friendly-markup">HTML5-Friendly Markup</a></li>
</ul>
</li>
<li><a href="#expression-language">Chapter 9. Expression Language</a>
<ul class="sectlevel2">
<li><a href="#overview-of-the-el">Overview of the EL</a></li>
<li><a href="#immediate-and-deferred-evaluation-syntax">Immediate and Deferred Evaluation Syntax</a></li>
<li><a href="#value-and-method-expressions">Value and Method Expressions</a></li>
<li><a href="#operations-on-collection-objects">Operations on Collection Objects</a></li>
<li><a href="#operators">Operators</a></li>
<li><a href="#reserved-words">Reserved Words</a></li>
<li><a href="#examples-of-el-expressions">Examples of EL Expressions</a></li>
<li><a href="#further-information-about-the-expression-language">Further Information about the Expression Language</a></li>
</ul>
</li>
<li><a href="#using-jakarta-faces-technology-in-web-pages">Chapter 10. Using Jakarta Faces Technology in Web Pages</a>
<ul class="sectlevel2">
<li><a href="#setting-up-a-page">Setting Up a Page</a></li>
<li><a href="#adding-components-to-a-page-using-html-tag-library-tags">Adding Components to a Page Using HTML Tag Library Tags</a></li>
<li><a href="#using-core-tags">Using Core Tags</a></li>
</ul>
</li>
<li><a href="#using-converters-listeners-and-validators">Chapter 11. Using Converters, Listeners, and Validators</a>
<ul class="sectlevel2">
<li><a href="#using-the-standard-converters">Using the Standard Converters</a></li>
<li><a href="#registering-listeners-on-components">Registering Listeners on Components</a></li>
<li><a href="#using-the-standard-validators">Using the Standard Validators</a></li>
<li><a href="#referencing-a-managed-bean-method">Referencing a Managed Bean Method</a></li>
</ul>
</li>
<li><a href="#developing-with-jakarta-faces-technology">Chapter 12. Developing with Jakarta Faces Technology</a>
<ul class="sectlevel2">
<li><a href="#managed-beans-in-jakarta-faces-technology">Managed Beans in Jakarta Faces Technology</a></li>
<li><a href="#writing-bean-properties">Writing Bean Properties</a></li>
<li><a href="#writing-managed-bean-methods">Writing Managed Bean Methods</a></li>
</ul>
</li>
<li><a href="#using-ajax-with-jakarta-faces-technology">Chapter 13. Using Ajax with Jakarta Faces Technology</a>
<ul class="sectlevel2">
<li><a href="#overview-of-ajax">Overview of Ajax</a></li>
<li><a href="#using-ajax-functionality-with-jakarta-faces-technology">Using Ajax Functionality with Jakarta Faces Technology</a></li>
<li><a href="#using-ajax-with-facelets">Using Ajax with Facelets</a></li>
<li><a href="#sending-an-ajax-request">Sending an Ajax Request</a></li>
<li><a href="#monitoring-events-on-the-client">Monitoring Events on the Client</a></li>
<li><a href="#handling-errors">Handling Errors</a></li>
<li><a href="#receiving-an-ajax-response">Receiving an Ajax Response</a></li>
<li><a href="#ajax-request-lifecycle">Ajax Request Lifecycle</a></li>
<li><a href="#grouping-of-components">Grouping of Components</a></li>
<li><a href="#loading-javascript-as-a-resource">Loading JavaScript as a Resource</a></li>
<li><a href="#the-ajaxguessnumber-example-application">The ajaxguessnumber Example Application</a></li>
<li><a href="#further-information-about-ajax-in-jakarta-faces-technology">Further Information about Ajax in Jakarta Faces Technology</a></li>
</ul>
</li>
<li><a href="#composite-components-advanced-topics-and-an-example">Chapter 14. Composite Components: Advanced Topics and an Example</a>
<ul class="sectlevel2">
<li><a href="#attributes-of-a-composite-component">Attributes of a Composite Component</a></li>
<li><a href="#invoking-a-managed-bean">Invoking a Managed Bean</a></li>
<li><a href="#validating-composite-component-values">Validating Composite Component Values</a></li>
<li><a href="#the-compositecomponentexample-example-application">The compositecomponentexample Example Application</a></li>
</ul>
</li>
<li><a href="#creating-custom-ui-components-and-other-custom-objects">Chapter 15. Creating Custom UI Components and Other Custom Objects</a>
<ul class="sectlevel2">
<li><a href="#introduction-to-creating-custom-components">Introduction to Creating Custom Components</a></li>
<li><a href="#determining-whether-you-need-a-custom-component-or-renderer">Determining Whether You Need a Custom Component or Renderer</a></li>
<li><a href="#understanding-the-image-map-example">Understanding the Image Map Example</a></li>
<li><a href="#steps-for-creating-a-custom-component">Steps for Creating a Custom Component</a></li>
<li><a href="#creating-custom-component-classes">Creating Custom Component Classes</a></li>
<li><a href="#delegating-rendering-to-a-renderer">Delegating Rendering to a Renderer</a></li>
<li><a href="#implementing-an-event-listener">Implementing an Event Listener</a></li>
<li><a href="#handling-events-for-custom-components">Handling Events for Custom Components</a></li>
<li><a href="#defining-the-custom-component-tag-in-a-tag-library-descriptor">Defining the Custom Component Tag in a Tag Library Descriptor</a></li>
<li><a href="#using-a-custom-component">Using a Custom Component</a></li>
<li><a href="#creating-and-using-a-custom-converter">Creating and Using a Custom Converter</a></li>
<li><a href="#creating-and-using-a-custom-validator">Creating and Using a Custom Validator</a></li>
<li><a href="#binding-component-values-and-instances-to-managed-bean-properties">Binding Component Values and Instances to Managed Bean Properties</a></li>
<li><a href="#binding-converters-listeners-and-validators-to-managed-bean-properties">Binding Converters, Listeners, and Validators to Managed Bean Properties</a></li>
</ul>
</li>
<li><a href="#configuring-jakarta-faces-applications">Chapter 16. Configuring Jakarta Faces Applications</a>
<ul class="sectlevel2">
<li><a href="#introduction-to-configuring-jakarta-faces-applications">Introduction to Configuring Jakarta Faces Applications</a></li>
<li><a href="#using-annotations-to-configure-managed-beans">Using Annotations to Configure Managed Beans</a></li>
<li><a href="#application-configuration-resource-file">Application Configuration Resource File</a></li>
<li><a href="#using-faces-flows">Using Faces Flows</a></li>
<li><a href="#configuring-managed-beans">Configuring Managed Beans</a></li>
<li><a href="#registering-application-messages">Registering Application Messages</a></li>
<li><a href="#using-default-validators">Using Default Validators</a></li>
<li><a href="#registering-a-custom-validator">Registering a Custom Validator</a></li>
<li><a href="#registering-a-custom-converter">Registering a Custom Converter</a></li>
<li><a href="#configuring-navigation-rules">Configuring Navigation Rules</a></li>
<li><a href="#registering-a-custom-renderer-with-a-render-kit">Registering a Custom Renderer with a Render Kit</a></li>
<li><a href="#registering-a-custom-component">Registering a Custom Component</a></li>
<li><a href="#basic-requirements-of-a-jakarta-faces-application">Basic Requirements of a Jakarta Faces Application</a></li>
</ul>
</li>
<li><a href="#using-websockets-with-jakarta-faces-technology">Chapter 17. Using WebSockets with Jakarta Faces Technology</a>
<ul class="sectlevel2">
<li><a href="#about-websockets-in-jakarta-faces">About WebSockets in Jakarta Faces</a></li>
<li><a href="#configuring-websockets">Configuring WebSockets</a></li>
<li><a href="#using-the-fwebsocket-tag">Using the f:websocket Tag</a></li>
<li><a href="#websocket-scopes-and-users">WebSocket Scopes and Users</a></li>
<li><a href="#conditionally-connecting-websockets">Conditionally Connecting WebSockets</a></li>
<li><a href="#websocket-security-considerations">WebSocket Security Considerations</a></li>
<li><a href="#using-ajax-with-websockets">Using Ajax With WebSockets</a></li>
</ul>
</li>
<li><a href="#jakarta-servlet-technology-2">Chapter 18. Jakarta Servlet Technology</a>
<ul class="sectlevel2">
<li><a href="#what-is-a-servlet">What Is a Servlet?</a></li>
<li><a href="#servlet-lifecycle">Servlet Lifecycle</a></li>
<li><a href="#sharing-information">Sharing Information</a></li>
<li><a href="#creating-and-initializing-a-servlet">Creating and Initializing a Servlet</a></li>
<li><a href="#writing-service-methods">Writing Service Methods</a></li>
<li><a href="#filtering-requests-and-responses">Filtering Requests and Responses</a></li>
<li><a href="#invoking-other-web-resources">Invoking Other Web Resources</a></li>
<li><a href="#accessing-the-web-context">Accessing the Web Context</a></li>
<li><a href="#maintaining-client-state">Maintaining Client State</a></li>
<li><a href="#finalizing-a-servlet">Finalizing a Servlet</a></li>
<li><a href="#uploading-files-with-jakarta-servlet-technology">Uploading Files with Jakarta Servlet Technology</a></li>
<li><a href="#asynchronous-processing">Asynchronous Processing</a></li>
<li><a href="#nonblocking-io">Nonblocking I/O</a></li>
<li><a href="#server-push">Server Push</a></li>
<li><a href="#protocol-upgrade-processing">Protocol Upgrade Processing</a></li>
<li><a href="#http-trailer">HTTP Trailer</a></li>
<li><a href="#the-mood-example-application">The mood Example Application</a></li>
<li><a href="#the-fileupload-example-application">The fileupload Example Application</a></li>
<li><a href="#the-dukeetf-example-application">The dukeetf Example Application</a></li>
<li><a href="#further-information-about-jakarta-servlet-technology">Further Information about Jakarta Servlet Technology</a></li>
</ul>
</li>
<li><a href="#jakarta-websocket-2">Chapter 19. Jakarta WebSocket</a>
<ul class="sectlevel2">
<li><a href="#introduction-to-websocket">Introduction to WebSocket</a></li>
<li><a href="#creating-websocket-applications-in-the-jakarta-ee-platform">Creating WebSocket Applications in the Jakarta EE Platform</a></li>
<li><a href="#programmatic-endpoints">Programmatic Endpoints</a></li>
<li><a href="#annotated-endpoints">Annotated Endpoints</a></li>
<li><a href="#sending-and-receiving-messages">Sending and Receiving Messages</a></li>
<li><a href="#maintaining-client-state-2">Maintaining Client State</a></li>
<li><a href="#using-encoders-and-decoders">Using Encoders and Decoders</a></li>
<li><a href="#path-parameters">Path Parameters</a></li>
<li><a href="#handling-errors-2">Handling Errors</a></li>
<li><a href="#specifying-an-endpoint-configurator-class">Specifying an Endpoint Configurator Class</a></li>
<li><a href="#the-dukeetf2-example-application">The dukeetf2 Example Application</a></li>
<li><a href="#the-websocketbot-example-application">The websocketbot Example Application</a></li>
<li><a href="#further-information-about-websocket">Further Information about WebSocket</a></li>
</ul>
</li>
<li><a href="#json-processing">Chapter 20. JSON Processing</a>
<ul class="sectlevel2">
<li><a href="#introduction-to-json">Introduction to JSON</a></li>
<li><a href="#json-processing-in-the-jakarta-ee-platform">JSON Processing in the Jakarta EE Platform</a></li>
<li><a href="#using-the-object-model-api">Using the Object Model API</a></li>
<li><a href="#using-the-streaming-api">Using the Streaming API</a></li>
<li><a href="#json-in-jakarta-ee-restful-web-services">JSON in Jakarta EE RESTful Web Services</a></li>
<li><a href="#the-jsonpmodel-example-application">The jsonpmodel Example Application</a></li>
<li><a href="#the-jsonpstreaming-example-application">The jsonpstreaming Example Application</a></li>
<li><a href="#further-information-about-the-jakarta-json-processing">Further Information about the Jakarta JSON Processing</a></li>
</ul>
</li>
<li><a href="#json-binding">Chapter 21. JSON Binding</a>
<ul class="sectlevel2">
<li><a href="#json-binding-in-the-jakarta-ee-platform">JSON Binding in the Jakarta EE Platform</a></li>
<li><a href="#overview-of-the-json-binding-api">Overview of the JSON Binding API</a></li>
<li><a href="#running-the-jsonbbasics-example-application">Running the jsonbbasics Example Application</a></li>
<li><a href="#further-information-about-the-jakarta-json-binding">Further Information about the Jakarta JSON Binding</a></li>
</ul>
</li>
<li><a href="#internationalizing-and-localizing-web-applications">Chapter 22. Internationalizing and Localizing Web Applications</a>
<ul class="sectlevel2">
<li><a href="#java-platform-localization-classes">Java Platform Localization Classes</a></li>
<li><a href="#providing-localized-messages-and-labels">Providing Localized Messages and Labels</a></li>
<li><a href="#date-and-number-formatting">Date and Number Formatting</a></li>
<li><a href="#character-sets-and-encodings">Character Sets and Encodings</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#bean-validation">Part IV: Bean Validation</a>
<ul class="sectlevel1">
<li><a href="#introduction-to-jakarta-bean-validation">Chapter 23. Introduction to Jakarta Bean Validation</a>
<ul class="sectlevel2">
<li><a href="#overview-of-jakarta-bean-validation">Overview of Jakarta Bean Validation</a></li>
<li><a href="#using-jakarta-bean-validation-constraints">Using Jakarta Bean Validation Constraints</a></li>
<li><a href="#repeating-annotations">Repeating Annotations</a></li>
<li><a href="#validating-null-and-empty-strings">Validating Null and Empty Strings</a></li>
<li><a href="#validating-constructors-and-methods">Validating Constructors and Methods</a></li>
<li><a href="#further-information-about-jakarta-bean-validation">Further Information about Jakarta Bean Validation</a></li>
</ul>
</li>
<li><a href="#bean-validation-advanced-topics">Chapter 24. Bean Validation: Advanced Topics</a>
<ul class="sectlevel2">
<li><a href="#creating-custom-constraints">Creating Custom Constraints</a></li>
<li><a href="#implementing-temporal-constraints-using-clockprovider">Implementing Temporal Constraints Using ClockProvider</a></li>
<li><a href="#custom-constraints">Custom Constraints</a></li>
<li><a href="#using-in-built-value-extractors-in-custom-containers">Using In-Built Value Extractors in Custom Containers</a></li>
<li><a href="#customizing-validator-messages">Customizing Validator Messages</a></li>
<li><a href="#grouping-constraints">Grouping Constraints</a></li>
<li><a href="#using-method-constraints-in-type-hierarchies">Using Method Constraints in Type Hierarchies</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#jakarta-ee-contexts-and-dependency-injection">Part V: Jakarta EE Contexts and Dependency Injection</a>
<ul class="sectlevel1">
<li><a href="#introduction-to-jakarta-contexts-and-dependency-injection">Chapter 25. Introduction to Jakarta Contexts and Dependency Injection</a>
<ul class="sectlevel2">
<li><a href="#getting-started">Getting Started</a></li>
<li><a href="#overview-of-cdi">Overview of CDI</a></li>
<li><a href="#about-beans">About Beans</a></li>
<li><a href="#about-cdi-managed-beans">About CDI Managed Beans</a></li>
<li><a href="#beans-as-injectable-objects">Beans as Injectable Objects</a></li>
<li><a href="#using-qualifiers">Using Qualifiers</a></li>
<li><a href="#injecting-beans">Injecting Beans</a></li>
<li><a href="#using-scopes">Using Scopes</a></li>
<li><a href="#giving-beans-el-names">Giving Beans EL Names</a></li>
<li><a href="#adding-setter-and-getter-methods">Adding Setter and Getter Methods</a></li>
<li><a href="#using-a-managed-bean-in-a-facelets-page">Using a Managed Bean in a Facelets Page</a></li>
<li><a href="#injecting-objects-by-using-producer-methods">Injecting Objects by Using Producer Methods</a></li>
<li><a href="#configuring-a-cdi-application">Configuring a CDI Application</a></li>
<li><a href="#using-the-postconstruct-and-predestroy-annotations-with-cdi-managed-bean-classes">Using the @PostConstruct and @PreDestroy Annotations with CDI Managed Bean Classes</a></li>
<li><a href="#further-information-about-cdi">Further Information about CDI</a></li>
</ul>
</li>
<li><a href="#running-the-basic-contexts-and-dependency-injection-examples">Chapter 26. Running the Basic Contexts and Dependency Injection Examples</a>
<ul class="sectlevel2">
<li><a href="#building-and-running-the-cdi-samples">Building and Running the CDI Samples</a></li>
<li><a href="#the-simplegreeting-cdi-example">The simplegreeting CDI Example</a></li>
<li><a href="#the-guessnumber-cdi-cdi-example">The guessnumber-cdi CDI Example</a></li>
</ul>
</li>
<li><a href="#jakarta-contexts-and-dependency-injection-advanced-topics">Chapter 27. Jakarta Contexts and Dependency Injection: Advanced Topics</a>
<ul class="sectlevel2">
<li><a href="#packaging-cdi-applications">Packaging CDI Applications</a></li>
<li><a href="#using-alternatives-in-cdi-applications">Using Alternatives in CDI Applications</a></li>
<li><a href="#using-producer-methods-producer-fields-and-disposer-methods-in-cdi-applications">Using Producer Methods, Producer Fields, and Disposer Methods in CDI Applications</a></li>
<li><a href="#using-predefined-beans-in-cdi-applications">Using Predefined Beans in CDI Applications</a></li>
<li><a href="#using-events-in-cdi-applications">Using Events in CDI Applications</a></li>
<li><a href="#using-interceptors-in-cdi-applications">Using Interceptors in CDI Applications</a></li>
<li><a href="#using-decorators-in-cdi-applications">Using Decorators in CDI Applications</a></li>
<li><a href="#using-stereotypes-in-cdi-applications">Using Stereotypes in CDI Applications</a></li>
<li><a href="#using-the-built-in-annotation-literals">Using the Built-In Annotation Literals</a></li>
<li><a href="#using-the-configurators-interfaces">Using the Configurators Interfaces</a></li>
</ul>
</li>
<li><a href="#bootstrapping-a-cdi-container-in-java-se">Chapter 28. Bootstrapping a CDI Container in Java SE</a>
<ul class="sectlevel2">
<li><a href="#the-bootstrap-api">The Bootstrap API</a></li>
<li><a href="#configuring-the-cdi-container">Configuring the CDI Container</a></li>
</ul>
</li>
<li><a href="#running-the-advanced-contexts-and-dependency-injection-examples">Chapter 29. Running the Advanced Contexts and Dependency Injection Examples</a>
<ul class="sectlevel2">
<li><a href="#building-and-running-the-cdi-advanced-examples">Building and Running the CDI Advanced Examples</a></li>
<li><a href="#the-encoder-example-using-alternatives">The encoder Example: Using Alternatives</a></li>
<li><a href="#the-producermethods-example-using-a-producer-method-to-choose-a-bean-implementation">The producermethods Example: Using a Producer Method to Choose a Bean Implementation</a></li>
<li><a href="#the-producerfields-example-using-producer-fields-to-generate-resources">The producerfields Example: Using Producer Fields to Generate Resources</a></li>
<li><a href="#the-billpayment-example-using-events-and-interceptors">The billpayment Example: Using Events and Interceptors</a></li>
<li><a href="#the-decorators-example-decorating-a-bean">The decorators Example: Decorating a Bean</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#web-services">Part VI: Web Services</a>
<ul class="sectlevel1">
<li><a href="#introduction-to-web-services">Chapter 30. Introduction to Web Services</a>
<ul class="sectlevel2">
<li><a href="#what-are-web-services">What Are Web Services?</a></li>
<li><a href="#types-of-web-services">Types of Web Services</a></li>
<li><a href="#deciding-which-type-of-web-service-to-use">Deciding Which Type of Web Service to Use</a></li>
</ul>
</li>
<li><a href="#building-web-services-with-jakarta-xml-web-services">Chapter 31. Building Web Services with Jakarta XML Web Services</a>
<ul class="sectlevel2">
<li><a href="#overview-of-jakarta-xml-web-services">Overview of Jakarta XML Web Services</a></li>
<li><a href="#creating-a-simple-web-service-and-clients-with-xml-web-services">Creating a Simple Web Service and Clients with XML Web Services</a></li>
<li><a href="#types-supported-by-xml-web-services">Types Supported by XML Web Services</a></li>
<li><a href="#web-services-interoperability-and-jakarta-xml-web-services">Web Services Interoperability and Jakarta XML Web Services</a></li>
<li><a href="#further-information-about-jakarta-xml-web-services">Further Information about Jakarta XML Web Services</a></li>
</ul>
</li>
<li><a href="#building-restful-web-services-with-jakarta-rest">Chapter 32. Building RESTful Web Services with Jakarta REST</a>
<ul class="sectlevel2">
<li><a href="#what-are-restful-web-services">What Are RESTful Web Services?</a></li>
<li><a href="#creating-a-restful-root-resource-class">Creating a RESTful Root Resource Class</a></li>
<li><a href="#example-applications-for-jakarta-rest">Example Applications for Jakarta REST</a></li>
<li><a href="#further-information-about-jakarta-rest">Further Information about Jakarta REST</a></li>
</ul>
</li>
<li><a href="#accessing-rest-resources-with-the-jakarta-rest-client-api">Chapter 33. Accessing REST Resources with the Jakarta REST Client API</a>
<ul class="sectlevel2">
<li><a href="#overview-of-the-client-api">Overview of the Client API</a></li>
<li><a href="#using-the-client-api-in-the-jakarta-rest-example-applications">Using the Client API in the Jakarta REST Example Applications</a></li>
<li><a href="#advanced-features-of-the-client-api">Advanced Features of the Client API</a></li>
</ul>
</li>
<li><a href="#jakarta-rest-advanced-topics-and-an-example">Chapter 34. Jakarta REST: Advanced Topics and an Example</a>
<ul class="sectlevel2">
<li><a href="#annotations-for-field-and-bean-properties-of-resource-classes">Annotations for Field and Bean Properties of Resource Classes</a></li>
<li><a href="#validating-resource-data-with-bean-validation">Validating Resource Data with Bean Validation</a></li>
<li><a href="#subresources-and-runtime-resource-resolution">Subresources and Runtime Resource Resolution</a></li>
<li><a href="#integrating-jakarta-rest-with-jakarta-enterprise-beans-technology-and-cdi">Integrating Jakarta REST with Jakarta Enterprise Beans Technology and CDI</a></li>
<li><a href="#conditional-http-requests">Conditional HTTP Requests</a></li>
<li><a href="#runtime-content-negotiation">Runtime Content Negotiation</a></li>
<li><a href="#using-jakarta-rest-with-jakarta-xml-binding">Using Jakarta REST with Jakarta XML Binding</a></li>
<li><a href="#the-customer-example-application">The customer Example Application</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#enterprise-beans">Part VII: Enterprise Beans</a>
<ul class="sectlevel1">
<li><a href="#enterprise-beans-2">Chapter 35. Enterprise Beans</a>
<ul class="sectlevel2">
<li><a href="#what-is-an-enterprise-bean">What Is an Enterprise Bean?</a></li>
<li><a href="#what-is-a-session-bean">What Is a Session Bean?</a></li>
<li><a href="#what-is-a-message-driven-bean">What Is a Message-Driven Bean?</a></li>
<li><a href="#accessing-enterprise-beans">Accessing Enterprise Beans</a></li>
<li><a href="#the-contents-of-an-enterprise-bean">The Contents of an Enterprise Bean</a></li>
<li><a href="#naming-conventions-for-enterprise-beans">Naming Conventions for Enterprise Beans</a></li>
<li><a href="#the-lifecycles-of-enterprise-beans">The Lifecycles of Enterprise Beans</a></li>
<li><a href="#further-information-about-enterprise-beans">Further Information about Enterprise Beans</a></li>
</ul>
</li>
<li><a href="#getting-started-with-enterprise-beans">Chapter 36. Getting Started with Enterprise Beans</a>
<ul class="sectlevel2">
<li><a href="#starting-with-enterprise-beans">Starting With Enterprise Beans</a></li>
<li><a href="#creating-the-enterprise-bean">Creating the Enterprise Bean</a></li>
<li><a href="#modifying-the-jakarta-ee-application">Modifying the Jakarta EE Application</a></li>
</ul>
</li>
<li><a href="#running-the-enterprise-bean-examples">Chapter 37. Running the Enterprise Bean Examples</a>
<ul class="sectlevel2">
<li><a href="#overview-of-the-jakarta-enterprise-beans-examples">Overview of the Jakarta Enterprise Beans Examples</a></li>
<li><a href="#the-cart-example">The cart Example</a></li>
<li><a href="#a-singleton-session-bean-example-counter">A Singleton Session Bean Example: counter</a></li>
<li><a href="#a-web-service-example-helloservice">A Web Service Example: helloservice</a></li>
<li><a href="#using-the-timer-service">Using the Timer Service</a></li>
<li><a href="#handling-exceptions">Handling Exceptions</a></li>
</ul>
</li>
<li><a href="#using-the-embedded-enterprise-bean-container">Chapter 38. Using the Embedded Enterprise Bean Container</a>
<ul class="sectlevel2">
<li><a href="#overview-of-the-embedded-enterprise-bean-container">Overview of the Embedded Enterprise Bean Container</a></li>
<li><a href="#developing-embeddable-enterprise-bean-applications">Developing Embeddable Enterprise Bean Applications</a></li>
<li><a href="#the-standalone-example-application">The standalone Example Application</a></li>
</ul>
</li>
<li><a href="#using-asynchronous-method-invocation-in-session-beans">Chapter 39. Using Asynchronous Method Invocation in Session Beans</a>
<ul class="sectlevel2">
<li><a href="#asynchronous-method-invocation">Asynchronous Method Invocation</a></li>
<li><a href="#the-async-example-application">The async Example Application</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#persistence">Part VIII: Persistence</a>
<ul class="sectlevel1">
<li><a href="#introduction-to-jakarta-persistence">Chapter 40. Introduction to Jakarta Persistence</a>
<ul class="sectlevel2">
<li><a href="#overview-of-jakarta-persistence">Overview of Jakarta Persistence</a></li>
<li><a href="#entities">Entities</a></li>
<li><a href="#entity-inheritance">Entity Inheritance</a></li>
<li><a href="#managing-entities">Managing Entities</a></li>
<li><a href="#querying-entities">Querying Entities</a></li>
<li><a href="#database-schema-creation">Database Schema Creation</a></li>
<li><a href="#further-information-about-persistence">Further Information about Persistence</a></li>
</ul>
</li>
<li><a href="#running-the-persistence-examples">Chapter 41. Running the Persistence Examples</a>
<ul class="sectlevel2">
<li><a href="#overview-of-the-persistence-examples">Overview of the Persistence Examples</a></li>
<li><a href="#the-order-application">The order Application</a></li>
<li><a href="#the-roster-application">The roster Application</a></li>
<li><a href="#the-address-book-application">The address-book Application</a></li>
</ul>
</li>
<li><a href="#the-jakarta-persistence-query-language">Chapter 42. The Jakarta Persistence Query Language</a>
<ul class="sectlevel2">
<li><a href="#overview-of-the-jakarta-persistence-query-language">Overview of the Jakarta Persistence Query Language</a></li>
<li><a href="#query-language-terminology">Query Language Terminology</a></li>
<li><a href="#creating-queries-using-the-jakarta-persistence-query-language">Creating Queries Using the Jakarta Persistence Query Language</a></li>
<li><a href="#simplified-query-language-syntax">Simplified Query Language Syntax</a></li>
<li><a href="#example-queries">Example Queries</a></li>
<li><a href="#full-query-language-syntax">Full Query Language Syntax</a></li>
</ul>
</li>
<li><a href="#using-the-criteria-api-to-create-queries">Chapter 43. Using the Criteria API to Create Queries</a>
<ul class="sectlevel2">
<li><a href="#overview-of-the-criteria-and-metamodel-apis">Overview of the Criteria and Metamodel APIs</a></li>
<li><a href="#using-the-metamodel-api-to-model-entity-classes">Using the Metamodel API to Model Entity Classes</a></li>
<li><a href="#using-the-criteria-api-and-metamodel-api-to-create-basic-typesafe-queries">Using the Criteria API and Metamodel API to Create Basic Typesafe Queries</a></li>
</ul>
</li>
<li><a href="#creating-and-using-string-based-criteria-queries">Chapter 44. Creating and Using String-Based Criteria Queries</a>
<ul class="sectlevel2">
<li><a href="#overview-of-string-based-criteria-api-queries">Overview of String-Based Criteria API Queries</a></li>
<li><a href="#creating-string-based-queries">Creating String-Based Queries</a></li>
<li><a href="#executing-string-based-queries">Executing String-Based Queries</a></li>
</ul>
</li>
<li><a href="#controlling-concurrent-access-to-entity-data-with-locking">Chapter 45. Controlling Concurrent Access to Entity Data with Locking</a>
<ul class="sectlevel2">
<li><a href="#overview-of-entity-locking-and-concurrency">Overview of Entity Locking and Concurrency</a></li>
<li><a href="#lock-modes">Lock Modes</a></li>
</ul>
</li>
<li><a href="#creating-fetch-plans-with-entity-graphs">Chapter 46. Creating Fetch Plans with Entity Graphs</a>
<ul class="sectlevel2">
<li><a href="#overview-of-using-fetch-plans-and-entity-graphs">Overview of Using Fetch Plans and Entity Graphs</a></li>
<li><a href="#entity-graph-basics">Entity Graph Basics</a></li>
<li><a href="#using-named-entity-graphs">Using Named Entity Graphs</a></li>
<li><a href="#using-entity-graphs-in-query-operations">Using Entity Graphs in Query Operations</a></li>
</ul>
</li>
<li><a href="#using-a-second-level-cache-with-jakarta-persistence-applications">Chapter 47. Using a Second-Level Cache with Jakarta Persistence Applications</a>
<ul class="sectlevel2">
<li><a href="#overview-of-the-second-level-cache">Overview of the Second-Level Cache</a></li>
<li><a href="#specifying-the-cache-mode-settings-to-improve-performance">Specifying the Cache Mode Settings to Improve Performance</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#messaging">Part IX: Messaging</a>
<ul class="sectlevel1">
<li><a href="#jakarta-messaging-concepts">Chapter 48. Jakarta Messaging Concepts</a>
<ul class="sectlevel2">
<li><a href="#jakarta-messaging-overview">Jakarta Messaging Overview</a></li>
<li><a href="#basic-jakarta-messaging-concepts">Basic Jakarta Messaging Concepts</a></li>
<li><a href="#jakarta-messaging-programming-model">Jakarta Messaging Programming Model</a></li>
<li><a href="#using-advanced-jakarta-messaging-features">Using Advanced Jakarta Messaging Features</a></li>
<li><a href="#using-jakarta-messaging-in-jakarta-ee-applications">Using Jakarta Messaging in Jakarta EE Applications</a></li>
<li><a href="#further-information-about-jakarta-messaging">Further Information about Jakarta Messaging</a></li>
</ul>
</li>
<li><a href="#jakarta-messaging-examples">Chapter 49. Jakarta Messaging Examples</a>
<ul class="sectlevel2">
<li><a href="#building-and-running-jakarta-messaging-examples">Building and Running Jakarta Messaging Examples</a></li>
<li><a href="#overview-of-the-jakarta-messaging-examples">Overview of the Jakarta Messaging Examples</a></li>
<li><a href="#writing-simple-jakarta-messaging-applications">Writing Simple Jakarta Messaging Applications</a></li>
<li><a href="#writing-more-advanced-jakarta-messaging-applications">Writing More Advanced Jakarta Messaging Applications</a></li>
<li><a href="#writing-high-performance-and-scalable-jakarta-messaging-applications">Writing High Performance and Scalable Jakarta Messaging Applications</a></li>
<li><a href="#sending-and-receiving-messages-using-a-simple-web-application">Sending and Receiving Messages Using a Simple Web Application</a></li>
<li><a href="#receiving-messages-asynchronously-using-a-message-driven-bean">Receiving Messages Asynchronously Using a Message-Driven Bean</a></li>
<li><a href="#sending-messages-from-a-session-bean-to-an-mdb">Sending Messages from a Session Bean to an MDB</a></li>
<li><a href="#using-an-entity-to-join-messages-from-two-mdbs">Using an Entity to Join Messages from Two MDBs</a></li>
<li><a href="#using-netbeans-ide-to-create-jakarta-messaging-resources">Using NetBeans IDE to Create Jakarta Messaging Resources</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#security-2">Part X: Security</a>
<ul class="sectlevel1">
<li><a href="#introduction-to-security-in-the-jakarta-ee-platform">Chapter 50. Introduction to Security in the Jakarta EE Platform</a>
<ul class="sectlevel2">
<li><a href="#overview-of-jakarta-security">Overview of Jakarta Security</a></li>
<li><a href="#security-mechanisms">Security Mechanisms</a></li>
<li><a href="#using-pluggable-providers">Using Pluggable Providers</a></li>
<li><a href="#securing-containers">Securing Containers</a></li>
<li><a href="#securing-glassfish-server">Securing GlassFish Server</a></li>
<li><a href="#working-with-identity-stores">Working with Identity Stores</a></li>
<li><a href="#working-with-realms-users-groups-and-roles">Working with Realms, Users, Groups, and Roles</a></li>
<li><a href="#establishing-a-secure-connection-using-ssl">Establishing a Secure Connection Using SSL</a></li>
<li><a href="#further-information-about-security">Further Information about Security</a></li>
</ul>
</li>
<li><a href="#getting-started-securing-web-applications">Chapter 51. Getting Started Securing Web Applications</a>
<ul class="sectlevel2">
<li><a href="#overview-of-web-application-security">Overview of Web Application Security</a></li>
<li><a href="#securing-web-applications">Securing Web Applications</a></li>
<li><a href="#using-programmatic-security-with-web-applications">Using Programmatic Security with Web Applications</a></li>
<li><a href="#examples-securing-web-applications">Examples: Securing Web Applications</a></li>
</ul>
</li>
<li><a href="#getting-started-securing-enterprise-applications">Chapter 52. Getting Started Securing Enterprise Applications</a>
<ul class="sectlevel2">
<li><a href="#basic-security-tasks-for-enterprise-applications">Basic Security Tasks for Enterprise Applications</a></li>
<li><a href="#securing-enterprise-beans">Securing Enterprise Beans</a></li>
<li><a href="#examples-securing-enterprise-beans">Examples: Securing Enterprise Beans</a></li>
</ul>
</li>
<li><a href="#using-jakarta-security">Chapter 53. Using Jakarta Security</a>
<ul class="sectlevel2">
<li><a href="#about-jakarta-security">About Jakarta Security</a></li>
<li><a href="#overview-of-the-http-authentication-mechanism-interface">Overview of the HTTP Authentication Mechanism Interface</a></li>
<li><a href="#overview-of-the-identity-store-interfaces">Overview of the Identity Store Interfaces</a></li>
<li><a href="#running-the-built-in-database-identity-store-example">Running the Built-In Database Identity Store Example</a></li>
<li><a href="#running-the-custom-identity-store-example">Running the Custom Identity Store Example</a></li>
</ul>
</li>
<li><a href="#jakarta-ee-security-advanced-topics">Chapter 54. Jakarta EE Security: Advanced Topics</a>
<ul class="sectlevel2">
<li><a href="#working-with-digital-certificates">Working with Digital Certificates</a></li>
<li><a href="#authentication-mechanisms">Authentication Mechanisms</a></li>
<li><a href="#using-the-jdbc-realm-for-user-authentication">Using the JDBC Realm for User Authentication</a></li>
<li><a href="#securing-http-resources">Securing HTTP Resources</a></li>
<li><a href="#securing-application-clients">Securing Application Clients</a></li>
<li><a href="#securing-enterprise-information-systems-applications">Securing Enterprise Information Systems Applications</a></li>
<li><a href="#configuring-security-using-deployment-descriptors">Configuring Security Using Deployment Descriptors</a></li>
<li><a href="#further-information-about-advanced-security-topics">Further Information about Advanced Security Topics</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#jakarta-ee-supporting-technologies">Part XI: Jakarta EE Supporting Technologies</a>
<ul class="sectlevel1">
<li><a href="#transactions">Chapter 55. Transactions</a>
<ul class="sectlevel2">
<li><a href="#overview-of-transactions">Overview of Transactions</a></li>
<li><a href="#transactions-in-jakarta-ee-applications">Transactions in Jakarta EE Applications</a></li>
<li><a href="#what-is-a-transaction">What Is a Transaction?</a></li>
<li><a href="#container-managed-transactions">Container-Managed Transactions</a></li>
<li><a href="#bean-managed-transactions">Bean-Managed Transactions</a></li>
<li><a href="#transaction-timeouts">Transaction Timeouts</a></li>
<li><a href="#updating-multiple-databases">Updating Multiple Databases</a></li>
<li><a href="#transactions-in-web-components">Transactions in Web Components</a></li>
<li><a href="#further-information-about-transactions">Further Information about Transactions</a></li>
</ul>
</li>
<li><a href="#resource-adapters-and-contracts">Chapter 56. Resource Adapters and Contracts</a>
<ul class="sectlevel2">
<li><a href="#what-is-a-resource-adapter">What Is a Resource Adapter?</a></li>
<li><a href="#metadata-annotations">Metadata Annotations</a></li>
<li><a href="#common-client-interface">Common Client Interface</a></li>
<li><a href="#using-resource-adapters-with-jakarta-contexts-and-dependency-injection-cdi">Using Resource Adapters with Jakarta Contexts and Dependency Injection (CDI)</a></li>
<li><a href="#further-information-about-resource-adapters">Further Information about Resource Adapters</a></li>
</ul>
</li>
<li><a href="#the-resource-adapter-examples">Chapter 57. The Resource Adapter Examples</a>
<ul class="sectlevel2">
<li><a href="#overview-of-the-resource-adapter-examples">Overview of the Resource Adapter Examples</a></li>
<li><a href="#the-trading-example">The trading Example</a></li>
<li><a href="#the-traffic-example">The traffic Example</a></li>
</ul>
</li>
<li><a href="#using-jakarta-ee-interceptors">Chapter 58. Using Jakarta EE Interceptors</a>
<ul class="sectlevel2">
<li><a href="#overview-of-interceptors">Overview of Interceptors</a></li>
<li><a href="#using-interceptors">Using Interceptors</a></li>
<li><a href="#the-interceptor-example-application">The interceptor Example Application</a></li>
</ul>
</li>
<li><a href="#batch-processing">Chapter 59. Batch Processing</a>
<ul class="sectlevel2">
<li><a href="#introduction-to-batch-processing">Introduction to Batch Processing</a></li>
<li><a href="#batch-processing-in-jakarta-ee">Batch Processing in Jakarta EE</a></li>
<li><a href="#simple-use-case">Simple Use Case</a></li>
<li><a href="#using-the-job-specification-language">Using the Job Specification Language</a></li>
<li><a href="#creating-batch-artifacts">Creating Batch Artifacts</a></li>
<li><a href="#submitting-jobs-to-the-batch-runtime">Submitting Jobs to the Batch Runtime</a></li>
<li><a href="#packaging-batch-applications">Packaging Batch Applications</a></li>
<li><a href="#the-webserverlog-example-application">The webserverlog Example Application</a></li>
<li><a href="#the-phonebilling-example-application">The phonebilling Example Application</a></li>
<li><a href="#further-information-about-batch-processing">Further Information about Batch Processing</a></li>
</ul>
</li>
<li><a href="#jakarta-concurrency-2">Chapter 60. Jakarta Concurrency</a>
<ul class="sectlevel2">
<li><a href="#concurrency-basics">Concurrency Basics</a></li>
<li><a href="#main-components-of-the-concurrency-utilities">Main Components of the Concurrency Utilities</a></li>
<li><a href="#concurrency-and-transactions">Concurrency and Transactions</a></li>
<li><a href="#concurrency-and-security">Concurrency and Security</a></li>
<li><a href="#the-jobs-concurrency-example">The jobs Concurrency Example</a></li>
<li><a href="#the-taskcreator-concurrency-example">The taskcreator Concurrency Example</a></li>
<li><a href="#further-information-about-jakarta-concurrency">Further Information about Jakarta Concurrency</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#case-studies">Part XII: Case Studies</a>
<ul class="sectlevel1">
<li><a href="#dukes-bookstore-case-study-example">Chapter 61. Duke&#8217;s Bookstore Case Study Example</a>
<ul class="sectlevel2">
<li><a href="#design-and-architecture-of-dukes-bookstore">Design and Architecture of Duke&#8217;s Bookstore</a></li>
<li><a href="#the-dukes-bookstore-interface">The Duke&#8217;s Bookstore Interface</a></li>
<li><a href="#running-the-dukes-bookstore-case-study-application">Running the Duke&#8217;s Bookstore Case Study Application</a></li>
</ul>
</li>
<li><a href="#dukes-tutoring-case-study-example">Chapter 62. Duke&#8217;s Tutoring Case Study Example</a>
<ul class="sectlevel2">
<li><a href="#design-and-architecture-of-dukes-tutoring">Design and Architecture of Duke&#8217;s Tutoring</a></li>
<li><a href="#main-interface">Main Interface</a></li>
<li><a href="#administration-interface">Administration Interface</a></li>
<li><a href="#running-the-dukes-tutoring-case-study-application">Running the Duke&#8217;s Tutoring Case Study Application</a></li>
</ul>
</li>
<li><a href="#dukes-forest-case-study-example">Chapter 63. Duke&#8217;s Forest Case Study Example</a>
<ul class="sectlevel2">
<li><a href="#overview-of-the-dukes-forest-case-study-example">Overview of the Duke&#8217;s Forest Case Study Example</a></li>
<li><a href="#design-and-architecture-of-dukes-forest">Design and Architecture of Duke&#8217;s Forest</a></li>
<li><a href="#building-and-deploying-the-dukes-forest-case-study-application">Building and Deploying the Duke&#8217;s Forest Case Study Application</a></li>
<li><a href="#running-the-dukes-forest-application">Running the Duke&#8217;s Forest Application</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre>The Jakarta&#174; EE Tutorial

Version: Release 9

Status: DRAFT

Release: May 2021</pre>
</div>
</div>
<div class="paragraph">
<p>Copyright &#169; 2017, 2021 Oracle and/or its affiliates. All rights reserved.</p>
</div>
<div class="paragraph">
<p>This program and the accompanying materials are made available under the terms of the Eclipse Public License v. 2.0, which is available at <a href="https://www.eclipse.org/legal/epl-2.0" class="bare" target="_blank" rel="noopener">https://www.eclipse.org/legal/epl-2.0</a>.</p>
</div>
<div class="paragraph">
<p>SPDX-License-Identifier: EPL-2.0</p>
</div>
<div class="paragraph">
<p>Oracle and Java are registered trademarks of Oracle and/or its affiliates.
Other names may be trademarks of their respective owners.</p>
</div>
<div class="paragraph">
<p>Intel and Intel Xeon are trademarks or registered trademarks of Intel Corporation.
All SPARC trademarks are used under license and are trademarks or registered trademarks of SPARC International, Inc.
AMD, Opteron, the AMD logo, and the AMD Opteron logo are trademarks or registered trademarks of Advanced Micro Devices.
UNIX is a registered trademark of The Open Group.</p>
</div>
<div class="paragraph">
<p> : <a href="https://www.bychkov.name/%20Jakarta%20EE.pdf">Jakarta EE Tutorial -  </a>.</p>
</div>
<div class="paragraph">
<p><a href="mailto:github@bychkov.name"></a>   : <a href="mailto:github@bychkov.name">github@bychkov.name</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="preface"><a class="anchor" href="#preface"></a>Preface</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This tutorial is a guide to developing enterprise applications for the Jakarta EE 9 Platform, using Eclipse GlassFish Server.</p>
</div>
<div class="paragraph">
<p>Eclipse GlassFish Server is the leading open-source and open-community platform for building and deploying next-generation applications and services.
Eclipse GlassFish Server, developed by the Eclipse GlassFish project open-source community at <a href="https://projects.eclipse.org/projects/ee4j.glassfish" class="bare" target="_blank" rel="noopener">https://projects.eclipse.org/projects/ee4j.glassfish</a>, is a compatible implementation of the Jakarta EE 9 platform specification.
This lightweight, flexible, and open-source application server enables organizations not only to leverage the new capabilities introduced within the Jakarta EE 9 specification, but also to add to their existing capabilities through a faster and more streamlined development and deployment cycle.
Eclipse GlassFish Server is hereafter referred to as GlassFish Server.</p>
</div>
<div class="sect2">
<h3 id="audience"><a class="anchor" href="#audience"></a>Audience</h3>
<div class="paragraph">
<p>This tutorial is intended for programmers interested in developing and deploying Jakarta EE 9 applications.
It covers the technologies comprising the Jakarta EE platform and describes how to develop Jakarta EE components and deploy them on the Eclipse GlassFish.</p>
</div>
</div>
<div class="sect2">
<h3 id="before-you-read-this-book"><a class="anchor" href="#before-you-read-this-book"></a>Before You Read This Book</h3>
<div class="paragraph">
<p>Before proceeding with this tutorial, you should have a good knowledge of the Java programming language.
A good way to get to that point is to work through the Java&#8482; Tutorials <a href="https://docs.oracle.com/javase/tutorial/index.html" class="bare" target="_blank" rel="noopener">https://docs.oracle.com/javase/tutorial/index.html</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="related-documentation"><a class="anchor" href="#related-documentation"></a>Related Documentation</h3>
<div class="paragraph">
<p>The GlassFish Server documentation set describes deployment planning and system installation.
To obtain the GlassFish Server documentation, go to <a href="https://glassfish.org/docs" class="bare" target="_blank" rel="noopener">https://glassfish.org/docs</a>.</p>
</div>
<div class="paragraph">
<p>The Jakarta EE 9 API specification can be viewed at <a href="https://jakarta.ee/specifications/platform/9/" class="bare" target="_blank" rel="noopener">https://jakarta.ee/specifications/platform/9/</a>.</p>
</div>
<div class="paragraph">
<p>Additionally, the Jakarta EE Specifications at <a href="https://jakarta.ee/specifications" class="bare" target="_blank" rel="noopener">https://jakarta.ee/specifications</a> might be useful.</p>
</div>
<div class="paragraph">
<p>For information about creating enterprise applications in the NetBeans Integrated Development Environment (IDE), see <a href="https://netbeans.apache.org/kb/" class="bare" target="_blank" rel="noopener">https://netbeans.apache.org/kb/</a>.</p>
</div>
<div class="paragraph">
<p>For information about Apache Derby for use with GlassFish Server, see <a href="https://db.apache.org/derby/docs/10.14/adminguide/" class="bare" target="_blank" rel="noopener">https://db.apache.org/derby/docs/10.14/adminguide/</a>.</p>
</div>
<div class="paragraph">
<p>The GlassFish Samples project is a collection of sample applications that demonstrate a broad range of Jakarta EE technologies.
The GlassFish Samples are available from the GlassFish Samples project page at <a href="https://github.com/eclipse-ee4j/glassfish-samples/" class="bare" target="_blank" rel="noopener">https://github.com/eclipse-ee4j/glassfish-samples/</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="conventions"><a class="anchor" href="#conventions"></a>Conventions</h3>
<div class="paragraph">
<p>The following table describes the typographic conventions that are used in this book.</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 99%;">
<colgroup>
<col style="width: 21.0526%;">
<col style="width: 40%;">
<col style="width: 38.9474%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Convention</th>
<th class="tableblock halign-left valign-top">Meaning</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Boldface</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boldface type indicates graphical user interface elements associated with an action or terms defined in text.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">From the <strong>File</strong> menu, choose <strong>Open Project</strong>.</p>
<p class="tableblock">A <strong>cache</strong> is a copy that is stored locally.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Monospace</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Monospace type indicates the names of files and directories, commands within a paragraph, URLs, code in examples, text that appears on the screen, or text that you enter.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Edit your <code>.login</code> file.</p>
<p class="tableblock">Use <code>ls -a</code> to list all files.</p>
<p class="tableblock"><code><em>machine_name</em>% you have mail.</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Italic</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Italic type indicates book titles, emphasis, or placeholder variables for which you supply particular values.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Read Chapter 6 in the <em>User&#8217;s Guide</em>.</p>
<p class="tableblock">Do <em>not</em> save the file.</p>
<p class="tableblock">The command to remove a file is <code>rm <em>filename</em></code>.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="default-paths-and-file-names"><a class="anchor" href="#default-paths-and-file-names"></a>Default Paths and File Names</h3>
<div class="paragraph">
<p>The following table describes the default paths and file names that are
used in this book.</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 99%;">
<colgroup>
<col style="width: 20.8333%;">
<col style="width: 39.5833%;">
<col style="width: 39.5834%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Placeholder</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><em>as-install</em></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Represents the base installation directory for GlassFish Server.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Installations on the Solaris operating system, Linux operating system, and Mac operating system:</p>
<p class="tableblock"><code><em>user&#8217;s-home-directory</em>/glassfish6/glassfish</code></p>
<p class="tableblock">Windows, all installations:</p>
<p class="tableblock"><code><em>SystemDrive</em>:\glassfish6\glassfish</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><em>as-install-parent</em></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Represents the parent of the base installation directory for GlassFish Server.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Installations on the Solaris operating system, Linux operating system, and Mac operating system:</p>
<p class="tableblock"><code><em>user&#8217;s-home-directory</em>/glassfish6</code></p>
<p class="tableblock">Windows, all installations:</p>
<p class="tableblock"><code><em>SystemDrive</em>:\glassfish6</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><em>tut-install</em></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Represents the base installation directory for the Jakarta EE Tutorial after you download and extract it.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><em>user&#8217;s-home-directory</em>/jakartaee-tutorial</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><em>domain-dir</em></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Represents the directory in which a domain&#8217;s configuration is stored.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><em>as-install</em>/domains/domain1</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<h1 id="introduction" class="sect0"><a class="anchor" href="#introduction"></a>Part I: Introduction</h1>
<div class="openblock partintro">
<div class="content">
Part I introduces the platform, the tutorial, and the examples.
</div>
</div>
<div class="sect1">
<h2 id="overview"><a class="anchor" href="#overview"></a>Chapter 1. Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter introduces you to Jakarta EE enterprise application development.
Here you will review development basics, learn about the Jakarta EE architecture and APIs, become acquainted with important terms and concepts, and find out how to approach Jakarta EE application programming, assembly, and deployment.</p>
</div>
<div class="sect2">
<h3 id="introduction-to-jakarta-ee"><a class="anchor" href="#introduction-to-jakarta-ee"></a>Introduction to Jakarta EE</h3>
<div class="paragraph">
<p>Developers today increasingly recognize the need for distributed, transactional, and portable applications that leverage the speed, security, and reliability of server-side technology.
Enterprise applications provide the business logic for an enterprise.
They are centrally managed and often interact with other enterprise software.
In the world of information technology, enterprise applications must be designed, built, and produced for less money, with greater speed, and with fewer resources.</p>
</div>
<div class="paragraph">
<p>With Jakarta EE, development of Java enterprise applications has never been easier or faster.
The aim of the Jakarta EE platform is to provide developers with a powerful set of APIs while shortening development time, reducing application complexity, and improving application performance.</p>
</div>
<div class="paragraph">
<p>The Jakarta EE platform is developed through the Jakarta EE Specification Process.
Expert groups composed of interested parties have created Jakarta Specifications to define the various Jakarta EE technologies.
The work of the Jakarta Community under the Jakarta EE Specification Process program helps to ensure Java technology&#8217;s standards of stability and cross-platform compatibility.</p>
</div>
<div class="paragraph">
<p>The Jakarta EE platform uses a simplified programming model. XML deployment descriptors are optional.
Instead, a developer can simply enter the information as an annotation directly into a Java source file, and the Jakarta EE server will configure the component at deployment and runtime.
These annotations are generally used to embed in a program data that would otherwise be furnished in a deployment descriptor.
With annotations, you put the specification information in your code next to the program element affected.</p>
</div>
<div class="paragraph">
<p>In the Jakarta EE platform, dependency injection can be applied to all resources a component needs, effectively hiding the creation and lookup of resources from application code.
Dependency injection can be used in enterprise bean containers, web containers, and application clients.
Dependency injection allows the Jakarta EE container to automatically insert references to other required components or resources, using annotations.</p>
</div>
<div class="paragraph">
<p>This tutorial uses examples to describe the features available in the Jakarta EE platform for developing enterprise applications.
Whether you are a new or experienced enterprise developer, you should find the examples and accompanying text a valuable and accessible knowledge base for creating your own solutions.</p>
</div>
</div>
<div class="sect2">
<h3 id="jakarta-ee-9-platform-highlights"><a class="anchor" href="#jakarta-ee-9-platform-highlights"></a>Jakarta EE 9 Platform Highlights</h3>
<div class="paragraph">
<p>The goal of the Jakarta EE 9 release is to deliver a set of specifications functionally similar to Jakarta EE 8 but in the new Jakarta EE 9 namespace jakarta.*.</p>
</div>
<div class="paragraph">
<p>In addition, the Jakarta EE 9 release removes a small set of specifications from Jakarta EE 8 that were old, optional, or deprecated in order to reduce the surface area of the APIs to ensure that it is easier for new vendors to enter the ecosystem  as well as reduce the burden on implementation, migration, and maintenance of these old APIs.</p>
</div>
<div class="paragraph">
<p>The following Jakarta EE Technologies were removed from the Jakarta EE Platform:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>XML Registries 1.0</p>
</li>
<li>
<p>XML RPC 1.1</p>
</li>
<li>
<p>Deployment 1.7</p>
</li>
<li>
<p>Management 1.1</p>
</li>
<li>
<p>Distributed Interoperability (EJB 3.2 Core Specification, Chapter 10)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Aside from the removed technologies, some technologies in Jakarta EE 9 release are marked as optional.
The reason for this is that some of the technologies originally included in Jakarta EE are no longer as relevant as they were when they were introduced to the platform.</p>
</div>
<div class="paragraph">
<p>Platform Specification Project can decide to officially "remove" the "optional" feature from the Platform in the next (or beyond) releases.</p>
</div>
<div class="paragraph">
<p>The following technologies are optional:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Jakarta Enterprise Beans 3.2 and earlier entity beans and associated Jakarta Enterprise Beans QL</p>
</li>
<li>
<p>Jakarta Enterprise Beans 2.x API group</p>
</li>
<li>
<p>Jakarta Enterprise Web Services 2.0</p>
</li>
<li>
<p>Jakarta SOAP with Attachments 2.0</p>
</li>
<li>
<p>Jakarta Web Services Metadata 3.0</p>
</li>
<li>
<p>Jakarta XML Web Services 3.0</p>
</li>
<li>
<p>Jakarta XML Binding 3.0</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="jakarta-ee-application-model"><a class="anchor" href="#jakarta-ee-application-model"></a>Jakarta EE Application Model</h3>
<div class="paragraph">
<p>The Jakarta EE application model begins with the Java programming language and the Java virtual machine.
The proven portability, security, and developer productivity they provide form the basis of the application model.
Jakarta EE is designed to support applications that implement enterprise services for customers, employees, suppliers, partners, and others who make demands on or contributions to the enterprise.
Such applications are inherently complex, potentially accessing data from a variety of sources and distributing applications to a variety of clients.</p>
</div>
<div class="paragraph">
<p>To better control and manage these applications, the business functions to support these various users are conducted in the middle tier.
The middle tier represents an environment that is closely controlled by an enterprise&#8217;s information technology department.
The middle tier is typically run on dedicated server hardware and has access to the full services of the enterprise.</p>
</div>
<div class="paragraph">
<p>The Jakarta EE application model defines an architecture for implementing services as multitier applications that deliver the scalability, accessibility, and manageability needed by enterprise-level applications.
This model partitions the work needed to implement a multitier service into the following parts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The business and presentation logic to be implemented by the developer</p>
</li>
<li>
<p>The standard system services provided by the Jakarta EE platform</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The developer can rely on the platform to provide solutions for the hard systems-level problems of developing a multitier service.</p>
</div>
</div>
<div class="sect2">
<h3 id="distributed-multitiered-applications"><a class="anchor" href="#distributed-multitiered-applications"></a>Distributed Multitiered Applications</h3>
<div class="paragraph">
<p>The Jakarta EE platform uses a distributed multitiered application model for enterprise applications.
Application logic is divided into components according to function, and the application components that make up a Jakarta EE application are installed on various machines depending on the tier in the multitiered Jakarta EE environment to which the application component belongs.</p>
</div>
<div class="paragraph">
<p><a href="#multitiered-applications">Figure 1-1</a> shows two multitiered Jakarta EE applications divided into the tiers described in the following list. The Jakarta EE application parts shown in <a href="#multitiered-applications">Figure 1-1</a> are presented in <a href="#jakarta-ee-components">Jakarta EE Components</a>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Client-tier components run on the client machine.</p>
</li>
<li>
<p>Web-tier components run on the Jakarta EE server.</p>
</li>
<li>
<p>Business-tier components run on the Jakarta EE server.</p>
</li>
<li>
<p>Enterprise information system (EIS)-tier software runs on the EIS server.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Although a Jakarta EE application can consist of all tiers shown in <a href="#multitiered-applications">Figure 1-1</a>, Jakarta EE multitiered applications are generally considered to be three-tiered applications because they are distributed over three locations: client machines, the Jakarta EE server machine, and the database or legacy machines at the back end.
Three-tiered applications that run in this way extend the standard two-tiered client-and-server model by placing a multithreaded application server between the client application and back-end storage.</p>
</div>
<div id="multitiered-applications" class="imageblock">
<div class="content">
<img src="images/jakartaeett_dt_001.svg" alt="Diagram of multitiered application structure, including client tier, web tier, business tier, and EIS tier.">
</div>
<div class="title">Figure 1-1 Multitiered Applications</div>
</div>
<div class="sect3">
<h4 id="security"><a class="anchor" href="#security"></a>Security</h4>
<div class="paragraph">
<p>Although other enterprise application models require platform-specific security measures in each application, the Jakarta EE security environment enables security constraints to be defined at deployment time.
The Jakarta EE platform makes applications portable to a wide variety of security implementations by shielding application developers from the complexity of implementing security features.</p>
</div>
<div class="paragraph">
<p>The Jakarta EE platform provides standard declarative access control rules that are defined by the developer and interpreted when the application is deployed on the server.
Jakarta EE also provides standard login mechanisms so that application developers do not have to implement these mechanisms in their applications.
The same application works in a variety of security environments without changing the source code.</p>
</div>
</div>
<div class="sect3">
<h4 id="jakarta-ee-components"><a class="anchor" href="#jakarta-ee-components"></a>Jakarta EE Components</h4>
<div class="paragraph">
<p>Jakarta EE applications are made up of components.
A Jakarta EE component is a self-contained functional software unit that is assembled into a Jakarta EE application with its related classes and files and that communicates with other components.</p>
</div>
<div class="paragraph">
<p>The Jakarta EE specification defines the following Jakarta EE components:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Application clients and applets are components that run on the client.</p>
</li>
<li>
<p>Jakarta Servlet, Jakarta Faces, and Jakarta Server Pages technology components are web components that run on the server.</p>
</li>
<li>
<p>Enterprise bean components (enterprise beans) are business components that run on the server.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Jakarta EE components are written in the Java programming language and are compiled in the same way as any program in the language.
The differences between Jakarta EE components and "standard" Java classes are that Jakarta EE components are assembled into a Jakarta EE application, they are verified to be well formed and in compliance with the Jakarta EE specification, and they are deployed to production, where they are run and managed by the Jakarta EE server.</p>
</div>
</div>
<div class="sect3">
<h4 id="jakarta-ee-clients"><a class="anchor" href="#jakarta-ee-clients"></a>Jakarta EE Clients</h4>
<div class="paragraph">
<p>A Jakarta EE client is usually either a web client or an application client.</p>
</div>
<div class="sect4">
<h5 id="web-clients"><a class="anchor" href="#web-clients"></a>Web Clients</h5>
<div class="paragraph">
<p>A web client consists of two parts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Dynamic web pages containing various types of markup language (HTML, XML, and so on), which are generated by web components running in the web tier</p>
</li>
<li>
<p>A web browser, which renders the pages received from the server</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A web client is sometimes called a thin client.
Thin clients usually do not query databases, execute complex business rules, or connect to legacy applications.
When you use a thin client, such heavyweight operations are off-loaded to enterprise beans executing on the Jakarta EE server, where they can leverage the security, speed, services, and reliability of Jakarta EE server-side technologies.</p>
</div>
</div>
<div class="sect4">
<h5 id="application-clients"><a class="anchor" href="#application-clients"></a>Application Clients</h5>
<div class="paragraph">
<p>An application client runs on a client machine and provides a way for users to handle tasks that require a richer user interface than can be provided by a markup language.
An application client typically has a graphical user interface (GUI) created from the Swing API or the Abstract Window Toolkit (AWT) API, but a command-line interface is certainly possible.</p>
</div>
<div class="paragraph">
<p>Application clients directly access enterprise beans running in the business tier.
However, if application requirements warrant it, an application client can open an HTTP connection to establish communication with a servlet running in the web tier.
Application clients written in languages other than Java can interact with Jakarta EE servers, enabling the Jakarta EE platform to interoperate with legacy systems, clients, and non-Java languages.</p>
</div>
</div>
<div class="sect4">
<h5 id="applets"><a class="anchor" href="#applets"></a>Applets</h5>
<div class="paragraph">
<p>A web page received from the web tier can include an embedded applet.
Written in the Java programming language, an applet is a small client application that executes in the Java virtual machine installed in the web browser.
However, client systems will likely need the Java Plug-in and possibly a security policy file for the applet to successfully execute in the web browser.</p>
</div>
<div class="paragraph">
<p>Web components are the preferred API for creating a web client program because no plug-ins or security policy files are needed on the client systems.
Also, web components enable cleaner and more modular application design because they provide a way to separate applications programming from web page design.
Personnel involved in web page design thus do not need to understand Java programming language syntax to do their jobs.</p>
</div>
</div>
<div class="sect4">
<h5 id="the-javabeans-component-architecture"><a class="anchor" href="#the-javabeans-component-architecture"></a>The JavaBeans Component Architecture</h5>
<div class="paragraph">
<p>The server and client tiers might also include components based on the JavaBeans component architecture (JavaBeans components) to manage the data flow between the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An application client or applet and components running on the Jakarta EE server</p>
</li>
<li>
<p>Server components and a database</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>JavaBeans components are not considered Jakarta EE components by the Jakarta EE specification.</p>
</div>
<div class="paragraph">
<p>JavaBeans components have properties and have <code>get</code> and <code>set</code> methods for accessing those properties.
JavaBeans components used in this way are typically simple in design and implementation but should conform to the naming and design conventions outlined in the JavaBeans component architecture.</p>
</div>
</div>
<div class="sect4">
<h5 id="jakarta-ee-server-communications"><a class="anchor" href="#jakarta-ee-server-communications"></a>Jakarta EE Server Communications</h5>
<div class="paragraph">
<p><a href="#server-communication">Figure 1-2</a> shows the various elements that can make up the client tier.
The client communicates with the business tier running on the Jakarta EE server either directly or, as in the case of a client running in a browser, by going through web pages or servlets running in the web tier.</p>
</div>
<div id="server-communication" class="imageblock">
<div class="content">
<img src="images/jakartaeett_dt_002.svg" alt="Diagram of client-server communication. Application clients access the business tier directly. Browsers, web pages, and applets access the web tier.">
</div>
<div class="title">Figure 1-2 Server Communication</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="web-components"><a class="anchor" href="#web-components"></a>Web Components</h4>
<div class="paragraph">
<p>Jakarta EE web components are either servlets or web pages created using Jakarta Faces technology and/or Jakarta Server Pages technology.
Servlets are Java programming language classes that dynamically process requests and construct responses.
Jakarta Server Pages are text-based documents that execute as servlets but allow a more natural approach to creating static content.
Jakarta Faces technology builds on servlets and Jakarta Server Pages technology and provides a user interface component framework for web applications.</p>
</div>
<div class="paragraph">
<p>Static HTML pages and applets are bundled with web components during application assembly but are not considered web components by the Jakarta EE specification.
Server-side utility classes can also be bundled with web components and, like HTML pages, are not considered web components.</p>
</div>
<div class="paragraph">
<p>As shown in <a href="#web-tier-and-jakarta-ee-applications">Figure 1-3</a>, the web tier, like the client tier, might include a JavaBeans component to manage the user input and send that input to enterprise beans running in the business tier for processing.</p>
</div>
<div id="web-tier-and-jakarta-ee-applications" class="imageblock">
<div class="content">
<img src="images/jakartaeett_dt_003.svg" alt="Diagram of client-server communication showing detail of JavaBeans components and web pages in the web tier.">
</div>
<div class="title">Figure 1-3 Web Tier and Jakarta EE Applications</div>
</div>
</div>
<div class="sect3">
<h4 id="business-components"><a class="anchor" href="#business-components"></a>Business Components</h4>
<div class="paragraph">
<p>Business code, which is logic that solves or meets the needs of a particular business domain such as banking, retail, or finance, is handled by enterprise beans running in either the business tier or the web tier.
<a href="#business-and-eis-tiers">Figure 1-4</a> shows how an enterprise bean receives data from client programs, processes it (if necessary), and sends it to the enterprise information system tier for storage.
An enterprise bean also retrieves data from storage, processes it (if necessary), and sends it back to the client program.</p>
</div>
<div id="business-and-eis-tiers" class="imageblock">
<div class="content">
<img src="images/jakartaeett_dt_004.svg" alt="Diagram of client-server communication showing detail of entities, session beans, and message-driven beans in the business tier.">
</div>
<div class="title">Figure 1-4 Business and EIS Tiers</div>
</div>
</div>
<div class="sect3">
<h4 id="enterprise-information-system-tier"><a class="anchor" href="#enterprise-information-system-tier"></a>Enterprise Information System Tier</h4>
<div class="paragraph">
<p>The enterprise information system tier handles EIS software and includes enterprise infrastructure systems, such as enterprise resource planning (ERP), mainframe transaction processing, database systems, and other legacy information systems.
For example, Jakarta EE application components might need access to enterprise information systems for database connectivity.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="jakarta-ee-containers"><a class="anchor" href="#jakarta-ee-containers"></a>Jakarta EE Containers</h3>
<div class="paragraph">
<p>Normally, thin-client multitiered applications are hard to write because they involve many lines of intricate code to handle transaction and state management, multithreading, resource pooling, and other complex low-level details.
The component-based and platform-independent Jakarta EE architecture makes applications easy to write because business logic is organized into reusable components.
In addition, the Jakarta EE server provides underlying services in the form of a container for every component type.
Because you do not have to develop these services yourself, you are free to concentrate on solving the business problem at hand.</p>
</div>
<div class="sect3">
<h4 id="container-services"><a class="anchor" href="#container-services"></a>Container Services</h4>
<div class="paragraph">
<p>Containers are the interface between a component and the low-level, platform-specific functionality that supports the component.
Before it can be executed, a web, enterprise bean, or application client component must be assembled into a Jakarta EE module and deployed into its container.</p>
</div>
<div class="paragraph">
<p>The assembly process involves specifying container settings for each component in the Jakarta EE application and for the Jakarta EE application itself.
Container settings customize the underlying support provided by the Jakarta EE server, including such services as security, transaction management, Java Naming and Directory Interface (JNDI) API lookups, and remote connectivity.
Here are some of the highlights.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The Jakarta EE security model lets you configure a web component or enterprise bean so that system resources are accessed only by authorized users.</p>
</li>
<li>
<p>The Jakarta EE transaction model lets you specify relationships among methods that make up a single transaction so that all methods in one transaction are treated as a single unit.</p>
</li>
<li>
<p>JNDI lookup services provide a unified interface to multiple naming and directory services in the enterprise so that application components can access these services.</p>
</li>
<li>
<p>The Jakarta EE remote connectivity model manages low-level communications between clients and enterprise beans.
After an enterprise bean is created, a client invokes methods on it as if it were in the same virtual machine.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Because the Jakarta EE architecture provides configurable services, components within the same application can behave differently based on where they are deployed.
For example, an enterprise bean can have security settings that allow it a certain level of access to database data in one production environment and another level of database access in another production environment.</p>
</div>
<div class="paragraph">
<p>The container also manages nonconfigurable services, such as enterprise bean and servlet lifecycles, database connection resource pooling, data persistence, and access to the Jakarta EE platform APIs (see <a href="#jakarta-ee-apis">Jakarta EE APIs</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="container-types"><a class="anchor" href="#container-types"></a>Container Types</h4>
<div class="paragraph">
<p>The deployment process installs Jakarta EE application components in the Jakarta EE containers, as illustrated in <a href="#jakarta-ee-server-and-containers">Figure 1-5</a>.</p>
</div>
<div id="jakarta-ee-server-and-containers" class="imageblock">
<div class="content">
<img src="images/jakartaeett_dt_005.svg" alt="Diagram of client-server communication showing servlets and web pages in the web tier and enterprise beans in the business tier.">
</div>
<div class="title">Figure 1-5 Jakarta EE Server and Containers</div>
</div>
<div class="paragraph">
<p>The server and containers are as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Jakarta EE server: The runtime portion of a Jakarta EE product.
A Jakarta EE server provides enterprise and web containers.</p>
</li>
<li>
<p>Jakarta Enterprise Bean container: Manages the execution of enterprise beans for Jakarta EE applications.
Jakarta Enterprise Beans and their container run on the Jakarta EE server.</p>
</li>
<li>
<p>Web container: Manages the execution of web pages, servlets, and some enterprise bean components for Jakarta EE applications.
Web components and their container run on the Jakarta EE server.</p>
</li>
<li>
<p>Application client container: Manages the execution of application client components.
Application clients and their container run on the client.</p>
</li>
<li>
<p>Applet container: Manages the execution of applets.
Consists of a web browser and a Java Plug-in running on the client together.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="web-services-support"><a class="anchor" href="#web-services-support"></a>Web Services Support</h3>
<div class="paragraph">
<p>Web services are web-based enterprise applications that use open, XML-based standards and transport protocols to exchange data with calling clients.
The Jakarta EE platform provides the XML APIs and tools you need to quickly design, develop, test, and deploy web services and clients that fully interoperate with other web services and clients running on Java-based or non-Java-based platforms.</p>
</div>
<div class="paragraph">
<p>To write web services and clients with the Jakarta EE XML APIs, all you need to do is pass parameter data to the method calls and process the data returned; for document-oriented web services, you send documents containing the service data back and forth.
No low-level programming is needed because the XML API implementations do the work of translating the application data to and from an XML-based data stream that is sent over the standardized XML-based transport protocols.
These XML-based standards and protocols are introduced in the following sections.</p>
</div>
<div class="paragraph">
<p>The translation of data to a standardized XML-based data stream is what makes web services and clients written with the Jakarta EE XML APIs fully interoperable.
This does not necessarily mean that the data being transported includes XML tags, because the transported data can itself be plain text, XML data, or any kind of binary data, such as audio, video, maps, program files, computer-aided design (CAD) documents, and the like.
The next section introduces XML and explains how parties doing business can use XML tags and schemas to exchange data in a meaningful way.</p>
</div>
<div class="sect3">
<h4 id="xml"><a class="anchor" href="#xml"></a>XML</h4>
<div class="paragraph">
<p>Extensible Markup Language (XML) is a cross-platform, extensible, text-based standard for representing data.
Parties that exchange XML data can create their own tags to describe the data, set up schemas to specify which tags can be used in a particular kind of XML document, and use XML style sheets to manage the display and handling of the data.</p>
</div>
<div class="paragraph">
<p>For example, a web service can use XML and a schema to produce price lists, and companies that receive the price lists and schema can have their own style sheets to handle the data in a way that best suits their needs. Here are examples.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>One company might put XML pricing information through a program to translate the XML into HTML so that it can post the price lists to its intranet.</p>
</li>
<li>
<p>A partner company might put the XML pricing information through a tool to create a marketing presentation.</p>
</li>
<li>
<p>Another company might read the XML pricing information into an application for processing.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="soap-transport-protocol"><a class="anchor" href="#soap-transport-protocol"></a>SOAP Transport Protocol</h4>
<div class="paragraph">
<p>Client requests and web service responses are transmitted as Simple Object Access Protocol (SOAP) messages over HTTP to enable a completely interoperable exchange between clients and web services, all running on different platforms and at various locations on the Internet.
HTTP is a familiar request-and-response standard for sending messages over the Internet, and SOAP is an XML-based protocol that follows the HTTP request-and-response model.</p>
</div>
<div class="paragraph">
<p>The SOAP portion of a transported message does the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Defines an XML-based envelope to describe what is in the message and explain how to process the message</p>
</li>
<li>
<p>Includes XML-based encoding rules to express instances of application-defined data types within the message</p>
</li>
<li>
<p>Defines an XML-based convention for representing the request to the remote service and the resulting response</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="wsdl-standard-format"><a class="anchor" href="#wsdl-standard-format"></a>WSDL Standard Format</h4>
<div class="paragraph">
<p>The Web Services Description Language (WSDL) is a standardized XML format for describing network services.
The description includes the name of the service, the location of the service, and ways to communicate with the service.
WSDL service descriptions can be published on the Web.
Eclipse GlassFish Server provides a tool for generating the WSDL specification of a web service that uses remote procedure calls to communicate with clients.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="jakarta-ee-application-assembly-and-deployment"><a class="anchor" href="#jakarta-ee-application-assembly-and-deployment"></a>Jakarta EE Application Assembly and Deployment</h3>
<div class="paragraph">
<p>A Jakarta EE application is packaged into one or more standard units for deployment to any Jakarta EE platform-compliant system.
Each unit contains</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A functional component or components, such as an enterprise bean, web page, servlet, or applet</p>
</li>
<li>
<p>An optional deployment descriptor that describes its content</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Once a Jakarta EE unit has been produced, it is ready to be deployed.
Deployment typically involves using a platform&#8217;s deployment tool to specify location-specific information, such as a list of local users who can access it and the name of the local database.
Once deployed on a local platform, the application is ready to run.</p>
</div>
</div>
<div class="sect2">
<h3 id="jakarta-ee-apis"><a class="anchor" href="#jakarta-ee-apis"></a>Jakarta EE APIs</h3>
<div class="paragraph">
<p><a href="#jakarta-ee-containers-2">Figure 1-6</a> shows the relationships among the Jakarta EE
containers.</p>
</div>
<div id="jakarta-ee-containers-2" class="imageblock">
<div class="content">
<img src="images/jakartaeett_dt_006.svg" alt="Diagram of Jakarta EE containers and their relationships">
</div>
<div class="title">Figure 1-6 Jakarta EE Containers</div>
</div>
<div class="paragraph">
<p><a href="#jakarta-ee-apis-in-the-web-container">Figure 1-7</a> shows the availability of the Jakarta EE APIs in the web container.</p>
</div>
<div id="jakarta-ee-apis-in-the-web-container" class="imageblock">
<div class="content">
<img src="images/jakartaeett_dt_007.svg" alt="Diagram of Jakarta EE APIs in the web container">
</div>
<div class="title">Figure 1-7 Jakarta EE APIs in the Web Container</div>
</div>
<div class="paragraph">
<p><a href="#jakarta-ee-apis-in-the-enterprise-bean-container">Figure 1-8</a> shows the availability of the Jakarta EE APIs in the enterprise bean container.</p>
</div>
<div id="jakarta-ee-apis-in-the-enterprise-bean-container" class="imageblock">
<div class="content">
<img src="images/jakartaeett_dt_008.svg" alt="Diagram of Jakarta EE APIs in the enterprise bean container">
</div>
<div class="title">Figure 1-8 Jakarta EE APIs in the enterprise bean Container</div>
</div>
<div class="paragraph">
<p><a href="#jakarta-ee-apis-in-the-application-client-container">Figure 1-9</a> shows the availability of the Jakarta EE APIs in the application client container.</p>
</div>
<div id="jakarta-ee-apis-in-the-application-client-container" class="imageblock">
<div class="content">
<img src="images/jakartaeett_dt_009.svg" alt="Diagram of Jakarta EE APIs in the application client container">
</div>
<div class="title">Figure 1-9 Jakarta EE APIs in the Application Client Container</div>
</div>
<div class="paragraph">
<p>The following sections give a brief summary of the technologies required by the Jakarta EE platform and the APIs used in Jakarta EE applications.</p>
</div>
<div class="sect3">
<h4 id="jakarta-enterprise-beans-technology"><a class="anchor" href="#jakarta-enterprise-beans-technology"></a>Jakarta Enterprise Beans Technology</h4>
<div class="paragraph">
<p>An enterprise bean component, or enterprise bean, is a body of code that has fields and methods to implement modules of business logic.
You can think of an enterprise bean as a building block that can be used alone or with other enterprise beans to execute business logic on the Jakarta EE server.</p>
</div>
<div class="paragraph">
<p>Enterprise beans are either session beans or message-driven beans.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A session bean represents a transient conversation with a client.
When the client finishes executing, the session bean and its data are gone.</p>
</li>
<li>
<p>A message-driven bean combines features of a session bean and a message listener, allowing a business component to receive messages asynchronously.
Commonly, these are Jakarta Messaging messages.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Jakarta EE 9 platform requires Jakarta Enterprise Beans 4.0 and Jakarta Interceptors 2.0.</p>
</div>
</div>
<div class="sect3">
<h4 id="jakarta-servlet-technology"><a class="anchor" href="#jakarta-servlet-technology"></a>Jakarta Servlet Technology</h4>
<div class="paragraph">
<p>Jakarta Servlet technology lets you define HTTP-specific servlet classes.
A servlet class extends the capabilities of servers that host applications accessed by way of a request-response programming model. Although servlets can respond to any type of request, they are commonly used to extend the applications hosted by web servers.</p>
</div>
<div class="paragraph">
<p>In the Jakarta EE 8 platform, new Jakarta Servlet technology features include the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Server Push</p>
</li>
<li>
<p>HTTP Trailer</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Jakarta EE 9 platform requires Servlet 5.0.</p>
</div>
</div>
<div class="sect3">
<h4 id="jakarta-server-faces-technology"><a class="anchor" href="#jakarta-server-faces-technology"></a>Jakarta Server Faces Technology</h4>
<div class="paragraph">
<p>Jakarta Faces technology is a user interface framework for building web applications.
The main components of Jakarta Faces technology are as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A GUI component framework.</p>
</li>
<li>
<p>A flexible model for rendering components in different kinds of HTML or different markup languages and technologies.
A <code>Renderer</code> object generates the markup to render the component and converts the data stored in a model object to types that can be represented in a view.</p>
</li>
<li>
<p>A standard <code>RenderKit</code> for generating HTML 4.01 markup.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following features support the GUI components:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Input validation</p>
</li>
<li>
<p>Event handling</p>
</li>
<li>
<p>Data conversion between model objects and components</p>
</li>
<li>
<p>Managed model object creation</p>
</li>
<li>
<p>Page navigation configuration</p>
</li>
<li>
<p>Jakarta Expression Language</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All this functionality is available using standard Java APIs and XML-based configuration files.</p>
</div>
<div class="paragraph">
<p>In the Jakarta EE 8 platform, new features of Jakarta Faces technology include the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Direct support for WebSockets via the new <code>&lt;f:websocket&gt;</code> tag</p>
</li>
<li>
<p>Class-level bean validation via the new <code>&lt;f:validateWholeBean&gt;</code> tag</p>
</li>
<li>
<p>A Jakarta Contexts and Dependency Injection compatible <code>@ManagedProperty</code> annotation</p>
</li>
<li>
<p>Enhanced component search expression framework</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Jakarta EE 9 platform requires Jakarta Faces 3.0 and Jakarta Expression Language 4.0.</p>
</div>
</div>
<div class="sect3">
<h4 id="jakarta-server-pages-technology"><a class="anchor" href="#jakarta-server-pages-technology"></a>Jakarta Server Pages Technology</h4>
<div class="paragraph">
<p>Jakarta Server Pages technology lets you put snippets of servlet code directly into a text-based document.
A Jakarta Server Pages page is a text-based document that contains two types of text:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Static data, which can be expressed in any text-based format, such as HTML or XML</p>
</li>
<li>
<p>JSP elements, which determine how the page constructs dynamic content</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Jakarta Server Pages technology is derived from and compatible with the JavaServer Pages (JSP) technology.</p>
</div>
<div class="paragraph">
<p>For information about JSP technology, see <em>The Java EE 5 Tutorial</em> at <a href="https://docs.oracle.com/javaee/5/tutorial/doc/" class="bare" target="_blank" rel="noopener">https://docs.oracle.com/javaee/5/tutorial/doc/</a>.</p>
</div>
<div class="paragraph">
<p>The Jakarta EE 9 platform requires Jakarta Server Pages 3.0 for compatibility with earlier releases but recommends the use of Facelets as the display technology in new applications.</p>
</div>
</div>
<div class="sect3">
<h4 id="jakarta-standard-tag-library"><a class="anchor" href="#jakarta-standard-tag-library"></a>Jakarta Standard Tag Library</h4>
<div class="paragraph">
<p>The Jakarta Standard Tag Library encapsulates core functionality common to many Jakarta Server Pages applications.
Instead of mixing tags from numerous vendors in your Jakarta Server Pages applications, you use a single, standard set of tags.
This standardization allows you to deploy your applications on any Jakarta Server Pages container that supports Jakarta Standard Tag Library and makes it more likely that the implementation of the tags is optimized.</p>
</div>
<div class="paragraph">
<p>Jakarta Standard Tag Library has iterator and conditional tags for handling flow control, tags for manipulating XML documents, internationalization tags, tags for accessing databases using SQL, and tags for commonly used functions.</p>
</div>
<div class="paragraph">
<p>The Jakarta EE 9 platform requires Jakarta Standard Tag Library 2.0.</p>
</div>
</div>
<div class="sect3">
<h4 id="jakarta-persistence"><a class="anchor" href="#jakarta-persistence"></a>Jakarta Persistence</h4>
<div class="paragraph">
<p>Jakarta Persistence is a Java standardsbased solution for persistence.
Persistence uses an object/relational mapping approach to bridge the gap between an object-oriented model and a relational database.
The Jakarta Persistence can also be used in Java SE applications outside of the Jakarta EE environment.
Jakarta Persistence consists of the following areas:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The Jakarta Persistence</p>
</li>
<li>
<p>The query language</p>
</li>
<li>
<p>Object/relational mapping metadata</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Jakarta EE 9 platform requires Jakarta Persistence 3.0.</p>
</div>
</div>
<div class="sect3">
<h4 id="jakarta-transactions"><a class="anchor" href="#jakarta-transactions"></a>Jakarta Transactions</h4>
<div class="paragraph">
<p>Jakarta Transactions provides a standard interface for demarcating transactions.
The Jakarta EE architecture provides a default auto commit to handle transaction commits and rollbacks.
An auto commit means that any other applications that are viewing data will see the updated data after each database read or write operation.
However, if your application performs two separate database access operations that depend on each other, you will want to use the Jakarta Transactions to demarcate where the entire transaction, including both operations, begins, rolls back, and commits.</p>
</div>
<div class="paragraph">
<p>The Jakarta EE 9 platform requires Jakarta Transactions 2.0.</p>
</div>
</div>
<div class="sect3">
<h4 id="jakarta-restful-web-services"><a class="anchor" href="#jakarta-restful-web-services"></a>Jakarta RESTful Web Services</h4>
<div class="paragraph">
<p>Jakarta RESTful Web Services defines APIs for the development of web services built according to the Representational State Transfer (REST) architectural style.
A Jakarta RESTful application is a web application that consists of classes packaged as a servlet in a WAR file along with required libraries.</p>
</div>
<div class="paragraph">
<p>In the Jakarta EE 8 platform, new RESTful web services features include the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Reactive Client API<br>
When the results of an invocation on a target resource are received, enhancements to the completion stage APIs in Java SE allow the sequence of those results to be specified, prioritized, combined, or concatenated, and how exceptions can be handled.</p>
</li>
<li>
<p>Enhancements in support for server-sent events<br>
Clients may subscribe to server-issued event notifications using a long-running connection. Support for a new media type, text/event-stream, has been added.</p>
</li>
<li>
<p>Support for Jakarta JSON Binding objects, and improved integration with Jakarta Contexts and Dependency Injection, Jakarta Servlet, and Jakarta Bean Validation technologies</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Jakarta EE 9 platform requires Jakarta RESTful Web Services 3.0.</p>
</div>
</div>
<div class="sect3">
<h4 id="jakarta-managed-beans"><a class="anchor" href="#jakarta-managed-beans"></a>Jakarta Managed Beans</h4>
<div class="paragraph">
<p>Jakarta Managed Beans, lightweight container-managed objects (POJOs) with minimal requirements, support a small set of basic services, such as resource injection, lifecycle callbacks, and interceptors.
Managed Beans represent a generalization of the managed beans specified by Jakarta Faces technology and can be used anywhere in a Jakarta EE application, not just in web modules.</p>
</div>
<div class="paragraph">
<p>The Jakarta Managed Beans specification is part of the Jakarta EE 9 platform specification.
The Jakarta EE 9 platform requires Jakarta Managed Beans 2.0.</p>
</div>
</div>
<div class="sect3">
<h4 id="jakarta-contexts-and-dependency-injection"><a class="anchor" href="#jakarta-contexts-and-dependency-injection"></a>Jakarta Contexts and Dependency Injection</h4>
<div class="paragraph">
<p>Jakarta Contexts and Dependency Injection (CDI) defines a set of contextual services, provided by Jakarta EE containers, that make it easy for developers to use enterprise beans along with Jakarta Faces technology in web applications.
Designed for use with stateful objects, CDI also has many broader uses, allowing developers a great deal of flexibility to integrate different kinds of components in a loosely coupled but typesafe way.</p>
</div>
<div class="paragraph">
<p>In the Jakarta EE 8 platform, new CDI features include the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An API for bootstrapping a CDI container in Java SE 8</p>
</li>
<li>
<p>Support for observer ordering, which determines the order in which the observer methods for a particular event are invoked, and support for firing events asynchronously</p>
</li>
<li>
<p>Configurators interfaces, which are used for dynamically defining and modifying CDI objects</p>
</li>
<li>
<p>Built-in annotation literals, a convenience feature for creating instances of annotations, and more</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Jakarta EE 9 platform requires Jakarta Contexts and Dependency Injection 3.0.</p>
</div>
</div>
<div class="sect3">
<h4 id="jakarta-dependency-injection"><a class="anchor" href="#jakarta-dependency-injection"></a>Jakarta Dependency Injection</h4>
<div class="paragraph">
<p>Jakarta Dependency Injection defines a standard set of annotations (and one interface) for use on injectable classes.</p>
</div>
<div class="paragraph">
<p>In the Jakarta EE platform, CDI provides support for Dependency Injection.
Specifically, you can use injection points only in a CDI-enabled application.</p>
</div>
<div class="paragraph">
<p>The Jakarta EE 9 platform requires Jakarta Dependency Injection 2.0.</p>
</div>
</div>
<div class="sect3">
<h4 id="jakarta-bean-validation"><a class="anchor" href="#jakarta-bean-validation"></a>Jakarta Bean Validation</h4>
<div class="paragraph">
<p>The Jakarta Bean Validation specification defines a metadata model and API for validating data in JavaBeans components.
Instead of distributing validation of data over several layers, such as the browser and the server side, you can define the validation constraints in one place and share them across the different layers.</p>
</div>
<div class="paragraph">
<p>In the Jakarta EE 8 platform, new Jakarta Bean Validation features include the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Support for new features in Java SE 8, such as the Date-Time API</p>
</li>
<li>
<p>Addition of new built-in Jakarta Bean Validation constraints</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Jakarta EE 9 platform requires Jakarta Bean Validation 3.0.</p>
</div>
</div>
<div class="sect3">
<h4 id="jakarta-messaging"><a class="anchor" href="#jakarta-messaging"></a>Jakarta Messaging</h4>
<div class="paragraph">
<p>Jakarta Messaging is a messaging standard that allows Jakarta EE application components to create, send, receive, and read messages.
It enables distributed communication that is loosely coupled, reliable, and asynchronous.</p>
</div>
<div class="paragraph">
<p>The Jakarta EE 9 platform requires Jakarta Messaging 3.0.</p>
</div>
</div>
<div class="sect3">
<h4 id="jakarta-connectors"><a class="anchor" href="#jakarta-connectors"></a>Jakarta Connectors</h4>
<div class="paragraph">
<p>The Jakarta Connectors is used by tools vendors and system integrators to create resource adapters that support access to enterprise information systems that can be plugged in to any Jakarta EE product.
A resource adapter is a software component that allows Jakarta EE application components to access and interact with the underlying resource manager of the EIS.
Because a resource adapter is specific to its resource manager, a different resource adapter typically exists for each type of database or enterprise information system.</p>
</div>
<div class="paragraph">
<p>The Jakarta Connectors also provides a performance-oriented, secure, scalable, and message-based transactional integration of Jakarta EE platform-based web services with existing EISs that can be either synchronous or asynchronous.
Existing applications and EISs integrated through the Jakarta Connectors into the Jakarta EE platform can be exposed as XML-based web services by using Jakarta XML Web Services and Jakarta EE component models.
Thus Jakarta XML Web Services and the Jakarta Connectors are complementary technologies for enterprise application integration (EAI) and end-to-end business integration.</p>
</div>
<div class="paragraph">
<p>The Jakarta EE 9 platform requires Jakarta Connectors 2.0.</p>
</div>
</div>
<div class="sect3">
<h4 id="jakarta-mail"><a class="anchor" href="#jakarta-mail"></a>Jakarta Mail</h4>
<div class="paragraph">
<p>Jakarta EE applications use the Jakarta Mail to send email notifications.
The Jakarta Mail has two parts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An application-level interface used by the application components to send mail</p>
</li>
<li>
<p>A service provider interface</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Jakarta EE platform includes the Jakarta Mail with a service provider that allows application components to send Internet mail.</p>
</div>
<div class="paragraph">
<p>The Jakarta EE 9 platform requires Jakarta Mail 2.0.</p>
</div>
</div>
<div class="sect3">
<h4 id="jakarta-authorization"><a class="anchor" href="#jakarta-authorization"></a>Jakarta Authorization</h4>
<div class="paragraph">
<p>The Jakarta Authorization specification defines a contract between a Jakarta EE application server and an authorization policy provider.
All Jakarta EE containers support this contract.</p>
</div>
<div class="paragraph">
<p>The Jakarta Authorization specification defines <code>java.security.Permission</code> classes that satisfy the Jakarta EE authorization model.
The specification defines the binding of container-access decisions to operations on instances of these permission classes.
It defines the semantics of policy providers that use the new permission classes to address the authorization requirements of the Jakarta EE platform, including the definition and use of roles.</p>
</div>
<div class="paragraph">
<p>The Jakarta EE 9 platform requires Jakarta Authorization 2.0.</p>
</div>
</div>
<div class="sect3">
<h4 id="jakarta-authentication"><a class="anchor" href="#jakarta-authentication"></a>Jakarta Authentication</h4>
<div class="paragraph">
<p>The Jakarta Authentication specification defines a service provider interface (SPI) by which authentication providers that implement message authentication mechanisms may be integrated in client or server message-processing containers or runtimes.
Authentication providers integrated through this interface operate on network messages provided to them by their calling containers.
The authentication providers transform outgoing messages so that the source of each message can be authenticated by the receiving container, and the recipient of the message can be authenticated by the message sender.
Authentication providers authenticate each incoming message and return to their calling containers the identity established as a result of the message authentication.</p>
</div>
<div class="paragraph">
<p>The Jakarta EE 9 platform requires Jakarta Authentication 2.0.</p>
</div>
</div>
<div class="sect3">
<h4 id="jakarta-security"><a class="anchor" href="#jakarta-security"></a>Jakarta Security</h4>
<div class="paragraph">
<p>Jakarta Security specification defines portable, plug-in interfaces for HTTP authentication and identity stores, and an injectable <code>SecurityContext</code> interface that provides an API for programmatic security.</p>
</div>
<div class="paragraph">
<p>Implementations of the <code>HttpAuthenticationMechanism</code> interface can be used to authenticate callers of web applications.
An application can supply its own <code>HttpAuthenticationMechanism</code>, or use one of the default implementations provided by the container.</p>
</div>
<div class="paragraph">
<p>Implementations of the <code>IdentityStore</code> interface can be used to validate user credentials and retrieve group information.
An application can provide its own <code>IdentityStore</code>, or use the built in LDAP or Database store.</p>
</div>
<div class="paragraph">
<p>The <code>HttpAuthenticationMechanism</code> and <code>IdentityStore</code> APIs provide an advantage over container-provided implementations in that they allow an application to control the authentication process, and the identity stores used for authentication, in a standard, portable way.</p>
</div>
<div class="paragraph">
<p>The <code>SecurityContext</code> API is intended for use by application code to query and interact with the current security context.
The specification also provides for default group-to-role mapping, and defines a principal type called <code>CallerPrincipal</code> that can represent the identity of an application caller.</p>
</div>
<div class="paragraph">
<p>The Jakarta EE 9 platform requires Jakarta Security 2.0.</p>
</div>
</div>
<div class="sect3">
<h4 id="jakarta-websocket"><a class="anchor" href="#jakarta-websocket"></a>Jakarta WebSocket</h4>
<div class="paragraph">
<p>WebSocket is an application protocol that provides full-duplex communications between two peers over TCP.
Jakarta WebSocket enables Jakarta EE applications to create endpoints using annotations that specify the configuration parameters of the endpoint and designate its lifecycle callback methods.</p>
</div>
<div class="paragraph">
<p>The Jakarta EE 9 platform requires Jakarta WebSocket 2.0.</p>
</div>
</div>
<div class="sect3">
<h4 id="jakarta-json-processing"><a class="anchor" href="#jakarta-json-processing"></a>Jakarta JSON Processing</h4>
<div class="paragraph">
<p>JavaScript Object Notation (JSON) is a text-based data exchange format derived from JavaScript that is used in web services and other connected applications.
Jakarta JSON Processing enables Jakarta EE applications to parse, transform, and query JSON data using the object model or the streaming model.</p>
</div>
<div class="paragraph">
<p>In the Jakarta EE 8 platform, new features of Jakarta JSON Processing include support for the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>JSON Pointer<br>
Defines a string syntax for referencing a specific value within a JSON document. JSON Pointer includes APIs for extracting values from a target document and transforming them to create a new JSON document.</p>
</li>
<li>
<p>JSON Patch<br>
Defines a format for expressing a sequence of operations to be applied to a JSON document.</p>
</li>
<li>
<p>JSON Merge Patch<br>
Defines a format and processing rules for applying operations to a JSON document that are based upon specific content of the target document.</p>
</li>
<li>
<p>The addition of editing and transformation functions to basic JSON document processing.</p>
</li>
<li>
<p>Helper classes and methods, called JSON Collectors, which leverage features of the Stream API that was introduced in Java SE 8.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Jakarta EE 9 platform requires Jakarta JSON Processing 2.0.</p>
</div>
</div>
<div class="sect3">
<h4 id="jakarta-json-binding"><a class="anchor" href="#jakarta-json-binding"></a>Jakarta JSON Binding</h4>
<div class="paragraph">
<p>Jakarta JSON Binding provides a binding layer for converting Java objects to and from JSON messages.
Jakarta JSON Binding also supports the ability to customize the default mapping process used in this binding layer through the use of Java annotations for a given field, JavaBean property, type or package, or by providing an implementation of a property naming strategy.</p>
</div>
<div class="paragraph">
<p>The Jakarta EE 9 platform requires Jakarta JSON Binding 2.0.</p>
</div>
</div>
<div class="sect3">
<h4 id="jakarta-concurrency"><a class="anchor" href="#jakarta-concurrency"></a>Jakarta Concurrency</h4>
<div class="paragraph">
<p>Jakarta Concurrency is a standard API for providing asynchronous capabilities to Jakarta EE application components through the following types of objects: managed executor service, managed scheduled executor service, managed thread factory, and context service.</p>
</div>
<div class="paragraph">
<p>The Jakarta EE 9 platform requires Jakarta Concurrency 2.0.</p>
</div>
</div>
<div class="sect3">
<h4 id="jakarta-batch"><a class="anchor" href="#jakarta-batch"></a>Jakarta Batch</h4>
<div class="paragraph">
<p>Batch jobs are tasks that can be executed without user interaction.
The Batch Applications for the Java Platform specification is a batch framework that provides support for creating and running batch jobs in Java applications.
The batch framework consists of a batch runtime, a job specification language based on XML, a Java API to interact with the batch runtime, and a Java API to implement batch artifacts.</p>
</div>
<div class="paragraph">
<p>The Jakarta EE 9 platform requires Jakarta Batch 2.0.</p>
</div>
</div>
<div class="sect3">
<h4 id="jakarta-activation"><a class="anchor" href="#jakarta-activation"></a>Jakarta Activation</h4>
<div class="paragraph">
<p>The Jakarta Activation is used by the Jakarta Mail.
Jakarta Activation provides standard services to determine the type of an arbitrary piece of data, encapsulate access to it, discover the operations available on it, and create the appropriate JavaBeans component to perform those operations.</p>
</div>
<div class="paragraph">
<p>The Jakarta EE 9 platform requires Jakarta Activation 2.0.</p>
</div>
</div>
<div class="sect3">
<h4 id="jakarta-xml-binding"><a class="anchor" href="#jakarta-xml-binding"></a>Jakarta XML Binding</h4>
<div class="paragraph">
<p>The Jakarta XML Binding provides a convenient way to bind an XML schema to a representation in Java language programs.
XML Binding can be used independently or in combination with Jakarta XML Web Services, in which case it provides a standard data binding for web service messages.
All Jakarta EE application client containers, web containers, and Jakarta Enterprise Beans containers support the XML Binding API.</p>
</div>
<div class="paragraph">
<p>The Jakarta EE 9 platform requires Jakarta XML Binding 3.0.</p>
</div>
</div>
<div class="sect3">
<h4 id="jakarta-xml-web-services"><a class="anchor" href="#jakarta-xml-web-services"></a>Jakarta XML Web Services</h4>
<div class="paragraph">
<p>The Jakarta XML Web Services specification provides support for web services that use the Jakarta XML Binding API for binding XML data to Java objects.
The Jakarta XML Web Services specification defines client APIs for accessing web services as well as techniques for implementing web service endpoints.
The Enterprise Web Services specification describes the deployment of Jakarta XML Web Services based services and clients.
The Jakarta Enterprise Beans and Jakarta Servlet specifications also describe aspects of such deployment.
Jakarta XML Web Services based applications can be deployed using any of these deployment models.</p>
</div>
<div class="paragraph">
<p>The Jakarta XML Web Services specification describes the support for message handlers that can process message requests and responses.
In general, these message handlers execute in the same container and with the same privileges and execution context as the Jakarta XML Web Services client or endpoint component with which they are associated.
These message handlers have access to the same JNDI namespace as their associated component.
Custom serializers and deserializers, if supported, are treated in the same way as message handlers.</p>
</div>
<div class="paragraph">
<p>The Jakarta EE 9 platform requires Jakarta XML Web Services 3.0.</p>
</div>
</div>
<div class="sect3">
<h4 id="jakarta-soap-with-attachments"><a class="anchor" href="#jakarta-soap-with-attachments"></a>Jakarta SOAP with Attachments</h4>
<div class="paragraph">
<p>The Jakarta SOAP with Attachments is a low-level API on which Jakarta XML Web Services depends.
Jakarta SOAP with Attachments enables the production and consumption of messages that conform to the SOAP 1.1 and 1.2 specifications and the Jakarta SOAP with Attachments note.
Most developers do not use the Jakarta SOAP with Attachments, instead using the higher-level Jakarta XML Web Services API.</p>
</div>
</div>
<div class="sect3">
<h4 id="jakarta-annotations"><a class="anchor" href="#jakarta-annotations"></a>Jakarta Annotations</h4>
<div class="paragraph">
<p>Annotations enable a declarative style of programming in the Java platform.</p>
</div>
<div class="paragraph">
<p>The Jakarta EE 9 platform requires Jakarta Annotations 2.0.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="jakarta-ee-9-apis-in-the-java-platform-standard-edition-8"><a class="anchor" href="#jakarta-ee-9-apis-in-the-java-platform-standard-edition-8"></a>Jakarta EE 9 APIs in the Java Platform, Standard Edition 8</h3>
<div class="paragraph">
<p>Several APIs that are required by the Jakarta EE 9 platform are included in the Java Platform, Standard Edition 8 (Java SE 8) and are thus available to Jakarta EE applications.</p>
</div>
<div class="sect3">
<h4 id="java-database-connectivity-api"><a class="anchor" href="#java-database-connectivity-api"></a>Java Database Connectivity API</h4>
<div class="paragraph">
<p>The Java Database Connectivity (JDBC) API lets you invoke SQL commands from Java programming language methods.
You use the JDBC API in an enterprise bean when you have a session bean access the database.
You can also use the JDBC API from a servlet or a JSP page to access the database directly without going through an enterprise bean.</p>
</div>
<div class="paragraph">
<p>The JDBC API has two parts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An application-level interface used by the application components to access a database</p>
</li>
<li>
<p>A service provider interface to attach a JDBC driver to the Jakarta EE platform</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Jakarta EE 9 platform requires JDBC 4.1.</p>
</div>
</div>
<div class="sect3">
<h4 id="java-naming-and-directory-interface-api"><a class="anchor" href="#java-naming-and-directory-interface-api"></a>Java Naming and Directory Interface API</h4>
<div class="paragraph">
<p>The Java Naming and Directory Interface (JNDI) API provides naming and directory functionality, enabling applications to access multiple naming and directory services, such as LDAP, DNS, and NIS.
The JNDI API provides applications with methods for performing standard directory operations, such as associating attributes with objects and searching for objects using their attributes.
Using JNDI, a Jakarta EE application can store and retrieve any type of named Java object, allowing Jakarta EE applications to coexist with many legacy applications and systems.</p>
</div>
<div class="paragraph">
<p>Jakarta EE naming services provide application clients, enterprise beans, and web components with access to a JNDI naming environment.
A naming environment allows a component to be customized without the need to access or change the component&#8217;s source code.
A container implements the component&#8217;s environment and provides it to the component as a JNDI naming context.</p>
</div>
<div class="paragraph">
<p>The naming environment provides four logical namespaces: <code>java:comp</code>, <code>java:module</code>, <code>java:app</code>, and <code>java:global</code> for objects available to components, modules, or applications or shared by all deployed applications.
A Jakarta EE component can access named system-provided and user-defined objects. The names of some system-provided objects, such as a default JDBC <code>DataSource</code> object, a default Messaging connection factory, and a Transactions <code>UserTransaction</code> object, are stored in the <code>java:comp</code> namespace.
The Jakarta EE platform allows a component to name user-defined objects, such as enterprise beans, environment entries, JDBC <code>DataSource</code> objects, and messaging destinations.</p>
</div>
<div class="paragraph">
<p>A Jakarta EE component can also locate its environment naming context by using JNDI interfaces.
A component can create a <code>javax.naming.InitialContext</code> object and look up the environment naming context in <code>InitialContext</code> under the name <code>java:comp/env</code>.
A component&#8217;s naming environment is stored directly in the environment naming context or in any of its direct or indirect subcontexts.</p>
</div>
</div>
<div class="sect3">
<h4 id="java-api-for-xml-processing"><a class="anchor" href="#java-api-for-xml-processing"></a>Java API for XML Processing</h4>
<div class="paragraph">
<p>The Java API for XML Processing (JAXP), part of the Java SE platform, supports the processing of XML documents using Document Object Model (DOM), Simple API for XML (SAX), and Extensible Stylesheet Language Transformations (XSLT).
JAXP enables applications to parse and transform XML documents independently of a particular XML-processing implementation.</p>
</div>
<div class="paragraph">
<p>JAXP also provides namespace support, which lets you work with schemas that might otherwise have naming conflicts.
Designed to be flexible, JAXP lets you use any XML-compliant parser or XSL processor from within your application and supports the Worldwide Web Consortium (W3C) schema.
You can find information on the W3C schema at <a href="https://www.w3.org/XML/Schema" class="bare" target="_blank" rel="noopener">https://www.w3.org/XML/Schema</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="java-authentication-and-authorization-service"><a class="anchor" href="#java-authentication-and-authorization-service"></a>Java Authentication and Authorization Service</h4>
<div class="paragraph">
<p>The Java Authentication and Authorization Service (JAAS) provides a way for a Jakarta EE application to authenticate and authorize a specific user or group of users to run it.</p>
</div>
<div class="paragraph">
<p>JAAS is a Java programming language version of the standard Pluggable Authentication Module (PAM) framework, which extends the Java platform security architecture to support user-based authorization.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="eclipse-glassfish-server-tools"><a class="anchor" href="#eclipse-glassfish-server-tools"></a>Eclipse GlassFish Server Tools</h3>
<div class="paragraph">
<p>Eclipse GlassFish Server is a compliant implementation of the Jakarta EE platform.
In addition to supporting all the APIs described in the previous sections, Eclipse GlassFish Server includes a number of Jakarta EE tools that are not part of the Jakarta EE platform but are provided as a convenience to the developer.</p>
</div>
<div class="paragraph">
<p>This section briefly summarizes the tools that make up Eclipse GlassFish Server.
Instructions for starting and stopping Eclipse GlassFish Server, starting the Administration Console, and starting and stopping Apache Derby are in <a href="#using-the-tutorial-examples">Chapter 2, <em>Using the Tutorial Examples</em></a>.</p>
</div>
<div class="paragraph">
<p>Eclipse GlassFish Server contains the tools listed in <a href="#glassfish-server-tools">Table 1-1</a>.
Basic usage information for many of the tools appears throughout the tutorial.
For detailed information, see the online help in the GUI tools.</p>
</div>
<table id="glassfish-server-tools" class="tableblock frame-all grid-all" style="width: 85%;">
<caption class="title">Table 1-1 Eclipse GlassFish Server Tools</caption>
<colgroup>
<col style="width: 23.5294%;">
<col style="width: 76.4706%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Tool</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Administration Console</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A web-based GUI Eclipse GlassFish Server administration utility.
Used to stop Eclipse GlassFish Server and to manage users, resources, and applications.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>asadmin</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A command-line Eclipse GlassFish Server administration utility.
Used to start and stop Eclipse GlassFish Server and to manage users, resources, and applications.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>appclient</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A command-line tool that launches the application client container and invokes the client application packaged in the application client JAR file.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>capture-schema</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A command-line tool to extract schema information from a database, producing a schema file that Eclipse GlassFish Server can use for container-managed persistence.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>package-appclient</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A command-line tool to package the application client container libraries and JAR files.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apache Derby</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A copy of Apache Derby database.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xjc</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A command-line tool to transform, or bind, a source XML schema to a set of JAXB content classes in the Java programming language.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>schemagen</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A command-line tool to create a schema file for each namespace referenced in your Java classes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>wsimport</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A command-line tool to generate Jakarta XML Web Services portable artifacts for a given WSDL file.
After generation, these artifacts can be packaged in a WAR file with the WSDL and schema documents, along with the endpoint implementation, and then deployed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>wsgen</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A command-line tool to read a web service endpoint class and generate all the required Jakarta XML Web Services portable artifacts for web service deployment and invocation.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using-the-tutorial-examples"><a class="anchor" href="#using-the-tutorial-examples"></a>Chapter 2. Using the Tutorial Examples</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter tells you everything you need to know to install, build, and run the tutorial examples.</p>
</div>
<div class="paragraph">
<p>For additional samples, see the GlassFish samples at <a href="https://github.com/eclipse-ee4j/glassfish-samples/tree/master/ws/jakartaee9" class="bare">https://github.com/eclipse-ee4j/glassfish-samples/tree/master/ws/jakartaee9</a></p>
</div>
<div class="sect2">
<h3 id="required-software"><a class="anchor" href="#required-software"></a>Required Software</h3>
<div class="paragraph">
<p>The following software is required to run the examples:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#java-platform-standard-edition">Java Platform, Standard Edition</a></p>
</li>
<li>
<p><a href="#eclipse-glassfish-server">Eclipse Glassfish Server</a></p>
</li>
<li>
<p><a href="#jakarta-ee-tutorial-examples">Jakarta EE Tutorial Examples</a></p>
</li>
<li>
<p><a href="#apache-netbeans-ide">Apache NetBeans IDE</a></p>
</li>
<li>
<p><a href="#apache-maven">Apache Maven</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="java-platform-standard-edition"><a class="anchor" href="#java-platform-standard-edition"></a>Java Platform, Standard Edition</h4>
<div class="paragraph">
<p>To build, deploy, and run the examples, you need a copy of the Java Platform, Standard Edition Development Kit (JDK).
You must use JDK 8 Update 20 or above.
You can download JDK software from <a href="https://www.oracle.com/technetwork/java/javase/downloads/index.html" class="bare" target="_blank" rel="noopener">https://www.oracle.com/technetwork/java/javase/downloads/index.html</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="eclipse-glassfish-server"><a class="anchor" href="#eclipse-glassfish-server"></a>Eclipse Glassfish Server</h4>
<div class="paragraph">
<p>GlassFish Server 6.0 is targeted as the build and runtime environment for the tutorial examples.
To build, deploy, and run the examples, you need a copy of GlassFish Server and, optionally, NetBeans IDE.
You can download GlassFish Server from <a href="https://glassfish.org/download" class="bare" target="_blank" rel="noopener">https://glassfish.org/download</a>.</p>
</div>
<div class="sect4">
<h5 id="glassfish-server-installation-tips"><a class="anchor" href="#glassfish-server-installation-tips"></a>GlassFish Server Installation Tips</h5>
<div class="paragraph">
<p>GlassFish Server is installed from a ZIP file.
It sets the default administration user name as <code>admin</code> with no required password.
The Admin Port is set to 4848, and the HTTP Port is set to 8080.</p>
</div>
<div class="paragraph">
<p>This tutorial refers to <code><em>as-install-parent</em></code>, the directory where you install GlassFish Server.
For example, the default installation directory on Microsoft Windows is <code>C:\glassfish6</code>, so <code><em>as-install-parent</em></code> is <code>C:\glassfish6</code>.
GlassFish Server itself is installed in <code><em>as-install</em></code>, the <code>glassfish</code> directory under <code><em>as-install-parent</em></code>.
So on Microsoft Windows, <code><em>as-install</em></code> is <code>C:\glassfish6\glassfish</code>.</p>
</div>
<div class="paragraph">
<p>After you install GlassFish Server, add the following directories to your <code>PATH</code> to avoid having to specify the full path when you use commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>as-install-parent/bin
as-install/bin</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="jakarta-ee-tutorial-examples"><a class="anchor" href="#jakarta-ee-tutorial-examples"></a>Jakarta EE Tutorial Examples</h4>
<div class="paragraph">
<p>The tutorial example codes are located at <a href="https://github.com/eclipse-ee4j/jakartaee-tutorial-examples" class="bare">https://github.com/eclipse-ee4j/jakartaee-tutorial-examples</a>.</p>
</div>
<div class="paragraph">
<p>Download the examples and extract it to the following location:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="apache-netbeans-ide"><a class="anchor" href="#apache-netbeans-ide"></a>Apache NetBeans IDE</h4>
<div class="paragraph">
<p>The NetBeans integrated development environment (IDE) is a free, open-source IDE for developing Java applications, including enterprise applications.
NetBeans IDE supports the Jakarta EE platform.
You can build, package, deploy, and run the tutorial examples from within NetBeans IDE.</p>
</div>
<div class="paragraph">
<p>To run the tutorial examples, you need the latest version of NetBeans IDE.
You can download NetBeans IDE from <a href="https://netbeans.apache.org/download/index.html" class="bare" target="_blank" rel="noopener">https://netbeans.apache.org/download/index.html</a>.</p>
</div>
<div class="sect4">
<h5 id="to-add-glassfish-server-as-a-server-using-netbeans-ide"><a class="anchor" href="#to-add-glassfish-server-as-a-server-using-netbeans-ide"></a>To Add GlassFish Server as a Server Using NetBeans IDE</h5>
<div class="paragraph">
<p>To run the tutorial examples in NetBeans IDE, you must add your GlassFish Server as a server in NetBeans IDE.
Follow these instructions to add GlassFish Server to NetBeans IDE.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>From the <strong>Tools</strong> menu, choose <strong>Servers</strong>.</p>
</li>
<li>
<p>In the Servers wizard, click <strong>Add Server</strong>.</p>
</li>
<li>
<p>Under Choose Server, select <strong>GlassFish Server</strong> and click <strong>Next</strong>.</p>
</li>
<li>
<p>Under Server Location, browse to the GlassFish Server installation and click <strong>Next</strong>.</p>
</li>
<li>
<p>Under Domain Location, select <strong>Register Local Domain</strong>.</p>
</li>
<li>
<p>Click <strong>Finish</strong>.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="apache-maven"><a class="anchor" href="#apache-maven"></a>Apache Maven</h4>
<div class="paragraph">
<p>Maven is a Java technology-based build tool developed by the Apache Software Foundation and is used to build, package, and deploy the tutorial examples.
To run the tutorial examples from the command line, you need Maven 3.0 or higher. If you do not already have Maven, you can install it from:</p>
</div>
<div class="paragraph">
<p><a href="https://maven.apache.org" class="bare" target="_blank" rel="noopener">https://maven.apache.org</a></p>
</div>
<div class="paragraph">
<p>Be sure to add the <code>maven-install/bin</code> directory to your path.</p>
</div>
<div class="paragraph">
<p>If you are using NetBeans IDE to build and run the examples, it includes a copy of Maven.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="starting-and-stopping-glassfish-server"><a class="anchor" href="#starting-and-stopping-glassfish-server"></a>Starting and Stopping GlassFish Server</h3>
<div class="paragraph">
<p>You can start and stop GlassFish Server using either NetBeans IDE or the command line.</p>
</div>
<div class="sect3">
<h4 id="to-start-glassfish-server-using-netbeans-ide"><a class="anchor" href="#to-start-glassfish-server-using-netbeans-ide"></a>To Start GlassFish Server Using NetBeans IDE</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click the <strong>Services</strong> tab.</p>
</li>
<li>
<p>Expand <strong>Servers</strong>.</p>
</li>
<li>
<p>Right-click the <strong>GlassFish Server instance</strong> and select <strong>Start</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="to-stop-glassfish-server-using-netbeans-ide"><a class="anchor" href="#to-stop-glassfish-server-using-netbeans-ide"></a>To Stop GlassFish Server Using NetBeans IDE</h4>
<div class="paragraph">
<p>To stop GlassFish Server using NetBeans IDE, right-click the <strong>GlassFish Server instance</strong> and select <strong>Stop</strong>.</p>
</div>
</div>
<div class="sect3">
<h4 id="to-start-glassfish-server-using-the-command-line"><a class="anchor" href="#to-start-glassfish-server-using-the-command-line"></a>To Start GlassFish Server Using the Command Line</h4>
<div class="paragraph">
<p>To start GlassFish Server from the command line, open a terminal window or command prompt and execute the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">asadmin start-domain --verbose</code></pre>
</div>
</div>
<div class="paragraph">
<p>A domain is a set of one or more GlassFish Server instances managed by one administration server.
The following elements are associated with a domain:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The GlassFish Server port number: The default is 8080.</p>
</li>
<li>
<p>The administration server&#8217;s port number: The default is 4848.</p>
</li>
<li>
<p>An administration user name and password: The default user name is <code>admin</code>, and by default no password is required.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You specify these values when you install GlassFish Server.
The examples in this tutorial assume that you chose the default ports as well as the default user name and lack of password.</p>
</div>
<div class="paragraph">
<p>With no arguments, the <code>start-domain</code> command initiates the default domain, which is <code>domain1</code>.
The <code>--verbose</code> flag causes all logging and debugging output to appear on the terminal window or command prompt.
The output also goes into the server log, which is located in <code><em>domain-dir</em>/logs/server.log</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="to-stop-glassfish-server-using-the-command-line"><a class="anchor" href="#to-stop-glassfish-server-using-the-command-line"></a>To Stop GlassFish Server Using the Command Line</h4>
<div class="paragraph">
<p>To stop GlassFish Server, open a terminal window or command prompt and execute:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">asadmin stop-domain domain1</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="starting-the-administration-console"><a class="anchor" href="#starting-the-administration-console"></a>Starting the Administration Console</h3>
<div class="paragraph">
<p>To administer GlassFish Server and manage users, resources, and Jakarta EE applications, use the Administration Console tool.
GlassFish Server must be running before you invoke the Administration Console.
To start the Administration Console, open a browser at <a href="http://localhost:4848/" class="bare" target="_blank" rel="noopener">http://localhost:4848/</a>.</p>
</div>
<div class="sect3">
<h4 id="to-start-the-administration-console-using-netbeans-ide"><a class="anchor" href="#to-start-the-administration-console-using-netbeans-ide"></a>To Start the Administration Console Using NetBeans IDE</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click the <strong>Services</strong> tab.</p>
</li>
<li>
<p>Expand <strong>Servers</strong>.</p>
</li>
<li>
<p>Right-click the <strong>GlassFish Server instance</strong> and select <strong>View Domain Admin Console</strong>.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
NetBeans IDE uses your default web browser to open the Administration Console.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="starting-and-stopping-apache-derby"><a class="anchor" href="#starting-and-stopping-apache-derby"></a>Starting and Stopping Apache Derby</h3>
<div class="paragraph">
<p>GlassFish Server includes Apache Derby.</p>
</div>
<div class="sect3">
<h4 id="to-start-derby-using-command-line"><a class="anchor" href="#to-start-derby-using-command-line"></a>To Start Derby Using Command Line</h4>
<div class="paragraph">
<p>To start Derby from the command line, open a terminal window or command prompt, change to the <code><em>as-install</em>/bin</code> directory, and execute:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">asadmin start-database</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="to-stop-derby-using-command-line"><a class="anchor" href="#to-stop-derby-using-command-line"></a>To Stop Derby Using Command Line</h4>
<div class="paragraph">
<p>To stop Derby from the command line, open a terminal window or command prompt, change to the <code><em>as-install</em>/bin</code> directory, and execute:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">asadmin stop-database</code></pre>
</div>
</div>
<div class="paragraph">
<p>For information about Apache Derby included with GlassFish Server, see the Release Notes that are located in the <code><em>as-install</em>/javadb/</code> directory.</p>
</div>
</div>
<div class="sect3">
<h4 id="to-start-derby-using-netbeans-ide"><a class="anchor" href="#to-start-derby-using-netbeans-ide"></a>To Start Derby Using NetBeans IDE</h4>
<div class="paragraph">
<p>When you start GlassFish Server using NetBeans IDE, the database server starts automatically.
If you ever need to start the server manually, however, follow these steps.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click the <strong>Services</strong> tab.</p>
</li>
<li>
<p>Expand <strong>Databases</strong>.</p>
</li>
<li>
<p>Right-click <strong>Java DB</strong> and select <strong>Start Server</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="to-stop-derby-using-netbeans-ide"><a class="anchor" href="#to-stop-derby-using-netbeans-ide"></a>To Stop Derby Using NetBeans IDE</h4>
<div class="paragraph">
<p>To stop the database using NetBeans IDE, right-click <strong>Java DB</strong> and select <strong>Stop Server</strong>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="building-the-examples"><a class="anchor" href="#building-the-examples"></a>Building the Examples</h3>
<div class="paragraph">
<p>The tutorial examples are distributed with a configuration file for either NetBeans IDE or Maven.
Either NetBeans IDE or Maven may be used to build, package, deploy, and run the examples.
Directions for building the examples are provided in each chapter.</p>
</div>
</div>
<div class="sect2">
<h3 id="tutorial-example-directory-structure"><a class="anchor" href="#tutorial-example-directory-structure"></a>Tutorial Example Directory Structure</h3>
<div class="paragraph">
<p>To facilitate iterative development and keep application source files separate from compiled files, the tutorial examples use the Maven application directory structure.</p>
</div>
<div class="paragraph">
<p>Each application module has the following structure:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>pom.xml</code>: Maven build file</p>
</li>
<li>
<p><code>src/main/java</code>: Java source files for the module</p>
</li>
<li>
<p><code>src/main/resources</code>: configuration files for the module, with the exception of web applications</p>
</li>
<li>
<p><code>src/main/webapp</code>: web pages, style sheets, tag files, and images (web applications only)</p>
</li>
<li>
<p><code>src/main/webapp/WEB-INF</code>: configuration files for web applications (web applications only)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When an example has multiple application modules packaged into an EAR file, its submodule directories use the following naming conventions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>example-name</em><code>-app-client</code>: application clients</p>
</li>
<li>
<p><em>example-name</em><code>-ejb</code>: enterprise bean JAR files</p>
</li>
<li>
<p><em>example-name</em><code>-war</code>: web applications</p>
</li>
<li>
<p><em>example-name</em><code>-ear</code>: enterprise applications</p>
</li>
<li>
<p><em>example-name</em><code>-common</code>: library JAR containing components, classes, and files used by other modules</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Maven build files (<code>pom.xml</code>) distributed with the examples contain goals to compile and assemble the application into the <code>target</code> directory and deploy the archive to GlassFish Server.</p>
</div>
</div>
<div class="sect2">
<h3 id="jakarta-ee-maven-archetypes-in-the-tutorial"><a class="anchor" href="#jakarta-ee-maven-archetypes-in-the-tutorial"></a>Jakarta EE Maven Archetypes in the Tutorial</h3>
<div class="paragraph">
<p>Some of the chapters have instructions on how to build an example application using Maven archetypes.
Archetypes are templates for generating a particular Maven project.
The Tutorial includes several Maven archetypes for generating Jakarta EE projects.</p>
</div>
<div class="sect3">
<h4 id="installing-the-tutorial-archetypes"><a class="anchor" href="#installing-the-tutorial-archetypes"></a>Installing the Tutorial Archetypes</h4>
<div class="paragraph">
<p>You must install the included Maven archetypes into your local Maven repository before you can create new projects based on the archetypes.
You can install the archetypes using NetBeans IDE or Maven.</p>
</div>
<div class="sect4">
<h5 id="installing-the-tutorial-archetypes-using-netbeans-ide"><a class="anchor" href="#installing-the-tutorial-archetypes-using-netbeans-ide"></a>Installing the Tutorial Archetypes Using NetBeans IDE</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>From the <strong>File</strong> menu, choose <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the Open Project dialog box, navigate to:<br></p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples</pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Select the <code>archetypes</code> folder.</p>
</li>
<li>
<p>Click <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the <strong>Projects</strong> tab, right-click the <code>archetypes</code> project and select <strong>Build</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="installing-the-tutorial-archetypes-using-maven"><a class="anchor" href="#installing-the-tutorial-archetypes-using-maven"></a>Installing the Tutorial Archetypes Using Maven</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In a terminal window, go to:<br></p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/archetypes/</pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Enter the following command:<br></p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>mvn install</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="debugging-jakarta-ee-applications"><a class="anchor" href="#debugging-jakarta-ee-applications"></a>Debugging Jakarta EE Applications</h3>
<div class="paragraph">
<p>This section explains how to determine what is causing an error in your application deployment or execution.</p>
</div>
<div class="sect3">
<h4 id="using-the-server-log"><a class="anchor" href="#using-the-server-log"></a>Using the Server Log</h4>
<div class="paragraph">
<p>One way to debug applications is to look at the server log in <code><em>domain-dir</em>/logs/server.log</code>.
The log contains output from GlassFish Server and your applications.
You can log messages from any Java class in your application with <code>System.out.println</code> and the Java Logging APIs (documented at <a href="https://docs.oracle.com/javase/8/docs/technotes/guides/logging/index.html" class="bare" target="_blank" rel="noopener">https://docs.oracle.com/javase/8/docs/technotes/guides/logging/index.html</a>) and from web components with the <code>ServletContext.log</code> method.</p>
</div>
<div class="paragraph">
<p>If you use NetBeans IDE, logging output appears in the Output window as well as the server log.</p>
</div>
<div class="paragraph">
<p>If you start GlassFish Server with the <code>--verbose</code> flag, all logging and debugging output will appear on the terminal window or command prompt and the server log.
If you start GlassFish Server in the background, debugging information is available only in the log.
You can view the server log with a text editor or with the Administration Console log viewer.</p>
</div>
<div class="sect4">
<h5 id="to-use-the-administration-console-log-viewer"><a class="anchor" href="#to-use-the-administration-console-log-viewer"></a>To Use the Administration Console Log Viewer</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Select the <strong>GlassFish Server</strong> node.</p>
</li>
<li>
<p>Click <strong>View Log Files</strong>.<br>
The log viewer opens and displays the last 40 entries.</p>
</li>
<li>
<p>To display other entries, follow these steps:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Click <strong>Modify Search</strong>.</p>
</li>
<li>
<p>Specify any constraints on the entries you want to see.</p>
</li>
<li>
<p>Click Search at the top of the log viewer.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="using-a-debugger"><a class="anchor" href="#using-a-debugger"></a>Using a Debugger</h4>
<div class="paragraph">
<p>GlassFish Server supports the Java Platform Debugger Architecture (JPDA).
With JPDA, you can configure GlassFish Server to communicate debugging information using a socket.</p>
</div>
<div class="sect4">
<h5 id="to-debug-an-application-using-a-debugger"><a class="anchor" href="#to-debug-an-application-using-a-debugger"></a>To Debug an Application Using a Debugger</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Follow these steps to enable debugging in GlassFish Server using the Administration Console:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Expand the <strong>Configurations</strong> node, then expand the <strong>server-config</strong> node.</p>
</li>
<li>
<p>Select the <strong>JVM Settings</strong> node. The default debug options are set to:</p>
<div class="listingblock">
<div class="content">
<pre>-agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=9009</pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, the default debugger socket port is 9009.
You can change it to a port not in use by GlassFish Server or another service.</p>
</div>
</li>
<li>
<p>Select the <strong>Debug Enabled</strong> check box.</p>
</li>
<li>
<p>Click <strong>Save</strong>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Stop GlassFish Server and then restart it.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
</div>
<h1 id="platform-basics" class="sect0"><a class="anchor" href="#platform-basics"></a>Part II: Platform Basics</h1>
<div class="openblock partintro">
<div class="content">
Part II introduces platform basics.
</div>
</div>
<div class="sect1">
<h2 id="resource-creation"><a class="anchor" href="#resource-creation"></a>Chapter 3. Resource Creation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A resource is a program object that provides connections to such systems as database servers and messaging systems.
Jakarta EE components can access a wide variety of resources, including databases, mail sessions, Jakarta Messaging objects, and URLs.
The Jakarta EE platform provides mechanisms that allow you to access all these resources in a similar manner.
This chapter examines several types of resources and explains how to create them.</p>
</div>
<div class="sect2">
<h3 id="resources-and-jndi-naming"><a class="anchor" href="#resources-and-jndi-naming"></a>Resources and JNDI Naming</h3>
<div class="paragraph">
<p>In a distributed application, components need to access other components and resources, such as databases.
For example, a servlet might invoke remote methods on an enterprise bean that retrieves information from a database.
In the Jakarta EE platform, the Java Naming and Directory Interface (JNDI) naming service enables components to locate other components and resources.</p>
</div>
<div class="paragraph">
<p>A resource is a program object that provides connections to systems, such as database servers and messaging systems.
A Java Database Connectivity resource is sometimes referred to as a data source.
Each resource object is identified by a unique, people-friendly name, called the JNDI name.
For example, the JNDI name of the preconfigured JDBC resource for Apache Derby shipped with GlassFish Server is <code>java:comp/DefaultDataSource</code>.</p>
</div>
<div class="paragraph">
<p>An administrator creates resources in a JNDI namespace.
In GlassFish Server, you can use either the Administration Console or the <code>asadmin</code> command to create resources.
Applications then use annotations to inject the resources.
If an application uses resource injection, GlassFish Server invokes the JNDI API, and the application is not required to do so.
However, it is also possible for an application to locate resources by making direct calls to the JNDI API.</p>
</div>
<div class="paragraph">
<p>A resource object and its JNDI name are bound together by the naming and directory service.
To create a new resource, a new name/object binding is entered into the JNDI namespace.
You inject resources by using the <code>@Resource</code> annotation in an application.</p>
</div>
<div class="paragraph">
<p>You can use a deployment descriptor to override the resource mapping that you specify in an annotation.
Using a deployment descriptor allows you to change an application by repackaging it rather than by both recompiling the source files and repackaging.
However, for most applications a deployment descriptor is not necessary.</p>
</div>
</div>
<div class="sect2">
<h3 id="datasource-objects-and-connection-pools"><a class="anchor" href="#datasource-objects-and-connection-pools"></a>DataSource Objects and Connection Pools</h3>
<div class="paragraph">
<p>To store, organize, and retrieve data, most applications use a relational database.
Jakarta EE components may access relational databases through the JDBC API.
For information on this API, see <a href="https://docs.oracle.com/javase/8/docs/technotes/guides/jdbc/" class="bare" target="_blank" rel="noopener">https://docs.oracle.com/javase/8/docs/technotes/guides/jdbc/</a>.</p>
</div>
<div class="paragraph">
<p>In the JDBC API, databases are accessed by using <code>DataSource</code> objects.
A <code>DataSource</code> has a set of properties that identify and describe the real-world data source that it represents.
These properties include such information as the location of the database server, the name of the database, the network protocol to use to communicate with the server, and so on.
In GlassFish Server, a data source is called a JDBC resource.</p>
</div>
<div class="paragraph">
<p>Applications access a data source by using a connection, and a <code>DataSource</code> object can be thought of as a factory for connections to the particular data source that the <code>DataSource</code> instance represents.
In a basic <code>DataSource</code> implementation, a call to the <code>getConnection</code> method returns a connection object that is a physical connection to the data source.</p>
</div>
<div class="paragraph">
<p>A <code>DataSource</code> object may be registered with a JNDI naming service.
If so, an application can use the JNDI API to access that <code>DataSource</code> object, which can then be used to connect to the data source it represents.</p>
</div>
<div class="paragraph">
<p><code>DataSource</code> objects that implement connection pooling also produce a connection to the particular data source that the <code>DataSource</code> class represents.
The connection object that the <code>getConnection</code> method returns is a handle to a <code>PooledConnection</code> object rather than a physical connection.
An application uses the connection object in the same way that it uses a connection.
Connection pooling has no effect on application code except that a pooled connection, like all connections, should always be explicitly closed. When an application closes a connection that is pooled, the connection is returned to a pool of reusable connections.
The next time <code>getConnection</code> is called, a handle to one of these pooled connections will be returned if one is available.
Because connection pooling avoids creating a new physical connection every time one is requested, applications can run significantly faster.</p>
</div>
<div class="paragraph">
<p>A JDBC connection pool is a group of reusable connections for a particular database.
Because creating each new physical connection is time consuming, the server maintains a pool of available connections to increase performance.
When it requests a connection, an application obtains one from the pool.
When an application closes a connection, the connection is returned to the pool.</p>
</div>
<div class="paragraph">
<p>Applications that use Jakarta Persistence specify the <code>DataSource</code> object they are using in the <code>jta-data-source</code> element of the <code>persistence.xml</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;jta-data-source&gt;</span>jdbc/MyOrderDB<span class="tag">&lt;/jta-data-source&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This is typically the only reference to a JDBC object for a persistence unit.
The application code does not refer to any JDBC objects.</p>
</div>
</div>
<div class="sect2">
<h3 id="creating-resources-administratively"><a class="anchor" href="#creating-resources-administratively"></a>Creating Resources Administratively</h3>
<div class="paragraph">
<p>Before you deploy or run many applications, you may need to create resources for them.
An application can include a <code>glassfish-resources.xml</code> file that can be used to define resources for that application and others.
You can then use the <code>asadmin</code> command, specifying as the argument a file named <code>glassfish-resources.xml</code>, to create the resources administratively, as shown.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">asadmin add-resources glassfish-resources.xml</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>glassfish-resources.xml</code> file can be created in any project using NetBeans IDE or by hand.
Some of the Jakarta Messaging examples use this approach to resource creation.
A file for creating the resources needed for the Messaging simple producer example can be found in the <code>jms/simple/producer/src/main/setup</code> directory.</p>
</div>
<div class="paragraph">
<p>You could also use the <code>asadmin create-jms-resource</code> command to create the resources for this example.
When you are done using the resources, you would use the <code>asadmin list-jms-resources</code> command to display their names, and the <code>asadmin delete-jms-resource</code> command to remove them, regardless of the way you created the resources.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="injection"><a class="anchor" href="#injection"></a>Chapter 4. Injection</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter provides an overview of injection in Jakarta EE and describes the two injection mechanisms provided by the platform: resource injection and dependency injection.</p>
</div>
<div class="paragraph">
<p>Jakarta EE provides injection mechanisms that enable your objects to obtain references to resources and other dependencies without having to instantiate them directly.
You declare the required resources and other dependencies in your classes by decorating fields or methods with one of the annotations that mark the field as an injection point.
The container then provides the required instances at runtime.
Injection simplifies your code and decouples it from the implementations of its dependencies.</p>
</div>
<div class="sect2">
<h3 id="resource-injection"><a class="anchor" href="#resource-injection"></a>Resource Injection</h3>
<div class="paragraph">
<p>Resource injection enables you to inject any resource available in the JNDI namespace into any container-managed object, such as a servlet, an enterprise bean, or a managed bean.
For example, you can use resource injection to inject data sources, connectors, or custom resources available in the JNDI namespace.</p>
</div>
<div class="paragraph">
<p>The type you use for the reference to the injected instance is usually an interface, which decouples your code from the implementation of the resource.</p>
</div>
<div class="paragraph">
<p>For example, the following code injects a data source object that provides connections to the default Apache Derby database shipped with
Eclipse GlassFish Server:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">MyServlet</span> <span class="directive">extends</span> HttpServlet {
    <span class="annotation">@Resource</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">java:comp/DefaultDataSource</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">private</span> javax.sql.DataSource dsc;
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition to field-based injection as in the preceding example, you can inject resources using method-based injection:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">MyServlet</span> <span class="directive">extends</span> HttpServlet {
    <span class="directive">private</span> javax.sql.DataSource dsc;
    ...
    <span class="annotation">@Resource</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">java:comp/DefaultDataSource</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> setDsc(java.sql.DataSource ds) {
        dsc = ds;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To use method-based injection, the setter method must follow the JavaBeans conventions for property names: The method name must begin with <code>set</code>, have a <code>void</code> return type, and have only one parameter.</p>
</div>
<div class="paragraph">
<p>The <code>@Resource</code> annotation is in the <code>jakarta.annotation</code> package and is defined in the Jakarta Annotations spec.
Resource injection resolves by name, so it is not typesafe: the type of the resource object is not known at compile time, so you can get runtime errors if the types of the object and its reference do not match.</p>
</div>
</div>
<div class="sect2">
<h3 id="dependency-injection"><a class="anchor" href="#dependency-injection"></a>Dependency Injection</h3>
<div class="paragraph">
<p>Dependency injection enables you to turn regular Java classes into managed objects and to inject them into any other managed object.
Using dependency injection, your code can declare dependencies on any managed object.
The container automatically provides instances of these dependencies at the injection points at runtime, and it also manages the lifecycle of these instances for you.</p>
</div>
<div class="paragraph">
<p>Dependency injection in Jakarta EE defines scopes, which determine the lifecycle of the objects that the container instantiates and injects.
For example, a managed object that is only needed to respond to a single client request (such as a currency converter) has a different scope than a managed object that is needed to process multiple client requests within a session (such as a shopping cart).</p>
</div>
<div class="paragraph">
<p>You can define managed objects (also called managed beans) that you can later inject by assigning a scope to a regular class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@jakarta</span>.enterprise.context.RequestScoped
<span class="directive">public</span> <span class="type">class</span> <span class="class">CurrencyConverter</span> { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Use the <code>jakarta.inject.Inject</code> annotation to inject managed beans; for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">MyServlet</span> <span class="directive">extends</span> HttpServlet {
    <span class="annotation">@Inject</span> CurrencyConverter cc;
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As opposed to resource injection, dependency injection is typesafe because it resolves by type.
To decouple your code from the implementation of the managed bean, you can reference the injected instances using an interface type and have your managed bean implement that interface.</p>
</div>
<div class="paragraph">
<p>For more information about dependency injection, see <a href="#introduction-to-jakarta-contexts-and-dependency-injection">Chapter 25, <em>Introduction to Jakarta Contexts and Dependency Injection</em></a> and the Jakarta Contexts and Dependency Injection spec.</p>
</div>
</div>
<div class="sect2">
<h3 id="the-main-differences-between-resource-injection-and-dependency-injection"><a class="anchor" href="#the-main-differences-between-resource-injection-and-dependency-injection"></a>The Main Differences between Resource Injection and Dependency Injection</h3>
<div class="paragraph">
<p><a href="#differences-between-resource-injection-and-dependency-injection">Table 4-1</a> lists the main differences between resource injection and dependency injection.</p>
</div>
<table id="differences-between-resource-injection-and-dependency-injection" class="tableblock frame-all grid-all" style="width: 99%;">
<caption class="title">Table 4-1 Differences between Resource Injection and Dependency Injection</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 15%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Injection Mechanism</th>
<th class="tableblock halign-left valign-top">Can Inject JNDI Resources Directly</th>
<th class="tableblock halign-left valign-top">Can Inject Regular Classes Directly</th>
<th class="tableblock halign-left valign-top">Resolves By</th>
<th class="tableblock halign-left valign-top">Typesafe</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resource Injection</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resource name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dependency Injection</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="packaging"><a class="anchor" href="#packaging"></a>Chapter 5. Packaging</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter describes packaging.
A Jakarta EE application is packaged into one or more standard units for deployment to any Jakarta EE platform-compliant system.
Each unit contains a functional component or components, such as an enterprise bean, web page, servlet, or applet, and an optional deployment descriptor that describes its content.</p>
</div>
<div class="sect2">
<h3 id="packaging-applications"><a class="anchor" href="#packaging-applications"></a>Packaging Applications</h3>
<div class="paragraph">
<p>A Jakarta EE application is delivered in a Java Archive (JAR) file, a Web Archive (WAR) file, or an Enterprise Archive (EAR) file.
A WAR or EAR file is a standard JAR (<code>.jar</code>) file with a <code>.war</code> or <code>.ear</code> extension.
Using JAR, WAR, and EAR files and modules makes it possible to assemble a number of different Jakarta EE applications using some of the same components.
No extra coding is needed; it is only a matter of assembling (or packaging) various Jakarta EE modules into Jakarta EE JAR, WAR, or EAR files.</p>
</div>
<div class="paragraph">
<p>An EAR file (see <a href="#ear-file-structure">Figure 5-1</a>) contains Jakarta EE modules and, optionally, deployment descriptors.
A deployment descriptor, an XML document with an <code>.xml</code> extension, describes the deployment settings of an application, a module, or a component.
Because deployment descriptor information is declarative, it can be changed without the need to modify the source code.
At runtime, the Jakarta EE server reads the deployment descriptor and acts upon the application, module, or component accordingly.</p>
</div>
<div class="paragraph">
<p>Deployment information is most commonly specified in the source code by annotations.
Deployment descriptors, if present, override what is specified in the source code.</p>
</div>
<div id="ear-file-structure" class="imageblock">
<div class="content">
<img src="images/jakartaeett_dt_010.svg" alt="Diagram of EAR file structure. META-INF and web, application client, enterprise bean, and resource adapter modules are under the assembly root.">
</div>
<div class="title">Figure 5-1 EAR File Structure</div>
</div>
<div class="paragraph">
<p>The two types of deployment descriptors are Jakarta EE and runtime.
A Jakarta EE deployment descriptor is defined by a Jakarta EE specification and can be used to configure deployment settings on any Jakarta EE-compliant implementation.
A runtime deployment descriptor is used to configure Jakarta EE implementation-specific parameters.
For example, the GlassFish Server runtime deployment descriptor contains such information as the context root of a web application as well as GlassFish Server implementation-specific parameters, such as caching directives.
The GlassFish Server runtime deployment descriptors are named <code>glassfish-<em>moduleType</em>.xml</code> and are located in the same <code>META-INF</code> directory as the Jakarta EE deployment descriptor.</p>
</div>
<div class="paragraph">
<p>A Jakarta EE module consists of one or more Jakarta EE components for the same container type and, optionally, one component deployment descriptor of that type.
An enterprise bean module deployment descriptor, for example, declares transaction attributes and security authorizations for an enterprise bean.
A Jakarta EE module can be deployed as a stand-alone module.</p>
</div>
<div class="paragraph">
<p>Jakarta EE modules are of the following types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Enterprise bean modules, which contain class files for enterprise beans and, optionally, an enterprise bean deployment descriptor.
Enterprise bean modules are packaged as JAR files with a <code>.jar</code> extension.</p>
</li>
<li>
<p>Web modules, which contain servlet class files, web files, supporting class files, GIF and HTML files, and, optionally, a web application deployment descriptor.
Web modules are packaged as JAR files with a <code>.war</code> (web archive) extension.</p>
</li>
<li>
<p>Application client modules, which contain class files and, optionally, an application client deployment descriptor.
Application client modules are packaged as JAR files with a <code>.jar</code> extension.</p>
</li>
<li>
<p>Resource adapter modules, which contain all Java interfaces, classes, native libraries, and, optionally, a resource adapter deployment descriptor.
Together, these implement the Connector architecture (see <a href="#jakarta-connectors">Jakarta Connectors</a>) for a particular EIS.
Resource adapter modules are packaged as JAR files with an <code>.rar</code> (resource adapter archive) extension.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="packaging-enterprise-beans"><a class="anchor" href="#packaging-enterprise-beans"></a>Packaging Enterprise Beans</h3>
<div class="paragraph">
<p>This section explains how enterprise beans can be packaged in enterprise bean JAR or WAR modules. It includes the following sections:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#packaging-enterprise-beans-in-enterprise-bean-jar-modules">Packaging Enterprise Beans in enterprise bean JAR Modules</a></p>
</li>
<li>
<p><a href="#packaging-enterprise-beans-in-war-modules">Packaging Enterprise Beans in WAR Modules</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="packaging-enterprise-beans-in-enterprise-bean-jar-modules"><a class="anchor" href="#packaging-enterprise-beans-in-enterprise-bean-jar-modules"></a>Packaging Enterprise Beans in enterprise bean JAR Modules</h4>
<div class="paragraph">
<p>An enterprise bean JAR file is portable and can be used for various applications.</p>
</div>
<div class="paragraph">
<p>To assemble a Jakarta EE application, package one or more modules, such as enterprise bean JAR files, into an EAR file, the archive file that holds the application.
When deploying the EAR file that contains the enterprise bean&#8217;s JAR file, you also deploy the enterprise bean to GlassFish Server.
You can also deploy an enterprise bean JAR that is not contained in an EAR file.
<a href="#structure-of-an-enterprise-bean-jar">Figure 5-2</a> shows the contents of an enterprise bean JAR file.</p>
</div>
<div id="structure-of-an-enterprise-bean-jar" class="imageblock">
<div class="content">
<img src="images/jakartaeett_dt_011.svg" alt="Diagram showing the structure and contents of an enterprise bean JAR file.">
</div>
<div class="title">Figure 5-2 Structure of an Enterprise Bean JAR</div>
</div>
</div>
<div class="sect3">
<h4 id="packaging-enterprise-beans-in-war-modules"><a class="anchor" href="#packaging-enterprise-beans-in-war-modules"></a>Packaging Enterprise Beans in WAR Modules</h4>
<div class="paragraph">
<p>Enterprise beans often provide the business logic of a web application. In these cases, packaging the enterprise bean within the web application&#8217;s WAR module simplifies deployment and application organization.
Enterprise beans may be packaged within a WAR module as Java programming language class files or within a JAR file that is bundled within the WAR module.</p>
</div>
<div class="paragraph">
<p>To include enterprise bean class files in a WAR module, the class files should be in the <code>WEB-INF/classes</code> directory.</p>
</div>
<div class="paragraph">
<p>To include a JAR file that contains enterprise beans in a WAR module, add the JAR to the <code>WEB-INF/lib</code> directory of the WAR module.</p>
</div>
<div class="paragraph">
<p>WAR modules that contain enterprise beans do not require an <code>ejb-jar.xml</code> deployment descriptor.
If the application uses <code>ejb-jar.xml</code>, it must be located in the WAR module&#8217;s <code>WEB-INF</code> directory.</p>
</div>
<div class="paragraph">
<p>JAR files that contain enterprise bean classes packaged within a WAR module are not considered enterprise bean JAR files, even if the bundled JAR file conforms to the format of an enterprise bean JAR file.
The enterprise beans contained within the JAR file are semantically equivalent to enterprise beans located in the WAR module&#8217;s <code>WEB-INF/classes</code> directory, and the environment namespace of all the enterprise beans are scoped to the WAR module.</p>
</div>
<div class="paragraph">
<p>For example, suppose that a web application consists of a shopping cart enterprise bean, a credit cardprocessing enterprise bean, and a Java servlet front end.
The shopping cart bean exposes a local, no-interface view and is defined as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.example.cart</span>;

<span class="annotation">@Stateless</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">CartBean</span> { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The credit cardprocessing bean is packaged within its own JAR file, <code>cc.jar</code>, exposes a local, no-interface view, and is defined as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.example.cc</span>;

<span class="annotation">@Stateless</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">CreditCardBean</span> { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The servlet, <code>com.example.web.StoreServlet</code>, handles the web front end and uses both <code>CartBean</code> and <code>CreditCardBean</code>.
The WAR module layout for this application is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>WEB-INF/classes/com/example/cart/CartBean.class
WEB-INF/classes/com/example/web/StoreServlet
WEB-INF/lib/cc.jar
WEB-INF/ejb-jar.xml
WEB-INF/web.xml</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="packaging-web-archives"><a class="anchor" href="#packaging-web-archives"></a>Packaging Web Archives</h3>
<div class="paragraph">
<p>In the Jakarta EE architecture, a web module is the smallest deployable and usable unit of web resources.
A web module contains web components and static web content files, such as images, which are called web resources.
A Jakarta EE web module corresponds to a web application as defined in the Jakarta Servlet specification.</p>
</div>
<div class="paragraph">
<p>In addition to web components and web resources, a web module can contain other files:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Server-side utility classes, such as shopping carts</p>
</li>
<li>
<p>Client-side classes, such as utility classes</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A web module has a specific structure.
The top-level directory of a web module is the document root of the application.
The document root is where XHTML pages, client-side classes and archives, and static web resources, such as images, are stored.</p>
</div>
<div class="paragraph">
<p>The document root contains a subdirectory named <code>WEB-INF</code>, which can contain the following files and directories:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>classes</code>, a directory that contains server-side classes: servlets, enterprise bean class files, utility classes, and JavaBeans components</p>
</li>
<li>
<p><code>lib</code>, a directory that contains JAR files that contain enterprise beans, and JAR archives of libraries called by server-side classes</p>
</li>
<li>
<p>Deployment descriptors, such as <code>web.xml</code> (the web application deployment descriptor) and <code>ejb-jar.xml</code> (an enterprise bean deployment descriptor)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A web module needs a <code>web.xml</code> file if it uses Jakarta Faces technology, if it must specify certain kinds of security information, or if you want to override information specified by web component annotations.</p>
</div>
<div class="paragraph">
<p>You can also create application-specific subdirectories (that is, package directories) in either the document root or the <code>WEB-INF/classes/</code> directory.</p>
</div>
<div class="paragraph">
<p>A web module can be deployed as an unpacked file structure or can be packaged in a JAR file known as a Web Archive (WAR) file.
Because the contents and use of WAR files differ from those of JAR files, WAR file names use a <code>.war</code> extension.
The web module just described is portable; you can deploy it into any web container that conforms to the Jakarta Servlet specification.</p>
</div>
<div class="paragraph">
<p>You can provide a runtime deployment descriptor (DD) when you deploy a WAR on GlassFish Server, but it is not required under most circumstances.
The runtime DD is an XML file that may contain such information as the context root of the web application, the mapping of the portable names of an application&#8217;s resources to GlassFish Server resources, and the mapping of an application&#8217;s security roles to users, groups, and principals defined in GlassFish Server.
The GlassFish Server web application runtime DD, if used, is named <code>glassfish-web.xml</code> and is located in the <code>WEB-INF</code> directory.
The structure of a web module that can be deployed on GlassFish Server is shown in <a href="#web-module-structure">Figure 5-3</a>.</p>
</div>
<div id="web-module-structure" class="imageblock">
<div class="content">
<img src="images/jakartaeett_dt_012.svg" alt="Diagram of web module structure. WEB-INF and web pages are under the root. Under WEB-INF are descriptors and the lib and classes directories.">
</div>
<div class="title">Figure 5-3 Web Module Structure</div>
</div>
</div>
<div class="sect2">
<h3 id="packaging-resource-adapter-archives"><a class="anchor" href="#packaging-resource-adapter-archives"></a>Packaging Resource Adapter Archives</h3>
<div class="paragraph">
<p>A Resource Adapter Archive (RAR) file stores XML files, Java classes, and other objects for Jakarta EE Connector applications.
A resource adapter can be deployed on any Jakarta EE server, much like a Jakarta EE application.
A RAR file can be contained in an Enterprise Archive (EAR) file, or it can exist as a separate file.</p>
</div>
<div class="paragraph">
<p>The RAR file contains</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A JAR file with the implementation classes of the resource adapter</p>
</li>
<li>
<p>An optional <code>META-INF/</code> directory that can store an <code>ra.xml</code> file and/or an application serverspecific deployment descriptor used for configuration purposes</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A RAR file can be deployed on the application server as a standalone component or as part of a larger application.
In both cases, the adapter is available to all applications using a lookup procedure.</p>
</div>
</div>
</div>
</div>
<h1 id="the-web-tier" class="sect0"><a class="anchor" href="#the-web-tier"></a>Part III: The Web Tier</h1>
<div class="openblock partintro">
<div class="content">
Part III explores the technologies in the web tier.
</div>
</div>
<div class="sect1">
<h2 id="getting-started-with-web-applications"><a class="anchor" href="#getting-started-with-web-applications"></a>Chapter 6. Getting Started with Web Applications</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter introduces web applications, which typically use Jakarta
Server Faces technology and/or Jakarta Servlet technology.</p>
</div>
<div class="sect2">
<h3 id="web-applications"><a class="anchor" href="#web-applications"></a>Web Applications</h3>
<div class="paragraph">
<p>A web application is a dynamic extension of a web or application server.
Web applications are of the following types:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Presentation-oriented</dt>
<dd>
<p>A presentation-oriented web application generates interactive web pages containing various types of markup language (HTML, XHTML, XML, and so on) and dynamic content in response to requests.
Development of presentation-oriented web applications is covered in <a href="#jakarta-faces-technology">Chapter 7, <em>Jakarta Faces Technology</em></a> through <a href="#jakarta-servlet-technology-2">Chapter 18, <em>Jakarta Servlet Technology</em></a></p>
</dd>
<dt class="hdlist1">Service-oriented</dt>
<dd>
<p>A service-oriented web application implements the endpoint of a web service.
Presentation-oriented applications are often clients of service-oriented web applications.
Development of service-oriented web applications is covered in <a href="#building-web-services-with-jakarta-xml-web-services">Chapter 31, <em>Building Web Services with Jakarta XML Web Services</em></a> and <a href="#building-restful-web-services-with-jakarta-rest">Chapter 32, <em>Building RESTful Web Services with Jakarta REST</em></a> in <a href="#web-services">Part VI, &#8220;Web Services&#8221;</a></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>In the Jakarta EE platform, web components provide the dynamic extension capabilities for a web server.
Web components can be Jakarta servlets, web pages implemented with Jakarta Faces technology, web service endpoints, or Jakarta Server Pages.
<a href="#jakarta-web-application-request-handling">Figure 6-1</a> illustrates the interaction between a web client and a web application that uses a servlet.
The client sends an HTTP request to the web server.
A web server that implements Jakarta Servlet and Jakarta Server Pages technology converts the request into an <code>HTTPServletRequest</code> object.
This object is delivered to a web component, which can interact with JavaBeans components or a database to generate dynamic content.
The web component can then generate an <code>HTTPServletResponse</code> or can pass the request to another web component.
A web component eventually generates a <code>HTTPServletResponse</code> object.
The web server converts this object to an HTTP response and returns it to the client.</p>
</div>
<div id="jakarta-web-application-request-handling" class="imageblock">
<div class="content">
<img src="images/jakartaeett_dt_013.svg" alt="Diagram of web application request handling. Clients and servlets communicate using HttpServletRequest and HttpServletResponse.">
</div>
<div class="title">Figure 6-1 Jakarta Web Application Request Handling</div>
</div>
<div class="paragraph">
<p>Servlets are Java programming language classes that dynamically process requests and construct responses.
Java technologies, such as Jakarta Faces and Facelets, are used for building interactive web applications.
(Frameworks can also be used for this purpose.)
Although servlets and Jakarta Faces and Facelets pages can be used to accomplish similar things, each has its own strengths.
Servlets are best suited for service-oriented applications (web service endpoints can be implemented as servlets) and the control functions of a presentation-oriented application, such as dispatching requests and handling nontextual data.
Jakarta Faces and Facelets pages are more appropriate for generating text-based markup, such as XHTML, and are generally used for presentation-oriented applications.</p>
</div>
<div class="paragraph">
<p>Web components are supported by the services of a runtime platform called a web container.
A web container provides such services as request dispatching, security, concurrency, and lifecycle management.
A web container also gives web components access to such APIs as naming, transactions, and email.</p>
</div>
<div class="paragraph">
<p>Certain aspects of web application behavior can be configured when the application is installed, or deployed, to the web container.
The configuration information can be specified using Jakarta EE annotations or can be maintained in a text file in XML format called a web application deployment descriptor (DD).
A web application DD must conform to the schema described in the Jakarta Servlet specification.</p>
</div>
<div class="paragraph">
<p>This chapter gives a brief overview of the activities involved in developing web applications.
First, it summarizes the web application lifecycle and explains how to package and deploy very simple web applications on GlassFish Server.
The chapter then moves on to configuring web applications and discusses how to specify the most commonly used configuration parameters.</p>
</div>
</div>
<div class="sect2">
<h3 id="web-application-lifecycle"><a class="anchor" href="#web-application-lifecycle"></a>Web Application Lifecycle</h3>
<div class="paragraph">
<p>A web application consists of web components; static resource files, such as images and cascading style sheets (CSS); and helper classes and libraries.
The web container provides many supporting services that enhance the capabilities of web components and make them easier to develop.
However, because a web application must take these services into account, the process for creating and running a web application is different from that of traditional stand-alone Java classes.</p>
</div>
<div class="paragraph">
<p>The process for creating, deploying, and executing a web application can be summarized as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Develop the web component code.</p>
</li>
<li>
<p>Develop the web application deployment descriptor, if necessary.</p>
</li>
<li>
<p>Compile the web application components and helper classes referenced by the components.</p>
</li>
<li>
<p>Optionally, package the application into a deployable unit.</p>
</li>
<li>
<p>Deploy the application into a web container.</p>
</li>
<li>
<p>Access a URL that references the web application.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Developing web component code is covered in the later chapters.
Steps 2 through 4 are expanded on in the following sections and illustrated with a Hello, Worldstyle, presentation-oriented application.
This application allows a user to enter a name into an HTML form and then displays a greeting after the name is submitted.</p>
</div>
<div class="paragraph">
<p>The Hello application contains two web components that generate the greeting and the response.
This chapter discusses the following simple applications:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>hello1</code>, a Jakarta Faces technologybased application that uses two XHTML pages and a managed bean</p>
</li>
<li>
<p><code>hello2</code>, a servlet-based web application in which the components are implemented by two servlet classes</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The applications are used to illustrate tasks involved in packaging, deploying, configuring, and running an application that contains web components.</p>
</div>
</div>
<div class="sect2">
<h3 id="a-web-module-that-uses-jakarta-faces-technology-the-hello1-example"><a class="anchor" href="#a-web-module-that-uses-jakarta-faces-technology-the-hello1-example"></a>A Web Module That Uses Jakarta Faces Technology: The hello1 Example</h3>
<div class="paragraph">
<p>The <code>hello1</code> application is a web module that uses Jakarta Faces technology to display a greeting and response.
You can use a text editor to view the application files, or you can use NetBeans IDE.</p>
</div>
<div class="paragraph">
<p>The source code for this application is in the <code><em>tut-install</em>/examples/web/jsf/hello1/</code> directory.</p>
</div>
<div class="sect3">
<h4 id="to-view-the-hello1-web-module-using-netbeans-ide"><a class="anchor" href="#to-view-the-hello1-web-module-using-netbeans-ide"></a>To View the hello1 Web Module Using NetBeans IDE</h4>
<div class="paragraph">
<p>To view the <code>hello1</code> web module using NetBeans IDE:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>From the <strong>File</strong> menu, choose <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the Open Project dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/web/jsf</pre>
</div>
</div>
</li>
<li>
<p>Select the <code>hello1</code> folder and click <strong>Open Project</strong>.</p>
</li>
<li>
<p>Expand the <strong>Web Pages</strong> node and double-click the <code>index.xhtml</code> file to view it in the editor.</p>
<div class="paragraph">
<p>The <code>index.xhtml</code> file is the default landing page for a Facelets application.
In a typical Facelets application, web pages are created in XHTML.
For this application, the page uses simple tag markup to display a form with a graphic image, a header, a field, and two command buttons:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="doctype">&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;
    &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;&gt;</span>
<span class="tag">&lt;html</span> <span class="attribute-name">lang</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/1999/xhtml</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xmlns:h</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://xmlns.jcp.org/jsf/html</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;h:head&gt;</span>
        <span class="tag">&lt;title&gt;</span>Facelets Hello Greeting<span class="tag">&lt;/title&gt;</span>
    <span class="tag">&lt;/h:head&gt;</span>
    <span class="tag">&lt;h:body&gt;</span>
        <span class="tag">&lt;h:form&gt;</span>
            <span class="tag">&lt;h:graphicImage</span> <span class="attribute-name">url</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{resource['images:duke.waving.gif']}</span><span class="delimiter">&quot;</span></span>
                            <span class="attribute-name">alt</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Duke waving his hand</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;h2&gt;</span>Hello, my name is Duke. What's yours?<span class="tag">&lt;/h2&gt;</span>
            <span class="tag">&lt;h:inputText</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">username</span><span class="delimiter">&quot;</span></span>
                         <span class="attribute-name">title</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">My name is: </span><span class="delimiter">&quot;</span></span>
                         <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{hello.name}</span><span class="delimiter">&quot;</span></span>
                         <span class="attribute-name">required</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
                         <span class="attribute-name">requiredMessage</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Error: A name is required.</span><span class="delimiter">&quot;</span></span>
                         <span class="attribute-name">maxlength</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">25</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
            <span class="tag">&lt;p&gt;</span><span class="tag">&lt;/p&gt;</span>
            <span class="tag">&lt;h:commandButton</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">submit</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Submit</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">response</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;/h:commandButton&gt;</span>
            <span class="tag">&lt;h:commandButton</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">reset</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Reset</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">reset</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;/h:commandButton&gt;</span>
        <span class="tag">&lt;/h:form&gt;</span>
        ...
    <span class="tag">&lt;/h:body&gt;</span>
<span class="tag">&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The most complex element on the page is the <code>inputText</code> field.
The <code>maxlength</code> attribute specifies the maximum length of the field.
The <code>required</code> attribute specifies that the field must be filled out; the <code>requiredMessage</code> attribute provides the error message to be displayed if the field is left empty.
The <code>title</code> attribute provides the text to be used by screen readers for the visually disabled.
Finally, the <code>value</code> attribute contains an expression that will be provided by the <code>Hello</code> managed bean.</p>
</div>
<div class="paragraph">
<p>The web page connects to the <code>Hello</code> managed bean through the Expression Language (EL) value expression <code>#{hello.name}</code>, which retrieves the value of the <code>name</code> property from the managed bean.
Note the use of <code>hello</code> to reference the managed bean <code>Hello</code>.
If no name is specified in the <code>@Named</code> annotation of the managed bean, the managed bean is always accessed with the first letter of the class name in lowercase.</p>
</div>
<div class="paragraph">
<p>The Submit <code>commandButton</code> element specifies the action as <code>response</code>, meaning that when the button is clicked, the <code>response.xhtml</code> page is displayed.</p>
</div>
</li>
<li>
<p>Double-click the <code>response.xhtml</code> file to view it.</p>
<div class="paragraph">
<p>The response page appears. Even simpler than the greeting page, the response page contains a graphic image, a header that displays the expression provided by the managed bean, and a single button whose <code>action</code> element transfers you back to the <code>index.xhtml</code> page:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="doctype">&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;
    &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;&gt;</span>
<span class="tag">&lt;html</span> <span class="attribute-name">lang</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/1999/xhtml</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xmlns:h</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://xmlns.jcp.org/jsf/html</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;h:head&gt;</span>
        <span class="tag">&lt;title&gt;</span>Facelets Hello Response<span class="tag">&lt;/title&gt;</span>
    <span class="tag">&lt;/h:head&gt;</span>
    <span class="tag">&lt;h:body&gt;</span>
        <span class="tag">&lt;h:form&gt;</span>
            <span class="tag">&lt;h:graphicImage</span> <span class="attribute-name">url</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{resource['images:duke.waving.gif']}</span><span class="delimiter">&quot;</span></span>
                            <span class="attribute-name">alt</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Duke waving his hand</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;h2&gt;</span>Hello, #{hello.name}!<span class="tag">&lt;/h2&gt;</span>
            <span class="tag">&lt;p&gt;</span><span class="tag">&lt;/p&gt;</span>
            <span class="tag">&lt;h:commandButton</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">back</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Back</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">index</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;/h:form&gt;</span>
    <span class="tag">&lt;/h:body&gt;</span>
<span class="tag">&lt;/html&gt;</span></code></pre>
</div>
</div>
</li>
<li>
<p>Expand the Source Packages node, then the <code>ee.jakarta.tutorial.hello1</code> node.</p>
</li>
<li>
<p><a id="hello1-nb-step-7"></a> Double-click the <code>Hello.java</code> file to view it.</p>
<div class="paragraph">
<p>The <code>Hello</code> class, called a managed bean class, provides getter and setter methods for the <code>name</code> property used in the Facelets page expressions.
By default, the expression language refers to the class name, with the first letter in lowercase (<code>hello.name</code>).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">ee.jakarta.tutorial.hello1</span>;

<span class="keyword">import</span> <span class="include">jakarta.enterprise.context.RequestScoped</span>;
<span class="keyword">import</span> <span class="include">jakarta.inject.Named</span>;

<span class="annotation">@Named</span>
<span class="annotation">@RequestScoped</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Hello</span> {

    <span class="directive">private</span> <span class="predefined-type">String</span> name;

    <span class="directive">public</span> Hello() {
    }

    <span class="directive">public</span> <span class="predefined-type">String</span> getName() {
        <span class="keyword">return</span> name;
    }

    <span class="directive">public</span> <span class="type">void</span> setName(<span class="predefined-type">String</span> user_name) {
        <span class="local-variable">this</span>.name = user_name;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you use the default name for the bean class, you can specify <code>@Model</code> as the annotation instead of having to specify both <code>@Named</code> and <code>@RequestScoped</code>.
The <code>@Model</code> annotation is called a stereotype, a term for an annotation that encapsulates other annotations.
It is described later in <a href="#using-stereotypes-in-cdi-applications">Using Stereotypes in CDI Applications</a>.
Some examples will use <code>@Model</code> where it is appropriate.</p>
</div>
</li>
<li>
<p>Under the Web Pages node, expand the WEB-INF node and double-click the <code>web.xml</code> file to view it.</p>
<div class="paragraph">
<p>The <code>web.xml</code> file contains several elements that are required for a Facelets application.
All of the following are created automatically when you use NetBeans IDE to create an application.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A context parameter specifying the project stage:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;context-param&gt;</span>
    <span class="tag">&lt;param-name&gt;</span>jakarta.faces.PROJECT_STAGE<span class="tag">&lt;/param-name&gt;</span>
    <span class="tag">&lt;param-value&gt;</span>Development<span class="tag">&lt;/param-value&gt;</span>
<span class="tag">&lt;/context-param&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A context parameter provides configuration information needed by a web application.
An application can define its own context parameters.
In addition, Jakarta Faces technology and Jakarta Servlet technology define context parameters that an application can use.</p>
</div>
</li>
<li>
<p>A <code>servlet</code> element and its <code>servlet-mapping</code> element specifying the <code>FacesServlet</code>. All files with the <code>.xhtml</code> suffix will be matched:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;servlet&gt;</span>
    <span class="tag">&lt;servlet-name&gt;</span>Faces Servlet<span class="tag">&lt;/servlet-name&gt;</span>
    <span class="tag">&lt;servlet-class&gt;</span>jakarta.faces.webapp.FacesServlet<span class="tag">&lt;/servlet-class&gt;</span>
    <span class="tag">&lt;load-on-startup&gt;</span>1<span class="tag">&lt;/load-on-startup&gt;</span>
<span class="tag">&lt;/servlet&gt;</span>
<span class="tag">&lt;servlet-mapping&gt;</span>
    <span class="tag">&lt;servlet-name&gt;</span>Faces Servlet<span class="tag">&lt;/servlet-name&gt;</span>
    <span class="tag">&lt;url-pattern&gt;</span>*.xhtml<span class="tag">&lt;/url-pattern&gt;</span>
<span class="tag">&lt;/servlet-mapping&gt;</span></code></pre>
</div>
</div>
</li>
<li>
<p>A <code>welcome-file-list</code> element specifying the location of the landing page:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;welcome-file-list&gt;</span>
    <span class="tag">&lt;welcome-file&gt;</span>index.xhtml<span class="tag">&lt;/welcome-file&gt;</span>
<span class="tag">&lt;/welcome-file-list&gt;</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="introduction-to-scopes"><a class="anchor" href="#introduction-to-scopes"></a>Introduction to Scopes</h5>
<div class="paragraph">
<p>In the <code>Hello.java</code> class, the annotations <code>jakarta.inject.Named</code> and <code>jakarta.enterprise.context.RequestScoped</code> identify the class as a managed bean using request scope.
Scope defines how application data persists and is shared.</p>
</div>
<div class="paragraph">
<p>The most commonly used scopes in Jakarta Faces applications are the following:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Request (<code>@RequestScoped</code>)</dt>
<dd>
<p>Request scope persists during a single HTTP request in a web application.
In an application like <code>hello1</code>, in which the application consists of a single request and response, the bean uses request scope.</p>
</dd>
<dt class="hdlist1">Session (<code>@SessionScoped</code>)</dt>
<dd>
<p>Session scope persists across multiple HTTP requests in a web application.
When an application consists of multiple requests and responses where data needs to be maintained, beans use session scope.</p>
</dd>
<dt class="hdlist1">Application (<code>@ApplicationScoped</code>)</dt>
<dd>
<p>Application scope persists across all users' interactions with a web application.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>For more information on scopes in Jakarta Faces technology, see <a href="#using-managed-bean-scopes">Using Managed Bean Scopes</a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="packaging-and-deploying-the-hello1-web-module"><a class="anchor" href="#packaging-and-deploying-the-hello1-web-module"></a>Packaging and Deploying the hello1 Web Module</h4>
<div class="paragraph">
<p>A web module must be packaged into a WAR in certain deployment scenarios and whenever you want to distribute the web module.
You can package a web module into a WAR file by using Maven or by using the IDE tool of your choice.
This tutorial shows you how to use NetBeans IDE or Maven to build, package, and deploy the <code>hello1</code> sample application.</p>
</div>
<div class="paragraph">
<p>You can deploy a WAR file to GlassFish Server by:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Using NetBeans IDE</p>
</li>
<li>
<p>Using the <code>asadmin</code> command</p>
</li>
<li>
<p>Using the Administration Console</p>
</li>
<li>
<p>Copying the WAR file into the <code><em>domain-dir</em>/autodeploy/</code> directory</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Throughout the tutorial, you will use NetBeans IDE or Maven for packaging and deploying.</p>
</div>
<div class="sect4">
<h5 id="to-build-and-package-the-hello1-web-module-using-netbeans-ide"><a class="anchor" href="#to-build-and-package-the-hello1-web-module-using-netbeans-ide"></a>To Build and Package the hello1 Web Module Using NetBeans IDE</h5>
<div class="paragraph">
<p>To build and package the <code>hello1</code> web module using NetBeans IDE:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Start GlassFish Server as described in <a href="#to-start-glassfish-server-using-netbeans-ide">To Start GlassFish Server Using NetBeans IDE</a>, if you have not already done so.</p>
</li>
<li>
<p>From the <strong>File</strong> menu, choose <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the Open Project dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/web/jsf</pre>
</div>
</div>
</li>
<li>
<p>Select the <code>hello1</code> folder.</p>
</li>
<li>
<p>Click <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the <strong>Projects</strong> tab, right-click the <code>hello1</code> project and select <strong>Build</strong>. This command deploys the project to the server.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-build-and-package-the-hello1-web-module-using-maven"><a class="anchor" href="#to-build-and-package-the-hello1-web-module-using-maven"></a>To Build and Package the hello1 Web Module Using Maven</h5>
<div class="paragraph">
<p>To build and package the <code>hello1</code> web module using Maven:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Start GlassFish Server as described in <a href="#to-start-glassfish-server-using-the-command-line">To Start GlassFish Server Using the Command Line</a>, if you have not already done so.</p>
</li>
<li>
<p>In a terminal window, go to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/web/jsf/hello1/</pre>
</div>
</div>
</li>
<li>
<p>Enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">mvn install</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command spawns any necessary compilations and creates the WAR file in <code><em>tut-install</em>/examples/web/jsf/hello1/target/</code>.
It then deploys the project to the server.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="viewing-deployed-web-modules"><a class="anchor" href="#viewing-deployed-web-modules"></a>Viewing Deployed Web Modules</h4>
<div class="paragraph">
<p>GlassFish Server provides two ways to view the deployed web modules: the Administration Console and the <code>asadmin</code> command.
You can also use NetBeans IDE to view deployed modules.</p>
</div>
<div class="sect4">
<h5 id="to-view-deployed-web-modules-using-the-administration-console"><a class="anchor" href="#to-view-deployed-web-modules-using-the-administration-console"></a>To View Deployed Web Modules Using the Administration Console</h5>
<div class="paragraph">
<p>To view deployed web modules using the Administration Console:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open the URL <a href="http://localhost:4848/" class="bare" target="_blank" rel="noopener">http://localhost:4848/</a> in a browser.</p>
</li>
<li>
<p>Select the Applications node.</p>
<div class="paragraph">
<p>The deployed web modules appear in the Deployed Applications table.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-view-deployed-web-modules-using-the-asadmin-command"><a class="anchor" href="#to-view-deployed-web-modules-using-the-asadmin-command"></a>To View Deployed Web Modules Using the asadmin Command</h5>
<div class="paragraph">
<p>Enter the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">asadmin list-applications</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="to-view-deployed-web-modules-using-netbeans-ide"><a class="anchor" href="#to-view-deployed-web-modules-using-netbeans-ide"></a>To View Deployed Web Modules Using NetBeans IDE</h5>
<div class="paragraph">
<p>To view deployed web modules using NetBeans IDE:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the <strong>Services</strong> tab, expand the <strong>Servers</strong> node, then expand the <strong>GlassFish Server</strong> node.</p>
</li>
<li>
<p>Expand the <strong>Applications</strong> node to view the deployed modules.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="running-the-deployed-hello1-web-module"><a class="anchor" href="#running-the-deployed-hello1-web-module"></a>Running the Deployed hello1 Web Module</h4>
<div class="paragraph">
<p>Now that the web module is deployed, you can view it by opening the application in a web browser.
By default, the application is deployed to host <code>localhost</code> on port 8080.
The context root of the web application is <code>hello1</code>.</p>
</div>
<div class="paragraph">
<p>To run the deployed <code>hello1</code> web module:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open a web browser.</p>
</li>
<li>
<p>Enter the following URL:</p>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080/hello1/</pre>
</div>
</div>
</li>
<li>
<p>In the field, enter your name and click Submit.</p>
<div class="paragraph">
<p>The response page displays the name you submitted. Click Back to try again.</p>
</div>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="dynamic-reloading-of-deployed-modules"><a class="anchor" href="#dynamic-reloading-of-deployed-modules"></a>Dynamic Reloading of Deployed Modules</h5>
<div class="paragraph">
<p>If dynamic reloading is enabled, you do not have to redeploy an application or module when you change its code or deployment descriptors.
All you have to do is copy the changed pages or class files into the deployment directory for the application or module.
The deployment directory for a web module named context-root is <code><em>domain-dir</em>/applications/<em>context-root</em></code>.
The server checks for changes periodically and redeploys the application, automatically and dynamically, with the changes.</p>
</div>
<div class="paragraph">
<p>This capability is useful in a development environment because it allows code changes to be tested quickly.
Dynamic reloading is not recommended for a production environment, however, because it may degrade performance.
In addition, whenever a reload takes place, the sessions at that time become invalid, and the client must restart the session.</p>
</div>
<div class="paragraph">
<p>In GlassFish Server, dynamic reloading is enabled by default.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="undeploying-the-hello1-web-module"><a class="anchor" href="#undeploying-the-hello1-web-module"></a>Undeploying the hello1 Web Module</h4>
<div class="paragraph">
<p>You can undeploy web modules and other types of enterprise applications by using either NetBeans IDE or Maven.</p>
</div>
<div class="sect4">
<h5 id="to-undeploy-the-hello1-web-module-using-netbeans-ide"><a class="anchor" href="#to-undeploy-the-hello1-web-module-using-netbeans-ide"></a>To Undeploy the hello1 Web Module Using NetBeans IDE</h5>
<div class="paragraph">
<p>To undeploy the <code>hello1</code> web module using NetBeans IDE:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the <strong>Services</strong> tab, expand the <strong>Servers</strong> node, then expand the <strong>GlassFish Server</strong> node.</p>
</li>
<li>
<p>Expand the <strong>Applications</strong> node.</p>
</li>
<li>
<p>Right-click the <code>hello1</code> module and select <strong>Undeploy</strong>.</p>
</li>
<li>
<p>To delete the class files and other build artifacts, go back to the <strong>Projects</strong> tab, right-click the project, and select <strong>Clean</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-undeploy-the-hello1-web-module-using-maven"><a class="anchor" href="#to-undeploy-the-hello1-web-module-using-maven"></a>To Undeploy the hello1 Web Module Using Maven</h5>
<div class="paragraph">
<p>To undeploy the <code>hello1</code> web module using Maven:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In a terminal window, go to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/web/jsf/hello1/</pre>
</div>
</div>
</li>
<li>
<p>Enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">mvn cargo:undeploy</code></pre>
</div>
</div>
</li>
<li>
<p>To delete the class files and other build artifacts, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">mvn clean</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="a-web-module-that-uses-jakarta-servlet-technology-the-hello2-example"><a class="anchor" href="#a-web-module-that-uses-jakarta-servlet-technology-the-hello2-example"></a>A Web Module That Uses Jakarta Servlet Technology: The hello2 Example</h3>
<div class="paragraph">
<p>The <code>hello2</code> application is a web module that uses Jakarta Servlet technology to display a greeting and response.
You can use a text editor to view the application files, or you can use NetBeans IDE.</p>
</div>
<div class="paragraph">
<p>The source code for this application is in the <code><em>tut-install</em>/examples/web/servlet/hello2/</code> directory.</p>
</div>
<div class="sect3">
<h4 id="mapping-urls-to-web-components"><a class="anchor" href="#mapping-urls-to-web-components"></a>Mapping URLs to Web Components</h4>
<div class="paragraph">
<p>When it receives a request, the web container must determine which web component should handle the request.
The web container does so by mapping the URL path contained in the request to a web application and a web component.
A URL path contains the context root and, optionally, a URL pattern:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>http://host:port/context-root[/url-pattern]</pre>
</div>
</div>
<div class="paragraph">
<p>You set the URL pattern for a servlet by using the <code>@WebServlet</code> annotation in the servlet source file.
For example, the <code>GreetingServlet.java</code> file in the <code>hello2</code> application contains the following annotation, specifying the URL pattern as <code>/greeting</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@WebServlet</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/greeting</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">GreetingServlet</span> <span class="directive">extends</span> HttpServlet {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This annotation indicates that the URL pattern <code>/greeting</code> follows the context root.
Therefore, when the servlet is deployed locally, it is accessed with the following URL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080/hello2/greeting</pre>
</div>
</div>
<div class="paragraph">
<p>To access the servlet by using only the context root, specify <code>"/"</code> as the URL pattern.</p>
</div>
</div>
<div class="sect3">
<h4 id="examining-the-hello2-web-module"><a class="anchor" href="#examining-the-hello2-web-module"></a>Examining the hello2 Web Module</h4>
<div class="paragraph">
<p>The <code>hello2</code> application behaves almost identically to the <code>hello1</code> application, but it is implemented using Jakarta Servlet technology instead of Jakarta Faces technology.
You can use a text editor to view the application files, or you can use NetBeans IDE.</p>
</div>
<div class="sect4">
<h5 id="to-view-the-hello2-web-module-using-netbeans-ide"><a class="anchor" href="#to-view-the-hello2-web-module-using-netbeans-ide"></a>To View the hello2 Web Module Using NetBeans IDE</h5>
<div class="paragraph">
<p>To view the <code>hello2</code> web module using NetBeans IDE:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>From the <strong>File</strong> menu, choose <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the Open Project dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/web/servlet</pre>
</div>
</div>
</li>
<li>
<p>Select the <code>hello2</code> folder and click <strong>Open Project</strong>.</p>
</li>
<li>
<p>Expand the <strong>Source Packages</strong> node, then expand the <code>ee.jakarta.tutorial.hello2</code> node.</p>
</li>
<li>
<p>Double-click the <code>GreetingServlet.java</code> file to view it.</p>
<div class="paragraph">
<p>This servlet overrides the <code>doGet</code> method, implementing the <code>GET</code> method of HTTP.
The servlet displays a simple HTML greeting form whose Submit button, like that of <code>hello1</code>, specifies a response page for its action.
The following excerpt begins with the <code>@WebServlet</code> annotation, which specifies the URL pattern relative to the context root:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@WebServlet</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/greeting</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">GreetingServlet</span> <span class="directive">extends</span> HttpServlet {

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> doGet(HttpServletRequest request,
            HttpServletResponse response)
            <span class="directive">throws</span> ServletException, <span class="exception">IOException</span> {

        response.setContentType(<span class="string"><span class="delimiter">&quot;</span><span class="content">text/html</span><span class="delimiter">&quot;</span></span>);
        response.setBufferSize(<span class="integer">8192</span>);
        <span class="keyword">try</span> (<span class="predefined-type">PrintWriter</span> out = response.getWriter()) {
            out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;html lang=</span><span class="char">\&quot;</span><span class="content">en</span><span class="char">\&quot;</span><span class="content">&gt;</span><span class="delimiter">&quot;</span></span>
                    + <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;head&gt;&lt;title&gt;Servlet Hello&lt;/title&gt;&lt;/head&gt;</span><span class="delimiter">&quot;</span></span>);

            <span class="comment">// then write the data of the response</span>
            out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;body  bgcolor=</span><span class="char">\&quot;</span><span class="content">#ffffff</span><span class="char">\&quot;</span><span class="content">&gt;</span><span class="delimiter">&quot;</span></span>
                + <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;img src=</span><span class="char">\&quot;</span><span class="content">duke.waving.gif</span><span class="char">\&quot;</span><span class="content"> </span><span class="delimiter">&quot;</span></span>
                + <span class="string"><span class="delimiter">&quot;</span><span class="content">alt=</span><span class="char">\&quot;</span><span class="content">Duke waving his hand</span><span class="char">\&quot;</span><span class="content">&gt;</span><span class="delimiter">&quot;</span></span>
                + <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;form method=</span><span class="char">\&quot;</span><span class="content">get</span><span class="char">\&quot;</span><span class="content">&gt;</span><span class="delimiter">&quot;</span></span>
                + <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;h2&gt;Hello, my name is Duke. What's yours?&lt;/h2&gt;</span><span class="delimiter">&quot;</span></span>
                + <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;input title=</span><span class="char">\&quot;</span><span class="content">My name is: </span><span class="char">\&quot;</span><span class="content">type=</span><span class="char">\&quot;</span><span class="content">text</span><span class="char">\&quot;</span><span class="content"> </span><span class="delimiter">&quot;</span></span>
                + <span class="string"><span class="delimiter">&quot;</span><span class="content">name=</span><span class="char">\&quot;</span><span class="content">username</span><span class="char">\&quot;</span><span class="content"> size=</span><span class="char">\&quot;</span><span class="content">25</span><span class="char">\&quot;</span><span class="content">&gt;</span><span class="delimiter">&quot;</span></span>
                + <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;p&gt;&lt;/p&gt;</span><span class="delimiter">&quot;</span></span>
                + <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;input type=</span><span class="char">\&quot;</span><span class="content">submit</span><span class="char">\&quot;</span><span class="content"> value=</span><span class="char">\&quot;</span><span class="content">Submit</span><span class="char">\&quot;</span><span class="content">&gt;</span><span class="delimiter">&quot;</span></span>
                + <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;input type=</span><span class="char">\&quot;</span><span class="content">reset</span><span class="char">\&quot;</span><span class="content"> value=</span><span class="char">\&quot;</span><span class="content">Reset</span><span class="char">\&quot;</span><span class="content">&gt;</span><span class="delimiter">&quot;</span></span>
                + <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/form&gt;</span><span class="delimiter">&quot;</span></span>);

            <span class="predefined-type">String</span> username = request.getParameter(<span class="string"><span class="delimiter">&quot;</span><span class="content">username</span><span class="delimiter">&quot;</span></span>);
            <span class="keyword">if</span> (username != <span class="predefined-constant">null</span> &amp;&amp; username.length() &gt; <span class="integer">0</span>) {
                RequestDispatcher dispatcher =
                    getServletContext().getRequestDispatcher(<span class="string"><span class="delimiter">&quot;</span><span class="content">/response</span><span class="delimiter">&quot;</span></span>);

                <span class="keyword">if</span> (dispatcher != <span class="predefined-constant">null</span>) {
                    dispatcher.include(request, response);
                }
            }
            out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/body&gt;&lt;/html&gt;</span><span class="delimiter">&quot;</span></span>);
        }
    }
    ...
}</code></pre>
</div>
</div>
</li>
<li>
<p>Double-click the <code>ResponseServlet.java</code> file to view it.</p>
<div class="paragraph">
<p>This servlet also overrides the <code>doGet</code> method, displaying only the response.
The following excerpt begins with the <code>@WebServlet</code> annotation, which specifies the URL pattern relative to the context root:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@WebServlet</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/response</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">ResponseServlet</span> <span class="directive">extends</span> HttpServlet {

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> doGet(HttpServletRequest request,
            HttpServletResponse response)
            <span class="directive">throws</span> ServletException, <span class="exception">IOException</span> {
        <span class="keyword">try</span> (<span class="predefined-type">PrintWriter</span> out = response.getWriter()) {

            <span class="comment">// then write the data of the response</span>
            <span class="predefined-type">String</span> username = request.getParameter(<span class="string"><span class="delimiter">&quot;</span><span class="content">username</span><span class="delimiter">&quot;</span></span>);
            <span class="keyword">if</span> (username != <span class="predefined-constant">null</span> &amp;&amp; username.length() &gt; <span class="integer">0</span>) {
                out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;h2&gt;Hello, </span><span class="delimiter">&quot;</span></span> + username + <span class="string"><span class="delimiter">&quot;</span><span class="content">!&lt;/h2&gt;</span><span class="delimiter">&quot;</span></span>);
            }
        }
    }
    ...
}</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="running-the-hello2-example"><a class="anchor" href="#running-the-hello2-example"></a>Running the hello2 Example</h4>
<div class="paragraph">
<p>You can use either NetBeans IDE or Maven to build, package, deploy, and run the <code>hello2</code> example.</p>
</div>
<div class="sect4">
<h5 id="to-run-the-hello2-example-using-netbeans-ide"><a class="anchor" href="#to-run-the-hello2-example-using-netbeans-ide"></a>To Run the hello2 Example Using NetBeans IDE</h5>
<div class="paragraph">
<p>To run the <code>hello2</code> example using NetBeans IDE:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Start GlassFish Server as described in <a href="#to-start-glassfish-server-using-netbeans-ide">To Start GlassFish Server Using NetBeans IDE</a>, if you have not already done so.</p>
</li>
<li>
<p>From the <strong>File</strong> menu, choose <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the Open Project dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/web/servlet</pre>
</div>
</div>
</li>
<li>
<p>Select the <code>hello2</code> folder.</p>
</li>
<li>
<p>Click <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the <strong>Projects</strong> tab, right-click the <code>hello2</code> project and select <strong>Build</strong> to package and deploy the project.</p>
</li>
<li>
<p>In a web browser, open the following URL:</p>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080/hello2/greeting</pre>
</div>
</div>
<div class="paragraph">
<p>The URL specifies the context root, followed by the URL pattern.</p>
</div>
<div class="paragraph">
<p>The application looks much like the <code>hello1</code> application.
The major difference is that after you click Submit the response appears below the greeting, not on a separate page.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-run-the-hello2-example-using-maven"><a class="anchor" href="#to-run-the-hello2-example-using-maven"></a>To Run the hello2 Example Using Maven</h5>
<div class="paragraph">
<p>To run the <code>hello2</code> example using Maven:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Start GlassFish Server as described in <a href="#to-start-glassfish-server-using-the-command-line">To Start GlassFish Server Using the Command Line</a>, if you have not already done so.</p>
</li>
<li>
<p>In a terminal window, go to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/web/servlet/hello2/</pre>
</div>
</div>
</li>
<li>
<p>Enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">mvn install</code></pre>
</div>
</div>
<div class="paragraph">
<p>This target builds the WAR file, copies it to the <code><em>tut-install</em>/examples/web/hello2/target/</code> directory, and deploys it.</p>
</div>
</li>
<li>
<p>In a web browser, open the following URL:</p>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080/hello2/greeting</pre>
</div>
</div>
<div class="paragraph">
<p>The URL specifies the context root, followed by the URL pattern.</p>
</div>
<div class="paragraph">
<p>The application looks much like the <code>hello1</code> application.
The major difference is that after you click Submit the response appears below the greeting, not on a separate page.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-web-applications"><a class="anchor" href="#configuring-web-applications"></a>Configuring Web Applications</h3>
<div class="paragraph">
<p>This section describes the following tasks involved with configuring web applications:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Setting context parameters</p>
</li>
<li>
<p>Declaring welcome files</p>
</li>
<li>
<p>Mapping errors to error screens</p>
</li>
<li>
<p>Declaring resource references</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="setting-context-parameters"><a class="anchor" href="#setting-context-parameters"></a>Setting Context Parameters</h4>
<div class="paragraph">
<p>The web components in a web module share an object that represents their application context.
You can pass context parameters to the context, or you can pass initialization parameters to a servlet.
Context parameters are available to the entire application.
For information on initialization parameters, see <a href="#creating-and-initializing-a-servlet">Creating and Initializing a Servlet</a>.</p>
</div>
<div class="sect4">
<h5 id="to-add-a-context-parameter-using-netbeans-ide"><a class="anchor" href="#to-add-a-context-parameter-using-netbeans-ide"></a>To Add a Context Parameter Using NetBeans IDE</h5>
<div class="paragraph">
<p>These steps apply generally to web applications but do not apply specifically to the examples in this chapter.</p>
</div>
<div class="paragraph">
<p>To add a context parameter using NetBeans IDE:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open the project.</p>
</li>
<li>
<p>Expand the project&#8217;s node in the <strong>Projects</strong> tree.</p>
</li>
<li>
<p>Expand the <strong>Web Pages</strong> node and then the <strong>WEB-INF</strong> node.</p>
</li>
<li>
<p>Double-click <code>web.xml</code>.</p>
<div class="paragraph">
<p>If the project does not have a <code>web.xml</code> file, create one by following the steps in <a href="#to-create-a-web-xml-file-using-netbeans-ide">To Create a web.xml File Using NetBeans IDE</a>.</p>
</div>
</li>
<li>
<p>Click <strong>General</strong> at the top of the editor window.</p>
</li>
<li>
<p>Expand the <strong>Context Parameters</strong> node.</p>
</li>
<li>
<p>Click <strong>Add</strong>.</p>
</li>
<li>
<p>In the <strong>Add Context Parameter</strong> dialog box, in the <strong>Parameter Name</strong> field, enter the name that specifies the context object.</p>
</li>
<li>
<p>In the <strong>Parameter Value</strong> field, enter the parameter to pass to the context object.</p>
</li>
<li>
<p>Click <strong>OK</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-create-a-web-xml-file-using-netbeans-ide"><a class="anchor" href="#to-create-a-web-xml-file-using-netbeans-ide"></a>To Create a web.xml File Using NetBeans IDE</h5>
<div class="paragraph">
<p>To create a <code>web.xml</code> file using NetBeans IDE:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>From the <strong>File</strong> menu, choose <strong>New File</strong>.</p>
</li>
<li>
<p>In the New File wizard, select the <strong>Web</strong> category, then select <strong>Standard Deployment Descriptor</strong> under <strong>File Types</strong>.</p>
</li>
<li>
<p>Click <strong>Next</strong>.</p>
</li>
<li>
<p>Click <strong>Finish</strong>.</p>
<div class="paragraph">
<p>A basic <code>web.xml</code> file appears in <code>web/WEB-INF/</code>.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="declaring-welcome-files"><a class="anchor" href="#declaring-welcome-files"></a>Declaring Welcome Files</h4>
<div class="paragraph">
<p>The welcome files mechanism allows you to specify a list of files that the web container can append to a request for a URL (called a valid partial request) that is not mapped to a web component.
For example, suppose that you define a welcome file <code>welcome.html</code>.
When a client requests a URL such as <code><em>host:port/webapp/directory</em></code>, where <code><em>directory</em></code> is not mapped to a servlet or XHTML page, the file <code><em>host:port/webapp/directory/</em>welcome.html</code> is returned to the client.</p>
</div>
<div class="paragraph">
<p>If a web container receives a valid partial request, the web container examines the welcome file list, appends to the partial request each welcome file in the order specified, and checks whether a static resource or servlet in the WAR is mapped to that request URL.
The web container then sends the request to the first resource that matches in the WAR.</p>
</div>
<div class="paragraph">
<p>If no welcome file is specified, GlassFish Server will use a file named <code>index.html</code> as the default welcome file.
If there is no welcome file and no file named <code>index.html</code>, GlassFish Server returns a directory listing.</p>
</div>
<div class="paragraph">
<p>You specify welcome files in the <code>web.xml</code> file.
The welcome file specification for the <code>hello1</code> example looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;welcome-file-list&gt;</span>
    <span class="tag">&lt;welcome-file&gt;</span>index.xhtml<span class="tag">&lt;/welcome-file&gt;</span>
<span class="tag">&lt;/welcome-file-list&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A specified welcome file must not have a leading or trailing slash (<code>/</code>).</p>
</div>
<div class="paragraph">
<p>The <code>hello2</code> example does not specify a welcome file, because the URL request is mapped to the <code>GreetingServlet</code> web component through the URL pattern <code>/greeting</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="mapping-errors-to-error-screens"><a class="anchor" href="#mapping-errors-to-error-screens"></a>Mapping Errors to Error Screens</h4>
<div class="paragraph">
<p>When an error occurs during execution of a web application, you can have the application display a specific error screen according to the type of error.
In particular, you can specify a mapping between the status code returned in an HTTP response or a Java programming language exception returned by any web component and any type of error screen.</p>
</div>
<div class="paragraph">
<p>You can have multiple <code>error-page</code> elements in your deployment descriptor.
Each element identifies a different error that causes an error page to open.
This error page can be the same for any number of <code>error-page</code> elements.</p>
</div>
<div class="sect4">
<h5 id="to-set-up-error-mapping-using-netbeans-ide"><a class="anchor" href="#to-set-up-error-mapping-using-netbeans-ide"></a>To Set Up Error Mapping Using NetBeans IDE</h5>
<div class="paragraph">
<p>These steps apply generally to web applications but do not apply specifically to the examples in this chapter.</p>
</div>
<div class="paragraph">
<p>To set up error mapping using NetBeans IDE:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open the project.</p>
</li>
<li>
<p>Expand the project&#8217;s node in the <strong>Projects</strong> tab.</p>
</li>
<li>
<p>Expand the <strong>Web Pages</strong> node and then the <strong>WEB-INF</strong> node.</p>
</li>
<li>
<p>Double-click <code>web.xml</code>.</p>
<div class="paragraph">
<p>If the project does not have a <code>web.xml</code> file, create one by following the steps in <a href="#to-create-a-web-xml-file-using-netbeans-ide">To Create a web.xml File Using NetBeans IDE</a>.</p>
</div>
</li>
<li>
<p>Click <strong>Pages</strong> at the top of the editor window.</p>
</li>
<li>
<p>Expand the <strong>Error Pages</strong> node.</p>
</li>
<li>
<p>Click <strong>Add</strong>.</p>
</li>
<li>
<p>In the Add Error Page dialog box, click <strong>Browse</strong> to locate the page that you want to act as the error page.</p>
</li>
<li>
<p>Specify either an error code or an exception type.</p>
<div class="ulist">
<ul>
<li>
<p>To specify an error code, in the Error Code field enter the HTTP status code that will cause the error page to be opened, or leave the field blank to include all error codes.</p>
</li>
<li>
<p>To specify an exception type, in the Exception Type field enter the exception that will cause the error page to load. To specify all throwable errors and exceptions, enter <code>java.lang.Throwable</code>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Click <strong>OK</strong>.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="declaring-resource-references"><a class="anchor" href="#declaring-resource-references"></a>Declaring Resource References</h4>
<div class="paragraph">
<p>If your web component uses such objects as enterprise beans, data sources, or web services, you use Jakarta EE annotations to inject these resources into your application.
Annotations eliminate a lot of the boilerplate lookup code and configuration elements that previous versions of Jakarta EE required.</p>
</div>
<div class="paragraph">
<p>Although resource injection using annotations can be more convenient for the developer, there are some restrictions on using it in web applications.
First, you can inject resources only into container-managed objects, because a container must have control over the creation of a component so that it can perform the injection into a component.
As a result, you cannot inject resources into such objects as simple JavaBeans components.
However, managed beans are managed by the container; therefore, they can accept resource injections.</p>
</div>
<div class="paragraph">
<p>Components that can accept resource injections are listed in <a href="#web-components-that-accept-resource-injections">Table 6-1</a>.</p>
</div>
<div class="paragraph">
<p>This section explains how to use a couple of the annotations supported by a web container to inject resources.
<a href="#running-the-persistence-examples">Chapter 41, <em>Running the Persistence Examples</em></a>, explains how web applications use annotations supported by Jakarta Persistence.
<a href="#getting-started-securing-web-applications">Chapter 51, <em>Getting Started Securing Web Applications</em></a>, explains how to use annotations to specify information about securing web applications.
See <a href="#resource-adapters-and-contracts">Chapter 56, <em>Resource Adapters and Contracts</em></a>, for more information on resources.</p>
</div>
<table id="web-components-that-accept-resource-injections" class="tableblock frame-all grid-all" style="width: 50%;">
<caption class="title">Table 6-1 Web Components That Accept Resource Injections</caption>
<colgroup>
<col style="width: 40%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Component</th>
<th class="tableblock halign-left valign-top">Interface/Class</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Servlets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jakarta.servlet.Servlet</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Servlet filters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jakarta.servlet.ServletFilter</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Event listeners</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jakarta.servlet.ServletContextListener</code></p>
<p class="tableblock"><code>jakarta.servlet.ServletContextAttributeListener</code></p>
<p class="tableblock"><code>jakarta.servlet.ServletRequestListener</code></p>
<p class="tableblock"><code>jakarta.servlet.ServletRequestAttributeListener</code></p>
<p class="tableblock"><code>jakarta.servlet.http.HttpSessionListener</code></p>
<p class="tableblock"><code>jakarta.servlet.http.HttpSessionAttributeListener</code></p>
<p class="tableblock"><code>jakarta.servlet.http.HttpSessionBindingListener</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Managed beans</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Plain Old Java Objects</p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="declaring-a-reference-to-a-resource"><a class="anchor" href="#declaring-a-reference-to-a-resource"></a>Declaring a Reference to a Resource</h5>
<div class="paragraph">
<p>The <code>@Resource</code> annotation is used to declare a reference to a resource, such as a data source, an enterprise bean, or an environment entry.</p>
</div>
<div class="paragraph">
<p>The <code>@Resource</code> annotation is specified on a class, a method, or a field.
The container is responsible for injecting references to resources declared by the <code>@Resource</code> annotation and mapping it to the proper JNDI resources.</p>
</div>
<div class="paragraph">
<p>In the following example, the <code>@Resource</code> annotation is used to inject a data source into a component that needs to make a connection to the data source, as is done when using JDBC technology to access a relational database:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Resource</span> javax.sql.DataSource catalogDS;
<span class="directive">public</span> getProductsByCategory() {
    <span class="comment">// get a connection and execute the query</span>
    <span class="predefined-type">Connection</span> conn = catalogDS.getConnection();
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The container injects this data source prior to the component&#8217;s being made available to the application.
The data source JNDI mapping is inferred from the field name, <code>catalogDS</code>, and the type, <code>javax.sql.DataSource</code>.</p>
</div>
<div class="paragraph">
<p>If you have multiple resources that you need to inject into one component, you need to use the <code>@Resources</code> annotation to contain them, as shown by the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Resources</span> ({
    <span class="annotation">@Resource</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">myDB</span><span class="delimiter">&quot;</span></span> type=javax.sql.DataSource.class),
    <span class="annotation">@Resource</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">myMQ</span><span class="delimiter">&quot;</span></span> type=jakarta.jms.ConnectionFactory.class)
})</code></pre>
</div>
</div>
<div class="paragraph">
<p>The web application examples in this tutorial use Jakarta Persistence to access relational databases.
This API does not require you to explicitly create a connection to a data source.
Therefore, the examples do not use the <code>@Resource</code> annotation to inject a data source.
However, this API supports the <code>@PersistenceUnit</code> and <code>@PersistenceContext</code> annotations for injecting <code>EntityManagerFactory</code> and <code>EntityManager</code> instances, respectively.
<a href="#running-the-persistence-examples">Running the Persistence Examples</a> describes these annotations and the use of the Jakarta Persistence in web applications.</p>
</div>
</div>
<div class="sect4">
<h5 id="declaring-a-reference-to-a-web-service"><a class="anchor" href="#declaring-a-reference-to-a-web-service"></a>Declaring a Reference to a Web Service</h5>
<div class="paragraph">
<p>The <code>@WebServiceRef</code> annotation provides a reference to a web service.
The following example shows uses the <code>@WebServiceRef</code> annotation to declare a reference to a web service.
<code>WebServiceRef</code> uses the <code>wsdlLocation</code> element to specify the URI of the deployed service&#8217;s WSDL file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">...
import jakarta.xml.ws.WebServiceRef;
...
public <span class="type">class</span> <span class="class">ResponseServlet</span> <span class="directive">extends</span> HTTPServlet {
<span class="annotation">@WebServiceRef</span>(wsdlLocation=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8080/helloservice/hello?wsdl</span><span class="delimiter">&quot;</span></span>)
<span class="directive">static</span> HelloService service;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="further-information-about-web-applications"><a class="anchor" href="#further-information-about-web-applications"></a>Further Information about Web Applications</h3>
<div class="paragraph">
<p>For more information on web applications, see</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Jakarta Faces 3.0 specification:<br>
<a href="https://jakarta.ee/specifications/faces/3.0/" class="bare" target="_blank" rel="noopener">https://jakarta.ee/specifications/faces/3.0/</a></p>
</li>
<li>
<p>Jakarta Servlet 5.0 specification:<br>
<a href="https://jakarta.ee/specifications/servlet/5.0/" class="bare" target="_blank" rel="noopener">https://jakarta.ee/specifications/servlet/5.0/</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="jakarta-faces-technology"><a class="anchor" href="#jakarta-faces-technology"></a>Chapter 7. Jakarta Faces Technology</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Jakarta Faces technology is a server-side component framework for building Java technologybased web applications.</p>
</div>
<div class="sect2">
<h3 id="introduction-to-jakarta-faces-technology"><a class="anchor" href="#introduction-to-jakarta-faces-technology"></a>Introduction to Jakarta Faces Technology</h3>
<div class="paragraph">
<p>Jakarta Faces technology consists of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An API for representing components and managing their state; handling events, server-side validation, and data conversion; defining page navigation; supporting internationalization and accessibility; and providing extensibility for all these features</p>
</li>
<li>
<p>Tag libraries for adding components to web pages and for connecting components to server-side objects</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Jakarta Faces technology provides a well-defined programming model and various tag libraries.
The tag libraries contain tag handlers that implement the component tags.
These features significantly ease the burden of building and maintaining web applications with server-side user interfaces (UIs).
With minimal effort, you can complete the following tasks.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create a web page.</p>
</li>
<li>
<p>Drop components onto a web page by adding component tags.</p>
</li>
<li>
<p>Bind components on a page to server-side data.</p>
</li>
<li>
<p>Wire component-generated events to server-side application code.</p>
</li>
<li>
<p>Save and restore application state beyond the life of server requests.</p>
</li>
<li>
<p>Reuse and extend components through customization.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This chapter provides an overview of Jakarta Faces technology.
After explaining what a Jakarta Faces application is and reviewing some of the primary benefits of using Jakarta Faces technology, this chapter describes the process of creating a simple Jakarta Faces application.
This chapter also introduces the Jakarta Faces lifecycle by describing the example Jakarta Faces application and its progression through the lifecycle stages.</p>
</div>
</div>
<div class="sect2">
<h3 id="what-is-a-jakarta-faces-application"><a class="anchor" href="#what-is-a-jakarta-faces-application"></a>What Is a Jakarta Faces Application?</h3>
<div class="paragraph">
<p>The functionality provided by a Jakarta Faces application is similar to that of any other Java web application.
A typical Jakarta Faces application includes the following parts.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A set of web pages in which components are laid out.</p>
</li>
<li>
<p>A set of tags to add components to the web page.</p>
</li>
<li>
<p>A set of managed beans, which are lightweight, container-managed objects (POJOs).
In a Jakarta Faces application, managed beans serve as backing beans, which define properties and functions for UI components on a page.</p>
</li>
<li>
<p>A web deployment descriptor (<code>web.xml</code> file).</p>
</li>
<li>
<p>Optionally, one or more application configuration resource files, such as a <code>faces-config.xml</code> file, which can be used to define page navigation rules and configure beans and other custom objects, such as custom components.</p>
</li>
<li>
<p>Optionally, a set of custom objects, which can include custom components, validators, converters, or listeners, created by the application developer.</p>
</li>
<li>
<p>Optionally, a set of custom tags for representing custom objects on the page.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a href="#responding-to-a-client-request-for-a-jakarta-faces-page">Figure 7-1</a> shows the interaction between client and server in a typical Jakarta Faces application.
In response to a client request, a web page is rendered by the web container that implements Jakarta Faces technology.</p>
</div>
<div id="responding-to-a-client-request-for-a-jakarta-faces-page" class="imageblock">
<div class="content">
<img src="images/jakartaeett_dt_014.svg" alt="Diagram that shows a browser accessing the myfacelet.xhtml page using an HTTP Request and the server sending the rendered HTML page using an HTTP Response.">
</div>
<div class="title">Figure 7-1 Responding to a Client Request for a Jakarta Faces Page</div>
</div>
<div class="paragraph">
<p>The web page, <code>myfacelet.xhtml</code>, is built using Jakarta Faces component tags.
Component tags are used to add components to the <code>view</code> (represented by <code>myView</code> in the diagram), which is the server-side representation of the page.
In addition to components, the web page can also reference objects, such as the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Any event listeners, validators, and converters that are registered on the components</p>
</li>
<li>
<p>The JavaBeans components that capture the data and process the application-specific functionality of the components</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>On request from the client, the view is rendered as a response.
Rendering is the process whereby, based on the server-side view, the web container generates output, such as HTML or XHTML, that can be read by the client, such as a browser.</p>
</div>
</div>
<div class="sect2">
<h3 id="jakarta-faces-technology-benefits"><a class="anchor" href="#jakarta-faces-technology-benefits"></a>Jakarta Faces Technology Benefits</h3>
<div class="paragraph">
<p>One of the greatest advantages of Jakarta Faces technology is that it offers a clean separation between behavior and presentation for web applications.
A Jakarta Faces application can map HTTP requests to component-specific event handling and manage components as stateful objects on the server.
Jakarta Faces technology allows you to build web applications that implement the finer-grained separation of behavior and presentation that is traditionally offered by client-side UI architectures.</p>
</div>
<div class="paragraph">
<p>The separation of logic from presentation also allows each member of a web application development team to focus on a single piece of the development process and provides a simple programming model to link the pieces.
For example, page authors with no programming expertise can use Jakarta Faces technology tags in a web page to link to server-side objects without writing any scripts.</p>
</div>
<div class="paragraph">
<p>Another important goal of Jakarta Faces technology is to leverage familiar component and web-tier concepts without limiting you to a particular scripting technology or markup language.
Jakarta Faces technology APIs are layered directly on top of the Servlet API, as shown in <a href="#web-application-technologies">Figure 7-2</a>.</p>
</div>
<div id="web-application-technologies" class="imageblock">
<div class="content">
<img src="images/jakartaeett_dt_015.svg" alt="Diagram of web application technologies. Jakarta Server Pages, the server pages Standard Tag Library, and Jakarta Faces rest on Jakarta Servlet technology.">
</div>
<div class="title">Figure 7-2 Web Application Technologies</div>
</div>
<div class="paragraph">
<p>This layering of APIs enables several important application use cases, such as using different presentation technologies, creating your own custom components directly from the component classes, and generating output for various client devices.</p>
</div>
<div class="paragraph">
<p>Facelets technology, available as part of Jakarta Faces technology, is the preferred presentation technology for building Jakarta Faces technologybased web applications.
For more information on Facelets technology features, see <a href="#introduction-to-facelets">Chapter 8, <em>Introduction to Facelets</em></a>.</p>
</div>
<div class="paragraph">
<p>Facelets technology offers several advantages.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Code can be reused and extended for components through the templating and composite component features.</p>
</li>
<li>
<p>You can use annotations to automatically register the managed bean as a resource available for Jakarta Faces applications.
In addition, implicit navigation rules allow developers to quickly configure page navigation (see <a href="#navigation-model">Navigation Model</a> for details).
These features reduce the manual configuration process for applications.</p>
</li>
<li>
<p>Most important, Jakarta Faces technology provides a rich architecture for managing component state, processing component data, validating user input, and handling events.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="a-simple-jakarta-faces-application"><a class="anchor" href="#a-simple-jakarta-faces-application"></a>A Simple Jakarta Faces Application</h3>
<div class="paragraph">
<p>Jakarta Faces technology provides an easy and user-friendly process for creating web applications.
Developing a simple Jakarta Faces application typically requires the following tasks, which have already been described in <a href="#a-web-module-that-uses-jakarta-faces-technology-the-hello1-example">A Web Module That Uses Jakarta Faces Technology: The hello1 Example</a>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Creating web pages using component tags</p>
</li>
<li>
<p>Developing managed beans</p>
</li>
<li>
<p>Mapping the <code>FacesServlet</code> instance</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>hello1</code> example includes a managed bean and two Facelets web pages.
When accessed by a client, the first web page asks the user for his or her name, and the second page responds by providing a greeting.</p>
</div>
<div class="paragraph">
<p>For details on Facelets technology, see <a href="#introduction-to-facelets">Chapter 8, <em>Introduction to Facelets</em></a>.
For details on using EL expressions, see <a href="#expression-language">Chapter 9, <em>Expression Language</em></a>.
For details on the Jakarta Faces programming model and building web pages using Jakarta Faces technology, see <a href="#using-jakarta-faces-technology-in-web-pages">Chapter 10, <em>Using Jakarta Faces Technology in Web Pages</em></a>.</p>
</div>
<div class="paragraph">
<p>Every web application has a lifecycle.
Common tasks, such as handling incoming requests, decoding parameters, modifying and saving state, and rendering web pages to the browser, are all performed during a web application lifecycle.
Some web application frameworks hide the details of the lifecycle from you, whereas others require you to manage them manually.</p>
</div>
<div class="paragraph">
<p>By default, Jakarta Faces automatically handles most of the lifecycle actions for you.
However, it also exposes the various stages of the request lifecycle so that you can modify or perform different actions if your application requirements warrant it.</p>
</div>
<div class="paragraph">
<p>The lifecycle of a Jakarta Faces application starts and ends with the following activity: The client makes a request for the web page, and the server responds with the page.
The lifecycle consists of two main phases: Execute and Render.</p>
</div>
<div class="paragraph">
<p>During the Execute phase, several actions can take place.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The application view is built or restored.</p>
</li>
<li>
<p>The request parameter values are applied.</p>
</li>
<li>
<p>Conversions and validations are performed for component values.</p>
</li>
<li>
<p>Managed beans are updated with component values.</p>
</li>
<li>
<p>Application logic is invoked.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For a first (initial) request, only the view is built.
For subsequent (postback) requests, some or all of the other actions can take place.</p>
</div>
<div class="paragraph">
<p>In the Render phase, the requested view is rendered as a response to the client.
Rendering is typically the process of generating output, such as HTML or XHTML, that can be read by the client, usually a browser.</p>
</div>
<div class="paragraph">
<p>The following short description of the example Jakarta Faces application passing through its lifecycle summarizes the activity that takes place behind the scenes.</p>
</div>
<div class="paragraph">
<p>The <code>hello1</code> example application goes through the following stages when it is deployed on GlassFish Server.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>When the <code>hello1</code> application is built and deployed on GlassFish Server, the application is in an uninitiated state.</p>
</li>
<li>
<p>When a client makes an initial request for the <code>index.xhtml</code> web page, the <code>hello1</code> Facelets application is compiled.</p>
</li>
<li>
<p>The compiled Facelets application is executed, and a new component tree is constructed for the <code>hello1</code> application and placed in a <code>FacesContext</code>.</p>
</li>
<li>
<p>The component tree is populated with the component and the managed bean property associated with it, represented by the EL expression <code>hello.name</code>.</p>
</li>
<li>
<p>A new view is built, based on the component tree.</p>
</li>
<li>
<p>The view is rendered to the requesting client as a response.</p>
</li>
<li>
<p>The component tree is destroyed automatically.</p>
</li>
<li>
<p>On subsequent (postback) requests, the component tree is rebuilt, and the saved state is applied.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For full details on the lifecycle, see <a href="#the-lifecycle-of-a-jakarta-faces-application">The Lifecycle of a Jakarta Faces Application</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="user-interface-component-model"><a class="anchor" href="#user-interface-component-model"></a>User Interface Component Model</h3>
<div class="paragraph">
<p>In addition to the lifecycle description, an overview of Jakarta Faces architecture provides better understanding of the technology.</p>
</div>
<div class="paragraph">
<p>Jakarta Faces components are the building blocks of a Jakarta Faces view.
A component can be a user interface (UI) component or a non-UI component.</p>
</div>
<div class="paragraph">
<p>Jakarta Faces UI components are configurable, reusable elements that compose the user interfaces of Jakarta Faces applications.
A component can be simple, such as a button, or can be compound, such as a table composed of multiple components.</p>
</div>
<div class="paragraph">
<p>Jakarta Faces technology provides a rich, flexible component architecture that includes the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A set of <code>jakarta.faces.component.UIComponent</code> classes for specifying the state and behavior of UI components</p>
</li>
<li>
<p>A rendering model that defines how to render the components in various ways</p>
</li>
<li>
<p>A conversion model that defines how to register data converters onto a component</p>
</li>
<li>
<p>An event and listener model that defines how to handle component events</p>
</li>
<li>
<p>A validation model that defines how to register validators onto a component</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This section briefly describes each of these pieces of the component architecture.</p>
</div>
<div class="sect3">
<h4 id="user-interface-component-classes"><a class="anchor" href="#user-interface-component-classes"></a>User Interface Component Classes</h4>
<div class="paragraph">
<p>Jakarta Faces technology provides a set of UI component classes and associated behavioral interfaces that specify all the UI component functionality, such as holding component state, maintaining a reference to objects, and driving event handling and rendering for a set of standard components.</p>
</div>
<div class="paragraph">
<p>The component classes are completely extensible, allowing component writers to create their own custom components.
See <a href="#creating-custom-ui-components-and-other-custom-objects">Chapter 15, <em>Creating Custom UI Components and Other Custom Objects</em></a> for more information.</p>
</div>
<div class="paragraph">
<p>The abstract base class for all components is <code>jakarta.faces.component.UIComponent</code>.
Jakarta Faces UI component classes extend the <code>UIComponentBase</code> class (a subclass of <code>UIComponent</code>), which defines the default state and behavior of a component.
The following set of component classes is included with Jakarta Faces technology.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>UIColumn</code>: Represents a single column of data in a <code>UIData</code> component.</p>
</li>
<li>
<p><code>UICommand</code>: Represents a control that fires actions when activated.</p>
</li>
<li>
<p><code>UIData</code>: Represents a data binding to a collection of data represented by a <code>jakarta.faces.model.DataModel</code> instance.</p>
</li>
<li>
<p><code>UIForm</code>: Represents an input form to be presented to the user.
Its child components represent (among other things) the input fields to be included when the form is submitted.
This component is analogous to the <code>form</code> tag in HTML.</p>
</li>
<li>
<p><code>UIGraphic</code>: Displays an image.</p>
</li>
<li>
<p><code>UIInput</code>: Takes data input from a user.
This class is a subclass of <code>UIOutput</code>.</p>
</li>
<li>
<p><code>UIMessage</code>: Displays a localized error message.</p>
</li>
<li>
<p><code>UIMessages</code>: Displays a set of localized error messages.</p>
</li>
<li>
<p><code>UIOutcomeTarget</code>: Displays a link in the form of a link or a button.</p>
</li>
<li>
<p><code>UIOutput</code>: Displays data output on a page.</p>
</li>
<li>
<p><code>UIPanel</code>: Manages the layout of its child components.</p>
</li>
<li>
<p><code>UIParameter</code>: Represents substitution parameters.</p>
</li>
<li>
<p><code>UISelectBoolean</code>: Allows a user to set a <code>boolean</code> value on a control by selecting or deselecting it.
This class is a subclass of the <code>UIInput</code> class.</p>
</li>
<li>
<p><code>UISelectItem</code>: Represents a single item in a set of items.</p>
</li>
<li>
<p><code>UISelectItems</code>: Represents an entire set of items.</p>
</li>
<li>
<p><code>UISelectMany</code>: Allows a user to select multiple items from a group of items.
This class is a subclass of the <code>UIInput</code> class.</p>
</li>
<li>
<p><code>UISelectOne</code>: Allows a user to select one item from a group of items.
This class is a subclass of the <code>UIInput</code> class.</p>
</li>
<li>
<p><code>UIViewParameter</code>: Represents the query parameters in a request.
This class is a subclass of the <code>UIInput</code> class.</p>
</li>
<li>
<p><code>UIViewRoot</code>: Represents the root of the component tree.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In addition to extending <code>UIComponentBase</code>, the component classes also implement one or more behavioral interfaces, each of which defines certain behavior for a set of components whose classes implement the interface.</p>
</div>
<div class="paragraph">
<p>These behavioral interfaces, all defined in the <code>jakarta.faces.component</code> package unless otherwise stated, are as follows.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ActionSource</code>: Indicates that the component can fire an action event.
This interface is intended for use with components based on JavaServer Faces technology 1.1_01 and earlier versions.
This interface is deprecated in JavaServer Faces 2.</p>
</li>
<li>
<p><code>ActionSource2</code>: Extends <code>ActionSource</code> and therefore provides the same functionality.
However, it allows components to use the Expression Language (EL) when they are referencing methods that handle action events.</p>
</li>
<li>
<p><code>EditableValueHolder</code>: Extends <code>ValueHolder</code> and specifies additional features for editable components, such as validation and emitting value-change events.</p>
</li>
<li>
<p><code>NamingContainer</code>: Mandates that each component rooted at this component have a unique ID.</p>
</li>
<li>
<p><code>StateHolder</code>: Denotes that a component has state that must be saved between requests.</p>
</li>
<li>
<p><code>ValueHolder</code>: Indicates that the component maintains a local value as well as the option of accessing data in the model tier.</p>
</li>
<li>
<p><code>jakarta.faces.event.SystemEventListenerHolder</code>: Maintains a list of <code>jakarta.faces.event.SystemEventListener</code> instances for each type of <code>jakarta.faces.event.SystemEvent</code> defined by that class.</p>
</li>
<li>
<p><code>jakarta.faces.component.behavior.ClientBehaviorHolder</code>: Adds the ability to attach <code>jakarta.faces.component.behavior.ClientBehavior</code> instances, such as a reusable script.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>UICommand</code> implements <code>ActionSource2</code> and <code>StateHolder</code>.
<code>UIOutput</code> and component classes that extend <code>UIOutput</code> implement <code>StateHolder</code> and <code>ValueHolder</code>.
<code>UIInput</code> and component classes that extend <code>UIInput</code> implement <code>EditableValueHolder</code>, <code>StateHolder</code>, and <code>ValueHolder</code>.
<code>UIComponentBase</code> implements <code>StateHolder</code>.</p>
</div>
<div class="paragraph">
<p>Only component writers will need to use the component classes and behavioral interfaces directly.
Page authors and application developers will use a standard component by including a tag that represents it on a page.
Most of the components can be rendered in different ways on a page.
For example, a <code>UICommand</code> component can be rendered as a button or a link.</p>
</div>
<div class="paragraph">
<p>The next section explains how the rendering model works and how page authors can choose to render the components by selecting the appropriate tags.</p>
</div>
</div>
<div class="sect3">
<h4 id="component-rendering-model"><a class="anchor" href="#component-rendering-model"></a>Component Rendering Model</h4>
<div class="paragraph">
<p>The Jakarta Faces component architecture is designed such that the functionality of the components is defined by the component classes, whereas the component rendering can be defined by a separate renderer class.
This design has several benefits, including the following.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Component writers can define the behavior of a component once but create multiple renderers, each of which defines a different way to render the component to the same client or to different clients.</p>
</li>
<li>
<p>Page authors and application developers can change the appearance of a component on the page by selecting the tag that represents the appropriate combination of component and renderer.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A render kit defines how component classes map to component tags that are appropriate for a particular client.
The Jakarta Faces implementation includes a standard HTML render kit for rendering to an HTML client.</p>
</div>
<div class="paragraph">
<p>The render kit defines a set of <code>jakarta.faces.render.Renderer</code> classes for each component that it supports.
Each <code>Renderer</code> class defines a different way to render the particular component to the output defined by the render kit.
For example, a <code>UISelectOne</code> component has three different renderers.
One of them renders the component as a group of options.
Another renders the component as a combo box.
The third one renders the component as a list box.
Similarly, a <code>UICommand</code> component can be rendered as a button or a link, using the <code>h:commandButton</code> or <code>h:commandLink</code> tag.
The <code>command</code> part of each tag corresponds to the <code>UICommand</code> class, specifying the functionality, which is to fire an action.
The <code>Button</code> or <code>Link</code> part of each tag corresponds to a separate <code>Renderer</code> class that defines how the component appears on the page.</p>
</div>
<div class="paragraph">
<p>Each custom tag defined in the standard HTML render kit is composed of the component functionality (defined in the <code>UIComponent</code> class) and the rendering attributes (defined by the <code>Renderer</code> class).</p>
</div>
<div class="paragraph">
<p>The section <a href="#adding-components-to-a-page-using-html-tag-library-tags">Adding Components to a Page Using HTML Tag Library Tags</a> lists all supported component tags and illustrates how to use the tags in an example.</p>
</div>
<div class="paragraph">
<p>The Jakarta Faces implementation provides a custom tag library for rendering components in HTML.</p>
</div>
</div>
<div class="sect3">
<h4 id="conversion-model"><a class="anchor" href="#conversion-model"></a>Conversion Model</h4>
<div class="paragraph">
<p>A Jakarta Faces application can optionally associate a component with server-side object data.
This object is a JavaBeans component, such as a managed bean.
An application gets and sets the object data for a component by calling the appropriate object properties for that component.</p>
</div>
<div class="paragraph">
<p>When a component is bound to an object, the application has two views of the component&#8217;s data.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The model view, in which data is represented as data types, such as <code>int</code> or <code>long</code>.</p>
</li>
<li>
<p>The presentation view, in which data is represented in a manner that can be read or modified by the user.
For example, a <code>java.util.Date</code> might be represented as a text string in the format <code>mm/dd/yy</code> or as a set of three text strings.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Jakarta Faces implementation automatically converts component data between these two views when the bean property associated with the component is of one of the types supported by the component&#8217;s data.
For example, if a <code>UISelectBoolean</code> component is associated with a bean property of type <code>java.lang.Boolean</code>, the Jakarta Faces implementation will automatically convert the component&#8217;s data from <code>String</code> to <code>Boolean</code>.
In addition, some component data must be bound to properties of a particular type.
For example, a <code>UISelectBoolean</code> component must be bound to a property of type <code>boolean</code> or <code>java.lang.Boolean</code>.</p>
</div>
<div class="paragraph">
<p>Sometimes you might want to convert a component&#8217;s data to a type other than a standard type, or you might want to convert the format of the data.
To facilitate this, Jakarta Faces technology allows you to register a <code>jakarta.faces.convert.Converter</code> implementation on <code>UIOutput</code> components and components whose classes subclass <code>UIOutput</code>.
If you register the <code>Converter</code> implementation on a component, the <code>Converter</code> implementation converts the component&#8217;s data between the two views.</p>
</div>
<div class="paragraph">
<p>You can either use the standard converters supplied with the Jakarta Faces implementation or create your own custom converter.
Custom converter creation is covered in <a href="#creating-custom-ui-components-and-other-custom-objects">Chapter 15, <em>Creating Custom UI Components and Other Custom Objects</em></a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="event-and-listener-model"><a class="anchor" href="#event-and-listener-model"></a>Event and Listener Model</h4>
<div class="paragraph">
<p>The Jakarta Faces event and listener model is similar to the JavaBeans event model in that it has strongly typed event classes and listener interfaces that an application can use to handle events generated by components.</p>
</div>
<div class="paragraph">
<p>The Jakarta Faces specification defines three types of events: application events, system events, and data-model events.</p>
</div>
<div class="paragraph">
<p>Application events are tied to a particular application and are generated by a <code>UIComponent</code>.
They represent the standard events available in previous versions of Jakarta Faces technology.</p>
</div>
<div class="paragraph">
<p>An event object identifies the component that generated the event and stores information about the event.
To be notified of an event, an application must provide an implementation of the listener class and must register it on the component that generates the event.
When the user activates a component, such as by clicking a button, an event is fired.
This causes the Jakarta Faces implementation to invoke the listener method that processes the event.</p>
</div>
<div class="paragraph">
<p>Jakarta Faces supports two kinds of application events: action events and value-change events.</p>
</div>
<div class="paragraph">
<p>An action event (class <code>jakarta.faces.event.ActionEvent</code>) occurs when the user activates a component that implements <code>ActionSource</code>.
These components include buttons and links.</p>
</div>
<div class="paragraph">
<p>A value-change event (class <code>jakarta.faces.event.ValueChangeEvent</code>) occurs when the user changes the value of a component represented by <code>UIInput</code> or one of its subclasses.
An example is selecting a check box, an action that results in the component&#8217;s value changing to <code>true</code>.
The component types that can generate these types of events are the <code>UIInput</code>, <code>UISelectOne</code>, <code>UISelectMany</code>, and <code>UISelectBoolean</code> components.
Value-change events are fired only if no validation errors are detected.</p>
</div>
<div class="paragraph">
<p>Depending on the value of the <code>immediate</code> property (see <a href="#the-immediate-attribute">The immediate Attribute</a>) of the component emitting the event, action events can be processed during the Invoke Application phase or the Apply Request Values phase, and value-change events can be processed during the Process Validations phase or the Apply Request Values phase.</p>
</div>
<div class="paragraph">
<p>System events are generated by an <code>Object</code> rather than a <code>UIComponent</code>.
They are generated during the execution of an application at predefined times.
They are applicable to the entire application rather than to a specific component.</p>
</div>
<div class="paragraph">
<p>A data-model event occurs when a new row of a <code>UIData</code> component is selected.</p>
</div>
<div class="paragraph">
<p>There are two ways to cause your application to react to action events or value-change events that are emitted by a standard component:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Implement an event listener class to handle the event, and register the listener on the component by nesting either an <code>f:valueChangeListener</code> tag or an <code>f:actionListener</code> tag inside the component tag.</p>
</li>
<li>
<p>Implement a method of a managed bean to handle the event, and refer to the method with a method expression from the appropriate attribute of the component&#8217;s tag.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See <a href="#implementing-an-event-listener">Implementing an Event Listener</a> for information on how to implement an event listener.
See <a href="#registering-listeners-on-components">Registering Listeners on Components</a> for information on how to register the listener on a component.</p>
</div>
<div class="paragraph">
<p>See <a href="#writing-a-method-to-handle-an-action-event">Writing a Method to Handle an Action Event</a> and <a href="#writing-a-method-to-handle-a-value-change-event">Writing a Method to Handle a Value-Change Event</a> for information on how to implement managed bean methods that handle these events.</p>
</div>
<div class="paragraph">
<p>See <a href="#referencing-a-managed-bean-method">Referencing a Managed Bean Method</a> for information on how to refer to the managed bean method from the component tag.</p>
</div>
<div class="paragraph">
<p>When emitting events from custom components, you must implement the appropriate event class and manually queue the event on the component in addition to implementing an event listener class or a managed bean method that handles the event.
<a href="#handling-events-for-custom-components">Handling Events for Custom Components</a> explains how to do this.</p>
</div>
</div>
<div class="sect3">
<h4 id="validation-model"><a class="anchor" href="#validation-model"></a>Validation Model</h4>
<div class="paragraph">
<p>Jakarta Faces technology supports a mechanism for validating the local data of editable components (such as text fields).
This validation occurs before the corresponding model data is updated to match the local value.</p>
</div>
<div class="paragraph">
<p>Like the conversion model, the validation model defines a set of standard classes for performing common data validation checks.
The Jakarta Faces core tag library also defines a set of tags that correspond to the standard <code>jakarta.faces.validator.Validator</code> implementations.
See <a href="#using-the-standard-validators">Using the Standard Validators</a> for a list of all the standard validation classes and corresponding tags.</p>
</div>
<div class="paragraph">
<p>Most of the tags have a set of attributes for configuring the validator&#8217;s properties, such as the minimum and maximum allowable values for the component&#8217;s data.
The page author registers the validator on a component by nesting the validator&#8217;s tag within the component&#8217;s tag.</p>
</div>
<div class="paragraph">
<p>In addition to validators that are registered on the component, you can declare a default validator that is registered on all <code>UIInput</code> components in the application.
For more information on default validators, see <a href="#using-default-validators">Using Default Validators</a>.</p>
</div>
<div class="paragraph">
<p>The validation model also allows you to create your own custom validator and corresponding tag to perform custom validation.
The validation model provides two ways to implement custom validation.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Implement a <code>Validator</code> interface that performs the validation.</p>
</li>
<li>
<p>Implement a managed bean method that performs the validation.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you are implementing a <code>Validator</code> interface, you must also do the following.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Register the <code>Validator</code> implementation with the application.</p>
</li>
<li>
<p>Create a custom tag or use an <code>f:validator</code> tag to register the validator on the component.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the previously described standard validation model, the validator is defined for each input component on a page.
The Bean Validation model allows the validator to be applied to all fields in a page.
See <a href="#introduction-to-jakarta-bean-validation">Chapter 23, <em>Introduction to Jakarta Bean Validation</em></a> and <a href="#bean-validation-advanced-topics">Chapter 24, <em>Bean Validation: Advanced Topics</em></a> for more information on Bean Validation.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="navigation-model"><a class="anchor" href="#navigation-model"></a>Navigation Model</h3>
<div class="paragraph">
<p>The Jakarta Faces navigation model makes it easy to define page navigation and to handle any additional processing that is needed to choose the sequence in which pages are loaded.</p>
</div>
<div class="paragraph">
<p>In Jakarta Faces technology, navigation is a set of rules for choosing the next page or view to be displayed after an application action, such as when a button or link is clicked.</p>
</div>
<div class="paragraph">
<p>Navigation can be implicit or user-defined.
Implicit navigation comes into play when user-defined navigation rules are not configured in the application configuration resource files.</p>
</div>
<div class="paragraph">
<p>When you add a component such as a <code>commandButton</code> to a Facelets page, and assign another page as the value for its <code>action</code> property, the default navigation handler will try to match a suitable page within the application implicitly.
In the following example, the default navigation handler will try to locate a page named <code>response.xhtml</code> within the application and navigate to it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:commandButton</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">submit</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">response</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>User-defined navigation rules are declared in zero or more application configuration resource files, such as <code>faces-config.xml</code>, by using a set of XML elements.
The default structure of a navigation rule is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;navigation-rule&gt;</span>
    <span class="tag">&lt;description&gt;</span><span class="tag">&lt;/description&gt;</span>
    <span class="tag">&lt;from-view-id&gt;</span><span class="tag">&lt;/from-view-id&gt;</span>
    <span class="tag">&lt;navigation-case&gt;</span>
        <span class="tag">&lt;from-action&gt;</span><span class="tag">&lt;/from-action&gt;</span>
        <span class="tag">&lt;from-outcome&gt;</span><span class="tag">&lt;/from-outcome&gt;</span>
        <span class="tag">&lt;if&gt;</span><span class="tag">&lt;/if&gt;</span>
        <span class="tag">&lt;to-view-id&gt;</span><span class="tag">&lt;/to-view-id&gt;</span>
    <span class="tag">&lt;/navigation-case&gt;</span>
<span class="tag">&lt;/navigation-rule&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>User-defined navigation is handled as follows.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Define the rules in the application configuration resource file.</p>
</li>
<li>
<p>Refer to an outcome <code>String</code> from the button or link component&#8217;s <code>action</code> attribute.
This outcome <code>String</code> is used by the Jakarta Faces implementation to select the navigation rule.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Here is an example navigation rule:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;navigation-rule&gt;</span>
    <span class="tag">&lt;from-view-id&gt;</span>/greeting.xhtml<span class="tag">&lt;/from-view-id&gt;</span>
    <span class="tag">&lt;navigation-case&gt;</span>
        <span class="tag">&lt;from-outcome&gt;</span>success<span class="tag">&lt;/from-outcome&gt;</span>
        <span class="tag">&lt;to-view-id&gt;</span>/response.xhtml<span class="tag">&lt;/to-view-id&gt;</span>
    <span class="tag">&lt;/navigation-case&gt;</span>
<span class="tag">&lt;/navigation-rule&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This rule states that when a command component (such as an <code>h:commandButton</code> or an <code>h:commandLink</code>) on <code>greeting.xhtml</code> is activated, the application will navigate from the <code>greeting.xhtml</code> page to the <code>response.xhtml</code> page if the outcome referenced by the button component&#8217;s tag is <code>success</code>.
Here is an <code>h:commandButton</code> tag from <code>greeting.xhtml</code> that would specify a logical outcome of <code>success</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:commandButton</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">submit</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Submit</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">success</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As the example demonstrates, each <code>navigation-rule</code> element defines how to get from one page (specified in the <code>from-view-id</code> element) to the other pages of the application.
The <code>navigation-rule</code> elements can contain any number of <code>navigation-case</code> elements, each of which defines the page to open next (defined by <code>to-view-id</code>) based on a logical outcome (defined by <code>from-outcome</code>).</p>
</div>
<div class="paragraph">
<p>In more complicated applications, the logical outcome can also come from the return value of an action method in a managed bean.
This method performs some processing to determine the outcome.
For example, the method can check whether the password the user entered on the page matches the one on file.
If it does, the method might return <code>success</code>; otherwise, it might return <code>failure</code>.
An outcome of <code>failure</code> might result in the logon page being reloaded.
An outcome of <code>success</code> might cause the page displaying the user&#8217;s credit card activity to open.
If you want the outcome to be returned by a method on a bean, you must refer to the method using a method expression with the <code>action</code> attribute, as shown by this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:commandButton</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">submit</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Submit</span><span class="delimiter">&quot;</span></span>
                 <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{cashierBean.submit}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When the user clicks the button represented by this tag, the corresponding component generates an action event.
This event is handled by the default <code>jakarta.faces.event.ActionListener</code> instance, which calls the action method referenced by the component that triggered the event.
The action method returns a logical outcome to the action listener.</p>
</div>
<div class="paragraph">
<p>The listener passes the logical outcome and a reference to the action method that produced the outcome to the default <code>jakarta.faces.application.NavigationHandler</code>.
The <code>NavigationHandler</code> selects the page to display next by matching the outcome or the action method reference against the navigation rules in the application configuration resource file by the following process.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The <code>NavigationHandler</code> selects the navigation rule that matches the page currently displayed.</p>
</li>
<li>
<p>It matches the outcome or the action method reference that it received from the default <code>jakarta.faces.event.ActionListener</code> with those defined by the navigation cases.</p>
</li>
<li>
<p>It tries to match both the method reference and the outcome against the same navigation case.</p>
</li>
<li>
<p>If the previous step fails, the navigation handler attempts to match the outcome.</p>
</li>
<li>
<p>Finally, the navigation handler attempts to match the action method reference if the previous two attempts failed.</p>
</li>
<li>
<p>If no navigation case is matched, it displays the same view again.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>When the <code>NavigationHandler</code> achieves a match, the Render Response phase begins.
During this phase, the page selected by the <code>NavigationHandler</code> will be rendered.</p>
</div>
<div class="paragraph">
<p>The Duke&#8217;s Tutoring case study example application uses navigation rules in the business methods that handle creating, editing, and deleting the users of the application.
For example, the form for creating a student has the following <code>h:commandButton</code> tag:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:commandButton</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">submit</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{adminBean.createStudent(studentManager.newStudent)}</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{bundle['action.submit']}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The action event calls the <code>dukestutoring.ejb.AdminBean.createStudent</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="predefined-type">String</span> createStudent(Student student) {
    em.persist(student);
    <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">createdStudent</span><span class="delimiter">&quot;</span></span>;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The return value of <code>createdStudent</code> has a corresponding navigation case in the <code>faces-config.xml</code> configuration file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;navigation-rule&gt;</span>
    <span class="tag">&lt;from-view-id&gt;</span>/admin/student/createStudent.xhtml<span class="tag">&lt;/from-view-id&gt;</span>
    <span class="tag">&lt;navigation-case&gt;</span>
        <span class="tag">&lt;from-outcome&gt;</span>createdStudent<span class="tag">&lt;/from-outcome&gt;</span>
        <span class="tag">&lt;to-view-id&gt;</span>/admin/index.xhtml<span class="tag">&lt;/to-view-id&gt;</span>
    <span class="tag">&lt;/navigation-case&gt;</span>
<span class="tag">&lt;/navigation-rule&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>After the student is created, the user is returned to the Administration index page.</p>
</div>
<div class="paragraph">
<p>For more information on how to define navigation rules, see <a href="#configuring-navigation-rules">Configuring Navigation Rules</a>.</p>
</div>
<div class="paragraph">
<p>For more information on how to implement action methods to handle navigation, see <a href="#writing-a-method-to-handle-an-action-event">Writing a Method to Handle an Action Event</a>.</p>
</div>
<div class="paragraph">
<p>For more information on how to reference outcomes or action methods from component tags, see <a href="#referencing-a-method-that-performs-navigation">Referencing a Method That Performs Navigation</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="the-lifecycle-of-a-jakarta-faces-application"><a class="anchor" href="#the-lifecycle-of-a-jakarta-faces-application"></a>The Lifecycle of a Jakarta Faces Application</h3>
<div class="paragraph">
<p>The lifecycle of an application refers to the various stages of processing of that application, from its initiation to its conclusion.
All applications have lifecycles.
During a web application lifecycle, common tasks are performed, including the following.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Handling incoming requests</p>
</li>
<li>
<p>Decoding parameters</p>
</li>
<li>
<p>Modifying and saving state</p>
</li>
<li>
<p>Rendering web pages to the browser</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Jakarta Faces web application framework manages lifecycle phases automatically for simple applications or allows you to manage them manually for more complex applications as required.</p>
</div>
<div class="paragraph">
<p>Jakarta Faces applications that use advanced features may require interaction with the lifecycle at certain phases.
For example, Ajax applications use partial processing features of the lifecycle (see <a href="#partial-processing-and-partial-rendering">Partial Processing and Partial Rendering</a>).
A clearer understanding of the lifecycle phases is key to creating well-designed components.</p>
</div>
<div class="paragraph">
<p>A simplified view of the Jakarta Faces lifecycle, consisting of the two main phases of a Jakarta Faces web application, is introduced in <a href="#a-simple-jakarta-faces-application">A Simple Jakarta Faces Application</a>.
This section examines the Jakarta Faces lifecycle in more detail.</p>
</div>
<div class="sect3">
<h4 id="overview-of-the-jakarta-faces-lifecycle"><a class="anchor" href="#overview-of-the-jakarta-faces-lifecycle"></a>Overview of the Jakarta Faces Lifecycle</h4>
<div class="paragraph">
<p>The lifecycle of a Jakarta Faces application begins when the client makes an HTTP request for a page and ends when the server responds with the page, translated to HTML.</p>
</div>
<div class="paragraph">
<p>The lifecycle can be divided into two main phases: Execute and Render.
The Execute phase is further divided into subphases to support the sophisticated component tree.
This structure requires that component data be converted and validated, component events be handled, and component data be propagated to beans in an orderly fashion.</p>
</div>
<div class="paragraph">
<p>A Jakarta Faces page is represented by a tree of components, called a view.
During the lifecycle, the Jakarta Faces implementation must build the view while considering the state saved from a previous submission of the page.
When the client requests a page, the Jakarta Faces implementation performs several tasks, such as validating the data input of components in the view and converting input data to types specified on the server side.</p>
</div>
<div class="paragraph">
<p>The Jakarta Faces implementation performs all these tasks as a series of steps in the Jakarta Faces request-response lifecycle.
<a href="#jakarta-faces-standard-request-response-lifecycle">Figure 7-3</a> illustrates these steps.</p>
</div>
<div id="jakarta-faces-standard-request-response-lifecycle" class="imageblock">
<div class="content">
<img src="images/jakartaeett_dt_016.svg" alt="Flow diagram of Faces request and Faces response, including event and validation processing, error handling, model updating, application invocation.">
</div>
<div class="title">Figure 7-3 Jakarta Faces Standard Request-Response Lifecycle</div>
</div>
<div class="paragraph">
<p>The request-response lifecycle handles two kinds of requests: initial requests and postbacks.
An initial request occurs when a user makes a request for a page for the first time.
A postback request occurs when a user submits the form contained on a page that was previously loaded into the browser as a result of executing an initial request.</p>
</div>
<div class="paragraph">
<p>When the lifecycle handles an initial request, it executes only the Restore View and Render Response phases, because there is no user input or action to process.
Conversely, when the lifecycle handles a postback, it executes all of the phases.</p>
</div>
<div class="paragraph">
<p>Usually, the first request for a Jakarta Faces page comes in from a client, as a result of clicking a link or button component on a Jakarta Faces page.
To render a response that is another Jakarta Faces page, the application creates a new view and stores it in the <code>jakarta.faces.context.FacesContext</code> instance, which represents all of the information associated with processing an incoming request and creating a response.
The application then acquires object references needed by the view and calls the <code>FacesContext.renderResponse</code> method, which forces immediate rendering of the view by skipping to the <a href="#render-response-phase">Render Response Phase</a> of the lifecycle, as is shown by the arrows labelled Render Response in <a href="#jakarta-faces-standard-request-response-lifecycle">Figure 7-3</a>.</p>
</div>
<div class="paragraph">
<p>Sometimes, an application might need to redirect to a different web application resource, such as a web service, or generate a response that does not contain Jakarta Faces components.
In these situations, the developer must skip the Render Response phase by calling the <code>FacesContext.responseComplete</code> method.
This situation is also shown in , with the arrows labelled Response Complete.</p>
</div>
<div class="paragraph">
<p>The most common situation is that a Jakarta Faces component submits a request for another Jakarta Faces page.
In this case, the Jakarta Faces implementation handles the request and automatically goes through the phases in the lifecycle to perform any necessary conversions, validations, and model updates and to generate the response.</p>
</div>
<div class="paragraph">
<p>There is one exception to the lifecycle described in this section.
When a component&#8217;s <code>immediate</code> attribute is set to <code>true</code>, the validation, conversion, and events associated with these components are processed during the <a href="#apply-request-values-phase">Apply Request Values Phase</a> rather than in a later phase.</p>
</div>
<div class="paragraph">
<p>The details of the lifecycle explained in the following sections are primarily intended for developers who need to know information such as when validations, conversions, and events are usually handled and ways to change how and when they are handled.
For more information on each of the lifecycle phases, download the latest Jakarta Faces Specification documentation from <a href="https://jakarta.ee/specifications/faces/" class="bare" target="_blank" rel="noopener">https://jakarta.ee/specifications/faces/</a>.</p>
</div>
<div class="paragraph">
<p>The Jakarta Faces application lifecycle Execute phase contains the following subphases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#restore-view-phase">Restore View Phase</a></p>
</li>
<li>
<p><a href="#apply-request-values-phase">Apply Request Values Phase</a></p>
</li>
<li>
<p><a href="#process-validations-phase">Process Validations Phase</a></p>
</li>
<li>
<p><a href="#update-model-values-phase">Update Model Values Phase</a></p>
</li>
<li>
<p><a href="#invoke-application-phase">Invoke Application Phase</a></p>
</li>
<li>
<p><a href="#render-response-phase">Render Response Phase</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="restore-view-phase"><a class="anchor" href="#restore-view-phase"></a>Restore View Phase</h4>
<div class="paragraph">
<p>When a request for a Jakarta Faces page is made, usually by an action, such as when a link or a button component is clicked, the Jakarta Faces implementation begins the Restore View phase.</p>
</div>
<div class="paragraph">
<p>During this phase, the Jakarta Faces implementation builds the view of the page, wires event handlers and validators to components in the view, and saves the view in the <code>FacesContext</code> instance, which contains all the information needed to process a single request.
All the application&#8217;s components, event handlers, converters, and validators have access to the <code>FacesContext</code> instance.</p>
</div>
<div class="paragraph">
<p>If the request for the page is an initial request, the Jakarta Faces implementation creates an empty view during this phase and the lifecycle advances to the Render Response phase, during which the empty view is populated with the components referenced by the tags in the page.</p>
</div>
<div class="paragraph">
<p>If the request for the page is a postback, a view corresponding to this page already exists in the <code>FacesContext</code> instance.
During this phase, the Jakarta Faces implementation restores the view by using the state information saved on the client or the server.</p>
</div>
</div>
<div class="sect3">
<h4 id="apply-request-values-phase"><a class="anchor" href="#apply-request-values-phase"></a>Apply Request Values Phase</h4>
<div class="paragraph">
<p>After the component tree is restored during a postback request, each component in the tree extracts its new value from the request parameters by using its <code>decode</code> (<code>processDecodes()</code>) method.
The value is then stored locally on each component.</p>
</div>
<div class="paragraph">
<p>If any <code>decode</code> methods or event listeners have called the <code>renderResponse</code> method on the current <code>FacesContext</code> instance, the Jakarta Faces implementation skips to the Render Response phase.</p>
</div>
<div class="paragraph">
<p>If any events have been queued during this phase, the Jakarta Faces implementation broadcasts the events to interested listeners.</p>
</div>
<div class="paragraph">
<p>If some components on the page have their <code>immediate</code> attributes (see <a href="#the-immediate-attribute">The immediate Attribute</a>) set to <code>true</code>, then the validations, conversions, and events associated with these components will be processed during this phase.
If any conversion fails, an error message associated with the component is generated and queued on <code>FacesContext</code>.
This message will be displayed during the Render Response phase, along with any validation errors resulting from the Process Validations phase.</p>
</div>
<div class="paragraph">
<p>At this point, if the application needs to redirect to a different web application resource or generate a response that does not contain any Jakarta Faces components, it can call the <code>FacesContext.responseComplete</code> method.</p>
</div>
<div class="paragraph">
<p>At the end of this phase, the components are set to their new values, and messages and events have been queued.</p>
</div>
<div class="paragraph">
<p>If the current request is identified as a partial request, the partial context is retrieved from the <code>FacesContext</code>, and the partial processing method is applied.</p>
</div>
</div>
<div class="sect3">
<h4 id="process-validations-phase"><a class="anchor" href="#process-validations-phase"></a>Process Validations Phase</h4>
<div class="paragraph">
<p>During this phase, the Jakarta Faces implementation processes all validators registered on the components in the tree by using its <code>validate</code> (<code>processValidators</code>) method.
It examines the component attributes that specify the rules for the validation and compares these rules to the local value stored for the component.
The Jakarta Faces implementation also completes conversions for input components that do not have the <code>immediate</code> attribute set to true.</p>
</div>
<div class="paragraph">
<p>If the local value is invalid, or if any conversion fails, the Jakarta Faces implementation adds an error message to the <code>FacesContext</code> instance, and the lifecycle advances directly to the Render Response phase so that the page is rendered again with the error messages displayed.
If there were conversion errors from the Apply Request Values phase, the messages for these errors are also displayed.</p>
</div>
<div class="paragraph">
<p>If any <code>validate</code> methods or event listeners have called the <code>renderResponse</code> method on the current <code>FacesContext</code>, the Jakarta Faces implementation skips to the Render Response phase.</p>
</div>
<div class="paragraph">
<p>At this point, if the application needs to redirect to a different web application resource or generate a response that does not contain any Jakarta Faces components, it can call the <code>FacesContext.responseComplete</code> method.</p>
</div>
<div class="paragraph">
<p>If events have been queued during this phase, the Jakarta Faces implementation broadcasts them to interested listeners.</p>
</div>
<div class="paragraph">
<p>If the current request is identified as a partial request, the partial context is retrieved from the <code>FacesContext</code>, and the partial processing method is applied.</p>
</div>
</div>
<div class="sect3">
<h4 id="update-model-values-phase"><a class="anchor" href="#update-model-values-phase"></a>Update Model Values Phase</h4>
<div class="paragraph">
<p>After the Jakarta Faces implementation determines that the data is valid, it traverses the component tree and sets the corresponding server-side object properties to the components' local values.
The Jakarta Faces implementation updates only the bean properties pointed at by an input component&#8217;s <code>value</code> attribute.
If the local data cannot be converted to the types specified by the bean properties, the lifecycle advances directly to the Render Response phase so that the page is re-rendered with errors displayed.
This is similar to what happens with validation errors.</p>
</div>
<div class="paragraph">
<p>If any <code>updateModels</code> methods or any listeners have called the <code>renderResponse</code> method on the current <code>FacesContext</code> instance, the Jakarta Faces implementation skips to the Render Response phase.</p>
</div>
<div class="paragraph">
<p>At this point, if the application needs to redirect to a different web application resource or generate a response that does not contain any Jakarta Faces components, it can call the <code>FacesContext.responseComplete</code> method.</p>
</div>
<div class="paragraph">
<p>If any events have been queued during this phase, the Jakarta Faces implementation broadcasts them to interested listeners.</p>
</div>
<div class="paragraph">
<p>If the current request is identified as a partial request, the partial context is retrieved from the <code>FacesContext</code>, and the partial processing method is applied.</p>
</div>
</div>
<div class="sect3">
<h4 id="invoke-application-phase"><a class="anchor" href="#invoke-application-phase"></a>Invoke Application Phase</h4>
<div class="paragraph">
<p>During this phase, the Jakarta Faces implementation handles any application-level events, such as submitting a form or linking to another page.</p>
</div>
<div class="paragraph">
<p>At this point, if the application needs to redirect to a different web application resource or generate a response that does not contain any Jakarta Faces components, it can call the <code>FacesContext.responseComplete</code> method.</p>
</div>
<div class="paragraph">
<p>If the view being processed was reconstructed from state information from a previous request and if a component has fired an event, these events are broadcast to interested listeners.</p>
</div>
<div class="paragraph">
<p>Finally, the Jakarta Faces implementation transfers control to the Render Response phase.</p>
</div>
</div>
<div class="sect3">
<h4 id="render-response-phase"><a class="anchor" href="#render-response-phase"></a>Render Response Phase</h4>
<div class="paragraph">
<p>During this phase, Jakarta Faces builds the view and delegates authority to the appropriate resource for rendering the pages.</p>
</div>
<div class="paragraph">
<p>If this is an initial request, the components that are represented on the page will be added to the component tree.
If this is not an initial request, the components are already added to the tree and need not be added again.</p>
</div>
<div class="paragraph">
<p>If the request is a postback and errors were encountered during the Apply Request Values phase, Process Validations phase, or Update Model Values phase, the original page is rendered again during this phase.
If the pages contain <code>h:message</code> or <code>h:messages</code> tags, any queued error messages are displayed on the page.</p>
</div>
<div class="paragraph">
<p>After the content of the view is rendered, the state of the response is saved so that subsequent requests can access it.
The saved state is available to the Restore View phase.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="partial-processing-and-partial-rendering"><a class="anchor" href="#partial-processing-and-partial-rendering"></a>Partial Processing and Partial Rendering</h3>
<div class="paragraph">
<p>The Jakarta Faces lifecycle spans all of the execute and render processes of an application.
It is also possible to process and render only parts of an application, such as a single component.
For example, the Jakarta Faces Ajax framework can generate requests containing information on which particular component may be processed and which particular component may be rendered back to the client.</p>
</div>
<div class="paragraph">
<p>Once such a partial request enters the Jakarta Faces lifecycle, the information is identified and processed by a <code>jakarta.faces.context.PartialViewContext</code> object.
The Jakarta Faces lifecycle is still aware of such Ajax requests and modifies the component tree accordingly.</p>
</div>
<div class="paragraph">
<p>The <code>execute</code> and <code>render</code> attributes of the <code>f:ajax</code> tag are used to identify which components may be executed and rendered.
For more information on these attributes, see <a href="#using-ajax-with-jakarta-faces-technology">Chapter 13, <em>Using Ajax with Jakarta Faces Technology</em></a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="further-information-about-jakarta-faces-technology"><a class="anchor" href="#further-information-about-jakarta-faces-technology"></a>Further Information about Jakarta Faces Technology</h3>
<div class="paragraph">
<p>For more information on Jakarta Faces technology, see</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Jakarta Faces 3.0 specification:<br>
<a href="https://jakarta.ee/specifications/faces/3.0/" class="bare" target="_blank" rel="noopener">https://jakarta.ee/specifications/faces/3.0/</a></p>
</li>
<li>
<p>Mojarra website:<br>
<a href="https://eclipse-ee4j.github.io/mojarra/" class="bare" target="_blank" rel="noopener">https://eclipse-ee4j.github.io/mojarra/</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For additional samples, see the GlassFish samples at <a href="https://github.com/eclipse-ee4j/glassfish-samples/tree/master/ws/jakartaee9" class="bare" target="_blank" rel="noopener">https://github.com/eclipse-ee4j/glassfish-samples/tree/master/ws/jakartaee9</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="introduction-to-facelets"><a class="anchor" href="#introduction-to-facelets"></a>Chapter 8. Introduction to Facelets</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The term Facelets refers to the view declaration language for Jakarta Faces technology.
Facelets is a part of the Jakarta Faces specification and also the preferred presentation technology for building Jakarta Faces technologybased applications.
Jakarta Server Pages technology, previously used as the presentation technology for Jakarta Faces, does not support all the new features available in Jakarta Faces in the Jakarta EE platform.
Jakarta Server Pages technology is considered to be a deprecated presentation technology for Jakarta Faces.</p>
</div>
<div class="sect2">
<h3 id="what-is-facelets"><a class="anchor" href="#what-is-facelets"></a>What Is Facelets?</h3>
<div class="paragraph">
<p>Facelets is a powerful but lightweight page declaration language that is used to build Jakarta Faces views using HTML style templates and to build component trees.
Facelets features include the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use of XHTML for creating web pages</p>
</li>
<li>
<p>Support for Facelets tag libraries in addition to Jakarta Faces and JSTL tag libraries</p>
</li>
<li>
<p>Support for the Expression Language (EL)</p>
</li>
<li>
<p>Templating for components and pages</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The advantages of Facelets for large-scale development projects include the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Support for code reuse through templating and composite components</p>
</li>
<li>
<p>Functional extensibility of components and other server-side objects through customization</p>
</li>
<li>
<p>Faster compilation time</p>
</li>
<li>
<p>Compile-time EL validation</p>
</li>
<li>
<p>High-performance rendering</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In short, the use of Facelets reduces the time and effort that needs to be spent on development and deployment.</p>
</div>
<div class="paragraph">
<p>Facelets views are usually created as XHTML pages.
Jakarta Faces implementations support XHTML pages created in conformance with the XHTML Transitional Document Type Definition (DTD), as listed at <a href="https://www.w3.org/TR/xhtml1/#a_dtd_XHTML-1.0-Transitional" class="bare" target="_blank" rel="noopener">https://www.w3.org/TR/xhtml1/#a_dtd_XHTML-1.0-Transitional</a>.
By convention, web pages built with XHTML have an <code>.xhtml</code> extension.</p>
</div>
<div class="paragraph">
<p>Jakarta Faces technology supports various tag libraries to add components to a web page.
To support the Jakarta Faces tag library mechanism, Facelets uses XML namespace declarations.
<a href="#tag-libraries-supported-by-facelets">Table 8-1</a> lists the tag libraries supported by Facelets.</p>
</div>
<table id="tag-libraries-supported-by-facelets" class="tableblock frame-all grid-all" style="width: 99%;">
<caption class="title">Table 8-1 Tag Libraries Supported by Facelets</caption>
<colgroup>
<col style="width: 26.3157%;">
<col style="width: 26.3157%;">
<col style="width: 10.5263%;">
<col style="width: 15.7894%;">
<col style="width: 21.0529%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Tag Library</th>
<th class="tableblock halign-left valign-top">URI</th>
<th class="tableblock halign-left valign-top">Prefix</th>
<th class="tableblock halign-left valign-top">Example</th>
<th class="tableblock halign-left valign-top">Contents</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jakarta Faces Facelets Tag Library</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">http://xmlns.jcp.org/jsf/facelets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ui:</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ui:component</code></p>
<p class="tableblock"><code>ui:insert</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tags for templating</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jakarta Faces HTML Tag Library</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">http://xmlns.jcp.org/jsf/html</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>h:</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>h:head</code></p>
<p class="tableblock"><code>h:body</code></p>
<p class="tableblock"><code>h:outputText</code></p>
<p class="tableblock"><code>h:inputText</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jakarta Faces component tags for all <code>UIComponent</code> objects</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jakarta Faces Core Tag Library</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">http://xmlns.jcp.org/jsf/core</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>f:</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>f:actionListener</code></p>
<p class="tableblock"><code>f:attribute</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tags for Jakarta Faces custom actions that are independent of any particular render kit</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pass-through Elements Tag Library</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">http://xmlns.jcp.org/jsf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jsf:</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jsf:id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tags to support HTML5-friendly markup</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pass-through Attributes Tag Library</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">http://xmlns.jcp.org/jsf/passthrough</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>p:</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>p:type</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tags to support HTML5-friendly markup</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Composite Component Tag Library</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">http://xmlns.jcp.org/jsf/composite</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cc:</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cc:interface</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tags to support composite components</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JSTL Core Tag Library</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">http://xmlns.jcp.org/jsp/jstl/core</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>c:</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>c:forEach</code></p>
<p class="tableblock"><code>c:catch</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JSTL 1.2 Core Tags</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JSTL Functions Tag Library</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">http://xmlns.jcp.org/jsp/jstl/functions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fn:</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fn:toUpperCase</code></p>
<p class="tableblock"><code>fn:toLowerCase</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JSTL 1.2 Functions Tags</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Facelets provides two namespaces to support HTML5-friendly markup.
For details, see <a href="#html5-friendly-markup">HTML5-Friendly Markup</a>.</p>
</div>
<div class="paragraph">
<p>Facelets supports tags for composite components, for which you can declare custom prefixes.
For more information on composite components, see <a href="#composite-components">Composite Components</a>.</p>
</div>
<div class="paragraph">
<p>The namespace prefixes shown in the table are conventional, not mandatory.
As is always the case when you declare an XML namespace, you can specify any prefix in your Facelets page.
For example, you can declare the prefix for the composite component tag library as</p>
</div>
<div class="listingblock">
<div class="content">
<pre>xmlns:composite="http://xmlns.jcp.org/jsf/composite"</pre>
</div>
</div>
<div class="paragraph">
<p>instead of as</p>
</div>
<div class="listingblock">
<div class="content">
<pre>xmlns:cc="http://xmlns.jcp.org/jsf/composite"</pre>
</div>
</div>
<div class="paragraph">
<p>Based on the Jakarta Faces support for Expression Language (EL) syntax, Facelets uses EL expressions to reference properties and methods of managed beans.
EL expressions can be used to bind component objects or values to methods or properties of managed beans that are used as backing beans.
For more information on using EL expressions, see <a href="#using-the-el-to-reference-managed-beans">Using the EL to Reference Managed Beans</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="the-lifecycle-of-a-facelets-application"><a class="anchor" href="#the-lifecycle-of-a-facelets-application"></a>The Lifecycle of a Facelets Application</h3>
<div class="paragraph">
<p>The Jakarta Faces specification defines the lifecycle of a Jakarta Faces application.
For more information on this lifecycle, see <a href="#the-lifecycle-of-a-jakarta-faces-application">The Lifecycle of a Jakarta Faces Application</a>.
The following steps describe that process as applied to a Facelets-based application.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>When a client, such as a browser, makes a new request to a page that is created using Facelets, a new component tree or <code>jakarta.faces.component.UIViewRoot</code> is created and placed in the <code>FacesContext</code>.</p>
</li>
<li>
<p><a id="step-2-of-lifecycle-of-facelets"></a> The <code>UIViewRoot</code> is applied to the Facelets, and the view is populated with components for rendering.</p>
</li>
<li>
<p>The newly built view is rendered back as a response to the client.</p>
</li>
<li>
<p>On rendering, the state of this view is stored for the next request.
The state of input components and form data is stored.</p>
</li>
<li>
<p>The client may interact with the view and request another view or change from the Jakarta Faces application.
At this time, the saved view is restored from the stored state.</p>
</li>
<li>
<p>The restored view is once again passed through the Jakarta Faces lifecycle, which eventually will either generate a new view or re-render the current view if there were no validation problems and no action was triggered.</p>
</li>
<li>
<p>If the same view is requested, the stored view is rendered once again.</p>
</li>
<li>
<p>If a new view is requested, then the process described in <a href="#step-2-of-lifecycle-of-facelets">Step 2</a> is continued.</p>
</li>
<li>
<p>The new view is then rendered back as a response to the client.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="developing-a-simple-facelets-application-the-guessnumber-jsf-example-application"><a class="anchor" href="#developing-a-simple-facelets-application-the-guessnumber-jsf-example-application"></a>Developing a Simple Facelets Application: The guessnumber-jsf Example Application</h3>
<div class="paragraph">
<p>This section describes the general steps involved in developing a Jakarta Faces application.
The following tasks are usually required:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Developing the managed beans</p>
</li>
<li>
<p>Creating the pages using the component tags</p>
</li>
<li>
<p>Defining page navigation</p>
</li>
<li>
<p>Mapping the <code>FacesServlet</code> instance</p>
</li>
<li>
<p>Adding managed bean declarations</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="creating-a-facelets-application"><a class="anchor" href="#creating-a-facelets-application"></a>Creating a Facelets Application</h4>
<div class="paragraph">
<p>The example used in this tutorial is the <code>guessnumber-jsf</code> application.
The application presents you with a page that asks you to guess a number from 0 to 10, validates your input against a random number, and responds with another page that informs you whether you guessed the number correctly or incorrectly.</p>
</div>
<div class="paragraph">
<p>The source code for this application is in the <code><em>tut-install</em>/examples/web/jsf/guessnumber-jsf/</code> directory.</p>
</div>
<div class="sect4">
<h5 id="developing-a-managed-bean"><a class="anchor" href="#developing-a-managed-bean"></a>Developing a Managed Bean</h5>
<div class="paragraph">
<p>In a typical Jakarta Faces application, each page of the application connects to a managed bean that serves as a backing bean.
The backing bean defines the methods and properties that are associated with the components.
In this example, both pages use the same backing bean.</p>
</div>
<div class="paragraph">
<p>The following managed bean class, <code>UserNumberBean.java</code>, generates a random number from 0 to 10 inclusive:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">ee.jakarta.tutorial.guessnumber</span>;

<span class="keyword">import</span> <span class="include">java.io.Serializable</span>;
<span class="keyword">import</span> <span class="include">java.util.Random</span>;
<span class="keyword">import</span> <span class="include">jakarta.enterprise.context.SessionScoped</span>;
<span class="keyword">import</span> <span class="include">jakarta.inject.Named</span>;

<span class="annotation">@Named</span>
<span class="annotation">@SessionScoped</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">UserNumberBean</span> <span class="directive">implements</span> <span class="predefined-type">Serializable</span> {

    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="type">long</span> serialVersionUID = <span class="integer">5443351151396868724L</span>;
    <span class="predefined-type">Integer</span> randomInt = <span class="predefined-constant">null</span>;
    <span class="predefined-type">Integer</span> userNumber = <span class="predefined-constant">null</span>;
    <span class="predefined-type">String</span> response = <span class="predefined-constant">null</span>;
    <span class="directive">private</span> <span class="type">int</span> maximum = <span class="integer">10</span>;
    <span class="directive">private</span> <span class="type">int</span> minimum = <span class="integer">0</span>;

    <span class="directive">public</span> UserNumberBean() {
        <span class="predefined-type">Random</span> randomGR = <span class="keyword">new</span> <span class="predefined-type">Random</span>();
        randomInt = <span class="keyword">new</span> <span class="predefined-type">Integer</span>(randomGR.nextInt(maximum + <span class="integer">1</span>));
        <span class="comment">// Print number to server log</span>
        <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Duke's number: </span><span class="delimiter">&quot;</span></span> + randomInt);
    }

    <span class="directive">public</span> <span class="type">void</span> setUserNumber(<span class="predefined-type">Integer</span> user_number) {
        userNumber = user_number;
    }

    <span class="directive">public</span> <span class="predefined-type">Integer</span> getUserNumber() {
        <span class="keyword">return</span> userNumber;
    }

    <span class="directive">public</span> <span class="predefined-type">String</span> getResponse() {
        <span class="keyword">if</span> ((userNumber == <span class="predefined-constant">null</span>) || (userNumber.compareTo(randomInt) != <span class="integer">0</span>)) {
            <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Sorry, </span><span class="delimiter">&quot;</span></span> + userNumber + <span class="string"><span class="delimiter">&quot;</span><span class="content"> is incorrect.</span><span class="delimiter">&quot;</span></span>;
        } <span class="keyword">else</span> {
            <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Yay! You got it!</span><span class="delimiter">&quot;</span></span>;
        }
    }

    <span class="directive">public</span> <span class="type">int</span> getMaximum() {
        <span class="keyword">return</span> (<span class="local-variable">this</span>.maximum);
    }

    <span class="directive">public</span> <span class="type">void</span> setMaximum(<span class="type">int</span> maximum) {
        <span class="local-variable">this</span>.maximum = maximum;
    }

    <span class="directive">public</span> <span class="type">int</span> getMinimum() {
        <span class="keyword">return</span> (<span class="local-variable">this</span>.minimum);
    }

    <span class="directive">public</span> <span class="type">void</span> setMinimum(<span class="type">int</span> minimum) {
        <span class="local-variable">this</span>.minimum = minimum;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note the use of the <code>@Named</code> annotation, which makes the managed bean accessible through the EL.
The <code>@SessionScoped</code> annotation registers the bean scope as <code>session</code> to enable you to make multiple guesses as you run the application.</p>
</div>
</div>
<div class="sect4">
<h5 id="creating-facelets-views"><a class="anchor" href="#creating-facelets-views"></a>Creating Facelets Views</h5>
<div class="paragraph">
<p>To create a page or view, you add components to the pages, wire the components to backing bean values and properties, and register converters, validators, or listeners on the components.</p>
</div>
<div class="paragraph">
<p>For the example application, XHTML web pages serve as the front end.
The first page of the example application is a page called <code>greeting.xhtml</code>.
A closer look at various sections of this web page provides more information.</p>
</div>
<div class="paragraph">
<p>The first section of the web page declares the content type for the page, which is XHTML:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="doctype">&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;
  &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The next section specifies the language of the XHTML page and then declares the XML namespace for the tag libraries that are used in the web page:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;html</span> <span class="attribute-name">lang</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/1999/xhtml</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xmlns:h</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://xmlns.jcp.org/jsf/html</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xmlns:f</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://xmlns.jcp.org/jsf/core</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The next section uses various tags to insert components into the web page:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">    <span class="tag">&lt;h:head&gt;</span>
        <span class="tag">&lt;h:outputStylesheet</span> <span class="attribute-name">library</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">css</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default.css</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;title&gt;</span>Guess Number Facelets Application<span class="tag">&lt;/title&gt;</span>
    <span class="tag">&lt;/h:head&gt;</span>
    <span class="tag">&lt;h:body&gt;</span>
        <span class="tag">&lt;h:form&gt;</span>
            <span class="tag">&lt;h:graphicImage</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{resource['images:wave.med.gif']}</span><span class="delimiter">&quot;</span></span>
                            <span class="attribute-name">alt</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Duke waving his hand</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;h2&gt;</span>
                Hi, my name is Duke. I am thinking of a number from
                #{userNumberBean.minimum} to #{userNumberBean.maximum}.
                Can you guess it?
            <span class="tag">&lt;/h2&gt;</span>
            <span class="tag">&lt;p&gt;</span><span class="tag">&lt;h:inputText</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">userNo</span><span class="delimiter">&quot;</span></span>
                            <span class="attribute-name">title</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Enter a number from 0 to 10:</span><span class="delimiter">&quot;</span></span>
                            <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{userNumberBean.userNumber}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                   <span class="tag">&lt;f:validateLongRange</span> <span class="attribute-name">minimum</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{userNumberBean.minimum}</span><span class="delimiter">&quot;</span></span>
                                        <span class="attribute-name">maximum</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{userNumberBean.maximum}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;/h:inputText&gt;</span>
                <span class="tag">&lt;h:commandButton</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">submit</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Submit</span><span class="delimiter">&quot;</span></span>
                                 <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">response</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/p&gt;</span>
            <span class="tag">&lt;h:message</span> <span class="attribute-name">showSummary</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">showDetail</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>
                       <span class="attribute-name">style</span>=<span class="string"><span class="delimiter">&quot;</span><span class="key">color</span>: <span class="color">#d20005</span>;
                       <span class="key">font-family</span>: <span class="string"><span class="delimiter">'</span><span class="content">New Century Schoolbook</span><span class="delimiter">'</span></span>, <span class="value">serif</span>;
                       <span class="key">font-style</span>: <span class="value">oblique</span>;
                       <span class="key">text-decoration</span>: <span class="value">overline</span><span class="delimiter">&quot;</span></span>
                       <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">errors1</span><span class="delimiter">&quot;</span></span>
                       <span class="attribute-name">for</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">userNo</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/h:form&gt;</span>
    <span class="tag">&lt;/h:body&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note the use of the following tags:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Facelets HTML tags (those beginning with <code>h:</code>) to add components</p>
</li>
<li>
<p>The Facelets core tag <code>f:validateLongRange</code> to validate the user input</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An <code>h:inputText</code> tag accepts user input and sets the value of the managed bean property <code>userNumber</code> through the EL expression <code>#{userNumberBean.userNumber}</code>.
The input value is validated for value range by the Jakarta Faces standard validator tag <code>f:validateLongRange</code>.</p>
</div>
<div class="paragraph">
<p>The image file, <code>wave.med.gif</code>, is added to the page as a resource, as is the style sheet.
For more details about the resources facility, see <a href="#web-resources">Web Resources</a>.</p>
</div>
<div class="paragraph">
<p>An <code>h:commandButton</code> tag with the ID <code>submit</code> starts validation of the input data when a user clicks the button.
Using implicit navigation, the tag redirects the client to another page, <code>response.xhtml</code>, which shows the response to your input.
The page specifies only <code>response</code>, which by default causes the server to look for <code>response.xhtml</code>.</p>
</div>
<div class="paragraph">
<p>You can now create the second page, <code>response.xhtml</code>, with the following content:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="doctype">&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;
    &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;&gt;</span>

<span class="tag">&lt;html</span> <span class="attribute-name">lang</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/1999/xhtml</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xmlns:h</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://xmlns.jcp.org/jsf/html</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    <span class="tag">&lt;h:head&gt;</span>
        <span class="tag">&lt;h:outputStylesheet</span> <span class="attribute-name">library</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">css</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default.css</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;title&gt;</span>Guess Number Facelets Application<span class="tag">&lt;/title&gt;</span>
    <span class="tag">&lt;/h:head&gt;</span>
    <span class="tag">&lt;h:body&gt;</span>
        <span class="tag">&lt;h:form&gt;</span>
            <span class="tag">&lt;h:graphicImage</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{resource['images:wave.med.gif']}</span><span class="delimiter">&quot;</span></span>
                            <span class="attribute-name">alt</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Duke waving his hand</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;h2&gt;</span>
                <span class="tag">&lt;h:outputText</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">result</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{userNumberBean.response}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/h2&gt;</span>
            <span class="tag">&lt;h:commandButton</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">back</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Back</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">greeting</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/h:form&gt;</span>
    <span class="tag">&lt;/h:body&gt;</span>
<span class="tag">&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This page also uses implicit navigation, setting the <code>action</code> attribute for the Back button to send the user to the <code>greeting.xhtml</code> page.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configuring-the-application"><a class="anchor" href="#configuring-the-application"></a>Configuring the Application</h4>
<div class="paragraph">
<p>Configuring a Jakarta Faces application involves mapping the Faces Servlet in the web deployment descriptor file, such as a <code>web.xml</code> file, and possibly adding managed bean declarations, navigation rules, and resource bundle declarations to the application configuration resource file, <code>faces-config.xml</code>.</p>
</div>
<div class="paragraph">
<p>If you are using NetBeans IDE, a web deployment descriptor file is automatically created for you.
In such an IDE-created <code>web.xml</code> file, change the default greeting page, which is <code>index.xhtml</code>, to <code>greeting.xhtml</code>.
Here is an example <code>web.xml</code> file, showing this change in bold.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;web-app</span> <span class="attribute-name">version</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">5.0</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">https://jakarta.ee/xml/ns/jakartaee</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">https://jakarta.ee/xml/ns/jakartaee https://jakarta.ee/xml/ns/jakartaee/web-app_5_0.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;context-param&gt;</span>
        <span class="tag">&lt;param-name&gt;</span>jakarta.faces.PROJECT_STAGE<span class="tag">&lt;/param-name&gt;</span>
        <span class="tag">&lt;param-value&gt;</span>Development<span class="tag">&lt;/param-value&gt;</span>
    <span class="tag">&lt;/context-param&gt;</span>
    <span class="tag">&lt;servlet&gt;</span>
        <span class="tag">&lt;servlet-name&gt;</span>Faces Servlet<span class="tag">&lt;/servlet-name&gt;</span>
        <span class="tag">&lt;servlet-class&gt;</span>jakarta.faces.webapp.FacesServlet<span class="tag">&lt;/servlet-class&gt;</span>
        <span class="tag">&lt;load-on-startup&gt;</span>1<span class="tag">&lt;/load-on-startup&gt;</span>
    <span class="tag">&lt;/servlet&gt;</span>
    <span class="tag">&lt;servlet-mapping&gt;</span>
        <span class="tag">&lt;servlet-name&gt;</span>Faces Servlet<span class="tag">&lt;/servlet-name&gt;</span>
        <span class="tag">&lt;url-pattern&gt;</span>*.xhtml<span class="tag">&lt;/url-pattern&gt;</span>
    <span class="tag">&lt;/servlet-mapping&gt;</span>
    <span class="tag">&lt;session-config&gt;</span>
        <span class="tag">&lt;session-timeout&gt;</span>
            30
        <span class="tag">&lt;/session-timeout&gt;</span>
    <span class="tag">&lt;/session-config&gt;</span>
    <span class="tag">&lt;welcome-file-list&gt;</span>
        <span class="tag">&lt;welcome-file&gt;</span>greeting.xhtml<span class="tag">&lt;/welcome-file&gt;</span>
    <span class="tag">&lt;/welcome-file-list&gt;</span>
<span class="tag">&lt;/web-app&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note the use of the context parameter <code>PROJECT_STAGE</code>.
This parameter identifies the status of a Jakarta Faces application in the software lifecycle.</p>
</div>
<div class="paragraph">
<p>The stage of an application can affect the behavior of the application.
For example, if the project stage is defined as <code>Development</code>, debugging information is automatically generated for the user.
If not defined by the user, the default project stage is <code>Production</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="running-the-guessnumber-jsf-facelets-example"><a class="anchor" href="#running-the-guessnumber-jsf-facelets-example"></a>Running the guessnumber-jsf Facelets Example</h4>
<div class="paragraph">
<p>You can use either NetBeans IDE or Maven to build, package, deploy, and run the <code>guessnumber-jsf</code> example.</p>
</div>
<div class="sect4">
<h5 id="to-build-package-and-deploy-the-guessnumber-jsf-example-using-netbeans-ide"><a class="anchor" href="#to-build-package-and-deploy-the-guessnumber-jsf-example-using-netbeans-ide"></a>To Build, Package, and Deploy the guessnumber-jsf Example Using NetBeans IDE</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>From the <strong>File</strong> menu, choose <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the Open Project dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/web/jsf</pre>
</div>
</div>
</li>
<li>
<p>Select the <code>guessnumber-jsf</code> folder.</p>
</li>
<li>
<p>Click <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the <strong>Projects</strong> tab, right-click the <code>guessnumber-jsf</code> project and select <strong>Build</strong>.</p>
<div class="paragraph">
<p>This option builds the example application and deploys it to your GlassFish Server instance.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-build-package-and-deploy-the-guessnumber-jsf-example-using-maven"><a class="anchor" href="#to-build-package-and-deploy-the-guessnumber-jsf-example-using-maven"></a>To Build, Package, and Deploy the guessnumber-jsf Example Using Maven</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>In a terminal window, go to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/web/jsf/guessnumber-jsf/</pre>
</div>
</div>
</li>
<li>
<p>Enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">mvn install</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command builds and packages the application into a WAR file, <code>guessnumber-jsf.war</code>, that is located in the <code>target</code> directory.
It then deploys it to the server.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-run-the-guessnumber-jsf-example"><a class="anchor" href="#to-run-the-guessnumber-jsf-example"></a>To Run the guessnumber-jsf Example</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open a web browser.</p>
</li>
<li>
<p>Enter the following URL in your web browser:</p>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080/guessnumber-jsf</pre>
</div>
</div>
</li>
<li>
<p>In the field, enter a number from 0 to 10 and click Submit.</p>
<div class="paragraph">
<p>Another page appears, reporting whether your guess is correct or incorrect.</p>
</div>
</li>
<li>
<p>If you guessed incorrectly, click Back to return to the main page.</p>
<div class="paragraph">
<p>You can continue to guess until you get the correct answer, or you can look in the server log, where the <code>UserNumberBean</code> constructor displays the correct answer.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-facelets-templates"><a class="anchor" href="#using-facelets-templates"></a>Using Facelets Templates</h3>
<div class="paragraph">
<p>Jakarta Faces technology provides the tools to implement user interfaces that are easy to extend and reuse.
Templating is a useful Facelets feature that allows you to create a page that will act as the base, or template, for the other pages in an application.
By using templates, you can reuse code and avoid recreating similarly constructed pages.
Templating also helps in maintaining a standard look and feel in an application with a large number of pages.</p>
</div>
<div class="paragraph">
<p><a href="#facelets-templating-tags">Table 8-2</a> lists Facelets tags that are used for templating and their respective functionality.</p>
</div>
<table id="facelets-templating-tags" class="tableblock frame-all grid-all" style="width: 99%;">
<caption class="title">Table 8-2 Facelets Templating Tags</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Tag</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ui:component</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines a component that is created and added to the component tree.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ui:composition</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines a page composition that optionally uses a template.
Content outside of this tag is ignored.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ui:debug</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines a debug component that is created and added to the component tree.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ui:decorate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Similar to the composition tag but does not disregard content outside this tag.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ui:define</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines content that is inserted into a page by a template.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ui:fragment</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Similar to the component tag but does not disregard content outside this tag.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ui:include</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Encapsulates and reuses content for multiple pages.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ui:insert</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Inserts content into a template.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ui:param</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used to pass parameters to an included file.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ui:repeat</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Used as an alternative for loop tags, such as <code>c:forEach</code> or <code>h:dataTable.</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ui:remove</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Removes content from a page.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For more information on Facelets templating tags, see the Jakarta Faces Facelets Tag Library documentation.</p>
</div>
<div class="paragraph">
<p>The Facelets tag library includes the main templating tag <code>ui:insert</code>.
A template page that is created with this tag allows you to define a default structure for a page.
A template page is used as a template for other pages, usually referred to as client pages.</p>
</div>
<div class="paragraph">
<p>Here is an example of a template saved as <code>template.xhtml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="doctype">&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;
      &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;&gt;</span>
<span class="tag">&lt;html</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/1999/xhtml</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xmlns:ui</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://xmlns.jcp.org/jsf/facelets</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xmlns:h</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://xmlns.jcp.org/jsf/html</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    <span class="tag">&lt;h:head&gt;</span>
        <span class="tag">&lt;meta</span> <span class="attribute-name">http-equiv</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Content-Type</span><span class="delimiter">&quot;</span></span>
              <span class="attribute-name">content</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text/html; charset=UTF-8</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;h:outputStylesheet</span> <span class="attribute-name">library</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">css</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default.css</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;h:outputStylesheet</span> <span class="attribute-name">library</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">css</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">cssLayout.css</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;title&gt;</span>Facelets Template<span class="tag">&lt;/title&gt;</span>
    <span class="tag">&lt;/h:head&gt;</span>

    <span class="tag">&lt;h:body&gt;</span>
        <span class="tag">&lt;div</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">top</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">top</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;ui:insert</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">top</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>Top Section<span class="tag">&lt;/ui:insert&gt;</span>
        <span class="tag">&lt;/div&gt;</span>
        <span class="tag">&lt;div&gt;</span>
        <span class="tag">&lt;div</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">left</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
             <span class="tag">&lt;ui:insert</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">left</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>Left Section<span class="tag">&lt;/ui:insert&gt;</span>
        <span class="tag">&lt;/div&gt;</span>
        <span class="tag">&lt;div</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">content</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">left_content</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
             <span class="tag">&lt;ui:insert</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">content</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>Main Content<span class="tag">&lt;/ui:insert&gt;</span>
        <span class="tag">&lt;/div&gt;</span>
        <span class="tag">&lt;/div&gt;</span>
    <span class="tag">&lt;/h:body&gt;</span>
<span class="tag">&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The example page defines an XHTML page that is divided into three sections: a top section, a left section, and a main section.
The sections have style sheets associated with them.
The same structure can be reused for the other pages of the application.</p>
</div>
<div class="paragraph">
<p>The client page invokes the template by using the <code>ui:composition</code> tag.
In the following example, a client page named <code>templateclient.xhtml</code> invokes the template page named <code>template.xhtml</code> from the preceding example.
A client page allows content to be inserted with the help of the <code>ui:define</code> tag.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="doctype">&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;
  &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;&gt;</span>
<span class="tag">&lt;html</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/1999/xhtml</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xmlns:ui</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://xmlns.jcp.org/jsf/facelets</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xmlns:h</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://xmlns.jcp.org/jsf/html</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    <span class="tag">&lt;h:body&gt;</span>
        <span class="tag">&lt;ui:composition</span> <span class="attribute-name">template</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">./template.xhtml</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;ui:define</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">top</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                Welcome to Template Client Page
            <span class="tag">&lt;/ui:define&gt;</span>

            <span class="tag">&lt;ui:define</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">left</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;h:outputLabel</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">You are in the Left Section</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/ui:define&gt;</span>

            <span class="tag">&lt;ui:define</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">content</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;h:graphicImage</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{resource['images:wave.med.gif']}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;h:outputText</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">You are in the Main Content Section</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/ui:define&gt;</span>
        <span class="tag">&lt;/ui:composition&gt;</span>
    <span class="tag">&lt;/h:body&gt;</span>
<span class="tag">&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use NetBeans IDE to create Facelets template and client pages.
For more information on creating these pages, see <a href="https://netbeans.org/kb/docs/web/jsf20-intro.html" class="bare" target="_blank" rel="noopener">https://netbeans.org/kb/docs/web/jsf20-intro.html</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="composite-components"><a class="anchor" href="#composite-components"></a>Composite Components</h3>
<div class="paragraph">
<p>Jakarta Faces technology offers the concept of composite components with Facelets.
A composite component is a special type of template that acts as a component.</p>
</div>
<div class="paragraph">
<p>Any component is essentially a piece of reusable code that behaves in a particular way.
For example, an input component accepts user input.
A component can also have validators, converters, and listeners attached to it to perform certain defined actions.</p>
</div>
<div class="paragraph">
<p>A composite component consists of a collection of markup tags and other existing components.
This reusable, user-created component has a customized, defined functionality and can have validators, converters, and listeners attached to it like any other component.</p>
</div>
<div class="paragraph">
<p>With Facelets, any XHTML page that contains markup tags and other components can be converted into a composite component.
Using the resources facility, the composite component can be stored in a library that is available to the application from the defined resources location.</p>
</div>
<div class="paragraph">
<p><a href="#composite-component-tags">Table 8-3</a> lists the most commonly used composite tags and their functions.</p>
</div>
<table id="composite-component-tags" class="tableblock frame-all grid-all" style="width: 99%;">
<caption class="title">Table 8-3 Composite Component Tags</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Tag</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>composite:interface</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Declares the usage contract for a composite component.
The composite component can be used as a single component whose feature set is the union of the features declared in the usage contract.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>composite:implementation</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the implementation of the composite component.
If a <code>composite:interface</code> element appears, there must be a corresponding <code>composite:implementation</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>composite:attribute</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Declares an attribute that may be given to an instance of the composite component in which this tag is declared.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>composite:insertChildren</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any child components or template text within the composite component tag in the using page will be reparented into the composite component at the point indicated by this tag&#8217;s placement within the <code>composite:implementation</code> section.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>composite:valueHolder</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Declares that the composite component whose contract is declared by the <code>composite:interface</code> in which this element is nested exposes an implementation of <code>ValueHolder</code> suitable for use as the target of attached objects in the using page.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>composite:editableValueHolder</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Declares that the composite component whose contract is declared by the <code>composite:interface</code> in which this element is nested exposes an implementation of <code>EditableValueHolder</code> suitable for use as the target of attached objects in the using page.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>composite:actionSource</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Declares that the composite component whose contract is declared by the <code>composite:interface</code> in which this element is nested exposes an implementation of <code>ActionSource2</code> suitable for use as the target of attached objects in the using page.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For more information and a complete list of Facelets composite tags, see the Jakarta Faces Facelets Tag Library documentation.</p>
</div>
<div class="paragraph">
<p>The following example shows a composite component that accepts an email address as input:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="doctype">&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;
  &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;&gt;</span>
<span class="tag">&lt;html</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/1999/xhtml</span><span class="delimiter">&quot;</span></span>
  <span class="attribute-name">xmlns:composite</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://xmlns.jcp.org/jsf/composite</span><span class="delimiter">&quot;</span></span>
  <span class="attribute-name">xmlns:h</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://xmlns.jcp.org/jsf/html</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    <span class="tag">&lt;h:head&gt;</span>
        <span class="tag">&lt;title&gt;</span>This content will not be displayed<span class="tag">&lt;/title&gt;</span>
    <span class="tag">&lt;/h:head&gt;</span>
    <span class="tag">&lt;h:body&gt;</span>
        <span class="tag">&lt;composite:interface&gt;</span>
            <span class="tag">&lt;composite:attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">required</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/composite:interface&gt;</span>

        <span class="tag">&lt;composite:implementation&gt;</span>
            <span class="tag">&lt;h:outputLabel</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Email id: </span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/h:outputLabel&gt;</span>
            <span class="tag">&lt;h:inputText</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{cc.attrs.value}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/h:inputText&gt;</span>
        <span class="tag">&lt;/composite:implementation&gt;</span>
    <span class="tag">&lt;/h:body&gt;</span>
<span class="tag">&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note the use of <code>cc.attrs.value</code> when defining the value of the <code>inputText</code> component.
The word <code>cc</code> in Jakarta Faces is a reserved word for composite components.
The <code>#{cc.attrs.<em>attribute-name</em>}</code> expression is used to access the attributes defined for the composite component&#8217;s interface, which in this case happens to be <code>value</code>.</p>
</div>
<div class="paragraph">
<p>The preceding example content is stored as a file named <code>email.xhtml</code> in a folder named <code>resources/emcomp</code>, under the application web root directory.
This directory is considered a library by Jakarta Faces, and a component can be accessed from such a library. For more information on resources, see <a href="#web-resources">Web Resources</a>.</p>
</div>
<div class="paragraph">
<p>The web page that uses this composite component is generally called a using page.
The using page includes a reference to the composite component, in the <code>xml</code> namespace declarations:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="doctype">&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;
  &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;&gt;</span>
<span class="tag">&lt;html</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/1999/xhtml</span><span class="delimiter">&quot;</span></span>
  <span class="attribute-name">xmlns:h</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://xmlns.jcp.org/jsf/html</span><span class="delimiter">&quot;</span></span>
  <span class="attribute-name">xmlns:em</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://xmlns.jcp.org/jsf/composite/emcomp</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    <span class="tag">&lt;h:head&gt;</span>
        <span class="tag">&lt;title&gt;</span>Using a sample composite component<span class="tag">&lt;/title&gt;</span>
    <span class="tag">&lt;/h:head&gt;</span>

    <span class="tag">&lt;body&gt;</span>
        <span class="tag">&lt;h:form&gt;</span>
            <span class="tag">&lt;em:email</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Enter your email id</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;/h:form&gt;</span>
    <span class="tag">&lt;/body&gt;</span>
<span class="tag">&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The local composite component library is defined in the <code>xmlns</code> namespace with the declaration <code>xmlns:em="http://xmlns.jcp.org/jsf/composite/emcomp"</code>.
The component itself is accessed through the <code>em:email</code> tag.
The preceding example content can be stored as a web page named <code>emuserpage.xhtml</code> under the web root directory.
When compiled and deployed on a server, it can be accessed with the following URL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080/application-name/emuserpage.xhtml</pre>
</div>
</div>
<div class="paragraph">
<p>See <a href="#composite-components-advanced-topics-and-an-example">Chapter 14, <em>Composite Components: Advanced Topics and an Example</em></a> for more information and an example.</p>
</div>
</div>
<div class="sect2">
<h3 id="web-resources"><a class="anchor" href="#web-resources"></a>Web Resources</h3>
<div class="paragraph">
<p>Web resources are any software artifacts that the web application requires for proper rendering, including images, script files, and any user-created component libraries.
Resources must be collected in a standard location, which can be one of the following.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A resource packaged in the web application root must be in a subdirectory of a <code>resources</code> directory at the web application root: <code>resources/<em>resource-identifier</em></code>.</p>
</li>
<li>
<p>A resource packaged in the web application&#8217;s classpath must be in a subdirectory of the <code>META-INF/resources</code> directory within a web application: <code>META-INF/resources/<em>resource-identifier</em></code>.
You can use this file structure to package resources in a JAR file bundled in the web application.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Jakarta Faces runtime will look for the resources in the preceding listed locations, in that order.</p>
</div>
<div class="paragraph">
<p>Resource identifiers are unique strings that conform to the following format (all on one line):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[locale-prefix/][library-name/][library-version/]resource-name[/resource-version]</pre>
</div>
</div>
<div class="paragraph">
<p>Elements of the resource identifier in brackets (<code>[]</code>) are optional, indicating that only a resource-name, which is usually a file name, is a required element.
For example, the most common way to specify a style sheet, image, or script is to use the <code>library</code> and <code>name</code> attributes, as in the following tag from the <code>guessnumber-jsf</code> example:s</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:outputStylesheet</span> <span class="attribute-name">library</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">css</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default.css</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This tag specifies that the <code>default.css</code> style sheet is in the directory <code>web/resources/css</code>.</p>
</div>
<div class="paragraph">
<p>You can also specify the location of an image using the following syntax, also from the <code>guessnumber-jsf</code> example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:graphicImage</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{resource['images:wave.med.gif']}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This tag specifies that the image named <code>wave.med.gif</code> is in the directory <code>web/resources/images</code>.</p>
</div>
<div class="paragraph">
<p>Resources can be considered as a library location.
Any artifact, such as a composite component or a template that is stored in the <code>resources</code> directory, becomes accessible to the other application components, which can use it to create a resource instance.</p>
</div>
</div>
<div class="sect2">
<h3 id="relocatable-resources"><a class="anchor" href="#relocatable-resources"></a>Relocatable Resources</h3>
<div class="paragraph">
<p>You can place a resource tag in one part of a page and specify that it be rendered in another part of the page.
To do this, you use the <code>target</code> attribute of a tag that specifies a resource.
Acceptable values for this attribute are as follows.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>&#8220;head&#8221; renders the resource in the <code>head</code> element.</p>
</li>
<li>
<p>&#8220;body&#8221; renders the resource in the <code>body</code> element.</p>
</li>
<li>
<p>&#8220;form&#8221; renders the resource in the <code>form</code> element.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, the following <code>h:outputScript</code> tag is placed within an <code>h:form</code> element, but it renders the JavaScript in the <code>head</code> element:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:form&gt;</span>
    <span class="tag">&lt;h:outputScript</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myscript.js</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">library</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mylibrary</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">target</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">head</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/h:form&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>h:outputStylesheet</code> tag also supports resource relocation, in a similar way.</p>
</div>
<div class="paragraph">
<p>Relocatable resources are essential for composite components that use stylesheets and can also be useful for composite components that use JavaScript.
See <a href="#the-compositecomponentexample-example-application">The compositecomponentexample Example Application</a> for an example.</p>
</div>
</div>
<div class="sect2">
<h3 id="resource-library-contracts"><a class="anchor" href="#resource-library-contracts"></a>Resource Library Contracts</h3>
<div class="paragraph">
<p>Resource library contracts allow you to define a different look and feel for different parts of one or more applications, instead of either having to use the same look and feel for all or having to specify a different look on a page-by-page basis.</p>
</div>
<div class="paragraph">
<p>To do this, you create a <code>contracts</code> section of your web application.
Within the <code>contracts</code> section, you can specify any number of named areas, each of which is called a contract.
Within each contract you can specify resources such as template files, stylesheets, JavaScript files, and images.</p>
</div>
<div class="paragraph">
<p>For example, you could specify two contracts named <code>c1</code> and <code>c2</code>, each of which uses a template and other files:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>src/main/webapp
    WEB-INF/
    contracts
        c1
            template.xhtml
            style.css
            myImg.gif
            myJS.js
        c2
            template.xhtml
            style2.css
            img2.gif
            JS2.js
    index.xhtml
    ...</pre>
</div>
</div>
<div class="paragraph">
<p>One part of the application can use <code>c1</code>, while another can use <code>c2</code>.</p>
</div>
<div class="paragraph">
<p>Another way to use contracts is to specify a single contract that contains multiple templates:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>src/main/webapp
    contracts
        myContract
            template1.xhtml
            template2.xhtml
            style.css
            img.png
            img2.png</pre>
</div>
</div>
<div class="paragraph">
<p>You can package a resource library contract in a JAR file for reuse in different applications.
If you do so, the contracts must be located under <code>META-INF/contracts</code>.
You can then place the JAR file in the <code>WEB-INF/lib</code> directory of an application.
This means that the application would be organized as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>src/main/webapp/
    WEB-INF/lib/myContract.jar
    ...</pre>
</div>
</div>
<div class="paragraph">
<p>You can specify the contract usage within an application&#8217;s <code>faces-config.xml</code> file, under the <code>resource-library-contracts</code> element.
You need to use this element only if your application uses more than one contract, however.</p>
</div>
<div class="sect3">
<h4 id="the-hello1-rlc-example-application"><a class="anchor" href="#the-hello1-rlc-example-application"></a>The hello1-rlc Example Application</h4>
<div class="paragraph">
<p>The <code>hello1-rlc</code> example modifies the simple <code>hello1</code> example from <a href="#a-web-module-that-uses-jakarta-faces-technology-the-hello1-example">A Web Module That Uses Jakarta Faces Technology: The hello1 Example</a> to use two resource library contracts.
Each of the two pages in the application uses a different contract.</p>
</div>
<div class="paragraph">
<p>The managed bean for <code>hello1-rlc</code>, <code>Hello.java</code>, is identical to the one for <code>hello1</code> (except that it replaces the <code>@Named</code> and <code>@RequestScoped</code> annotations with <code>@Model</code>).</p>
</div>
<div class="paragraph">
<p>The source code for this application is in the <code><em>tut-install</em>/examples/web/jsf/hello1-rlc/</code> directory.</p>
</div>
<div class="sect4">
<h5 id="configuring-the-hello1-rlc-example"><a class="anchor" href="#configuring-the-hello1-rlc-example"></a>Configuring the hello1-rlc Example</h5>
<div class="paragraph">
<p>The <code>faces-config.xml</code> file for the <code>hello1-rlc</code> example contains the following elements:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;resource-library-contracts&gt;</span>
    <span class="tag">&lt;contract-mapping&gt;</span>
        <span class="tag">&lt;url-pattern&gt;</span>/reply/*<span class="tag">&lt;/url-pattern&gt;</span>
        <span class="tag">&lt;contracts&gt;</span>reply<span class="tag">&lt;/contracts&gt;</span>
    <span class="tag">&lt;/contract-mapping&gt;</span>
    <span class="tag">&lt;contract-mapping&gt;</span>
        <span class="tag">&lt;url-pattern&gt;</span>*<span class="tag">&lt;/url-pattern&gt;</span>
        <span class="tag">&lt;contracts&gt;</span>hello<span class="tag">&lt;/contracts&gt;</span>
    <span class="tag">&lt;/contract-mapping&gt;</span>
<span class="tag">&lt;/resource-library-contracts&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>contract-mapping</code> elements within the <code>resource-library-contracts</code> element map each contract to a different set of pages within the application.
One contract, named <code>reply</code>, is used for all pages under the <code>reply</code> area of the application (<code>/reply/*</code>).
The other contract, <code>hello</code>, is used for all other pages in the application (<code>*</code>).</p>
</div>
<div class="paragraph">
<p>The application is organized as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>hello1-rlc
    pom.xml
    src/main/java/ee/jakarta/tutorial/hello1rlc/Hello.java
    src/main/webapp
        WEB-INF
            faces-config.xml
            web.xml
        contracts
            hello
                default.css
                duke.handsOnHips.gif
                template.xhtml
            reply
                default.css
                duke.thumbsup.gif
                template.xhtml
        reply
            response.xhtml
        greeting.xhtml</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>web.xml</code> file specifies the <code>welcome-file</code> as <code>greeting.xhtml</code>.
Because it is not located under <code>src/main/webapp/reply</code>, this Facelets page uses the <code>hello</code> contract, whereas <code>src/main/webapp/reply/response.xhtml</code> uses the <code>reply</code> contract.</p>
</div>
</div>
<div class="sect4">
<h5 id="the-facelets-pages-for-the-hello1-rlc-example"><a class="anchor" href="#the-facelets-pages-for-the-hello1-rlc-example"></a>The Facelets Pages for the hello1-rlc Example</h5>
<div class="paragraph">
<p>The <code>greeting.xhtml</code> and <code>response.xhtml</code> pages have identical code calling in their templates:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;ui:composition</span> <span class="attribute-name">template</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/template.xhtml</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>template.xhtml</code> files in the <code>hello</code> and <code>reply</code> contracts differ only in two respects: the placeholder text for the <code>title</code> element ("Hello Template" and "Reply Template") and the graphic that each specifies.</p>
</div>
<div class="paragraph">
<p>The <code>default.css</code> stylesheets in the two contracts differ in only one respect: the background color specified for the <code>body</code> element.</p>
</div>
</div>
<div class="sect4">
<h5 id="to-build-package-and-deploy-the-hello1-rlc-example-using-netbeans-ide"><a class="anchor" href="#to-build-package-and-deploy-the-hello1-rlc-example-using-netbeans-ide"></a>To Build, Package, and Deploy the hello1-rlc Example Using NetBeans IDE</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>From the <strong>File</strong> menu, choose <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the Open Project dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/web/jsf</pre>
</div>
</div>
</li>
<li>
<p>Select the <code>hello1-rlc</code> folder.</p>
</li>
<li>
<p>Click <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the <strong>Projects</strong> tab, right-click the <code>hello1-rlc</code> project and select <strong>Build</strong>.</p>
<div class="paragraph">
<p>This option builds the example application and deploys it to your GlassFish Server instance.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-build-package-and-deploy-the-hello1-rlc-example-using-maven"><a class="anchor" href="#to-build-package-and-deploy-the-hello1-rlc-example-using-maven"></a>To Build, Package, and Deploy the hello1-rlc Example Using Maven</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>In a terminal window, go to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/web/jsf/hello1-rlc/</pre>
</div>
</div>
</li>
<li>
<p>Enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">mvn install</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command builds and packages the application into a WAR file, <code>hello1-rlc.war</code>, that is located in the <code>target</code> directory.
It then deploys it to your GlassFish Server instance.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-run-the-hello1-rlc-example"><a class="anchor" href="#to-run-the-hello1-rlc-example"></a>To Run the hello1-rlc Example</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Enter the following URL in your web browser:</p>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080/hello1-rlc</pre>
</div>
</div>
</li>
<li>
<p>The <code>greeting.xhtml</code> page looks just like the one from <code>hello1</code> except for its background color and graphic.</p>
</li>
<li>
<p>In the text field, enter your name and click Submit.</p>
</li>
<li>
<p>The response page also looks just like the one from <code>hello1</code> except for its background color and graphic.</p>
<div class="paragraph">
<p>The page displays the name you submitted.
Click Back to return to the <code>greeting.xhtml</code> page.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="html5-friendly-markup"><a class="anchor" href="#html5-friendly-markup"></a>HTML5-Friendly Markup</h3>
<div class="paragraph">
<p>When you want to produce user interface features for which HTML does not have its own elements, you can create a custom Jakarta Faces component and insert it in your Facelets page.
This mechanism can cause a simple element to create complex web code.
However, creating such a component is a significant task (see <a href="#creating-custom-ui-components-and-other-custom-objects">Chapter 15, <em>Creating Custom UI Components and Other Custom Objects</em></a>).</p>
</div>
<div class="paragraph">
<p>HTML5 offers new elements and attributes that can make it unnecessary to write your own components.
It also provides many new capabilities for existing components.
Jakarta Faces technology supports HTML5 not by introducing new UI components that imitate HTML5 ones but by allowing you to use HTML5 markup directly.
It also allows you to use Jakarta Faces attributes within HTML5 elements.
Jakarta Faces technology support for HTML5 falls into two categories:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Pass-through elements</p>
</li>
<li>
<p>Pass-through attributes</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The effect of the HTML5-friendly markup feature is to offer the Facelets page author almost complete control over the rendered page output, rather than having to pass this control off to component authors.
You can mix and match Jakarta Faces and HTML5 components and elements as you see fit.</p>
</div>
<div class="sect3">
<h4 id="using-pass-through-elements"><a class="anchor" href="#using-pass-through-elements"></a>Using Pass-Through Elements</h4>
<div class="paragraph">
<p>Pass-through elements allow you to use HTML5 tags and attributes but to treat them as equivalent to Jakarta Faces components associated with a server-side <code>UIComponent</code> instance.</p>
</div>
<div class="paragraph">
<p>To make an element that is not a Jakarta Faces element a pass-through element, specify at least one of its attributes using the <code>http://xmlns.jcp.org/jsf</code> namespace.
For example, the following code declares the namespace with the short name <code>jsf</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;html</span> <span class="attribute-name">...</span> <span class="attribute-name">xmlns:jsf</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://xmlns.jcp.org/jsf</span><span class="delimiter">&quot;</span></span>
<span class="attribute-name">...</span>
    <span class="error">&lt;</span><span class="attribute-name">input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">email</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">jsf:id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">email</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">email</span><span class="delimiter">&quot;</span></span>
           <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{reservationBean.email}</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">required</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">required</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, the <code>jsf</code> prefix is placed on the <code>id</code> attribute so that the HTML5 input tag&#8217;s attributes are treated as part of the Facelets page.
This means that, for example, you can use EL expressions to retrieve managed bean properties.</p>
</div>
<div class="paragraph">
<p><a href="#how-facelets-renders-html5-elements">Table 8-4</a> shows how pass-through elements are rendered as Facelets tags.
The faces implementation uses the element name and the identifying attribute to determine the corresponding Facelets tag that will be used in the server-side processing.
The browser, however, interprets the markup that the page author has written.</p>
</div>
<table id="how-facelets-renders-html5-elements" class="tableblock frame-all grid-all" style="width: 60%;">
<caption class="title">Table 8-4 How Facelets Renders HTML5 Elements</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">HTML5 Element Name</th>
<th class="tableblock halign-left valign-top">Identifying Attribute</th>
<th class="tableblock halign-left valign-top">Facelets Tag</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jsf:action</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>h:commandLink</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jsf:actionListener</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>h:commandLink</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jsf:value</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>h:outputLink</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jsf:outcome</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>h:link</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>body</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>h:body</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>button</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>h:commandButton</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>button</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jsf:outcome</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>h:button</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>form</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>h:form</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>head</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>h:head</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>img</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>h:graphicImage</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>input</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>type="button"</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>h:commandButton</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>input</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>type="checkbox"</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>h:selectBooleanCheckbox</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>input</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>type="color"</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>h:inputText</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>input</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>type="date"</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>h:inputText</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>input</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>type="datetime"</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>h:inputText</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>input</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>type="datetime-local"</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>h:inputText</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>input</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>type="email"</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>h:inputText</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>input</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>type="month"</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>h:inputText</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>input</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>type="number"</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>h:inputText</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>input</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>type="range"</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>h:inputText</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>input</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>type="search"</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>h:inputText</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>input</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>type="time"</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>h:inputText</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>input</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>type="url"</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>h:inputText</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>input</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>type="week"</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>h:inputText</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>input</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>type="file"</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>h:inputFile</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>input</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>type="hidden"</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>h:inputHidden</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>input</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>type="password"</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>h:inputSecret</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>input</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>type="reset"</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>h:commandButton</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>input</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>type="submit"</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>h:commandButton</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>input</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>type="*"</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>h:inputText</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>label</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>h:outputLabel</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>link</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>h:outputStylesheet</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>script</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>h:outputScript</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>select</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>multiple="*"</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>h:selectManyListbox</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>select</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>h:selectOneListbox</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>textarea</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>h:inputTextArea</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="using-pass-through-attributes"><a class="anchor" href="#using-pass-through-attributes"></a>Using Pass-Through Attributes</h4>
<div class="paragraph">
<p>Pass-through attributes are the converse of pass-through elements.
They allow you to pass attributes that are not Jakarta Faces attributes through to the browser without interpretation.
If you specify a pass-through attribute in a Jakarta Faces <code>UIComponent</code>, the attribute name and value are passed straight through to the browser without being interpreted by Jakarta Faces components or renderers.
There are several ways to specify pass-through attributes.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use the Jakarta Faces namespace for pass-through attributes to prefix the attribute names within a Jakarta Faces component.
For example, the following code declares the namespace with the short name <code>p</code>, then passes the <code>type</code>, <code>min</code>, <code>max</code>, <code>required</code>, and <code>title</code> attributes through to the HTML5 <code>input</code> component:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;html</span> <span class="attribute-name">...</span> <span class="attribute-name">xmlns:p</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://xmlns.jcp.org/jsf/passthrough</span><span class="delimiter">&quot;</span></span>
<span class="attribute-name">...</span>

<span class="error">&lt;</span><span class="attribute-name">h:form</span> <span class="attribute-name">prependId</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="tag">&lt;h:inputText</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">nights</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">p:type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">number</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{bean.nights}</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">p:min</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">p:max</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">30</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">p:required</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">required</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">p:title</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Enter a number between 1 and 30 inclusive.</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will cause the following markup to be rendered (assuming that <code>bean.nights</code> has a default value set to 1):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;input</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">nights</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">number</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">min</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">max</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">30</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">required</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">required</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">title</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Enter a number between 1 and 30 inclusive.</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span></code></pre>
</div>
</div>
</li>
<li>
<p>To pass a single attribute, nest the <code>f:passThroughAttribute</code> tag within a component tag.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:inputText</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{user.email}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;f:passThroughAttribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">email</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/h:inputText&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This code would be rendered similarly to the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;input</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">me@me.com</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">email</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
</li>
<li>
<p>To pass a group of attributes, nest the <code>f:passThroughAttributes</code> tag within a component tag, specifying an EL value that must evaluate to a <code>Map&lt;String, Object&gt;</code>.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:inputText</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{bean.nights}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;f:passThroughAttributes</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{bean.nameValuePairs}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/h:inputText&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If the bean used the following <code>Map</code> declaration and initialized the map in the constructor as follows, the markup would be similar to the output of the code that uses the pass-through attribute namespace:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">private</span> <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; nameValuePairs;
...
public Bean() {
    <span class="local-variable">this</span>.nameValuePairs = <span class="keyword">new</span> <span class="predefined-type">HashMap</span>&lt;&gt;();
    <span class="local-variable">this</span>.nameValuePairs.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">number</span><span class="delimiter">&quot;</span></span>);
    <span class="local-variable">this</span>.nameValuePairs.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">min</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>);
    <span class="local-variable">this</span>.nameValuePairs.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">max</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">30</span><span class="delimiter">&quot;</span></span>);
    <span class="local-variable">this</span>.nameValuePairs.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">required</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">required</span><span class="delimiter">&quot;</span></span>);
    <span class="local-variable">this</span>.nameValuePairs.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">Enter a number between 1 and 4 inclusive.</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="the-reservation-example-application"><a class="anchor" href="#the-reservation-example-application"></a>The reservation Example Application</h4>
<div class="paragraph">
<p>The <code>reservation</code> example application provides a set of HTML5 <code>input</code> elements of various types to simulate purchasing tickets for a theatrical event.
It consists of two Facelets pages, <code>reservation.xhtml</code> and <code>confirmation.xhtml</code>, and a backing bean, <code>ReservationBean.java</code>.
The pages use both pass-through attributes and pass-through elements.</p>
</div>
<div class="paragraph">
<p>The source code for this application is in the <code><em>tut-install</em>/examples/web/jsf/reservation/</code> directory.</p>
</div>
<div class="sect4">
<h5 id="the-facelets-pages-for-the-reservation-application"><a class="anchor" href="#the-facelets-pages-for-the-reservation-application"></a>The Facelets Pages for the reservation Application</h5>
<div class="paragraph">
<p>The first important feature of the Facelets pages for the <code>reservation</code> application is the <code>DOCTYPE</code> header.
Most Facelets pages in Jakarta Faces applications refer to the XHTML DTD.
The facelets pages for this application begin simply with the following <code>DOCTYPE</code> header, which indicates an HTML5 page:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="doctype">&lt;!DOCTYPE html&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The namespace declarations in the <code>html</code> element of the <code>reservation.xhtml</code> page specify both the <code>jsf</code> and the <code>passthrough</code> namespaces:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;html</span> <span class="attribute-name">lang</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/1999/xhtml</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xmlns:f</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://xmlns.jcp.org/jsf/core</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xmlns:h</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://xmlns.jcp.org/jsf/html</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xmlns:p</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://xmlns.jcp.org/jsf/passthrough</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xmlns:jsf</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://xmlns.jcp.org/jsf</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Next, an empty <code>h:head</code> tag followed by an <code>h:outputStylesheet</code> tag within the <code>h:body</code> tag illustrates the use of a relocatable resource (as described in <a href="#relocatable-resources">Relocatable Resources</a>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:head&gt;</span>
<span class="tag">&lt;/h:head&gt;</span>
<span class="tag">&lt;h:body&gt;</span>
    <span class="tag">&lt;h:outputStylesheet</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">css/stylesheet.css</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">target</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">head</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>reservation.xhtml</code> page uses pass-through elements for most of the form fields on the page.
This allows it to use some HTML5-specific <code>input</code> element types, such as <code>date</code> and <code>email</code>.
For example, the following element renders both a date format and a calendar from which you can choose a date.
The <code>jsf</code> prefix on the <code>id</code> attribute makes the element a pass-through one:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">    <span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">date</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">jsf:id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">date</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">date</span><span class="delimiter">&quot;</span></span>
           <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{reservationBean.date}</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">required</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">required</span><span class="delimiter">&quot;</span></span>
           <span class="attribute-name">title</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Enter or choose a date.</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The field for the number of tickets, however, uses the <code>h:passThroughAttributes</code> tag to pass a <code>Map</code> defined in the managed bean.
It also recalculates the total in response to a change in the field:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">    <span class="tag">&lt;h:inputText</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">tickets</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{reservationBean.tickets}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;f:passThroughAttributes</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{reservationBean.ticketAttrs}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;f:ajax</span> <span class="attribute-name">event</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">change</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">render</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">total</span><span class="delimiter">&quot;</span></span>
                <span class="attribute-name">listener</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{reservationBean.calculateTotal}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/h:inputText&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The field for the price specifies the <code>number</code> type as a pass-through attribute of the <code>h:inputText</code> element, offering a range of four ticket prices.
Here, the <code>p</code> prefix on the HTML5 attributes passes them through to the browser uninterpreted by the Jakarta Faces input component:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">    <span class="tag">&lt;h:inputText</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">price</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">p:type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">number</span><span class="delimiter">&quot;</span></span>
                 <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{reservationBean.price}</span><span class="delimiter">&quot;</span></span>
                 <span class="attribute-name">p:min</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">80</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">p:max</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">120</span><span class="delimiter">&quot;</span></span>
                 <span class="attribute-name">p:step</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">20</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">p:required</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">required</span><span class="delimiter">&quot;</span></span>
                 <span class="attribute-name">p:title</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Enter a price: 80, 100, 120, or 140.</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;f:ajax</span> <span class="attribute-name">event</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">change</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">render</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">total</span><span class="delimiter">&quot;</span></span>
                <span class="attribute-name">listener</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{reservationBean.calculateTotal}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/h:inputText&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The output of the <code>calculateTotal</code> method that is specified as the listener for the Ajax event is rendered in the output element whose <code>id</code> and <code>name</code> value is <code>total</code>.
See <a href="#using-ajax-with-jakarta-faces-technology">Using Ajax with Jakarta Faces Technology</a>, for more information.</p>
</div>
<div class="paragraph">
<p>The second Facelets page, <code>confirmation.xhtml</code>, uses a pass-through <code>output</code> element to display the values entered by the user and provides a Facelets <code>h:commandButton</code> tag to allow the user to return to the <code>reservation.xhtml</code> page.</p>
</div>
</div>
<div class="sect4">
<h5 id="the-managed-bean-for-the-reservation-application"><a class="anchor" href="#the-managed-bean-for-the-reservation-application"></a>The Managed Bean for the reservation Application</h5>
<div class="paragraph">
<p>The session-scoped managed bean for the reservation application, <code>ReservationBean.java</code>, contains properties for all the elements on the Facelets pages.
It also contains two methods, <code>calculateTotal</code> and <code>clear</code>, that act as listeners for Ajax events on the <code>reservation.xhtml</code> page.</p>
</div>
</div>
<div class="sect4">
<h5 id="to-build-package-and-deploy-the-reservation-example-using-netbeans-ide"><a class="anchor" href="#to-build-package-and-deploy-the-reservation-example-using-netbeans-ide"></a>To Build, Package, and Deploy the reservation Example Using NetBeans IDE</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>From the <strong>File</strong> menu, choose <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the Open Project dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/web/jsf</pre>
</div>
</div>
</li>
<li>
<p>Select the <code>reservation</code> folder.</p>
</li>
<li>
<p>Click <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the <strong>Projects</strong> tab, right-click the <code>reservation</code> project and select <strong>Build</strong>.</p>
<div class="paragraph">
<p>This option builds the example application and deploys it to your GlassFish Server instance.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-build-package-and-deploy-the-reservation-example-using-maven"><a class="anchor" href="#to-build-package-and-deploy-the-reservation-example-using-maven"></a>To Build, Package, and Deploy the reservation Example Using Maven</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>In a terminal window, go to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/web/jsf/reservation/</pre>
</div>
</div>
</li>
<li>
<p>Enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">mvn install</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command builds and packages the application into a WAR file, <code>reservation.war</code>, that is located in the <code>target</code> directory.
It then deploys the WAR file to your GlassFish Server instance.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-run-the-reservation-example"><a class="anchor" href="#to-run-the-reservation-example"></a>To Run the reservation Example</h5>
<div class="paragraph">
<p>At the time of the publication of this tutorial, the browser that most fully implements HTML5 is Google Chrome, and it is recommended that you use it to run this example.
Other browsers are catching up, however, and may work equally well by the time you read this.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Enter the following URL in your web browser:</p>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080/reservation</pre>
</div>
</div>
</li>
<li>
<p>Enter information in the fields of the <code>reservation.xhtml</code> page.</p>
<div class="paragraph">
<p>The Performance Date field has a date field with up and down arrows that allow you to increment and decrement the month, day, and year as well as a larger down arrow that brings up a date editor in calendar form.</p>
</div>
<div class="paragraph">
<p>The Number of Tickets and Ticket Price fields also have up and down arrows that allow you to increment and decrement the values within the allowed range and steps.
The Estimated Total changes when you change either of these two fields.</p>
</div>
<div class="paragraph">
<p>Email addresses and dates are checked for format, but not for validity (you can make a reservation for a past date, for instance).</p>
</div>
</li>
<li>
<p>Click Make Reservation to complete the reservation or Clear to restore the fields to their default values.</p>
</li>
<li>
<p>If you click Make Reservation, the <code>confirmation.xhtml</code> page appears, displaying the submitted values.</p>
<div class="paragraph">
<p>Click Back to return to the <code>reservation.xhtml</code> page.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="expression-language"><a class="anchor" href="#expression-language"></a>Chapter 9. Expression Language</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter introduces the Expression Language (also referred to as the EL), which provides an important mechanism for enabling the presentation layer (web pages) to communicate with the application logic (managed beans).
The EL is used by several Jakarta EE technologies, such as Jakarta Faces technology, Jakarta Server Pages technology, and Dependency Injection for Jakarta EE (CDI).
The EL can also be used in stand-alone environments.
This chapter only covers the use of the EL in Jakarta EE containers.</p>
</div>
<div class="sect2">
<h3 id="overview-of-the-el"><a class="anchor" href="#overview-of-the-el"></a>Overview of the EL</h3>
<div class="paragraph">
<p>The EL allows page authors to use simple expressions to dynamically access data from JavaBeans components.
For example, the <code>test</code> attribute of the following conditional tag is supplied with an EL expression that compares 0 with the number of items in the session-scoped bean named <code>cart</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;c:if</span> <span class="attribute-name">test</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${sessionScope.cart.numberOfItems </span></span><span class="error">&gt;</span> 0}&quot;<span class="error">&gt;</span>
  ...
<span class="tag">&lt;/c:if&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>See <a href="#using-the-el-to-reference-managed-beans">Using the EL to Reference Managed Beans</a> for more information on how to use the EL in Jakarta Faces applications.</p>
</div>
<div class="paragraph">
<p>To summarize, the EL provides a way to use simple expressions to perform the following tasks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Dynamically read application data stored in JavaBeans components, various data structures, and implicit objects</p>
</li>
<li>
<p>Dynamically write data, such as user input into forms, to JavaBeans components</p>
</li>
<li>
<p>Invoke arbitrary static and public methods</p>
</li>
<li>
<p>Dynamically perform arithmetic, boolean, and string operations</p>
</li>
<li>
<p>Dynamically construct collection objects and perform operations on collections</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In a Jakarta Faces page, an EL expression can be used either in static text or in the attribute of a custom tag or standard action.</p>
</div>
<div class="paragraph">
<p>Finally, the EL provides a pluggable API for resolving expressions so that custom resolvers that can handle expressions not already supported by the EL can be implemented.</p>
</div>
</div>
<div class="sect2">
<h3 id="immediate-and-deferred-evaluation-syntax"><a class="anchor" href="#immediate-and-deferred-evaluation-syntax"></a>Immediate and Deferred Evaluation Syntax</h3>
<div class="paragraph">
<p>The EL supports both immediate and deferred evaluation of expressions.
Immediate evaluation means that the expression is evaluated and the result returned as soon as the page is first rendered.
Deferred evaluation means that the technology using the expression language can use its own machinery to evaluate the expression sometime later during the page&#8217;s lifecycle, whenever it is appropriate to do so.</p>
</div>
<div class="paragraph">
<p>Those expressions that are evaluated immediately use the <code>${}</code> syntax. Expressions whose evaluation is deferred use the <code>#{}</code> syntax.</p>
</div>
<div class="paragraph">
<p>Because of its multiphase lifecycle, Jakarta Faces technology uses mostly deferred evaluation expressions.
During the lifecycle, component events are handled, data is validated, and other tasks are performed in a particular order.
Therefore, a Jakarta Faces implementation must defer evaluation of expressions until the appropriate point in the lifecycle.</p>
</div>
<div class="paragraph">
<p>Other technologies using the EL might have different reasons for using deferred expressions.</p>
</div>
<div class="sect3">
<h4 id="immediate-evaluation"><a class="anchor" href="#immediate-evaluation"></a>Immediate Evaluation</h4>
<div class="paragraph">
<p>All expressions using the <code>${}</code> syntax are evaluated immediately.
These expressions can appear as part of a template (static) text or as the value of a tag attribute that can accept runtime expressions.</p>
</div>
<div class="paragraph">
<p>The following example shows a tag whose <code>value</code> attribute references an immediate evaluation expression that updates the quantity of books retrieved from the backing bean named <code>catalog</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:outputText</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${catalog.bookQuantity}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The Jakarta Faces implementation evaluates the expression <code>${catalog.bookQuantity}</code>, converts it, and passes the returned value to the tag handler. The value is updated on the page.</p>
</div>
</div>
<div class="sect3">
<h4 id="deferred-evaluation"><a class="anchor" href="#deferred-evaluation"></a>Deferred Evaluation</h4>
<div class="paragraph">
<p>Deferred evaluation expressions take the form <code>#{expr}</code> and can be evaluated at other phases of a page lifecycle as defined by whatever technology is using the expression.
In the case of Jakarta Faces technology, its controller can evaluate the expression at different phases of the lifecycle, depending on how the expression is being used in the page.</p>
</div>
<div class="paragraph">
<p>The following example shows a Jakarta Faces <code>h:inputText</code> tag, which represents a field component into which a user enters a value.
The <code>h:inputText</code> tag&#8217;s <code>value</code> attribute references a deferred evaluation expression that points to the <code>name</code> property of the <code>customer</code> bean:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:inputText</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{customer.name}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For an initial request of the page containing this tag, the Jakarta Faces implementation evaluates the <code>#{customer.name}</code> expression during the render-response phase of the lifecycle.
During this phase, the expression merely accesses the value of <code>name</code> from the <code>customer</code> bean, as is done in immediate evaluation.</p>
</div>
<div class="paragraph">
<p>For a postback request, the Jakarta Faces implementation evaluates the expression at different phases of the lifecycle, during which the value is retrieved from the request, validated, and propagated to the <code>customer</code> bean.</p>
</div>
<div class="paragraph">
<p>As shown in this example, deferred evaluation expressions can be</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Value expressions that can be used to both read and write data</p>
</li>
<li>
<p>Method expressions</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Value expressions (both immediate and deferred) and method expressions are explained in the next section.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="value-and-method-expressions"><a class="anchor" href="#value-and-method-expressions"></a>Value and Method Expressions</h3>
<div class="paragraph">
<p>The EL defines two kinds of expressions: value expressions and method expressions.
Value expressions can be evaluated to yield a value, and method expressions are used to reference a method.</p>
</div>
<div class="sect3">
<h4 id="value-expressions"><a class="anchor" href="#value-expressions"></a>Value Expressions</h4>
<div class="paragraph">
<p>Value expressions can be further categorized into <em>rvalue</em> and <em>lvalue</em> expressions.
An <em>lvalue</em> expression can specify a target, such as an object, a bean property, or elements of a collection, that can be assigned a value.
An <em>rvalue</em> expression cannot specify such a target.</p>
</div>
<div class="paragraph">
<p>All expressions that are evaluated immediately use the <code>${}</code> delimiters, and although the expression can be an <em>lvalue</em> expression, no assignments will ever happen.
Expressions whose evaluation can be deferred use the <code>#{}</code> delimiters and can act as both <em>rvalue</em> and <em>lvalue</em> expressions; if the expression is an <em>lvalue</em> expression, it can be assigned a new value.
Consider the following two value expressions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="error">$</span>{customer.name}

<span class="error">#</span>{customer.name}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The former uses immediate evaluation syntax, whereas the latter uses deferred evaluation syntax.
The first expression accesses the <code>name</code> property, gets its value, and passes the value to the tag handler.
With the second expression, the tag handler can defer the expression evaluation to a later time in the page lifecycle if the technology using this tag allows.</p>
</div>
<div class="paragraph">
<p>In the case of Jakarta Faces technology, the latter tag&#8217;s expression is evaluated immediately during an initial request for the page.
During a postback request, this expression can be used to set the value of the <code>name</code> property with user input.</p>
</div>
<div class="sect4">
<h5 id="referencing-objects"><a class="anchor" href="#referencing-objects"></a>Referencing Objects</h5>
<div class="paragraph">
<p>A top-level identifier (such as <code>customer</code> in the expression <code>customer.name</code>) can refer to the following objects:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Lambda parameters</p>
</li>
<li>
<p>EL variables</p>
</li>
<li>
<p>Managed beans</p>
</li>
<li>
<p>Implicit objects</p>
</li>
<li>
<p>Classes of static fields and methods</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To refer to these objects, you write an expression using a variable that is the name of the object.
The following expression references a managed bean called <code>customer</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="error">$</span>{customer}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use a custom EL resolver to alter the way variables are resolved.
For instance, you can provide an EL resolver that intercepts objects with the name <code>customer</code>, so that <code>${customer}</code> returns a value in the EL resolver instead.
(Jakarta Faces technology uses an EL resolver to handle managed beans.)</p>
</div>
<div class="paragraph">
<p>An <code>enum</code> constant is a special case of a static field, and you can reference such a constant directly.
For example, consider this <code>enum</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">enum</span> Suit {hearts, spades, diamonds, clubs}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the following expression, in which <code>mySuit</code> is an instance of <code>Suit</code>, you can compare <code>suit.hearts</code> to the instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="error">$</span>{mySuit == suit.hearts}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="referencing-object-properties-or-collection-elements"><a class="anchor" href="#referencing-object-properties-or-collection-elements"></a>Referencing Object Properties or Collection Elements</h5>
<div class="paragraph">
<p>To refer to properties of a bean, static fields or methods of a class, or items of a collection, you use the <code>.</code> or <code>[]</code> notation.
The same syntax can be used for attributes of an implicit object, because attributes are placed in a map.</p>
</div>
<div class="paragraph">
<p>To reference the <code>name</code> property of the <code>customer</code> bean, use either the expression <code>${customer.name}</code> or the expression <code>${customer["name"]}</code>.
Here, the part inside the brackets is a <code>String</code> literal that is the name of the property to reference.
The <code>[]</code> syntax is more general than the <code>.</code> syntax, because the part inside the brackets can be any <code>String</code> expression, not just literals.</p>
</div>
<div class="paragraph">
<p>You can use double or single quotes for the <code>String</code> literal. You can also combine the <code>[]</code> and <code>.</code> notations, as shown here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="error">$</span>{customer.address[<span class="string"><span class="delimiter">&quot;</span><span class="content">street</span><span class="delimiter">&quot;</span></span>]}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can reference a static field or method using the syntax classname.field, as in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Boolean</span>.FALSE</code></pre>
</div>
</div>
<div class="paragraph">
<p>The classname is the name of the class without the package name.
By default, all the <code>java.lang</code> packages are imported.
You can import other packages, classes, and static fields as needed.</p>
</div>
<div class="paragraph">
<p>If you are accessing an item in an array or list, you must use the <code>[]</code> notation and specify an index in the array or list.
The index is an expression that can be converted to <code>int</code>.
The following example references the first of the customer orders, assuming that <code>customer.orders</code> is a <code>List</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="error">$</span>{customer.orders[<span class="integer">1</span>]}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you are accessing an item in a <code>Map</code>, you must specify the key for the <code>Map</code>.
If the key is a <code>String</code> literal, the dot (<code>.)</code> notation can be used.
Assuming that <code>customer.orders</code> is a <code>Map</code> with a <code>String</code> key, the following examples reference the item with the key <code>"socks"</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="error">$</span>{customer.orders[<span class="string"><span class="delimiter">&quot;</span><span class="content">socks</span><span class="delimiter">&quot;</span></span>]}

<span class="error">$</span>{customer.orders.socks}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="referencing-literals"><a class="anchor" href="#referencing-literals"></a>Referencing Literals</h5>
<div class="paragraph">
<p>The EL defines the following literals:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Boolean: <code>true</code> and <code>false</code></p>
</li>
<li>
<p>Integer: As in Java</p>
</li>
<li>
<p>Floating-point: As in Java</p>
</li>
<li>
<p>String: With single and double quotes; <code>"</code> is escaped as <code>\"</code>, <code>'</code> is
escaped as <code>\'</code>, and <code>\</code> is escaped as <code>\\</code></p>
</li>
<li>
<p>Null: <code>null</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Here are some examples:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>${"literal"}</code></p>
</li>
<li>
<p><code>${true}</code></p>
</li>
<li>
<p><code>${57}</code></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="parameterized-method-calls"><a class="anchor" href="#parameterized-method-calls"></a>Parameterized Method Calls</h5>
<div class="paragraph">
<p>The EL offers support for parameterized method calls.</p>
</div>
<div class="paragraph">
<p>Both the <code>.</code> and <code>[]</code> operators can be used for invoking method calls with parameters, as shown in the following expression syntax:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code><em>expr-a</em>[<em>expr-b</em>](<em>parameters</em>)</code></p>
</li>
<li>
<p><code><em>expr-a</em>.<em>identifier-b</em>(<em>parameters</em>)</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the first expression syntax, <em>expr-a</em> is evaluated to represent a bean object.
The expression <em>expr-b</em> is evaluated and cast to a string that represents a method in the bean represented by <em>expr-a</em>.
In the second expression syntax, <em>expr-a</em> is evaluated to represent a bean object, and <em>identifier-b</em> is a string that represents a method in the bean object.
The <em>parameters</em> in parentheses are the arguments for the method invocation.
Parameters can be zero or more values of expressions, separated by commas.</p>
</div>
<div class="paragraph">
<p>Parameters are supported for both value expressions and method expressions.
In the following example, which is a modified tag from the <code>guessnumber</code> application, a random number is provided as an argument rather than from user input to the method call:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:inputText</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{userNumberBean.userNumber('5')}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The preceding example uses a value expression.</p>
</div>
<div class="paragraph">
<p>Consider the following example of a Jakarta Faces component tag that uses a method expression:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:commandButton</span> <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{trader.buy}</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">buy</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The EL expression <code>trader.buy</code> calls the <code>trader</code> bean&#8217;s <code>buy</code> method.
You can modify the tag to pass on a parameter.
Here is the revised tag in which a parameter is passed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:commandButton</span> <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{trader.buy('SOMESTOCK')}</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">buy</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the preceding example, you are passing the string <code>'SOMESTOCK'</code> (a stock symbol) as a parameter to the <code>buy</code> method.</p>
</div>
</div>
<div class="sect4">
<h5 id="where-value-expressions-can-be-used"><a class="anchor" href="#where-value-expressions-can-be-used"></a>Where Value Expressions Can Be Used</h5>
<div class="paragraph">
<p>Value expressions using the <code>${}</code> delimiters can be used</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In static text</p>
</li>
<li>
<p>In any standard or custom tag attribute that can accept an expression</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The value of an expression in static text is computed and inserted into the current output.
Here is an example of an expression embedded in static text:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;some:tag&gt;</span>
    some text ${expr} some text
<span class="tag">&lt;/some:tag&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A tag attribute can be set in the following ways.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>With a single expression construct:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;some:tag</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${expr}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;another:tag</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{expr}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>These expressions are evaluated, and the result is converted to the attribute&#8217;s expected type.</p>
</div>
</li>
<li>
<p>With one or more expressions separated or surrounded by text:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;some:tag</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">some${expr}${expr}text${expr}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;another:tag</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">some#{expr}#{expr}text#{expr}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>These kinds of expression, called composite expressions, are evaluated from left to right.
Each expression embedded in the composite expression is converted to a <code>String</code> and then concatenated with any intervening text.
The resulting <code>String</code> is then converted to the attribute&#8217;s expected type.</p>
</div>
</li>
<li>
<p>With text only:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;some:tag</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sometext</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The attribute&#8217;s <code>String</code> value is converted to the attribute&#8217;s expected type.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can use the string concatenation operator <code>+=</code> to create a single expression from what would otherwise be a composite expression. For example, you could change the composite expression</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;some:tag</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sometext ${expr} moretext</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>to</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;some:tag</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${sometext += expr += moretext}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>All expressions used to set attribute values are evaluated in the context of an expected type.
If the result of the expression evaluation does not match the expected type exactly, a type conversion will be performed.
For example, the expression <code>${1.2E4}</code> provided as the value of an attribute of type <code>float</code> will result in the following conversion:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Float</span>.valueOf(<span class="string"><span class="delimiter">&quot;</span><span class="content">1.2E4</span><span class="delimiter">&quot;</span></span>).floatValue()</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="method-expressions"><a class="anchor" href="#method-expressions"></a>Method Expressions</h4>
<div class="paragraph">
<p>Another feature of the EL is its support of deferred method expressions.
A method expression is used to refer to a public method of a bean and has the same syntax as an <em>lvalue</em> expression.</p>
</div>
<div class="paragraph">
<p>In Jakarta Faces technology, a component tag represents a component on a page.
The component tag uses method expressions to specify methods that can be invoked to perform some processing for the component.
These methods are necessary for handling events that the components generate and for validating component data, as shown in this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:form&gt;</span>
    <span class="tag">&lt;h:inputText</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>
                 <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{customer.name}</span><span class="delimiter">&quot;</span></span>
                 <span class="attribute-name">validator</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{customer.validateName}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;h:commandButton</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">submit</span><span class="delimiter">&quot;</span></span>
                     <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{customer.submit}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/h:form&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>h:inputText</code> tag displays as a field. The <code>validator</code> attribute of this <code>h:inputText</code> tag references a method, called <code>validateName</code>, in the bean, called <code>customer</code>.</p>
</div>
<div class="paragraph">
<p>Because a method can be invoked during different phases of the lifecycle, method expressions must always use the deferred evaluation syntax.</p>
</div>
<div class="paragraph">
<p>Like lvalue expressions, method expressions can use the <code>.</code> and the <code>[]</code> operators.
For example, <code>#{object.method}</code> is equivalent to #<code>{object["method"]}</code>.
The literal inside the <code>[]</code> is converted to <code>String</code> and is used to find the name of the method that matches it.</p>
</div>
<div class="paragraph">
<p>Method expressions can be used only in tag attributes and only in the following ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>With a single expression construct, where bean refers to a JavaBeans component and method refers to a method of the JavaBeans component:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;some:tag</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{bean.method}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The expression is evaluated to a method expression, which is passed to the tag handler.
The method represented by the method expression can then be invoked later.</p>
</div>
</li>
<li>
<p>With text only:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;some:tag</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sometext</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Method expressions support literals primarily to support <code>action</code> attributes in Jakarta Faces technology.
When the method referenced by this method expression is invoked, the method returns the <code>String</code> literal, which is then converted to the expected return type, as defined in the tag&#8217;s tag library descriptor.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="lambda-expressions"><a class="anchor" href="#lambda-expressions"></a>Lambda Expressions</h4>
<div class="paragraph">
<p>A lambda expression is a value expression with parameters.
The syntax is similar to that of the lambda expression in the Java programming language, except that in the EL, the body of the lambda expression is an EL expression.</p>
</div>
<div class="paragraph">
<p>For basic information on lambda expressions, see <a href="https://docs.oracle.com/javase/tutorial/java/javaOO/lambdaexpressions.html" class="bare" target="_blank" rel="noopener">https://docs.oracle.com/javase/tutorial/java/javaOO/lambdaexpressions.html</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Lambda expressions are part of Java SE 8
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A lambda expression uses the arrow token (<code>-&gt;</code>) operator.
The identifiers to the left of the operator are called lambda parameters.
The body, to the right of the operator, must be an EL expression.
The lambda parameters are enclosed in parentheses; the parentheses can be omitted if there is only one parameter.
Here are some examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">x -&gt; x+<span class="integer">1</span>
(x, y) -&gt; x + y
() -&gt; <span class="integer">64</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A lambda expression behaves like a function.
It can be invoked immediately.
For example, the following invocation evaluates to 7:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">((x, y) -&gt; x + y)(<span class="integer">3</span>, <span class="integer">4</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use a lambda expression in conjunction with the assignment and semicolon operators.
For example, the following code assigns the previous lambda expression to a variable and then invokes it.
The result is again 7:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">v = (x, y) -&gt; x + y; v(<span class="integer">3</span>, <span class="integer">4</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>A lambda expression can also be passed as an argument to a method and be invoked in the method.
It can also be nested in another lambda expression.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="operations-on-collection-objects"><a class="anchor" href="#operations-on-collection-objects"></a>Operations on Collection Objects</h3>
<div class="paragraph">
<p>The EL supports operations on collection objects: sets, lists, and maps.
It allows the dynamic creation of collection objects, which can then be operated on using streams and pipelines.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Like lambda expressions, operations on collection objects are part of Java SE 8.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For example, you can construct a set as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">{<span class="integer">1</span>,<span class="integer">2</span>,<span class="integer">3</span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can construct a list as follows; a list can contain various types of items:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">[<span class="integer">1</span>,<span class="integer">2</span>,<span class="integer">3</span>]
[<span class="integer">1</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">two</span><span class="delimiter">&quot;</span></span>, [three,four]]</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can construct a map by using a colon to define the entries, as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">{<span class="string"><span class="delimiter">&quot;</span><span class="content">one</span><span class="delimiter">&quot;</span></span>:<span class="integer">1</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">two</span><span class="delimiter">&quot;</span></span>:<span class="integer">2</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">three</span><span class="delimiter">&quot;</span></span>:<span class="integer">3</span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You operate on collection objects using method calls to the stream of elements derived from the collection.
Some operations return another stream, which allows additional operations.
Therefore, you can chain these operations together in a pipeline.</p>
</div>
<div class="paragraph">
<p>A stream pipeline consists of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A source (the <code>Stream</code> object)</p>
</li>
<li>
<p>Any number of intermediate operations that return a stream (for example, <code>filter</code> and <code>map</code>)</p>
</li>
<li>
<p>A terminal operation that does not return a stream (for example, <code>toList()</code>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>stream</code> method obtains a <code>Stream</code> from a <code>java.util.Collection</code> or a Java array.
The stream operations do not modify the original collection object.</p>
</div>
<div class="paragraph">
<p>For example, you might generate a list of titles of history books as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">books.stream().filter(b-&gt;b.category == <span class="string"><span class="delimiter">&quot;</span><span class="content">history</span><span class="delimiter">&quot;</span></span>)
              .map(b-&gt;b.title)
              .toList()</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following simpler example returns a sorted version of the original list:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">[<span class="integer">1</span>,<span class="integer">3</span>,<span class="integer">5</span>,<span class="integer">2</span>].stream().sorted().toList()</code></pre>
</div>
</div>
<div class="paragraph">
<p>Streams and stream operations are documented in the Java SE 8 API documentation, available at <a href="https://docs.oracle.com/javase/8/docs/api/" class="bare" target="_blank" rel="noopener">https://docs.oracle.com/javase/8/docs/api/</a>.
The following subset of operations is supported by the EL:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 50%;">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>allMatch</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>anyMatch</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>average</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>count</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>distinct</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>filter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>findFirst</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>flatMap</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>forEach</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>iterator</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>limit</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>map</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>max</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>min</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>noneMatch</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>peek</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>reduce</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sorted</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>substream</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sum</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>toArray</code></p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>toList</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>See the Expression Language specification at <a href="https://jakarta.ee/specifications/expression-language/4.0/" class="bare" target="_blank" rel="noopener">https://jakarta.ee/specifications/expression-language/4.0/</a> for details on these operations.</p>
</div>
</div>
<div class="sect2">
<h3 id="operators"><a class="anchor" href="#operators"></a>Operators</h3>
<div class="paragraph">
<p>In addition to the <code>.</code> and <code>[]</code> operators discussed in <a href="#value-and-method-expressions">Value and Method Expressions</a>, the EL provides the following operators, which can be used in rvalue expressions only.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Arithmetic: <code>+</code>, <code>-</code> (binary), <code>*</code>, <code>/</code> and <code>div</code>, <code>%</code> and <code>mod</code>, <code>-</code> (unary).</p>
</li>
<li>
<p>String concatenation: <code>+=</code>.</p>
</li>
<li>
<p>Logical: <code>and</code>, <code>&amp;&amp;</code>, <code>or</code>, <code>||</code>, <code>not</code>, <code>!</code>.</p>
</li>
<li>
<p>Relational: <code>==</code>, <code>eq</code>, <code>!=</code>, <code>ne</code>, <code>&lt;</code>, <code>lt</code>, <code>&gt;</code>, <code>gt</code>, <code>&lt;=</code>, <code>ge</code>, <code>&gt;=</code>, <code>le</code>.
Comparisons can be made against other values or against Boolean, string, integer, or floating-point literals.</p>
</li>
<li>
<p>Empty: The <code>empty</code> operator is a prefix operation that can be used to determine whether a value is <code>null</code> or empty.</p>
</li>
<li>
<p>Conditional: <code>A ? B : C</code>. Evaluate <code>B</code> or <code>C</code>, depending on the result of the evaluation of <code>A</code>.</p>
</li>
<li>
<p>Lambda expression: <code>-&gt;</code>, the arrow token.</p>
</li>
<li>
<p>Assignment: <code>=</code>.</p>
</li>
<li>
<p>Semicolon: <code>;</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The precedence of operators, highest to lowest, left to right, is as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>[] .</code></p>
</li>
<li>
<p><code>()</code> (used to change the precedence of operators)</p>
</li>
<li>
<p><code>-</code> (unary) <code>not ! empty</code></p>
</li>
<li>
<p><code>* / div % mod</code></p>
</li>
<li>
<p><code>+ -</code> (binary)</p>
</li>
<li>
<p><code>+=</code></p>
</li>
<li>
<p><code>&lt;&gt; &lt;= &gt;= lt gt le ge</code></p>
</li>
<li>
<p><code>== != eq ne</code></p>
</li>
<li>
<p><code>&amp;&amp; and</code></p>
</li>
<li>
<p><code>|| or</code></p>
</li>
<li>
<p><code>? :</code></p>
</li>
<li>
<p><code>-&gt;</code></p>
</li>
<li>
<p><code>=</code></p>
</li>
<li>
<p><code>;</code></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="reserved-words"><a class="anchor" href="#reserved-words"></a>Reserved Words</h3>
<div class="paragraph">
<p>The following words are reserved for the EL and should not be used as identifiers:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 50%;">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>and</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>or</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>not</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>eq</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ne</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>lt</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>gt</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>le</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ge</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>null</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>instanceof</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>empty</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>div</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mod</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="examples-of-el-expressions"><a class="anchor" href="#examples-of-el-expressions"></a>Examples of EL Expressions</h3>
<div class="paragraph">
<p><a href="#example-expressions">Table 9-1</a> contains example EL expressions and the result of evaluating them.</p>
</div>
<table id="example-expressions" class="tableblock frame-all grid-all" style="width: 80%;">
<caption class="title">Table 9-1 Example Expressions</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">EL Expression</th>
<th class="tableblock halign-left valign-top">Result</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${1 &gt; (4/2)}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${4.0 &gt;= 3}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${100.0 == 100}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${(10*10) ne 100}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${'a' &gt; 'b'}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${'hip' lt 'hit'}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${4 &gt; 3}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${1.2E4 + 1.4}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>12001.4</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${3 div 4}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0.75</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${10 mod 4}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${((x, y) &#8594; x + y)(3, 5.5)}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>8.5</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[1,2,3,4].stream().sum()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>10</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[1,3,5,2].stream().sorted().toList()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[1, 2, 3, 5]</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${!empty param.Add}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>False</code> if the request parameter named <code>Add</code> is <code>null</code> or an empty string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${pageContext.request.contextPath}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The context path</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${sessionScope.cart.numberOfItems}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The value of the <code>numberOfItems</code> property of the session-scoped attribute named <code>cart</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${param['mycom.productId']}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The value of the request parameter named <code>mycom.productId</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${header["host"]}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The host</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${departments[deptName]}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The value of the entry named <code>deptName</code> in the <code>departments</code> map</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${requestScope['jakarta.servlet.forward.servlet_path']}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The value of the request-scoped attribute named <code>jakarta.servlet.forward.servlet_path</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>#{customer.lName}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gets the value of the property <code>lName</code> from the <code>customer</code> bean during an initial request; sets the value of <code>lName</code> during a postback</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>#{customer.calcTotal}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The return value of the method <code>calcTotal</code> of the <code>customer</code> bean</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="further-information-about-the-expression-language"><a class="anchor" href="#further-information-about-the-expression-language"></a>Further Information about the Expression Language</h3>
<div class="paragraph">
<p>For more information about the Expression Language, see</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The Expression Language 4.0 specification:<br>
<a href="https://jakarta.ee/specifications/expression-language/4.0/" class="bare" target="_blank" rel="noopener">https://jakarta.ee/specifications/expression-language/4.0/</a></p>
</li>
<li>
<p>The EL specification website:<br>
<a href="https://github.com/eclipse-ee4j/el-ri/tree/master/spec" class="bare" target="_blank" rel="noopener">https://github.com/eclipse-ee4j/el-ri/tree/master/spec</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using-jakarta-faces-technology-in-web-pages"><a class="anchor" href="#using-jakarta-faces-technology-in-web-pages"></a>Chapter 10. Using Jakarta Faces Technology in Web Pages</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Web pages (Facelets pages, in most cases) represent the presentation layer for web applications.
The process of creating web pages for a Jakarta Faces application includes using component tags to add components to the page and wire them to backing beans, validators, listeners, converters, and other server-side objects that are associated with the page.</p>
</div>
<div class="paragraph">
<p>This chapter explains how to create web pages using various types of component and core tags.
In the next chapter, you will learn about adding converters, validators, and listeners to component tags to provide additional functionality to components.</p>
</div>
<div class="paragraph">
<p>Many of the examples in this chapter are taken from <a href="#dukes-bookstore-case-study-example">Chapter 61, <em>Duke&#8217;s Bookstore Case Study Example</em></a></p>
</div>
<div class="sect2">
<h3 id="setting-up-a-page"><a class="anchor" href="#setting-up-a-page"></a>Setting Up a Page</h3>
<div class="paragraph">
<p>A typical Jakarta Faces web page includes the following elements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A set of namespace declarations that declare the Jakarta Faces tag libraries</p>
</li>
<li>
<p>Optionally, the HTML head (<code>h:head</code>) and body (<code>h:body</code>) tags</p>
</li>
<li>
<p>A form tag (<code>h:form</code>) that represents the user input components</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To add the Jakarta Faces components to your web page, you need to provide the page access to the two standard tag libraries: the Jakarta Faces HTML render kit tag library and the Jakarta Faces core tag library.
The <a href="https://jakarta.ee/specifications/faces/3.0/renderkitdoc/" target="_blank" rel="noopener">Jakarta Faces standard HTML tag library</a> defines tags that represent common HTML user interface components.
The Jakarta Faces core tag library defines tags that perform core actions and are independent of a particular render kit.</p>
</div>
<div class="paragraph">
<p>For a complete list of Jakarta Faces Facelets tags and their attributes, refer to the <a href="https://jakarta.ee/specifications/faces/3.0/vdldoc/" target="_blank" rel="noopener">Jakarta Faces Facelets Tag Library documentation</a>.</p>
</div>
<div class="paragraph">
<p>To use any of the Jakarta Faces tags, you need to include appropriate directives at the top of each page specifying the tag libraries.</p>
</div>
<div class="paragraph">
<p>For Facelets applications, the XML namespace directives uniquely identify the tag library URI and the tag prefix.</p>
</div>
<div class="paragraph">
<p>For example, when you create a Facelets XHTML page, include namespace directives as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;html</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/1999/xhtml</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xmlns:h</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://xmlns.jcp.org/jsf/html</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xmlns:f</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://xmlns.jcp.org/jsf/core</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The XML namespace URI identifies the tag library location, and the prefix value is used to distinguish the tags belonging to that specific tag library.
You can also use other prefixes instead of the standard <code>h</code> or <code>f</code>.
However, when including the tag in the page you must use the prefix that you have chosen for the tag library.
For example, in the following web page the <code>form</code> tag must be referenced using the <code>h</code> prefix because the preceding tag library directive uses the <code>h</code> prefix to distinguish the tags defined in the HTML tag library:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:form</span> <span class="attribute-name">...</span><span class="tag">&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The sections <a href="#adding-components-to-a-page-using-html-tag-library-tags">Adding Components to a Page Using HTML Tag Library Tags</a> and <a href="#using-core-tags">Using Core Tags</a> describe how to use the component tags from the Jakarta Faces standard HTML tag library and the core tags from the Jakarta Faces core tag library.</p>
</div>
</div>
<div class="sect2">
<h3 id="adding-components-to-a-page-using-html-tag-library-tags"><a class="anchor" href="#adding-components-to-a-page-using-html-tag-library-tags"></a>Adding Components to a Page Using HTML Tag Library Tags</h3>
<div class="paragraph">
<p>The tags defined by the Jakarta Faces standard HTML tag library represent HTML form components and other basic HTML elements.
These components display data or accept data from the user.
This data is collected as part of a form and is submitted to the server, usually when the user clicks a button.
This section explains how to use each of the component tags shown in <a href="#the-component-tags">Table 10-1</a>.</p>
</div>
<table id="the-component-tags" class="tableblock frame-all grid-all" style="width: 99%;">
<caption class="title">Table 10-1 The Component Tags</caption>
<colgroup>
<col style="width: 15%;">
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Tag</th>
<th class="tableblock halign-left valign-top">Functions</th>
<th class="tableblock halign-left valign-top">Rendered As</th>
<th class="tableblock halign-left valign-top">Appearance</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>h:column</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Represents a column of data in a data component</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A column of data in an HTML table</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A column in a table</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>h:commandButton</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Submits a form to the application</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An HTML <code>&lt;input type=<em>value</em>&gt;</code> element for which the <code>type</code> value can be &#8220;submit&#8221;, &#8220;reset&#8221;, or &#8220;image&#8221;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A button</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>h:commandLink</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Links to another page or location on a page</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An HTML <code>&lt;a href&gt;</code> element</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A link</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>h:dataTable</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Represents a data wrapper</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An HTML <code>&lt;table&gt;</code> element</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A table that can be updated dynamically</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>h:form</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Represents an input form (inner tags of the form receive the data that will be submitted with the form)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An HTML <code>&lt;form&gt;</code> element</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No appearance</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>h:graphicImage</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Displays an image</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An HTML <code>&lt;img&gt;</code> element</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An image</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>h:inputFile</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows a user to upload a file</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An HTML <code>&lt;input type="file"&gt;</code> element</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A field with a Browse&#8230;&#8203; button</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>h:inputHidden</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows a page author to include a hidden variable in a page</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An HTML <code>&lt;input type="hidden"&gt;</code> element</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No appearance</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>h:inputSecret</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows a user to input a string without the actual string appearing in the field</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An HTML <code>&lt;input type="password"&gt;</code> element</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A field that displays a row of characters instead of the actual string entered</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>h:inputText</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows a user to input a string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An HTML <code>&lt;input type="text"&gt;</code> element</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A field</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>h:inputTextarea</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows a user to enter a multiline string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An HTML <code>&lt;textarea&gt;</code> element</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A multirow field</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>h:message</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Displays a localized message</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An HTML <code>&lt;span&gt;</code> tag if styles are used</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A text string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>h:messages</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Displays localized messages</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A set of HTML <code>&lt;span&gt;</code> tags if styles are used</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A text string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>h:outputFormat</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Displays a formatted message</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Plain text</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Plain text</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>h:outputLabel</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Displays a nested component as a label for a specified input field</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An HTML <code>&lt;label&gt;</code> element</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Plain text</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>h:outputLink</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Links to another page or location on a page without generating an action event</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An HTML <code>&lt;a&gt;</code> element</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A link</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>h:outputText</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Displays a line of text</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Plain text</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Plain text</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>h:panelGrid</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Displays a table</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An HTML <code>&lt;table&gt;</code> element with <code>&lt;tr&gt;</code> and <code>&lt;td&gt;</code> elements</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A table</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>h:panelGroup</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Groups a set of components under one parent</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A HTML <code>&lt;div&gt;</code> or <code>&lt;span&gt;</code> element</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A row in a table</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>h:selectBooleanCheckbox</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows a user to change the value of a Boolean choice</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An HTML <code>&lt;input type="checkbox"&gt;</code> element</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A check box</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>h:selectManyCheckbox</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Displays a set of check boxes from which the user can select multiple values</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A set of HTML <code>&lt;input&gt;</code> elements of type <code>checkbox</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A group of check boxes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>h:selectManyListbox</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows a user to select multiple items from a set of items all displayed at once</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An HTML <code>&lt;select&gt;</code> element</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A box</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>h:selectManyMenu</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows a user to select multiple items from a set of items</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An HTML <code>&lt;select&gt;</code> element</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A menu</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>h:selectOneListbox</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows a user to select one item from a set of items all displayed at once</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An HTML <code>&lt;select&gt;</code> element</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A box</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>h:selectOneMenu</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows a user to select one item from a set of items</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An HTML <code>&lt;select&gt;</code> element</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A menu</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>h:selectOneRadio</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows a user to select one item from a set of items</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An HTML <code>&lt;input type="radio"&gt;</code> element</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A group of options</p>
</div>
<div class="paragraph">
<p>For a standalone radio button, use the <code>group</code> attribute.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The tags correspond to components in the <code>jakarta.faces.component</code> package.
The components are discussed in more detail in <a href="#developing-with-jakarta-faces-technology">Chapter 12, <em>Developing with Jakarta Faces Technology</em></a></p>
</div>
<div class="paragraph">
<p>The next section explains the important attributes that are common to most component tags.
For each of the components discussed in the following sections, <a href="#writing-bean-properties">Writing Bean Properties</a> explains how to write a bean property bound to that particular component or its value.</p>
</div>
<div class="paragraph">
<p>For reference information about the tags and their attributes, see the <a href="https://jakarta.ee/specifications/faces/3.0/vdldoc/" target="_blank" rel="noopener">Jakarta Faces Facelets Tag Library documentation</a>.</p>
</div>
<div class="sect3">
<h4 id="common-component-tag-attributes"><a class="anchor" href="#common-component-tag-attributes"></a>Common Component Tag Attributes</h4>
<div class="paragraph">
<p>Most of the component tags support the attributes shown in <a href="#common-tag-attributes">Table 10-2</a>.</p>
</div>
<table id="common-tag-attributes" class="tableblock frame-all grid-all" style="width: 80%;">
<caption class="title">Table 10-2 Common Component Tag Attributes</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>binding</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Identifies a bean property and binds the component instance to it.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uniquely identifies the component.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>immediate</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>If set to <code>true</code>, indicates that any events, validation, and conversion associated with the component should happen when request parameter values are applied.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rendered</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies a condition under which the component should be rendered.
If the condition is not satisfied, the component is not rendered.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>style</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies a Cascading Style Sheet (CSS) style for the tag.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>styleClass</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies a CSS class that contains definitions of the styles.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>value</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the value of the component in the form of a value expression.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>All the tag attributes except <code>id</code> can accept expressions, as defined by the Expression Language, described in <a href="#expression-language">Chapter 9, <em>Expression Language</em></a>.</p>
</div>
<div class="paragraph">
<p>An attribute such as <code>rendered</code> or <code>value</code> can be set on the page and then modified in the backing bean for the page.</p>
</div>
<div class="sect4">
<h5 id="the-id-attribute"><a class="anchor" href="#the-id-attribute"></a>The id Attribute</h5>
<div class="paragraph">
<p>The <code>id</code> attribute is not usually required for a component tag but is used when another component or a server-side class must refer to the component.
If you don&#8217;t include an <code>id</code> attribute, the Jakarta Faces implementation automatically generates a component ID.
Unlike most other Jakarta Faces tag attributes, the <code>id</code> attribute takes expressions using only the evaluation syntax described in <a href="#immediate-evaluation">Immediate Evaluation</a>, which uses the <code>${}</code> delimiters.
For more information on expression syntax, see <a href="#value-expressions">Value Expressions</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="the-immediate-attribute"><a class="anchor" href="#the-immediate-attribute"></a>The immediate Attribute</h5>
<div class="paragraph">
<p>Input components and command components (those that implement the <code>ActionSource</code> interface, such as buttons and links) can set the <code>immediate</code> attribute to <code>true</code> to force events, validations, and conversions to be processed when request parameter values are applied.</p>
</div>
<div class="paragraph">
<p>You need to carefully consider how the combination of an input component&#8217;s <code>immediate</code> value and a command component&#8217;s <code>immediate</code> value determines what happens when the command component is activated.</p>
</div>
<div class="paragraph">
<p>Suppose that you have a page with a button and a field for entering the quantity of a book in a shopping cart.
If the <code>immediate</code> attributes of both the button and the field are set to <code>true</code>, the new value entered in the field will be available for any processing associated with the event that is generated when the button is clicked.
The event associated with the button as well as the events, validation, and conversion associated with the field are all handled when request parameter values are applied.</p>
</div>
<div class="paragraph">
<p>If the button&#8217;s <code>immediate</code> attribute is set to <code>true</code> but the field&#8217;s <code>immediate</code> attribute is set to <code>false</code>, the event associated with the button is processed without updating the field&#8217;s local value to the model layer.
The reason is that any events, conversion, and validation associated with the field occur after request parameter values are applied.</p>
</div>
<div class="paragraph">
<p>The <code>bookshowcart.xhtml</code> page of the Duke&#8217;s Bookstore case study has examples of components using the <code>immediate</code> attribute to control which component&#8217;s data is updated when certain buttons are clicked.
The <code>quantity</code> field for each book does not set the <code>immediate</code> attribute, so the value is <code>false</code> (the default).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:inputText</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">quantity</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">4</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{item.quantity}</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">title</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{bundle.ItemQuantity}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;f:validateLongRange</span> <span class="attribute-name">minimum</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    ...
<span class="tag">&lt;/h:inputText&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>immediate</code> attribute of the Continue Shopping hyperlink is set to <code>true</code>, while the <code>immediate</code> attribute of the Update Quantities hyperlink is set to <code>false</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:commandLink</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">continue</span><span class="delimiter">&quot;</span></span>
               <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bookcatalog</span><span class="delimiter">&quot;</span></span>
               <span class="attribute-name">immediate</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;h:outputText</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{bundle.ContinueShopping}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/h:commandLink&gt;</span>
...
<span class="tag">&lt;h:commandLink</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">update</span><span class="delimiter">&quot;</span></span>
               <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{showcart.update}</span><span class="delimiter">&quot;</span></span>
               <span class="attribute-name">immediate</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;h:outputText</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{bundle.UpdateQuantities}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/h:commandLink&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you click the Continue Shopping hyperlink, none of the changes entered into the <code>quantity</code> input fields will be processed.
If you click the Update Quantities hyperlink, the values in the <code>quantity</code> fields will be updated in the shopping cart.</p>
</div>
</div>
<div class="sect4">
<h5 id="the-rendered-attribute"><a class="anchor" href="#the-rendered-attribute"></a>The rendered Attribute</h5>
<div class="paragraph">
<p>A component tag uses a Boolean EL expression along with the <code>rendered</code> attribute to determine whether the component will be rendered.
For example, the <code>commandLink</code> component in the following section of a page is not rendered if the cart contains no items:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:commandLink</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">check</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">...</span> <span class="attribute-name">rendered</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{cart.numberOfItems </span></span><span class="error">&gt;</span> 0}&quot;<span class="error">&gt;</span>
    <span class="tag">&lt;h:outputText</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{bundle.CartCheck}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/h:commandLink&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Unlike nearly every other Jakarta Faces tag attribute, the <code>rendered</code> attribute is restricted to using rvalue expressions.
As explained in <a href="#value-and-method-expressions">Value and Method Expressions</a>, these rvalue expressions can only read data; they cannot write the data back to the data source.
Therefore, expressions used with <code>rendered</code> attributes can use the arithmetic operators and literals that rvalue expressions can use but lvalue expressions cannot use.
For example, the expression in the preceding example uses the <code>&gt;</code> operator.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In this example and others, <code>bundle</code> refers to a <code>java.util.ResourceBundle</code> file that contains locale-specific strings to be displayed.
Resource bundles are discussed in <a href="#internationalizing-and-localizing-web-applications">Chapter 22, <em>Internationalizing and Localizing Web Applications</em></a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="the-style-and-styleclass-attributes"><a class="anchor" href="#the-style-and-styleclass-attributes"></a>The style and styleClass Attributes</h5>
<div class="paragraph">
<p>The <code>style</code> and <code>styleClass</code> attributes allow you to specify CSS styles for the rendered output of your tags.
<a href="#displaying-error-messages-with-the-hmessage-and-hmessages-tags">Displaying Error Messages with the h:message and h:messages Tags</a> describes an example of using the <code>style</code> attribute to specify styles directly in the attribute.
A component tag can instead refer to a CSS class.</p>
</div>
<div class="paragraph">
<p>The following example shows the use of a <code>dataTable</code> tag that references the style class <code>list-background</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:dataTable</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">items</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">...</span>
             <span class="attribute-name">styleClass</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">list-background</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{cart.items}</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">var</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">book</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The style sheet that defines this class is <code>stylesheet.css</code>, which will be included in the application.
For more information on defining styles, see the Cascading Style Sheets specifications and drafts at <a href="https://www.w3.org/Style/CSS/" class="bare" target="_blank" rel="noopener">https://www.w3.org/Style/CSS/</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="the-value-and-binding-attributes"><a class="anchor" href="#the-value-and-binding-attributes"></a>The value and binding Attributes</h5>
<div class="paragraph">
<p>A tag representing an output component uses the <code>value</code> and <code>binding</code> attributes to bind its component&#8217;s value or instance, respectively, to a data object.
The <code>value</code> attribute is used more commonly than the <code>binding</code> attribute, and examples appear throughout this chapter.
For more information on these attributes, see <a href="#creating-a-managed-bean">Creating a Managed Bean</a>, <a href="#writing-properties-bound-to-component-values">Writing Properties Bound to Component Values</a>, and <a href="#writing-properties-bound-to-component-instances">Writing Properties Bound to Component Instances</a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="adding-html-head-and-body-tags"><a class="anchor" href="#adding-html-head-and-body-tags"></a>Adding HTML Head and Body Tags</h4>
<div class="paragraph">
<p>The HTML head (<code>h:head</code>) and body (<code>h:body</code>) tags add HTML page structure to Jakarta Faces web pages.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>h:head</code> tag represents the head element of an HTML page.</p>
</li>
<li>
<p>The <code>h:body</code> tag represents the body element of an HTML page.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following is an example of an XHTML page using the usual head and body markup tags:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="doctype">&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;
  &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;&gt;</span>
<span class="tag">&lt;html</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/1999/xhtml</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;head&gt;</span>
        <span class="tag">&lt;title&gt;</span>Add a title<span class="tag">&lt;/title&gt;</span>
    <span class="tag">&lt;/head&gt;</span>
    <span class="tag">&lt;body&gt;</span>
        Add Content
    <span class="tag">&lt;/body&gt;</span>
<span class="tag">&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following is an example of an XHTML page using <code>h:head</code> and <code>h:body</code> tags:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="doctype">&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;
  &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;&gt;</span>
<span class="tag">&lt;html</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/1999/xhtml</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xmlns:h</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://xmlns.jcp.org/jsf/html</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;h:head&gt;</span>
        Add a title
    <span class="tag">&lt;/h:head&gt;</span>
    <span class="tag">&lt;h:body&gt;</span>
        Add Content
    <span class="tag">&lt;/h:body&gt;</span>
<span class="tag">&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Both of the preceding example code segments render the same HTML elements.
The head and body tags are useful mainly for resource relocation.
For more information on resource relocation, see <a href="#resource-relocation-using-houtputscript-and-houtputstylesheet-tags">Resource Relocation Using h:outputScript and h:outputStylesheet Tags</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="adding-a-form-component"><a class="anchor" href="#adding-a-form-component"></a>Adding a Form Component</h4>
<div class="paragraph">
<p>An <code>h:form</code> tag represents an input form, which includes child components that can contain data that is either presented to the user or submitted with the form.</p>
</div>
<div class="paragraph">
<p><a href="#a-typical-form">Figure 10-1</a> shows a typical login form in which a user enters a user name and password, then submits the form by clicking the Login button.</p>
</div>
<div id="a-typical-form" class="imageblock">
<div class="content">
<img src="images/jakartaeett_dt_065_frmcmpnt.svg" alt="Form with User Name and Password text fields and a Login button.">
</div>
<div class="title">Figure 10-1 A Typical Form</div>
</div>
<div class="paragraph">
<p>The <code>h:form</code> tag represents the form on the page and encloses all the components that display or collect data from the user, as shown here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:form&gt;</span>
... other Jakarta Faces tags and other content...
<span class="tag">&lt;/h:form&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>h:form</code> tag can also include HTML markup to lay out the components on the page.
Note that the <code>h:form</code> tag itself does not perform any layout; its purpose is to collect data and to declare attributes that can be used by other components in the form.</p>
</div>
<div class="paragraph">
<p>A page can include multiple <code>h:form</code> tags, but only the values from the form submitted by the user will be included in the postback request.</p>
</div>
</div>
<div class="sect3">
<h4 id="using-text-components"><a class="anchor" href="#using-text-components"></a>Using Text Components</h4>
<div class="paragraph">
<p>Text components allow users to view and edit text in web applications.
The basic types of text components are as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Label, which displays read-only text</p>
</li>
<li>
<p>Field, which allows users to enter text (on one or more lines), often to be submitted as part of a form</p>
</li>
<li>
<p>Password field, which is a type of field that displays a set of characters, such as asterisks, instead of the password text that the user enters</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a href="#example-text-components">Figure 10-2</a> shows examples of these text components.</p>
</div>
<div id="example-text-components" class="imageblock">
<div class="content">
<img src="images/jakartaeett_dt_068_txtcmpnts.svg" alt="A form. " width="User Name" labels a field. "Password" labels a password field. "Comments" labels a multi-line field."">
</div>
<div class="title">Figure 10-2 Example Text Components</div>
</div>
<div class="paragraph">
<p>Text components can be categorized as either input or output.
A Jakarta Faces output component, such as a label, is rendered as read-only text.
A Jakarta Faces input component, such as a field, is rendered as editable text.</p>
</div>
<div class="paragraph">
<p>The input and output components can each be rendered in various ways to display more specialized text.</p>
</div>
<div class="paragraph">
<p><a href="#input-tags">Table 10-3</a> lists the tags that represent the input components.</p>
</div>
<table id="input-tags" class="tableblock frame-all grid-all" style="width: 80%;">
<caption class="title">Table 10-3 Input Tags</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Tag</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>h:inputHidden</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows a page author to include a hidden variable in a page</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>h:inputSecret</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The standard password field: accepts one line of text with no spaces and displays it as a set of asterisks as it is entered</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>h:inputText</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The standard field: accepts a one-line text string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>h:inputTextarea</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The standard multiline field: accepts multiple lines of text</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The input tags support the tag attributes shown in <a href="#input-tag-attributes">Table 10-4</a> in addition to those described in <a href="#common-component-tag-attributes">Common Component Tag Attributes</a>.
Note that this table does not include all the attributes supported by the input tags but just those that are used most often.
For the complete list of attributes, refer to the <a href="https://jakarta.ee/specifications/faces/3.0/vdldoc/" target="_blank" rel="noopener">Jakarta Faces Facelets Tag Library documentation</a>.</p>
</div>
<table id="input-tag-attributes" class="tableblock frame-all grid-all" style="width: 80%;">
<caption class="title">Table 10-4 Input Tag Attributes</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>converter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Identifies a converter that will be used to convert the component&#8217;s local data.
See <a href="#using-the-standard-converters">Using the Standard Converters</a> for more information on how to use this attribute.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>converterMessage</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies an error message to display when the converter registered on the component fails.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dir</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the direction of the text displayed by this component.
Acceptable values are <code>ltr</code>, meaning left to right, and <code>rtl</code>, meaning right to left.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>label</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies a name that can be used to identify this component in error messages.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>lang</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the code for the language used in the rendered markup, such as <code>en</code> or <code>pt-BR</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>required</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Takes a <code>boolean</code> value that indicates whether the user must enter a value in this component.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>requiredMessage</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies an error message to display when the user does not enter a value into the component.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>validator</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Identifies a method expression pointing to a managed bean method that performs validation on the component&#8217;s data.
See <a href="#referencing-a-method-that-performs-validation">Referencing a Method That Performs Validation</a> for an example of using the <code>f:validator</code> tag.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>validatorMessage</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies an error message to display when the validator registered on the component fails to validate the component&#8217;s local value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>valueChangeListener</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Identifies a method expression that points to a managed bean method that handles the event of entering a value in this component.
See <a href="#referencing-a-method-that-handles-a-value-change-event">Referencing a Method That Handles a Value-Change Event</a> for an example of using <code>valueChangeListener</code>.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><a href="#output-tags">Table 10-5</a> lists the tags that represent the output components.</p>
</div>
<table id="output-tags" class="tableblock frame-all grid-all" style="width: 80%;">
<caption class="title">Table 10-5 Output Tags</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Tag</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>h:outputFormat</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Displays a formatted message</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>h:outputLabel</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The standard read-only label: displays a component as a label for a specified input field</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>h:outputLink</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Displays an <code>&lt;a href&gt;</code> tag that links to another page without generating an action event</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>h:outputText</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Displays a one-line text string</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The output tags support the <code>converter</code> tag attribute in addition to those listed in <a href="#common-component-tag-attributes">Common Component Tag Attributes</a>.</p>
</div>
<div class="paragraph">
<p>The rest of this section explains how to use some of the tags listed in <a href="#output-tags">Table 10-5</a>.
The other tags are written in a similar way.</p>
</div>
<div class="sect4">
<h5 id="rendering-a-field-with-the-hinputtext-tag"><a class="anchor" href="#rendering-a-field-with-the-hinputtext-tag"></a>Rendering a Field with the h:inputText Tag</h5>
<div class="paragraph">
<p>The <code>h:inputText</code> tag is used to display a field.
A similar tag, the <code>h:outputText</code> tag, displays a read-only, single-line string.
This section shows you how to use the <code>h:inputText</code> tag.
The <code>h:outputText</code> tag is written in a similar way.</p>
</div>
<div class="paragraph">
<p>Here is an example of an <code>h:inputText</code> tag:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:inputText</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">label</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Customer Name</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">30</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{cashierBean.name}</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">required</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">requiredMessage</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{bundle.ReqCustomerName}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;f:valueChangeListener</span>
        <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ee.jakarta.tutorial.dukesbookstore.listeners.NameChanged</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/h:inputText&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>label</code> attribute specifies a user-friendly name that will be used in the substitution parameters of error messages displayed for this component.</p>
</div>
<div class="paragraph">
<p>The <code>value</code> attribute refers to the <code>name</code> property of a managed bean named <code>CashierBean</code>.
This property holds the data for the <code>name</code> component.
After the user submits the form, the value of the <code>name</code> property in <code>CashierBean</code> will be set to the text entered in the field corresponding to this tag.</p>
</div>
<div class="paragraph">
<p>The <code>required</code> attribute causes the page to reload, displaying errors, if the user does not enter a value in the <code>name</code> field.
The Jakarta Faces implementation checks whether the value of the component is null or is an empty string.</p>
</div>
<div class="paragraph">
<p>If your component must have a non-null value or a <code>String</code> value at least one character in length, you should add a <code>required</code> attribute to your tag and set its value to <code>true</code>.
If your tag has a <code>required</code> attribute that is set to <code>true</code> and the value is null or a zero-length string, no other validators that are registered on the tag are called.
If your tag does not have a <code>required</code> attribute set to <code>true</code>, other validators that are registered on the tag are called, but those validators must handle the possibility of a null or zero-length string.
See <a href="#validating-null-and-empty-strings">Validating Null and Empty Strings</a> for more information.</p>
</div>
</div>
<div class="sect4">
<h5 id="rendering-a-password-field-with-the-hinputsecret-tag"><a class="anchor" href="#rendering-a-password-field-with-the-hinputsecret-tag"></a>Rendering a Password Field with the h:inputSecret Tag</h5>
<div class="paragraph">
<p>The <code>h:inputSecret</code> tag renders an <code>&lt;input type="password"&gt;</code> HTML tag.
When the user types a string into this field, a row of asterisks is displayed instead of the text entered by the user.
Here is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:inputSecret</span> <span class="attribute-name">redisplay</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{loginBean.password}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the <code>redisplay</code> attribute is set to <code>false</code>.
This will prevent the password from being displayed in a query string or in the source file of the resulting HTML page.</p>
</div>
</div>
<div class="sect4">
<h5 id="rendering-a-label-with-the-houtputlabel-tag"><a class="anchor" href="#rendering-a-label-with-the-houtputlabel-tag"></a>Rendering a Label with the h:outputLabel Tag</h5>
<div class="paragraph">
<p>The <code>h:outputLabel</code> tag is used to attach a label to a specified input field for the purpose of making it accessible.
The following page uses an <code>h:outputLabel</code> tag to render the label of a check box:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:selectBooleanCheckbox</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">fanClub</span><span class="delimiter">&quot;</span></span>
                         <span class="attribute-name">rendered</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>
                         <span class="attribute-name">binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{cashierBean.specialOffer}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;h:outputLabel</span> <span class="attribute-name">for</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">fanClub</span><span class="delimiter">&quot;</span></span>
               <span class="attribute-name">rendered</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>
               <span class="attribute-name">binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{cashierBean.specialOfferText}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;h:outputText</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">fanClubLabel</span><span class="delimiter">&quot;</span></span>
                  <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{bundle.DukeFanClub}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/h:outputLabel&gt;</span>
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>h:selectBooleanCheckbox</code> tag and the <code>h:outputLabel</code> tag have <code>rendered</code> attributes that are set to <code>false</code> on the page but are set to true in the <code>CashierBean</code> under certain circumstances.
The <code>for</code> attribute of the <code>h:outputLabel</code> tag maps to the <code>id</code> of the input field to which the label is attached.
The <code>h:outputText</code> tag nested inside the <code>h:outputLabel</code> tag represents the label component.
The <code>value</code> attribute on the <code>h:outputText</code> tag indicates the text that is displayed next to the input field.</p>
</div>
<div class="paragraph">
<p>Instead of using an <code>h:outputText</code> tag for the text displayed as a label, you can simply use the <code>h:outputLabel</code> tag&#8217;s <code>value</code> attribute.
The following code snippet shows what the previous code snippet would look like if it used the <code>value</code> attribute of the <code>h:outputLabel</code> tag to specify the text of the label:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:selectBooleanCheckbox</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">fanClub</span><span class="delimiter">&quot;</span></span>
                         <span class="attribute-name">rendered</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>
                         <span class="attribute-name">binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{cashierBean.specialOffer}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;h:outputLabel</span> <span class="attribute-name">for</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">fanClub</span><span class="delimiter">&quot;</span></span>
               <span class="attribute-name">rendered</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>
               <span class="attribute-name">binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{cashierBean.specialOfferText}</span><span class="delimiter">&quot;</span></span>
               <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{bundle.DukeFanClub}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/h:outputLabel&gt;</span>
...</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="rendering-a-link-with-the-houtputlink-tag"><a class="anchor" href="#rendering-a-link-with-the-houtputlink-tag"></a>Rendering a Link with the h:outputLink Tag</h5>
<div class="paragraph">
<p>The <code>h:outputLink</code> tag is used to render a link that, when clicked, loads another page but does not generate an action event.
You should use this tag instead of the <code>h:commandLink</code> tag if you always want the URL specified by the <code>h:outputLink</code> tag&#8217;s <code>value</code> attribute to open and do not want any processing to be performed when the user clicks the link.
Here is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:outputLink</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">javadocs</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    Documentation for this demo
<span class="tag">&lt;/h:outputLink&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The text in the body of the <code>h:outputLink</code> tag identifies the text that the user clicks to get to the next page.</p>
</div>
</div>
<div class="sect4">
<h5 id="displaying-a-formatted-message-with-the-houtputformat-tag"><a class="anchor" href="#displaying-a-formatted-message-with-the-houtputformat-tag"></a>Displaying a Formatted Message with the h:outputFormat Tag</h5>
<div class="paragraph">
<p>The <code>h:outputFormat</code> tag allows display of concatenated messages as a <code>MessageFormat</code> pattern, as described in the API documentation for <code>java.text.MessageFormat</code>.
Here is an example of an <code>h:outputFormat</code> tag:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:outputFormat</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello, {0}!</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;f:param</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{hello.name}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/h:outputFormat&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>value</code> attribute specifies the <code>MessageFormat</code> pattern.
The <code>f:param</code> tag specifies the substitution parameters for the message.
The value of the parameter replaces the <code>{0}</code> in the sentence.
If the value of <code>"#{hello.name}"</code> is "Bill", the message displayed in the page is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Hello, Bill!</pre>
</div>
</div>
<div class="paragraph">
<p>An <code>h:outputFormat</code> tag can include more than one <code>f:param</code> tag for those messages that have more than one parameter that must be concatenated into the message.
If you have more than one parameter for one message, make sure that you put the <code>f:param</code> tags in the proper order so that the data is inserted in the correct place in the message.
Here is the preceding example modified with an additional parameter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:outputFormat</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello, {0}! You are visitor number {1} to the page.</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;f:param</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{hello.name}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;f:param</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{bean.numVisitor}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/h:outputFormat&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The value of <code>{1}</code> is replaced by the second parameter.
The parameter is an EL expression, <code>bean.numVisitor</code>, in which the property <code>numVisitor</code> of the managed bean <code>bean</code> keeps track of visitors to the page.
This is an example of a value-expression-enabled tag attribute accepting an EL expression.
The message displayed in the page is now as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Hello, Bill! You are visitor number 10 to the page.</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="using-command-component-tags-for-performing-actions-and-navigation"><a class="anchor" href="#using-command-component-tags-for-performing-actions-and-navigation"></a>Using Command Component Tags for Performing Actions and Navigation</h4>
<div class="paragraph">
<p>In Jakarta Faces applications, the button and link component tags are used to perform actions, such as submitting a form, and for navigating to another page.
These tags are called command component tags because they perform an action when activated.</p>
</div>
<div class="paragraph">
<p>The <code>h:commandButton</code> tag is rendered as a button.
The <code>h:commandLink</code> tag is rendered as a link.</p>
</div>
<div class="paragraph">
<p>In addition to the tag attributes listed in <a href="#common-component-tag-attributes">Common Component Tag Attributes</a>, the <code>h:commandButton</code> and <code>h:commandLink</code> tags can use the following attributes.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>action</code>, which is either a logical outcome <code>String</code> or a method expression pointing to a bean method that returns a logical outcome <code>String</code>.
In either case, the logical outcome <code>String</code> is used to determine what page to access when the command component tag is activated.</p>
</li>
<li>
<p><code>actionListener</code>, which is a method expression pointing to a bean method that processes an action event fired by the command component tag.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See <a href="#referencing-a-method-that-performs-navigation">Referencing a Method That Performs Navigation</a> for more information on using the <code>action</code> attribute.
See <a href="#referencing-a-method-that-handles-an-action-event">Referencing a Method That Handles an Action Event</a> for details on using the <code>actionListener</code> attribute.</p>
</div>
<div class="sect4">
<h5 id="rendering-a-button-with-the-hcommandbutton-tag"><a class="anchor" href="#rendering-a-button-with-the-hcommandbutton-tag"></a>Rendering a Button with the h:commandButton Tag</h5>
<div class="paragraph">
<p>If you are using an <code>h:commandButton</code> component tag, the data from the current page is processed when a user clicks the button, and the next page is opened.
Here is an example of the <code>h:commandButton</code> tag:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:commandButton</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Submit</span><span class="delimiter">&quot;</span></span>
                 <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{cashierBean.submit}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Clicking the button will cause the <code>submit</code> method of <code>CashierBean</code> to be invoked because the <code>action</code> attribute references this method.
The <code>submit</code> method performs some processing and returns a logical outcome.</p>
</div>
<div class="paragraph">
<p>The <code>value</code> attribute of the example <code>h:commandButton</code> tag references the button&#8217;s label.
For information on how to use the <code>action</code> attribute, see <a href="#referencing-a-method-that-performs-navigation">Referencing a Method That Performs Navigation</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="rendering-a-link-with-the-hcommandlink-tag"><a class="anchor" href="#rendering-a-link-with-the-hcommandlink-tag"></a>Rendering a Link with the h:commandLink Tag</h5>
<div class="paragraph">
<p>The <code>h:commandLink</code> tag represents an HTML link and is rendered as an HTML <code>&lt;a&gt;</code> element.</p>
</div>
<div class="paragraph">
<p>An <code>h:commandLink</code> tag must include a nested <code>h:outputText</code> tag, which represents the text that the user clicks to generate the event.
Here is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:commandLink</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Duke</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bookstore</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;f:actionListener</span>
        <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ee.jakarta.tutorial.dukesbookstore.listeners.LinkBookChangeListener</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;h:outputText</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{bundle.Book201}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/h:commandLink&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This tag will render HTML that looks something like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><span class="tag">&lt;a</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">_idt16:Duke</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#</span><span class="delimiter">&quot;</span></span>
     <span class="attribute-name">onclick</span>=<span class="string"><span class="delimiter">&quot;</span>mojarra.jsfcljs(document.getElementById(<span class="string"><span class="delimiter">'</span><span class="content">j_idt16</span><span class="delimiter">'</span></span>),
     {<span class="key"><span class="delimiter">'</span><span class="content">j_idt16:Duke</span><span class="delimiter">'</span></span>:<span class="string"><span class="delimiter">'</span><span class="content">j_idt16:Duke</span><span class="delimiter">'</span></span>},<span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>);
     <span class="keyword">return</span> <span class="predefined-constant">false</span>;<span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>My Early Years: Growing Up on Star7, by Duke<span class="tag">&lt;/a&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>h:commandLink</code> tag will render JavaScript scripting language.
If you use this tag, make sure that your browser is enabled for JavaScript technology.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="adding-graphics-and-images-with-the-hgraphicimage-tag"><a class="anchor" href="#adding-graphics-and-images-with-the-hgraphicimage-tag"></a>Adding Graphics and Images with the h:graphicImage Tag</h4>
<div class="paragraph">
<p>In a Jakarta Faces application, use the <code>h:graphicImage</code> tag to render an image on a page:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:graphicImage</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mapImage</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">url</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/resources/images/book_all.jpg</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the <code>url</code> attribute specifies the path to the image.
The URL of the example tag begins with a slash (<code>/</code>), which adds the relative context path of the web application to the beginning of the path to the image.</p>
</div>
<div class="paragraph">
<p>Alternatively, you can use the facility described in <a href="#web-resources">Web Resources</a> to point to the image location.
Here are two examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:graphicImage</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mapImage</span><span class="delimiter">&quot;</span></span>
                <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">book_all.jpg</span><span class="delimiter">&quot;</span></span>
                <span class="attribute-name">library</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">images</span><span class="delimiter">&quot;</span></span>
                <span class="attribute-name">alt</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{bundle.ChooseBook}</span><span class="delimiter">&quot;</span></span>
                <span class="attribute-name">usemap</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#bookMap</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>

<span class="tag">&lt;h:graphicImage</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{resource['images:wave.med.gif']}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use similar syntax to refer to an image in a style sheet.
The following syntax in a style sheet specifies that the image is to be found at <code>resources/img/top-background.jpg</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="css"><span class="tag">header</span> {
    <span class="key">position</span>: <span class="value">relative</span>;
    <span class="key">height</span>: <span class="float">150px</span>;
    <span class="key">background</span>: <span class="color">#fff</span> <span class="function"><span class="delimiter">url(</span><span class="content">#{resource['img:top-background.jpg']}</span><span class="delimiter">)</span></span> <span class="value">repeat-x</span>;
    ...
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="laying-out-components-with-the-hpanelgrid-and-hpanelgroup-tags"><a class="anchor" href="#laying-out-components-with-the-hpanelgrid-and-hpanelgroup-tags"></a>Laying Out Components with the h:panelGrid and h:panelGroup Tags</h4>
<div class="paragraph">
<p>In a Jakarta Faces application, you use a panel as a layout container for a set of other components.
A panel is rendered as an HTML table.
<a href="#panel-component-tags">Table 10-6</a> lists the tags used to create panels.</p>
</div>
<table id="panel-component-tags" class="tableblock frame-all grid-all" style="width: 90%;">
<caption class="title">Table 10-6 Panel Component Tags</caption>
<colgroup>
<col style="width: 22.2222%;">
<col style="width: 55.5555%;">
<col style="width: 22.2223%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Tag</th>
<th class="tableblock halign-left valign-top">Attributes</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>h:panelGrid</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>columns</code>, <code>columnClasses</code>, <code>footerClass</code>, <code>headerClass</code>, <code>panelClass</code>, <code>rowClasses</code>, <code>role</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Displays a table</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>h:panelGroup</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>layout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Groups a set of components under one parent</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <code>h:panelGrid</code> tag is used to represent an entire table.
The <code>h:panelGroup</code> tag is used to represent rows in a table.
Other tags are used to represent individual cells in the rows.</p>
</div>
<div class="paragraph">
<p>The <code>columns</code> attribute defines how to group the data in the table and therefore is required if you want your table to have more than one column.
The <code>h:panelGrid</code> tag also has a set of optional attributes that specify CSS classes: <code>columnClasses</code>, <code>footerClass</code>, <code>headerClass</code>, <code>panelClass</code>, and <code>rowClasses</code>.
The <code>role</code> attribute can have the value <code>"presentation"</code> to indicate that the purpose of the table is to format the display rather than to show data.</p>
</div>
<div class="paragraph">
<p>If the <code>headerClass</code> attribute value is specified, the <code>h:panelGrid</code> tag must have a header as its first child.
Similarly, if a <code>footerClass</code> attribute value is specified, the <code>h:panelGrid</code> tag must have a footer as its last child.</p>
</div>
<div class="paragraph">
<p>Here is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:panelGrid</span> <span class="attribute-name">columns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">headerClass</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">list-header</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">styleClass</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">list-background</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">rowClasses</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">list-row-even, list-row-odd</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">summary</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{bundle.CustomerInfo}</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">title</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{bundle.Checkout}</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">role</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">presentation</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;f:facet</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">header</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;h:outputText</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{bundle.Checkout}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/f:facet&gt;</span>

    <span class="tag">&lt;h:outputLabel</span> <span class="attribute-name">for</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{bundle.Name}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;h:inputText</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">30</span><span class="delimiter">&quot;</span></span>
                 <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{cashierBean.name}</span><span class="delimiter">&quot;</span></span>
                 <span class="attribute-name">required</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
                 <span class="attribute-name">requiredMessage</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{bundle.ReqCustomerName}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
         <span class="tag">&lt;f:valueChangeListener</span>
             <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ee.jakarta.tutorial.dukesbookstore.listeners.NameChanged</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;/h:inputText&gt;</span>
    <span class="tag">&lt;h:message</span> <span class="attribute-name">styleClass</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">error-message</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">for</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

    <span class="tag">&lt;h:outputLabel</span> <span class="attribute-name">for</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ccno</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{bundle.CCNumber}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;h:inputText</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ccno</span><span class="delimiter">&quot;</span></span>
                 <span class="attribute-name">size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">19</span><span class="delimiter">&quot;</span></span>
                 <span class="attribute-name">converterMessage</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{bundle.CreditMessage}</span><span class="delimiter">&quot;</span></span>
                 <span class="attribute-name">required</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
                 <span class="attribute-name">requiredMessage</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{bundle.ReqCreditCard}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;f:converter</span> <span class="attribute-name">converterId</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ccno</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;f:validateRegex</span>
        <span class="attribute-name">pattern</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">\d{16}|\d{4} \d{4} \d{4} \d{4}|\d{4}-\d{4}-\d{4}-\d{4}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;/h:inputText&gt;</span>
    <span class="tag">&lt;h:message</span> <span class="attribute-name">styleClass</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">error-message</span><span class="delimiter">&quot;</span></span>  <span class="attribute-name">for</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ccno</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    ...
<span class="tag">&lt;/h:panelGrid&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The preceding <code>h:panelGrid</code> tag is rendered as a table that contains components in which a customer inputs personal information.
This <code>h:panelGrid</code> tag uses style sheet classes to format the table.
The following code shows the <code>list-header</code> definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="css"><span class="class">.list-header</span> {
    <span class="key">background-color</span>: <span class="color">#ffffff</span>;
    <span class="key">color</span>: <span class="color">#000000</span>;
    <span class="key">text-align</span>: <span class="value">center</span>;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Because the <code>h:panelGrid</code> tag specifies a <code>headerClass</code>, the <code>h:panelGrid</code> tag must contain a header.
The example <code>h:panelGrid</code> tag uses an <code>f:facet</code> tag for the header.
Facets can have only one child, so an <code>h:panelGroup</code> tag is needed if you want to group more than one component within an <code>f:facet</code>.
The example <code>h:panelGrid</code> tag has only one cell of data, so an <code>h:panelGroup</code> tag is not needed.
(For more information about facets, see <a href="#using-data-bound-table-components">Using Data-Bound Table Components</a>.</p>
</div>
<div class="paragraph">
<p>The <code>h:panelGroup</code> tag has an attribute, <code>layout</code>, in addition to those listed in <a href="#common-component-tag-attributes">Common Component Tag Attributes</a>.
If the <code>layout</code> attribute has the value <code>block</code>, an HTML <code>div</code> element is rendered to enclose the row; otherwise, an HTML <code>span</code> element is rendered to enclose the row.
If you are specifying styles for the <code>h:panelGroup</code> tag, you should set the <code>layout</code> attribute to <code>block</code> in order for the styles to be applied to the components within the <code>h:panelGroup</code> tag.
You should do this because styles, such as those that set width and height, are not applied to inline elements, which is how content enclosed by the <code>span</code> element is defined.</p>
</div>
<div class="paragraph">
<p>An <code>h:panelGroup</code> tag can also be used to encapsulate a nested tree of components so that the tree of components appears as a single component to the parent component.</p>
</div>
<div class="paragraph">
<p>Data, represented by the nested tags, is grouped into rows according to the value of the <code>columns</code> attribute of the <code>h:panelGrid</code> tag.
The <code>columns</code> attribute in the example is set to <code>2</code>, and therefore the table will have two columns.
The column in which each component is displayed is determined by the order in which the component is listed on the page modulo 2.
So, if a component is the fifth one in the list of components, that component will be in the 5 modulo 2 column, or column 1.</p>
</div>
</div>
<div class="sect3">
<h4 id="displaying-components-for-selecting-one-value"><a class="anchor" href="#displaying-components-for-selecting-one-value"></a>Displaying Components for Selecting One Value</h4>
<div class="paragraph">
<p>Another commonly used component is one that allows a user to select one value, whether it is the only value available or one of a set of choices.
The most common tags for this kind of component are as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An <code>h:selectBooleanCheckbox</code> tag, displayed as a check box, which represents a Boolean state</p>
</li>
<li>
<p>An <code>h:selectOneRadio</code> tag, displayed as a set of options</p>
</li>
<li>
<p>An <code>h:selectOneMenu</code> tag, displayed as a scrollable list</p>
</li>
<li>
<p>An <code>h:selectOneListbox</code> tag, displayed as an unscrollable list</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a href="#example-components-for-selecting-one-item">Figure 10-3</a> shows examples of these components.</p>
</div>
<div id="example-components-for-selecting-one-item" class="imageblock">
<div class="content">
<img src="images/jakartaeett_dt_067_slctn.svg" alt="Options, check box, and lists.">
</div>
<div class="title">Figure 10-3 Example Components for Selecting One Item</div>
</div>
<div class="sect4">
<h5 id="displaying-a-check-box-using-the-hselectbooleancheckbox-tag"><a class="anchor" href="#displaying-a-check-box-using-the-hselectbooleancheckbox-tag"></a>Displaying a Check Box Using the h:selectBooleanCheckbox Tag</h5>
<div class="paragraph">
<p>The <code>h:selectBooleanCheckbox</code> tag is the only tag that Jakarta Faces technology provides for representing a Boolean state.</p>
</div>
<div class="paragraph">
<p>Here is an example that shows how to use the <code>h:selectBooleanCheckbox</code> tag:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:selectBooleanCheckbox</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">fanClub</span><span class="delimiter">&quot;</span></span>
                         <span class="attribute-name">rendered</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>
                         <span class="attribute-name">binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{cashierBean.specialOffer}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;h:outputLabel</span> <span class="attribute-name">for</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">fanClub</span><span class="delimiter">&quot;</span></span>
               <span class="attribute-name">rendered</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>
               <span class="attribute-name">binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{cashierBean.specialOfferText}</span><span class="delimiter">&quot;</span></span>
               <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{bundle.DukeFanClub}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>h:selectBooleanCheckbox</code> tag and the <code>h:outputLabel</code> tag have <code>rendered</code> attributes that are set to <code>false</code> on the page but are set to true in the <code>CashierBean</code> under certain circumstances.
When the <code>h:selectBooleanCheckbox</code> tag is rendered, it displays a check box to allow users to indicate whether they want to join the Duke Fan Club.
When the <code>h:outputLabel</code> tag is rendered, it displays the label for the check box.
The label text is represented by the <code>value</code> attribute.</p>
</div>
</div>
<div class="sect4">
<h5 id="displaying-a-menu-using-the-hselectonemenu-tag"><a class="anchor" href="#displaying-a-menu-using-the-hselectonemenu-tag"></a>Displaying a Menu Using the h:selectOneMenu Tag</h5>
<div class="paragraph">
<p>A component that allows the user to select one value from a set of values can be rendered as a box or a set of options.
This section describes the <code>h:selectOneMenu</code> tag.
The <code>h:selectOneRadio</code> and <code>h:selectOneListbox</code> tags are used in a similar way.
The <code>h:selectOneListbox</code> tag is similar to the <code>h:selectOneMenu</code> tag except that <code>h:selectOneListbox</code> defines a <code>size</code> attribute that determines how many of the items are displayed at once.</p>
</div>
<div class="paragraph">
<p>The <code>h:selectOneMenu</code> tag represents a component that contains a list of items from which a user can select one item.
This menu component is sometimes known as a drop-down list or a combo box.
The following code snippet shows how the <code>h:selectOneMenu</code> tag is used to allow the user to select a shipping method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:selectOneMenu</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">shippingOption</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">required</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{cashierBean.shippingOption}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;f:selectItem</span> <span class="attribute-name">itemValue</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">itemLabel</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{bundle.QuickShip}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;f:selectItem</span> <span class="attribute-name">itemValue</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">5</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">itemLabel</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{bundle.NormalShip}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;f:selectItem</span> <span class="attribute-name">itemValue</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">7</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">itemLabel</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{bundle.SaverShip}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
 <span class="tag">&lt;/h:selectOneMenu&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>value</code> attribute of the <code>h:selectOneMenu</code> tag maps to the property that holds the currently selected item&#8217;s value.
In this case, the value is set by the backing bean.
You are not required to provide a value for the currently selected item.
If you don&#8217;t provide a value, the browser determines which one is selected.</p>
</div>
<div class="paragraph">
<p>Like the <code>h:selectOneRadio</code> tag, the <code>h:selectOneMenu</code> tag must contain either an <code>f:selectItems</code> tag or a set of <code>f:selectItem</code> tags for representing the items in the list.
<a href="#using-the-fselectitem-and-fselectitems-tags">Using the f:selectItem and f:selectItems Tags</a> describes these tags.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="displaying-components-for-selecting-multiple-values"><a class="anchor" href="#displaying-components-for-selecting-multiple-values"></a>Displaying Components for Selecting Multiple Values</h4>
<div class="paragraph">
<p>In some cases, you need to allow your users to select multiple values rather than just one value from a list of choices.
You can do this using one of the following component tags:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An <code>h:selectManyCheckbox</code> tag, displayed as a set of check boxes</p>
</li>
<li>
<p>An <code>h:selectManyMenu</code> tag, displayed as a menu</p>
</li>
<li>
<p>An <code>h:selectManyListbox</code> tag, displayed as a box</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a href="#example-components-for-selecting-multiple-values">Figure 10-4</a> shows examples of these components.</p>
</div>
<div id="example-components-for-selecting-multiple-values" class="imageblock">
<div class="content">
<img src="images/jakartaeett_dt_066_slctmny.svg" alt="Check box group, scrollable box, and unscrollable box.">
</div>
<div class="title">Figure 10-4 Example Components for Selecting Multiple Values</div>
</div>
<div class="paragraph">
<p>These tags allow the user to select zero or more values from a set of values.
This section explains the <code>h:selectManyCheckbox</code> tag.
The <code>h:selectManyListbox</code> and <code>h:selectManyMenu</code> tags are used in a similar way.</p>
</div>
<div class="paragraph">
<p>Unlike a menu, a list displays a subset of items in a box; a menu displays only one item at a time when the user is not selecting the menu.
The <code>size</code> attribute of the <code>h:selectManyListbox</code> tag determines the number of items displayed at one time.
The box includes a scroll bar for scrolling through any remaining items in the list.</p>
</div>
<div class="paragraph">
<p>The <code>h:selectManyCheckbox</code> tag renders a group of check boxes, with each check box representing one value that can be selected:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:selectManyCheckbox</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">newslettercheckbox</span><span class="delimiter">&quot;</span></span>
                      <span class="attribute-name">layout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pageDirection</span><span class="delimiter">&quot;</span></span>
                      <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{cashierBean.newsletters}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;f:selectItems</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{cashierBean.newsletterItems}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/h:selectManyCheckbox&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>value</code> attribute of the <code>h:selectManyCheckbox</code> tag identifies the <code>newsletters</code> property of the <code>CashierBean</code> managed bean.
This property holds the values of the currently selected items from the set of check boxes.
You are not required to provide a value for the currently selected items.
If you don&#8217;t provide a value, the first item in the list is selected by default.
In the <code>CashierBean</code> managed bean, this value is instantiated to 0, so no items are selected by default.</p>
</div>
<div class="paragraph">
<p>The <code>layout</code> attribute indicates how the set of check boxes is arranged on the page.
Because layout is set to <code>pageDirection</code>, the check boxes are arranged vertically.
The default is <code>lineDirection</code>, which aligns the check boxes horizontally.</p>
</div>
<div class="paragraph">
<p>The <code>h:selectManyCheckbox</code> tag must also contain a tag or set of tags representing the set of check boxes.
To represent a set of items, you use the <code>f:selectItems</code> tag.
To represent each item individually, you use the <code>f:selectItem</code> tag.
The following section explains these tags in more detail.</p>
</div>
</div>
<div class="sect3">
<h4 id="using-the-fselectitem-and-fselectitems-tags"><a class="anchor" href="#using-the-fselectitem-and-fselectitems-tags"></a>Using the f:selectItem and f:selectItems Tags</h4>
<div class="paragraph">
<p>The <code>f:selectItem</code> and <code>f:selectItems</code> tags represent components that can be nested inside a component that allows you to select one or multiple items.
An <code>f:selectItem</code> tag contains the value, label, and description of a single item.
An <code>f:selectItems</code> tag contains the values, labels, and descriptions of the entire list of items.</p>
</div>
<div class="paragraph">
<p>You can use either a set of <code>f:selectItem</code> tags or a single <code>f:selectItems</code> tag within your component tag.</p>
</div>
<div class="paragraph">
<p>The advantages of using the <code>f:selectItems</code> tag are as follows.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Items can be represented by using different data structures, including <code>Array</code>, <code>Map</code>, and <code>Collection</code>.
The value of the <code>f:selectItems</code> tag can represent even a generic collection of POJOs.</p>
</li>
<li>
<p>Different lists can be concatenated into a single component, and the lists can be grouped within the component.</p>
</li>
<li>
<p>Values can be generated dynamically at runtime.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The advantages of using <code>f:selectItem</code> are as follows.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Items in the list can be defined from the page.</p>
</li>
<li>
<p>Less code is needed in the backing bean for the <code>f:selectItem</code> properties.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The rest of this section shows you how to use the <code>f:selectItems</code> and <code>f:selectItem</code> tags.</p>
</div>
<div class="sect4">
<h5 id="using-the-fselectitems-tag"><a class="anchor" href="#using-the-fselectitems-tag"></a>Using the f:selectItems Tag</h5>
<div class="paragraph">
<p>The following example from <a href="#displaying-components-for-selecting-multiple-values">Displaying Components for Selecting Multiple Values</a> shows how to use the <code>h:selectManyCheckbox</code> tag:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:selectManyCheckbox</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">newslettercheckbox</span><span class="delimiter">&quot;</span></span>
                      <span class="attribute-name">layout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pageDirection</span><span class="delimiter">&quot;</span></span>
                      <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{cashierBean.newsletters}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;f:selectItems</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{cashierBean.newsletterItems}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/h:selectManyCheckbox&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>value</code> attribute of the <code>f:selectItems</code> tag is bound to the managed bean property <code>cashierBean.newsletterItems</code>.
The individual <code>SelectItem</code> objects are created programmatically in the managed bean.</p>
</div>
<div class="paragraph">
<p>See <a href="#uiselectitems-properties">UISelectItems Properties</a> for information on how to write a managed bean property for one of these tags.</p>
</div>
</div>
<div class="sect4">
<h5 id="using-the-fselectitem-tag"><a class="anchor" href="#using-the-fselectitem-tag"></a>Using the f:selectItem Tag</h5>
<div class="paragraph">
<p>The <code>f:selectItem</code> tag represents a single item in a list of items.
Here is the example from <a href="#displaying-a-menu-using-the-hselectonemenu-tag">Displaying a Menu Using the h:selectOneMenu Tag</a> once again:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:selectOneMenu</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">shippingOption</span><span class="delimiter">&quot;</span></span>
                 <span class="attribute-name">required</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
                 <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{cashierBean.shippingOption}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;f:selectItem</span> <span class="attribute-name">itemValue</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span>
                  <span class="attribute-name">itemLabel</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{bundle.QuickShip}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;f:selectItem</span> <span class="attribute-name">itemValue</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">5</span><span class="delimiter">&quot;</span></span>
                  <span class="attribute-name">itemLabel</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{bundle.NormalShip}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;f:selectItem</span> <span class="attribute-name">itemValue</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">7</span><span class="delimiter">&quot;</span></span>
                  <span class="attribute-name">itemLabel</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{bundle.SaverShip}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/h:selectOneMenu&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>itemValue</code> attribute represents the value for the <code>f:selectItem</code> tag.
The <code>itemLabel</code> attribute represents the <code>String</code> that appears in the list component on the page.</p>
</div>
<div class="paragraph">
<p>The <code>itemValue</code> and <code>itemLabel</code> attributes are value-binding enabled, meaning that they can use value-binding expressions to refer to values in external objects.
These attributes can also define literal values, as shown in the example <code>h:selectOneMenu</code> tag.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="displaying-the-results-from-selection-components"><a class="anchor" href="#displaying-the-results-from-selection-components"></a>Displaying the Results from Selection Components</h4>
<div class="paragraph">
<p>If you display components that allow a user to select values, you may also want to display the result of the selection.</p>
</div>
<div class="paragraph">
<p>For example, you might want to thank a user who selected the checkbox to join the Duke Fan Club, as described in <a href="#displaying-a-check-box-using-the-hselectbooleancheckbox-tag">Displaying a Check Box Using the h:selectBooleanCheckbox Tag</a>.
Because the checkbox is bound to the <code>specialOffer</code> property of <code>CashierBean</code>, a <code>UISelectBoolean</code> value, you can call the <code>isSelected</code> method of the property to determine whether to render a thank-you message:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:outputText</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{bundle.DukeFanClubThanks}</span><span class="delimiter">&quot;</span></span>
              <span class="attribute-name">rendered</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{cashierBean.specialOffer.isSelected()}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Similarly, you might want to acknowledge that a user subscribed to newsletters using the <code>h:selectManyCheckbox</code> tag, as described in <a href="#displaying-components-for-selecting-multiple-values">Displaying Components for Selecting Multiple Values</a>.
To do so, you can retrieve the value of the <code>newsletters</code> property, the <code>String</code> array that holds the selected items:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:outputText</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{bundle.NewsletterThanks}</span><span class="delimiter">&quot;</span></span>
              <span class="attribute-name">rendered</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{!empty cashierBean.newsletters}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;ul&gt;</span>
    <span class="tag">&lt;ui:repeat</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{cashierBean.newsletters}</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">var</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">nli</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;li&gt;</span><span class="tag">&lt;h:outputText</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{nli}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span><span class="tag">&lt;/li&gt;</span>
    <span class="tag">&lt;/ui:repeat&gt;</span>
<span class="tag">&lt;/ul&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>An introductory thank-you message is displayed only if the <code>newsletters</code> array is not empty.
Then a <code>ui:repeat</code> tag, a simple way to show values in a loop, displays the contents of the selected items in an itemized list.
(This tag is listed in <a href="#facelets-templating-tags">Table 8-2</a>.)</p>
</div>
</div>
<div class="sect3">
<h4 id="using-data-bound-table-components"><a class="anchor" href="#using-data-bound-table-components"></a>Using Data-Bound Table Components</h4>
<div class="paragraph">
<p>Data-bound table components display relational data in a tabular format.
In a Jakarta Faces application, the <code>h:dataTable</code> component tag supports binding to a collection of data objects and displays the data as an HTML table.
The <code>h:column</code> tag represents a column of data within the table, iterating over each record in the data source, which is displayed as a row.
Here is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:dataTable</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">items</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">captionClass</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">list-caption</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">columnClasses</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">list-column-center, list-column-left,</span>
             <span class="content">list-column-right, list-column-center</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">footerClass</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">list-footer</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">headerClass</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">list-header</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">rowClasses</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">list-row-even, list-row-odd</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">styleClass</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">list-background</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">summary</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{bundle.ShoppingCart}</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{cart.items}</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">border</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">var</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">item</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;h:column&gt;</span>
        <span class="tag">&lt;f:facet</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">header</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;h:outputText</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{bundle.ItemQuantity}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;/f:facet&gt;</span>
        <span class="tag">&lt;h:inputText</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">quantity</span><span class="delimiter">&quot;</span></span>
                     <span class="attribute-name">size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">4</span><span class="delimiter">&quot;</span></span>
                     <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{item.quantity}</span><span class="delimiter">&quot;</span></span>
                     <span class="attribute-name">title</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{bundle.ItemQuantity}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;f:validateLongRange</span> <span class="attribute-name">minimum</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;f:valueChangeListener</span>
                <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ee.jakarta.tutorial.dukesbookstore.listeners.QuantityChanged</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/h:inputText&gt;</span>
    <span class="tag">&lt;/h:column&gt;</span>
    <span class="tag">&lt;h:column&gt;</span>
        <span class="tag">&lt;f:facet</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">header</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;h:outputText</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{bundle.ItemTitle}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/f:facet&gt;</span>
        <span class="tag">&lt;h:commandLink</span> <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{showcart.details}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;h:outputText</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{item.item.title}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/h:commandLink&gt;</span>
    <span class="tag">&lt;/h:column&gt;</span>
    ...
    <span class="tag">&lt;f:facet</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">footer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;h:panelGroup&gt;</span>
            <span class="tag">&lt;h:outputText</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{bundle.Subtotal}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;h:outputText</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{cart.total}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
                <span class="tag">&lt;f:convertNumber</span> <span class="attribute-name">currencySymbol</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">$</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">currency</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
            <span class="tag">&lt;/h:outputText&gt;</span>
        <span class="tag">&lt;/h:panelGroup&gt;</span>
    <span class="tag">&lt;/f:facet&gt;</span>
    <span class="tag">&lt;f:facet</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">caption</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;h:outputText</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{bundle.Caption}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/f:facet&gt;</span>
<span class="tag">&lt;/h:dataTable&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The example <code>h:dataTable</code> tag displays the books in the shopping cart as well as the quantity of each book in the shopping cart, the prices, and a set of buttons the user can click to remove books from the shopping cart.</p>
</div>
<div class="paragraph">
<p>The <code>h:column</code> tags represent columns of data in a data component.
While the data component is iterating over the rows of data, it processes the column component associated with each <code>h:column</code> tag for each row in the table.</p>
</div>
<div class="paragraph">
<p>The <code>h:dataTable</code> tag shown in the preceding code example iterates through the list of books (<code>cart.items</code>) in the shopping cart and displays their titles, authors, and prices.
Each time the <code>h:dataTable</code> tag iterates through the list of books, it renders one cell in each column.</p>
</div>
<div class="paragraph">
<p>The <code>h:dataTable</code> and <code>h:column</code> tags use facets to represent parts of the table that are not repeated or updated.
These parts include headers, footers, and captions.</p>
</div>
<div class="paragraph">
<p>In the preceding example, <code>h:column</code> tags include <code>f:facet</code> tags for representing column headers or footers.
The <code>h:column</code> tag allows you to control the styles of these headers and footers by supporting the <code>headerClass</code> and <code>footerClass</code> attributes.
These attributes accept space-separated lists of CSS classes, which will be applied to the header and footer cells of the corresponding column in the rendered table.</p>
</div>
<div class="paragraph">
<p>Facets can have only one child, so an <code>h:panelGroup</code> tag is needed if you want to group more than one component within an <code>f:facet</code>.
Because the facet tag representing the footer includes more than one tag, the <code>h:panelGroup</code> tag is needed to group those tags.
Finally, this <code>h:dataTable</code> tag includes an <code>f:facet</code> tag with its <code>name</code> attribute set to <code>caption</code>, causing a table caption to be rendered above the table.</p>
</div>
<div class="paragraph">
<p>This table is a classic use case for a data component because the number of books might not be known to the application developer or the page author when that application is developed.
The data component can dynamically adjust the number of rows of the table to accommodate the underlying data.</p>
</div>
<div class="paragraph">
<p>The <code>value</code> attribute of an <code>h:dataTable</code> tag references the data to be included in the table.
This data can take the form of any of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A list of beans</p>
</li>
<li>
<p>An array of beans</p>
</li>
<li>
<p>A single bean</p>
</li>
<li>
<p>A <code>jakarta.faces.model.DataModel</code> object</p>
</li>
<li>
<p>A <code>java.sql.ResultSet</code> object</p>
</li>
<li>
<p>A <code>jakarta.servlet.jsp.jstl.sql.Result</code> object</p>
</li>
<li>
<p>A <code>javax.sql.RowSet</code> object</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All data sources for data components have a <code>DataModel</code> wrapper.
Unless you explicitly construct a <code>DataModel</code> wrapper, the Jakarta Faces implementation will create one around data of any of the other acceptable types.
See <a href="#writing-bean-properties">Writing Bean Properties</a> for more information on how to write properties for use with a data component.</p>
</div>
<div class="paragraph">
<p>The <code>var</code> attribute specifies a name that is used by the components within the <code>h:dataTable</code> tag as an alias to the data referenced in the <code>value</code> attribute of <code>h:dataTable</code>.</p>
</div>
<div class="paragraph">
<p>In the example <code>h:dataTable</code> tag, the <code>value</code> attribute points to a list of books.
The <code>var</code> attribute points to a single book in that list.
As the <code>h:dataTable</code> tag iterates through the list, each reference to <code>item</code> points to the current book in the list.</p>
</div>
<div class="paragraph">
<p>The <code>h:dataTable</code> tag also has the ability to display only a subset of the underlying data.
This feature is not shown in the preceding example.
To display a subset of the data, you use the optional <code>first</code> and <code>rows</code> attributes.</p>
</div>
<div class="paragraph">
<p>The <code>first</code> attribute specifies the first row to be displayed.
The <code>rows</code> attribute specifies the number of rows, starting with the first row, to be displayed.
For example, if you wanted to display records 2 through 10 of the underlying data, you would set <code>first</code> to 2 and <code>rows</code> to 9.
When you display a subset of the data in your pages, you might want to consider including a link or button that causes subsequent rows to display when clicked.
By default, both <code>first</code> and <code>rows</code> are set to zero, and this causes all the rows of the underlying data to display.</p>
</div>
<div class="paragraph">
<p><a href="#optional-attributes-for-the-hdatatable-tag">Table 10-7</a> shows the optional attributes for the <code>h:dataTable</code> tag.</p>
</div>
<table id="optional-attributes-for-the-hdatatable-tag" class="tableblock frame-all grid-all" style="width: 60%;">
<caption class="title">Table 10-7 Optional Attributes for the h:dataTable Tag</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Defines Styles For</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>captionClass</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Table caption</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>columnClasses</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All the columns</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>footerClass</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Footer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>headerClass</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Header</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rowClasses</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rows</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>styleClass</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The entire table</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Each of the attributes in <a href="#optional-attributes-for-the-hdatatable-tag">Table 10-7</a> can specify more than one style.
If <code>columnClasses</code> or <code>rowClasses</code> specifies more than one style, the styles are applied to the columns or rows in the order that the styles are listed in the attribute.
For example, if <code>columnClasses</code> specifies styles <code>list-column-center</code> and <code>list-column-right</code>, and if the table has two columns, the first column will have style <code>list-column-center</code>, and the second column will have style <code>list-column-right</code>.</p>
</div>
<div class="paragraph">
<p>If the style attribute specifies more styles than there are columns or rows, the remaining styles will be assigned to columns or rows starting from the first column or row.
Similarly, if the style attribute specifies fewer styles than there are columns or rows, the remaining columns or rows will be assigned styles starting from the first style.</p>
</div>
</div>
<div class="sect3">
<h4 id="displaying-error-messages-with-the-hmessage-and-hmessages-tags"><a class="anchor" href="#displaying-error-messages-with-the-hmessage-and-hmessages-tags"></a>Displaying Error Messages with the h:message and h:messages Tags</h4>
<div class="paragraph">
<p>The <code>h:message</code> and <code>h:messages</code> tags are used to display error messages when conversion or validation fails.
The <code>h:message</code> tag displays error messages related to a specific input component, whereas the <code>h:messages</code> tag displays the error messages for the entire page.</p>
</div>
<div class="paragraph">
<p>Here is an example <code>h:message</code> tag from the <code>guessnumber-jsf</code> application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;p&gt;</span>
    <span class="tag">&lt;h:inputText</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">userNo</span><span class="delimiter">&quot;</span></span>
                 <span class="attribute-name">title</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Type a number from 0 to 10:</span><span class="delimiter">&quot;</span></span>
                 <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{userNumberBean.userNumber}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;f:validateLongRange</span> <span class="attribute-name">minimum</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{userNumberBean.minimum}</span><span class="delimiter">&quot;</span></span>
                             <span class="attribute-name">maximum</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{userNumberBean.maximum}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
   <span class="tag">&lt;/h:inputText&gt;</span>
   <span class="tag">&lt;h:commandButton</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">submit</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Submit</span><span class="delimiter">&quot;</span></span>
                    <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">response</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/p&gt;</span>
<span class="tag">&lt;h:message</span> <span class="attribute-name">showSummary</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">showDetail</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>
           <span class="attribute-name">style</span>=<span class="string"><span class="delimiter">&quot;</span><span class="key">color</span>: <span class="color">#d20005</span>;
           <span class="key">font-family</span>: <span class="string"><span class="delimiter">'</span><span class="content">New Century Schoolbook</span><span class="delimiter">'</span></span>, <span class="value">serif</span>;
           <span class="key">font-style</span>: <span class="value">oblique</span>;
           <span class="key">text-decoration</span>: <span class="value">overline</span><span class="delimiter">&quot;</span></span>
           <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">errors1</span><span class="delimiter">&quot;</span></span>
           <span class="attribute-name">for</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">userNo</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>for</code> attribute refers to the ID of the component that generated the error message.
The error message is displayed at the same location that the <code>h:message</code> tag appears in the page.
In this case, the error message will appear below the Submit button.</p>
</div>
<div class="paragraph">
<p>The <code>style</code> attribute allows you to specify the style of the text of the message.
In the example in this section, the text will be a shade of red, New Century Schoolbook, serif font family, and oblique style, and a line will appear over the text.
The message and messages tags support many other attributes for defining styles.
For more information on these attributes, refer to the <a href="https://jakarta.ee/specifications/faces/3.0/vdldoc/" target="_blank" rel="noopener">Jakarta Faces Facelets Tag Library documentation</a>.</p>
</div>
<div class="paragraph">
<p>Another attribute supported by the <code>h:messages</code> tag is the <code>layout</code> attribute.
Its default value is <code>list</code>, which indicates that the messages are displayed in a bullet list using the HTML <code>ul</code> and <code>li</code> elements.
If you set the attribute value to <code>table</code>, the messages will be rendered in a table using the HTML <code>table</code> element.</p>
</div>
<div class="paragraph">
<p>The preceding example shows a standard validator that is registered on the input component.
The message tag displays the error message that is associated with this validator when the validator cannot validate the input component&#8217;s value.
In general, when you register a converter or validator on a component, you are queueing the error messages associated with the converter or validator on the component.
The <code>h:message</code> and <code>h:messages</code> tags display the appropriate error messages that are queued on the component when the validators or converters registered on that component fail to convert or validate the component&#8217;s value.</p>
</div>
<div class="paragraph">
<p>Standard error messages are provided with standard converters and standard validators.
An application architect can override these standard messages and supply error messages for custom converters and validators by registering custom error messages with the application.</p>
</div>
</div>
<div class="sect3">
<h4 id="creating-bookmarkable-urls-with-the-hbutton-and-hlink-tags"><a class="anchor" href="#creating-bookmarkable-urls-with-the-hbutton-and-hlink-tags"></a>Creating Bookmarkable URLs with the h:button and h:link Tags</h4>
<div class="paragraph">
<p>The ability to create bookmarkable URLs refers to the ability to generate links based on a specified navigation outcome and on component parameters.</p>
</div>
<div class="paragraph">
<p>In HTTP, most browsers by default send GET requests for URL retrieval and POST requests for data processing.
The GET requests can have query parameters and can be cached, which is not advised for POST requests, which send data to servers for processing.
The other Jakarta Faces tags capable of generating links use either simple GET requests, as in the case of <code>h:outputLink</code>, or POST requests, as in the case of <code>h:commandLink</code> or <code>h:commandButton</code> tags.
GET requests with query parameters provide finer granularity to URL strings.
These URLs are created with one or more <code>name=value</code> parameters appended to the simple URL after a <code>?</code> character and separated by either <code>&amp;;</code> or <code>&amp;</code> strings.</p>
</div>
<div class="paragraph">
<p>To create a bookmarkable URL, use an <code>h:link</code> or <code>h:button</code> tag.
Both of these tags can generate a link based on the <code>outcome</code> attribute of the component.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:link</span> <span class="attribute-name">outcome</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">somepage</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Message</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>h:link</code> tag will generate a URL link that points to the <code>somepage.xhtml</code> file on the same server.
The following sample HTML is generated from the preceding tag, assuming that the application name is <code>simplebookmark</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><span class="tag">&lt;a</span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/simplebookmark/somepage.xhtml</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>Message<span class="tag">&lt;/a&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This is a simple GET request that cannot pass any data from page to page.
To create more complex GET requests and utilize the complete functionality of the <code>h:link</code> tag, use view parameters.</p>
</div>
</div>
<div class="sect3">
<h4 id="using-view-parameters-to-configure-bookmarkable-urls"><a class="anchor" href="#using-view-parameters-to-configure-bookmarkable-urls"></a>Using View Parameters to Configure Bookmarkable URLs</h4>
<div class="paragraph">
<p>To pass a parameter from one page to another, use the <code>includeViewParams</code> attribute in your <code>h:link</code> tag and, in addition, use an <code>f:param</code> tag to specify the name and value to be passed.
Here the <code>h:link</code> tag specifies the outcome page as <code>personal.xhtml</code> and provides a parameter named <code>Result</code> whose value is a managed bean property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:body&gt;</span>
    <span class="tag">&lt;h:form&gt;</span>
        <span class="tag">&lt;h:graphicImage</span> <span class="attribute-name">url</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{resource['images:duke.waving.gif']}</span><span class="delimiter">&quot;</span></span>
                        <span class="attribute-name">alt</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Duke waving his hand</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;h2&gt;</span>Hello, #{hello.name}!<span class="tag">&lt;/h2&gt;</span>
        <span class="tag">&lt;p&gt;</span>I've made your
            <span class="tag">&lt;h:link</span> <span class="attribute-name">outcome</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">personal</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">personal greeting page!</span><span class="delimiter">&quot;</span></span>
                    <span class="attribute-name">includeViewParams</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;f:param</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Result</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{hello.name}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/h:link&gt;</span>
        <span class="tag">&lt;/p&gt;</span>
        <span class="tag">&lt;h:commandButton</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">back</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Back</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">index</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;/h:form&gt;</span>
<span class="tag">&lt;/h:body&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If the <code>includeViewParams</code> attribute is set on the component, the view parameters are added to the hyperlink.
Therefore, the resulting URL will look something like this if the value of <code>hello.name</code> is <code>Timmy</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080/bookmarks/personal.xhtml?Result=Timmy</pre>
</div>
</div>
<div class="paragraph">
<p>On the outcome page, specify the core tags <code>f:metadata</code> and <code>f:viewparam</code> as the source of parameters for configuring the URLs.
View parameters are declared as part of <code>f:metadata</code> for a page, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;f:metadata&gt;</span>
    <span class="tag">&lt;f:viewParam</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Result</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{hello.name}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/f:metadata&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This allows you to specify the bean property value on the page:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:outputText</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Howdy, #{hello.name}!</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As a view parameter, the name also appears in the page&#8217;s URL.
If you edit the URL, you change the output on the page.</p>
</div>
<div class="paragraph">
<p>Because the URL can be the result of various parameter values, the order of the URL creation has been predefined.
The order in which the various parameter values are read is as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Component</p>
</li>
<li>
<p>Navigation-case parameters</p>
</li>
<li>
<p>View parameters</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="the-bookmarks-example-application"><a class="anchor" href="#the-bookmarks-example-application"></a>The bookmarks Example Application</h4>
<div class="paragraph">
<p>The <code>bookmarks</code> example application modifies the <code>hello1</code> application described in <a href="#a-web-module-that-uses-jakarta-faces-technology-the-hello1-example">A Web Module That Uses Jakarta Faces Technology: The hello1 Example</a> to use a bookmarkable URL that uses view parameters.</p>
</div>
<div class="paragraph">
<p>Like <code>hello1</code>, the application includes the <code>Hello.java</code> managed bean, an <code>index.xhtml</code> page, and a <code>response.xhtml</code> page.
In addition, it includes a <code>personal.xhtml page</code>, to which a bookmarkable URL and view parameters are passed from the <code>response.xhtml</code> page, as described in <a href="#using-view-parameters-to-configure-bookmarkable-urls">Using View Parameters to Configure Bookmarkable URLs</a>.</p>
</div>
<div class="paragraph">
<p>You can use either NetBeans IDE or Maven to build, package, deploy, and run the <code>bookmarks</code> example.
The source code for this example is in the <code><em>tut-install</em>/examples/web/jsf/bookmarks/</code> directory.</p>
</div>
<div class="sect4">
<h5 id="to-build-package-and-deploy-the-bookmarks-example-using-netbeans-ide"><a class="anchor" href="#to-build-package-and-deploy-the-bookmarks-example-using-netbeans-ide"></a>To Build, Package, and Deploy the bookmarks Example Using NetBeans IDE</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>From the <strong>File</strong> menu, choose <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the Open Project dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/web/jsf</pre>
</div>
</div>
</li>
<li>
<p>Select the <code>bookmarks</code> folder.</p>
</li>
<li>
<p>Click <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the <strong>Projects</strong> tab, right-click the <code>bookmarks</code> project and select <strong>Build</strong>.</p>
<div class="paragraph">
<p>This option builds the example application and deploys it to your GlassFish Server instance.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-build-package-and-deploy-the-bookmarks-example-using-maven"><a class="anchor" href="#to-build-package-and-deploy-the-bookmarks-example-using-maven"></a>To Build, Package, and Deploy the bookmarks Example Using Maven</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>In a terminal window, go to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/web/jsf/bookmarks/</pre>
</div>
</div>
</li>
<li>
<p>Enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">mvn install</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command builds and packages the application into a WAR file, <code>bookmarks.war</code>, that is located in the <code>target</code> directory.
It then deploys the WAR file to your GlassFish Server instance.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-run-the-bookmarks-example"><a class="anchor" href="#to-run-the-bookmarks-example"></a>To Run the bookmarks Example</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Enter the following URL in your web browser:</p>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080/bookmarks</pre>
</div>
</div>
</li>
<li>
<p>In the text field, enter a name and click Submit.</p>
</li>
<li>
<p>On the response page, move your mouse over the "personal greeting page" link to view the URL with the view parameter, then click the link.</p>
<div class="paragraph">
<p>The <code>personal.xhtml</code> page opens, displaying a greeting to the name you typed.</p>
</div>
</li>
<li>
<p>In the URL field, modify the Result parameter value and press Return.</p>
<div class="paragraph">
<p>The name in the greeting changes to what you typed.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="resource-relocation-using-houtputscript-and-houtputstylesheet-tags"><a class="anchor" href="#resource-relocation-using-houtputscript-and-houtputstylesheet-tags"></a>Resource Relocation Using h:outputScript and h:outputStylesheet Tags</h4>
<div class="paragraph">
<p>Resource relocation refers to the ability of a Jakarta Faces application to specify the location where a resource can be rendered.
Resource relocation can be defined with the following HTML tags:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>h:outputScript</code></p>
</li>
<li>
<p><code>h:outputStylesheet</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These tags have <code>name</code> and <code>target</code> attributes, which can be used to define the render location.
For a complete list of attributes for these tags, see the <a href="https://jakarta.ee/specifications/faces/3.0/vdldoc/" target="_blank" rel="noopener">Jakarta Faces Facelets Tag Library documentation</a>.</p>
</div>
<div class="paragraph">
<p>For the <code>h:outputScript</code> tag, the <code>name</code> and <code>target</code> attributes define where the output of a resource may appear.
Here is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;html</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/1999/xhtml</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xmlns:h</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://xmlns.jcp.org/jsf/html</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;h:head</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">head</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;title&gt;</span>Resource Relocation<span class="tag">&lt;/title&gt;</span>
    <span class="tag">&lt;/h:head&gt;</span>
    <span class="tag">&lt;h:body</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">body</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;h:form</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">form</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;h:outputScript</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hello.js</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;h:outputStylesheet</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hello.css</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/h:form&gt;</span>
    <span class="tag">&lt;/h:body&gt;</span>
<span class="tag">&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Because the <code>target</code> attribute is not defined in the tags, the style sheet <code>hello.css</code> is rendered in the head element of the page, and the <code>hello.js</code> script is rendered in the body of the page.</p>
</div>
<div class="paragraph">
<p>Here is the HTML generated by the preceding code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;html</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/1999/xhtml</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;head&gt;</span>
        <span class="tag">&lt;title&gt;</span>Resource Relocation<span class="tag">&lt;/title&gt;</span>
        <span class="tag">&lt;link</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text/css</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">rel</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">stylesheet</span><span class="delimiter">&quot;</span></span>
              <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/context-root/jakarta.faces.resource/hello.css</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/head&gt;</span>
    <span class="tag">&lt;body&gt;</span>
        <span class="tag">&lt;form</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">form</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">form</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">method</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">post</span><span class="delimiter">&quot;</span></span>
              <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">...</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">enctype</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">...</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;script</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text/javascript</span><span class="delimiter">&quot;</span></span>
                    <span class="attribute-name">src</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/context-root/jakarta.faces.resource/hello.js</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="inline">            </span><span class="tag">&lt;/script&gt;</span>
        <span class="tag">&lt;/form&gt;</span>
    <span class="tag">&lt;/body&gt;</span>
<span class="tag">&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you set the <code>target</code> attribute for the <code>h:outputScript</code> tag, the incoming GET request provides the location parameter.
Here is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;html</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/1999/xhtml</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xmlns:h</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://xmlns.jcp.org/jsf/html</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;h:head</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">head</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;title&gt;</span>Resource Relocation<span class="tag">&lt;/title&gt;</span>
    <span class="tag">&lt;/h:head&gt;</span>
    <span class="tag">&lt;h:body</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">body</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;h:form</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">form</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;h:outputScript</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hello.js</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">target</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{param.location}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;h:outputStylesheet</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hello.css</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/h:form&gt;</span>
    <span class="tag">&lt;/h:body&gt;</span>
<span class="tag">&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, if the incoming request does not provide a location parameter, the default locations will still apply: The style sheet is rendered in the head, and the script is rendered inline.
However, if the incoming request specifies the location parameter as the head, both the style sheet and the script will be rendered in the <code>head</code> element.</p>
</div>
<div class="paragraph">
<p>The HTML generated by the preceding code is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><span class="tag">&lt;html</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/1999/xhtml</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;head&gt;</span>
        <span class="tag">&lt;title&gt;</span>Resource Relocation<span class="tag">&lt;/title&gt;</span>
        <span class="tag">&lt;link</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text/css</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">rel</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">stylesheet</span><span class="delimiter">&quot;</span></span>
              <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/context-root/jakarta.faces.resource/hello.css</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;script</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text/javascript</span><span class="delimiter">&quot;</span></span>
                <span class="attribute-name">src</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/context-root/jakarta.faces.resource/hello.js</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="inline">          </span><span class="tag">&lt;/script&gt;</span>
    <span class="tag">&lt;/head&gt;</span>
    <span class="tag">&lt;body&gt;</span>
        <span class="tag">&lt;form</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">form</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">form</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">method</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">post</span><span class="delimiter">&quot;</span></span>
              <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">...</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">enctype</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">...</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;/form&gt;</span>
    <span class="tag">&lt;/body&gt;</span>
<span class="tag">&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Similarly, if the incoming request provides the location parameter as the body, the script will be rendered in the body element.</p>
</div>
<div class="paragraph">
<p>The preceding section describes simple uses for resource relocation.
That feature can add even more functionality for the components and pages.
A page author does not have to know the location of a resource or its placement.</p>
</div>
<div class="paragraph">
<p>By using a <code>@ResourceDependency</code> annotation for the components, component authors can define the resources for the component, such as a style sheet and script.
This allows the page authors freedom from defining resource locations.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-core-tags"><a class="anchor" href="#using-core-tags"></a>Using Core Tags</h3>
<div class="paragraph">
<p>The tags included in the Jakarta Faces core tag library are used to perform core actions that are not performed by HTML tags.</p>
</div>
<div class="paragraph">
<p><a href="#event-handling-core-tags">Table 10-8</a> lists the event-handling core tags.</p>
</div>
<table id="event-handling-core-tags" class="tableblock frame-all grid-all" style="width: 99%;">
<caption class="title">Table 10-8 Event-Handling Core Tags</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Tag</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>f:actionListener</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adds an action listener to a parent component</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>f:phaseListener</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Adds a <code>PhaseListener</code> to a page</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>f:setPropertyActionListener</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Registers a special action listener whose sole purpose is to push a value into a managed bean when a form is submitted</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>f:valueChangeListener</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adds a value-change listener to a parent component</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><a href="#data-conversion-core-tags">Table 10-9</a> lists the data-conversion core tags.</p>
</div>
<table id="data-conversion-core-tags" class="tableblock frame-all grid-all" style="width: 99%;">
<caption class="title">Table 10-9 Data-Conversion Core Tags</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Tag</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>f:converter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adds an arbitrary converter to the parent component</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>f:convertDateTime</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Adds a <code>DateTimeConverter</code> instance to the parent component</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>f:convertNumber</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Adds a <code>NumberConverter</code> instance to the parent component</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><a href="#facet-core-tags">Table 10-10</a> lists the facet core tags.</p>
</div>
<table id="facet-core-tags" class="tableblock frame-all grid-all" style="width: 99%;">
<caption class="title">Table 10-10 Facet Core Tags</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Tag</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>f:facet</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adds a nested component that has a special relationship to
its enclosing tag</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>f:metadata</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Registers a <code>facet</code> on a parent component</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><a href="#core-tags-that-represent-items-in-a-list">Table 10-11</a> lists the core tags that represent items in a list.</p>
</div>
<table id="core-tags-that-represent-items-in-a-list" class="tableblock frame-all grid-all" style="width: 99%;">
<caption class="title">Table 10-11 Core Tags That Represent Items in a List</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Tag</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>f:selectItem</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Represents one item in a list of items</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>f:selectItems</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Represents a set of items</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><a href="#validator-core-tags">Table 10-12</a> lists the validator core tags.</p>
</div>
<table id="validator-core-tags" class="tableblock frame-all grid-all" style="width: 99%;">
<caption class="title">Table 10-12 Validator Core Tags</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Tag</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>f:validateDoubleRange</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Adds a <code>DoubleRangeValidator</code> to a component</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>f:validateLength</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Adds a <code>LengthValidator</code> to a component</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>f:validateLongRange</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Adds a <code>LongRangeValidator</code> to a component</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>f:validator</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adds a custom validator to a component</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>f:validateRegEx</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Adds a <code>RegExValidator</code> to a component</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>f:validateBean</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Delegates the validation of a local value to a <code>BeanValidator</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>f:validateRequired</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enforces the presence of a value in a component</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><a href="#miscellaneous-core-tags">Table 10-13</a> lists the core tags that fall into other categories.</p>
</div>
<table id="miscellaneous-core-tags" class="tableblock frame-all grid-all" style="width: 99%;">
<caption class="title">Table 10-13 Miscellaneous Core Tags</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 15%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Tag Category</th>
<th class="tableblock halign-left valign-top">Tag</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Attribute configuration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>f:attribute</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adds configurable attributes to a parent component</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Localization</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>f:loadBundle</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Specifies a <code>ResourceBundle</code> that is exposed as a <code>Map</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Parameter substitution</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>f:param</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Substitutes parameters into a <code>MessageFormat</code> instance and adds query string name-value pairs to a URL</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ajax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>f:ajax</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Associates an Ajax action with a single component or a group of components based on placement</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Event</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>f:event</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Allows installing a <code>ComponentSystemEventListener</code> on a component</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">WebSocket</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>f:websocket</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows server-side communications to be pushed to all instances of a socket containing the same channel name.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>These tags, which are used in conjunction with component tags, are explained in other sections of this tutorial.</p>
</div>
<div class="paragraph">
<p><a href="#where-the-core-tags-are-explained">Table 10-14</a> lists the sections that explain how to use specific core tags.</p>
</div>
<table id="where-the-core-tags-are-explained" class="tableblock frame-all grid-all" style="width: 99%;">
<caption class="title">Table 10-14 Where the Core Tags Are Explained</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Tags</th>
<th class="tableblock halign-left valign-top">Where Explained</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Event-handling tags</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#registering-listeners-on-components">Registering Listeners on Components</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Data-conversion tags</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#using-the-standard-converters">Using the Standard Converters</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>f:facet</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#using-data-bound-table-components">Using Data-Bound Table Components</a> and <a href="#laying-out-components-with-the-hpanelgrid-and-hpanelgroup-tags">Laying Out Components with the h:panelGrid and h:panelGroup Tags</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>f:loadBundle</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#setting-the-resource-bundle">Setting the Resource Bundle</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>f:metadata</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#using-view-parameters-to-configure-bookmarkable-urls">Using View Parameters to Configure Bookmarkable URLs</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>f:param</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#displaying-a-formatted-message-with-the-houtputformat-tag">Displaying a Formatted Message with the h:outputFormat Tag</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>f:selectItem</code> and <code>f:selectItems</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#using-the-fselectitem-and-fselectitems-tags">Using the f:selectItem and f:selectItems Tags</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Validator tags</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#using-the-standard-validators">Using the Standard Validators</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>f:ajax</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#using-ajax-with-jakarta-faces-technology">Chapter 13, <em>Using Ajax with Jakarta Faces Technology</em></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>f:websocket</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#using-websockets-with-jakarta-faces-technology">Chapter 17, <em>Using WebSockets with Jakarta Faces Technology</em></a></p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using-converters-listeners-and-validators"><a class="anchor" href="#using-converters-listeners-and-validators"></a>Chapter 11. Using Converters, Listeners, and Validators</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The previous chapter described components and explained how to add them to a web page.
This chapter provides information on adding more functionality to the components through converters, listeners, and validators.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Converters are used to convert data that is received from the input components.
Converters allow an application to bring the strongly typed features of the Java programming language into the String-based world of HTTP servlet programming.</p>
</li>
<li>
<p>Listeners are used to listen to the events happening in the page and perform actions as defined.</p>
</li>
<li>
<p>Validators are used to validate the data that is received from the input components.
Validators allow an application to express constraints on form input data to ensure that the necessary requirements are met before the input data is processed.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="using-the-standard-converters"><a class="anchor" href="#using-the-standard-converters"></a>Using the Standard Converters</h3>
<div class="paragraph">
<p>The Jakarta Faces implementation provides a set of <code>Converter</code> implementations that you can use to convert component data.
The purpose of conversion is to take the String-based data coming in from the Servlet API and convert it to strongly typed Java objects suitable for the business domain.
For more information on the conceptual details of the conversion model, see <a href="#conversion-model">Conversion Model</a>.</p>
</div>
<div class="paragraph">
<p>The standard <code>Converter</code> implementations are located in the <code>jakarta.faces.convert</code> package.
Normally, converters are implicitly assigned based on the type of the EL expression pointed to by the value of the component.
However, these converters can also be accessed by a converter ID.
<a href="#converter-classes-and-converter-ids">Table 11-1</a> shows the converter classes and their associated converter IDs.</p>
</div>
<table id="converter-classes-and-converter-ids" class="tableblock frame-all grid-all" style="width: 60%;">
<caption class="title">Table 11-1 Converter Classes and Converter IDs</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Class in the jakarta.faces.convert Package</th>
<th class="tableblock halign-left valign-top">Converter ID</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BigDecimalConverter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jakarta.faces.BigDecimal</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BigIntegerConverter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jakarta.faces.BigInteger</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BooleanConverter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jakarta.faces.Boolean</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ByteConverter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jakarta.faces.Byte</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CharacterConverter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jakarta.faces.Character</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DateTimeConverter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jakarta.faces.DateTime</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DoubleConverter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jakarta.faces.Double</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>EnumConverter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jakarta.faces.Enum</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FloatConverter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jakarta.faces.Float</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IntegerConverter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jakarta.faces.Integer</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LongConverter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jakarta.faces.Long</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NumberConverter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jakarta.faces.Number</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ShortConverter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jakarta.faces.Short</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>A standard error message is associated with each of these converters.
If you have registered one of these converters onto a component on your page and the converter is not able to convert the component&#8217;s value, the converter&#8217;s error message will display on the page.
For example, the following error message appears if <code>BigIntegerConverter</code> fails to convert a value:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">{<span class="integer">0</span>} must be a number consisting of one or more digits</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, the <code>{0}</code> substitution parameter will be replaced with the name of the input component on which the converter is registered.</p>
</div>
<div class="paragraph">
<p>Two of the standard converters (<code>DateTimeConverter</code> and <code>NumberConverter</code>) have their own tags, which allow you to configure the format of the component data using the tag attributes.
For more information about using <code>DateTimeConverter</code>, see <a href="#using-datetimeconverter">Using DateTimeConverter</a>.
For more information about using <code>NumberConverter</code>, see <a href="#using-numberconverter">Using NumberConverter</a>.
The following section explains how to convert a component&#8217;s value, including how to register other standard converters with a component.</p>
</div>
<div class="sect3">
<h4 id="converting-a-components-value"><a class="anchor" href="#converting-a-components-value"></a>Converting a Component&#8217;s Value</h4>
<div class="paragraph">
<p>To use a particular converter to convert a component&#8217;s value, you need to register the converter onto the component.
You can register any of the standard converters in one of the following ways.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Nest one of the standard converter tags inside the component&#8217;s tag.
These tags are <code>f:convertDateTime</code> and <code>f:convertNumber</code>, which are described in <a href="#using-numberconverter">Using NumberConverter</a>, respectively.</p>
</li>
<li>
<p>Bind the value of the component to a managed bean property of the same type as the converter.
This is the most common technique.</p>
</li>
<li>
<p>Refer to the converter from the component tag&#8217;s <code>converter</code> attribute, specifying the ID of the converter class.</p>
</li>
<li>
<p>Nest an <code>f:converter</code> tag inside of the component tag, and use either the <code>f:converter</code> tag&#8217;s <code>converterId</code> attribute or its <code>binding</code> attribute to refer to the converter.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As an example of the second technique, if you want a component&#8217;s data to be converted to an <code>Integer</code>, you can simply bind the component&#8217;s value to a managed bean property.
Here is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Integer</span> age = <span class="integer">0</span>;
<span class="directive">public</span> <span class="predefined-type">Integer</span> getAge(){ <span class="keyword">return</span> age;}
<span class="directive">public</span> <span class="type">void</span> setAge(<span class="predefined-type">Integer</span> age) {<span class="local-variable">this</span>.age = age;}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The data from the <code>h:inputText</code> tag in the this example will be converted to a <code>java.lang.Integer</code> value.
The <code>Integer</code> type is a supported type of <code>NumberConverter</code>.
If you don&#8217;t need to specify any formatting instructions using the <code>f:convertNumber</code> tag attributes, and if one of the standard converters will suffice, you can simply reference that converter by using the component tag&#8217;s <code>converter</code> attribute.</p>
</div>
<div class="paragraph">
<p>You can also nest an <code>f:converter</code> tag within the component tag and use either the converter tag&#8217;s <code>converterId</code> attribute or its <code>binding</code> attribute to reference the converter.</p>
</div>
<div class="paragraph">
<p>The <code>converterId</code> attribute must reference the converter&#8217;s ID.
Here is an example that uses one of the converter IDs listed in <a href="#converter-classes-and-converter-ids">Table 11-1</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:inputText</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{loginBean.age}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;f:converter</span> <span class="attribute-name">converterId</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakarta.faces.Integer</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/h:inputText&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Instead of using the <code>converterId</code> attribute, the <code>f:converter</code> tag can use the <code>binding</code> attribute.
The <code>binding</code> attribute must resolve to a bean property that accepts and returns an appropriate <code>Converter</code> instance.</p>
</div>
<div class="paragraph">
<p>You can also create custom converters and register them on components using the <code>f:converter</code> tag.
For details, see <a href="#creating-and-using-a-custom-converter">Creating and Using a Custom Converter</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="using-datetimeconverter"><a class="anchor" href="#using-datetimeconverter"></a>Using DateTimeConverter</h4>
<div class="paragraph">
<p>You can convert a component&#8217;s data to a <code>java.util.Date</code> by nesting the <code>convertDateTime</code> tag inside the component tag.
The <code>convertDateTime</code> tag has several attributes that allow you to specify the format and type of the data.
<a href="#attributes-for-the-fconvertDateTime-tag">Table 11-2</a> lists the attributes.</p>
</div>
<div class="paragraph">
<p>Here is a simple example of a <code>convertDateTime</code> tag:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:outputText</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{cashierBean.shipDate}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;f:convertDateTime</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">date</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">dateStyle</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">full</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/h:outputText&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When binding the <code>DateTimeConverter</code> to a component, ensure that the managed bean property to which the component is bound is of type <code>java.util.Date</code>.
In the preceding example, <code>cashierBean.shipDate</code> must be of type <code>java.util.Date</code>.</p>
</div>
<div class="paragraph">
<p>The example tag can display the following output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Saturday, September 21, 2013</pre>
</div>
</div>
<div class="paragraph">
<p>You can also display the same date and time by using the following tag in which the date format is specified:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:outputText</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{cashierBean.shipDate}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;f:convertDateTime</span> <span class="attribute-name">pattern</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">EEEEEEEE, MMM dd, yyyy</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/h:outputText&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want to display the example date in Spanish, you can use the <code>locale</code> attribute:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:outputText</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{cashierBean.shipDate}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;f:convertDateTime</span> <span class="attribute-name">dateStyle</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">full</span><span class="delimiter">&quot;</span></span>
                       <span class="attribute-name">locale</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">es</span><span class="delimiter">&quot;</span></span>
                       <span class="attribute-name">timeStyle</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">long</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">both</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/h:outputText&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This tag would display the following output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>jueves 24 de octubre de 2013 15:07:04 GMT</pre>
</div>
</div>
<div class="paragraph">
<p>Refer to the "Customizing Formats" lesson of the Java Tutorial at <a href="https://docs.oracle.com/javase/tutorial/i18n/format/simpleDateFormat.html" class="bare" target="_blank" rel="noopener">https://docs.oracle.com/javase/tutorial/i18n/format/simpleDateFormat.html</a> for more information on how to format the output using the <code>pattern</code> attribute of the <code>convertDateTime</code> tag.</p>
</div>
<table id="attributes-for-the-fconvertDateTime-tag" class="tableblock frame-all grid-all" style="width: 99%;">
<caption class="title">Table 11-2 Attributes for the f:convertDateTime Tag</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>binding</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DateTimeConverter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used to bind a converter to a managed bean property.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>dateStyle</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Defines the format, as specified by <code>java.text.DateFormat</code>, of a date or the date part of a <code>date</code> string.
Applied only if <code>type</code> is <code>date</code> or <code>both</code> and if <code>pattern</code> is not defined.
Valid values: <code>default</code>, <code>short</code>, <code>medium</code>, <code>long</code>, and <code>full</code>.
If no value is specified, <code>default</code> is used.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>for</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used with composite components.
Refers to one of the objects within the composite component inside which this tag is nested.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>locale</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code> or <code>Locale</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>Locale</code> whose predefined styles for dates and times are used during formatting or parsing.
If not specified, the <code>Locale</code> returned by <code>FacesContext.getLocale</code> will be used.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>pattern</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Custom formatting pattern that determines how the date/time string should be formatted and parsed.
If this attribute is specified, <code>dateStyle</code> and <code>timeStyle</code> attributes are ignored.</p>
</div>
<div class="paragraph">
<p>See <a href="#type-attribute-and-default-pattern-values">Table 11-3</a> for the default values when <code>pattern</code> is not specified.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>timeStyle</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Defines the format, as specified by <code>java.text.DateFormat</code>, of a <code>time</code> or the time part of a <code>date</code> string.
Applied only if <code>type</code> is time and <code>pattern</code> is not defined.
Valid values: <code>default</code>, <code>short</code>, <code>medium</code>, <code>long</code>, and <code>full</code>.
If no value is specified, <code>default</code> is used.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>timeZone</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code> or <code>TimeZone</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Time zone in which to interpret any time information in the <code>date</code> string.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>type</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Specifies whether the string value will contain a date, a time, or both.
Valid values are: <code>date</code>, <code>time</code>, <code>both</code>, <code>LocalDate</code>, <code>LocalTime</code>, <code>LocalDateTime</code>, <code>OffsetTime</code>, <code>OffsetDateTime</code>, or <code>ZonedDateTime</code>.
If no value is specified, <code>date</code> is used.</p>
</div>
<div class="paragraph">
<p>See <a href="#type-attribute-and-default-pattern-values">Table 11-3</a> for additional information.</p>
</div></div></td>
</tr>
</tbody>
</table>
<table id="type-attribute-and-default-pattern-values" class="tableblock frame-all grid-all" style="width: 99%;">
<caption class="title">Table 11-3 Type Attribute and Default Pattern Values</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type Attribute</th>
<th class="tableblock halign-left valign-top">Class</th>
<th class="tableblock halign-left valign-top">Default When Pattern Is Not Specified</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>both</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.util.Date</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DateFormat.getDateTimeInstance(dateStyle,timeStyle)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>date</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.util.Date</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DateFormat.getDateTimeInstance(dateStyle)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>time</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.util.Date</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DateFormat.getDateTimeInstance(timeStyle)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>localDate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.time.LocalDate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DateTimeFormatter.ofLocalizedDate(dateStyle)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>localTime</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.time.LocalTime</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DateTimeFormatter.ofLocalizedTime(dateStyle)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>localDateTime</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.time.LocalDateTime</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DateTimeFormatter.ofLocalizedDateTime(dateStyle)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>offsetTime</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.time.OffsetTime</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DateTimeFormatter.ISO_OFFSET_TIME</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>offsetDateTime</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.time.OffsetDateTime</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DateTimeFormatter.ISO_OFFSET_DATE_TIME</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zonedDateTime</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.time.ZonedDateTime</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DateTimeFormatter.ISO_ZONED_DATE_TIME</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="using-numberconverter"><a class="anchor" href="#using-numberconverter"></a>Using NumberConverter</h4>
<div class="paragraph">
<p>You can convert a component&#8217;s data to a <code>java.lang.Number</code> by nesting the <code>convertNumber</code> tag inside the component tag.
The <code>convertNumber</code> tag has several attributes that allow you to specify the format and type of the data.
<a href="#attributes-for-the-fconvertNumber-tag">Table 11-4</a> lists the attributes.</p>
</div>
<div class="paragraph">
<p>The following example uses a <code>convertNumber</code> tag to display the total prices of the contents of a shopping cart:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:outputText</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{cart.total}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;f:convertNumber</span> <span class="attribute-name">currencySymbol</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">$</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">currency</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/h:outputText&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When binding the <code>NumberConverter</code> to a component, ensure that the managed bean property to which the component is bound is of a primitive type or has a type of <code>java.lang.Number</code>.
In the preceding example, <code>cart.total</code> is of type <code>double</code>.</p>
</div>
<div class="paragraph">
<p>Here is an example of a number that this tag can display:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$934</pre>
</div>
</div>
<div class="paragraph">
<p>This result can also be displayed by using the following tag in which the currency pattern is specified:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:outputText</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">cartTotal</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{cart.total}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;f:convertNumber</span> <span class="attribute-name">pattern</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">$####</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/h:outputText&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>See the "Customizing Formats" lesson of the Java Tutorial at <a href="https://docs.oracle.com/javase/tutorial/i18n/format/decimalFormat.html" class="bare" target="_blank" rel="noopener">https://docs.oracle.com/javase/tutorial/i18n/format/decimalFormat.html</a> for more information on how to format the output by using the <code>pattern</code> attribute of the <code>convertNumber</code> tag.</p>
</div>
<table id="attributes-for-the-fconvertNumber-tag" class="tableblock frame-all grid-all" style="width: 99%;">
<caption class="title">Table 11-4 Attributes for the f:convertNumber Tag</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>binding</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NumberConverter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used to bind a converter to a managed bean property.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>currencyCode</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISO 4217 currency code, used only when formatting currencies.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>currencySymbol</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Currency symbol, applied only when formatting currencies.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>for</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used with composite components.
Refers to one of the objects within the composite component inside which this tag is nested.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>groupingUsed</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Boolean</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies whether formatted output contains grouping separators.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>integerOnly</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Boolean</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies whether only the integer part of the value will be parsed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>locale</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code> or <code>Locale</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Locale</code> whose number styles are used to format or parse data.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>maxFractionDigits</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>int</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum number of digits formatted in the fractional part of the output.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>maxIntegerDigits</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>int</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum number of digits formatted in the integer part of the output.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>minFractionDigits</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>int</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Minimum number of digits formatted in the
fractional part of the output.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>minIntegerDigits</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>int</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Minimum number of digits formatted in the integer part of the output.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pattern</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Custom formatting pattern that determines how the number string is formatted and parsed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>type</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies whether the string value is parsed and formatted as a <code>number</code>, <code>currency</code>, or <code>percentage</code>.
If not specified, <code>number</code> is used.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="registering-listeners-on-components"><a class="anchor" href="#registering-listeners-on-components"></a>Registering Listeners on Components</h3>
<div class="paragraph">
<p>An application developer can implement listeners as classes or as managed bean methods.
If a listener is a managed bean method, the page author references the method from either the component&#8217;s <code>valueChangeListener</code> attribute or its <code>actionListener</code> attribute.
If the listener is a class, the page author can reference the listener from either an <code>f:valueChangeListener</code> tag or an <code>f:actionListener</code> tag and nest the tag inside the component tag to register the listener on the component.</p>
</div>
<div class="paragraph">
<p><a href="#referencing-a-method-that-handles-an-action-event">Referencing a Method That Handles an Action Event</a> and <a href="#referencing-a-method-that-handles-a-value-change-event">Referencing a Method That Handles a Value-Change Event</a> explain how a page author uses the <code>valueChangeListener</code> and <code>actionListener</code> attributes to reference managed bean methods that handle events.</p>
</div>
<div class="paragraph">
<p>This section explains how to register a <code>NameChanged</code> value-change listener and a <code>BookChange</code> action listener implementation on components.
The Duke&#8217;s Bookstore case study includes both of these listeners.</p>
</div>
<div class="sect3">
<h4 id="registering-a-value-change-listener-on-a-component"><a class="anchor" href="#registering-a-value-change-listener-on-a-component"></a>Registering a Value-Change Listener on a Component</h4>
<div class="paragraph">
<p>A page author can register a <code>ValueChangeListener</code> implementation on a component that implements <code>EditableValueHolder</code> by nesting an <code>f:valueChangeListener</code> tag within the component&#8217;s tag on the page.
The <code>f:valueChangeListener</code> tag supports the attributes shown in <a href="#attributes-for-the-fvaluechangelistener-tag">Table 11-5</a>, one of which must be used.</p>
</div>
<table id="attributes-for-the-fvaluechangelistener-tag" class="tableblock frame-all grid-all" style="width: 60%;">
<caption class="title">Table 11-5 Attributes for the f:valueChangeListener Tag</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>type</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">References the fully qualified class name of a <code>ValueChangeListener</code> implementation.
Can accept a literal or a value expression.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>binding</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">References an object that implements <code>ValueChangeListener</code>.
Can accept only a value expression, which must point to a managed bean property that accepts and returns a <code>ValueChangeListener</code> implementation.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The following example shows a value-change listener registered on a component:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:inputText</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">30</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{cashierBean.name}</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">required</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">requiredMessage</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{bundle.ReqCustomerName}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;f:valueChangeListener</span>
        <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ee.jakarta.tutorial.dukesbookstore.listeners.NameChanged</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/h:inputText&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example, the core tag <code>type</code> attribute specifies the custom <code>NameChanged</code> listener as the <code>ValueChangeListener</code> implementation registered on the <code>name</code> component.</p>
</div>
<div class="paragraph">
<p>After this component tag is processed and local values have been validated, its corresponding component instance will queue the <code>ValueChangeEvent</code> associated with the specified <code>ValueChangeListener</code> to the component.</p>
</div>
<div class="paragraph">
<p>The <code>binding</code> attribute is used to bind a <code>ValueChangeListener</code> implementation to a managed bean property.
This attribute works in a similar way to the <code>binding</code> attribute supported by the standard converter tags.
See <a href="#binding-component-values-and-instances-to-managed-bean-properties">Binding Component Values and Instances to Managed Bean Properties</a> for more information.</p>
</div>
</div>
<div class="sect3">
<h4 id="registering-an-action-listener-on-a-component"><a class="anchor" href="#registering-an-action-listener-on-a-component"></a>Registering an Action Listener on a Component</h4>
<div class="paragraph">
<p>A page author can register an <code>ActionListener</code> implementation on a command component by nesting an <code>f:actionListener</code> tag within the component&#8217;s tag on the page.
Similarly to the <code>f:valueChangeListener</code> tag, the <code>f:actionListener</code> tag supports both the <code>type</code> and <code>binding</code> attributes.
One of these attributes must be used to reference the action listener.</p>
</div>
<div class="paragraph">
<p>Here is an example of an <code>h:commandLink</code> tag that references an <code>ActionListener</code> implementation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:commandLink</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Duke</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bookstore</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;f:actionListener</span>
        <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ee.jakarta.tutorial.dukesbookstore.listeners.LinkBookChangeListener</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;h:outputText</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{bundle.Book201}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/h:commandLink&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>type</code> attribute of the <code>f:actionListener</code> tag specifies the fully qualified class name of the <code>ActionListener</code> implementation.
Similarly to the <code>f:valueChangeListener</code> tag, the <code>f:actionListener</code> tag also supports the <code>binding</code> attribute.
See <a href="#binding-converters-listeners-and-validators-to-managed-bean-properties">Binding Converters, Listeners, and Validators to Managed Bean Properties</a> for more information about binding listeners to managed bean properties.</p>
</div>
<div class="paragraph">
<p>In addition to the <code>actionListener</code> tag that allows you register a custom listener onto a component, the core tag library includes the <code>f:setPropertyActionListener</code> tag.
You use this tag to register a special action listener onto the <code>ActionSource</code> instance associated with a component.
When the component is activated, the listener will store the object referenced by the tag&#8217;s <code>value</code> attribute into the object referenced by the tag&#8217;s <code>target</code> attribute.</p>
</div>
<div class="paragraph">
<p>The <code>bookcatalog.xhtml</code> page of the Duke&#8217;s Bookstore application uses <code>f:setPropertyActionListener</code> with two components: the <code>h:commandLink</code> component used to link to the <code>bookdetails.xhtml</code> page and the <code>h:commandButton</code> component used to add a book to the cart:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:dataTable</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">books</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{store.books}</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">var</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">book</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">headerClass</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">list-header</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">styleClass</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">list-background</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">rowClasses</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">list-row-even, list-row-odd</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">border</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">summary</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{bundle.BookCatalog}</span><span class="delimiter">&quot;</span></span> <span class="tag">&gt;</span>
    ...
    <span class="tag">&lt;h:column&gt;</span>
        <span class="tag">&lt;f:facet</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">header</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;h:outputText</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{bundle.ItemTitle}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/f:facet&gt;</span>
        <span class="tag">&lt;h:commandLink</span> <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{catalog.details}</span><span class="delimiter">&quot;</span></span>
                       <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{book.title}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;f:setPropertyActionListener</span> <span class="attribute-name">target</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{requestScope.book}</span><span class="delimiter">&quot;</span></span>
                                         <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{book}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/h:commandLink&gt;</span>
    <span class="tag">&lt;/h:column&gt;</span>
    ...
    <span class="tag">&lt;h:column&gt;</span>
        <span class="tag">&lt;f:facet</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">header</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;h:outputText</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{bundle.CartAdd}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/f:facet&gt;</span>
        <span class="tag">&lt;h:commandButton</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">add</span><span class="delimiter">&quot;</span></span>
                         <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{catalog.add}</span><span class="delimiter">&quot;</span></span>
                         <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{bundle.CartAdd}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;f:setPropertyActionListener</span> <span class="attribute-name">target</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{requestScope.book}</span><span class="delimiter">&quot;</span></span>
                                         <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{book}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/h:commandButton&gt;</span>
    <span class="tag">&lt;/h:column&gt;</span>
    ...
<span class="tag">&lt;/h:dataTable&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>h:commandLink</code> and <code>h:commandButton</code> tags are within an <code>h:dataTable</code> tag, which iterates over the list of books.
The <code>var</code> attribute refers to a single book in the list of books.</p>
</div>
<div class="paragraph">
<p>The object referenced by the <code>var</code> attribute of an <code>h:dataTable</code> tag is in page scope.
However, in this case you need to put this object into request scope so that when the user activates the <code>commandLink</code> component to go to <code>bookdetails.xhtml</code> or activates the <code>commandButton</code> component to go to <code>bookcatalog.xhtml</code>, the book data is available to those pages.
Therefore, the <code>f:setPropertyActionListener</code> tag is used to set the current book object into request scope when the <code>commandLink</code> or <code>commandButton</code> component is activated.</p>
</div>
<div class="paragraph">
<p>In the preceding example, the <code>f:setPropertyActionListener</code> tag&#8217;s <code>value</code> attribute references the <code>book</code> object.
The <code>f:setPropertyActionListener</code> tag&#8217;s <code>target</code> attribute references the value expression <code>requestScope.book</code>, which is where the <code>book</code> object referenced by the <code>value</code> attribute is stored when the <code>commandLink</code> or the <code>commandButton</code> component is activated.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-the-standard-validators"><a class="anchor" href="#using-the-standard-validators"></a>Using the Standard Validators</h3>
<div class="paragraph">
<p>Jakarta Faces technology provides a set of standard classes and associated tags that page authors and application developers can use to validate a component&#8217;s data.
<a href="#the-validator-classes">Table 11-6</a> lists all the standard validator classes and the tags that allow you to use the validators from the page.</p>
</div>
<table id="the-validator-classes" class="tableblock frame-all grid-all" style="width: 99%;">
<caption class="title">Table 11-6 The Validator Classes</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 66.6668%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Validator Class</th>
<th class="tableblock halign-left valign-top">Tag</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BeanValidator</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>validateBean</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Registers a bean validator for the component.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BeanValidator</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>validateWholeBean</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows cross-field validation by enabling class-level bean validation on CDI-based backing beans.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DoubleRangeValidator</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>validateDoubleRange</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Checks whether the local value of a component is within a certain range.
The value must be floating-point or convertible to floating-point.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LengthValidator</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>validateLength</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Checks whether the length of a component&#8217;s local value is within a certain range.
The value must be a <code>java.lang.String</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LongRangeValidator</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>validateLongRange</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Checks whether the local value of a component is within a certain range.
The value must be any numeric type or <code>String</code> that can be converted to a <code>long</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RegexValidator</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>validateRegex</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Checks whether the local value of a component is a match against a regular expression from the <code>java.util.regex</code> package.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RequiredValidator</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>validateRequired</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ensures that the local value is not empty on an <code>EditableValueHolder</code> component.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>All of these validator classes implement the <code>Validator</code> interface.
Component writers and application developers can also implement this interface to define their own set of constraints for a component&#8217;s value.</p>
</div>
<div class="paragraph">
<p>Similar to the standard converters, each of these validators has one or more standard error messages associated with it.
If you have registered one of these validators onto a component on your page and the validator is unable to validate the component&#8217;s value, the validator&#8217;s error message will display on the page.
For example, the error message that displays when the component&#8217;s value exceeds the maximum value allowed by <code>LongRangeValidator</code> is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">{<span class="integer">1</span>}: Validation <span class="exception">Error</span>: Value is greater than allowable maximum of <span class="string"><span class="delimiter">&quot;</span><span class="content">{0}</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, the <code>{1}</code> substitution parameter is replaced by the component&#8217;s label or <code>id</code>, and the <code>{0}</code> substitution parameter is replaced with the maximum value allowed by the validator.</p>
</div>
<div class="paragraph">
<p>See <a href="#displaying-error-messages-with-the-hmessage-and-hmessages-tags">Displaying Error Messages with the h:message and h:messages Tags</a> for information on how to display validation error messages on the page when validation fails.</p>
</div>
<div class="paragraph">
<p>Instead of using the standard validators, you can use Bean Validation to validate data.
If you specify bean validation constraints on your managed bean properties, the constraints are automatically placed on the corresponding fields on your applications web pages.
See <a href="#introduction-to-jakarta-bean-validation">Chapter 23, <em>Introduction to Jakarta Bean Validation</em></a> for more information.
You do not need to specify the <code>validateBean</code> tag to use Bean Validation, but the tag allows you to use more advanced Bean Validation features.
For example, you can use the <code>validationGroups</code> attribute of the tag to specify constraint groups.</p>
</div>
<div class="paragraph">
<p>You can also create and register custom validators, although Bean Validation has made this feature less useful.
For details, see <a href="#creating-and-using-a-custom-validator">Creating and Using a Custom Validator</a>.</p>
</div>
<div class="sect3">
<h4 id="validating-a-components-value"><a class="anchor" href="#validating-a-components-value"></a>Validating a Component&#8217;s Value</h4>
<div class="paragraph">
<p>To validate a component&#8217;s value using a particular validator, you need to register that validator on the component.
You can do this in one of the following ways.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Nest the validator&#8217;s corresponding tag (shown in <a href="#the-validator-classes">Table 11-6</a>) inside the component&#8217;s tag.
<a href="#using-validator-tags">Using Validator Tags</a> explains how to use the <code>validateLongRange</code> tag.
You can use the other standard tags in the same way.</p>
</li>
<li>
<p>Refer to a method that performs the validation from the component tag&#8217;s <code>validator</code> attribute.</p>
</li>
<li>
<p>Nest a validator tag inside the component tag, and use either the validator tag&#8217;s <code>validatorId</code> attribute or its <code>binding</code> attribute to refer to the validator.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See <a href="#referencing-a-method-that-performs-validation">Referencing a Method That Performs Validation</a> for more information on using the <code>validator</code> attribute.</p>
</div>
<div class="paragraph">
<p>The <code>validatorId</code> attribute works similarly to the <code>converterId</code> attribute of the <code>converter</code> tag, as described in <a href="#converting-a-components-value">Converting a Component&#8217;s Value</a>.</p>
</div>
<div class="paragraph">
<p>Keep in mind that validation can be performed only on components that implement <code>EditableValueHolder</code>, because these components accept values that can be validated.</p>
</div>
</div>
<div class="sect3">
<h4 id="using-validator-tags"><a class="anchor" href="#using-validator-tags"></a>Using Validator Tags</h4>
<div class="paragraph">
<p>The following example shows how to use the <code>f:validateLongRange</code> validator tag on an input component named <code>quantity</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:inputText</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">quantity</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">4</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{item.quantity}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;f:validateLongRange</span> <span class="attribute-name">minimum</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/h:inputText&gt;</span>
<span class="tag">&lt;h:message</span> <span class="attribute-name">for</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">quantity</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This tag requires the user to enter a number that is at least 1.
The <code>validateLongRange</code> tag also has a <code>maximum</code> attribute, which sets a maximum value for the input.</p>
</div>
<div class="paragraph">
<p>The attributes of all the standard validator tags accept EL value expressions.
This means that the attributes can reference managed bean properties rather than specify literal values.
For example, the <code>f:validateLongRange</code> tag in the preceding example can reference managed bean properties called <code>minimum</code> and <code>maximum</code> to get the minimum and maximum values acceptable to the validator implementation, as shown in this snippet from the <code>guessnumber-jsf</code> example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:inputText</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">userNo</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">title</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Type a number from 0 to 10:</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{userNumberBean.userNumber}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;f:validateLongRange</span> <span class="attribute-name">minimum</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{userNumberBean.minimum}</span><span class="delimiter">&quot;</span></span>
                         <span class="attribute-name">maximum</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{userNumberBean.maximum}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/h:inputText&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following <code>f:validateRegex</code> tag shows how you might ensure that a password is from 4 to 10 characters long and contains at least one digit, at least one lowercase letter, and at least one uppercase letter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;f:validateRegex</span> <span class="attribute-name">pattern</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">((?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{4,10})</span><span class="delimiter">&quot;</span></span>
                 <span class="attribute-name">for</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">passwordVal</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="referencing-a-managed-bean-method"><a class="anchor" href="#referencing-a-managed-bean-method"></a>Referencing a Managed Bean Method</h3>
<div class="paragraph">
<p>A component tag has a set of attributes for referencing managed bean methods that can perform certain functions for the component associated with the tag.
These attributes are summarized in <a href="#component-tag-attributes-that-reference-managed-bean-methods">Table 11-7</a>.</p>
</div>
<table id="component-tag-attributes-that-reference-managed-bean-methods" class="tableblock frame-all grid-all" style="width: 60%;">
<caption class="title">Table 11-7 Component Tag Attributes That Reference Managed Bean Methods</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>action</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Refers to a managed bean method that performs navigation processing for the component and returns a logical outcome <code>String</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>actionListener</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Refers to a managed bean method that handles action events</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>validator</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Refers to a managed bean method that performs validation on the component&#8217;s value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>valueChangeListener</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Refers to a managed bean method that handles value-change events</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Only components that implement <code>ActionSource</code> can use the <code>action</code> and <code>actionListener</code> attributes.
Only components that implement <code>EditableValueHolder</code> can use the <code>validator</code> or <code>valueChangeListener</code> attributes.</p>
</div>
<div class="paragraph">
<p>The component tag refers to a managed bean method using a method expression as a value of one of the attributes.
The method referenced by an attribute must follow a particular signature, which is defined by the tag attribute&#8217;s definition in the <a href="https://jakarta.ee/specifications/faces/3.0/vdldoc/" target="_blank" rel="noopener">Jakarta Faces Facelets Tag Library documentation</a>.
For example, the definition of the <code>validator</code> attribute of the <code>inputText</code> tag is the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">void</span> validate(jakarta.faces.context.FacesContext,
              jakarta.faces.component.UIComponent, java.lang.Object)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following sections give examples of how to use the attributes.</p>
</div>
<div class="sect3">
<h4 id="referencing-a-method-that-performs-navigation"><a class="anchor" href="#referencing-a-method-that-performs-navigation"></a>Referencing a Method That Performs Navigation</h4>
<div class="paragraph">
<p>If your page includes a component, such as a button or a link, that causes the application to navigate to another page when the component is activated, the tag corresponding to this component must include an <code>action</code> attribute.
This attribute does one of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Specifies a logical outcome <code>String</code> that tells the application which page to access next</p>
</li>
<li>
<p>References a managed bean method that performs some processing and returns a logical outcome <code>String</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following example shows how to reference a navigation method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:commandButton</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{bundle.Submit}</span><span class="delimiter">&quot;</span></span>
                 <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{cashierBean.submit}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>See <a href="#writing-a-method-to-handle-navigation">Writing a Method to Handle Navigation</a> for information on how to write such a method.</p>
</div>
</div>
<div class="sect3">
<h4 id="referencing-a-method-that-handles-an-action-event"><a class="anchor" href="#referencing-a-method-that-handles-an-action-event"></a>Referencing a Method That Handles an Action Event</h4>
<div class="paragraph">
<p>If a component on your page generates an action event, and if that event is handled by a managed bean method, you refer to the method by using the component&#8217;s <code>actionListener</code> attribute.</p>
</div>
<div class="paragraph">
<p>The following example shows how such a method could be referenced:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:commandLink</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Duke</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bookstore</span><span class="delimiter">&quot;</span></span>
               <span class="attribute-name">actionListener</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{actionBean.chooseBookFromLink}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>actionListener</code> attribute of this component tag references the <code>chooseBookFromLink</code> method using a method expression.
The <code>chooseBookFromLink</code> method handles the event when the user clicks the link rendered by this component.
See <a href="#writing-a-method-to-handle-an-action-event">Writing a Method to Handle an Action Event</a> for information on how to write such a method.</p>
</div>
</div>
<div class="sect3">
<h4 id="referencing-a-method-that-performs-validation"><a class="anchor" href="#referencing-a-method-that-performs-validation"></a>Referencing a Method That Performs Validation</h4>
<div class="paragraph">
<p>If the input of one of the components on your page is validated by a managed bean method, refer to the method from the component&#8217;s tag by using the <code>validator</code> attribute.</p>
</div>
<div class="paragraph">
<p>The following simplified example from <a href="#the-guessnumber-cdi-cdi-example">The guessnumber-cdi CDI Example</a> shows how to reference a method that performs validation on <code>inputGuess</code>, an input component:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:inputText</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">inputGuess</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{userNumberBean.userNumber}</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">required</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">3</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">disabled</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{userNumberBean.number eq userNumberBean.userNumber ...}</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">validator</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{userNumberBean.validateNumberRange}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="tag">&lt;/h:inputText&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The managed bean method <code>validateNumberRange</code> verifies that the input value is within the valid range, which changes each time another guess is made.
See <a href="#writing-a-method-to-perform-validation">Writing a Method to Perform Validation</a> for information on how to write such a method.</p>
</div>
</div>
<div class="sect3">
<h4 id="referencing-a-method-that-handles-a-value-change-event"><a class="anchor" href="#referencing-a-method-that-handles-a-value-change-event"></a>Referencing a Method That Handles a Value-Change Event</h4>
<div class="paragraph">
<p>If you want a component on your page to generate a value-change event and you want that event to be handled by a managed bean method instead of a <code>ValueChangeListener</code> implementation, you refer to the method by using the component&#8217;s <code>valueChangeListener</code> attribute:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:inputText</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">30</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{cashierBean.name}</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">required</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">valueChangeListener</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{cashierBean.processValueChange}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/h:inputText&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>valueChangeListener</code> attribute of this component tag references the <code>processValueChange</code> method of <code>CashierBean</code> by using a method expression.
The <code>processValueChange</code> method handles the event of a user entering a name in the input field rendered by this component.</p>
</div>
<div class="paragraph">
<p><a href="#writing-a-method-to-handle-a-value-change-event">Writing a Method to Handle a Value-Change Event</a> describes how to implement a method that handles a <code>ValueChangeEvent</code>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="developing-with-jakarta-faces-technology"><a class="anchor" href="#developing-with-jakarta-faces-technology"></a>Chapter 12. Developing with Jakarta Faces Technology</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter provides an overview of managed beans and explains how to write methods and properties of managed beans that are used by a Jakarta Faces application.
This chapter also introduces the Bean Validation feature.</p>
</div>
<div class="sect2">
<h3 id="managed-beans-in-jakarta-faces-technology"><a class="anchor" href="#managed-beans-in-jakarta-faces-technology"></a>Managed Beans in Jakarta Faces Technology</h3>
<div class="paragraph">
<p>A typical Jakarta Faces application includes one or more managed beans, each of which can be associated with the components used in a particular page.
This section introduces the basic concepts of creating, configuring, and using managed beans in an application.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<a href="#using-jakarta-faces-technology-in-web-pages">Chapter 10, <em>Using Jakarta Faces Technology in Web Pages</em></a> and <a href="#using-converters-listeners-and-validators">Chapter 11, <em>Using Converters, Listeners, and Validators</em></a> show how to add components to a page and connect them to server-side objects by using component tags and core tags.
These chapters also show how to provide additional functionality to the components through converters, listeners, and validators.
Developing a Jakarta Faces application also involves the task of programming the server-side objects: managed beans, converters, event handlers, and validators.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="creating-a-managed-bean"><a class="anchor" href="#creating-a-managed-bean"></a>Creating a Managed Bean</h4>
<div class="paragraph">
<p>A managed bean is created with a constructor with no arguments, a set of properties, and a set of methods that perform functions for a component.
Each of the managed bean properties can be bound to one of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A component value</p>
</li>
<li>
<p>A component instance</p>
</li>
<li>
<p>A converter instance</p>
</li>
<li>
<p>A listener instance</p>
</li>
<li>
<p>A validator instance</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The most common functions that managed bean methods perform include the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Validating a component&#8217;s data</p>
</li>
<li>
<p>Handling an event fired by a component</p>
</li>
<li>
<p>Performing processing to determine the next page to which the application must navigate</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As with all JavaBeans components, a property consists of a private data field and a set of accessor methods, as shown by this code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">private</span> <span class="predefined-type">Integer</span> userNumber = <span class="predefined-constant">null</span>;
...
public <span class="type">void</span> setUserNumber(<span class="predefined-type">Integer</span> user_number) {
    userNumber = user_number;
}
<span class="directive">public</span> <span class="predefined-type">Integer</span> getUserNumber() {
    <span class="keyword">return</span> userNumber;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When bound to a component&#8217;s value, a bean property can be any of the basic primitive and numeric types or any Java object type for which the application has access to an appropriate converter.
For example, a property can be of type <code>java.util.Date</code> if the application has access to a converter that can convert the <code>Date</code> type to a <code>String</code> and back again.
See <a href="#writing-bean-properties">Writing Bean Properties</a> for information on which types are accepted by which component tags.</p>
</div>
<div class="paragraph">
<p>When a bean property is bound to a component instance, the property&#8217;s type must be the same as the component object.
For example, if a <code>jakarta.faces.component.UISelectBoolean</code> component is bound to the property, the property must accept and return a <code>UISelectBoolean</code> object.
Likewise, if the property is bound to a converter, validator, or listener instance, the property must be of the appropriate converter, validator, or listener type.</p>
</div>
<div class="paragraph">
<p>For more information on writing beans and their properties, see <a href="#writing-bean-properties">Writing Bean Properties</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="using-the-el-to-reference-managed-beans"><a class="anchor" href="#using-the-el-to-reference-managed-beans"></a>Using the EL to Reference Managed Beans</h4>
<div class="paragraph">
<p>To bind component values and objects to managed bean properties or to reference managed bean methods from component tags, page authors use the Expression Language syntax.
As explained in <a href="#overview-of-the-el">Overview of the EL</a>, the following are some of the features that the EL offers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Deferred evaluation of expressions</p>
</li>
<li>
<p>The ability to use a value expression to both read and write data</p>
</li>
<li>
<p>Method expressions</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Deferred evaluation of expressions is important because the Jakarta Faces lifecycle is split into several phases in which component event handling, data conversion and validation, and data propagation to external objects are all performed in an orderly fashion.
The implementation must be able to delay the evaluation of expressions until the proper phase of the lifecycle has been reached.
Therefore, the implementation&#8217;s tag attributes always use deferred-evaluation syntax, which is distinguished by the <code>#{}</code> delimiter.</p>
</div>
<div class="paragraph">
<p>To store data in external objects, almost all Jakarta Faces tag attributes use lvalue expressions, which are expressions that allow both getting and setting data on external objects.</p>
</div>
<div class="paragraph">
<p>Finally, some component tag attributes accept method expressions that reference methods that handle component events or validate or convert component data.</p>
</div>
<div class="paragraph">
<p>To illustrate a Jakarta Faces tag using the EL, the following tag references a method that validates user input:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:inputText</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">inputGuess</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{userNumberBean.userNumber}</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">required</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">3</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">disabled</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{userNumberBean.number eq userNumberBean.userNumber ...}</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">validator</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{userNumberBean.validateNumberRange}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="tag">&lt;/h:inputText&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This tag binds the <code>inputGuess</code> component&#8217;s value to the <code>UserNumberBean.userNumber</code> managed bean property by using an lvalue expression.
The tag uses a method expression to refer to the <code>UserNumberBean.validateNumberRange</code> method, which performs validation of the component&#8217;s local value.
The local value is whatever the user types into the field corresponding to this tag.
This method is invoked when the expression is evaluated.</p>
</div>
<div class="paragraph">
<p>Nearly all Jakarta Faces tag attributes accept value expressions.
In addition to referencing bean properties, value expressions can reference lists, maps, arrays, implicit objects, and resource bundles.</p>
</div>
<div class="paragraph">
<p>Another use of value expressions is to bind a component instance to a managed bean property.
A page author does this by referencing the property from the <code>binding</code> attribute:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:outputLabel</span> <span class="attribute-name">for</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">fanClub</span><span class="delimiter">&quot;</span></span>
               <span class="attribute-name">rendered</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>
               <span class="attribute-name">binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{cashierBean.specialOfferText}</span><span class="delimiter">&quot;</span></span>
               <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{bundle.DukeFanClub}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/h:outputLabel&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition to using expressions with the standard component tags, you can configure your custom component properties to accept expressions by creating <code>jakarta.el.ValueExpression</code> or <code>jakarta.el.MethodExpression</code> instances for them.</p>
</div>
<div class="paragraph">
<p>For information on the EL, see <a href="#expression-language">Chapter 9, <em>Expression Language</em></a>.</p>
</div>
<div class="paragraph">
<p>For information on referencing managed bean methods from component tags, see <a href="#referencing-a-managed-bean-method">Referencing a Managed Bean Method</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="writing-bean-properties"><a class="anchor" href="#writing-bean-properties"></a>Writing Bean Properties</h3>
<div class="paragraph">
<p>As explained in <a href="#managed-beans-in-jakarta-faces-technology">Managed Beans in Jakarta Faces Technology</a>, a managed bean property can be bound to one of the following items:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A component value</p>
</li>
<li>
<p>A component instance</p>
</li>
<li>
<p>A converter implementation</p>
</li>
<li>
<p>A listener implementation</p>
</li>
<li>
<p>A validator implementation</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These properties follow the conventions of JavaBeans components (also called beans).
For more information on JavaBeans components, see the JavaBeans Tutorial at <a href="https://docs.oracle.com/javase/tutorial/javabeans/index.html" class="bare" target="_blank" rel="noopener">https://docs.oracle.com/javase/tutorial/javabeans/index.html</a>.</p>
</div>
<div class="paragraph">
<p>The component&#8217;s tag binds the component&#8217;s value to a managed bean property by using its <code>value</code> attribute and binds the component&#8217;s instance to a managed bean property by using its <code>binding</code> attribute.
Likewise, all the converter, listener, and validator tags use their <code>binding</code> attributes to bind their associated implementations to managed bean properties.
See <a href="#binding-component-values-and-instances-to-managed-bean-properties">Binding Component Values and Instances to Managed Bean Properties</a> and <a href="#binding-converters-listeners-and-validators-to-managed-bean-properties">Binding Converters, Listeners, and Validators to Managed Bean Properties</a> for more information.</p>
</div>
<div class="paragraph">
<p>To bind a component&#8217;s value to a managed bean property, the type of the property must match the type of the component&#8217;s value to which it is bound.
For example, if a managed bean property is bound to a <code>UISelectBoolean</code> component&#8217;s value, the property should accept and return a <code>boolean</code> value or a <code>Boolean</code> wrapper <code>Object</code> instance.</p>
</div>
<div class="paragraph">
<p>To bind a component instance to a managed bean property, the property must match the type of component.
For example, if a managed bean property is bound to a <code>UISelectBoolean</code> instance, the property should accept and return a <code>UISelectBoolean</code> value.</p>
</div>
<div class="paragraph">
<p>Similarly, to bind a converter, listener, or validator implementation to a managed bean property, the property must accept and return the same type of converter, listener, or validator object.
For example, if you are using the <code>convertDateTime</code> tag to bind a <code>jakarta.faces.convert.DateTimeConverter</code> to a property, that property must accept and return a <code>DateTimeConverter</code> instance.</p>
</div>
<div class="paragraph">
<p>The rest of this section explains how to write properties that can be bound to component values, to component instances for the component objects described in <a href="#adding-components-to-a-page-using-html-tag-library-tags">Adding Components to a Page Using HTML Tag Library Tags</a>, and to converter, listener, and validator implementations.</p>
</div>
<div class="sect3">
<h4 id="writing-properties-bound-to-component-values"><a class="anchor" href="#writing-properties-bound-to-component-values"></a>Writing Properties Bound to Component Values</h4>
<div class="paragraph">
<p>To write a managed bean property that is bound to a component&#8217;s value, you must match the property type to the component&#8217;s value.</p>
</div>
<div class="paragraph">
<p><a href="#acceptable-types-of-component-values">Table 12-1</a> lists the <code>jakarta.faces.component</code> classes and the acceptable types of their values.</p>
</div>
<table id="acceptable-types-of-component-values" class="tableblock frame-all grid-all" style="width: 99%;">
<caption class="title">Table 12-1 Acceptable Types of Component Values</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Component Class</th>
<th class="tableblock halign-left valign-top">Acceptable Types of Component Values</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>UIInput</code>, <code>UIOutput</code>, <code>UISelectItem</code>, <code>UISelectOne</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any of the basic primitive and numeric types or any Java programming language object type for which an appropriate <code>jakarta.faces.convert.Converter</code> implementation is available</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>UIData</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>array</code> of beans, <code>List</code> of beans, single bean, <code>java.sql.ResultSet</code>, <code>jakarta.servlet.jsp.jstl.sql.Result</code>, <code>javax.sql.RowSet</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>UISelectBoolean</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boolean</code> or <code>Boolean</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>UISelectItems</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.lang.String</code>, <code>Collection</code>, <code>Array</code>, <code>Map</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>UISelectMany</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>array</code> or <code>List</code>, although elements of the <code>array</code> or <code>List</code> can be any of the standard types</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>When they bind components to properties by using the <code>value</code> attributes of the component tags, page authors need to ensure that the corresponding properties match the types of the components' values.</p>
</div>
<div class="sect4">
<h5 id="uiinput-and-uioutput-properties"><a class="anchor" href="#uiinput-and-uioutput-properties"></a>UIInput and UIOutput Properties</h5>
<div class="paragraph">
<p>The <code>UIInput</code> and <code>UIOutput</code> component classes are represented by the component tags that begin with <code>h:input</code> and <code>h:output</code>, respectively (for example, <code>h:inputText</code> and <code>h:outputText</code>).</p>
</div>
<div class="paragraph">
<p>In the following example, an <code>h:inputText</code> tag binds the <code>name</code> component to the <code>name</code> property of a managed bean called <code>CashierBean</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:inputText</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">30</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{cashierBean.name}</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">...</span><span class="tag">&gt;</span>
<span class="tag">&lt;/h:inputText&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following code snippet from the managed bean <code>CashierBean</code> shows the bean property type bound by the preceding component tag:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">protected</span> <span class="predefined-type">String</span> name = <span class="predefined-constant">null</span>;

<span class="directive">public</span> <span class="type">void</span> setName(<span class="predefined-type">String</span> name) {
    <span class="local-variable">this</span>.name = name;
}
<span class="directive">public</span> <span class="predefined-type">String</span> getName() {
    <span class="keyword">return</span> <span class="local-variable">this</span>.name;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As described in <a href="#using-the-standard-converters">Using the Standard Converters</a>, to convert the value of an input or output component you can either apply a converter or create the bean property bound to the component with the matching type.
Here is the example tag, from <a href="#using-datetimeconverter">Using DateTimeConverter</a>, that displays the date on which items will be shipped.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:outputText</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{cashierBean.shipDate}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;f:convertDateTime</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">date</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">dateStyle</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">full</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/h:outputText&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The bean property represented by this tag must have a type of <code>java.util.Date</code>.
The following code snippet shows the <code>shipDate</code> property, from the managed bean <code>CashierBean</code>, that is bound by the tag&#8217;s value in the preceding example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">private</span> <span class="predefined-type">Date</span> shipDate;

<span class="directive">public</span> <span class="predefined-type">Date</span> getShipDate() {
    <span class="keyword">return</span> <span class="local-variable">this</span>.shipDate;
}
<span class="directive">public</span> <span class="type">void</span> setShipDate(<span class="predefined-type">Date</span> shipDate) {
    <span class="local-variable">this</span>.shipDate = shipDate;
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="uidata-properties"><a class="anchor" href="#uidata-properties"></a>UIData Properties</h5>
<div class="paragraph">
<p>The <code>UIData</code> component class is represented by the <code>h:dataTable</code> component tag.</p>
</div>
<div class="paragraph">
<p><code>UIData</code> components must be bound to one of the managed bean property types listed in <a href="#acceptable-types-of-component-values">Table 12-1</a>.
Data components are discussed in <a href="#using-data-bound-table-components">Using Data-Bound Table Components</a>.
Here is part of the start tag of <code>dataTable</code> from that section:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:dataTable</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">items</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">...</span>
    <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{cart.items}</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">...</span>
    <span class="attribute-name">var</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">item</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The value expression points to the <code>items</code> property of a shopping cart bean named <code>cart</code>.
The <code>cart</code> bean maintains a map of <code>ShoppingCartItem</code> beans.</p>
</div>
<div class="paragraph">
<p>The <code>getItems</code> method from the <code>cart</code> bean populates a <code>List</code> with <code>ShoppingCartItem</code> instances that are saved in the <code>items</code> map when the customer adds books to the cart, as shown in the following code segment:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">synchronized</span> <span class="predefined-type">List</span>&lt;ShoppingCartItem&gt; getItems() {
    <span class="predefined-type">List</span>&lt;ShoppingCartItem&gt; results = <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;ShoppingCartItem&gt;();
    results.addAll(<span class="local-variable">this</span>.items.values());
    <span class="keyword">return</span> results;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>All the components contained in the <code>UIData</code> component are bound to the properties of the <code>cart</code> bean that is bound to the entire <code>UIData</code> component.
For example, here is the <code>h:outputText</code> tag that displays the book title in the table:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:commandLink</span> <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{showcart.details}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;h:outputText</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{item.item.title}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/h:commandLink&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The title is actually a link to the <code>bookdetails.xhtml</code> page.
The <code>h:outputText</code> tag uses the value expression <code>#{item.item.title}</code> to bind its <code>UIOutput</code> component to the <code>title</code> property of the <code>Book</code> entity.
The first item in the expression is the <code>ShoppingCartItem</code> instance that the <code>h:dataTable</code> tag is referencing while rendering the current row.
The second item in expression refers to the <code>item</code> property of <code>ShoppingCartItem</code>, which returns an <code>Object</code> (in this case, a <code>Book</code>).
The <code>title</code> part of the expression refers to the <code>title</code> property of <code>Book</code>.
The value of the <code>UIOutput</code> component corresponding to this tag is bound to the <code>title</code> property of the <code>Book</code> entity:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">private</span> <span class="predefined-type">String</span> title;
...
public <span class="predefined-type">String</span> getTitle() {
    <span class="keyword">return</span> title;
}

<span class="directive">public</span> <span class="type">void</span> setTitle(<span class="predefined-type">String</span> title) {
    <span class="local-variable">this</span>.title = title;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The UIData component (and UIRepeat) supports the <code>Map</code> and <code>Iterable</code> interfaces, as well as custom types.</p>
</div>
<div class="paragraph">
<p>For UIData and UIRepeat, the supported types are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>null</code> (becomes empty list)</p>
</li>
<li>
<p><code>jakarta.faces.model.DataMode</code></p>
</li>
<li>
<p><code>java.util.List</code></p>
</li>
<li>
<p><code>java.lang.Object</code>[]</p>
</li>
<li>
<p><code>java.sql.ResultSet</code></p>
</li>
<li>
<p><code>jakarta.servlet.jsp.jstl.sql.Result</code></p>
</li>
<li>
<p><code>java.util.Collection</code></p>
</li>
<li>
<p><code>java.lang.Iterable</code></p>
</li>
<li>
<p><code>java.util.Map</code></p>
</li>
<li>
<p><code>java.lang.Object</code> (becomes ScalarDataModel)</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="uiselectboolean-properties"><a class="anchor" href="#uiselectboolean-properties"></a>UISelectBoolean Properties</h5>
<div class="paragraph">
<p>The <code>UISelectBoolean</code> component class is represented by the component tag <code>h:selectBooleanCheckbox</code>.</p>
</div>
<div class="paragraph">
<p>Managed bean properties that hold a <code>UISelectBoolean</code> component&#8217;s data must be of <code>boolean</code> or <code>Boolean</code> type.
The example <code>selectBooleanCheckbox</code> tag from the section <a href="#displaying-components-for-selecting-one-value">Displaying Components for Selecting One Value</a> binds a component to a property.
The following example shows a tag that binds a component value to a <code>boolean</code> property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:selectBooleanCheckbox</span> <span class="attribute-name">title</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{bundle.receiveEmails}</span><span class="delimiter">&quot;</span></span>
                         <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{custFormBean.receiveEmails}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="tag">&lt;/h:selectBooleanCheckbox&gt;</span>
<span class="tag">&lt;h:outputText</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{bundle.receiveEmails}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is an example property that can be bound to the component represented by the example tag:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">private</span> <span class="type">boolean</span> receiveEmails = <span class="predefined-constant">false</span>;
...
public <span class="type">void</span> setReceiveEmails(<span class="type">boolean</span> receiveEmails) {
    <span class="local-variable">this</span>.receiveEmails = receiveEmails;
}
<span class="directive">public</span> <span class="type">boolean</span> getReceiveEmails() {
    <span class="keyword">return</span> receiveEmails;
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="uiselectmany-properties"><a class="anchor" href="#uiselectmany-properties"></a>UISelectMany Properties</h5>
<div class="paragraph">
<p>The <code>UISelectMany</code> component class is represented by the component tags that begin with <code>h:selectMany</code> (for example, <code>h:selectManyCheckbox</code> and <code>h:selectManyListbox</code>).</p>
</div>
<div class="paragraph">
<p>Because a <code>UISelectMany</code> component allows a user to select one or more items from a list of items, this component must map to a bean property of type <code>List</code> or <code>array</code>.
This bean property represents the set of currently selected items from the list of available items.</p>
</div>
<div class="paragraph">
<p>The following example of the <code>selectManyCheckbox</code> tag comes from <a href="#displaying-components-for-selecting-multiple-values">Displaying Components for Selecting Multiple Values</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:selectManyCheckbox</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">newslettercheckbox</span><span class="delimiter">&quot;</span></span>
                      <span class="attribute-name">layout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pageDirection</span><span class="delimiter">&quot;</span></span>
                      <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{cashierBean.newsletters}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;f:selectItems</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{cashierBean.newsletterItems}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/h:selectManyCheckbox&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is the bean property that maps to the <code>value</code> of the <code>selectManyCheckbox</code> tag from the preceding example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">private</span> <span class="predefined-type">String</span><span class="type">[]</span> newsletters;

<span class="directive">public</span> <span class="type">void</span> setNewsletters(<span class="predefined-type">String</span><span class="type">[]</span> newsletters) {
    <span class="local-variable">this</span>.newsletters = newsletters;
}
<span class="directive">public</span> <span class="predefined-type">String</span><span class="type">[]</span> getNewsletters() {
    <span class="keyword">return</span> <span class="local-variable">this</span>.newsletters;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>UISelectItem</code> and <code>UISelectItems</code> components are used to represent all the values in a <code>UISelectMany</code> component.
See <a href="#uiselectitems-properties">UISelectItems Properties</a> for information on writing the bean properties for the <code>UISelectItem</code> and <code>UISelectItems</code> components.</p>
</div>
</div>
<div class="sect4">
<h5 id="uiselectone-properties"><a class="anchor" href="#uiselectone-properties"></a>UISelectOne Properties</h5>
<div class="paragraph">
<p>The <code>UISelectOne</code> component class is represented by the component tags that begin with <code>h:selectOne</code> (for example, <code>h:selectOneRadio</code> and <code>h:selectOneListbox</code>).</p>
</div>
<div class="paragraph">
<p><code>UISelectOne</code> properties accept the same types as <code>UIInput</code> and <code>UIOutput</code> properties, because a <code>UISelectOne</code> component represents the single selected item from a set of items.
This item can be any of the primitive types and anything else for which you can apply a converter.</p>
</div>
<div class="paragraph">
<p>Here is an example of the <code>h:selectOneMenu</code> tag from <a href="#displaying-a-menu-using-the-hselectonemenu-tag">Displaying a Menu Using the h:selectOneMenu Tag</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:selectOneMenu</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">shippingOption</span><span class="delimiter">&quot;</span></span>
                 <span class="attribute-name">required</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
                 <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{cashierBean.shippingOption}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;f:selectItem</span> <span class="attribute-name">itemValue</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span>
                  <span class="attribute-name">itemLabel</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{bundle.QuickShip}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;f:selectItem</span> <span class="attribute-name">itemValue</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">5</span><span class="delimiter">&quot;</span></span>
                  <span class="attribute-name">itemLabel</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{bundle.NormalShip}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;f:selectItem</span> <span class="attribute-name">itemValue</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">7</span><span class="delimiter">&quot;</span></span>
                  <span class="attribute-name">itemLabel</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{bundle.SaverShip}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
 <span class="tag">&lt;/h:selectOneMenu&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is the bean property corresponding to this tag:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">private</span> <span class="predefined-type">String</span> shippingOption = <span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span>;

<span class="directive">public</span> <span class="type">void</span> setShippingOption(<span class="predefined-type">String</span> shippingOption) {
    <span class="local-variable">this</span>.shippingOption = shippingOption;
}
<span class="directive">public</span> <span class="predefined-type">String</span> getShippingOption() {
    <span class="keyword">return</span> <span class="local-variable">this</span>.shippingOption;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that <code>shippingOption</code> represents the currently selected item from the list of items in the <code>UISelectOne</code> component.</p>
</div>
<div class="paragraph">
<p>The <code>UISelectItem</code> and <code>UISelectItems</code> components are used to represent all the values in a <code>UISelectOne</code> component.
This is explained in <a href="#displaying-a-menu-using-the-hselectonemenu-tag">Displaying a Menu Using the h:selectOneMenu Tag</a>.</p>
</div>
<div class="paragraph">
<p>For information on how to write the managed bean properties for the <code>UISelectItem</code> and <code>UISelectItems</code> components, see <a href="#uiselectitems-properties">UISelectItems Properties</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="uiselectitem-properties"><a class="anchor" href="#uiselectitem-properties"></a>UISelectItem Properties</h5>
<div class="paragraph">
<p>A <code>UISelectItem</code> component represents a single value in a set of values in a <code>UISelectMany</code> or a <code>UISelectOne</code> component.
A <code>UISelectItem</code> component must be bound to a managed bean property of type <code>jakarta.faces.model.SelectItem</code>.
A <code>SelectItem</code> object is composed of an <code>Object</code> representing the value along with two <code>Strings</code> representing the label and the description of the <code>UISelectItem</code> object.</p>
</div>
<div class="paragraph">
<p>The example <code>selectOneMenu</code> tag from <a href="#uiselectone-properties">UISelectOne Properties</a> contains <code>selectItem</code> tags that set the values of the list of items in the page.
Here is an example of a bean property that can set the values for this list in the bean:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">SelectItem itemOne = <span class="predefined-constant">null</span>;

SelectItem getItemOne(){
    <span class="keyword">return</span> itemOne;
}
<span class="type">void</span> setItemOne(SelectItem item) {
    itemOne = item;
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="uiselectitems-properties"><a class="anchor" href="#uiselectitems-properties"></a>UISelectItems Properties</h5>
<div class="paragraph">
<p><code>UISelectItems</code> components are children of <code>UISelectMany</code> and <code>UISelectOne</code> components.
Each <code>UISelectItems</code> component is composed of a set of either <code>UISelectItem</code> instances or any collection of objects, such as an array, a list, or even POJOs.</p>
</div>
<div class="paragraph">
<p>The following code snippet from <code>CashierBean</code> shows how to write the properties for <code>selectItems</code> tags containing <code>SelectItem</code> instances.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">private</span> <span class="predefined-type">String</span><span class="type">[]</span> newsletters;
<span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> SelectItem<span class="type">[]</span> newsletterItems = {
    <span class="keyword">new</span> SelectItem(<span class="string"><span class="delimiter">&quot;</span><span class="content">Duke's Quarterly</span><span class="delimiter">&quot;</span></span>),
    <span class="keyword">new</span> SelectItem(<span class="string"><span class="delimiter">&quot;</span><span class="content">Innovator's Almanac</span><span class="delimiter">&quot;</span></span>),
    <span class="keyword">new</span> SelectItem(<span class="string"><span class="delimiter">&quot;</span><span class="content">Duke's Diet and Exercise Journal</span><span class="delimiter">&quot;</span></span>),
    <span class="keyword">new</span> SelectItem(<span class="string"><span class="delimiter">&quot;</span><span class="content">Random Ramblings</span><span class="delimiter">&quot;</span></span>)
};
...
public <span class="type">void</span> setNewsletters(<span class="predefined-type">String</span><span class="type">[]</span> newsletters) {
    <span class="local-variable">this</span>.newsletters = newsletters;
}

<span class="directive">public</span> <span class="predefined-type">String</span><span class="type">[]</span> getNewsletters() {
    <span class="keyword">return</span> <span class="local-variable">this</span>.newsletters;
}

<span class="directive">public</span> SelectItem<span class="type">[]</span> getNewsletterItems() {
    <span class="keyword">return</span> newsletterItems;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, the <code>newsletters</code> property represents the <code>SelectItems</code> object, whereas the <code>newsletterItems</code> property represents a static array of <code>SelectItem</code> objects.
The <code>SelectItem</code> class has several constructors; in this example, the first argument is an <code>Object</code> representing the value of the item, whereas the second argument is a <code>String</code> representing the label that appears in the <code>UISelectMany</code> component on the page.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="writing-properties-bound-to-component-instances"><a class="anchor" href="#writing-properties-bound-to-component-instances"></a>Writing Properties Bound to Component Instances</h4>
<div class="paragraph">
<p>A property bound to a component instance returns and accepts a component instance rather than a component value.
The following components bind a component instance to a managed bean property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:selectBooleanCheckbox</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">fanClub</span><span class="delimiter">&quot;</span></span>
                         <span class="attribute-name">rendered</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>
                         <span class="attribute-name">binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{cashierBean.specialOffer}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;h:outputLabel</span> <span class="attribute-name">for</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">fanClub</span><span class="delimiter">&quot;</span></span>
               <span class="attribute-name">rendered</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>
               <span class="attribute-name">binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{cashierBean.specialOfferText}</span><span class="delimiter">&quot;</span></span>
               <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{bundle.DukeFanClub}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/h:outputLabel&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>selectBooleanCheckbox</code> tag renders a check box and binds the <code>fanClub</code> <code>UISelectBoolean</code> component to the <code>specialOffer</code> property of <code>CashierBean</code>.
The <code>outputLabel</code> tag binds the value of the <code>value</code> attribute, which represents the check box&#8217;s label, to the <code>specialOfferText</code> property of <code>CashierBean</code>.
If the user orders more than $100 worth of books and clicks the Submit button, the <code>submit</code> method of <code>CashierBean</code> sets both components' <code>rendered</code> properties to <code>true</code>, causing the check box and label to display when the page is re-rendered.</p>
</div>
<div class="paragraph">
<p>Because the components corresponding to the example tags are bound to the managed bean properties, these properties must match the components' types.
This means that the <code>specialOfferText</code> property must be of type <code>UIOutput</code>, and the <code>specialOffer</code> property must be of type <code>UISelectBoolean</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">UIOutput specialOfferText = <span class="predefined-constant">null</span>;
UISelectBoolean specialOffer = <span class="predefined-constant">null</span>;

<span class="directive">public</span> UIOutput getSpecialOfferText() {
    <span class="keyword">return</span> <span class="local-variable">this</span>.specialOfferText;
}
<span class="directive">public</span> <span class="type">void</span> setSpecialOfferText(UIOutput specialOfferText) {
    <span class="local-variable">this</span>.specialOfferText = specialOfferText;
}

<span class="directive">public</span> UISelectBoolean getSpecialOffer() {
    <span class="keyword">return</span> <span class="local-variable">this</span>.specialOffer;
}
<span class="directive">public</span> <span class="type">void</span> setSpecialOffer(UISelectBoolean specialOffer) {
    <span class="local-variable">this</span>.specialOffer = specialOffer;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more general information on component binding, see <a href="#managed-beans-in-jakarta-faces-technology">Managed Beans in Jakarta Faces Technology</a>.</p>
</div>
<div class="paragraph">
<p>For information on how to reference a managed bean method that performs navigation when a button is clicked, see <a href="#referencing-a-method-that-performs-navigation">Referencing a Method That Performs Navigation</a>.</p>
</div>
<div class="paragraph">
<p>For more information on writing managed bean methods that handle navigation, see <a href="#writing-a-method-to-handle-navigation">Writing a Method to Handle Navigation</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="writing-properties-bound-to-converters-listeners-or-validators"><a class="anchor" href="#writing-properties-bound-to-converters-listeners-or-validators"></a>Writing Properties Bound to Converters, Listeners, or Validators</h4>
<div class="paragraph">
<p>All the standard converter, listener, and validator tags included with Jakarta Faces technology support binding attributes that allow you to bind converter, listener, or validator implementations to managed bean properties.</p>
</div>
<div class="paragraph">
<p>The following example shows a standard <code>convertDateTime</code> tag using a value expression with its <code>binding</code> attribute to bind the <code>jakarta.faces.convert.DateTimeConverter</code> instance to the <code>convertDate</code> property of <code>LoginBean</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:inputText</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{loginBean.birthDate}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;f:convertDateTime</span> <span class="attribute-name">binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{loginBean.convertDate}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/h:inputText&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>convertDate</code> property must therefore accept and return a <code>DateTimeConverter</code> object, as shown here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">private</span> DateTimeConverter convertDate;
<span class="directive">public</span> DateTimeConverter getConvertDate() {
       ...
    return convertDate;
}
<span class="directive">public</span> <span class="type">void</span> setConvertDate(DateTimeConverter convertDate) {
    convertDate.setPattern(<span class="string"><span class="delimiter">&quot;</span><span class="content">EEEEEEEE, MMM dd, yyyy</span><span class="delimiter">&quot;</span></span>);
    <span class="local-variable">this</span>.convertDate = convertDate;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Because the converter is bound to a managed bean property, the managed bean property can modify the attributes of the converter or add new functionality to it.
In the case of the preceding example, the property sets the date pattern that the converter uses to parse the user&#8217;s input into a <code>Date</code> object.</p>
</div>
<div class="paragraph">
<p>The managed bean properties that are bound to validator or listener implementations are written in the same way and have the same general purpose.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="writing-managed-bean-methods"><a class="anchor" href="#writing-managed-bean-methods"></a>Writing Managed Bean Methods</h3>
<div class="paragraph">
<p>Methods of a managed bean can perform several application-specific functions for components on the page.
These functions include</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Performing processing associated with navigation</p>
</li>
<li>
<p>Handling action events</p>
</li>
<li>
<p>Performing validation on the component&#8217;s value</p>
</li>
<li>
<p>Handling value-change events</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="why-use-managed-beans"><a class="anchor" href="#why-use-managed-beans"></a>Why Use Managed Beans</h4>
<div class="paragraph">
<p>By using a managed bean to perform these functions, you eliminate the need to implement the <code>jakarta.faces.validator.Validator</code> interface to handle the validation or one of the listener interfaces to handle events.
Also, by using a managed bean instead of a <code>Validator</code> implementation to perform validation, you eliminate the need to create a custom tag for the <code>Validator</code> implementation.</p>
</div>
<div class="paragraph">
<p>In general, it is good practice to include these methods in the same managed bean that defines the properties for the components referencing these methods.
The reason for doing so is that the methods might need to access the component&#8217;s data to determine how to handle the event or to perform the validation associated with the component.</p>
</div>
<div class="paragraph">
<p>The following sections explain how to write various types of managed bean methods.</p>
</div>
</div>
<div class="sect3">
<h4 id="writing-a-method-to-handle-navigation"><a class="anchor" href="#writing-a-method-to-handle-navigation"></a>Writing a Method to Handle Navigation</h4>
<div class="paragraph">
<p>An action method, a managed bean method that handles navigation processing, must be a public method that takes no parameters and returns an <code>Object</code>, which is the logical outcome that the navigation system uses to determine the page to display next.
This method is referenced using the component tag&#8217;s <code>action</code> attribute.</p>
</div>
<div class="paragraph">
<p>The following action method is from the managed bean <code>CashierBean</code>, which is invoked when a user clicks the Submit button on the page.
If the user has ordered more than $100 worth of books, this method sets the <code>rendered</code> properties of the <code>fanClub</code> and <code>specialOffer</code> components to <code>true</code>, causing them to be displayed on the page the next time that page is rendered.</p>
</div>
<div class="paragraph">
<p>After setting the components' <code>rendered</code> properties to <code>true</code>, this method returns the logical outcome <code>null</code>.
This causes the Jakarta Faces implementation to re-render the page without creating a new view of the page, retaining the customer&#8217;s input.
If this method were to return <code>purchase</code>, which is the logical outcome to use to advance to a payment page, the page would re-render without retaining the customer&#8217;s input.
In this case, you want to re-render the page without clearing the data.</p>
</div>
<div class="paragraph">
<p>If the user does not purchase more than $100 worth of books or if the <code>thankYou</code> component has already been rendered, the method returns <code>bookreceipt</code>.
The Jakarta Faces implementation loads the <code>bookreceipt.xhtml</code> page after this method returns:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="predefined-type">String</span> submit() {
    ...
    if ((cart().getTotal() &gt; <span class="float">100.00</span>) &amp;&amp; !specialOffer.isRendered()) {
        specialOfferText.setRendered(<span class="predefined-constant">true</span>);
        specialOffer.setRendered(<span class="predefined-constant">true</span>);
        <span class="keyword">return</span> <span class="predefined-constant">null</span>;
    } <span class="keyword">else</span> <span class="keyword">if</span> (specialOffer.isRendered() &amp;&amp; !thankYou.isRendered()) {
        thankYou.setRendered(<span class="predefined-constant">true</span>);
        <span class="keyword">return</span> <span class="predefined-constant">null</span>;
    } <span class="keyword">else</span> {
        ...
        cart.clear();
        <span class="keyword">return</span> (<span class="string"><span class="delimiter">&quot;</span><span class="content">bookreceipt</span><span class="delimiter">&quot;</span></span>);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Typically, an action method will return a <code>String</code> outcome, as shown in the preceding example.
Alternatively, you can define an <code>Enum</code> class that encapsulates all possible outcome strings and then make an action method return an <code>enum</code> constant, which represents a particular <code>String</code> outcome defined by the <code>Enum</code> class.</p>
</div>
<div class="paragraph">
<p>The following example uses an <code>Enum</code> class to encapsulate all logical outcomes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">enum</span> Navigation  {
    main, accountHist, accountList, atm, atmAck, transferFunds,
     transferAck, error
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When it returns an outcome, an action method uses the dot notation to reference the outcome from the <code>Enum</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="predefined-type">Object</span> submit(){
    ...
    return Navigation.accountHist;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The section <a href="#referencing-a-method-that-performs-navigation">Referencing a Method That Performs Navigation</a> explains how a component tag references this method.
The section <a href="#writing-properties-bound-to-component-instances">Writing Properties Bound to Component Instances</a> explains how to write the bean properties to which the components are bound.</p>
</div>
</div>
<div class="sect3">
<h4 id="writing-a-method-to-handle-an-action-event"><a class="anchor" href="#writing-a-method-to-handle-an-action-event"></a>Writing a Method to Handle an Action Event</h4>
<div class="paragraph">
<p>A managed bean method that handles an action event must be a public method that accepts an action event and returns <code>void</code>.
This method is referenced using the component tag&#8217;s <code>actionListener</code> attribute.
Only components that implement <code>jakarta.faces.component.ActionSource</code> can refer to this method.</p>
</div>
<div class="paragraph">
<p>In the following example, a method from a managed bean named <code>ActionBean</code> processes the event of a user clicking one of the links on the page:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">void</span> chooseBookFromLink(<span class="predefined-type">ActionEvent</span> event) {
    <span class="predefined-type">String</span> current = event.getComponent().getId();
    FacesContext context = FacesContext.getCurrentInstance();
    <span class="predefined-type">String</span> bookId = books.get(current);
    context.getExternalContext().getSessionMap().put(<span class="string"><span class="delimiter">&quot;</span><span class="content">bookId</span><span class="delimiter">&quot;</span></span>, bookId);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This method gets the component that generated the event from the event object; then it gets the component&#8217;s ID, which is a code for the book.
The method matches the code against a <code>HashMap</code> object that contains the book codes and corresponding book ID values.
Finally, the method sets the book ID by using the selected value from the <code>HashMap</code> object.</p>
</div>
<div class="paragraph">
<p><a href="#referencing-a-method-that-handles-an-action-event">Referencing a Method That Handles an Action Event</a> explains how a component tag references this method.</p>
</div>
</div>
<div class="sect3">
<h4 id="writing-a-method-to-perform-validation"><a class="anchor" href="#writing-a-method-to-perform-validation"></a>Writing a Method to Perform Validation</h4>
<div class="paragraph">
<p>Instead of implementing the <code>jakarta.faces.validator.Validator</code> interface to perform validation for a component, you can include a method in a managed bean to take care of validating input for the component.
A managed bean method that performs validation must accept a <code>jakarta.faces.context.FacesContext</code>, the component whose data must be validated, and the data to be validated, just as the <code>validate</code> method of the <code>Validator</code> interface does.
A component refers to the managed bean method by using its <code>validator</code> attribute.
Only values of <code>UIInput</code> components or values of components that extend <code>UIInput</code> can be validated.</p>
</div>
<div class="paragraph">
<p>Here is an example of a managed bean method that validates user input, from <a href="#the-guessnumber-cdi-cdi-example">The guessnumber-cdi CDI Example</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">void</span> validateNumberRange(FacesContext context,
                                UIComponent toValidate,
                                <span class="predefined-type">Object</span> value) {
    <span class="keyword">if</span> (remainingGuesses &lt;= <span class="integer">0</span>) {
        ((UIInput) toValidate).setValid(<span class="predefined-constant">false</span>);
        FacesMessage message = <span class="keyword">new</span> FacesMessage(<span class="string"><span class="delimiter">&quot;</span><span class="content">No guesses left!</span><span class="delimiter">&quot;</span></span>);
        context.addMessage(toValidate.getClientId(context), message);
        <span class="keyword">return</span>;
    }

    <span class="type">int</span> input = (<span class="predefined-type">Integer</span>) value;
    <span class="keyword">if</span> (input &lt; minimum || input&gt; maximum) {
        ((UIInput) toValidate).setValid(<span class="predefined-constant">false</span>);

        FacesMessage message = <span class="keyword">new</span> FacesMessage(<span class="string"><span class="delimiter">&quot;</span><span class="content">Invalid guess</span><span class="delimiter">&quot;</span></span>);
        context.addMessage(toValidate.getClientId(context), message);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>validateNumberRange</code> method performs two different validations.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the user has run out of guesses, the method sets the <code>valid</code> property of the <code>UIInput</code> component to <code>false</code>.
Then it queues a message onto the <code>FacesContext</code> instance, associating the message with the component ID, and returns.</p>
</li>
<li>
<p>If the user has some remaining guesses, the method then retrieves the local value of the component.
If the input value is outside the allowable range, the method again sets the <code>valid</code> property of the <code>UIInput</code> component to <code>false</code>, queues a different message on the <code>FacesContext</code> instance, and returns.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See <a href="#referencing-a-method-that-performs-validation">Referencing a Method That Performs Validation</a> for information on how a component tag references this method.</p>
</div>
</div>
<div class="sect3">
<h4 id="writing-a-method-to-handle-a-value-change-event"><a class="anchor" href="#writing-a-method-to-handle-a-value-change-event"></a>Writing a Method to Handle a Value-Change Event</h4>
<div class="paragraph">
<p>A managed bean that handles a value-change event must use a public method that accepts a value-change event and returns <code>void</code>.
This method is referenced using the component&#8217;s <code>valueChangeListener</code> attribute.
This section explains how to write a managed bean method to replace the <code>jakarta.faces.event.ValueChangeListener</code> implementation.</p>
</div>
<div class="paragraph">
<p>The following example tag comes from <a href="#registering-a-value-change-listener-on-a-component">Registering a Value-Change Listener on a Component</a>, where the <code>h:inputText</code> tag with the <code>id</code> of <code>name</code> has a <code>ValueChangeListener</code> instance registered on it.
This <code>ValueChangeListener</code> instance handles the event of entering a value in the field corresponding to the component.
When the user enters a value, a value-change event is generated, and the <code>processValueChange(ValueChangeEvent)</code> method of the <code>ValueChangeListener</code> class is invoked:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:inputText</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">30</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{cashierBean.name}</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">required</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">requiredMessage</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{bundle.ReqCustomerName}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
     <span class="tag">&lt;f:valueChangeListener</span>
         <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ee.jakarta.tutorial.dukesbookstore.listeners.NameChanged</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/h:inputText&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Instead of implementing <code>ValueChangeListener</code>, you can write a managed bean method to handle this event.
To do this, you move the <code>processValueChange(ValueChangeEvent)</code> method from the <code>ValueChangeListener</code> class, called <code>NameChanged</code>, to your managed bean.</p>
</div>
<div class="paragraph">
<p>Here is the managed bean method that processes the event of entering a value in the <code>name</code> field on the page:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">void</span> processValueChange(ValueChangeEvent event)
        <span class="directive">throws</span> AbortProcessingException {
    <span class="keyword">if</span> (<span class="predefined-constant">null</span> != event.getNewValue()) {
        FacesContext.getCurrentInstance().getExternalContext().
                getSessionMap().put(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, event.getNewValue());
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To make this method handle the <code>ValueChangeEvent</code> generated by an input component, reference this method from the component tag&#8217;s <code>valueChangeListener</code> attribute.
See <a href="#referencing-a-method-that-handles-a-value-change-event">Referencing a Method That Handles a Value-Change Event</a> for more information.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using-ajax-with-jakarta-faces-technology"><a class="anchor" href="#using-ajax-with-jakarta-faces-technology"></a>Chapter 13. Using Ajax with Jakarta Faces Technology</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter describes using Ajax functionality in Jakarta Faces web applications.
Ajax is an acronym for Asynchronous JavaScript and XML, a group of web technologies that enable creation of dynamic and highly responsive web applications.
Using Ajax, web applications can retrieve content from the server without interfering with the display on the client.
In the Jakarta EE platform, Jakarta Faces technology provides built-in support for Ajax.</p>
</div>
<div class="sect2">
<h3 id="overview-of-ajax"><a class="anchor" href="#overview-of-ajax"></a>Overview of Ajax</h3>
<div class="paragraph">
<p>Early web applications were created mostly as static web pages.
When a static web page is updated by a client, the entire page has to reload to reflect the update.
In effect, every update needs a page reload to reflect the change.
Repetitive page reloads can result in excessive network access and can impact application performance.
Technologies such as Ajax were created to overcome these deficiencies.</p>
</div>
<div class="paragraph">
<p>Ajax refers to JavaScript and XML, technologies that are widely used for creating dynamic and asynchronous web content.
While Ajax is not limited to JavaScript and XML technologies, more often than not they are used together by web applications.
The focus of this tutorial is on using JavaScript based Ajax functionality in Jakarta Faces web applications.</p>
</div>
<div class="paragraph">
<p>JavaScript is a dynamic scripting language for web applications.
It allows users to add enhanced functionality to user interfaces and allows web pages to interact with clients asynchronously.
JavaScript runs mainly on the client side (as in a browser) and thereby reduces server access by clients.</p>
</div>
<div class="paragraph">
<p>When a JavaScript function sends an asynchronous request from the client to the server, the server sends back a response that is used to update the page&#8217;s Document Object Model (DOM).
This response is often in the format of an XML document.
The term Ajax refers to this interaction between the client and server.</p>
</div>
<div class="paragraph">
<p>The server response need not be in XML only; it can also be in other formats, such as JSON (see <a href="#introduction-to-json">Introduction to JSON</a> and <a href="https://www.json.org/" class="bare" target="_blank" rel="noopener">https://www.json.org/</a>).
This tutorial does not focus on the response formats.</p>
</div>
<div class="paragraph">
<p>Ajax enables asynchronous and partial updating of web applications.
Such functionality allows for highly responsive web pages that are rendered in near real time.
Ajax-based web applications can access server and process information and can also retrieve data without interfering with the display and rendering of the current web page on a client (such as a browser).</p>
</div>
<div class="paragraph">
<p>Some of the advantages of using Ajax are as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Form data validation in real time, eliminating the need to submit the form for verification</p>
</li>
<li>
<p>Enhanced functionality for web pages, such as user name and password prompts</p>
</li>
<li>
<p>Partial update of the web content, avoiding complete page reloads</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="using-ajax-functionality-with-jakarta-faces-technology"><a class="anchor" href="#using-ajax-functionality-with-jakarta-faces-technology"></a>Using Ajax Functionality with Jakarta Faces Technology</h3>
<div class="paragraph">
<p>Ajax functionality can be added to a Jakarta Faces application in one of the following ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Adding the required JavaScript code to an application</p>
</li>
<li>
<p>Using the built-in Ajax resource library</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In earlier releases of the Jakarta EE platform, Jakarta Faces applications provided Ajax functionality by adding the necessary JavaScript to the web page.
In the Jakarta EE platform, standard Ajax support is provided by a built-in JavaScript resource library.</p>
</div>
<div class="paragraph">
<p>With the support of this JavaScript resource library, Jakarta Faces standard UI components, such as buttons, labels, or text fields, can be enabled for Ajax functionality.
You can also load this resource library and use its methods directly from within the managed bean code.
The next sections of the tutorial describe the use of the built-in Ajax resource library.</p>
</div>
<div class="paragraph">
<p>In addition, because the Jakarta Faces technology component model can be extended, custom components can be created with Ajax functionality.</p>
</div>
<div class="paragraph">
<p>The tutorial examples include an Ajax version of the <code>guessnumber</code> application, <code>ajaxguessnumber</code>.
See <a href="#the-ajaxguessnumber-example-application">The ajaxguessnumber Example Application</a> for more information.</p>
</div>
<div class="paragraph">
<p>The Ajax specific <code>f:ajax</code> tag and its attributes are explained in the next sections.</p>
</div>
</div>
<div class="sect2">
<h3 id="using-ajax-with-facelets"><a class="anchor" href="#using-ajax-with-facelets"></a>Using Ajax with Facelets</h3>
<div class="paragraph">
<p>As mentioned in the previous section, Jakarta Faces technology supports Ajax by using a built-in JavaScript resource library that is provided as part of the Jakarta Faces core libraries.
This built-in Ajax resource can be used in Jakarta Faces web applications in one of the following ways.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>By using the <code>f:ajax</code> tag along with another standard component in a Facelets application.
This method adds Ajax functionality to any UI component without additional coding and configuration.</p>
</li>
<li>
<p>By using the JavaScript API method <code>jsf.ajax.request()</code> directly within the Facelets application.
This method provides direct access to Ajax methods and allows customized control of component behavior.</p>
</li>
<li>
<p>By using the <code>&lt;h:commandScript&gt;</code> component to execute arbitrary server-side methods from a view.
The component generates a JavaScript function with a given name that when invoked, in turn invokes, a given server-side method via Ajax.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="using-the-fajax-tag"><a class="anchor" href="#using-the-fajax-tag"></a>Using the f:ajax Tag</h4>
<div class="paragraph">
<p>The <code>f:ajax</code> tag is a Jakarta Faces core tag that provides Ajax functionality to any regular UI component when used in conjunction with that component.
In the following example, Ajax behavior is added to an input component by including the <code>f:ajax</code> core tag:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:inputText</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{bean.message}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;f:ajax</span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/h:inputText&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, although Ajax is enabled, the other attributes of the <code>f:ajax</code> tag are not defined.
If an event is not defined, the default action for the component is performed.
For the <code>inputText</code> component, when no <code>event</code> attribute is specified, the default event is <code>valueChange</code>.
<a href="#attributes-of-the-fajax-tag">Table 13-1</a> lists the attributes of the <code>f:ajax</code> tag and their default actions.</p>
</div>
<table id="attributes-of-the-fajax-tag" class="tableblock frame-all grid-all" style="width: 99%;">
<caption class="title">Table 13-1 Attributes of the f:ajax Tag</caption>
<colgroup>
<col style="width: 15%;">
<col style="width: 25%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>disabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jakarta.el.ValueExpression</code> that evaluates to a <code>Boolean</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <code>Boolean</code> value that identifies the tag status.
A value of <code>true</code> indicates that the Ajax behavior should not be rendered.
A value of <code>false</code> indicates that the Ajax behavior should be rendered.
The default value is <code>false</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>event</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jakarta.el.ValueExpression</code> that evaluates to a <code>String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <code>String</code> that identifies the type of event to which the Ajax action will apply.
If specified, it must be one of the events supported by the component.
If not specified, the default event (the event that triggers the Ajax request) is determined for the component.
The default event is <code>action</code> for <code>jakarta.faces.component.ActionSource</code> components and <code>valueChange</code> for <code>jakarta.faces.component.EditableValueHolder</code> components.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>execute</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jakarta.el.ValueExpression</code> that evaluates to an <code>Object</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <code>Collection</code> that identifies a list of components to be executed on the server.
If a literal is specified, it must be a space-delimited <code>String</code> of component identifiers and/or one of the keywords.
If a <code>ValueExpression</code> is specified, it must refer to a property that returns a <code>Collection</code> of <code>String</code> objects.
If not specified, the default value is <code>@this</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>immediate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jakarta.el.ValueExpression</code> that evaluates to a <code>Boolean</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <code>Boolean</code> value that indicates whether inputs are to be processed early in the lifecycle.
If <code>true</code>, behavior events generated from this behavior are broadcast during the Apply Request Values phase.
Otherwise, the events will be broadcast during the Invoke Application phase.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>listener</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jakarta.el.MethodExpression</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the listener method that is called when a <code>jakarta.faces.event.AjaxBehaviorEvent</code> has been broadcast for the listener.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>onevent</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jakarta.el.ValueExpression</code> that evaluates to a <code>String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the JavaScript function that handles UI events.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>onerror</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jakarta.el.ValueExpression</code> that evaluates to a <code>String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the JavaScript function that handles errors.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>render</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jakarta.el.ValueExpression</code> that evaluates to an <code>Object</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <code>Collection</code> that identifies a list of components to be rendered on the client.
If a literal is specified, it must be a space-delimited <code>String</code> of component identifiers and/or one of the keywords.
If a <code>ValueExpression</code> is specified, it must refer to a property that returns a <code>Collection</code> of <code>String</code> objects.
If not specified, the default value is <code>@none</code>.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The keywords listed in <a href="#execute-and-render-keywords">Table 13-2</a> can be used with the <code>execute</code> and <code>render</code> attributes of the <code>f:ajax</code> tag.</p>
</div>
<table id="execute-and-render-keywords" class="tableblock frame-all grid-all" style="width: 60%;">
<caption class="title">Table 13-2 Execute and Render Keywords</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Keyword</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@all</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All component identifiers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@form</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The form that encloses the component</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@none</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No component identifiers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@this</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The element that triggered the request</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Note that when you use the <code>f:ajax</code> tag in a Facelets page, the JavaScript resource library is loaded implicitly.
This resource library can also be loaded explicitly as described in <a href="#loading-javascript-as-a-resource">Loading JavaScript as a Resource</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sending-an-ajax-request"><a class="anchor" href="#sending-an-ajax-request"></a>Sending an Ajax Request</h3>
<div class="paragraph">
<p>To activate Ajax functionality, the web application must create an Ajax request and send it to the server.
The server then processes the request.</p>
</div>
<div class="paragraph">
<p>The application uses the attributes of the <code>f:ajax</code> tag listed in <a href="#attributes-of-the-fajax-tag">Table 13-1</a> to create the Ajax request.
The following sections explain the process of creating and sending an Ajax request using some of these attributes.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Behind the scenes, the <code>jsf.ajax.request()</code> method of the JavaScript resource library collects the data provided by the <code>f:ajax</code> tag and posts the request to the Jakarta Faces lifecycle.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="using-the-event-attribute"><a class="anchor" href="#using-the-event-attribute"></a>Using the event Attribute</h4>
<div class="paragraph">
<p>The <code>event</code> attribute defines the event that triggers the Ajax action.
Some of the possible values for this attribute are <code>click</code>, <code>keyup</code>, <code>mouseover</code>, <code>focus</code>, and <code>blur</code>.</p>
</div>
<div class="paragraph">
<p>If not specified, a default event based on the parent component will be applied.
The default event is <code>action</code> for <code>jakarta.faces.component.ActionSource</code> components, such as a <code>commandButton</code>, and <code>valueChange</code> for <code>jakarta.faces.component.EditableValueHolder</code> components, such as <code>inputText</code>.
In the following example, an Ajax tag is associated with the button component, and the event that triggers the Ajax action is a mouse click:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:commandButton</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">submit</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Submit</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;f:ajax</span> <span class="attribute-name">event</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">click</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/h:commandButton&gt;</span>
<span class="tag">&lt;h:outputText</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">result</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{userNumberBean.response}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You may have noticed that the listed events are very similar to JavaScript events.
In fact, they are based on JavaScript events, but do not have the <code>on</code> prefix.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For a command button, the default event is <code>click</code>, so you do not actually need to specify <code>event="click"</code> to obtain the desired behavior.</p>
</div>
</div>
<div class="sect3">
<h4 id="using-the-execute-attribute"><a class="anchor" href="#using-the-execute-attribute"></a>Using the execute Attribute</h4>
<div class="paragraph">
<p>The <code>execute</code> attribute defines the component or components to be executed on the server.
The component is identified by its <code>id</code> attribute.
You can specify more than one executable component.
If more than one component is to be executed, specify a space-delimited list of components.</p>
</div>
<div class="paragraph">
<p>When a component is executed, it participates in all phases of the request-processing lifecycle except the Render Response phase.</p>
</div>
<div class="paragraph">
<p>The <code>execute</code> attribute value can also be a keyword, such as <code>@all</code>, <code>@none</code>, <code>@this</code>, or <code>@form</code>.
The default value is <code>@this</code>, which refers to the component within which the <code>f:ajax</code> tag is nested.</p>
</div>
<div class="paragraph">
<p>The following code specifies that the <code>h:inputText</code> component with the <code>id</code> value of <code>userNo</code> should be executed when the button is clicked:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:inputText</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">userNo</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">title</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Type a number from 0 to 10:</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{userNumberBean.userNumber}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    ...
<span class="tag">&lt;/h:inputText&gt;</span>
<span class="tag">&lt;h:commandButton</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">submit</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Submit</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;f:ajax</span> <span class="attribute-name">event</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">click</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">execute</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">userNo</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/h:commandButton&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="using-the-immediate-attribute"><a class="anchor" href="#using-the-immediate-attribute"></a>Using the immediate Attribute</h4>
<div class="paragraph">
<p>The <code>immediate</code> attribute indicates whether user inputs are to be processed early in the application lifecycle or later.
If the attribute is set to <code>true</code>, events generated from this component are broadcast during the Apply Request Values phase.
Otherwise, the events will be broadcast during the Invoke Application phase.</p>
</div>
<div class="paragraph">
<p>If not defined, the default value of this attribute is <code>false</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="using-the-listener-attribute"><a class="anchor" href="#using-the-listener-attribute"></a>Using the listener Attribute</h4>
<div class="paragraph">
<p>The <code>listener</code> attribute refers to a method expression that is executed on the server side in response to an Ajax action on the client.
The listener&#8217;s <code>jakarta.faces.event.AjaxBehaviorListener.processAjaxBehavior</code> method is called once during the Invoke Application phase of the lifecycle.
In the following code from the <code>reservation</code> example application (see <a href="#the-reservation-example-application">The reservation Example Application</a>), a <code>listener</code> attribute is defined by an <code>f:ajax</code> tag, which refers to a method from the bean:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;f:ajax</span> <span class="attribute-name">event</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">change</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">render</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">total</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">listener</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{reservationBean.calculateTotal}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Whenever either the price or the number of tickets ordered changes, the <code>calculateTotal</code> method of <code>ReservationBean</code> recalculates the total cost of the tickets and displays it in the output component named <code>total</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="monitoring-events-on-the-client"><a class="anchor" href="#monitoring-events-on-the-client"></a>Monitoring Events on the Client</h3>
<div class="paragraph">
<p>To monitor ongoing Ajax requests, use the <code>onevent</code> attribute of the <code>f:ajax</code> tag.
The value of this attribute is the name of a JavaScript function.
Jakarta Faces calls the <code>onevent</code> function at each stage of the processing of an Ajax request: begin, complete, and success.</p>
</div>
<div class="paragraph">
<p>When calling the JavaScript function assigned to the <code>onevent</code> property, Jakarta Faces passes a data object to it.
The data object contains the properties listed in <a href="#properties-of-the-onevent-data-object">Table 13-3</a>.</p>
</div>
<table id="properties-of-the-onevent-data-object" class="tableblock frame-all grid-all" style="width: 60%;">
<caption class="title">Table 13-3 Properties of the onevent Data Object</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>responseXML</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The response to the Ajax call in XML format</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>responseText</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The response to the Ajax call in text format</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>responseCode</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The response to the Ajax call in numeric code</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>source</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The source of the current Ajax event: the DOM element</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>status</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The status of the current Ajax call: <code>begin</code>, <code>complete</code>, or <code>success</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>type</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The type of the Ajax call: <code>event</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>By using the <code>status</code> property of the data object, you can identify the current status of the Ajax request and monitor its progress.
In the following example, <code>monitormyajaxevent</code> is a JavaScript function that monitors the Ajax request sent by the event:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;f:ajax</span> <span class="attribute-name">event</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">click</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">render</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">statusmessage</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">onevent</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">monitormyajaxevent</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="handling-errors"><a class="anchor" href="#handling-errors"></a>Handling Errors</h3>
<div class="paragraph">
<p>Jakarta Faces handles Ajax errors through use of the <code>onerror</code> attribute of the <code>f:ajax</code> tag.
The value of this attribute is the name of a JavaScript function.</p>
</div>
<div class="paragraph">
<p>When there is an error in processing a Ajax request, Jakarta Faces calls the defined <code>onerror</code> JavaScript function and passes a data object to it.
The data object contains all the properties available for the <code>onevent</code> attribute and, in addition, the following properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>description</code></p>
</li>
<li>
<p><code>errorName</code></p>
</li>
<li>
<p><code>errorMessage</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>type</code> is <code>error</code>.
The <code>status</code> property of the data object contains one of the valid error values listed in <a href="#valid-error-values-for-the-data-object-status-property">Table 13-4</a>.</p>
</div>
<table id="valid-error-values-for-the-data-object-status-property" class="tableblock frame-all grid-all" style="width: 60%;">
<caption class="title">Table 13-4 Valid Error Values for the Data Object status Property</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Values</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>emptyResponse</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No Ajax response from server.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>httpError</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">One of the valid HTTP errors: <code>request.status==null</code> or <code>request.status==undefined</code> or <code>request.status&lt;200</code> or <code>request.status&gt;=300</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>malformedXML</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Ajax response is not well formed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>serverError</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Ajax response contains an <code>error</code> element.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In the following example, any errors that occurred in processing the Ajax request are handled by the <code>handlemyajaxerror</code> JavaScript function:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;f:ajax</span> <span class="attribute-name">event</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">click</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">render</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">errormessage</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">onerror</span>=<span class="string"><span class="delimiter">&quot;</span>handlemyajaxerror<span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="receiving-an-ajax-response"><a class="anchor" href="#receiving-an-ajax-response"></a>Receiving an Ajax Response</h3>
<div class="paragraph">
<p>After the application sends an Ajax request, it is processed on the server side, and a response is sent back to the client.
As described earlier, Ajax allows for partial updating of web pages.
To enable such partial updating, Jakarta Faces technology allows for partial processing of the view.
The handling of the response is defined by the <code>render</code> attribute of the <code>f:ajax</code> tag.</p>
</div>
<div class="paragraph">
<p>Similar to the <code>execute</code> attribute, the <code>render</code> attribute defines which sections of the page will be updated.
The value of a <code>render</code> attribute can be one or more component <code>id</code> values, one of the keywords <code>@this</code>, <code>@all</code>, <code>@none</code>, or <code>@form</code>, or an EL expression.
In the following example, the <code>render</code> attribute identifies an output component to be displayed when the button component is clicked (the default event for a command button):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:commandButton</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">submit</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Submit</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;f:ajax</span> <span class="attribute-name">execute</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">userNo</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">render</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">result</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/h:commandButton&gt;</span>
<span class="tag">&lt;h:outputText</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">result</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{userNumberBean.response}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Behind the scenes, once again the <code>jsf.ajax.request()</code> method handles the response.
It registers a response-handling callback when the original request is created.
When the response is sent back to the client, the callback is invoked.
This callback automatically updates the client-side DOM to reflect the rendered response.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="ajax-request-lifecycle"><a class="anchor" href="#ajax-request-lifecycle"></a>Ajax Request Lifecycle</h3>
<div class="paragraph">
<p>An Ajax request varies from other typical Jakarta Faces requests, and its processing is also handled differently by the Jakarta Faces lifecycle.</p>
</div>
<div class="paragraph">
<p>As described in <a href="#partial-processing-and-partial-rendering">Partial Processing and Partial Rendering</a>, when an Ajax request is received, the state associated with that request is captured by the <code>jakarta.faces.context.PartialViewContext</code>.
This object provides access to information such as which components are targeted for processing/rendering.
The <code>processPartial</code> method of <code>PartialViewContext</code> uses this information to perform partial component tree processing and rendering.</p>
</div>
<div class="paragraph">
<p>The <code>execute</code> attribute of the <code>f:ajax</code> tag identifies which segments of the server-side component tree should be processed.
Because components can be uniquely identified in the Jakarta Faces component tree, it is easy to identify and process a single component, a few components, or a whole tree.
This is made possible by the <code>visitTree</code> method of the <code>UIComponent</code> class.
The identified components then run through the Jakarta Faces request lifecycle phases.</p>
</div>
<div class="paragraph">
<p>Similar to the <code>execute</code> attribute, the <code>render</code> attribute identifies which segments of the Jakarta Faces component tree need to be rendered during the render response phase.</p>
</div>
<div class="paragraph">
<p>During the render response phase, the <code>render</code> attribute is examined.
The identified components are found and asked to render themselves and their children.
The components are then packaged up and sent back to the client as a response.</p>
</div>
</div>
<div class="sect2">
<h3 id="grouping-of-components"><a class="anchor" href="#grouping-of-components"></a>Grouping of Components</h3>
<div class="paragraph">
<p>The previous sections describe how to associate a single UI component with Ajax functionality.
You can also associate Ajax with more than one component at a time by grouping them together on a page.
The following example shows how a number of components can be grouped by using the <code>f:ajax</code> tag:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;f:ajax&gt;</span>
    <span class="tag">&lt;h:form&gt;</span>
        <span class="tag">&lt;h:inputText</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">input1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{user.name}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;h:commandButton</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Submit</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/h:form&gt;</span>
<span class="tag">&lt;/f:ajax&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example, neither component is associated with any Ajax <code>event</code> or <code>render</code> attributes yet.
Therefore, no action will take place in case of user input.
You can associate the above components with an <code>event</code> and a <code>render</code> attribute as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;f:ajax</span> <span class="attribute-name">event</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">click</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">render</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">@all</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;h:form&gt;</span>
        <span class="tag">&lt;h:inputText</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">input1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{user.name}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;h:commandButton</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Submit</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/h:form&gt;</span>
<span class="tag">&lt;/f:ajax&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the updated example, when the user clicks either component, the updated results will be displayed for all components.
You can further fine-tune the Ajax action by adding specific events to each of the components, in which case Ajax functionality becomes cumulative.
Consider the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;f:ajax</span> <span class="attribute-name">event</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">click</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">render</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">@all</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    ...
    <span class="tag">&lt;h:commandButton</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Submit</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;f:ajax</span> <span class="attribute-name">event</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mouseover</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/h:commandButton&gt;</span>
    ...
<span class="tag">&lt;/f:ajax&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now the button component will fire an Ajax action in case of a <code>mouseover</code> event as well as a mouse-click event.</p>
</div>
</div>
<div class="sect2">
<h3 id="loading-javascript-as-a-resource"><a class="anchor" href="#loading-javascript-as-a-resource"></a>Loading JavaScript as a Resource</h3>
<div class="paragraph">
<p>The JavaScript resource file bundled with Jakarta Faces technology is named <code>jsf.js</code> and is available in the <code>jakarta.faces</code> library.
This resource library supports Ajax functionality in Jakarta Faces applications.</p>
</div>
<div class="paragraph">
<p>If you use the <code>f:ajax</code> tag on a page, the <code>jsf.js</code> resource is automatically delivered to the client.
It is not necessary to use the <code>h:outputScript</code> tag to specify this resource.
You may want to use the <code>h:outputScript</code> tag to specify other JavaScript libraries.</p>
</div>
<div class="paragraph">
<p>To use a JavaScript resource directly with a <code>UIComponent</code>, you must explicitly load the resource as described in either of the following topics:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#using-javascript-api-in-a-facelets-application">Using JavaScript API in a Facelets Application</a>  Uses the <code>h:outputScript</code> tag directly in a Facelets page</p>
</li>
<li>
<p><a href="#using-the-resourcedependency-annotation-in-a-bean-class">Using the @ResourceDependency Annotation in a Bean Class</a>  Uses the <code>jakarta.faces.application.ResourceDependency</code> annotation on a <code>UIComponent</code> Java class</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="using-javascript-api-in-a-facelets-application"><a class="anchor" href="#using-javascript-api-in-a-facelets-application"></a>Using JavaScript API in a Facelets Application</h4>
<div class="paragraph">
<p>To use the JavaScript resource API directly in a web application, such as a Facelets page:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Identify the default JavaScript resource for the page with the help of the <code>h:outputScript</code> tag.</p>
<div class="paragraph">
<p>For example, consider the following section of a Facelets page:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:form&gt;</span>
    <span class="tag">&lt;h:outputScript</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jsf.js</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">library</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakarta.faces</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">target</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">head</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/h:form&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Specifying the target as <code>head</code> causes the script resource to be rendered within the <code>head</code> element on the HTML page.</p>
</div>
</li>
<li>
<p>Identify the component to which you would like to attach the Ajax functionality.</p>
</li>
<li>
<p>Add the Ajax functionality to the component by using the JavaScript API.
For example, consider the following:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:form&gt;</span>
    <span class="tag">&lt;h:outputScript</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jsf.js</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">library</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakarta.faces</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">target</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">head</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;h:inputText</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">inputname</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{userBean.name}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;h:outputText</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">outputname</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{userBean.name}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;h:commandButton</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">submit</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Submit</span><span class="delimiter">&quot;</span></span>
                     <span class="attribute-name">onclick</span>=<span class="string"><span class="delimiter">&quot;</span>jsf.ajax.request(<span class="local-variable">this</span>, event,
                              {<span class="key">execute</span>:<span class="string"><span class="delimiter">'</span><span class="content">inputname</span><span class="delimiter">'</span></span>,<span class="key">render</span>:<span class="string"><span class="delimiter">'</span><span class="content">outputname</span><span class="delimiter">'</span></span>});
                              <span class="keyword">return</span> <span class="predefined-constant">false</span>;<span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/h:form&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>jsf.ajax.request</code> method takes up to three parameters that specify source, event, and options.
The source parameter identifies the DOM element that triggered the Ajax request, typically <code>this</code>.
The optional event parameter identifies the DOM event that triggered this request.
The optional options parameter contains a set of name/value pairs from <a href="#possible-values-for-the-options-parameter">Table 13-5</a>.</p>
</div>
<table id="possible-values-for-the-options-parameter" class="tableblock frame-all grid-all" style="width: 70%;">
<caption class="title">Table 13-5 Possible Values for the Options Parameter</caption>
<colgroup>
<col style="width: 21.4285%;">
<col style="width: 78.5715%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>execute</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A space-delimited list of client identifiers or one of the keywords listed in <a href="#execute-and-render-keywords">Table 13-2</a>. The identifiers reference the components that will be processed during the Execute phase of the lifecycle.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>render</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A space-delimited list of client identifiers or one of the keywords listed in <a href="#execute-and-render-keywords">Table 13-2</a>. The identifiers reference the components that will be processed during the render phase of the lifecycle.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>onevent</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <code>String</code> that is the name of the JavaScript function to call when an event occurs.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>onerror</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <code>String</code> that is the name of the JavaScript function to call when an error occurs.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>params</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An object that may include additional parameters to include in the request.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If no identifier is specified, the default assumed keyword for the <code>execute</code> attribute is <code>@this</code>, and for the <code>render</code> attribute it is <code>@none</code>.</p>
</div>
<div class="paragraph">
<p>You can also place the JavaScript method in a file and include it as a resource.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="using-the-resourcedependency-annotation-in-a-bean-class"><a class="anchor" href="#using-the-resourcedependency-annotation-in-a-bean-class"></a>Using the @ResourceDependency Annotation in a Bean Class</h4>
<div class="paragraph">
<p>Use the <code>jakarta.faces.application.ResourceDependency</code> annotation to cause the bean class to load the default <code>jsf.js</code> library.</p>
</div>
<div class="paragraph">
<p>To load the Ajax resource from the server side:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Use the <code>jsf.ajax.request</code> method within the bean class.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This method is usually used when creating a custom component or a custom renderer for a component.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following example shows how the resource is loaded in a bean class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ResourceDependency</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">jsf.js</span><span class="delimiter">&quot;</span></span> library=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakarta.faces</span><span class="delimiter">&quot;</span></span> target=<span class="string"><span class="delimiter">&quot;</span><span class="content">head</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="the-ajaxguessnumber-example-application"><a class="anchor" href="#the-ajaxguessnumber-example-application"></a>The ajaxguessnumber Example Application</h3>
<div class="paragraph">
<p>To demonstrate the advantages of using Ajax, revisit the <code>guessnumber</code> example from <a href="#introduction-to-facelets">Chapter 8, <em>Introduction to Facelets</em></a>.
If you modify this example to use Ajax, the response need not be displayed on the <code>response.xhtml</code> page.
Instead, an asynchronous call is made to the bean on the server side, and the response is displayed on the originating page by executing just the input component rather than by form submission.</p>
</div>
<div class="paragraph">
<p>The source code for this application is in the <code><em>tut-install</em>/examples/web/jsf/ajaxguessnumber/</code> directory.</p>
</div>
<div class="sect3">
<h4 id="the-ajaxguessnumber-source-files"><a class="anchor" href="#the-ajaxguessnumber-source-files"></a>The ajaxguessnumber Source Files</h4>
<div class="paragraph">
<p>The changes to the <code>guessnumber</code> application occur in two source files.</p>
</div>
<div class="sect4">
<h5 id="the-ajaxgreeting-xhtml-facelets-page"><a class="anchor" href="#the-ajaxgreeting-xhtml-facelets-page"></a>The ajaxgreeting.xhtml Facelets Page</h5>
<div class="paragraph">
<p>The Facelets page for <code>ajaxguessnumber</code>, <code>ajaxgreeting.xhtml</code>, is almost the same as the <code>greeting.xhtml</code> page for the <code>guessnumber</code> application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:head&gt;</span>
    <span class="tag">&lt;h:outputStylesheet</span> <span class="attribute-name">library</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">css</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default.css</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;title&gt;</span>Ajax Guess Number Facelets Application<span class="tag">&lt;/title&gt;</span>
<span class="tag">&lt;/h:head&gt;</span>
<span class="tag">&lt;h:body&gt;</span>
    <span class="tag">&lt;h:form</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">AjaxGuess</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;h:graphicImage</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{resource['images:wave.med.gif']}</span><span class="delimiter">&quot;</span></span>
                        <span class="attribute-name">alt</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Duke waving his hand</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;h2&gt;</span>
            Hi, my name is Duke. I am thinking of a number from
            #{dukesNumberBean.minimum} to #{dukesNumberBean.maximum}.
            Can you guess it?
        <span class="tag">&lt;/h2&gt;</span>
        <span class="tag">&lt;p&gt;</span>
            <span class="tag">&lt;h:inputText</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">userNo</span><span class="delimiter">&quot;</span></span>
                         <span class="attribute-name">title</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Enter a number from 0 to 10:</span><span class="delimiter">&quot;</span></span>
                         <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{userNumberBean.userNumber}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;f:validateLongRange</span> <span class="attribute-name">minimum</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{dukesNumberBean.minimum}</span><span class="delimiter">&quot;</span></span>
                                     <span class="attribute-name">maximum</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{dukesNumberBean.maximum}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/h:inputText&gt;</span>

            <span class="tag">&lt;h:commandButton</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">submit</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Submit</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;f:ajax</span> <span class="attribute-name">execute</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">userNo</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">render</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">outputGroup</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
            <span class="tag">&lt;/h:commandButton&gt;</span>
        <span class="tag">&lt;/p&gt;</span>
        <span class="tag">&lt;p&gt;</span>
            <span class="tag">&lt;h:panelGroup</span> <span class="attribute-name">layout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">block</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">outputGroup</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;h:outputText</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">result</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">style</span>=<span class="string"><span class="delimiter">&quot;</span><span class="key">color</span>:<span class="value">blue</span><span class="delimiter">&quot;</span></span>
                              <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{userNumberBean.response}</span><span class="delimiter">&quot;</span></span>
                              <span class="attribute-name">rendered</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{!facesContext.validationFailed}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;h:message</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">errors1</span><span class="delimiter">&quot;</span></span>
                           <span class="attribute-name">showSummary</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
                           <span class="attribute-name">showDetail</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>
                           <span class="attribute-name">style</span>=<span class="string"><span class="delimiter">&quot;</span><span class="key">color</span>: <span class="color">#d20005</span>;
                           <span class="key">font-family</span>: <span class="string"><span class="delimiter">'</span><span class="content">New Century Schoolbook</span><span class="delimiter">'</span></span>, <span class="value">serif</span>;
                           <span class="key">font-style</span>: <span class="value">oblique</span>;
                           <span class="key">text-decoration</span>: <span class="value">overline</span><span class="delimiter">&quot;</span></span>
                           <span class="attribute-name">for</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">userNo</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/h:panelGroup&gt;</span>
        <span class="tag">&lt;/p&gt;</span>
    <span class="tag">&lt;/h:form&gt;</span>
<span class="tag">&lt;/h:body&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The most important change is in the <code>h:commandButton</code> tag.
The <code>action</code> attribute is removed from the tag, and an <code>f:ajax</code> tag is added.</p>
</div>
<div class="paragraph">
<p>The <code>f:ajax</code> tag specifies that when the button is clicked the <code>h:inputText</code> component with the <code>id</code> value <code>userNo</code> is executed.
The components within the <code>outputGroup</code> panel group are then rendered.
If a validation error occurs, the managed bean is not executed, and the validation error message is displayed in the message pane.
Otherwise, the result of the guess is rendered in the <code>result</code> component.</p>
</div>
</div>
<div class="sect4">
<h5 id="the-usernumberbean-backing-bean"><a class="anchor" href="#the-usernumberbean-backing-bean"></a>The UserNumberBean Backing Bean</h5>
<div class="paragraph">
<p>A small change is also made in the <code>UserNumberBean</code> code so that the output component does not display any message for the default (null) value of the property <code>response</code>.
Here is the modified bean code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="predefined-type">String</span> getResponse() {
    <span class="keyword">if</span> ((userNumber != <span class="predefined-constant">null</span>)
            &amp;&amp; (userNumber.compareTo(dukesNumberBean.getRandomInt()) == <span class="integer">0</span>)) {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Yay! You got it!</span><span class="delimiter">&quot;</span></span>;
    }
    <span class="keyword">if</span> (userNumber == <span class="predefined-constant">null</span>) {
        <span class="keyword">return</span> <span class="predefined-constant">null</span>;
    } <span class="keyword">else</span> {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Sorry, </span><span class="delimiter">&quot;</span></span> + userNumber + <span class="string"><span class="delimiter">&quot;</span><span class="content"> is incorrect.</span><span class="delimiter">&quot;</span></span>;
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="the-dukesnumberbean-cdi-managed-bean"><a class="anchor" href="#the-dukesnumberbean-cdi-managed-bean"></a>The DukesNumberBean CDI Managed Bean</h5>
<div class="paragraph">
<p>The <code>DukesNumberBean</code> session-scoped CDI managed bean stores the range of guessable numbers and the randomly chosen number from that range.
It is injected into <code>UserNumberBean</code> with the CDI <code>@Inject</code> annotation so that the value of the random number can be compared to the number the user submitted:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
DukesNumberBean dukesNumberBean;</code></pre>
</div>
</div>
<div class="paragraph">
<p>You will learn more about CDI in <a href="#introduction-to-jakarta-contexts-and-dependency-injection">Chapter 25, <em>Introduction to Jakarta Contexts and Dependency Injection</em></a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="running-the-ajaxguessnumber-example"><a class="anchor" href="#running-the-ajaxguessnumber-example"></a>Running the ajaxguessnumber Example</h4>
<div class="paragraph">
<p>You can use either NetBeans IDE or Maven to build, package, deploy, and run the <code>ajaxguessnumber</code> application.</p>
</div>
<div class="sect4">
<h5 id="to-build-package-and-deploy-the-ajaxguessnumber-example-using-netbeans-ide"><a class="anchor" href="#to-build-package-and-deploy-the-ajaxguessnumber-example-using-netbeans-ide"></a>To Build, Package, and Deploy the ajaxguessnumber Example Using NetBeans IDE</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>From the <strong>File</strong> menu, choose <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the Open Project dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/web/jsf</pre>
</div>
</div>
</li>
<li>
<p>Select the <code>ajaxguessnumber</code> folder.</p>
</li>
<li>
<p>Click <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the <strong>Projects</strong> tab, right-click the <code>ajaxguessnumber</code> project and select <strong>Build</strong>.</p>
<div class="paragraph">
<p>This command builds and deploys the project.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-build-package-and-deploy-the-ajaxguessnumber-example-using-maven"><a class="anchor" href="#to-build-package-and-deploy-the-ajaxguessnumber-example-using-maven"></a>To Build, Package, and Deploy the ajaxguessnumber Example Using Maven</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>In a terminal window, go to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/web/jsf/ajaxguessnumber/</pre>
</div>
</div>
</li>
<li>
<p>Enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">mvn install</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command builds and packages the application into a WAR file, <code>ajaxguessnumber.war</code>, located in the <code>target</code> directory.
It then deploys the application.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-run-the-ajaxguessnumber-example"><a class="anchor" href="#to-run-the-ajaxguessnumber-example"></a>To Run the ajaxguessnumber Example</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In a web browser, enter the following URL:</p>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080/ajaxguessnumber</pre>
</div>
</div>
</li>
<li>
<p>Enter a value in the field and click Submit.</p>
<div class="paragraph">
<p>If the value is in the range of 0 to 10, a message states whether the guess is correct or incorrect. If the value is outside that range or if the value is not a number, an error message appears in red.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="further-information-about-ajax-in-jakarta-faces-technology"><a class="anchor" href="#further-information-about-ajax-in-jakarta-faces-technology"></a>Further Information about Ajax in Jakarta Faces Technology</h3>
<div class="paragraph">
<p>For more information on Ajax in Jakarta Faces Technology, see</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Jakarta Faces project website:<br>
<a href="https://jakarta.ee/specifications/faces/3.0/" class="bare" target="_blank" rel="noopener">https://jakarta.ee/specifications/faces/3.0/</a></p>
</li>
<li>
<p><a href="https://jakarta.ee/specifications/faces/3.0/jsdoc/jsf.ajax.html" target="_blank" rel="noopener">Jakarta Faces JavaScript Library APIs</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="composite-components-advanced-topics-and-an-example"><a class="anchor" href="#composite-components-advanced-topics-and-an-example"></a>Chapter 14. Composite Components: Advanced Topics and an Example</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter describes the advanced features of composite components in Jakarta Faces technology.</p>
</div>
<div class="sect2">
<h3 id="attributes-of-a-composite-component"><a class="anchor" href="#attributes-of-a-composite-component"></a>Attributes of a Composite Component</h3>
<div class="paragraph">
<p>A composite component is a special type of Jakarta Faces template that acts as a component.
If you are new to composite components, see <a href="#composite-components">Composite Components</a> before you proceed with this chapter.</p>
</div>
<div class="paragraph">
<p>You define an attribute of a composite component by using the <code>composite:attribute</code> tag.
<a href="#commonly-used-attributes-of-the-compositeattribute-tag">Table 14-1</a> lists the commonly used attributes of this tag.</p>
</div>
<table id="commonly-used-attributes-of-the-compositeattribute-tag" class="tableblock frame-all grid-all" style="width: 70%;">
<caption class="title">Table 14-1 Commonly Used Attributes of the composite:attribute Tag</caption>
<colgroup>
<col style="width: 21.4285%;">
<col style="width: 78.5715%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Specifies the name of the composite component attribute to be used in the using page.
Alternatively, the <code>name</code> attribute can specify standard event handlers such as <code>action</code>, <code>actionListener</code>, and managed bean.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>default</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the default value of the composite component attribute.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>required</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies whether it is mandatory to provide a value for the attribute.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>method-signature</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Specifies a subclass of <code>java.lang.Object</code> as the type of the composite component&#8217;s attribute.
The <code>method-signature</code> element declares that the composite component attribute is a method expression.
The <code>type</code> attribute and the <code>method-signature</code> attribute are mutually exclusive. If you specify both, <code>method-signature</code> is ignored.
The default type of an attribute is <code>java.lang.Object.</code></p>
</div>
<div class="paragraph">
<p>Note: Method expressions are similar to value expressions, but rather than supporting the dynamic retrieval and setting of properties, method expressions support the invocation of a method of an arbitrary object, passing a specified set of parameters and returning the result from the called method (if any).</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>type</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Specifies a fully qualified class name as the type of the attribute. The <code>type</code> attribute and the <code>method-signature</code> attribute are mutually exclusive. If you specify both, <code>method-signature</code> is ignored. The default type of an attribute is <code>java.lang.Object.</code></p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The following code snippet defines a composite component attribute and assigns it a default value:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;composite:attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">username</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">default</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">admin</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following code snippet uses the <code>method-signature</code> element:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;composite:attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myaction</span><span class="delimiter">&quot;</span></span>
                     <span class="attribute-name">method-signature</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">java.lang.String action()</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following code snippet uses the <code>type</code> element:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;composite:attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dateofjoining</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">java.util.Date</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="invoking-a-managed-bean"><a class="anchor" href="#invoking-a-managed-bean"></a>Invoking a Managed Bean</h3>
<div class="paragraph">
<p>To enable a composite component to handle server-side data</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Invoke a managed bean in one of the following ways:</p>
<div class="ulist">
<ul>
<li>
<p>Pass the reference of the managed bean to the composite component.</p>
</li>
<li>
<p>Directly use the properties of the managed bean.</p>
<div class="paragraph">
<p>The example application described in <a href="#the-compositecomponentexample-example-application">The compositecomponentexample Example Application</a> shows how to use a managed bean with a composite component by passing the reference of the managed bean to the component.</p>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="validating-composite-component-values"><a class="anchor" href="#validating-composite-component-values"></a>Validating Composite Component Values</h3>
<div class="paragraph">
<p>Jakarta Faces provides the following tags for validating values of input components.
These tags can be used with the <code>composite:valueHolder</code> or the <code>composite:editableValueHolder</code> tag.</p>
</div>
<div class="paragraph">
<p><a href="#validator-tags">Table 14-2</a> lists commonly used validator tags.
See <a href="#using-the-standard-validators">Using the Standard Validators</a> for details and a complete list.</p>
</div>
<table id="validator-tags" class="tableblock frame-all grid-all" style="width: 70%;">
<caption class="title">Table 14-2 Validator Tags</caption>
<colgroup>
<col style="width: 21.4285%;">
<col style="width: 78.5715%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Tag Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>f:validateBean</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Delegates the validation of the local value to the Bean Validation API.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>f:validateRegex</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Uses the <code>pattern</code> attribute to validate the wrapping component.
The entire pattern is matched against the <code>String</code> value of the component.
If it matches, it is valid.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>f:validateRequired</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Enforces the presence of a value.
Has the same effect as setting the <code>required</code> element of a composite component&#8217;s attribute to <code>true</code>.</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="the-compositecomponentexample-example-application"><a class="anchor" href="#the-compositecomponentexample-example-application"></a>The compositecomponentexample Example Application</h3>
<div class="paragraph">
<p>The <code>compositecomponentexample</code> application creates a composite component that accepts a name (or any other string).
The component interacts with a managed bean that calculates whether the letters in the name, if converted to numeric values, add up to a prime number.
The component displays the sum of the letter values and reports whether it is or is not prime.</p>
</div>
<div class="paragraph">
<p>The <code>compositecomponentexample</code> application has a composite component file, a using page, and a managed bean.</p>
</div>
<div class="paragraph">
<p>The source code for this application is in the <code><em>tut-install</em>/examples/web/jsf/compositecomponentexample/</code> directory.</p>
</div>
<div class="sect3">
<h4 id="the-composite-component-file"><a class="anchor" href="#the-composite-component-file"></a>The Composite Component File</h4>
<div class="paragraph">
<p>The composite component file is an XHTML file, <code>/web/resources/ezcomp/PrimePanel.xhtml</code>.
It has a <code>composite:interface</code> section that declares the labels for the name and a command button.
It also declares a managed bean, which defines properties for the name.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;composite:interface&gt;</span>
    <span class="tag">&lt;composite:attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">namePrompt</span><span class="delimiter">&quot;</span></span>
                         <span class="attribute-name">default</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Name, word, or phrase: </span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;composite:attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">calcButtonText</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">default</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Calculate</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;composite:attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">calcAction</span><span class="delimiter">&quot;</span></span>
                         <span class="attribute-name">method-signature</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">java.lang.String action()</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;composite:attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">primeBean</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;composite:editableValueHolder</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">nameVal</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">targets</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">form:name</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/composite:interface&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The composite component implementation accepts the input value for the <code>name</code> property of the managed bean.
The <code>h:outputStylesheet</code> tag specifies the stylesheet as a relocatable resource.
The implementation then specifies the format of the output, using properties of the managed bean, as well as the format of error messages.
The sum value is rendered only after it has been calculated, and the report of whether the sum is prime or not is rendered only if the input value is validated.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;composite:implementation&gt;</span>
    <span class="tag">&lt;h:form</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">form</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;h:outputStylesheet</span> <span class="attribute-name">library</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">css</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default.css</span><span class="delimiter">&quot;</span></span>
                            <span class="attribute-name">target</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">head</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;h:panelGrid</span> <span class="attribute-name">columns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">role</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">presentation</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;h:outputLabel</span> <span class="attribute-name">for</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>
                           <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{cc.attrs.namePrompt}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;h:inputText</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>
                         <span class="attribute-name">size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">45</span><span class="delimiter">&quot;</span></span>
                         <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{cc.attrs.primeBean.name}</span><span class="delimiter">&quot;</span></span>
                         <span class="attribute-name">required</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/h:panelGrid&gt;</span>
        <span class="tag">&lt;p&gt;</span>
            <span class="tag">&lt;h:commandButton</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">calcButton</span><span class="delimiter">&quot;</span></span>
                             <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{cc.attrs.calcButtonText}</span><span class="delimiter">&quot;</span></span>
                             <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{cc.attrs.calcAction}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;f:ajax</span> <span class="attribute-name">execute</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">render</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">outputGroup</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/h:commandButton&gt;</span>
        <span class="tag">&lt;/p&gt;</span>

       <span class="tag">&lt;h:panelGroup</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">outputGroup</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">layout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">block</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;p&gt;</span>
                <span class="tag">&lt;h:outputText</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">result</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">style</span>=<span class="string"><span class="delimiter">&quot;</span><span class="key">color</span>:<span class="value">blue</span><span class="delimiter">&quot;</span></span>
                              <span class="attribute-name">rendered</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{cc.attrs.primeBean.totalSum gt 0}</span><span class="delimiter">&quot;</span></span>
                              <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Sum is #{cc.attrs.primeBean.totalSum}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
            <span class="tag">&lt;/p&gt;</span>
            <span class="tag">&lt;p&gt;</span>
                <span class="tag">&lt;h:outputText</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">response</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">style</span>=<span class="string"><span class="delimiter">&quot;</span><span class="key">color</span>:<span class="value">blue</span><span class="delimiter">&quot;</span></span>
                              <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{cc.attrs.primeBean.response}</span><span class="delimiter">&quot;</span></span>
                              <span class="attribute-name">rendered</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{!facesContext.validationFailed}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;h:message</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">errors1</span><span class="delimiter">&quot;</span></span>
                           <span class="attribute-name">showSummary</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
                           <span class="attribute-name">showDetail</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>
                           <span class="attribute-name">style</span>=<span class="string"><span class="delimiter">&quot;</span><span class="key">color</span>: <span class="color">#d20005</span>;
                           <span class="key">font-family</span>: <span class="string"><span class="delimiter">'</span><span class="content">New Century Schoolbook</span><span class="delimiter">'</span></span>, <span class="value">serif</span>;
                           <span class="key">font-style</span>: <span class="value">oblique</span>;
                           <span class="key">text-decoration</span>: <span class="value">overline</span><span class="delimiter">&quot;</span></span>
                           <span class="attribute-name">for</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/p&gt;</span>
        <span class="tag">&lt;/h:panelGroup&gt;</span>
    <span class="tag">&lt;/h:form&gt;</span>
<span class="tag">&lt;/composite:implementation&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="the-using-page"><a class="anchor" href="#the-using-page"></a>The Using Page</h4>
<div class="paragraph">
<p>The using page in this example application, <code>web/index.xhtml</code>, is an XHTML file that invokes the <code>PrimePanel.xhtml</code> composite component file along with the managed bean.
It validates the user&#8217;s input.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;div</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">compositecomponent</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;ez:PrimePanel</span> <span class="attribute-name">primeBean</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{primeBean}</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">calcAction</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{primeBean.calculate}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;/ez:PrimePanel&gt;</span>
<span class="tag">&lt;/div&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="the-managed-bean"><a class="anchor" href="#the-managed-bean"></a>The Managed Bean</h4>
<div class="paragraph">
<p>The managed bean, <code>PrimeBean.java</code>, defines a method called <code>calculate</code>, which performs the calculations on the input string and sets properties accordingly.
The bean first creates an array of prime numbers.
It calculates the sum of the letters in the string, with <code>'a'</code> equal to 1 and <code>'z'</code> equal to 26, and determines whether the value can be found in the array of primes.
An uppercase letter in the input string has the same value as its lowercase equivalent.</p>
</div>
<div class="paragraph">
<p>The bean specifies the minimum and maximum size of the <code>name</code> string, which is enforced by the Bean Validation <code>@Size</code> constraint.
The bean uses the <code>@Model</code> annotation, a shortcut for <code>@Named</code> and <code>@RequestScoped</code>, as described in <a href="#hello1-nb-step-7">Step 7</a> of <a href="#to-view-the-hello1-web-module-using-netbeans-ide">To View the hello1 Web Module Using NetBeans IDE</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Model</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">PrimeBean</span> <span class="directive">implements</span> <span class="predefined-type">Serializable</span> {
    ...
    <span class="annotation">@Size</span>(min=<span class="integer">1</span>, max=<span class="integer">45</span>)
    <span class="directive">private</span> <span class="predefined-type">String</span> name;
    ...

    public <span class="predefined-type">String</span> calculate() {
        ...
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="running-the-compositecomponentexample-example"><a class="anchor" href="#running-the-compositecomponentexample-example"></a>Running the compositecomponentexample Example</h4>
<div class="paragraph">
<p>You can use either NetBeans IDE or Maven to build, package, deploy, and run the <code>compositecomponentexample</code> example.</p>
</div>
<div class="sect4">
<h5 id="to-build-package-and-deploy-the-compositecomponentexample-example-using-netbeans-ide"><a class="anchor" href="#to-build-package-and-deploy-the-compositecomponentexample-example-using-netbeans-ide"></a>To Build, Package, and Deploy the compositecomponentexample Example Using NetBeans IDE</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>From the <strong>File</strong> menu, choose <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the Open Project dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/web/jsf</pre>
</div>
</div>
</li>
<li>
<p>Select the <code>compositecomponentexample</code> folder.</p>
</li>
<li>
<p>Click <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the <strong>Projects</strong> tab, right-click the <code>compositecomponentexample</code> project and select <strong>Build</strong>.</p>
<div class="paragraph">
<p>This command builds and deploys the application.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-build-package-and-deploy-the-compositecomponentexample-example-using-maven"><a class="anchor" href="#to-build-package-and-deploy-the-compositecomponentexample-example-using-maven"></a>To Build, Package, and Deploy the compositecomponentexample Example Using Maven</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>In a terminal window, go to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/web/jsf/compositecomponentexample/</pre>
</div>
</div>
</li>
<li>
<p>Enter the following command to build and deploy the application:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">mvn install</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-run-the-compositecomponentexample-example"><a class="anchor" href="#to-run-the-compositecomponentexample-example"></a>To Run the compositecomponentexample Example</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In a web browser, enter the following URL:</p>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080/compositecomponentexample</pre>
</div>
</div>
</li>
<li>
<p>On the page that appears, enter a string in the Name, word, or phrase field, then click Calculate.</p>
<div class="paragraph">
<p>The page reports the sum of the letters and whether the sum is prime.
A validation error is reported if no value is entered or if the string contains more than 45 characters.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="creating-custom-ui-components-and-other-custom-objects"><a class="anchor" href="#creating-custom-ui-components-and-other-custom-objects"></a>Chapter 15. Creating Custom UI Components and Other Custom Objects</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter describes creating custom components for applications that have additional functionality not provided by standard Jakarta Faces components.</p>
</div>
<div class="sect2">
<h3 id="introduction-to-creating-custom-components"><a class="anchor" href="#introduction-to-creating-custom-components"></a>Introduction to Creating Custom Components</h3>
<div class="paragraph">
<p>Jakarta Faces technology offers a basic set of standard, reusable UI components that enable quick and easy construction of user interfaces for web applications.
These components mostly map one-to-one to the elements in HTML 4.
But often an application requires a component that has additional functionality or requires a completely new component.
Jakarta Faces technology allows extension of standard components to enhance their functionality or to create custom components.
A rich ecosystem of third-party component libraries is built on this extension capability, but it is beyond the scope of this tutorial to examine them.
A web search for "JSF Component Libraries" is a good starting point to learn more about this important aspect of using Jakarta Faces technology.</p>
</div>
<div class="paragraph">
<p>In addition to extending the functionality of standard components, a component writer might want to give a page author the ability to change the appearance of the component on the page or to alter listener behavior.
Alternatively, the component writer might want to render a component to a different kind of client device type, such as a smartphone or a tablet instead of a desktop computer.
Enabled by the flexible Jakarta Faces architecture, a component writer can separate the definition of the component behavior from its appearance by delegating the rendering of the component to a separate renderer.
In this way, a component writer can define the behavior of a custom component once but create multiple renderers, each of which defines a different way to render the component to a particular kind of client device.</p>
</div>
<div class="paragraph">
<p>A <code>jakarta.faces.component.UIComponent</code> is a Java class that is responsible for representing a self-contained piece of the user interface during the request-processing lifecycle.
It is intended to represent the meaning of the component; the visual representation of the component is the responsibility of the <code>jakarta.faces.render.Renderer</code>.
There can be multiple instances of the same <code>UIComponent</code> class in any given Jakarta Faces view, just as there can be multiple instances of any Java class in any given Java program.</p>
</div>
<div class="paragraph">
<p>Jakarta Faces technology provides the ability to create custom components by extending the <code>UIComponent</code> class, the base class for all standard UI components.
A custom component can be used anywhere an ordinary component can be used, such as within a composite component.
A <code>UIComponent</code> is identified by two names: <code>component-family</code> specifies the general purpose of the component (input or output, for instance), and <code>component-type</code> indicates the specific purpose of a component, such as a text input field or a command button.</p>
</div>
<div class="paragraph">
<p>A <code>Renderer</code> is a helper to the <code>UIComponent</code> that deals with how that specific <code>UIComponent</code> class should appear in a specific kind of client device.
Renderers are identified by two names: <code>render-kit-id</code> and <code>renderer-type</code>.
A render kit is just a bucket into which a particular group of renderers is placed, and the <code>render-kit-id</code> identifies the group.
Most Jakarta Faces component libraries provide their own render kits.</p>
</div>
<div class="paragraph">
<p>A <code>jakarta.faces.view.facelets.Tag</code> object is a helper to the <code>UIComponent</code> and <code>Renderer</code> that allows the page author to include an instance of a <code>UIComponent</code> in a Jakarta Faces view.
A tag represents a specific combination of <code>component-type</code> and <code>renderer-type</code>.</p>
</div>
<div class="paragraph">
<p>See <a href="#component-renderer-and-tag-combinations">Component, Renderer, and Tag Combinations</a> for information on how components, renderers, and tags interact.</p>
</div>
<div class="paragraph">
<p>This chapter uses the image map component from the Duke&#8217;s Bookstore case study example to explain how you can create simple custom components, custom renderers, and associated custom tags, and take care of all the other details associated with using the components and renderers in an application.
See <a href="#dukes-bookstore-case-study-example">Chapter 61, <em>Duke&#8217;s Bookstore Case Study Example</em></a> for more information about this example.</p>
</div>
<div class="paragraph">
<p>The chapter also describes how to create other custom objects: custom converters, custom listeners, and custom validators.
It also describes how to bind component values and instances to data objects and how to bind custom objects to managed bean properties.</p>
</div>
</div>
<div class="sect2">
<h3 id="determining-whether-you-need-a-custom-component-or-renderer"><a class="anchor" href="#determining-whether-you-need-a-custom-component-or-renderer"></a>Determining Whether You Need a Custom Component or Renderer</h3>
<div class="paragraph">
<p>The Jakarta Faces implementation supports a very basic set of components and associated renderers.
This section helps you to decide whether you can use standard components and renderers in your application or need a custom component or custom renderer.</p>
</div>
<div class="sect3">
<h4 id="when-to-use-a-custom-component"><a class="anchor" href="#when-to-use-a-custom-component"></a>When to Use a Custom Component</h4>
<div class="paragraph">
<p>A component class defines the state and behavior of a UI component.
This behavior includes converting the value of a component to the appropriate markup, queuing events on components, performing validation, and any other behavior related to how the component interacts with the browser and the request-processing lifecycle.</p>
</div>
<div class="paragraph">
<p>You need to create a custom component in the following situations.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You need to add new behavior to a standard component, such as generating an additional type of event (for example, notifying another part of the page that something changed in this component as a result of user interaction).</p>
</li>
<li>
<p>You need to take a different action in the request processing of the value of a component from what is available in any of the existing standard components.</p>
</li>
<li>
<p>You want to take advantage of an HTML capability offered by your target browser, but none of the standard Jakarta Faces components take advantage of the capability in the way you want, if at all.
The current release does not contain standard components for complex HTML components, such as frames; however, because of the extensibility of the component architecture, you can use Jakarta Faces technology to create components like these.
The Duke&#8217;s Bookstore case study creates custom components that correspond to the HTML <code>map</code> and <code>area</code> tags.</p>
</li>
<li>
<p>You need to render to a non-HTML client that requires extra components not supported by HTML.
Eventually, the standard HTML render kit will provide support for all standard HTML components.
However, if you are rendering to a different client, such as a phone, you might need to create custom components to represent the controls uniquely supported by the client.
For example, some component architectures for wireless clients include support for tickers and progress bars, which are not available on an HTML client.
In this case, you might also need a custom renderer along with the component, or you might need only a custom renderer.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You do not need to create a custom component in the following cases.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You need to aggregate components to create a new component that has its own unique behavior.
In this situation, you can use a composite component to combine existing standard components.
For more information on composite components, see <a href="#composite-components">Composite Components</a> and <a href="#composite-components-advanced-topics-and-an-example">Chapter 14, <em>Composite Components: Advanced Topics and an Example</em></a>.</p>
</li>
<li>
<p>You simply need to manipulate data on the component or add application-specific functionality to it.
In this situation, you should create a managed bean for this purpose and bind it to the standard component rather than create a custom component.
See <a href="#managed-beans-in-jakarta-faces-technology">Managed Beans in Jakarta Faces Technology</a> for more information on managed beans.</p>
</li>
<li>
<p>You need to convert a component&#8217;s data to a type not supported by its renderer.
See <a href="#using-the-standard-converters">Using the Standard Converters</a> for more information about converting a component&#8217;s data.</p>
</li>
<li>
<p>You need to perform validation on the component data.
Standard validators and custom validators can be added to a component by using the validator tags from the page.
See <a href="#using-the-standard-validators">Using the Standard Validators</a> and <a href="#creating-and-using-a-custom-validator">Creating and Using a Custom Validator</a> for more information about validating a component&#8217;s data.</p>
</li>
<li>
<p>You need to register event listeners on components.
You can either register event listeners on components using the <code>f:valueChangeListener</code> and <code>f:actionListener</code> tags, or you can point at an event-processing method on a managed bean using the component&#8217;s <code>actionListener</code> or <code>valueChangeListener</code> attributes.
See <a href="#implementing-an-event-listener">Implementing an Event Listener</a> and <a href="#writing-managed-bean-methods">Writing Managed Bean Methods</a> for more information.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="when-to-use-a-custom-renderer"><a class="anchor" href="#when-to-use-a-custom-renderer"></a>When to Use a Custom Renderer</h4>
<div class="paragraph">
<p>A renderer, which generates the markup to display a component on a web page, allows you to separate the semantics of a component from its appearance.
By keeping this separation, you can support different kinds of client devices with the same kind of authoring experience.
You can think of a renderer as a "client adapter." It produces output suitable for consumption and display by the client and accepts input from the client when the user interacts with that component.</p>
</div>
<div class="paragraph">
<p>If you are creating a custom component, you need to ensure, among other things, that your component class performs these operations that are central to rendering the component:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Decoding: Converting the incoming request parameters to the local value of the component</p>
</li>
<li>
<p>Encoding: Converting the current local value of the component into the corresponding markup that represents it in the response</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Jakarta Faces specification supports two programming models for handling encoding and decoding.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Direct implementation: The component class itself implements the decoding and encoding.</p>
</li>
<li>
<p>Delegated implementation: The component class delegates the implementation of encoding and decoding to a separate renderer.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>By delegating the operations to the renderer, you have the option of associating your custom component with different renderers so that you can render the component on different clients.
If you don&#8217;t plan to render a particular component on different clients, it may be simpler to let the component class handle the rendering.
However, a separate renderer enables you to preserve the separation of semantics from appearance.
The Duke&#8217;s Bookstore application separates the renderers from the components, although it renders only to HTML 4 web browsers.</p>
</div>
<div class="paragraph">
<p>If you aren&#8217;t sure whether you will need the flexibility offered by separate renderers but you want to use the simpler direct-implementation approach, you can actually use both models.
Your component class can include some default rendering code, but it can delegate rendering to a renderer if there is one.</p>
</div>
</div>
<div class="sect3">
<h4 id="component-renderer-and-tag-combinations"><a class="anchor" href="#component-renderer-and-tag-combinations"></a>Component, Renderer, and Tag Combinations</h4>
<div class="paragraph">
<p>When you create a custom component, you can create a custom renderer to go with it.
To associate the component with the renderer and to reference the component from the page, you will also need a custom tag.</p>
</div>
<div class="paragraph">
<p>Although you need to write the custom component and renderer, there is no need to write code for a custom tag (called a tag handler).
If you specify the component and renderer combination, Facelets creates the tag handler automatically.</p>
</div>
<div class="paragraph">
<p>In rare situations, you might use a custom renderer with a standard component rather than a custom component.
Or you might use a custom tag without a renderer or a component.
This section gives examples of these situations and summarizes what is required for a custom component, renderer, and tag.</p>
</div>
<div class="paragraph">
<p>You would use a custom renderer without a custom component if you wanted to add some client-side validation on a standard component.
You would implement the validation code with a client-side scripting language, such as JavaScript, and then render the JavaScript with the custom renderer.
In this situation, you need a custom tag to go with the renderer so that its tag handler can register the renderer on the standard component.</p>
</div>
<div class="paragraph">
<p>Custom components as well as custom renderers need custom tags associated with them.
However, you can have a custom tag without a custom renderer or custom component.
For example, suppose that you need to create a custom validator that requires extra attributes on the validator tag.
In this case, the custom tag corresponds to a custom validator and not to a custom component or custom renderer.
In any case, you still need to associate the custom tag with a server-side object.</p>
</div>
<div class="paragraph">
<p><a href="#requirements-for-custom-components-custom-renderers-and-custom-tags">Table 15-1</a> summarizes what you must or can associate with a custom component, custom renderer, or custom tag.</p>
</div>
<table id="requirements-for-custom-components-custom-renderers-and-custom-tags" class="tableblock frame-all grid-all" style="width: 90%;">
<caption class="title">Table 15-1 Requirements for Custom Components, Custom Renderers and Custom Tags</caption>
<colgroup>
<col style="width: 34%;">
<col style="width: 30%;">
<col style="width: 36%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Custom Item</th>
<th class="tableblock halign-left valign-top">Must Have</th>
<th class="tableblock halign-left valign-top">Can Have</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Custom component</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Custom tag</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Custom renderer or standard renderer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Custom renderer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Custom tag</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Custom component or standard component</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Custom Jakarta Faces tag</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Some server-side object, like a component, a custom renderer, or custom validator</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Custom component or standard component associated with a custom renderer</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="understanding-the-image-map-example"><a class="anchor" href="#understanding-the-image-map-example"></a>Understanding the Image Map Example</h3>
<div class="paragraph">
<p>Duke&#8217;s Bookstore includes a custom image map component on the <code>index.xhtml</code> page.
This image map displays a selection of six book titles.
When the user clicks one of the book titles in the image map, the application goes to a page that displays the title of the selected book as well as information about a featured book.
The page allows the user to add either book (or none) to the shopping cart.</p>
</div>
<div class="sect3">
<h4 id="why-use-jakarta-faces-technology-to-implement-an-image-map"><a class="anchor" href="#why-use-jakarta-faces-technology-to-implement-an-image-map"></a>Why Use Jakarta Faces Technology to Implement an Image Map?</h4>
<div class="paragraph">
<p>Jakarta Faces technology is an ideal framework to use for implementing this kind of image map because it can perform the work that must be done on the server without requiring you to create a server-side image map.</p>
</div>
<div class="paragraph">
<p>In general, client-side image maps are preferred over server-side image maps for several reasons.
One reason is that the client-side image map allows the browser to provide immediate feedback when a user positions the mouse over a hotspot.
Another reason is that client-side image maps perform better because they don&#8217;t require round-trips to the server.
However, in some situations, your image map might need to access the server to retrieve data or to change the appearance of nonform controls, tasks that a client-side image map cannot do.</p>
</div>
<div class="paragraph">
<p>Because the image map custom component uses Jakarta Faces technology, it has the best of both styles of image maps: It can handle the parts of the application that need to be performed on the server while allowing the other parts of the application to be performed on the client side.</p>
</div>
</div>
<div class="sect3">
<h4 id="understanding-the-rendered-html"><a class="anchor" href="#understanding-the-rendered-html"></a>Understanding the Rendered HTML</h4>
<div class="paragraph">
<p>Here is an abbreviated version of the form part of the HTML page that the application needs to render:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><span class="tag">&lt;form</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">j_idt13</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">j_idt13</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">method</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">post</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/dukesbookstore/index.xhtml</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">...</span><span class="tag">&gt;</span>
    ...
    <span class="tag">&lt;img</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">j_idt13:mapImage</span><span class="delimiter">&quot;</span></span>
         <span class="attribute-name">src</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/dukesbookstore/jakarta.faces.resource/book_all.jpg?ln=images</span><span class="delimiter">&quot;</span></span>
         <span class="attribute-name">alt</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Choose a Book from our Catalog</span><span class="delimiter">&quot;</span></span>
         <span class="attribute-name">usemap</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#bookMap</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    ...
    <span class="tag">&lt;map</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bookMap</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
       <span class="tag">&lt;area</span> <span class="attribute-name">alt</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Duke</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">coords</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">67,23,212,268</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">shape</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">rect</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">onmouseout</span>=<span class="string"><span class="delimiter">&quot;</span>document.forms[<span class="integer">0</span>][<span class="string"><span class="delimiter">'</span><span class="content">j_idt13:mapImage</span><span class="delimiter">'</span></span>].src=<span class="string"><span class="delimiter">'</span><span class="content">resources/images/book_all.jpg</span><span class="delimiter">'</span></span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">onmouseover</span>=<span class="string"><span class="delimiter">&quot;</span>document.forms[<span class="integer">0</span>][<span class="string"><span class="delimiter">'</span><span class="content">j_idt13:mapImage</span><span class="delimiter">'</span></span>].src=<span class="string"><span class="delimiter">'</span><span class="content">resources/images/book_201.jpg</span><span class="delimiter">'</span></span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">onclick</span>=<span class="string"><span class="delimiter">&quot;</span>document.forms[<span class="integer">0</span>][<span class="string"><span class="delimiter">'</span><span class="content">bookMap_current</span><span class="delimiter">'</span></span>].value=<span class="string"><span class="delimiter">'</span><span class="content">Duke</span><span class="delimiter">'</span></span>; document.forms[<span class="integer">0</span>].submit()<span class="delimiter">&quot;</span></span>
       <span class="tag">/&gt;</span>
    ...
       <span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hidden</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bookMap_current</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;/map&gt;</span>
    ...
<span class="tag">&lt;/form&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>img</code> tag associates an image (<code>book_all.jpg</code>) with the image map referenced in the <code>usemap</code> attribute value.</p>
</div>
<div class="paragraph">
<p>The <code>map</code> tag specifies the image map and contains a set of <code>area</code> tags.</p>
</div>
<div class="paragraph">
<p>Each <code>area</code> tag specifies a region of the image map.
The <code>onmouseover</code>, <code>onmouseout</code>, and <code>onclick</code> attributes define which JavaScript code is executed when these events occur.
When the user moves the mouse over a region, the <code>onmouseover</code> function associated with the region displays the map with that region highlighted.
When the user moves the mouse out of a region, the <code>onmouseout</code> function redisplays the original image.
If the user clicks on a region, the <code>onclick</code> function sets the value of the <code>input</code> tag to the ID of the selected area and submits the page.</p>
</div>
<div class="paragraph">
<p>The <code>input</code> tag represents a hidden control that stores the value of the currently selected area between client-server exchanges so that the server-side component classes can retrieve the value.</p>
</div>
<div class="paragraph">
<p>The server-side objects retrieve the value of <code>bookMap_current</code> and set the locale in the <code>jakarta.faces.context.FacesContext</code> instance according to the region that was selected.</p>
</div>
</div>
<div class="sect3">
<h4 id="understanding-the-facelets-page"><a class="anchor" href="#understanding-the-facelets-page"></a>Understanding the Facelets Page</h4>
<div class="paragraph">
<p>Here is an abbreviated form of the Facelets page that the image map component uses to generate the HTML page shown in the preceding section.
It uses custom <code>bookstore:map</code> and <code>bookstore:area</code> tags to represent the custom components:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:form&gt;</span>
    ...
        <span class="tag">&lt;h:graphicImage</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mapImage</span><span class="delimiter">&quot;</span></span>
                        <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">book_all.jpg</span><span class="delimiter">&quot;</span></span>
                        <span class="attribute-name">library</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">images</span><span class="delimiter">&quot;</span></span>
                        <span class="attribute-name">alt</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{bundle.ChooseBook}</span><span class="delimiter">&quot;</span></span>
                        <span class="attribute-name">usemap</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#bookMap</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;bookstore:map</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bookMap</span><span class="delimiter">&quot;</span></span>
                       <span class="attribute-name">current</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">map1</span><span class="delimiter">&quot;</span></span>
                       <span class="attribute-name">immediate</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
                       <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bookstore</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;f:actionListener</span>
                <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dukesbookstore.listeners.MapBookChangeListener</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
            <span class="tag">&lt;bookstore:area</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">map1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{Book201}</span><span class="delimiter">&quot;</span></span>
                            <span class="attribute-name">onmouseover</span>=<span class="string"><span class="delimiter">&quot;</span>resources/images/book_201.jpg<span class="delimiter">&quot;</span></span>
                            <span class="attribute-name">onmouseout</span>=<span class="string"><span class="delimiter">&quot;</span>resources/images/book_all.jpg<span class="delimiter">&quot;</span></span>
                            <span class="attribute-name">targetImage</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mapImage</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
            <span class="tag">&lt;bookstore:area</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">map2</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{Book202}</span><span class="delimiter">&quot;</span></span>
                            <span class="attribute-name">onmouseover</span>=<span class="string"><span class="delimiter">&quot;</span>resources/images/book_202.jpg<span class="delimiter">&quot;</span></span>
                            <span class="attribute-name">onmouseout</span>=<span class="string"><span class="delimiter">&quot;</span>resources/images/book_all.jpg<span class="delimiter">&quot;</span></span>
                            <span class="attribute-name">targetImage</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mapImage</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            ...
        <span class="tag">&lt;/bookstore:map&gt;</span>
    ...
<span class="tag">&lt;/h:form&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>alt</code> attribute of the <code>h:graphicImage</code> tag maps to the localized string <code>"Choose a Book from our Catalog"</code>.</p>
</div>
<div class="paragraph">
<p>The <code>f:actionListener</code> tag within the <code>bookstore:map</code> tag points to a listener class for an action event.
The <code>processAction</code> method of the listener places the book ID for the selected map area into the session map.
The way this event is handled is explained more in <a href="#handling-events-for-custom-components">Handling Events for Custom Components</a>.</p>
</div>
<div class="paragraph">
<p>The <code>action</code> attribute of the <code>bookstore:map</code> tag specifies a logical outcome <code>String</code>, <code>"bookstore"</code>, which by implicit navigation rules sends the application to the page <code>bookstore.xhtml</code>.
For more information on navigation, see <a href="#configuring-navigation-rules">Configuring Navigation Rules</a>.</p>
</div>
<div class="paragraph">
<p>The <code>immediate</code> attribute of the <code>bookstore:map</code> tag is set to <code>true</code>, which indicates that the default <code>jakarta.faces.event.ActionListener</code> implementation should execute during the Apply Request Values phase of the request-processing lifecycle, instead of waiting for the Invoke Application phase.
Because the request resulting from clicking the map does not require any validation, data conversion, or server-side object updates, it makes sense to skip directly to the Invoke Application phase.</p>
</div>
<div class="paragraph">
<p>The <code>current</code> attribute of the <code>bookstore:map</code> tag is set to the default area, which is <code>map1</code> (the book My Early Years: Growing Up on Star7, by Duke).</p>
</div>
<div class="paragraph">
<p>Notice that the <code>bookstore:area</code> tags do not contain any of the JavaScript, coordinate, or shape data that is displayed on the HTML page.
The JavaScript is generated by the <code>dukesbookstore.renderers.AreaRenderer</code> class.
The <code>onmouseover</code> and <code>onmouseout</code> attribute values indicate the image to be loaded when these events occur.
How the JavaScript is generated is explained more in <a href="#performing-encoding">Performing Encoding</a>.</p>
</div>
<div class="paragraph">
<p>The coordinate, shape, and alternate text data are obtained through the <code>value</code> attribute, whose value refers to an attribute in application scope.
The value of this attribute is a bean, which stores the <code>coords</code>, <code>shape</code>, and <code>alt</code> data.
How these beans are stored in the application scope is explained more in the next section.</p>
</div>
</div>
<div class="sect3">
<h4 id="configuring-model-data"><a class="anchor" href="#configuring-model-data"></a>Configuring Model Data</h4>
<div class="paragraph">
<p>In a Jakarta Faces application, data such as the coordinates of a hotspot of an image map is retrieved from the <code>value</code> attribute through a bean.
However, the shape and coordinates of a hotspot should be defined together because the coordinates are interpreted differently depending on what shape the hotspot is.
Because a component&#8217;s value can be bound only to one property, the <code>value</code> attribute cannot refer to both the shape and the coordinates.</p>
</div>
<div class="paragraph">
<p>To solve this problem, the application encapsulates all of this information in a set of <code>ImageArea</code> objects.
These objects are initialized into application scope by the managed bean creation facility (see <a href="#using-the-managed-bean-element">Using the managed-bean Element</a>).
Here is part of the managed bean declaration for the <code>ImageArea</code> bean corresponding to the South America hotspot:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;managed-bean</span> <span class="attribute-name">eager</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    ...
    <span class="tag">&lt;managed-bean-name&gt;</span>Book201<span class="tag">&lt;/managed-bean-name&gt;</span>
    <span class="tag">&lt;managed-bean-class&gt;</span>
        ee.jakarta.tutorial.dukesbookstore.model.ImageArea
    <span class="tag">&lt;/managed-bean-class&gt;</span>
    <span class="tag">&lt;managed-bean-scope&gt;</span>application<span class="tag">&lt;/managed-bean-scope&gt;</span>
    <span class="tag">&lt;managed-property&gt;</span>
        ...
        <span class="tag">&lt;property-name&gt;</span>shape<span class="tag">&lt;/property-name&gt;</span>
        <span class="tag">&lt;value&gt;</span>rect<span class="tag">&lt;/value&gt;</span>
    <span class="tag">&lt;/managed-property&gt;</span>
    <span class="tag">&lt;managed-property&gt;</span>
        ...
        <span class="tag">&lt;property-name&gt;</span>alt<span class="tag">&lt;/property-name&gt;</span>
        <span class="tag">&lt;value&gt;</span>Duke<span class="tag">&lt;/value&gt;</span>
    <span class="tag">&lt;/managed-property&gt;</span>
    <span class="tag">&lt;managed-property&gt;</span>
        ...
        <span class="tag">&lt;property-name&gt;</span>coords<span class="tag">&lt;/property-name&gt;</span>
        <span class="tag">&lt;value&gt;</span>67,23,212,268<span class="tag">&lt;/value&gt;</span>
    <span class="tag">&lt;/managed-property&gt;</span>
<span class="tag">&lt;/managed-bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information on initializing managed beans with the managed bean creation facility, see the section <a href="#application-configuration-resource-file">Application Configuration Resource File</a>.</p>
</div>
<div class="paragraph">
<p>The <code>value</code> attributes of the <code>bookstore:area</code> tags refer to the beans in the application scope, as shown in this <code>bookstore:area</code> tag from <code>index.xhtml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bookstore:area</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">map1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{Book201}</span><span class="delimiter">&quot;</span></span>
                <span class="attribute-name">onmouseover</span>=<span class="string"><span class="delimiter">&quot;</span>resources/images/book_201.jpg<span class="delimiter">&quot;</span></span>
                <span class="attribute-name">onmouseout</span>=<span class="string"><span class="delimiter">&quot;</span>resources/images/book_all.jpg<span class="delimiter">&quot;</span></span>
                <span class="attribute-name">targetImage</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mapImage</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To reference the <code>ImageArea</code> model object bean values from the component class, you implement a <code>getValue</code> method in the component class.
This method calls <code>super.getValue</code>.
The superclass of <code><em>tut-install</em>/examples/case-studies/dukes-bookstore/src/java/dukesbookstore/components/AreaComponent.java</code>, <code>UIOutput</code>, has a <code>getValue</code> method that does the work of finding the <code>ImageArea</code> object associated with <code>AreaComponent</code>.
The <code>AreaRenderer</code> class, which needs to render the <code>alt</code>, <code>shape</code>, and <code>coords</code> values from the <code>ImageArea</code> object, calls the <code>getValue</code> method of <code>AreaComponent</code> to retrieve the <code>ImageArea</code> object.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ImageArea iarea = (ImageArea) area.getValue();</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>ImageArea</code> is a simple bean, so you can access the shape, coordinates, and alternative text values by calling the appropriate accessor methods of <code>ImageArea</code>.
<a href="#creating-the-renderer-class">Creating the Renderer Class</a> explains how to do this in the <code>AreaRenderer</code> class.</p>
</div>
</div>
<div class="sect3">
<h4 id="summary-of-the-image-map-application-classes"><a class="anchor" href="#summary-of-the-image-map-application-classes"></a>Summary of the Image Map Application Classes</h4>
<div class="paragraph">
<p><a href="#image-map-classes">Table 15-2</a> summarizes all the classes needed to implement the image map component.</p>
</div>
<table id="image-map-classes" class="tableblock frame-all grid-all" style="width: 60%;">
<caption class="title">Table 15-2 Image Map Classes</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Class</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AreaSelectedEvent</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The <code>jakarta.faces.event.ActionEvent</code> indicating that an <code>AreaComponent</code> from the <code>MapComponent</code> has been selected.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AreaComponent</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The class that defines <code>AreaComponent</code>, which corresponds to the <code>bookstore:area</code> custom tag.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MapComponent</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The class that defines <code>MapComponent</code>, which corresponds to the <code>bookstore:map</code> custom tag.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AreaRenderer</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>This <code>jakarta.faces.render.Renderer</code> performs the delegated rendering for <code>AreaComponent</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ImageArea</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The bean that stores the shape and coordinates of the hotspots.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MapBookChangeListener</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The action listener for the <code>MapComponent</code>.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The Duke&#8217;s Bookstore source directory, called bookstore-dir, is <code><em>tut-install</em>/examples/case-studies/dukes-bookstore/src/java/dukesbookstore/</code>.
The event and listener classes are located in <code><em>bookstore-dir</em>/listeners/</code>.
The component classes are located in <code><em>bookstore-dir</em>/components/</code>.
The renderer classes are located in <code><em>bookstore-dir</em>/renderers/</code>.
<code>ImageArea</code> is located in <code><em>bookstore-dir</em>/model/</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="steps-for-creating-a-custom-component"><a class="anchor" href="#steps-for-creating-a-custom-component"></a>Steps for Creating a Custom Component</h3>
<div class="paragraph">
<p>You can apply the following steps while developing your own custom component.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a custom component class that does the following:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Overrides the <code>getFamily</code> method to return the component family, which is used to look up renderers that can render the component</p>
</li>
<li>
<p>Includes the rendering code or delegates it to a renderer (explained in <a href="#create-custom-component-step-2">Step 2</a>)</p>
</li>
<li>
<p>Enables component attributes to accept expressions</p>
</li>
<li>
<p>Queues an event on the component if the component generates events</p>
</li>
<li>
<p>Saves and restores the component state</p>
</li>
</ol>
</div>
</li>
<li>
<p><a id="create-custom-component-step-2"></a> Delegate rendering to a renderer if your component does not handle the rendering.
To do this:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Create a custom renderer class by extending <code>jakarta.faces.render.Renderer</code>.</p>
</li>
<li>
<p>Register the renderer to a render kit.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Register the component.</p>
</li>
<li>
<p>Create an event handler if your component generates events.</p>
</li>
<li>
<p>Create a tag library descriptor (TLD) that defines the custom tag.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>See <a href="#registering-a-custom-component">Registering a Custom Component</a> and <a href="#registering-a-custom-renderer-with-a-render-kit">Registering a Custom Renderer with a Render Kit</a> for information on registering the custom component and the renderer.
The section <a href="#using-a-custom-component">Using a Custom Component</a> discusses how to use the custom component in a Jakarta Faces page.</p>
</div>
</div>
<div class="sect2">
<h3 id="creating-custom-component-classes"><a class="anchor" href="#creating-custom-component-classes"></a>Creating Custom Component Classes</h3>
<div class="paragraph">
<p>As explained in <a href="#when-to-use-a-custom-component">When to Use a Custom Component</a>, a component class defines the state and behavior of a UI component.
The state information includes the component&#8217;s type, identifier, and local value.
The behavior defined by the component class includes the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Decoding (converting the request parameter to the component&#8217;s local value)</p>
</li>
<li>
<p>Encoding (converting the local value into the corresponding markup)</p>
</li>
<li>
<p>Saving the state of the component</p>
</li>
<li>
<p>Updating the bean value with the local value</p>
</li>
<li>
<p>Processing validation on the local value</p>
</li>
<li>
<p>Queueing events</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>jakarta.faces.component.UIComponentBase</code> class defines the default behavior of a component class.
All the classes representing the standard components extend from <code>UIComponentBase</code>.
These classes add their own behavior definitions, as your custom component class will do.</p>
</div>
<div class="paragraph">
<p>Your custom component class must either extend <code>UIComponentBase</code> directly or extend a class representing one of the standard components.
These classes are located in the <code>jakarta.faces.component</code> package, and their names begin with <code>UI</code>.</p>
</div>
<div class="paragraph">
<p>If your custom component serves the same purpose as a standard component, you should extend that standard component rather than directly extend <code>UIComponentBase</code>.
For example, suppose you want to create an editable menu component.
It makes sense to have this component extend <code>UISelectOne</code> rather than <code>UIComponentBase</code> because you can reuse the behavior already defined in <code>UISelectOne</code>.
The only new functionality you need to define is to make the menu editable.</p>
</div>
<div class="paragraph">
<p>Whether you decide to have your component extend <code>UIComponentBase</code> or a standard component, you might also want your component to implement one or more of these behavioral interfaces defined in the <code>jakarta.faces.component</code> package:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ActionSource</code>: Indicates that the component can fire a <code>jakarta.faces.event.ActionEvent</code></p>
</li>
<li>
<p><code>ActionSource2</code>: Extends <code>ActionSource</code> and allows component properties referencing methods that handle action events to use method expressions as defined by the EL</p>
</li>
<li>
<p><code>EditableValueHolder</code>: Extends <code>ValueHolder</code> and specifies additional features for editable components, such as validation and emitting value-change events</p>
</li>
<li>
<p><code>NamingContainer</code>: Mandates that each component rooted at this component has a unique ID</p>
</li>
<li>
<p><code>StateHolder</code>: Denotes that a component has state that must be saved between requests</p>
</li>
<li>
<p><code>ValueHolder</code>: Indicates that the component maintains a local value as well as the option of accessing data in the model tier</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If your component extends <code>UIComponentBase</code>, it automatically implements only <code>StateHolder</code>.
Because all components directly or indirectly extend <code>UIComponentBase</code>, they all implement <code>StateHolder</code>.
Any component that implements <code>StateHolder</code> also implements the <code>StateHelper</code> interface, which extends <code>StateHolder</code> and defines a <code>Map</code>-like contract that makes it easy for components to save and restore a partial view state.</p>
</div>
<div class="paragraph">
<p>If your component extends one of the other standard components, it might also implement other behavioral interfaces in addition to <code>StateHolder</code>.
If your component extends <code>UICommand</code>, it automatically implements <code>ActionSource2</code>.
If your component extends <code>UIOutput</code> or one of the component classes that extend <code>UIOutput</code>, it automatically implements <code>ValueHolder</code>.
If your component extends <code>UIInput</code>, it automatically implements <code>EditableValueHolder</code> and <code>ValueHolder</code>.
See the Jakarta Faces API documentation to find out what the other component classes implement.</p>
</div>
<div class="paragraph">
<p>You can also make your component explicitly implement a behavioral interface that it doesn&#8217;t already by virtue of extending a particular standard component.
For example, if you have a component that extends <code>UIInput</code> and you want it to fire action events, you must make it explicitly implement <code>ActionSource2</code> because a <code>UIInput</code> component doesn&#8217;t automatically implement this interface.</p>
</div>
<div class="paragraph">
<p>The Duke&#8217;s Bookstore image map example has two component classes: <code>AreaComponent</code> and <code>MapComponent</code>.
The <code>MapComponent</code> class extends <code>UICommand</code> and therefore implements <code>ActionSource2</code>, which means it can fire action events when a user clicks on the map.
The <code>AreaComponent</code> class extends the standard component <code>UIOutput</code>.
The <code>@FacesComponent</code> annotation registers the components with the Jakarta Faces implementation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@FacesComponent</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">DemoMap</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">MapComponent</span> <span class="directive">extends</span> UICommand {...}

<span class="annotation">@FacesComponent</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">DemoArea</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">AreaComponent</span> <span class="directive">extends</span> UIOutput {...}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>MapComponent</code> class represents the component corresponding to the <code>bookstore:map</code> tag:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bookstore:map</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bookMap</span><span class="delimiter">&quot;</span></span>
               <span class="attribute-name">current</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">map1</span><span class="delimiter">&quot;</span></span>
               <span class="attribute-name">immediate</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
               <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bookstore</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    ...
<span class="tag">&lt;/bookstore:map&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>AreaComponent</code> class represents the component corresponding to the <code>bookstore:area</code> tag:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bookstore:area</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">map1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{Book201}</span><span class="delimiter">&quot;</span></span>
                <span class="attribute-name">onmouseover</span>=<span class="string"><span class="delimiter">&quot;</span>resources/images/book_201.jpg<span class="delimiter">&quot;</span></span>
                <span class="attribute-name">onmouseout</span>=<span class="string"><span class="delimiter">&quot;</span>resources/images/book_all.jpg<span class="delimiter">&quot;</span></span>
                <span class="attribute-name">targetImage</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mapImage</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>MapComponent</code> has one or more <code>AreaComponent</code> instances as children.
Its behavior consists of the following actions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Retrieving the value of the currently selected area</p>
</li>
<li>
<p>Defining the properties corresponding to the component&#8217;s values</p>
</li>
<li>
<p>Generating an event when the user clicks on the image map</p>
</li>
<li>
<p>Queuing the event</p>
</li>
<li>
<p>Saving its state</p>
</li>
<li>
<p>Rendering the HTML <code>map</code> tag and the HTML <code>input</code> tag</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>MapComponent</code> delegates the rendering of the HTML <code>map</code> and <code>input</code> tags to the <code>MapRenderer</code> class.</p>
</div>
<div class="paragraph">
<p><code>AreaComponent</code> is bound to a bean that stores the shape and coordinates of the region of the image map.
You will see how all this data is accessed through the value expression in <a href="#creating-the-renderer-class">Creating the Renderer Class</a>.
The behavior of <code>AreaComponent</code> consists of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Retrieving the shape and coordinate data from the bean</p>
</li>
<li>
<p>Setting the value of the hidden tag to the <code>id</code> of this component</p>
</li>
<li>
<p>Rendering the <code>area</code> tag, including the JavaScript for the <code>onmouseover</code>, <code>onmouseout</code>, and <code>onclick</code> functions</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Although these tasks are actually performed by <code>AreaRenderer</code>, <code>AreaComponent</code> must delegate the tasks to <code>AreaRenderer</code>.
See <a href="#delegating-rendering-to-a-renderer">Delegating Rendering to a Renderer</a> for more information.</p>
</div>
<div class="paragraph">
<p>The rest of this section describes the tasks that <code>MapComponent</code> performs as well as the encoding and decoding that it delegates to <code>MapRenderer</code>.
<a href="#handling-events-for-custom-components">Handling Events for Custom Components</a> details how <code>MapComponent</code> handles events.</p>
</div>
<div class="sect3">
<h4 id="specifying-the-component-family"><a class="anchor" href="#specifying-the-component-family"></a>Specifying the Component Family</h4>
<div class="paragraph">
<p>If your custom component class delegates rendering, it needs to override the <code>getFamily</code> method of <code>UIComponent</code> to return the identifier of a component family, which is used to refer to a component or set of components that can be rendered by a renderer or set of renderers.
The component family is used along with the renderer type to look up renderers that can render the component:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="predefined-type">String</span> getFamily() {
    <span class="keyword">return</span> (<span class="string"><span class="delimiter">&quot;</span><span class="content">Map</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The component family identifier, <code>Map</code>, must match that defined by the <code>component-family</code> elements included in the component and renderer configurations in the application configuration resource file.
<a href="#registering-a-custom-renderer-with-a-render-kit">Registering a Custom Renderer with a Render Kit</a> explains how to define the component family in the renderer configuration.
<a href="#registering-a-custom-component">Registering a Custom Component</a> explains how to define the component family in the component configuration.</p>
</div>
</div>
<div class="sect3">
<h4 id="performing-encoding"><a class="anchor" href="#performing-encoding"></a>Performing Encoding</h4>
<div class="paragraph">
<p>During the Render Response phase, the Jakarta Faces implementation processes the encoding methods of all components and their associated renderers in the view.
The encoding methods convert the current local value of the component into the corresponding markup that represents it in the response.</p>
</div>
<div class="paragraph">
<p>The <code>UIComponentBase</code> class defines a set of methods for rendering markup: <code>encodeBegin</code>, <code>encodeChildren</code>, and <code>encodeEnd</code>.
If the component has child components, you might need to use more than one of these methods to render the component; otherwise, all rendering should be done in <code>encodeEnd</code>.
Alternatively, you can use the <code>encodeALL</code> method, which encompasses all the methods.</p>
</div>
<div class="paragraph">
<p>Because <code>MapComponent</code> is a parent component of <code>AreaComponent</code>, the <code>area</code> tags must be rendered after the beginning <code>map</code> tag and before the ending <code>map</code> tag.
To accomplish this, the <code>MapRenderer</code> class renders the beginning <code>map</code> tag in <code>encodeBegin</code> and the rest of the <code>map</code> tag in <code>encodeEnd</code>.</p>
</div>
<div class="paragraph">
<p>The Jakarta Faces implementation automatically invokes the <code>encodeEnd</code> method of <code>AreaComponent</code>'s renderer after it invokes <code>MapRenderer</code>'s <code>encodeBegin</code> method and before it invokes <code>MapRenderer</code>'s <code>encodeEnd</code> method.
If a component needs to perform the rendering for its children, it does this in the <code>encodeChildren</code> method.</p>
</div>
<div class="paragraph">
<p>Here are the <code>encodeBegin</code> and <code>encodeEnd</code> methods of <code>MapRenderer</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> encodeBegin(FacesContext context, UIComponent component)
        <span class="directive">throws</span> <span class="exception">IOException</span> {
    <span class="keyword">if</span> ((context == <span class="predefined-constant">null</span>)|| (component == <span class="predefined-constant">null</span>)) {
        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">NullPointerException</span>();
    }
    MapComponent map = (MapComponent) component;
    ResponseWriter writer = context.getResponseWriter();
    writer.startElement(<span class="string"><span class="delimiter">&quot;</span><span class="content">map</span><span class="delimiter">&quot;</span></span>, map);
    writer.writeAttribute(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, map.getId(), <span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>);
}

<span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> encodeEnd(FacesContext context, UIComponent component)
        <span class="directive">throws</span> <span class="exception">IOException</span> {
    <span class="keyword">if</span> ((context == <span class="predefined-constant">null</span>) || (component == <span class="predefined-constant">null</span>)){
        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">NullPointerException</span>();
    }
    MapComponent map = (MapComponent) component;
    ResponseWriter writer = context.getResponseWriter();
    writer.startElement(<span class="string"><span class="delimiter">&quot;</span><span class="content">input</span><span class="delimiter">&quot;</span></span>, map);
    writer.writeAttribute(<span class="string"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">hidden</span><span class="delimiter">&quot;</span></span>, <span class="predefined-constant">null</span>);
    writer.writeAttribute(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, getName(context,map), <span class="string"><span class="delimiter">&quot;</span><span class="content">clientId</span><span class="delimiter">&quot;</span></span>);
    writer.endElement(<span class="string"><span class="delimiter">&quot;</span><span class="content">input</span><span class="delimiter">&quot;</span></span>);
    writer.endElement(<span class="string"><span class="delimiter">&quot;</span><span class="content">map</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that <code>encodeBegin</code> renders only the beginning <code>map</code> tag.
The <code>encodeEnd</code> method renders the <code>input</code> tag and the ending <code>map</code> tag.</p>
</div>
<div class="paragraph">
<p>The encoding methods accept a <code>UIComponent</code> argument and a <code>jakarta.faces.context.FacesContext</code> argument.
The <code>FacesContext</code> instance contains all the information associated with the current request.
The <code>UIComponent</code> argument is the component that needs to be rendered.</p>
</div>
<div class="paragraph">
<p>The rest of the method renders the markup to the <code>jakarta.faces.context.ResponseWriter</code> instance, which writes out the markup to the current response.
This basically involves passing the HTML tag names and attribute names to the <code>ResponseWriter</code> instance as strings, retrieving the values of the component attributes, and passing these values to the <code>ResponseWriter</code> instance.</p>
</div>
<div class="paragraph">
<p>The <code>startElement</code> method takes a <code>String</code> (the name of the tag) and the component to which the tag corresponds (in this case, <code>map</code>).
(Passing this information to the <code>ResponseWriter</code> instance helps design-time tools know which portions of the generated markup are related to which components.)</p>
</div>
<div class="paragraph">
<p>After calling <code>startElement</code>, you can call <code>writeAttribute</code> to render the tag&#8217;s attributes.
The <code>writeAttribute</code> method takes the name of the attribute, its value, and the name of a property or attribute of the containing component corresponding to the attribute.
The last parameter can be null, and it won&#8217;t be rendered.</p>
</div>
<div class="paragraph">
<p>The <code>name</code> attribute value of the <code>map</code> tag is retrieved using the <code>getId</code> method of <code>UIComponent</code>, which returns the component&#8217;s unique identifier.
The <code>name</code> attribute value of the <code>input</code> tag is retrieved using the <code>getName(FacesContext, UIComponent)</code> method of <code>MapRenderer</code>.</p>
</div>
<div class="paragraph">
<p>If you want your component to perform its own rendering but delegate to a renderer if there is one, include the following lines in the encoding method to check whether there is a renderer associated with this component:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">if</span> (getRendererType() != <span class="predefined-constant">null</span>) {
    <span class="local-variable">super</span>.encodeEnd(context);
    <span class="keyword">return</span>;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If there is a renderer available, this method invokes the superclass&#8217;s <code>encodeEnd</code> method, which does the work of finding the renderer.
The <code>MapComponent</code> class delegates all rendering to <code>MapRenderer</code>, so it does not need to check for available renderers.</p>
</div>
<div class="paragraph">
<p>In some custom component classes that extend standard components, you might need to implement other methods in addition to <code>encodeEnd</code>.
For example, if you need to retrieve the component&#8217;s value from the request parameters, you must also implement the <code>decode</code> method.</p>
</div>
</div>
<div class="sect3">
<h4 id="performing-decoding"><a class="anchor" href="#performing-decoding"></a>Performing Decoding</h4>
<div class="paragraph">
<p>During the Apply Request Values phase, the Jakarta Faces implementation processes the <code>decode</code> methods of all components in the tree.
The <code>decode</code> method extracts a component&#8217;s local value from incoming request parameters and uses a <code>jakarta.faces.convert.Converter</code> implementation to convert the value to a type that is acceptable to the component class.</p>
</div>
<div class="paragraph">
<p>A custom component class or its renderer must implement the <code>decode</code> method only if it must retrieve the local value or if it needs to queue events.
The component queues the event by calling <code>queueEvent</code>.</p>
</div>
<div class="paragraph">
<p>Here is the <code>decode</code> method of <code>MapRenderer</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> decode(FacesContext context, UIComponent component) {
    <span class="keyword">if</span> ((context == <span class="predefined-constant">null</span>) || (component == <span class="predefined-constant">null</span>)) {
        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">NullPointerException</span>();
    }
    MapComponent map = (MapComponent) component;
    <span class="predefined-type">String</span> key = getName(context, map);
    <span class="predefined-type">String</span> value = (<span class="predefined-type">String</span>) context.getExternalContext().
            getRequestParameterMap().get(key);
    <span class="keyword">if</span> (value != <span class="predefined-constant">null</span>)
        map.setCurrent(value);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>decode</code> method first gets the name of the hidden <code>input</code> field by calling <code>getName(FacesContext, UIComponent)</code>.
It then uses that name as the key to the request parameter map to retrieve the current value of the <code>input</code> field.
This value represents the currently selected area.
Finally, it sets the value of the <code>MapComponent</code> class&#8217;s <code>current</code> attribute to the value of the <code>input</code> field.</p>
</div>
</div>
<div class="sect3">
<h4 id="enabling-component-properties-to-accept-expressions"><a class="anchor" href="#enabling-component-properties-to-accept-expressions"></a>Enabling Component Properties to Accept Expressions</h4>
<div class="paragraph">
<p>Nearly all the attributes of the standard Jakarta Faces tags can accept expressions, whether they are value expressions or method expressions.
It is recommended that you also enable your component attributes to accept expressions because it gives you much more flexibility when you write Facelets pages.</p>
</div>
<div class="paragraph">
<p>To enable the attributes to accept expressions, the component class must implement getter and setter methods for the component properties.
These methods can use the facilities offered by the <code>StateHelper</code> interface to store and retrieve not only the values for these properties but also the state of the components across multiple requests.</p>
</div>
<div class="paragraph">
<p>Because <code>MapComponent</code> extends <code>UICommand</code>, the <code>UICommand</code> class already does the work of getting the <code>ValueExpression</code> and <code>MethodExpression</code> instances associated with each of the attributes that it supports.
Similarly, the <code>UIOutput</code> class that <code>AreaComponent</code> extends already obtains the <code>ValueExpression</code> instances for its supported attributes.
For both components, the simple getter and setter methods store and retrieve the key values and state for the attributes, as shown in this code fragment from <code>AreaComponent</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">enum</span> PropertyKeys {
    alt, coords, shape, targetImage;
}
<span class="directive">public</span> <span class="predefined-type">String</span> getAlt() {
    <span class="keyword">return</span> (<span class="predefined-type">String</span>) getStateHelper().eval(PropertyKeys.alt, <span class="predefined-constant">null</span>);
}
<span class="directive">public</span> <span class="type">void</span> setAlt(<span class="predefined-type">String</span> alt) {
    getStateHelper().put(PropertyKeys.alt, alt);
}
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>However, if you have a custom component class that extends <code>UIComponentBase</code>, you will need to implement the methods that get the <code>ValueExpression</code> and <code>MethodExpression</code> instances associated with those attributes that are enabled to accept expressions.
For example, you could include a method that gets the <code>ValueExpression</code> instance for the <code>immediate</code> attribute:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">boolean</span> isImmediate() {
    <span class="keyword">if</span> (<span class="local-variable">this</span>.immediateSet) {
        <span class="keyword">return</span> (<span class="local-variable">this</span>.immediate);
    }
    ValueExpression ve = getValueExpression(<span class="string"><span class="delimiter">&quot;</span><span class="content">immediate</span><span class="delimiter">&quot;</span></span>);
    <span class="keyword">if</span> (ve != <span class="predefined-constant">null</span>) {
        <span class="predefined-type">Boolean</span> value = (<span class="predefined-type">Boolean</span>) ve.getValue(
            getFacesContext().getELContext());
        <span class="keyword">return</span> (value.booleanValue());
    } <span class="keyword">else</span> {
        <span class="keyword">return</span> (<span class="local-variable">this</span>.immediate);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The properties corresponding to the component attributes that accept method expressions must accept and return a <code>MethodExpression</code> object.
For example, if <code>MapComponent</code> extended <code>UIComponentBase</code> instead of <code>UICommand</code>, it would need to provide an <code>action</code> property that returns and accepts a <code>MethodExpression</code> object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> MethodExpression getAction() {
    <span class="keyword">return</span> (<span class="local-variable">this</span>.action);
}
<span class="directive">public</span> <span class="type">void</span> setAction(MethodExpression action) {
    <span class="local-variable">this</span>.action = action;
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="saving-and-restoring-state"><a class="anchor" href="#saving-and-restoring-state"></a>Saving and Restoring State</h4>
<div class="paragraph">
<p>As described in <a href="#enabling-component-properties-to-accept-expressions">Enabling Component Properties to Accept Expressions</a>, use of the <code>StateHelper</code> interface facilities allows you to save the component&#8217;s state at the same time you set and retrieve property values.
The <code>StateHelper</code> implementation allows partial state saving; it saves only the changes in the state since the initial request, not the entire state, because the full state can be restored during the Restore View phase.</p>
</div>
<div class="paragraph">
<p>Component classes that implement <code>StateHolder</code> may prefer to implement the <code>saveState(FacesContext)</code> and <code>restoreState(FacesContext, Object)</code> methods to help the Jakarta Faces implementation save and restore the state of components across multiple requests.</p>
</div>
<div class="paragraph">
<p>To save a set of values, you can implement the <code>saveState(FacesContext)</code> method.
This method is called during the Render Response phase, during which the state of the response is saved for processing on subsequent requests.
Here is a hypothetical method from <code>MapComponent</code>, which has only one attribute, <code>current</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Override</span>
<span class="directive">public</span> <span class="predefined-type">Object</span> saveState(FacesContext context) {
    <span class="predefined-type">Object</span> values<span class="type">[]</span> = <span class="keyword">new</span> <span class="predefined-type">Object</span>[<span class="integer">2</span>];
    values[<span class="integer">0</span>] = <span class="local-variable">super</span>.saveState(context);
    values[<span class="integer">1</span>] = current;
    <span class="keyword">return</span> (values);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This method initializes an array, which will hold the saved state.
It next saves all of the state associated with the component.</p>
</div>
<div class="paragraph">
<p>A component that implements <code>StateHolder</code> may also provide an implementation for <code>restoreState(FacesContext, Object)</code>, which restores the state of the component to that saved with the <code>saveState(FacesContext)</code> method.
The <code>restoreState(FacesContext, Object)</code> method is called during the Restore View phase, during which the Jakarta Faces implementation checks whether there is any state that was saved during the last Render Response phase and needs to be restored in preparation for the next postback.</p>
</div>
<div class="paragraph">
<p>Here is a hypothetical <code>restoreState(FacesContext, Object)</code> method from <code>MapComponent</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">void</span> restoreState(FacesContext context, <span class="predefined-type">Object</span> state) {
    <span class="predefined-type">Object</span> values<span class="type">[]</span> = (<span class="predefined-type">Object</span><span class="type">[]</span>) state;
    <span class="local-variable">super</span>.restoreState(context, values[<span class="integer">0</span>]);
    current = (<span class="predefined-type">String</span>) values[<span class="integer">1</span>];
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This method takes a <code>FacesContext</code> and an <code>Object</code> instance, representing the array that is holding the state for the component.
This method sets the component&#8217;s properties to the values saved in the <code>Object</code> array.</p>
</div>
<div class="paragraph">
<p>Whether or not you implement these methods in your component class, you can use the <code>jakarta.faces.STATE_SAVING_METHOD</code> context parameter to specify in the deployment descriptor where you want the state to be saved: either <code>client</code> or <code>server</code>.
If state is saved on the client, the state of the entire view is rendered to a hidden field on the page.
By default, the state is saved on the server.</p>
</div>
<div class="paragraph">
<p>The web applications in the Duke&#8217;s Forest case study save their view state on the client.</p>
</div>
<div class="paragraph">
<p>Saving state on the client uses more bandwidth as well as more client resources, whereas saving it on the server uses more server resources.
You may also want to save state on the client if you expect your users to disable cookies.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="delegating-rendering-to-a-renderer"><a class="anchor" href="#delegating-rendering-to-a-renderer"></a>Delegating Rendering to a Renderer</h3>
<div class="paragraph">
<p>Both <code>MapComponent</code> and <code>AreaComponent</code> delegate all of their rendering to a separate renderer.
The section <a href="#performing-encoding">Performing Encoding</a> explains how <code>MapRenderer</code> performs the encoding for <code>MapComponent</code>.
This section explains in detail the process of delegating rendering to a renderer using <code>AreaRenderer</code>, which performs the rendering for <code>AreaComponent</code>.</p>
</div>
<div class="paragraph">
<p>To delegate rendering, you perform the tasks described in the following topics:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#creating-the-renderer-class">Creating the Renderer Class</a></p>
</li>
<li>
<p><a href="#identifying-the-renderer-type">Identifying the Renderer Type</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="creating-the-renderer-class"><a class="anchor" href="#creating-the-renderer-class"></a>Creating the Renderer Class</h4>
<div class="paragraph">
<p>When delegating rendering to a renderer, you can delegate all encoding and decoding to the renderer, or you can choose to do part of it in the component class.
The <code>AreaComponent</code> class delegates encoding to the <code>AreaRenderer</code> class.</p>
</div>
<div class="paragraph">
<p>The renderer class begins with a <code>@FacesRenderer</code> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@FacesRenderer</span>(componentFamily = <span class="string"><span class="delimiter">&quot;</span><span class="content">Area</span><span class="delimiter">&quot;</span></span>, rendererType = <span class="string"><span class="delimiter">&quot;</span><span class="content">DemoArea</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">AreaRenderer</span> <span class="directive">extends</span> <span class="predefined-type">Renderer</span> { }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>@FacesRenderer</code> annotation registers the renderer class with the Jakarta Faces implementation as a renderer class.
The annotation identifies the component family as well as the renderer type.</p>
</div>
<div class="paragraph">
<p>To perform the rendering for <code>AreaComponent</code>, <code>AreaRenderer</code> must implement an <code>encodeEnd</code> method.
The <code>encodeEnd</code> method of <code>AreaRenderer</code> retrieves the shape, coordinates, and alternative text values stored in the <code>ImageArea</code> bean that is bound to <code>AreaComponent</code>.
Suppose that the <code>area</code> tag currently being rendered has a <code>value</code> attribute value of <code>"book203"</code>.
The following line from <code>encodeEnd</code> gets the value of the attribute <code>"book203"</code> from the <code>FacesContext</code> instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ImageArea ia = (ImageArea)area.getValue();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The attribute value is the <code>ImageArea</code> bean instance, which contains the <code>shape</code>, <code>coords</code>, and <code>alt</code> values associated with the <code>book203</code> <code>AreaComponent</code> instance.
<a href="#configuring-model-data">Configuring Model Data</a> describes how the application stores these values.</p>
</div>
<div class="paragraph">
<p>After retrieving the <code>ImageArea</code> object, the method renders the values for <code>shape</code>, <code>coords</code>, and <code>alt</code> by simply calling the associated accessor methods and passing the returned values to the <code>ResponseWriter</code> instance, as shown by these lines of code, which write out the shape and coordinates:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">writer.startElement(<span class="string"><span class="delimiter">&quot;</span><span class="content">area</span><span class="delimiter">&quot;</span></span>, area);
writer.writeAttribute(<span class="string"><span class="delimiter">&quot;</span><span class="content">alt</span><span class="delimiter">&quot;</span></span>, iarea.getAlt(), <span class="string"><span class="delimiter">&quot;</span><span class="content">alt</span><span class="delimiter">&quot;</span></span>);
writer.writeAttribute(<span class="string"><span class="delimiter">&quot;</span><span class="content">coords</span><span class="delimiter">&quot;</span></span>, iarea.getCoords(), <span class="string"><span class="delimiter">&quot;</span><span class="content">coords</span><span class="delimiter">&quot;</span></span>);
writer.writeAttribute(<span class="string"><span class="delimiter">&quot;</span><span class="content">shape</span><span class="delimiter">&quot;</span></span>, iarea.getShape(), <span class="string"><span class="delimiter">&quot;</span><span class="content">shape</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>encodeEnd</code> method also renders the JavaScript for the <code>onmouseout</code>, <code>onmouseover</code>, and <code>onclick</code> attributes.
The Facelets page needs to provide only the path to the images that are to be loaded during an <code>onmouseover</code> or <code>onmouseout</code> action:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bookstore:area</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">map3</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{Book203}</span><span class="delimiter">&quot;</span></span>
                <span class="attribute-name">onmouseover</span>=<span class="string"><span class="delimiter">&quot;</span>resources/images/book_203.jpg<span class="delimiter">&quot;</span></span>
                <span class="attribute-name">onmouseout</span>=<span class="string"><span class="delimiter">&quot;</span>resources/images/book_all.jpg<span class="delimiter">&quot;</span></span>
                <span class="attribute-name">targetImage</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mapImage</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>AreaRenderer</code> class takes care of generating the JavaScript for these actions, as shown in the following code from <code>encodeEnd</code>.
The JavaScript that <code>AreaRenderer</code> generates for the <code>onclick</code> action sets the value of the hidden field to the value of the current area&#8217;s component ID and submits the page.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">sb = <span class="keyword">new</span> <span class="predefined-type">StringBuffer</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">document.forms[0]['</span><span class="delimiter">&quot;</span></span>).append(targetImageId).
        append(<span class="string"><span class="delimiter">&quot;</span><span class="content">'].src='</span><span class="delimiter">&quot;</span></span>);
sb.append(
        getURI(context,
        (<span class="predefined-type">String</span>) area.getAttributes().get(<span class="string"><span class="delimiter">&quot;</span><span class="content">onmouseout</span><span class="delimiter">&quot;</span></span>)));
sb.append(<span class="string"><span class="delimiter">&quot;</span><span class="content">'</span><span class="delimiter">&quot;</span></span>);
writer.writeAttribute(<span class="string"><span class="delimiter">&quot;</span><span class="content">onmouseout</span><span class="delimiter">&quot;</span></span>, sb.toString(), <span class="string"><span class="delimiter">&quot;</span><span class="content">onmouseout</span><span class="delimiter">&quot;</span></span>);
sb = <span class="keyword">new</span> <span class="predefined-type">StringBuffer</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">document.forms[0]['</span><span class="delimiter">&quot;</span></span>).append(targetImageId).
        append(<span class="string"><span class="delimiter">&quot;</span><span class="content">'].src='</span><span class="delimiter">&quot;</span></span>);
sb.append(
        getURI(context,
        (<span class="predefined-type">String</span>) area.getAttributes().get(<span class="string"><span class="delimiter">&quot;</span><span class="content">onmouseover</span><span class="delimiter">&quot;</span></span>)));
sb.append(<span class="string"><span class="delimiter">&quot;</span><span class="content">'</span><span class="delimiter">&quot;</span></span>);
writer.writeAttribute(<span class="string"><span class="delimiter">&quot;</span><span class="content">onmouseover</span><span class="delimiter">&quot;</span></span>, sb.toString(), <span class="string"><span class="delimiter">&quot;</span><span class="content">onmouseover</span><span class="delimiter">&quot;</span></span>);
sb = <span class="keyword">new</span> <span class="predefined-type">StringBuffer</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">document.forms[0]['</span><span class="delimiter">&quot;</span></span>);
sb.append(getName(context, area));
sb.append(<span class="string"><span class="delimiter">&quot;</span><span class="content">'].value='</span><span class="delimiter">&quot;</span></span>);
sb.append(iarea.getAlt());
sb.append(<span class="string"><span class="delimiter">&quot;</span><span class="content">'; document.forms[0].submit()</span><span class="delimiter">&quot;</span></span>);
writer.writeAttribute(<span class="string"><span class="delimiter">&quot;</span><span class="content">onclick</span><span class="delimiter">&quot;</span></span>, sb.toString(), <span class="string"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>);
writer.endElement(<span class="string"><span class="delimiter">&quot;</span><span class="content">area</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>By submitting the page, this code causes the Jakarta Faces lifecycle to return back to the Restore View phase.
This phase saves any state information, including the value of the hidden field, so that a new request component tree is constructed.
This value is retrieved by the <code>decode</code> method of the <code>MapComponent</code> class.
This decode method is called by the Jakarta Faces implementation during the Apply Request Values phase, which follows the Restore View phase.</p>
</div>
<div class="paragraph">
<p>In addition to the <code>encodeEnd</code> method, <code>AreaRenderer</code> contains an empty constructor.
This is used to create an instance of <code>AreaRenderer</code> so that it can be added to the render kit.</p>
</div>
<div class="paragraph">
<p>The <code>@FacesRenderer</code> annotation registers the renderer class with the Jakarta Faces implementation as a renderer class.
The annotation identifies the component family as well as the renderer type.</p>
</div>
</div>
<div class="sect3">
<h4 id="identifying-the-renderer-type"><a class="anchor" href="#identifying-the-renderer-type"></a>Identifying the Renderer Type</h4>
<div class="paragraph">
<p>Register the renderer with a render kit by using the <code>@FacesRenderer</code> annotation (or by using the application configuration resource file, as explained in <a href="#registering-a-custom-renderer-with-a-render-kit">Registering a Custom Renderer with a Render Kit</a>).
During the Render Response phase, the Jakarta Faces implementation calls the <code>getRendererType</code> method of the component&#8217;s tag handler to determine which renderer to invoke, if there is one.</p>
</div>
<div class="paragraph">
<p>You identify the type associated with the renderer in the <code>rendererType</code> element of the <code>@FacesRenderer</code> annotation for <code>AreaRenderer</code> as well as in the <code>renderer-type</code> element of the tag library descriptor.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="implementing-an-event-listener"><a class="anchor" href="#implementing-an-event-listener"></a>Implementing an Event Listener</h3>
<div class="paragraph">
<p>The Jakarta Faces technology supports action events and value-change events for components.</p>
</div>
<div class="paragraph">
<p>Action events occur when the user activates a component that implements <code>jakarta.faces.component.ActionSource</code>.
These events are represented by the class <code>jakarta.faces.event.ActionEvent</code>.</p>
</div>
<div class="paragraph">
<p>Value-change events occur when the user changes the value of a component that implements <code>jakarta.faces.component.EditableValueHolder</code>.
These events are represented by the class <code>jakarta.faces.event.ValueChangeEvent</code>.</p>
</div>
<div class="paragraph">
<p>One way to handle events is to implement the appropriate listener classes.
Listener classes that handle the action events in an application must implement the interface <code>jakarta.faces.event.ActionListener</code>.
Similarly, listeners that handle the value-change events must implement the interface <code>jakarta.faces.event.ValueChangeListener</code>.</p>
</div>
<div class="paragraph">
<p>This section explains how to implement the two listener classes.</p>
</div>
<div class="paragraph">
<p>To handle events generated by custom components, you must implement an event listener and an event handler and manually queue the event on the component.
See <a href="#handling-events-for-custom-components">Handling Events for Custom Components</a> for more information.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You do not need to create an <code>ActionListener</code> implementation to handle an event that results solely in navigating to a page and does not perform any other application-specific processing.
See <a href="#writing-a-method-to-handle-navigation">Writing a Method to Handle Navigation</a> for information on how to manage page navigation.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="implementing-value-change-listeners"><a class="anchor" href="#implementing-value-change-listeners"></a>Implementing Value-Change Listeners</h4>
<div class="paragraph">
<p>A <code>jakarta.faces.event.ValueChangeListener</code> implementation must include a <code>processValueChange(ValueChangeEvent)</code> method.
This method processes the specified value-change event and is invoked by the Jakarta Faces implementation when the value-change event occurs.
The <code>ValueChangeEvent</code> instance stores the old and the new values of the component that fired the event.</p>
</div>
<div class="paragraph">
<p>In the Duke&#8217;s Bookstore case study, the <code>NameChanged</code> listener implementation is registered on the <code>name</code> <code>UIInput</code> component on the <code>bookcashier.xhtml</code> page.
This listener stores into session scope the name the user entered in the field corresponding to the name component.</p>
</div>
<div class="paragraph">
<p>The <code>bookreceipt.xhtml</code> subsequently retrieves the name from the session scope:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:outputFormat</span> <span class="attribute-name">title</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">thanks</span><span class="delimiter">&quot;</span></span>
                <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{bundle.ThankYouParam}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;f:param</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{sessionScope.name}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/h:outputFormat&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When the <code>bookreceipt.xhtml</code> page is loaded, it displays the name inside the message:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="string"><span class="delimiter">&quot;</span><span class="content">Thank you, {0}, for purchasing your books from us.</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is part of the <code>NameChanged</code> listener implementation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">NameChanged</span> <span class="directive">extends</span> <span class="predefined-type">Object</span> <span class="directive">implements</span> ValueChangeListener {

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> processValueChange(ValueChangeEvent event)
            <span class="directive">throws</span> AbortProcessingException {

        <span class="keyword">if</span> (<span class="predefined-constant">null</span> != event.getNewValue()) {
            FacesContext.getCurrentInstance().getExternalContext().
                getSessionMap().put(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, event.getNewValue());
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When the user enters the name in the field, a value-change event is generated, and the <code>processValueChange(ValueChangeEvent)</code> method of the <code>NameChanged</code> listener implementation is invoked.
This method first gets the ID of the component that fired the event from the <code>ValueChangeEvent</code> object, and it puts the value, along with an attribute name, into the session map of the <code>FacesContext</code> instance.</p>
</div>
<div class="paragraph">
<p><a href="#registering-a-value-change-listener-on-a-component">Registering a Value-Change Listener on a Component</a> explains how to
register this listener onto a component.</p>
</div>
</div>
<div class="sect3">
<h4 id="implementing-action-listeners"><a class="anchor" href="#implementing-action-listeners"></a>Implementing Action Listeners</h4>
<div class="paragraph">
<p>A <code>jakarta.faces.event.ActionListener</code> implementation must include a <code>processAction(ActionEvent)</code> method.
The <code>processAction(ActionEvent)</code> method processes the specified action event.
The Jakarta Faces implementation invokes the <code>processAction(ActionEvent)</code> method when the <code>ActionEvent</code> occurs.</p>
</div>
<div class="paragraph">
<p>The Duke&#8217;s Bookstore case study uses two <code>ActionListener</code> implementations, <code>LinkBookChangeListener</code> and <code>MapBookChangeListener</code>.
See <a href="#handling-events-for-custom-components">Handling Events for Custom Components</a> for details on <code>MapBookChangeListener</code>.</p>
</div>
<div class="paragraph">
<p><a href="#registering-an-action-listener-on-a-component">Registering an Action Listener on a Component</a> explains how to register this listener onto a component.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="handling-events-for-custom-components"><a class="anchor" href="#handling-events-for-custom-components"></a>Handling Events for Custom Components</h3>
<div class="paragraph">
<p>As explained in <a href="#implementing-an-event-listener">Implementing an Event Listener</a>, events are automatically queued on standard components that fire events.
A custom component, on the other hand, must manually queue events from its <code>decode</code> method if it fires events.</p>
</div>
<div class="paragraph">
<p><a href="#performing-decoding">Performing Decoding</a> explains how to queue an event on <code>MapComponent</code> using its <code>decode</code> method.
This section explains how to write the class that represents the event of clicking on the map and how to write the method that processes this event.</p>
</div>
<div class="paragraph">
<p>As explained in <a href="#understanding-the-facelets-page">Understanding the Facelets Page</a>, the <code>actionListener</code> attribute of the <code>bookstore:map</code> tag points to the <code>MapBookChangeListener</code> class.
The listener class&#8217;s <code>processAction</code> method processes the event of clicking the image map.
Here is the <code>processAction</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> processAction(<span class="predefined-type">ActionEvent</span> actionEvent)
        <span class="directive">throws</span> AbortProcessingException {

    AreaSelectedEvent event = (AreaSelectedEvent) actionEvent;
    <span class="predefined-type">String</span> current = event.getMapComponent().getCurrent();
    FacesContext context = FacesContext.getCurrentInstance();
    <span class="predefined-type">String</span> bookId = books.get(current);
    context.getExternalContext().getSessionMap().put(<span class="string"><span class="delimiter">&quot;</span><span class="content">bookId</span><span class="delimiter">&quot;</span></span>, bookId);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When the Jakarta Faces implementation calls this method, it passes in an <code>ActionEvent</code> object that represents the event generated by clicking on the image map.
Next, it casts it to an <code>AreaSelectedEvent</code> object (see <code><em>tut-install</em>/examples/case-studies/dukes-bookstore/src/java/dukesbookstore/listeners/AreaSelectedEvent.java</code>).
Then this method gets the <code>MapComponent</code> associated with the event.
Next, it gets the value of the <code>MapComponent</code> object&#8217;s <code>current</code> attribute, which indicates the currently selected area.
The method then uses the value of the <code>current</code> attribute to get the book&#8217;s ID value from a <code>HashMap</code> object, which is constructed elsewhere in the <code>MapBookChangeListener</code> class.
Finally, the method places the ID obtained from the <code>HashMap</code> object into the session map for the application.</p>
</div>
<div class="paragraph">
<p>In addition to the method that processes the event, you need the event class itself.
This class is very simple to write; you have it extend <code>ActionEvent</code> and provide a constructor that takes the component on which the event is queued and a method that returns the component.
Here is the <code>AreaSelectedEvent</code> class used with the image map:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">AreaSelectedEvent</span> <span class="directive">extends</span> <span class="predefined-type">ActionEvent</span> {
    <span class="directive">public</span> AreaSelectedEvent(MapComponent map) {
        <span class="local-variable">super</span>(map);
    }
    <span class="directive">public</span> MapComponent getMapComponent() {
        <span class="keyword">return</span> ((MapComponent) getComponent());
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As explained in the section <a href="#creating-custom-component-classes">Creating Custom Component Classes</a>, in order for <code>MapComponent</code> to fire events in the first place, it must implement <code>ActionSource</code>.
Because <code>MapComponent</code> extends <code>UICommand</code>, it also implements <code>ActionSource</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="defining-the-custom-component-tag-in-a-tag-library-descriptor"><a class="anchor" href="#defining-the-custom-component-tag-in-a-tag-library-descriptor"></a>Defining the Custom Component Tag in a Tag Library Descriptor</h3>
<div class="paragraph">
<p>To use a custom tag, you declare it in a Tag Library Descriptor (TLD).
The TLD file defines how the custom tag is used in a Jakarta Faces page.
The web container uses the TLD to validate the tag.
The set of tags that are part of the HTML render kit are defined in the HTML_BASIC TLD, available in the <a href="https://jakarta.ee/specifications/faces/3.0/renderkitdoc/" target="_blank" rel="noopener">Jakarta Faces standard HTML tag library</a>.</p>
</div>
<div class="paragraph">
<p>The TLD file name must end with <code>taglib.xml</code>.
In the Duke&#8217;s Bookstore case study, the custom tags <code>area</code> and <code>map</code> are defined in the file <code>web/WEB-INF/bookstore.taglib.xml</code>.</p>
</div>
<div class="paragraph">
<p>All tag definitions must be nested inside the <code>facelet-taglib</code> element in the TLD.
Each tag is defined by a <code>tag</code> element.
Here are the tag definitions for the <code>area</code> and <code>map</code> components:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;facelet-taglib</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">https://jakarta.ee/xml/ns/jakartaee</span><span class="delimiter">&quot;</span></span>
<span class="attribute-name">...</span><span class="tag">&gt;</span>
    <span class="tag">&lt;namespace&gt;</span>http://dukesbookstore<span class="tag">&lt;/namespace&gt;</span>
    <span class="tag">&lt;tag&gt;</span>
        <span class="tag">&lt;tag-name&gt;</span>area<span class="tag">&lt;/tag-name&gt;</span>
        <span class="tag">&lt;component&gt;</span>
            <span class="tag">&lt;component-type&gt;</span>DemoArea<span class="tag">&lt;/component-type&gt;</span>
            <span class="tag">&lt;renderer-type&gt;</span>DemoArea<span class="tag">&lt;/renderer-type&gt;</span>
        <span class="tag">&lt;/component&gt;</span>
    <span class="tag">&lt;/tag&gt;</span>
    <span class="tag">&lt;tag&gt;</span>
        <span class="tag">&lt;tag-name&gt;</span>map<span class="tag">&lt;/tag-name&gt;</span>
        <span class="tag">&lt;component&gt;</span>
            <span class="tag">&lt;component-type&gt;</span>DemoMap<span class="tag">&lt;/component-type&gt;</span>
            <span class="tag">&lt;renderer-type&gt;</span>DemoMap<span class="tag">&lt;/renderer-type&gt;</span>
        <span class="tag">&lt;/component&gt;</span>
    <span class="tag">&lt;/tag&gt;</span>
<span class="tag">&lt;/facelet-taglib&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>component-type</code> element specifies the name defined in the <code>@FacesComponent</code> annotation, and the <code>renderer-type</code> element specifies the <code>rendererType</code> defined in the <code>@FacesRenderer</code> annotation.</p>
</div>
<div class="paragraph">
<p>The <code>facelet-taglib</code> element must also include a <code>namespace</code> element, which defines the namespace to be specified in pages that use the custom component.
See <a href="#using-a-custom-component">Using a Custom Component</a> for information on specifying the namespace in pages.</p>
</div>
<div class="paragraph">
<p>The TLD file is located in the <code>WEB-INF</code> directory.
In addition, an entry is included in the web deployment descriptor (<code>web.xml</code>) to identify the custom tag library descriptor file, as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">    <span class="tag">&lt;context-param&gt;</span>
        <span class="tag">&lt;param-name&gt;</span>jakarta.faces.FACELETS_LIBRARIES<span class="tag">&lt;/param-name&gt;</span>
        <span class="tag">&lt;param-value&gt;</span>/WEB-INF/bookstore.taglib.xml<span class="tag">&lt;/param-value&gt;</span>
    <span class="tag">&lt;/context-param&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-a-custom-component"><a class="anchor" href="#using-a-custom-component"></a>Using a Custom Component</h3>
<div class="paragraph">
<p>To use a custom component in a page, you add the custom tag associated with the component to the page.</p>
</div>
<div class="paragraph">
<p>As explained in <a href="#defining-the-custom-component-tag-in-a-tag-library-descriptor">Defining the Custom Component Tag in a Tag Library Descriptor</a>, you must ensure that the TLD that defines any custom tags is packaged in the application if you intend to use the tags in your pages.
TLD files are stored in the <code>WEB-INF/</code> directory or subdirectory of the WAR file or in the <code>META-INF/</code> directory or subdirectory of a tag library packaged in a JAR file.</p>
</div>
<div class="paragraph">
<p>You also need to include a namespace declaration in the page so that the page has access to the tags.
The custom tags for the Duke&#8217;s Bookstore case study are defined in <code>bookstore.taglib.xml</code>.
The <code>ui:composition</code> tag on the <code>index.xhtml</code> page declares the namespace defined in the tag library:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;ui:composition</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/1999/xhtml</span><span class="delimiter">&quot;</span></span>
                <span class="attribute-name">xmlns:ui</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://xmlns.jcp.org/jsf/facelets</span><span class="delimiter">&quot;</span></span>
                <span class="attribute-name">xmlns:h</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://xmlns.jcp.org/jsf/html</span><span class="delimiter">&quot;</span></span>
                <span class="attribute-name">xmlns:f</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://xmlns.jcp.org/jsf/core</span><span class="delimiter">&quot;</span></span>
                <span class="attribute-name">xmlns:bookstore</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://dukesbookstore</span><span class="delimiter">&quot;</span></span>
                <span class="attribute-name">template</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">./bookstoreTemplate.xhtml</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, to use a custom component in a page, you add the component&#8217;s tag to the page.</p>
</div>
<div class="paragraph">
<p>The Duke&#8217;s Bookstore case study includes a custom image map component on the <code>index.xhtml</code> page.
This component allows you to select a book by clicking on a region of the image map:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">...
<span class="tag">&lt;h:graphicImage</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mapImage</span><span class="delimiter">&quot;</span></span>
                <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">book_all.jpg</span><span class="delimiter">&quot;</span></span>
                <span class="attribute-name">library</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">images</span><span class="delimiter">&quot;</span></span>
                <span class="attribute-name">alt</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{bundle.chooseLocale}</span><span class="delimiter">&quot;</span></span>
                <span class="attribute-name">usemap</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#bookMap</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;bookstore:map</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bookMap</span><span class="delimiter">&quot;</span></span>
               <span class="attribute-name">current</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">map1</span><span class="delimiter">&quot;</span></span>
               <span class="attribute-name">immediate</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
               <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bookstore</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;f:actionListener</span>
        <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ee.jakarta.tutorial.dukesbookstore.listeners.MapBookChangeListener</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;bookstore:area</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">map1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{Book201}</span><span class="delimiter">&quot;</span></span>
                    <span class="attribute-name">onmouseover</span>=<span class="string"><span class="delimiter">&quot;</span>resources/images/book_201.jpg<span class="delimiter">&quot;</span></span>
                    <span class="attribute-name">onmouseout</span>=<span class="string"><span class="delimiter">&quot;</span>resources/images/book_all.jpg<span class="delimiter">&quot;</span></span>
                    <span class="attribute-name">targetImage</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mapImage</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    ...
    <span class="tag">&lt;bookstore:area</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">map6</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{Book207}</span><span class="delimiter">&quot;</span></span>
                    <span class="attribute-name">onmouseover</span>=<span class="string"><span class="delimiter">&quot;</span>resources/images/book_207.jpg<span class="delimiter">&quot;</span></span>
                    <span class="attribute-name">onmouseout</span>=<span class="string"><span class="delimiter">&quot;</span>resources/images<span class="comment">//book_all.jpg</span><span class="delimiter">&quot;</span></span>
                    <span class="attribute-name">targetImage</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mapImage</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/bookstore:map&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The standard <code>h:graphicImage</code> tag associates an image (<code>book_all.jpg</code>) with an image map that is referenced in the <code>usemap</code> attribute value.</p>
</div>
<div class="paragraph">
<p>The custom <code>bookstore:map</code> tag that represents the custom component, <code>MapComponent</code>, specifies the image map and contains a set of <code>bookstore:area</code> tags.
Each custom <code>bookstore:area</code> tag represents a custom <code>AreaComponent</code> and specifies a region of the image map.</p>
</div>
<div class="paragraph">
<p>On the page, the <code>onmouseover</code> and <code>onmouseout</code> attributes specify the image that is displayed when the user performs the actions described by the attributes.
The custom renderer also renders an <code>onclick</code> attribute.</p>
</div>
<div class="paragraph">
<p>In the rendered HTML page, the <code>onmouseover</code>, <code>onmouseout</code>, and <code>onclick</code> attributes define which JavaScript code is executed when these events occur.
When the user moves the mouse over a region, the <code>onmouseover</code> function associated with the region displays the map with that region highlighted.
When the user moves the mouse out of a region, the <code>onmouseout</code> function redisplays the original image.
When the user clicks a region, the <code>onclick</code> function sets the value of a hidden <code>input</code> tag to the ID of the selected area and submits the page.</p>
</div>
<div class="paragraph">
<p>When the custom renderer renders these attributes in HTML, it also renders the JavaScript code.
The custom renderer also renders the entire <code>onclick</code> attribute rather than letting the page author set it.</p>
</div>
<div class="paragraph">
<p>The custom renderer that renders the HTML <code>map</code> tag also renders a hidden <code>input</code> component that holds the current area.
The server-side objects retrieve the value of the hidden <code>input</code> field and set the locale in the <code>FacesContext</code> instance according to which region was selected.</p>
</div>
</div>
<div class="sect2">
<h3 id="creating-and-using-a-custom-converter"><a class="anchor" href="#creating-and-using-a-custom-converter"></a>Creating and Using a Custom Converter</h3>
<div class="paragraph">
<p>A Jakarta Faces converter class converts strings to objects and objects to strings as required.
Several standard converters are provided by Jakarta Faces for this purpose.
See <a href="#using-the-standard-converters">Using the Standard Converters</a> for more information on these included converters.</p>
</div>
<div class="paragraph">
<p>As explained in <a href="#conversion-model">Conversion Model</a>, if the standard converters included with Jakarta Faces cannot perform the data conversion that you need, you can create a custom converter to perform this specialized conversion.
This implementation, at a minimum, must define how to convert data both ways between the two views of the data described in <a href="#conversion-model">Conversion Model</a>.</p>
</div>
<div class="paragraph">
<p>All custom converters must implement the <code>jakarta.faces.convert.Converter</code> interface.
This section explains how to implement this interface to perform a custom data conversion.</p>
</div>
<div class="paragraph">
<p>The Duke&#8217;s Bookstore case study uses a custom <code>Converter</code> implementation, located in <code><em>tut-install</em>/examples/case-studies/dukes-bookstore/src/java/dukesbookstore/converters/CreditCardConverter.java</code>, to convert the data entered in the Credit Card Number field on the <code>bookcashier.xhtml</code> page.
It strips blanks and hyphens from the text string and formats it so that a blank space separates every four characters.</p>
</div>
<div class="paragraph">
<p>Another common use case for a custom converter is in a list for a nonstandard object type.
In the Duke&#8217;s Tutoring case study, the <code>Student</code> and <code>Guardian</code> entities require a custom converter so that they can be converted to and from a <code>UISelectItems</code> input component.</p>
</div>
<div class="sect3">
<h4 id="creating-a-custom-converter"><a class="anchor" href="#creating-a-custom-converter"></a>Creating a Custom Converter</h4>
<div class="paragraph">
<p>The <code>CreditCardConverter</code> custom converter class is created as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@FacesConverter</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">ccno</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">CreditCardConverter</span> <span class="directive">implements</span> Converter {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>@FacesConverter</code> annotation registers the custom converter class as a converter with the name of <code>ccno</code> with the Jakarta Faces implementation.
Alternatively, you can register the converter with entries in the application configuration resource file, as shown in <a href="#registering-a-custom-converter">Registering a Custom Converter</a>.</p>
</div>
<div class="paragraph">
<p>To define how the data is converted from the presentation view to the model view, the <code>Converter</code> implementation must implement the <code>getAsObject(FacesContext, UIComponent, String)</code> method from the <code>Converter</code> interface.
Here is the implementation of this method from <code>CreditCardConverter</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Override</span>
<span class="directive">public</span> <span class="predefined-type">Object</span> getAsObject(FacesContext context,
        UIComponent component, <span class="predefined-type">String</span> newValue)
        <span class="directive">throws</span> ConverterException {

    <span class="keyword">if</span> (newValue.isEmpty()) {
        <span class="keyword">return</span> <span class="predefined-constant">null</span>;
    }
    <span class="comment">// Since this is only a String to String conversion,</span>
    <span class="comment">// this conversion does not throw ConverterException.</span>

    <span class="predefined-type">String</span> convertedValue = newValue.trim();
    <span class="keyword">if</span> ( (convertedValue.contains(<span class="string"><span class="delimiter">&quot;</span><span class="content">-</span><span class="delimiter">&quot;</span></span>)) || (convertedValue.contains(<span class="string"><span class="delimiter">&quot;</span><span class="content"> </span><span class="delimiter">&quot;</span></span>))) {
        <span class="type">char</span><span class="type">[]</span> input = convertedValue.toCharArray();
        <span class="predefined-type">StringBuilder</span> builder = <span class="keyword">new</span> <span class="predefined-type">StringBuilder</span>(input.length);
        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="integer">0</span>; i &lt; input.length; ++i) {
            <span class="keyword">if</span> ((input[i] == <span class="string"><span class="delimiter">'</span><span class="content">-</span><span class="delimiter">'</span></span>) || (input[i] == <span class="string"><span class="delimiter">'</span><span class="content"> </span><span class="delimiter">'</span></span>)) {
            } <span class="keyword">else</span> {
                builder.append(input[i]);
            }
        }
        convertedValue = builder.toString();
    }
    <span class="keyword">return</span> convertedValue;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>During the Apply Request Values phase, when the components' <code>decode</code> methods are processed, the Jakarta Faces implementation looks up the component&#8217;s local value in the request and calls the <code>getAsObject</code> method.
When calling this method, the Jakarta Faces implementation passes in the current <code>FacesContext</code> instance, the component whose data needs conversion, and the local value as a <code>String</code>.
The method then writes the local value to a character array, trims the hyphens and blanks, adds the rest of the characters to a <code>String</code>, and returns the <code>String</code>.</p>
</div>
<div class="paragraph">
<p>To define how the data is converted from the model view to the presentation view, the <code>Converter</code> implementation must implement the <code>getAsString(FacesContext, UIComponent, Object)</code> method from the <code>Converter</code> interface.
Here is an implementation of this method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Override</span>
<span class="directive">public</span> <span class="predefined-type">String</span> getAsString(FacesContext context,
        UIComponent component, <span class="predefined-type">Object</span> value)
        <span class="directive">throws</span> ConverterException {

    <span class="predefined-type">String</span> inputVal = <span class="predefined-constant">null</span>;
    <span class="keyword">if</span> ( value == <span class="predefined-constant">null</span> ) {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>;
    }
    <span class="comment">// value must be of a type that can be cast to a String.</span>
    <span class="keyword">try</span> {
        inputVal = (<span class="predefined-type">String</span>)value;
    } <span class="keyword">catch</span> (<span class="exception">ClassCastException</span> ce) {
        FacesMessage errMsg = <span class="keyword">new</span> FacesMessage(CONVERSION_ERROR_MESSAGE_ID);
        FacesContext.getCurrentInstance().addMessage(<span class="predefined-constant">null</span>, errMsg);
        <span class="keyword">throw</span> <span class="keyword">new</span> ConverterException(errMsg.getSummary());
    }
    <span class="comment">// insert spaces after every four characters for better</span>
    <span class="comment">// readability if they are not already present.</span>
    <span class="type">char</span><span class="type">[]</span> input = inputVal.toCharArray();
    <span class="predefined-type">StringBuilder</span> builder = <span class="keyword">new</span> <span class="predefined-type">StringBuilder</span>(input.length + <span class="integer">3</span>);
    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="integer">0</span>; i &lt; input.length; ++i) {
        <span class="keyword">if</span> ((i % <span class="integer">4</span>) == <span class="integer">0</span> &amp;&amp; (i != <span class="integer">0</span>)) {
            <span class="keyword">if</span> ((input[i] != <span class="string"><span class="delimiter">'</span><span class="content"> </span><span class="delimiter">'</span></span>) || (input[i] != <span class="string"><span class="delimiter">'</span><span class="content">-</span><span class="delimiter">'</span></span>)){
                builder.append(<span class="string"><span class="delimiter">&quot;</span><span class="content"> </span><span class="delimiter">&quot;</span></span>);
                <span class="comment">// if there are any &quot;-&quot;'s convert them to blanks.</span>
            } <span class="keyword">else</span> <span class="keyword">if</span> (input[i] == <span class="string"><span class="delimiter">'</span><span class="content">-</span><span class="delimiter">'</span></span>) {
                builder.append(<span class="string"><span class="delimiter">&quot;</span><span class="content"> </span><span class="delimiter">&quot;</span></span>);
            }
         }
         builder.append(input[i]);
    }
    <span class="predefined-type">String</span> convertedValue = builder.toString();
    <span class="keyword">return</span> convertedValue;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>During the Render Response phase, in which the components' <code>encode</code> methods are called, the Jakarta Faces implementation calls the <code>getAsString</code> method in order to generate the appropriate output.
When the Jakarta Faces implementation calls this method, it passes in the current <code>FacesContext</code>, the <code>UIComponent</code> whose value needs to be converted, and the bean value to be converted.
Because this converter does a <code>String</code>-to-<code>String</code> conversion, this method can cast the bean value to a <code>String</code>.</p>
</div>
<div class="paragraph">
<p>If the value cannot be converted to a <code>String</code>, the method throws an exception, passing an error message from the resource bundle that is registered with the application.
<a href="#registering-application-messages">Registering Application Messages</a> explains how to register custom error messages with the application.</p>
</div>
<div class="paragraph">
<p>If the value can be converted to a <code>String</code>, the method reads the <code>String</code> to a character array and loops through the array, adding a space after every four characters.</p>
</div>
<div class="paragraph">
<p>You can also create a custom converter with a <code>@FacesConverter</code> annotation that specifies the <code>forClass</code> attribute, as shown in the following example from the Duke&#8217;s Tutoring case study:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@FacesConverter</span>(forClass=Guardian.class, value=<span class="string"><span class="delimiter">&quot;</span><span class="content">guardian</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">GuardianConverter</span> <span class="directive">extends</span> EntityConverter <span class="directive">implements</span> Converter { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>forClass</code> attribute registers the converter as the default converter for the <code>Guardian</code> class.
Therefore, whenever that class is specified by a <code>value</code> attribute of an input component, the converter is invoked automatically.</p>
</div>
<div class="paragraph">
<p>A converter class can be a separate Java POJO class, as in the Duke&#8217;s Bookstore case study.
If it needs to access objects defined in a managed bean class, however, it can be a subclass of a Jakarta Faces managed bean, as in the <code>address-book</code> persistence example, in which the converters use an enterprise bean that is injected into the managed bean class.</p>
</div>
</div>
<div class="sect3">
<h4 id="using-a-custom-converter"><a class="anchor" href="#using-a-custom-converter"></a>Using a Custom Converter</h4>
<div class="paragraph">
<p>To apply the data conversion performed by a custom converter to a particular component&#8217;s value, you must do one of the following.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Reference the converter from the component tag&#8217;s <code>converter</code> attribute.</p>
</li>
<li>
<p>Nest an <code>f:converter</code> tag inside the component&#8217;s tag and reference the custom converter from one of the <code>f:converter</code> tag&#8217;s attributes.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you are using the component tag&#8217;s <code>converter</code> attribute, this attribute must reference the <code>Converter</code> implementation&#8217;s identifier or the fully-qualified class name of the converter.
<a href="#creating-and-using-a-custom-converter">Creating and Using a Custom Converter</a> explains how to implement a custom converter.</p>
</div>
<div class="paragraph">
<p>The identifier for the credit card converter class is <code>ccno</code>, the value specified in the <code>@FacesConverter</code> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@FacesConverter</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">ccno</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">CreditCardConverter</span> <span class="directive">implements</span> Converter {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Therefore, the <code>CreditCardConverter</code> instance can be registered on the <code>ccno</code> component as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:inputText</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ccno</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">19</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">converter</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ccno</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{cashierBean.creditCardNumber}</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">required</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">requiredMessage</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{bundle.ReqCreditCard}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    ...
<span class="tag">&lt;/h:inputText&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>By setting the <code>converter</code> attribute of a component&#8217;s tag to the converter&#8217;s identifier or its class name, you cause that component&#8217;s local value to be automatically converted according to the rules specified in the <code>Converter</code> implementation.</p>
</div>
<div class="paragraph">
<p>Instead of referencing the converter from the component tag&#8217;s <code>converter</code> attribute, you can reference the converter from an <code>f:converter</code> tag nested inside the component&#8217;s tag.
To reference the custom converter using the <code>f:converter</code> tag, you do one of the following.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Set the <code>f:converter</code> tag&#8217;s <code>converterId</code> attribute to the <code>Converter</code> implementation&#8217;s identifier defined in the <code>@FacesConverter</code> annotation or in the application configuration resource file.
This method is shown in <code>bookcashier.xhtml</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:inputText</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ccno</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">19</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{cashierBean.creditCardNumber}</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">required</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">requiredMessage</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{bundle.ReqCreditCard}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;f:converter</span> <span class="attribute-name">converterId</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ccno</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;f:validateRegex</span>
       <span class="attribute-name">pattern</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">\d{16}|\d{4} \d{4} \d{4} \d{4}|\d{4}-\d{4}-\d{4}-\d{4}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/h:inputText&gt;</span></code></pre>
</div>
</div>
</li>
<li>
<p>Bind the <code>Converter</code> implementation to a managed bean property using the <code>f:converter</code> tag&#8217;s <code>binding</code> attribute, as described in <a href="#binding-converters-listeners-and-validators-to-managed-bean-properties">Binding Converters, Listeners, and Validators to Managed Bean Properties</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Jakarta Faces implementation calls the converter&#8217;s <code>getAsObject</code> method to strip spaces and hyphens from the input value.
The <code>getAsString</code> method is called when the <code>bookcashier.xhtml</code> page is redisplayed; this happens if the user orders more than $100 worth of books.</p>
</div>
<div class="paragraph">
<p>In the Duke&#8217;s Tutoring case study, each converter is registered as the converter for a particular class.
The converter is automatically invoked whenever that class is specified by a <code>value</code> attribute of an input component.
In the following example, the <code>itemValue</code> attribute calls the converter for the <code>Guardian</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:selectManyListbox</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">selectGuardiansMenu</span><span class="delimiter">&quot;</span></span>
                     <span class="attribute-name">title</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{bundle['action.add.guardian']}</span><span class="delimiter">&quot;</span></span>
                     <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{guardianManager.selectedGuardians}</span><span class="delimiter">&quot;</span></span>
                     <span class="attribute-name">size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">5</span><span class="delimiter">&quot;</span></span>
                     <span class="attribute-name">converter</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">guardian</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;f:selectItems</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{guardianManager.allGuardians}</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">var</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">selectedGuardian</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">itemLabel</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{selectedGuardian.name}</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">itemValue</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{selectedGuardian}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/h:selectManyListbox&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="creating-and-using-a-custom-validator"><a class="anchor" href="#creating-and-using-a-custom-validator"></a>Creating and Using a Custom Validator</h3>
<div class="paragraph">
<p>If the standard validators or Bean Validation don&#8217;t perform the validation checking you need, you can create a custom validator to validate user input.
As explained in <a href="#validation-model">Validation Model</a>, there are two ways to implement validation code.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Implement a managed bean method that performs the validation.</p>
</li>
<li>
<p>Provide an implementation of the <code>jakarta.faces.validator.Validator</code> interface to perform the validation.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a href="#writing-a-method-to-perform-validation">Writing a Method to Perform Validation</a> explains how to implement a managed bean method to perform validation.
The rest of this section explains how to implement the <code>Validator</code> interface.</p>
</div>
<div class="paragraph">
<p>If you choose to implement the <code>Validator</code> interface and you want to allow the page author to configure the validator&#8217;s attributes from the page, you also must specify a custom tag for registering the validator on a component.</p>
</div>
<div class="paragraph">
<p>If you prefer to configure the attributes in the <code>Validator</code> implementation, you can forgo specifying a custom tag and instead let the page author register the validator on a component using the <code>f:validator</code> tag, as described in <a href="#using-a-custom-validator">Using a Custom Validator</a>.</p>
</div>
<div class="paragraph">
<p>You can also create a managed bean property that accepts and returns the <code>Validator</code> implementation you create, as described in <a href="#writing-properties-bound-to-converters-listeners-or-validators">Writing Properties Bound to Converters, Listeners, or Validators</a>.
You can use the <code>f:validator</code> tag&#8217;s binding attribute to bind the <code>Validator</code> implementation to the managed bean property.</p>
</div>
<div class="paragraph">
<p>Usually, you will want to display an error message when data fails validation.
You need to store these error messages in a resource bundle.</p>
</div>
<div class="paragraph">
<p>After creating the resource bundle, you have two ways to make the messages available to the application.
You can queue the error messages onto the <code>FacesContext</code> programmatically, or you can register the error messages in the application configuration resource file, as explained in <a href="#registering-application-messages">Registering Application Messages</a>.</p>
</div>
<div class="paragraph">
<p>For example, an e-commerce application might use a general-purpose custom validator called <code>FormatValidator.java</code> to validate input data against a format pattern that is specified in the custom validator tag.
This validator would be used with a Credit Card Number field on a Facelets page.
Here is the custom validator tag:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;mystore:formatValidator</span>
 <span class="attribute-name">formatPatterns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">9999999999999999|9999 9999 9999 9999|9999-9999-9999-9999</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>According to this validator, the data entered in the field must be one of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A 16-digit number with no spaces</p>
</li>
<li>
<p>A 16-digit number with a space between every four digits</p>
</li>
<li>
<p>A 16-digit number with hyphens between every four digits</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>f:validateRegex</code> tag makes a custom validator unnecessary in this situation.
However, the rest of this section describes how this validator would be implemented and how to specify a custom tag so that the page author could register the validator on a component.</p>
</div>
<div class="sect3">
<h4 id="implementing-the-validator-interface"><a class="anchor" href="#implementing-the-validator-interface"></a>Implementing the Validator Interface</h4>
<div class="paragraph">
<p>A <code>Validator</code> implementation must contain a constructor, a set of accessor methods for any attributes on the tag, and a <code>validate</code> method, which overrides the <code>validate</code> method of the <code>Validator</code> interface.</p>
</div>
<div class="paragraph">
<p>The hypothetical <code>FormatValidator</code> class also defines accessor methods for setting the <code>formatPatterns</code> attribute, which specifies the acceptable format patterns for input into the fields.
The setter method calls the <code>parseFormatPatterns</code> method, which separates the components of the pattern string into a string array, <code>formatPatternsList</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="predefined-type">String</span> getFormatPatterns() {
    <span class="keyword">return</span> (<span class="local-variable">this</span>.formatPatterns);
}
<span class="directive">public</span> <span class="type">void</span> setFormatPatterns(<span class="predefined-type">String</span> formatPatterns) {
    <span class="local-variable">this</span>.formatPatterns = formatPatterns;
    parseFormatPatterns();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition to defining accessor methods for the attributes, the class overrides the <code>validate</code> method of the <code>Validator</code> interface.
This method validates the input and also accesses the custom error messages to be displayed when the <code>String</code> is invalid.</p>
</div>
<div class="paragraph">
<p>The <code>validate</code> method performs the actual validation of the data.
It takes the <code>FacesContext</code> instance, the component whose data needs to be validated, and the value that needs to be validated.
A validator can validate only data of a component that implements <code>jakarta.faces.component.EditableValueHolder</code>.</p>
</div>
<div class="paragraph">
<p>Here is an implementation of the <code>validate</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@FacesValidator</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">FormatValidator</span> <span class="directive">implements</span> <span class="predefined-type">Validator</span>, StateHolder {
    ...
    public <span class="type">void</span> validate(FacesContext context, UIComponent component,
                         <span class="predefined-type">Object</span> toValidate) {

        <span class="type">boolean</span> valid = <span class="predefined-constant">false</span>;
        <span class="predefined-type">String</span> value = <span class="predefined-constant">null</span>;
        <span class="keyword">if</span> ((context == <span class="predefined-constant">null</span>) || (component == <span class="predefined-constant">null</span>)) {
            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">NullPointerException</span>();
        }
        <span class="keyword">if</span> (!(component <span class="keyword">instanceof</span> UIInput)) {
            <span class="keyword">return</span>;
        }
        <span class="keyword">if</span> ( <span class="predefined-constant">null</span> == formatPatternsList || <span class="predefined-constant">null</span> == toValidate) {
            <span class="keyword">return</span>;
        }
        value = toValidate.toString();
        <span class="comment">// validate the value against the list of valid patterns.</span>
        <span class="predefined-type">Iterator</span> patternIt = formatPatternsList.iterator();
        <span class="keyword">while</span> (patternIt.hasNext()) {
            valid = isFormatValid(
                ((<span class="predefined-type">String</span>)patternIt.next()), value);
            <span class="keyword">if</span> (valid) {
                <span class="keyword">break</span>;
            }
        }
        <span class="keyword">if</span> ( !valid ) {
            FacesMessage errMsg =
                <span class="keyword">new</span> FacesMessage(FORMAT_INVALID_MESSAGE_ID);
            FacesContext.getCurrentInstance().addMessage(<span class="predefined-constant">null</span>, errMsg);
            <span class="keyword">throw</span> <span class="keyword">new</span> ValidatorException(errMsg);
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>@FacesValidator</code> annotation registers the <code>FormatValidator</code> class as a validator with the Jakarta Faces implementation.
The <code>validate</code> method gets the local value of the component and converts it to a <code>String</code>.
It then iterates over the <code>formatPatternsList</code> list, which is the list of acceptable patterns that was parsed from the <code>formatPatterns</code> attribute of the custom validator tag.</p>
</div>
<div class="paragraph">
<p>While iterating over the list, this method checks the pattern of the component&#8217;s local value against the patterns in the list.
If the pattern of the local value does not match any pattern in the list, this method generates an error message.
It then creates a <code>jakarta.faces.application.FacesMessage</code> and queues it on the <code>FacesContext</code> for display, using a <code>String</code> that represents the key in the <code>Properties</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> FORMAT_INVALID_MESSAGE_ID =
     <span class="string"><span class="delimiter">&quot;</span><span class="content">FormatInvalid</span><span class="delimiter">&quot;</span></span>;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, the method passes the message to the constructor of <code>jakarta.faces.validator.ValidatorException</code>.</p>
</div>
<div class="paragraph">
<p>When the error message is displayed, the format pattern will be substituted for the <code>{0}</code> in the error message, which, in English, is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Input must match one of the following patterns: {<span class="integer">0</span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You may wish to save and restore state for your validator, although state saving is not usually necessary.
To do so, you will need to implement the <code>StateHolder</code> interface as well as the <code>Validator</code> interface.
To implement <code>StateHolder</code>, you would need to implement its four methods: <code>saveState(FacesContext)</code>, <code>restoreState(FacesContext, Object)</code>, <code>isTransient</code>, and <code>setTransient(boolean)</code>.
See <a href="#saving-and-restoring-state">Saving and Restoring State</a> for more information.</p>
</div>
</div>
<div class="sect3">
<h4 id="specifying-a-custom-tag"><a class="anchor" href="#specifying-a-custom-tag"></a>Specifying a Custom Tag</h4>
<div class="paragraph">
<p>If you implemented a <code>Validator</code> interface rather than implementing a managed bean method that performs the validation, you need to do one of the following.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Allow the page author to specify the <code>Validator</code> implementation to use with the <code>f:validator</code> tag.
In this case, the <code>Validator</code> implementation must define its own properties.
<a href="#using-a-custom-validator">Using a Custom Validator</a> explains how to use the <code>f:validator</code> tag.</p>
</li>
<li>
<p>Specify a custom tag that provides attributes for configuring the properties of the validator from the page.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To create a custom tag, you need to add the tag to the tag library descriptor for the application, <code>bookstore.taglib.xml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;tag&gt;</span>
    <span class="tag">&lt;tag-name&gt;</span>validator<span class="tag">&lt;/tag-name&gt;</span>
    <span class="tag">&lt;validator&gt;</span>
        <span class="tag">&lt;validator-id&gt;</span>formatValidator<span class="tag">&lt;/validator-id&gt;</span>
        <span class="tag">&lt;validator-class&gt;</span>
            dukesbookstore.validators.FormatValidator
        <span class="tag">&lt;/validator-class&gt;</span>
    <span class="tag">&lt;/validator&gt;</span>
<span class="tag">&lt;/tag&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>tag-name</code> element defines the name of the tag as it must be used in a Facelets page.
The <code>validator-id</code> element identifies the custom validator.
The <code>validator-class</code> element wires the custom tag to its implementation class.</p>
</div>
<div class="paragraph">
<p><a href="#using-a-custom-validator">Using a Custom Validator</a> explains how to use the custom validator tag on the page.</p>
</div>
</div>
<div class="sect3">
<h4 id="using-a-custom-validator"><a class="anchor" href="#using-a-custom-validator"></a>Using a Custom Validator</h4>
<div class="paragraph">
<p>To register a custom validator on a component, you must do one of the following.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Nest the validator&#8217;s custom tag inside the tag of the component whose value you want to be validated.</p>
</li>
<li>
<p>Nest the standard <code>f:validator</code> tag within the tag of the component and reference the custom <code>Validator</code> implementation from the <code>f:validator</code> tag.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Here is a hypothetical custom <code>formatValidator</code> tag for the Credit Card Number field, nested within the <code>h:inputText</code> tag:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:inputText</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ccno</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">19</span><span class="delimiter">&quot;</span></span>
  <span class="attribute-name">...</span>
  <span class="attribute-name">required</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;mystore:formatValidator</span>
  <span class="attribute-name">formatPatterns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">9999999999999999|9999 9999 9999 9999|9999-9999-9999-9999</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/h:inputText&gt;</span>
<span class="tag">&lt;h:message</span> <span class="attribute-name">styleClass</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">validationMessage</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">for</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ccno</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This tag validates the input of the <code>ccno</code> field against the patterns defined by the page author in the <code>formatPatterns</code> attribute.</p>
</div>
<div class="paragraph">
<p>You can use the same custom validator for any similar component by simply nesting the custom validator tag within the component tag.</p>
</div>
<div class="paragraph">
<p>If the application developer who created the custom validator prefers to configure the attributes in the <code>Validator</code> implementation rather than allow the page author to configure the attributes from the page, the developer will not create a custom tag for use with the validator.</p>
</div>
<div class="paragraph">
<p>In this case, the page author must nest the <code>f:validator</code> tag inside the tag of the component whose data needs to be validated.
Then the page author needs to do one of the following.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Set the <code>f:validator</code> tag&#8217;s <code>validatorId</code> attribute to the ID of the validator that is defined in the application configuration resource file.</p>
</li>
<li>
<p>Bind the custom <code>Validator</code> implementation to a managed bean property using the <code>f:validator</code> tag&#8217;s <code>binding</code> attribute, as described in <a href="#binding-converters-listeners-and-validators-to-managed-bean-properties">Binding Converters, Listeners, and Validators to Managed Bean Properties</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following tag registers a hypothetical validator on a component using an <code>f:validator</code> tag and references the ID of the validator:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:inputText</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{CustomerBean.name}</span><span class="delimiter">&quot;</span></span>
            <span class="attribute-name">size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">...</span><span class="tag">&gt;</span>
    <span class="tag">&lt;f:validator</span> <span class="attribute-name">validatorId</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">customValidator</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    ...
<span class="tag">&lt;/h:inputText&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="binding-component-values-and-instances-to-managed-bean-properties"><a class="anchor" href="#binding-component-values-and-instances-to-managed-bean-properties"></a>Binding Component Values and Instances to Managed Bean Properties</h3>
<div class="paragraph">
<p>A component tag can wire its data to a managed bean by one of the following methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Binding its component&#8217;s value to a bean property</p>
</li>
<li>
<p>Binding its component&#8217;s instance to a bean property</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To bind a component&#8217;s value to a managed bean property, a component tag&#8217;s <code>value</code> attribute uses an EL value expression.
To bind a component instance to a bean property, a component tag&#8217;s <code>binding</code> attribute uses a value expression.</p>
</div>
<div class="paragraph">
<p>When a component instance is bound to a managed bean property, the property holds the component&#8217;s local value.
Conversely, when a component&#8217;s value is bound to a managed bean property, the property holds the value stored in the managed bean.
This value is updated with the local value during the Update Model Values phase of the lifecycle.
There are advantages to both of these methods.</p>
</div>
<div class="paragraph">
<p>Binding a component instance to a bean property has the following advantages.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The managed bean can programmatically modify component attributes.</p>
</li>
<li>
<p>The managed bean can instantiate components rather than let the page author do so.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Binding a component&#8217;s value to a bean property has the following advantages.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The page author has more control over the component attributes.</p>
</li>
<li>
<p>The managed bean has no dependencies on the Jakarta Faces API (such as the component classes), allowing for greater separation of the presentation layer from the model layer.</p>
</li>
<li>
<p>The Jakarta Faces implementation can perform conversions on the data based on the type of the bean property without the developer needing to apply a converter.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In most situations, you will bind a component&#8217;s value rather than its instance to a bean property.
You&#8217;ll need to use a component binding only when you need to change one of the component&#8217;s attributes dynamically.
For example, if an application renders a component only under certain conditions, it can set the component&#8217;s <code>rendered</code> property accordingly by accessing the property to which the component is bound.</p>
</div>
<div class="paragraph">
<p>When referencing the property using the component tag&#8217;s <code>value</code> attribute, you need to use the proper syntax.
For example, suppose a managed bean called <code>MyBean</code> has this <code>int</code> property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">protected</span> <span class="type">int</span> currentOption = <span class="predefined-constant">null</span>;
<span class="directive">public</span> <span class="type">int</span> getCurrentOption(){...}
<span class="directive">public</span> <span class="type">void</span> setCurrentOption(<span class="type">int</span> option){...}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>value</code> attribute that references this property must have this value-binding expression:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="error">#</span>{myBean.currentOption}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition to binding a component&#8217;s value to a bean property, the <code>value</code> attribute can specify a literal value or can map the component&#8217;s data to any primitive (such as <code>int</code>), structure (such as an array), or collection (such as a list), independent of a JavaBeans component.
<a href="#examples-of-value-binding-expressions">Table 15-3</a> lists some example value-binding expressions that you can use with the <code>value</code> attribute.</p>
</div>
<table id="examples-of-value-binding-expressions" class="tableblock frame-all grid-all" style="width: 60%;">
<caption class="title">Table 15-3 Examples of Value-Binding Expressions</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Expression</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">A Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cart.numberOfItems &gt; 0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">A property initialized from a context initialization parameter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>initParam.quantity</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">A bean property</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cashierBean.name</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">A value in an array</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>books[3]</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">A value in a collection</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>books["fiction"]</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">A property of an object in an array of objects</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>books[3].price</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The next two sections explain how to use the <code>value</code> attribute to bind a component&#8217;s value to a bean property or other data objects and how to use the <code>binding</code> attribute to bind a component instance to a bean property.</p>
</div>
<div class="sect3">
<h4 id="binding-a-component-value-to-a-property"><a class="anchor" href="#binding-a-component-value-to-a-property"></a>Binding a Component Value to a Property</h4>
<div class="paragraph">
<p>To bind a component&#8217;s value to a managed bean property, you specify the name of the bean and the property using the <code>value</code> attribute.</p>
</div>
<div class="paragraph">
<p>This means that the first part of the EL value expression must match the name of the managed bean up to the first period (<code>.</code>) and the part of the value expression after the period must match the property of the managed bean.</p>
</div>
<div class="paragraph">
<p>For example, in the Duke&#8217;s Bookstore case study, the <code>h:dataTable</code> tag in <code>bookcatalog.xhtml</code> sets the value of the component to the value of the <code>books</code> property of the <code>BookstoreBean</code> backing bean, whose name is <code>store</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:dataTable</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">books</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{store.books}</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">var</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">book</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">headerClass</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">list-header</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">styleClass</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">list-background</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">rowClasses</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">list-row-even, list-row-odd</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">border</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">summary</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{bundle.BookCatalog}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The value is obtained by calling the backing bean&#8217;s <code>getBooks</code> method, which in turn calls the <code>BookRequestBean</code> session bean&#8217;s <code>getBooks</code> method.</p>
</div>
<div class="paragraph">
<p>If you use the application configuration resource file to configure managed beans instead of defining them in managed bean classes, the name of the bean in the <code>value</code> expression must match the <code>managed-bean-name</code> element of the managed bean declaration up to the first period (<code>.</code>) in the expression.
Similarly, the part of the value expression after the period must match the name specified in the corresponding <code>property-name</code> element in the application configuration resource file.</p>
</div>
<div class="paragraph">
<p>For example, consider this managed bean configuration, which configures the <code>ImageArea</code> bean corresponding to the top-left book in the image map on the <code>index.html</code> page of the Duke&#8217;s Bookstore case study:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;managed-bean</span> <span class="attribute-name">eager</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    ...
    <span class="tag">&lt;managed-bean-name&gt;</span>Book201<span class="tag">&lt;/managed-bean-name&gt;</span>
    <span class="tag">&lt;managed-bean-class&gt;</span>dukesbookstore.model.ImageArea<span class="tag">&lt;/managed-bean-class&gt;</span>
    <span class="tag">&lt;managed-bean-scope&gt;</span>application<span class="tag">&lt;/managed-bean-scope&gt;</span>
    <span class="tag">&lt;managed-property&gt;</span>
        ...
        <span class="tag">&lt;property-name&gt;</span>shape<span class="tag">&lt;/property-name&gt;</span>
        <span class="tag">&lt;value&gt;</span>rect<span class="tag">&lt;/value&gt;</span>
    <span class="tag">&lt;/managed-property&gt;</span>
    <span class="tag">&lt;managed-property&gt;</span>
        ...
        <span class="tag">&lt;property-name&gt;</span>alt<span class="tag">&lt;/property-name&gt;</span>
        <span class="tag">&lt;value&gt;</span>Duke<span class="tag">&lt;/value&gt;</span>
    <span class="tag">&lt;/managed-property&gt;</span>
    ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example configures a bean called <code>Book201</code>, which has several properties, one of which is called <code>shape</code>.</p>
</div>
<div class="paragraph">
<p>Although the <code>bookstore:area</code> tags on the <code>index.xhtml</code> page do not bind to an <code>ImageArea</code> property (they bind to the bean itself), you could refer to the property using a value expression from the <code>value</code> attribute of the component&#8217;s tag:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:outputText</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{Book201.shape}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>See <a href="#configuring-managed-beans">Configuring Managed Beans</a> for information on how to configure beans in the application configuration resource file.</p>
</div>
</div>
<div class="sect3">
<h4 id="binding-a-component-value-to-an-implicit-object"><a class="anchor" href="#binding-a-component-value-to-an-implicit-object"></a>Binding a Component Value to an Implicit Object</h4>
<div class="paragraph">
<p>One external data source that a <code>value</code> attribute can refer to is an implicit object.</p>
</div>
<div class="paragraph">
<p>The <code>bookreceipt.xhtml</code> page of the Duke&#8217;s Bookstore case study has a reference to an implicit object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:outputFormat</span> <span class="attribute-name">title</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">thanks</span><span class="delimiter">&quot;</span></span>
                <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{bundle.ThankYouParam}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;f:param</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{sessionScope.name}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/h:outputFormat&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This tag gets the name of the customer from the session scope and inserts it into the parameterized message at the key <code>ThankYouParam</code> from the resource bundle.
For example, if the name of the customer is Gwen Canigetit, this tag will render:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Thank you, Gwen Canigetit, for purchasing your books from us.</pre>
</div>
</div>
<div class="paragraph">
<p>Retrieving values from other implicit objects is done in a similar way to the example shown in this section.
<a href="#implicit-objects">Table 15-4</a> lists the implicit objects to which a value attribute can refer.
All of the implicit objects, except for the scope objects, are read-only and therefore should not be used as values for a <code>UIInput</code> component.</p>
</div>
<table id="implicit-objects" class="tableblock frame-all grid-all" style="width: 75%;">
<caption class="title">Table 15-4 Implicit Objects</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Implicit Object</th>
<th class="tableblock halign-left valign-top">What It Is</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>applicationScope</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <code>Map</code> of the application scope attribute values, keyed by attribute name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cookie</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <code>Map</code> of the cookie values for the current request, keyed by cookie name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>facesContext</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>FacesContext</code> instance for the current request</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>header</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <code>Map</code> of HTTP header values for the current request, keyed by header name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>headerValues</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <code>Map</code> of <code>String</code> arrays containing all the header values for HTTP headers in the current request, keyed by header name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>initParam</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <code>Map</code> of the context initialization parameters for this web application</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>param</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <code>Map</code> of the request parameters for this request, keyed by parameter name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>paramValues</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <code>Map</code> of <code>String</code> arrays containing all the parameter values for request parameters in the current request, keyed by parameter name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>requestScope</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <code>Map</code> of the request attributes for this request, keyed by attribute name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sessionScope</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <code>Map</code> of the session attributes for this request, keyed by attribute name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>view</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The root <code>UIComponent</code> in the current component tree stored in the <code>FacesRequest</code> for this request</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="binding-a-component-instance-to-a-bean-property"><a class="anchor" href="#binding-a-component-instance-to-a-bean-property"></a>Binding a Component Instance to a Bean Property</h4>
<div class="paragraph">
<p>A component instance can be bound to a bean property using a value expression with the <code>binding</code> attribute of the component&#8217;s tag.
You usually bind a component instance rather than its value to a bean property if the bean must dynamically change the component&#8217;s attributes.</p>
</div>
<div class="paragraph">
<p>Here are two tags from the <code>bookcashier.xhtml</code> page that bind components to bean properties:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:selectBooleanCheckbox</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">fanClub</span><span class="delimiter">&quot;</span></span>
                         <span class="attribute-name">rendered</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>
                         <span class="attribute-name">binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{cashierBean.specialOffer}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;h:outputLabel</span> <span class="attribute-name">for</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">fanClub</span><span class="delimiter">&quot;</span></span>
               <span class="attribute-name">rendered</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>
               <span class="attribute-name">binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{cashierBean.specialOfferText}</span><span class="delimiter">&quot;</span></span>
               <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{bundle.DukeFanClub}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/h:outputLabel&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>h:selectBooleanCheckbox</code> tag renders a check box and binds the <code>fanClub</code> <code>UISelectBoolean</code> component to the <code>specialOffer</code> property of the <code>cashier</code> bean.
The <code>h:outputLabel</code> tag binds the component representing the check box&#8217;s label to the <code>specialOfferText</code> property of the <code>cashier</code> bean.
If the application&#8217;s locale is English, the <code>h:outputLabel</code> tag renders</p>
</div>
<div class="listingblock">
<div class="content">
<pre>I'd like to join the Duke Fan Club, free with my purchase of over $100</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>rendered</code> attributes of both tags are set to <code>false</code> to prevent the check box and its label from being rendered.
If the customer makes a large order and clicks the Submit button, the <code>submit</code> method of <code>CashierBean</code> sets both components' <code>rendered</code> properties to <code>true</code>, causing the check box and its label to be rendered.</p>
</div>
<div class="paragraph">
<p>These tags use component bindings rather than value bindings because the managed bean must dynamically set the values of the components' <code>rendered</code> properties.</p>
</div>
<div class="paragraph">
<p>If the tags were to use value bindings instead of component bindings, the managed bean would not have direct access to the components and would therefore require additional code to access the components from the <code>FacesContext</code> instance to change the components' <code>rendered</code> properties.</p>
</div>
<div class="paragraph">
<p><a href="#writing-properties-bound-to-component-instances">Writing Properties Bound to Component Instances</a> explains how to write the bean properties bound to the example components.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="binding-converters-listeners-and-validators-to-managed-bean-properties"><a class="anchor" href="#binding-converters-listeners-and-validators-to-managed-bean-properties"></a>Binding Converters, Listeners, and Validators to Managed Bean Properties</h3>
<div class="paragraph">
<p>As described in <a href="#adding-components-to-a-page-using-html-tag-library-tags">Adding Components to a Page Using HTML Tag Library Tags</a>, a page author can bind converter, listener, and validator implementations to managed bean properties using the <code>binding</code> attributes of the tags that are used to register the implementations on components.</p>
</div>
<div class="paragraph">
<p>This technique has similar advantages to binding component instances to managed bean properties, as described in <a href="#binding-component-values-and-instances-to-managed-bean-properties">Binding Component Values and Instances to Managed Bean Properties</a>.
In particular, binding a converter, listener, or validator implementation to a managed bean property yields the following benefits.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The managed bean can instantiate the implementation instead of
allowing the page author to do so.</p>
</li>
<li>
<p>The managed bean can programmatically modify the attributes of the implementation.
In the case of a custom implementation, the only other way to modify the attributes outside of the implementation class would be to create a custom tag for it and require the page author to set the attribute values from the page.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Whether you are binding a converter, listener, or validator to a managed bean property, the process is the same for any of the implementations.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Nest the converter, listener, or validator tag within an appropriate component tag.</p>
</li>
<li>
<p>Make sure that the managed bean has a property that accepts and returns the converter, listener, or validator implementation class that you want to bind to the property.</p>
</li>
<li>
<p>Reference the managed bean property using a value expression from the <code>binding</code> attribute of the converter, listener, or validator tag.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, say that you want to bind the standard <code>DateTime</code> converter to a managed bean property because you want to set the formatting pattern of the user&#8217;s input in the managed bean rather than on the Facelets page.
First, the page registers the converter onto the component by nesting the <code>f:convertDateTime</code> tag within the component tag.
Then, the page references the property with the <code>binding</code> attribute of the <code>f:convertDateTime</code> tag:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:inputText</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{loginBean.birthDate}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;f:convertDateTime</span> <span class="attribute-name">binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{loginBean.convertDate}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/h:inputText&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>convertDate</code> property would look something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">private</span> DateTimeConverter convertDate;
<span class="directive">public</span> DateTimeConverter getConvertDate() {
    ...
    return convertDate;
}
<span class="directive">public</span> <span class="type">void</span> setConvertDate(DateTimeConverter convertDate) {
    convertDate.setPattern(<span class="string"><span class="delimiter">&quot;</span><span class="content">EEEEEEEE, MMM dd, yyyy</span><span class="delimiter">&quot;</span></span>);
    <span class="local-variable">this</span>.convertDate = convertDate;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>See <a href="#writing-properties-bound-to-converters-listeners-or-validators">Writing Properties Bound to Converters, Listeners, or Validators</a> for more information on writing managed bean properties for converter, listener, and validator implementations.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuring-jakarta-faces-applications"><a class="anchor" href="#configuring-jakarta-faces-applications"></a>Chapter 16. Configuring Jakarta Faces Applications</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter describes additional configuration tasks required when you create large and complex applications.</p>
</div>
<div class="sect2">
<h3 id="introduction-to-configuring-jakarta-faces-applications"><a class="anchor" href="#introduction-to-configuring-jakarta-faces-applications"></a>Introduction to Configuring Jakarta Faces Applications</h3>
<div class="paragraph">
<p>The process of building and deploying simple Jakarta Faces applications is described in earlier chapters of this tutorial, including <a href="#getting-started-with-web-applications">Chapter 6, <em>Getting Started with Web Applications</em></a>, <a href="#introduction-to-facelets">Chapter 8, <em>Introduction to Facelets</em></a>, <a href="#using-ajax-with-jakarta-faces-technology">Chapter 13, <em>Using Ajax with Jakarta Faces Technology</em></a> and <a href="#composite-components-advanced-topics-and-an-example">Chapter 14, <em>Composite Components: Advanced Topics and an Example</em></a> When you create large and complex applications, however, various additional configuration tasks are required.
These tasks include the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Registering managed beans with the application so that all parts of the application have access to them</p>
</li>
<li>
<p>Configuring managed beans and model beans so that they are instantiated with the proper values when a page makes reference to them</p>
</li>
<li>
<p>Defining navigation rules for each of the pages in the application so that the application has a smooth page flow, if nondefault navigation is needed</p>
</li>
<li>
<p>Packaging the application to include all the pages, resources, and other files so that the application can be deployed on any compliant container</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="using-annotations-to-configure-managed-beans"><a class="anchor" href="#using-annotations-to-configure-managed-beans"></a>Using Annotations to Configure Managed Beans</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In Jakarta Faces 2.3, managed bean annotations are deprecated; CDI is now the preferred approach.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Jakarta Faces support for bean annotations is introduced in <a href="#jakarta-faces-technology">Chapter 7, <em>Jakarta Faces Technology</em></a>.
Bean annotations can be used for configuring Jakarta Faces applications.</p>
</div>
<div class="paragraph">
<p>The <code>@Named</code> (<code>jakarta.inject.Named</code>) annotation in a class, along with a scope annotation, automatically registers that class as a resource with the Jakarta Faces implementation.
A bean that uses these annotations is a CDI managed bean.</p>
</div>
<div class="paragraph">
<p>The following shows the use of the <code>@Named</code> and <code>@SessionScoped</code> annotations in a class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Named</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">cart</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@SessionScoped</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">ShoppingCart</span> ... { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above code snippet shows a bean that is managed by the Jakarta Faces implementation and is available for the length of the session.</p>
</div>
<div class="paragraph">
<p>You can annotate beans with any of the scopes listed in the next section, <a href="#using-managed-bean-scopes">Using Managed Bean Scopes</a>.</p>
</div>
<div class="paragraph">
<p>All classes will be scanned for annotations at startup unless the <code>faces-config</code> element in the <code>faces-config.xml</code> file has the <code>metadata-complete</code> attribute set to <code>true</code>.</p>
</div>
<div class="paragraph">
<p>Annotations are also available for other artifacts, such as components, converters, validators, and renderers, to be used in place of application configuration resource file entries.
These are discussed, along with registration of custom listeners, custom validators, and custom converters, in <a href="#creating-custom-ui-components-and-other-custom-objects">Chapter 15, <em>Creating Custom UI Components and Other Custom Objects</em></a>.</p>
</div>
<div class="sect3">
<h4 id="using-managed-bean-scopes"><a class="anchor" href="#using-managed-bean-scopes"></a>Using Managed Bean Scopes</h4>
<div class="paragraph">
<p>You can use annotations to define the scope in which the bean will be stored.
You can specify one of the following scopes for a bean class.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Application (<code>jakarta.enterprise.context.ApplicationScoped</code>): Application scope persists across all users' interactions with a web application.</p>
</li>
<li>
<p>Session (<code>jakarta.enterprise.context.SessionScoped</code>): Session scope persists across multiple HTTP requests in a web application.</p>
</li>
<li>
<p>Flow (<code>jakarta.faces.flows.FlowScoped</code>): Flow scope persists during a user&#8217;s interaction with a specific flow of a web application.
See <a href="#using-faces-flows">Using Faces Flows</a> for more information.</p>
</li>
<li>
<p>Request (<code>jakarta.enterprise.context.RequestScoped</code>): Request scope persists during a single HTTP request in a web application.</p>
</li>
<li>
<p>Dependent (<code>jakarta.enterprise.context.Dependent</code>): Indicates that the bean depends on some other bean.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You may want to use <code>@Dependent</code> when a managed bean references another managed bean.
The second bean should not be in a scope (<code>@Dependent</code>) if it is supposed to be created only when it is referenced.
If you define a bean as <code>@Dependent</code>, the bean is instantiated anew each time it is referenced, so it does not get saved in any scope.</p>
</div>
<div class="paragraph">
<p>If your managed bean is referenced by the <code>binding</code> attribute of a component tag, you should define the bean with a request scope.
If you placed the bean in session or application scope instead, the bean would need to take precautions to ensure thread safety, because <code>jakarta.faces.component.UIComponent</code> instances each depend on running inside of a single thread.</p>
</div>
<div class="paragraph">
<p>If you are configuring a bean that allows attributes to be associated with the view, you can use the view scope.
The attributes persist until the user has navigated to the next view.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="application-configuration-resource-file"><a class="anchor" href="#application-configuration-resource-file"></a>Application Configuration Resource File</h3>
<div class="paragraph">
<p>Jakarta Faces technology provides a portable configuration format (as an XML document) for configuring application resources.
One or more XML documents, called application configuration resource files, may use this format to register and configure objects and resources and to define navigation rules for applications.
An application configuration resource file is usually named <code>faces-config.xml</code>.</p>
</div>
<div class="paragraph">
<p>You need an application configuration resource file in the following cases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To specify configuration elements for your application that are not available through managed bean annotations, such as localized messages and navigation rules</p>
</li>
<li>
<p>To override managed bean annotations when the application is deployed</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The application configuration resource file must be valid against the XML schema located at <code><a href="https://jakarta.ee/xml/ns/jakartaee/web-facesconfig_3_0.xsd" class="bare">https://jakarta.ee/xml/ns/jakartaee/web-facesconfig_3_0.xsd</a></code>.</p>
</div>
<div class="paragraph">
<p>In addition, each file must include the following information, in the following order:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The XML version number, usually with an <code>encoding</code> attribute:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding='UTF-8'?&gt;</span></code></pre>
</div>
</div>
</li>
<li>
<p>A <code>faces-config</code> tag enclosing all the other declarations:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;faces-config</span> <span class="attribute-name">version</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">3.0</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">https://jakarta.ee/xml/ns/jakartaee</span><span class="delimiter">&quot;</span></span>
              <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
              <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">https://jakarta.ee/xml/ns/jakartaee</span>
              <span class="content">https://jakarta.ee/xml/ns/jakartaee/web-facesconfig_3_0.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    ...
<span class="tag">&lt;/faces-config&gt;</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can have more than one application configuration resource file for an application.
The Jakarta Faces implementation finds the configuration file or files by looking for the following.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A resource named <code>/META-INF/faces-config.xml</code> in any of the JAR files in the web application&#8217;s <code>/WEB-INF/lib/</code> directory and in parent class loaders.
If a resource with this name exists, it is loaded as a configuration resource.
This method is practical for a packaged library containing some components and renderers.
In addition, any file with a name that ends in <code>faces-config.xml</code> is also considered a configuration resource and is loaded as such.</p>
</li>
<li>
<p>A context initialization parameter, <code>jakarta.faces.application.CONFIG_FILES</code>, in your web deployment descriptor file that specifies one or more (comma-delimited) paths to multiple configuration files for your web application.
This method is most often used for enterprise-scale applications that delegate to separate groups the responsibility for maintaining the file for each portion of a big application.</p>
</li>
<li>
<p>A resource named <code>faces-config.xml</code> in the <code>/WEB-INF/</code> directory of your application.
Simple web applications make their configuration files available in this way.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To access the resources registered with the application, an application developer can use an instance of the <code>jakarta.faces.application.Application</code> class, which is automatically created for each application.
The <code>Application</code> instance acts as a centralized factory for resources that are defined in the XML file.</p>
</div>
<div class="paragraph">
<p>When an application starts up, the Jakarta Faces implementation creates a single instance of the <code>Application</code> class and configures it with the information you provided in the application configuration resource file.</p>
</div>
<div class="sect3">
<h4 id="configuring-eager-application-scoped-managed-beans"><a class="anchor" href="#configuring-eager-application-scoped-managed-beans"></a>Configuring Eager Application-Scoped Managed Beans</h4>
<div class="paragraph">
<p>Jakarta Faces managed beans (either specified in the <code>faces-config.xml</code> file or annotated with <code>jakarta.faces.bean.ManagedBean</code>) are lazily instantiated.
That is, that they are instantiated when a request is made from the application.</p>
</div>
<div class="paragraph">
<p>To force an application-scoped bean to be instantiated and placed in the application scope as soon as the application is started and before any request is made, the <code>eager</code> attribute of the managed bean should be set to <code>true</code>, as shown in the following examples.</p>
</div>
<div class="paragraph">
<p>The <code>faces-config.xml</code> file declaration is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;managed-bean</span> <span class="attribute-name">eager</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The annotation is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">@ManagedBean(eager=true)
@ApplicationScoped</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ordering-of-application-configuration-resource-files"><a class="anchor" href="#ordering-of-application-configuration-resource-files"></a>Ordering of Application Configuration Resource Files</h4>
<div class="paragraph">
<p>Because Jakarta Faces technology allows the use of multiple application configuration resource files stored in different locations, the order in which they are loaded by the implementation becomes important in certain situations (for example, when using application-level objects).
This order can be defined through an <code>ordering</code> element and its subelements in the application configuration resource file itself.
The ordering of application configuration resource files can be absolute or relative.</p>
</div>
<div class="paragraph">
<p>Absolute ordering is defined by an <code>absolute-ordering</code> element in the file.
With absolute ordering, the user specifies the order in which application configuration resource files will be loaded.
The following example shows an entry for absolute ordering.</p>
</div>
<div class="paragraph">
<p>File <code>my-faces-config.xml</code> contains the following elements:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;faces-config&gt;</span>
    <span class="tag">&lt;name&gt;</span>myJSF<span class="tag">&lt;/name&gt;</span>
    <span class="tag">&lt;absolute-ordering&gt;</span>
        <span class="tag">&lt;name&gt;</span>A<span class="tag">&lt;/name&gt;</span>
        <span class="tag">&lt;name&gt;</span>B<span class="tag">&lt;/name&gt;</span>
        <span class="tag">&lt;name&gt;</span>C<span class="tag">&lt;/name&gt;</span>
    <span class="tag">&lt;/absolute-ordering&gt;</span>
<span class="tag">&lt;/faces-config&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, A, B, and C are different application configuration resource files and are to be loaded in the listed order.</p>
</div>
<div class="paragraph">
<p>If there is an <code>absolute-ordering</code> element in the file, only the files listed by the subelement <code>name</code> are processed.
To process any other application configuration resource files, an <code>others</code> subelement is required.
In the absence of the <code>others</code> subelement, all other unlisted files will be ignored at load time.</p>
</div>
<div class="paragraph">
<p>Relative ordering is defined by an <code>ordering</code> element and its subelements <code>before</code> and <code>after</code>.
With relative ordering, the order in which application configuration resource files will be loaded is calculated by considering ordering entries from the different files.
The following example shows some of these considerations.
In the following example, <code>config-A</code>, <code>config-B</code>, and <code>config-C</code> are different application configuration resource files.</p>
</div>
<div class="paragraph">
<p>File <code>config-A</code> contains the following elements:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;faces-config&gt;</span>
    <span class="tag">&lt;name&gt;</span>config-A<span class="tag">&lt;/name&gt;</span>
    <span class="tag">&lt;ordering&gt;</span>
        <span class="tag">&lt;before&gt;</span>
            <span class="tag">&lt;name&gt;</span>config-B<span class="tag">&lt;/name&gt;</span>
        <span class="tag">&lt;/before&gt;</span>
    <span class="tag">&lt;/ordering&gt;</span>
<span class="tag">&lt;/faces-config&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>File <code>config-B</code> (not shown here) does not contain any <code>ordering</code> elements.</p>
</div>
<div class="paragraph">
<p>File <code>config-C</code> contains the following elements:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;faces-config&gt;</span>
    <span class="tag">&lt;name&gt;</span>config-C<span class="tag">&lt;/name&gt;</span>
    <span class="tag">&lt;ordering&gt;</span>
        <span class="tag">&lt;after&gt;</span>
            <span class="tag">&lt;name&gt;</span>config-B<span class="tag">&lt;/name&gt;</span>
        <span class="tag">&lt;/after&gt;</span>
    <span class="tag">&lt;/ordering&gt;</span>
<span class="tag">&lt;/faces-config&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Based on the <code>before</code> subelement entry, file <code>config-A</code> will be loaded before the <code>config-B</code> file.
Based on the <code>after</code> subelement entry, file <code>config-C</code> will be loaded after the <code>config-B</code> file.</p>
</div>
<div class="paragraph">
<p>In addition, a subelement <code>others</code> can also be nested within the <code>before</code> and <code>after</code> subelements.
If the <code>others</code> element is present, the specified file may receive highest or lowest preference among both listed and unlisted configuration files.</p>
</div>
<div class="paragraph">
<p>If an <code>ordering</code> element is not present in an application configuration file, then that file will be loaded after all the files that contain <code>ordering</code> elements.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-faces-flows"><a class="anchor" href="#using-faces-flows"></a>Using Faces Flows</h3>
<div class="paragraph">
<p>The Faces Flows feature of Jakarta Faces technology allows you to create a set of pages with a scope, <code>FlowScoped</code>, that is greater than request scope but less than session scope.
For example, you might want to create a series of pages for the checkout process in an online store.
You could create a set of self-contained pages that could be transferred from one store to another as needed.</p>
</div>
<div class="paragraph">
<p>Faces Flows are somewhat analogous to subroutines in procedural programming, in the following ways.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Like a subroutine, a flow has a well defined entry point, list of parameters, and return value.
However, unlike a subroutine, a flow can return multiple values.</p>
</li>
<li>
<p>Like a subroutine, a flow has a scope, allowing information to be available only during the invocation of the flow.
Such information is not available outside the scope of the flow and does not consume any resources once the flow returns.</p>
</li>
<li>
<p>Like a subroutine, a flow may call other flows before returning.
The invocation of flows is maintained in a call stack: a new flow causes a push onto the stack, and a return causes a pop.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An application can have any number of flows.
Each flow includes a set of pages and, usually, one or more managed beans scoped to that flow.
Each flow has a starting point, called a start node, and an exit point, called a return node.</p>
</div>
<div class="paragraph">
<p>The data in a flow is scoped to that flow alone, but you can pass data from one flow to another by specifying parameters and calling the other flow.</p>
</div>
<div class="paragraph">
<p>Flows can be nested, so that if you call one flow from another and then exit the second flow, you return to the calling flow rather than to the second flow&#8217;s return node.</p>
</div>
<div class="paragraph">
<p>You can configure a flow programmatically, by creating a class annotated <code>@FlowDefinition</code>, or you can configure a flow by using a configuration file.
The configuration file can be limited to one flow, or you can use the <code>faces-config.xml</code> file to put all the flows in one place, if you have many flows in an application.
The programmatic configuration places the code closer to the rest of the flow code and enables you to modularize the flows.</p>
</div>
<div class="paragraph">
<p><a href="#two-faces-flows-and-their-interactions">Figure 16-1</a> shows two flows and illustrates how they interact.</p>
</div>
<div id="two-faces-flows-and-their-interactions" class="imageblock">
<div class="content">
<img src="images/jakartaeett_dt_017.svg" alt="This figure shows two Faces flows, Flow A and Flow B. Each has a start node and two additional pages. Each has an associated managed bean. Each defines a return node, and each defines two parameters to be passed to the other flow.">
</div>
<div class="title">Figure 16-1 Two Faces Flows and Their Interactions</div>
</div>
<div class="paragraph">
<p>In this figure, Flow A has a start node named <code>flow-a</code> and two additional pages, <code>next_a1</code> and <code>next_a2</code>.
From <code>next_a2</code>, a user can either exit the flow using the defined return node, <code>taskFlowReturn1</code>, or call Flow B, passing two parameters.
Flow A also defines two inbound parameters that it can accept from Flow B.
Flow B is identical to Flow A except for the names of the flow and files.
Each flow also has an associated managed bean; the beans are <code>Flow_a_Bean</code> and <code>Flow_b_Bean</code>.</p>
</div>
<div class="sect3">
<h4 id="packaging-flows-in-an-application"><a class="anchor" href="#packaging-flows-in-an-application"></a>Packaging Flows in an Application</h4>
<div class="paragraph">
<p>Typically, you package flows in a web application using a directory structure that modularizes the flows.
In the <code>src/main/webapp</code> directory of a Maven project, for example, you would place the Facelets files that are outside the flow at the top level as usual.
Then the <code>webapp</code> files for each flow would be in a separate directory, and the Java files would be under <code>src/main/java</code>.
For example, the files for the application shown in <a href="#two-faces-flows-and-their-interactions">Figure 16-1</a> might look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>src/main/webapp/
    index.xhtml
    return.xhtml
    WEB_INF/
        beans.xml
        web.xml
    flow-a/
        flow-a.xhtml
        next_a1.xhtml
        next_a2.xhtml
    flow-b/
        flow-b-flow.xml
        next_b1.xhtml
        next_b2.xhtml
src/main/java/ee/jakarta/tutorial/flowexample
            FlowA.java
            Flow_a_Bean.java
            Flow_b_Bean.java</pre>
</div>
</div>
<div class="paragraph">
<p>In this example, <code>flow-a</code> is defined programmatically in <code>FlowA.java</code>, while <code>flow-b</code> is defined by the configuration file <code>flow-b-flow.xml</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="the-simplest-possible-flow-the-simple-flow-example-application"><a class="anchor" href="#the-simplest-possible-flow-the-simple-flow-example-application"></a>The Simplest Possible Flow: The simple-flow Example Application</h4>
<div class="paragraph">
<p>The <code>simple-flow</code> example application demonstrates the most basic building blocks of a Faces Flows application and illustrates some of the conventions that make it easy to get started with iterative development using flows.
You may want to start with a simple example like this one and build upon it.</p>
</div>
<div class="paragraph">
<p>This example provides an implicit flow definition by including an empty configuration file.
A configuration file that has content, or a class annotated <code>@FlowDefinition</code>, provides an explicit flow definition.</p>
</div>
<div class="paragraph">
<p>The source code for this application is in the <code><em>tut-install</em>/examples/web/jsf/simple-flow/</code> directory.</p>
</div>
<div class="paragraph">
<p>The file layout of the <code>simple-flow</code> example looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>src/main/webapp
    index.xhtml
    simple-flow-return.xhtml
    WEB_INF/
        web.xml
    simple-flow
        simple-flow-flow.xml
        simple-flow.xhtml
        simple-flow-page2.xhtml</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>simple-flow</code> example has an empty configuration file, which is by convention named flow-name-<code>flow.xml</code>.
The flow does not require any configuration for the following reasons.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The flow does not call another flow, nor does it pass parameters to another flow.</p>
</li>
<li>
<p>The flow uses default names for the first page of the flow, <code><em>flow-name</em>.xhtml</code>, and the return page, <code><em>flow-name</em>-return.xhtml</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This example has only four Facelets pages.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>index.xhtml</code>, the start page, which contains almost nothing but a button that navigates to the first page of the flow:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;p&gt;</span><span class="tag">&lt;h:commandButton</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Enter Flow</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">simple-flow</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span><span class="tag">&lt;/p&gt;</span></code></pre>
</div>
</div>
</li>
<li>
<p><code>simple-flow.xhtml</code> and <code>simple-flow-page2.xhtml</code>, the two pages of the flow itself.
In the absence of an explicit flow definition, the page whose name is the same as the name of the flow is assumed to be the start node of the flow.
In this case, the flow is named <code>simple-flow</code>, so the page named <code>simple-flow.xhtml</code> is assumed to be the start node of the flow.
The start node is the node navigated to upon entry into the flow.
It can be thought of as the home page of the flow.</p>
<div class="paragraph">
<p>The <code>simple-flow.xhtml</code> page asks you to enter a flow-scoped value and provides a button that navigates to the next page of the flow:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;p&gt;</span>Value: <span class="tag">&lt;h:inputText</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">input</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{flowScope.value}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span><span class="tag">&lt;/p&gt;</span>

<span class="tag">&lt;p&gt;</span><span class="tag">&lt;h:commandButton</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Next</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">simple-flow-page2</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span><span class="tag">&lt;/p&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The second page, which can have any name, displays the flow-scoped value and provides a button that navigates to the return page:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;p&gt;</span>Value: #{flowScope.value}<span class="tag">&lt;/p&gt;</span>

<span class="tag">&lt;p&gt;</span><span class="tag">&lt;h:commandButton</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Return</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">simple-flow-return</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span><span class="tag">&lt;/p&gt;</span></code></pre>
</div>
</div>
</li>
<li>
<p><code>simple-flow-return.xhtml</code>, the return page.
The return page, which by convention is named <code><em>flow-name</em>-return.xhtml</code>, must be located outside of the flow.
This page displays the flow-scoped value, to show that it has no value outside of the flow, and provides a link that navigates to the <code>index.xhtml</code> page:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;p&gt;</span>Value (should be empty):
    &quot;<span class="tag">&lt;h:outputText</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">output</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{flowScope.value}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>&quot;<span class="tag">&lt;/p&gt;</span>

<span class="tag">&lt;p&gt;</span><span class="tag">&lt;h:link</span> <span class="attribute-name">outcome</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">index</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Back to Start</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span><span class="tag">&lt;/p&gt;</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Facelets pages use only flow-scoped data, so the example does not need a managed bean.</p>
</div>
<div class="sect4">
<h5 id="to-build-package-and-deploy-the-simple-flow-example-using-netbeans-ide"><a class="anchor" href="#to-build-package-and-deploy-the-simple-flow-example-using-netbeans-ide"></a>To Build, Package, and Deploy the simple-flow Example Using NetBeans IDE</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>From the <strong>File</strong> menu, choose <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the Open Project dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/web/jsf</pre>
</div>
</div>
</li>
<li>
<p>Select the <code>simple-flow</code> folder.</p>
</li>
<li>
<p>Click <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the <strong>Projects</strong> tab, right-click the <code>simple-flow</code> project and select <strong>Build</strong>.</p>
<div class="paragraph">
<p>This command builds and packages the application into a WAR file, <code>simple-flow.war</code>, that is located in the <code>target</code> directory.
It then deploys the application to the server.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-build-package-and-deploy-the-simple-flow-example-using-maven"><a class="anchor" href="#to-build-package-and-deploy-the-simple-flow-example-using-maven"></a>To Build, Package, and Deploy the simple-flow Example Using Maven</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>In a terminal window, go to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/web/jsf/simple-flow/</pre>
</div>
</div>
</li>
<li>
<p>Enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">mvn install</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command builds and packages the application into a WAR file, <code>simple-flow.war</code>, that is located in the <code>target</code> directory.
It then deploys the application to the server.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-run-the-simple-flow-example"><a class="anchor" href="#to-run-the-simple-flow-example"></a>To Run the simple-flow Example</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Enter the following URL in your web browser:</p>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080/simple-flow</pre>
</div>
</div>
</li>
<li>
<p>On the <code>index.xhtml</code> page, click Enter Flow.</p>
</li>
<li>
<p>On the first page of the flow, enter any string in the Value field, then click Next.</p>
</li>
<li>
<p>On the second page of the flow, you can see the value you entered.
Click Return.</p>
</li>
<li>
<p>On the return page, an empty pair of quotation marks encloses the inaccessible value.
Click Back to Start to return to the <code>index.xhtml</code> page.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="the-checkout-module-example-application"><a class="anchor" href="#the-checkout-module-example-application"></a>The checkout-module Example Application</h4>
<div class="paragraph">
<p>The <code>checkout-module</code> example application is considerably more complex than <code>simple-flow</code>.
It shows how you might use the Faces Flows feature to implement a checkout module for an online store.</p>
</div>
<div class="paragraph">
<p>Like the hypothetical example in <a href="#two-faces-flows-and-their-interactions">Figure 16-1</a>, the example application contains two flows, each of which can call the other.
Both flows have explicit flow definitions.
One flow, <code>checkoutFlow</code>, is specified programmatically.
The other flow, <code>joinFlow</code>, is specified in a configuration file.</p>
</div>
<div class="paragraph">
<p>The source code for this application is in the <code><em>tut-install</em>/examples/web/jsf/checkout-module/</code> directory.</p>
</div>
<div class="paragraph">
<p>For the <code>checkout-module</code> application, the directory structure is as follows (there is also a <code>src/main/webapp/resources</code> directory with a stylesheet and an image):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>src/main/webapp/
    index.xhtml
    exithome.xhtml
    WEB_INF/
        beans.xml
        web.xml
    checkoutFlow/
        checkoutFlow.xhtml
        checkoutFlow2.xhtml
        checkoutFlow3.xhtml
        checkoutFlow4.xhtml
    joinFlow/
        joinFlow-flow.xml
        joinFlow.xhtml
        joinFlow2.xhtml
src/main/java/ee/jakarta/tutorial/checkoutmodule
    CheckoutBean.java
    CheckoutFlow.java
    CheckoutFlowBean.java
    JoinFlowBean.java</pre>
</div>
</div>
<div class="paragraph">
<p>For the example, <code>index.xhtml</code> is the beginning page for the application as well as the return node for the checkout flow.
The <code>exithome.xhtml</code> page is the return node for the join flow.</p>
</div>
<div class="paragraph">
<p>The configuration file <code>joinFlow-flow.xml</code> defines the join flow, and the source file <code>CheckoutFlow.java</code> defines the checkout flow.</p>
</div>
<div class="paragraph">
<p>The checkout flow contains four Facelets pages, whereas the join flow contains two.</p>
</div>
<div class="paragraph">
<p>The managed beans scoped to each flow are <code>CheckoutFlowBean.java</code> and <code>JoinFlowBean.java</code>, whereas <code>CheckoutBean.java</code> is the backing bean for the <code>index.html</code> page.</p>
</div>
<div class="sect4">
<h5 id="the-facelets-pages-for-the-checkout-module-example"><a class="anchor" href="#the-facelets-pages-for-the-checkout-module-example"></a>The Facelets Pages for the checkout-module Example</h5>
<div class="paragraph">
<p>The starting page for the example, <code>index.xhtml</code>, summarizes the contents of a hypothetical shopping cart.
It allows the user to click either of two buttons to enter one of the two flows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;p&gt;</span><span class="tag">&lt;h:commandButton</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Check Out</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">checkoutFlow</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span><span class="tag">&lt;/p&gt;</span>
...
<span class="tag">&lt;p&gt;</span><span class="tag">&lt;h:commandButton</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Join</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">joinFlow</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span><span class="tag">&lt;/p&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This page is also the return node for the checkout flow.</p>
</div>
<div class="paragraph">
<p>The Facelets page <code>exithome.xhtml</code> is the return node for the join flow.
This page has a button that allows you to return to the <code>index.xhtml</code> page.</p>
</div>
<div class="paragraph">
<p>The four Facelets pages within the checkout flow, starting with <code>checkoutFlow.xhtml</code> and ending with <code>checkoutFlow4.xhtml</code>, allow you to proceed to the next page or, in some cases, to return from the flow.
The <code>checkoutFlow.xhtml</code> page allows you to access parameters passed from the join flow through the flow scope.
These appear as empty quotation marks if you have not called the checkout flow from the join flow.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;p&gt;</span>If you called this flow from the Join flow, you can see these parameters:
    &quot;<span class="tag">&lt;h:outputText</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{flowScope.param1Value}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>&quot; and
    &quot;<span class="tag">&lt;h:outputText</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{flowScope.param2Value}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>&quot;
<span class="tag">&lt;/p&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Only <code>checkoutFlow2.xhtml</code> has a button to return to the previous page, but moving between pages is generally permitted within flows.
Here are the buttons for <code>checkoutFlow2.xhtml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;p&gt;</span><span class="tag">&lt;h:commandButton</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Continue</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">checkoutFlow3</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span><span class="tag">&lt;/p&gt;</span>
<span class="tag">&lt;p&gt;</span><span class="tag">&lt;h:commandButton</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Go Back</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">checkoutFlow</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span><span class="tag">&lt;/p&gt;</span>
<span class="tag">&lt;p&gt;</span><span class="tag">&lt;h:commandButton</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Exit Flow</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">returnFromCheckoutFlow</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span><span class="tag">&lt;/p&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The action <code>returnFromCheckoutFlow</code> is defined in the configuration source code file, <code>CheckoutFlow.java</code>.</p>
</div>
<div class="paragraph">
<p>The final page of the checkout flow, <code>checkoutFlow4.xhtml</code>, contains a button that calls the join flow:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;p&gt;</span><span class="tag">&lt;h:commandButton</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Join</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">calljoin</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span><span class="tag">&lt;/p&gt;</span>
<span class="tag">&lt;p&gt;</span><span class="tag">&lt;h:commandButton</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Exit Flow</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">returnFromCheckoutFlow</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span><span class="tag">&lt;/p&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>calljoin</code> action is also defined in the configuration source code file, <code>CheckoutFlow.java</code>.
This action enters the join flow, passing two parameters from the checkout flow.</p>
</div>
<div class="paragraph">
<p>The two pages in the join flow, <code>joinFlow.xhtml</code> and <code>joinFlow2.xhtml</code>, are similar to those in the checkout flow.
The second page has a button to call the checkout flow as well as one to return from the join flow:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;p&gt;</span><span class="tag">&lt;h:commandButton</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Check Out</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">callcheckoutFlow</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span><span class="tag">&lt;/p&gt;</span>
<span class="tag">&lt;p&gt;</span><span class="tag">&lt;h:commandButton</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Exit Flow</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">returnFromJoinFlow</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span><span class="tag">&lt;/p&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For this flow, the actions <code>callcheckoutFlow</code> and <code>returnFromJoinFlow</code> are defined in the configuration file <code>joinFlow-flow.xml</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="using-a-configuration-file-to-configure-a-flow"><a class="anchor" href="#using-a-configuration-file-to-configure-a-flow"></a>Using a Configuration File to Configure a Flow</h5>
<div class="paragraph">
<p>If you use an application configuration resource file to configure a flow, it must be named <code><em>flowName</em>-flow.xml</code>.
In this example, the join flow uses a configuration file named <code>joinFlow-flow.xml</code>.
The file is a <code>faces-config</code> file that specifies a <code>flow-definition</code> element.
This element must define the flow name using the <code>id</code> attribute.
Under the <code>flow-definition</code> element, there must be a <code>flow-return</code> element that specifies the return point for the flow.
Any inbound parameters are specified with <code>inbound-parameter</code> elements.
If the flow calls another flow, the <code>call-flow</code> element must use the flow-reference element to name the called flow and may use the <code>outbound-parameter</code> element to specify any outbound parameters.</p>
</div>
<div class="paragraph">
<p>The configuration file for the join flow looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;faces-config</span> <span class="attribute-name">version</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">3.0</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">https://jakarta.ee/xml/ns/jakartaee</span><span class="delimiter">&quot;</span></span>
              <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
              <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">https://jakarta.ee/xml/ns/jakartaee</span>
              <span class="content">https://jakarta.ee/xml/ns/jakartaee/web-facesconfig_3_0.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    <span class="tag">&lt;flow-definition</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">joinFlow</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;flow-return</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">returnFromJoinFlow</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;from-outcome&gt;</span>#{joinFlowBean.returnValue}<span class="tag">&lt;/from-outcome&gt;</span>
        <span class="tag">&lt;/flow-return&gt;</span>

        <span class="tag">&lt;flow-call</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">callcheckoutFlow</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;flow-reference&gt;</span>
                <span class="tag">&lt;flow-id&gt;</span>checkoutFlow<span class="tag">&lt;/flow-id&gt;</span>
            <span class="tag">&lt;/flow-reference&gt;</span>
            <span class="tag">&lt;outbound-parameter&gt;</span>
                <span class="tag">&lt;name&gt;</span>param1FromJoinFlow<span class="tag">&lt;/name&gt;</span>
                <span class="tag">&lt;value&gt;</span>#{&quot;param1 joinFlow value&quot;}<span class="tag">&lt;/value&gt;</span>
            <span class="tag">&lt;/outbound-parameter&gt;</span>
            <span class="tag">&lt;outbound-parameter&gt;</span>
                <span class="tag">&lt;name&gt;</span>param2FromJoinFlow<span class="tag">&lt;/name&gt;</span>
                <span class="tag">&lt;value&gt;</span>#{&quot;param2 joinFlow value&quot;}<span class="tag">&lt;/value&gt;</span>
            <span class="tag">&lt;/outbound-parameter&gt;</span>
        <span class="tag">&lt;/flow-call&gt;</span>
        <span class="tag">&lt;inbound-parameter&gt;</span>
            <span class="tag">&lt;name&gt;</span>param1FromCheckoutFlow<span class="tag">&lt;/name&gt;</span>
            <span class="tag">&lt;value&gt;</span>#{flowScope.param1Value}<span class="tag">&lt;/value&gt;</span>
        <span class="tag">&lt;/inbound-parameter&gt;</span>
        <span class="tag">&lt;inbound-parameter&gt;</span>
            <span class="tag">&lt;name&gt;</span>param2FromCheckoutFlow<span class="tag">&lt;/name&gt;</span>
            <span class="tag">&lt;value&gt;</span>#{flowScope.param2Value}<span class="tag">&lt;/value&gt;</span>
        <span class="tag">&lt;/inbound-parameter&gt;</span>
    <span class="tag">&lt;/flow-definition&gt;</span>
<span class="tag">&lt;/faces-config&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>id</code> attribute of the <code>flow-definition</code> element defines the name of the flow as <code>joinFlow</code>.
The value of the <code>id</code> attribute of the <code>flow-return</code> element identifies the name of the return node, and its value is defined in the <code>from-outcome</code> element as the <code>returnValue</code> property of the flow-scoped managed bean for the join flow, <code>JoinFlowBean</code>.</p>
</div>
<div class="paragraph">
<p>The names and values of the inbound parameters are retrieved from the flow scope in order (<code>flowScope.param1Value</code>, <code>flowScope.param2Value</code>), based on the way they were defined in the checkout flow configuration.</p>
</div>
<div class="paragraph">
<p>The <code>flow-call</code> element defines how the join flow calls the checkout flow.
The <code>id</code> attribute of the element, <code>callcheckoutFlow</code>, defines the action of calling the flow.
Within the <code>flow-call</code> element, the <code>flow-reference</code> element defines the actual name of the flow to call, <code>checkoutFlow</code>.
The <code>outbound-parameter</code> elements define the parameters to be passed when <code>checkoutFlow</code> is called.
Here they are just arbitrary strings.</p>
</div>
</div>
<div class="sect4">
<h5 id="using-a-java-class-to-configure-a-flow"><a class="anchor" href="#using-a-java-class-to-configure-a-flow"></a>Using a Java Class to Configure a Flow</h5>
<div class="paragraph">
<p>If you use a Java class to configure a flow, it must have the name of the flow.
The class for the checkout flow is called <code>CheckoutFlow.java</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">java.io.Serializable</span>;
<span class="keyword">import</span> <span class="include">jakarta.enterprise.inject.Produces</span>;
<span class="keyword">import</span> <span class="include">jakarta.faces.flow.Flow</span>;
<span class="keyword">import</span> <span class="include">jakarta.faces.flow.builder.FlowBuilder</span>;
<span class="keyword">import</span> <span class="include">jakarta.faces.flow.builder.FlowBuilderParameter</span>;
<span class="keyword">import</span> <span class="include">jakarta.faces.flow.builder.FlowDefinition</span>;

<span class="type">class</span> <span class="class">CheckoutFlow</span> <span class="directive">implements</span> <span class="predefined-type">Serializable</span> {

    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="type">long</span> serialVersionUID = <span class="integer">1L</span>;

    <span class="annotation">@Produces</span>
    <span class="annotation">@FlowDefinition</span>
    <span class="directive">public</span> Flow defineFlow(<span class="annotation">@FlowBuilderParameter</span> FlowBuilder flowBuilder) {

        <span class="predefined-type">String</span> flowId = <span class="string"><span class="delimiter">&quot;</span><span class="content">checkoutFlow</span><span class="delimiter">&quot;</span></span>;
        flowBuilder.id(<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>, flowId);
        flowBuilder.viewNode(flowId,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="delimiter">&quot;</span></span> + flowId + <span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="delimiter">&quot;</span></span> + flowId + <span class="string"><span class="delimiter">&quot;</span><span class="content">.xhtml</span><span class="delimiter">&quot;</span></span>).
                markAsStartNode();

        flowBuilder.returnNode(<span class="string"><span class="delimiter">&quot;</span><span class="content">returnFromCheckoutFlow</span><span class="delimiter">&quot;</span></span>).
                fromOutcome(<span class="string"><span class="delimiter">&quot;</span><span class="content">#{checkoutFlowBean.returnValue}</span><span class="delimiter">&quot;</span></span>);

        flowBuilder.inboundParameter(<span class="string"><span class="delimiter">&quot;</span><span class="content">param1FromJoinFlow</span><span class="delimiter">&quot;</span></span>,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">#{flowScope.param1Value}</span><span class="delimiter">&quot;</span></span>);
        flowBuilder.inboundParameter(<span class="string"><span class="delimiter">&quot;</span><span class="content">param2FromJoinFlow</span><span class="delimiter">&quot;</span></span>,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">#{flowScope.param2Value}</span><span class="delimiter">&quot;</span></span>);

        flowBuilder.flowCallNode(<span class="string"><span class="delimiter">&quot;</span><span class="content">calljoin</span><span class="delimiter">&quot;</span></span>).flowReference(<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">joinFlow</span><span class="delimiter">&quot;</span></span>).
                outboundParameter(<span class="string"><span class="delimiter">&quot;</span><span class="content">param1FromCheckoutFlow</span><span class="delimiter">&quot;</span></span>,
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">#{checkoutFlowBean.name}</span><span class="delimiter">&quot;</span></span>).
                outboundParameter(<span class="string"><span class="delimiter">&quot;</span><span class="content">param2FromCheckoutFlow</span><span class="delimiter">&quot;</span></span>,
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">#{checkoutFlowBean.city}</span><span class="delimiter">&quot;</span></span>);
        <span class="keyword">return</span> flowBuilder.getFlow();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The class performs actions that are almost identical to those performed by the configuration file <code>joinFlow-flow.xml</code>.
It contains a single method, <code>defineFlow</code>, as a producer method with the <code>@FlowDefinition</code> qualifier that returns a <code>jakarta.faces.flow.Flow</code> class.
The <code>defineFlow</code> method takes one parameter, a <code>FlowBuilder</code> with the qualifier <code>@FlowBuilderParameter</code>, which is passed in from the Jakarta Faces implementation.
The method then calls methods from the <code>jakarta.faces.flow.Builder.FlowBuilder</code> class to configure the flow.</p>
</div>
<div class="paragraph">
<p>First, the method defines the flow <code>id</code> as <code>checkoutFlow</code>.
Then, it explicitly defines the start node for the flow.
By default, this is the name of the flow with an <code>.xhtml</code> suffix.</p>
</div>
<div class="paragraph">
<p>The method then defines the return node similarly to the way the configuration file does.
The <code>returnNode</code> method sets the name of the return node as <code>returnFromCheckoutFlow</code>, and the chained <code>fromOutcome</code> method specifies its value as the <code>returnValue</code> property of the flow-scoped managed bean for the checkout flow, <code>CheckoutFlowBean</code>.</p>
</div>
<div class="paragraph">
<p>The <code>inboundParameter</code> method sets the names and values of the inbound parameters from the join flow, which are retrieved from the flow scope in order (<code>flowScope.param1Value</code>, <code>flowScope.param2Value</code>), based on the way they were defined in the join flow configuration.</p>
</div>
<div class="paragraph">
<p>The <code>flowCallNode</code> method defines how the checkout flow calls the join flow.
The argument, <code>calljoin</code>, specifies the action of calling the flow.
The chained <code>flowReference</code> method defines the actual name of the flow to call, <code>joinFlow</code>, then calls <code>outboundParameter</code> methods to define the parameters to be passed when <code>joinFlow</code> is called.
Here they are values from the <code>CheckoutFlowBean</code> managed bean.</p>
</div>
<div class="paragraph">
<p>Finally, the <code>defineFlow</code> method calls the <code>getFlow</code> method and returns the result.</p>
</div>
</div>
<div class="sect4">
<h5 id="the-flow-scoped-managed-beans"><a class="anchor" href="#the-flow-scoped-managed-beans"></a>The Flow-Scoped Managed Beans</h5>
<div class="paragraph">
<p>Each of the two flows has a managed bean that defines properties for the pages within the flow.
For example, the <code>CheckoutFlowBean</code> defines properties whose values are entered by the user on both the <code>checkoutFlow.xhtml</code> page and the <code>checkoutFlow3.xhtml</code> page.</p>
</div>
<div class="paragraph">
<p>Each managed bean has a <code>getReturnValue</code> method that sets the value of the return node.
For the <code>CheckoutFlowBean</code>, the return node is the <code>index.xhtml</code> page, specified using implicit navigation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="predefined-type">String</span> getReturnValue() {
    <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">index</span><span class="delimiter">&quot;</span></span>;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For the <code>JoinFlowBean</code>, the return node is the <code>exithome.xhtml</code> page.</p>
</div>
</div>
<div class="sect4">
<h5 id="to-build-package-and-deploy-the-checkout-module-example-using-netbeans-ide"><a class="anchor" href="#to-build-package-and-deploy-the-checkout-module-example-using-netbeans-ide"></a>To Build, Package, and Deploy the checkout-module Example Using NetBeans IDE</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>From the <strong>File</strong> menu, choose <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the Open Project dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/web/jsf</pre>
</div>
</div>
</li>
<li>
<p>Select the <code>checkout-module</code> folder.</p>
</li>
<li>
<p>Click <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the <strong>Projects</strong> tab, right-click the <code>checkout-module</code> project and select <strong>Build</strong>.</p>
<div class="paragraph">
<p>This command builds and packages the application into a WAR file, <code>checkout-module.war</code>, that is located in the <code>target</code> directory.
It then deploys the application to the server.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-build-package-and-deploy-the-checkout-module-example-using-maven"><a class="anchor" href="#to-build-package-and-deploy-the-checkout-module-example-using-maven"></a>To Build, Package, and Deploy the checkout-module Example Using Maven</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>In a terminal window, go to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/web/jsf/checkout-module/</pre>
</div>
</div>
</li>
<li>
<p>Enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">mvn install</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command builds and packages the application into a WAR file, <code>checkout-module.war</code>, that is located in the <code>target</code> directory.
It then deploys the application to the server.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-run-the-checkout-module-example"><a class="anchor" href="#to-run-the-checkout-module-example"></a>To Run the checkout-module Example</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Enter the following URL in your web browser:</p>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080/checkout-module</pre>
</div>
</div>
</li>
<li>
<p>The <code>index.xhtml</code> page presents hypothetical results of the shopping expedition.
Click either Check Out or Join to enter one of the two flows.</p>
</li>
<li>
<p>Follow the flow, providing input as needed and choosing whether to
continue, go back, or exit the flow.</p>
<div class="paragraph">
<p>In the checkout flow, only one of the input fields is validated (the
credit card field expects 16 digits), so you can enter any values you
like.
The join flow does not require you to check any boxes in its
checkbox menus.</p>
</div>
</li>
<li>
<p>On the last page of a flow, select the option to enter the other
flow.
This allows you to view the inbound parameters from the previous
flow.</p>
</li>
<li>
<p>Because flows are nested, if you click Exit Flow from a called flow, you will return to the first page of the calling flow (You may see a warning, which you can ignore).
Click Exit Flow on that page to go to the specified return node.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-managed-beans"><a class="anchor" href="#configuring-managed-beans"></a>Configuring Managed Beans</h3>
<div class="paragraph">
<p>When a page references a managed bean for the first time, the Jakarta Faces implementation initializes it either based on a <code>@Named</code> annotation and scope annotation in the bean class or according to its configuration in the application configuration resource file.
For information on using annotations to initialize beans, see <a href="#using-annotations-to-configure-managed-beans">Using Annotations to Configure Managed Beans</a>.</p>
</div>
<div class="paragraph">
<p>You can use either annotations or the application configuration resource file to instantiate managed beans that are used in a Jakarta Faces application and to store them in scope.
The managed bean creation facility is configured in the application configuration resource file using <code>managed-bean</code> XML elements to define each bean. This file is processed at application startup time.
For information on using this facility, see <a href="#using-the-managed-bean-element">Using the managed-bean Element</a>.</p>
</div>
<div class="paragraph">
<p>Managed beans created in the application configuration resource file are Jakarta Faces managed beans, not CDI managed beans.</p>
</div>
<div class="paragraph">
<p>With the managed bean creation facility, you can</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create beans in one centralized file that is available to the entire application, rather than conditionally instantiate beans throughout the application</p>
</li>
<li>
<p>Customize a bean&#8217;s properties without any additional code</p>
</li>
<li>
<p>Customize a bean&#8217;s property values directly from within the configuration file so that it is initialized with these values when it is created</p>
</li>
<li>
<p>Using <code>value</code> elements, set a property of one managed bean to be the result of evaluating another value expression</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This section shows you how to initialize beans using the managed bean creation facility.
See <a href="#writing-bean-properties">Writing Bean Properties</a> and <a href="#writing-managed-bean-methods">Writing Managed Bean Methods</a> for information on programming managed beans.</p>
</div>
<div class="sect3">
<h4 id="using-the-managed-bean-element"><a class="anchor" href="#using-the-managed-bean-element"></a>Using the managed-bean Element</h4>
<div class="paragraph">
<p>A managed bean is initiated in the application configuration resource file using a <code>managed-bean</code> element, which represents an instance of a bean class that must exist in the application.
At runtime, the Jakarta Faces implementation processes the <code>managed-bean</code> element.
If a page references the bean and no bean instance exists, the Jakarta Faces implementation instantiates the bean as specified by the element configuration.</p>
</div>
<div class="paragraph">
<p>Here is an example managed bean configuration from the Duke&#8217;s Bookstore case study:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;managed-bean</span> <span class="attribute-name">eager</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;managed-bean-name&gt;</span>Book201<span class="tag">&lt;/managed-bean-name&gt;</span>
    <span class="tag">&lt;managed-bean-class&gt;</span>dukesbookstore.model.ImageArea<span class="tag">&lt;/managed-bean-class&gt;</span>
    <span class="tag">&lt;managed-bean-scope&gt;</span>application<span class="tag">&lt;/managed-bean-scope&gt;</span>
    <span class="tag">&lt;managed-property&gt;</span>
        <span class="tag">&lt;property-name&gt;</span>shape<span class="tag">&lt;/property-name&gt;</span>
        <span class="tag">&lt;value&gt;</span>rect<span class="tag">&lt;/value&gt;</span>
    <span class="tag">&lt;/managed-property&gt;</span>
    <span class="tag">&lt;managed-property&gt;</span>
        <span class="tag">&lt;property-name&gt;</span>alt<span class="tag">&lt;/property-name&gt;</span>
        <span class="tag">&lt;value&gt;</span>Duke<span class="tag">&lt;/value&gt;</span>
    <span class="tag">&lt;/managed-property&gt;</span>
    <span class="tag">&lt;managed-property&gt;</span>
        <span class="tag">&lt;property-name&gt;</span>coords<span class="tag">&lt;/property-name&gt;</span>
        <span class="tag">&lt;value&gt;</span>67,23,212,268<span class="tag">&lt;/value&gt;</span>
    <span class="tag">&lt;/managed-property&gt;</span>
<span class="tag">&lt;/managed-bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>managed-bean-name</code> element defines the key under which the bean will be stored in a scope.
For a component&#8217;s value to map to this bean, the component tag&#8217;s <code>value</code> attribute must match the <code>managed-bean-name</code> up to the first period.</p>
</div>
<div class="paragraph">
<p>The <code>managed-bean-class</code> element defines the fully qualified name of the JavaBeans component class used to instantiate the bean.</p>
</div>
<div class="paragraph">
<p>The <code>managed-bean</code> element can contain zero or more <code>managed-property</code> elements, each corresponding to a property defined in the bean class.
These elements are used to initialize the values of the bean properties.
If you don&#8217;t want a particular property initialized with a value when the bean is instantiated, do not include a <code>managed-property</code> definition for it in your application configuration resource file.</p>
</div>
<div class="paragraph">
<p>If a <code>managed-bean</code> element does not contain other <code>managed-bean</code> elements, it can contain one <code>map-entries</code> element or <code>list-entries</code> element.
The <code>map-entries</code> element configures a set of beans that are instances of <code>Map</code>.
The <code>list-entries</code> element configures a set of beans that are instances of <code>List</code>.</p>
</div>
<div class="paragraph">
<p>In the following example, the <code>newsletters</code> managed bean, representing a <code>UISelectItems</code> component, is configured as an <code>ArrayList</code> that represents a set of <code>SelectItem</code> objects.
Each <code>SelectItem</code> object is in turn configured as a managed bean with properties:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;managed-bean&gt;</span>
    <span class="tag">&lt;managed-bean-name&gt;</span>newsletters<span class="tag">&lt;/managed-bean-name&gt;</span>
    <span class="tag">&lt;managed-bean-class&gt;</span>java.util.ArrayList<span class="tag">&lt;/managed-bean-class&gt;</span>
    <span class="tag">&lt;managed-bean-scope&gt;</span>application<span class="tag">&lt;/managed-bean-scope&gt;</span>
    <span class="tag">&lt;list-entries&gt;</span>
        <span class="tag">&lt;value-class&gt;</span>jakarta.faces.model.SelectItem<span class="tag">&lt;/value-class&gt;</span>
        <span class="tag">&lt;value&gt;</span>#{newsletter0}<span class="tag">&lt;/value&gt;</span>
        <span class="tag">&lt;value&gt;</span>#{newsletter1}<span class="tag">&lt;/value&gt;</span>
        <span class="tag">&lt;value&gt;</span>#{newsletter2}<span class="tag">&lt;/value&gt;</span>
        <span class="tag">&lt;value&gt;</span>#{newsletter3}<span class="tag">&lt;/value&gt;</span>
    <span class="tag">&lt;/list-entries&gt;</span>
<span class="tag">&lt;/managed-bean&gt;</span>
<span class="tag">&lt;managed-bean&gt;</span>
    <span class="tag">&lt;managed-bean-name&gt;</span>newsletter0<span class="tag">&lt;/managed-bean-name&gt;</span>
    <span class="tag">&lt;managed-bean-class&gt;</span>jakarta.faces.model.SelectItem<span class="tag">&lt;/managed-bean-class&gt;</span>
    <span class="tag">&lt;managed-bean-scope&gt;</span>none<span class="tag">&lt;/managed-bean-scope&gt;</span>
    <span class="tag">&lt;managed-property&gt;</span>
        <span class="tag">&lt;property-name&gt;</span>label<span class="tag">&lt;/property-name&gt;</span>
        <span class="tag">&lt;value&gt;</span>Duke's Quarterly<span class="tag">&lt;/value&gt;</span>
    <span class="tag">&lt;/managed-property&gt;</span>
    <span class="tag">&lt;managed-property&gt;</span>
        <span class="tag">&lt;property-name&gt;</span>value<span class="tag">&lt;/property-name&gt;</span>
        <span class="tag">&lt;value&gt;</span>200<span class="tag">&lt;/value&gt;</span>
    <span class="tag">&lt;/managed-property&gt;</span>
<span class="tag">&lt;/managed-bean&gt;</span>
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>This approach may be useful for quick-and-dirty creation of selection item lists before a development team has had time to create such lists from the database.
Note that each of the individual newsletter beans has a <code>managed-bean-scope</code> setting of <code>none</code> so that they will not themselves be placed into any scope.</p>
</div>
<div class="paragraph">
<p>See <a href="#initializing-array-and-list-properties">Initializing Array and List Properties</a> for more information on configuring collections as beans.</p>
</div>
<div class="paragraph">
<p>To map to a property defined by a <code>managed-property</code> element, you must ensure that the part of a component tag&#8217;s <code>value</code> expression after the period matches the <code>managed-property</code> element&#8217;s <code>property-name</code> element.
The next section, <a href="#initializing-properties-using-the-managed-property-element">Initializing Properties Using the managed-property Element</a>, explains in more detail how to use the <code>managed-property</code> element.
See <a href="#initializing-managed-bean-properties">Initializing Managed Bean Properties</a> for an example of initializing a managed bean property.</p>
</div>
</div>
<div class="sect3">
<h4 id="initializing-properties-using-the-managed-property-element"><a class="anchor" href="#initializing-properties-using-the-managed-property-element"></a>Initializing Properties Using the managed-property Element</h4>
<div class="paragraph">
<p>A <code>managed-property</code> element must contain a <code>property-name</code> element, which must match the name of the corresponding property in the bean.
A <code>managed-property</code> element must also contain one of a set of elements that defines the value of the property.
This value must be of the same type as that defined for the property in the corresponding bean.
Which element you use to define the value depends on the type of the property defined in the bean.
<a href="#subelements-of-managed-property-elements-that-define-property-values">Table 16-1</a> lists all the elements that are used to initialize a value.</p>
</div>
<table id="subelements-of-managed-property-elements-that-define-property-values" class="tableblock frame-all grid-all" style="width: 75%;">
<caption class="title">Table 16-1 Subelements of managed-property Elements That Define Property Values</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Value It Defines</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>list-entries</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the values in a list</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>map-entries</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the values of a map</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>null-value</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Explicitly sets the property to <code>null</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>value</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines a single value, such as a <code>String</code>, <code>int</code>, or Jakarta Faces EL expression</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><a href="#using-the-managed-bean-element">Using the managed-bean Element</a> includes an example of initializing an <code>int</code> property (a primitive type) using the <code>value</code> subelement.
You also use the <code>value</code> subelement to initialize <code>String</code> and other reference types.
The rest of this section describes how to use the <code>value</code> subelement and other subelements to initialize properties of Java <code>Enum</code> types, <code>Map</code>, <code>array</code>, and <code>Collection</code>, as well as initialization parameters.</p>
</div>
<div class="sect4">
<h5 id="referencing-a-java-enum-type"><a class="anchor" href="#referencing-a-java-enum-type"></a>Referencing a Java Enum Type</h5>
<div class="paragraph">
<p>A managed bean property can also be a Java <code>Enum</code> type (see <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Enum.html" class="bare" target="_blank" rel="noopener">https://docs.oracle.com/javase/8/docs/api/java/lang/Enum.html</a>).
In this case, the <code>value</code> element of the <code>managed-property</code> element must be a <code>String</code> that matches one of the <code>String</code> constants of the <code>Enum</code>.
In other words, the <code>String</code> must be one of the valid values that can be returned if you were to call <code>valueOf(Class, String)</code> on <code>enum</code>, where <code>Class</code> is the <code>Enum</code> class and <code>String</code> is the contents of the <code>value</code> subelement.
For example, suppose the managed bean property is the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">enum</span> Suit { Hearts, Spades, Diamonds, Clubs }
 ...
public Suit getSuit() { ... return Suit.Hearts; }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Assuming you want to configure this property in the application configuration resource file, the corresponding <code>managed-property</code> element looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;managed-property&gt;</span>
    <span class="tag">&lt;property-name&gt;</span>Suit<span class="tag">&lt;/property-name&gt;</span>
    <span class="tag">&lt;value&gt;</span>Hearts<span class="tag">&lt;/value&gt;</span>
<span class="tag">&lt;/managed-property&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When the system encounters this property, it iterates over each of the members of the <code>enum</code> and calls <code>toString()</code> on each member until it finds one that is exactly equal to the value from the <code>value</code> element.</p>
</div>
</div>
<div class="sect4">
<h5 id="referencing-a-context-initialization-parameter"><a class="anchor" href="#referencing-a-context-initialization-parameter"></a>Referencing a Context Initialization Parameter</h5>
<div class="paragraph">
<p>Another powerful feature of the managed bean creation facility is the ability to reference implicit objects from a managed bean property.</p>
</div>
<div class="paragraph">
<p>Suppose you have a page that accepts data from a customer, including the customer&#8217;s address.
Suppose also that most of your customers live in a particular area code.
You can make the area code component render this area code by saving it in an implicit object and referencing it when the page is rendered.</p>
</div>
<div class="paragraph">
<p>You can save the area code as an initial default value in the context <code>initParam</code> implicit object by adding a context parameter to your web application and setting its value in the deployment descriptor.
For example, to set a context parameter called <code>defaultAreaCode</code> to <code>650</code>, add a <code>context-param</code> element to the deployment descriptor and give the parameter the name <code>defaultAreaCode</code> and the value <code>650</code>.</p>
</div>
<div class="paragraph">
<p>Next, write a <code>managed-bean</code> declaration that configures a property that references the parameter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;managed-bean&gt;</span>
    <span class="tag">&lt;managed-bean-name&gt;</span>customer<span class="tag">&lt;/managed-bean-name&gt;</span>
        <span class="tag">&lt;managed-bean-class&gt;</span>CustomerBean<span class="tag">&lt;/managed-bean-class&gt;</span>
        <span class="tag">&lt;managed-bean-scope&gt;</span>request<span class="tag">&lt;/managed-bean-scope&gt;</span>
        <span class="tag">&lt;managed-property&gt;</span>
            <span class="tag">&lt;property-name&gt;</span>areaCode<span class="tag">&lt;/property-name&gt;</span>
                <span class="tag">&lt;value&gt;</span>#{initParam.defaultAreaCode}<span class="tag">&lt;/value&gt;</span>
            <span class="tag">&lt;/managed-property&gt;</span>
            ...
<span class="tag">&lt;/managed-bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To access the area code at the time the page is rendered, refer to the property from the <code>area</code> component tag&#8217;s <code>value</code> attribute:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:inputText</span> <span class="attribute-name">id</span>=<span class="attribute-value">area</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{customer.areaCode}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Values are retrieved from other implicit objects in a similar way.</p>
</div>
</div>
<div class="sect4">
<h5 id="initializing-map-properties"><a class="anchor" href="#initializing-map-properties"></a>Initializing Map Properties</h5>
<div class="paragraph">
<p>The <code>map-entries</code> element is used to initialize the values of a bean property with a type of <code>Map</code> if the <code>map-entries</code> element is used within a <code>managed-property</code> element.
A <code>map-entries</code> element contains an optional <code>key-class</code> element, an optional <code>value-class</code> element, and zero or more <code>map-entry</code> elements.</p>
</div>
<div class="paragraph">
<p>Each of the <code>map-entry</code> elements must contain a <code>key</code> element and either a <code>null-value</code> or <code>value</code> element.
Here is an example that uses the <code>map-entries</code> element:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;managed-bean&gt;</span>
    ...
    <span class="tag">&lt;managed-property&gt;</span>
        <span class="tag">&lt;property-name&gt;</span>prices<span class="tag">&lt;/property-name&gt;</span>
        <span class="tag">&lt;map-entries&gt;</span>
            <span class="tag">&lt;map-entry&gt;</span>
                <span class="tag">&lt;key&gt;</span>My Early Years: Growing Up on *7<span class="tag">&lt;/key&gt;</span>
                <span class="tag">&lt;value&gt;</span>30.75<span class="tag">&lt;/value&gt;</span>
            <span class="tag">&lt;/map-entry&gt;</span>
            <span class="tag">&lt;map-entry&gt;</span>
                <span class="tag">&lt;key&gt;</span>Web Servers for Fun and Profit<span class="tag">&lt;/key&gt;</span>
                <span class="tag">&lt;value&gt;</span>40.75<span class="tag">&lt;/value&gt;</span>
            <span class="tag">&lt;/map-entry&gt;</span>
        <span class="tag">&lt;/map-entries&gt;</span>
    <span class="tag">&lt;/managed-property&gt;</span>
<span class="tag">&lt;/managed-bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The map created from this <code>map-entries</code> tag contains two entries.
By default, all the keys and values are converted to <code>String</code>.
If you want to specify a different type for the keys in the map, embed the <code>key-class</code> element just inside the <code>map-entries</code> element:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;map-entries&gt;</span>
    <span class="tag">&lt;key-class&gt;</span>java.math.BigDecimal<span class="tag">&lt;/key-class&gt;</span>
    ...
<span class="tag">&lt;/map-entries&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This declaration will convert all the keys into <code>java.math.BigDecimal</code>.
Of course, you must make sure that the keys can be converted to the type you specify.
The key from the example in this section cannot be converted to a <code>BigDecimal</code>, because it is a <code>String</code>.</p>
</div>
<div class="paragraph">
<p>If you want to specify a different type for all the values in the map, include the <code>value-class</code> element after the <code>key-class</code> element:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;map-entries&gt;</span>
    <span class="tag">&lt;key-class&gt;</span>int<span class="tag">&lt;/key-class&gt;</span>
    <span class="tag">&lt;value-class&gt;</span>java.math.BigDecimal<span class="tag">&lt;/value-class&gt;</span>
    ...
<span class="tag">&lt;/map-entries&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that this tag sets only the type of all the <code>value</code> subelements.</p>
</div>
<div class="paragraph">
<p>Each <code>map-entry</code> in the preceding example includes a <code>value</code> subelement.
The <code>value</code> subelement defines a single value, which will be converted to the type specified in the bean.</p>
</div>
<div class="paragraph">
<p>Instead of using a <code>map-entries</code> element, it is also possible to assign the entire map using a <code>value</code> element that specifies a map-typed expression.</p>
</div>
</div>
<div class="sect4">
<h5 id="initializing-array-and-list-properties"><a class="anchor" href="#initializing-array-and-list-properties"></a>Initializing Array and List Properties</h5>
<div class="paragraph">
<p>The <code>list-entries</code> element is used to initialize the values of an array or <code>List</code> property.
Each individual value of the array or <code>List</code> is initialized using a <code>value</code> or <code>null-value</code> element.
Here is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;managed-bean&gt;</span>
    ...
    <span class="tag">&lt;managed-property&gt;</span>
        <span class="tag">&lt;property-name&gt;</span>books<span class="tag">&lt;/property-name&gt;</span>
        <span class="tag">&lt;list-entries&gt;</span>
            <span class="tag">&lt;value-class&gt;</span>java.lang.String<span class="tag">&lt;/value-class&gt;</span>
            <span class="tag">&lt;value&gt;</span>Web Servers for Fun and Profit<span class="tag">&lt;/value&gt;</span>
            <span class="tag">&lt;value&gt;</span>#{myBooks.bookId[3]}<span class="tag">&lt;/value&gt;</span>
            <span class="tag">&lt;null-value</span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/list-entries&gt;</span>
    <span class="tag">&lt;/managed-property&gt;</span>
<span class="tag">&lt;/managed-bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This example initializes an array or a <code>List</code>.
The type of the corresponding property in the bean determines which data structure is created.
The <code>list-entries</code> element defines the list of values in the array or <code>List</code>.
The <code>value</code> element specifies a single value in the array or <code>List</code> and can reference a property in another bean.
The <code>null-value</code> element will cause the <code>setBooks</code> method to be called with an argument of <code>null</code>.
A <code>null</code> property cannot be specified for a property whose data type is a Java primitive, such as <code>int</code> or <code>boolean</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="initializing-managed-bean-properties"><a class="anchor" href="#initializing-managed-bean-properties"></a>Initializing Managed Bean Properties</h5>
<div class="paragraph">
<p>Sometimes you might want to create a bean that also references other managed beans so that you can construct a graph or a tree of beans.
For example, suppose you want to create a bean representing a customer&#8217;s information, including the mailing address and street address, each of which is also a bean.
The following <code>managed-bean</code> declarations create a <code>CustomerBean</code> instance that has two <code>AddressBean</code> properties: one representing the mailing address and the other representing the street address.
This declaration results in a tree of beans with <code>CustomerBean</code> as its root and the two <code>AddressBean</code> objects as children.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;managed-bean&gt;</span>
    <span class="tag">&lt;managed-bean-name&gt;</span>customer<span class="tag">&lt;/managed-bean-name&gt;</span>
    <span class="tag">&lt;managed-bean-class&gt;</span>
        com.example.mybeans.CustomerBean
    <span class="tag">&lt;/managed-bean-class&gt;</span>
    <span class="tag">&lt;managed-bean-scope&gt;</span> request <span class="tag">&lt;/managed-bean-scope&gt;</span>
    <span class="tag">&lt;managed-property&gt;</span>
        <span class="tag">&lt;property-name&gt;</span>mailingAddress<span class="tag">&lt;/property-name&gt;</span>
        <span class="tag">&lt;value&gt;</span>#{addressBean}<span class="tag">&lt;/value&gt;</span>
    <span class="tag">&lt;/managed-property&gt;</span>
    <span class="tag">&lt;managed-property&gt;</span>
        <span class="tag">&lt;property-name&gt;</span>streetAddress<span class="tag">&lt;/property-name&gt;</span>
        <span class="tag">&lt;value&gt;</span>#{addressBean}<span class="tag">&lt;/value&gt;</span>
    <span class="tag">&lt;/managed-property&gt;</span>
    <span class="tag">&lt;managed-property&gt;</span>
        <span class="tag">&lt;property-name&gt;</span>customerType<span class="tag">&lt;/property-name&gt;</span>
        <span class="tag">&lt;value&gt;</span>New<span class="tag">&lt;/value&gt;</span>
    <span class="tag">&lt;/managed-property&gt;</span>
<span class="tag">&lt;/managed-bean&gt;</span>
<span class="tag">&lt;managed-bean&gt;</span>
    <span class="tag">&lt;managed-bean-name&gt;</span>addressBean<span class="tag">&lt;/managed-bean-name&gt;</span>
    <span class="tag">&lt;managed-bean-class&gt;</span>
        com.example.mybeans.AddressBean
    <span class="tag">&lt;/managed-bean-class&gt;</span>
    <span class="tag">&lt;managed-bean-scope&gt;</span> none <span class="tag">&lt;/managed-bean-scope&gt;</span>
    <span class="tag">&lt;managed-property&gt;</span>
        <span class="tag">&lt;property-name&gt;</span>street<span class="tag">&lt;/property-name&gt;</span>
        <span class="tag">&lt;null-value</span><span class="tag">/&gt;</span>
    <span class="tag">&lt;managed-property&gt;</span>
    ...
<span class="tag">&lt;/managed-bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The first <code>CustomerBean</code> declaration (with the <code>managed-bean-name</code> of <code>customer</code>) creates a <code>CustomerBean</code> in request scope.
This bean has two properties, <code>mailingAddress</code> and <code>streetAddress</code>.
These properties use the <code>value</code> element to reference a bean named <code>addressBean</code>.</p>
</div>
<div class="paragraph">
<p>The second managed bean declaration defines an <code>AddressBean</code> but does not create it, because its <code>managed-bean-scope</code> element defines a scope of <code>none</code>.
Recall that a scope of <code>none</code> means that the bean is created only when something else references it.
Because both the <code>mailingAddress</code> and the <code>streetAddress</code> properties reference <code>addressBean</code> using the <code>value</code> element, two instances of <code>AddressBean</code> are created when <code>CustomerBean</code> is created.</p>
</div>
<div class="paragraph">
<p>When you create an object that points to other objects, do not try to point to an object with a shorter life span, because it might be impossible to recover that scope&#8217;s resources when it goes away.
A session-scoped object, for example, cannot point to a request-scoped object.
And objects with <code>none</code> scope have no effective life span managed by the framework, so they can point only to other <code>none</code>-scoped objects.
<a href="#allowable-connections-between-scoped-objects">Table 16-2</a> outlines all of the allowed connections.</p>
</div>
<table id="allowable-connections-between-scoped-objects" class="tableblock frame-all grid-all" style="width: 60%;">
<caption class="title">Table 16-2 Allowable Connections between Scoped Objects</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">An Object of This Scope</th>
<th class="tableblock halign-left valign-top">May Point to an Object of This Scope</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>none</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>none</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>application</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>none</code>, <code>application</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>session</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>none</code>, <code>application</code>, <code>session</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>request</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>none</code>, <code>application</code>, <code>session</code>, <code>request</code>, <code>view</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>view</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>none</code>, <code>application</code>, <code>session</code>, <code>view</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Be sure not to allow cyclical references between objects.
For example, neither of the <code>AddressBean</code> objects in the preceding example should point back to the <code>CustomerBean</code> object, because <code>CustomerBean</code> already points to the <code>AddressBean</code> objects.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="initializing-maps-and-lists"><a class="anchor" href="#initializing-maps-and-lists"></a>Initializing Maps and Lists</h4>
<div class="paragraph">
<p>In addition to configuring <code>Map</code> and <code>List</code> properties, you can also configure a <code>Map</code> and a <code>List</code> directly so that you can reference them from a tag rather than referencing a property that wraps a <code>Map</code> or a <code>List</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="registering-application-messages"><a class="anchor" href="#registering-application-messages"></a>Registering Application Messages</h3>
<div class="paragraph">
<p>Application messages can include any strings displayed to the user as well as custom error messages (which are displayed by the <code>message</code> and <code>messages</code> tags) for your custom converters or validators.
To make messages available at application startup time, do one of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Queue an individual message onto the <code>jakarta.faces.context.FacesContext</code> instance programmatically, as described in <a href="#using-facesmessage-to-create-a-message">Using FacesMessage to Create a Message</a></p>
</li>
<li>
<p>Register all the messages with your application using the application configuration resource file</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Here is the section of the <code>faces-config.xml</code> file that registers the messages for the Duke&#8217;s Bookstore case study application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;application&gt;</span>
    <span class="tag">&lt;resource-bundle&gt;</span>
        <span class="tag">&lt;base-name&gt;</span>
            ee.jakarta.tutorial.dukesbookstore.web.messages.Messages
        <span class="tag">&lt;/base-name&gt;</span>
        <span class="tag">&lt;var&gt;</span>bundle<span class="tag">&lt;/var&gt;</span>
    <span class="tag">&lt;/resource-bundle&gt;</span>
    <span class="tag">&lt;locale-config&gt;</span>
        <span class="tag">&lt;default-locale&gt;</span>en<span class="tag">&lt;/default-locale&gt;</span>
        <span class="tag">&lt;supported-locale&gt;</span>es<span class="tag">&lt;/supported-locale&gt;</span>
        <span class="tag">&lt;supported-locale&gt;</span>de<span class="tag">&lt;/supported-locale&gt;</span>
        <span class="tag">&lt;supported-locale&gt;</span>fr<span class="tag">&lt;/supported-locale&gt;</span>
    <span class="tag">&lt;/locale-config&gt;</span>
<span class="tag">&lt;/application&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This set of elements causes the application to be populated with the messages that are contained in the specified resource bundle.</p>
</div>
<div class="paragraph">
<p>The <code>resource-bundle</code> element represents a set of localized messages.
It must contain the fully qualified path to the resource bundle containing the localized messages (in this case, <code>dukesbookstore.web.messages.Messages</code>).
The <code>var</code> element defines the EL name by which page authors refer to the resource bundle.</p>
</div>
<div class="paragraph">
<p>The <code>locale-config</code> element lists the default locale and the other supported locales.
The <code>locale-config</code> element enables the system to find the correct locale based on the browser&#8217;s language settings.</p>
</div>
<div class="paragraph">
<p>The <code>supported-locale</code> and <code>default-locale</code> tags accept the lowercase, two-character codes defined by ISO 639-1 (see <a href="https://www.loc.gov/standards/iso639-2/php/English_list.php" class="bare" target="_blank" rel="noopener">https://www.loc.gov/standards/iso639-2/php/English_list.php</a>).
Make sure that your resource bundle actually contains the messages for the locales you specify with these tags.</p>
</div>
<div class="paragraph">
<p>To access the localized message, the application developer merely references the key of the message from the resource bundle.</p>
</div>
<div class="paragraph">
<p>You can pull localized text into an <code>alt</code> tag for a graphic image, as in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:graphicImage</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mapImage</span><span class="delimiter">&quot;</span></span>
                <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">book_all.jpg</span><span class="delimiter">&quot;</span></span>
                <span class="attribute-name">library</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">images</span><span class="delimiter">&quot;</span></span>
                <span class="attribute-name">alt</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{bundle.ChooseBook}</span><span class="delimiter">&quot;</span></span>
                <span class="attribute-name">usemap</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#bookMap</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>alt</code> attribute can accept value expressions.
In this case, the <code>alt</code> attribute refers to localized text that will be included in the alternative text of the image rendered by this tag.</p>
</div>
<div class="sect3">
<h4 id="using-facesmessage-to-create-a-message"><a class="anchor" href="#using-facesmessage-to-create-a-message"></a>Using FacesMessage to Create a Message</h4>
<div class="paragraph">
<p>Instead of registering messages in the application configuration resource file, you can access the <code>java.util.ResourceBundle</code> directly from managed bean code.
The code snippet below locates an email error message:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">String</span> message = <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>;
...
message = ExampleBean.loadErrorMessage(context,
    ExampleBean.EX_RESOURCE_BUNDLE_NAME,
         <span class="string"><span class="delimiter">&quot;</span><span class="content">EMailError</span><span class="delimiter">&quot;</span></span>);
context.addMessage(toValidate.getClientId(context),
    <span class="keyword">new</span> FacesMessage(message));</code></pre>
</div>
</div>
<div class="paragraph">
<p>These lines call the bean&#8217;s <code>loadErrorMessage</code> method to get the message from the <code>ResourceBundle</code>.
Here is the <code>loadErrorMessage</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">static</span> <span class="predefined-type">String</span> loadErrorMessage(FacesContext context,
     <span class="predefined-type">String</span> basename, <span class="predefined-type">String</span> key) {
    <span class="keyword">if</span> ( bundle == <span class="predefined-constant">null</span> ) {
         <span class="keyword">try</span> {
            bundle = <span class="predefined-type">ResourceBundle</span>.getBundle(basename,
                 context.getViewRoot().getLocale());
        } <span class="keyword">catch</span> (<span class="exception">Exception</span> e) {
            <span class="keyword">return</span> <span class="predefined-constant">null</span>;
        }
    }
    <span class="keyword">return</span> bundle.getString(key);
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="referencing-error-messages"><a class="anchor" href="#referencing-error-messages"></a>Referencing Error Messages</h4>
<div class="paragraph">
<p>A Jakarta Faces page uses the <code>message</code> or <code>messages</code> tags to access error messages, as explained in <a href="#displaying-error-messages-with-the-hmessage-and-hmessages-tags">Displaying Error Messages with the h:message and h:messages Tags</a>.</p>
</div>
<div class="paragraph">
<p>The error messages these tags access include</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The standard error messages that accompany the standard converters and validators that ship with the API (see <a href="https://jakarta.ee/specifications/faces/3.0/jakarta-faces-3.0.html#a584" target="_blank" rel="noopener">Section 2.5.2.4</a> of the Jakarta Faces specification for a complete list of standard error messages).</p>
</li>
<li>
<p>Custom error messages contained in resource bundles registered with the application by the application architect using the <code>resource-bundle</code> element in the configuration file</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When a converter or validator is registered on an input component, the appropriate error message is automatically queued on the component.</p>
</div>
<div class="paragraph">
<p>A page author can override the error messages queued on a component by using the following attributes of the component&#8217;s tag:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>converterMessage</code>: References the error message to display when the data on the enclosing component cannot be converted by the converter registered on this component.</p>
</li>
<li>
<p><code>requiredMessage</code>: References the error message to display when no value has been entered into the enclosing component.</p>
</li>
<li>
<p><code>validatorMessage</code>: References the error message to display when the data on the enclosing component cannot be validated by the validator registered on this component.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All three attributes are enabled to take literal values and value expressions.
If an attribute uses a value expression, this expression references the error message in a resource bundle.
This resource bundle must be made available to the application in one of the following ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>By the application architect using the <code>resource-bundle</code> element in the configuration file</p>
</li>
<li>
<p>By the page author using the <code>f:loadBundle</code> tag</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Conversely, the <code>resource-bundle</code> element must be used to make available to the application those resource bundles containing custom error messages that are queued on the component as a result of a custom converter or validator being registered on the component.</p>
</div>
<div class="paragraph">
<p>The following tags show how to specify the <code>requiredMessage</code> attribute using a value expression to reference an error message:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:inputText</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ccno</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">19</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">required</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">requiredMessage</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{customMessages.ReqMessage}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    ...
<span class="tag">&lt;/h:inputText&gt;</span>
<span class="tag">&lt;h:message</span> <span class="attribute-name">styleClass</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">error-message</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">for</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ccno</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The value expression used by <code>requiredMessage</code> in this example references the error message with the <code>ReqMessage</code> key in the resource bundle <code>customMessages</code>.</p>
</div>
<div class="paragraph">
<p>This message replaces the corresponding message queued on the component and will display wherever the <code>message</code> or <code>messages</code> tag is placed on the page.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-default-validators"><a class="anchor" href="#using-default-validators"></a>Using Default Validators</h3>
<div class="paragraph">
<p>In addition to the validators you declare on the components, you can also specify zero or more default validators in the application configuration resource file.
The default validator applies to all <code>jakarta.faces.component.UIInput</code> instances in a view or component tree and is appended after the local defined validators.
Here is an example of a default validator registered in the application configuration resource file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;faces-config&gt;</span>
    <span class="tag">&lt;application&gt;</span>
        <span class="tag">&lt;default-validators&gt;</span>
            <span class="tag">&lt;validator-id&gt;</span>jakarta.faces.Bean<span class="tag">&lt;/validator-id&gt;</span>
        <span class="tag">&lt;/default-validators&gt;</span>
    <span class="tag">&lt;application</span><span class="tag">/&gt;</span>
<span class="tag">&lt;/faces-config&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="registering-a-custom-validator"><a class="anchor" href="#registering-a-custom-validator"></a>Registering a Custom Validator</h3>
<div class="paragraph">
<p>If the application developer provides an implementation of the <code>jakarta.faces.validator.Validator</code> interface to perform validation, you must register this custom validator either by using the <code>@FacesValidator</code> annotation, as described in <a href="#implementing-the-validator-interface">Implementing the Validator Interface</a>, or by using the <code>validator</code> XML element in the application configuration resource file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;validator&gt;</span>
    ...
    <span class="tag">&lt;validator-id&gt;</span>FormatValidator<span class="tag">&lt;/validator-id&gt;</span>
    <span class="tag">&lt;validator-class&gt;</span>
        myapplication.validators.FormatValidator
    <span class="tag">&lt;/validator-class&gt;</span>
    <span class="tag">&lt;attribute&gt;</span>
        ...
        <span class="tag">&lt;attribute-name&gt;</span>formatPatterns<span class="tag">&lt;/attribute-name&gt;</span>
        <span class="tag">&lt;attribute-class&gt;</span>java.lang.String<span class="tag">&lt;/attribute-class&gt;</span>
    <span class="tag">&lt;/attribute&gt;</span>
<span class="tag">&lt;/validator&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Attributes specified in a <code>validator</code> tag override any settings in the <code>@FacesValidator</code> annotation.</p>
</div>
<div class="paragraph">
<p>The <code>validator-id</code> and <code>validator-class</code> elements are required subelements.
The <code>validator-id</code> element represents the identifier under which the <code>Validator</code> class should be registered.
This ID is used by the tag class corresponding to the custom <code>validator</code> tag.</p>
</div>
<div class="paragraph">
<p>The <code>validator-class</code> element represents the fully qualified class name of the <code>Validator</code> class.</p>
</div>
<div class="paragraph">
<p>The <code>attribute</code> element identifies an attribute associated with the <code>Validator</code> implementation.
It has required <code>attribute-name</code> and <code>attribute-class</code> subelements.
The <code>attribute-name</code> element refers to the name of the attribute as it appears in the <code>validator</code> tag.
The <code>attribute-class</code> element identifies the Java type of the value associated with the attribute.</p>
</div>
<div class="paragraph">
<p><a href="#creating-and-using-a-custom-validator">Creating and Using a Custom Validator</a> explains how to implement the <code>Validator</code> interface.</p>
</div>
<div class="paragraph">
<p><a href="#using-a-custom-validator">Using a Custom Validator</a> explains how to reference the validator from the page.</p>
</div>
</div>
<div class="sect2">
<h3 id="registering-a-custom-converter"><a class="anchor" href="#registering-a-custom-converter"></a>Registering a Custom Converter</h3>
<div class="paragraph">
<p>As is the case with a custom validator, if the application developer creates a custom converter, you must register it with the application either by using the <code>@FacesConverter</code> annotation, as described in <a href="#creating-a-custom-converter">Creating a Custom Converter</a>, or by using the <code>converter</code> XML element in the application configuration resource file.
Here is a hypothetical <code>converter</code> configuration for <code>CreditCardConverter</code> from the Duke&#8217;s Bookstore case study:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;converter&gt;</span>
    <span class="tag">&lt;description&gt;</span>
        Converter for credit card numbers that normalizes
        the input to a standard format
    <span class="tag">&lt;/description&gt;</span>
    <span class="tag">&lt;converter-id&gt;</span>CreditCardConverter<span class="tag">&lt;/converter-id&gt;</span>
    <span class="tag">&lt;converter-class&gt;</span>
        dukesbookstore.converters.CreditCardConverter
    <span class="tag">&lt;/converter-class&gt;</span>
<span class="tag">&lt;/converter&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Attributes specified in a <code>converter</code> tag override any settings in the <code>@FacesConverter</code> annotation.</p>
</div>
<div class="paragraph">
<p>The <code>converter</code> element represents a <code>jakarta.faces.convert.Converter</code> implementation and contains required <code>converter-id</code> and <code>converter-class</code> elements.</p>
</div>
<div class="paragraph">
<p>The <code>converter-id</code> element identifies an ID that is used by the <code>converter</code> attribute of a UI component tag to apply the converter to the component&#8217;s data.
<a href="#using-a-custom-converter">Using a Custom Converter</a> includes an example of referencing the custom converter from a component tag.</p>
</div>
<div class="paragraph">
<p>The <code>converter-class</code> element identifies the <code>Converter</code> implementation.</p>
</div>
<div class="paragraph">
<p><a href="#creating-and-using-a-custom-converter">Creating and Using a Custom Converter</a> explains how to create a custom converter.</p>
</div>
</div>
<div class="sect2">
<h3 id="configuring-navigation-rules"><a class="anchor" href="#configuring-navigation-rules"></a>Configuring Navigation Rules</h3>
<div class="paragraph">
<p>Navigation between different pages of a Jakarta Faces application, such as choosing the next page to be displayed after a button or link component is clicked, is defined by a set of rules.
Navigation rules can be implicit, or they can be explicitly defined in the application configuration resource file.
For more information on implicit navigation rules, see <a href="#navigation-model">Navigation Model</a>.</p>
</div>
<div class="paragraph">
<p>Each navigation rule specifies how to navigate from one page to another page or set of pages.
The Jakarta Faces implementation chooses the proper navigation rule according to which page is currently displayed.</p>
</div>
<div class="paragraph">
<p>After the proper navigation rule is selected, the choice of which page to access next from the current page depends on two factors:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The action method invoked when the component was clicked</p>
</li>
<li>
<p>The logical outcome referenced by the component&#8217;s tag or returned from the action method</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The outcome can be anything the developer chooses, but <a href="#common-outcome-strings">Table 16-3</a> lists some outcomes commonly used in web applications.</p>
</div>
<table id="common-outcome-strings" class="tableblock frame-all grid-all" style="width: 60%;">
<caption class="title">Table 16-3 Common Outcome Strings</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Outcome</th>
<th class="tableblock halign-left valign-top">What It Means</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>success</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Everything worked.
Go on to the next page.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>failure</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Something is wrong.
Go on to an error page.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>login</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The user needs to log in first.
Go on to the login page.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>no results</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The search did not find anything.
Go to the search page again.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Usually, the action method performs some processing on the form data of the current page.
For example, the method might check whether the user name and password entered in the form match the user name and password on file.
If they match, the method returns the outcome <code>success</code>.
Otherwise, it returns the outcome <code>failure</code>.
As this example demonstrates, both the method used to process the action and the outcome returned are necessary to determine the correct page to access.</p>
</div>
<div class="paragraph">
<p>Here is a navigation rule that could be used with the example just described:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;navigation-rule&gt;</span>
    <span class="tag">&lt;from-view-id&gt;</span>/login.xhtml<span class="tag">&lt;/from-view-id&gt;</span>
    <span class="tag">&lt;navigation-case&gt;</span>
        <span class="tag">&lt;from-action&gt;</span>#{LoginForm.login}<span class="tag">&lt;/from-action&gt;</span>
        <span class="tag">&lt;from-outcome&gt;</span>success<span class="tag">&lt;/from-outcome&gt;</span>
        <span class="tag">&lt;to-view-id&gt;</span>/storefront.xhtml<span class="tag">&lt;/to-view-id&gt;</span>
    <span class="tag">&lt;/navigation-case&gt;</span>
    <span class="tag">&lt;navigation-case&gt;</span>
        <span class="tag">&lt;from-action&gt;</span>#{LoginForm.logon}<span class="tag">&lt;/from-action&gt;</span>
        <span class="tag">&lt;from-outcome&gt;</span>failure<span class="tag">&lt;/from-outcome&gt;</span>
        <span class="tag">&lt;to-view-id&gt;</span>/logon.xhtml<span class="tag">&lt;/to-view-id&gt;</span>
    <span class="tag">&lt;/navigation-case&gt;</span>
<span class="tag">&lt;/navigation-rule&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This navigation rule defines the possible ways to navigate from <code>login.xhtml</code>.
Each <code>navigation-case</code> element defines one possible navigation path from <code>login.xhtml</code>.
The first <code>navigation-case</code> says that if <code>LoginForm.login</code> returns an outcome of <code>success</code>, then <code>storefront.xhtml</code> will be accessed.
The second <code>navigation-case</code> says that <code>login.xhtml</code> will be re-rendered if <code>LoginForm.login</code> returns <code>failure</code>.</p>
</div>
<div class="paragraph">
<p>The configuration of an application&#8217;s page flow consists of a set of navigation rules.
Each rule is defined by the <code>navigation-rule</code> element in the <code>faces-config.xml</code> file.</p>
</div>
<div class="paragraph">
<p>Each <code>navigation-rule</code> element corresponds to one component tree identifier defined by the optional <code>from-view-id</code> element.
This means that each rule defines all the possible ways to navigate from one particular page in the application.
If there is no <code>from-view-id</code> element, the navigation rules defined in the <code>navigation-rule</code> element apply to all the pages in the application.
The <code>from-view-id</code> element also allows wildcard matching patterns.
For example, this <code>from-view-id</code> element says that the navigation rule applies to all the pages in the <code>books</code> directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;from-view-id&gt;</span>/books/*<span class="tag">&lt;/from-view-id&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A <code>navigation-rule</code> element can contain zero or more <code>navigation-case</code> elements.
The <code>navigation-case</code> element defines a set of matching criteria.
When these criteria are satisfied, the application will navigate to the page defined by the <code>to-view-id</code> element contained in the same <code>navigation-case</code> element.</p>
</div>
<div class="paragraph">
<p>The navigation criteria are defined by optional <code>from-outcome</code> and <code>from-action</code> elements.
The <code>from-outcome</code> element defines a logical outcome, such as <code>success</code>.
The <code>from-action</code> element uses a method expression to refer to an action method that returns a <code>String</code>, which is the logical outcome.
The method performs some logic to determine the outcome and returns the outcome.</p>
</div>
<div class="paragraph">
<p>The <code>navigation-case</code> elements are checked against the outcome and the method expression in the following order.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Cases specifying both a <code>from-outcome</code> value and a <code>from-action</code> value.
Both of these elements can be used if the action method returns different outcomes depending on the result of the processing it performs.</p>
</li>
<li>
<p>Cases specifying only a <code>from-outcome</code> value.
The <code>from-outcome</code> element must match either the outcome defined by the <code>action</code> attribute of the <code>jakarta.faces.component.UICommand</code> component or the outcome returned by the method referred to by the <code>UICommand</code> component.</p>
</li>
<li>
<p>Cases specifying only a <code>from-action</code> value.
This value must match the <code>action</code> expression specified by the component tag.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>When any of these cases is matched, the component tree defined by the <code>to-view-id</code> element will be selected for rendering.</p>
</div>
</div>
<div class="sect2">
<h3 id="registering-a-custom-renderer-with-a-render-kit"><a class="anchor" href="#registering-a-custom-renderer-with-a-render-kit"></a>Registering a Custom Renderer with a Render Kit</h3>
<div class="paragraph">
<p>When the application developer creates a custom renderer, as described in <a href="#delegating-rendering-to-a-renderer">Delegating Rendering to a Renderer</a>, you must register it using the appropriate render kit.
Because the image map application implements an HTML image map, the <code>AreaRenderer</code> and <code>MapRenderer</code> classes in the Duke&#8217;s Bookstore case study should be registered using the HTML render kit.</p>
</div>
<div class="paragraph">
<p>You register the renderer either by using the <code>@FacesRenderer</code> annotation, as described in <a href="#creating-the-renderer-class">Creating the Renderer Class</a>, or by using the <code>render-kit</code> element of the application configuration resource file.
Here is a hypothetical configuration of <code>AreaRenderer</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;render-kit&gt;</span>
    <span class="tag">&lt;renderer&gt;</span>
        <span class="tag">&lt;component-family&gt;</span>Area<span class="tag">&lt;/component-family&gt;</span>
        <span class="tag">&lt;renderer-type&gt;</span>DemoArea<span class="tag">&lt;/renderer-type&gt;</span>
        <span class="tag">&lt;renderer-class&gt;</span>
            dukesbookstore.renderers.AreaRenderer
        <span class="tag">&lt;/renderer-class&gt;</span>
        <span class="tag">&lt;attribute&gt;</span>
            <span class="tag">&lt;attribute-name&gt;</span>onmouseout<span class="tag">&lt;/attribute-name&gt;</span>
            <span class="tag">&lt;attribute-class&gt;</span>java.lang.String<span class="tag">&lt;/attribute-class&gt;</span>
        <span class="tag">&lt;/attribute&gt;</span>
        <span class="tag">&lt;attribute&gt;</span>
            <span class="tag">&lt;attribute-name&gt;</span>onmouseover<span class="tag">&lt;/attribute-name&gt;</span>
            <span class="tag">&lt;attribute-class&gt;</span>java.lang.String<span class="tag">&lt;/attribute-class&gt;</span>
        <span class="tag">&lt;/attribute&gt;</span>
        <span class="tag">&lt;attribute&gt;</span>
            <span class="tag">&lt;attribute-name&gt;</span>styleClass<span class="tag">&lt;/attribute-name&gt;</span>
            <span class="tag">&lt;attribute-class&gt;</span>java.lang.String<span class="tag">&lt;/attribute-class&gt;</span>
        <span class="tag">&lt;/attribute&gt;</span>
    <span class="tag">&lt;/renderer&gt;</span>
    ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Attributes specified in a <code>renderer</code> tag override any settings in the <code>@FacesRenderer</code> annotation.</p>
</div>
<div class="paragraph">
<p>The <code>render-kit</code> element represents a jakarta.faces.render.<code>RenderKit</code> implementation.
If no <code>render-kit-id</code> is specified, the default HTML render kit is assumed.
The <code>renderer</code> element represents a <code>jakarta.faces.render.Renderer</code> implementation.
By nesting the <code>renderer</code> element inside the <code>render-kit</code> element, you are registering the renderer with the <code>RenderKit</code> implementation associated with the <code>render-kit</code> element.</p>
</div>
<div class="paragraph">
<p>The <code>renderer-class</code> is the fully qualified class name of the <code>Renderer</code>.</p>
</div>
<div class="paragraph">
<p>The <code>component-family</code> and <code>renderer-type</code> elements are used by a component to find renderers that can render it.
The <code>component-family</code> identifier must match that returned by the component class&#8217;s <code>getFamily</code> method.
The component family represents a component or set of components that a particular renderer can render.
The <code>renderer-type</code> must match that returned by the <code>getRendererType</code> method of the tag handler class.</p>
</div>
<div class="paragraph">
<p>By using the component family and renderer type to look up renderers for components, the Jakarta Faces implementation allows a component to be rendered by multiple renderers and allows a renderer to render multiple components.</p>
</div>
<div class="paragraph">
<p>Each of the <code>attribute</code> tags specifies a render-dependent attribute and its type.
The <code>attribute</code> element doesn&#8217;t affect the runtime execution of your application.
Rather, it provides information to tools about the attributes the <code>Renderer</code> supports.</p>
</div>
<div class="paragraph">
<p>The object responsible for rendering a component (be it the component itself or a renderer to which the component delegates the rendering) can use facets to aid in the rendering process.
These facets allow the custom component developer to control some aspects of rendering the component.
Consider this custom component tag example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;d:dataScroller&gt;</span>
    <span class="tag">&lt;f:facet</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">header</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;h:panelGroup&gt;</span>
            <span class="tag">&lt;h:outputText</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Account Id</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;h:outputText</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Customer Name</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;h:outputText</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Total Sales</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/h:panelGroup&gt;</span>
    <span class="tag">&lt;/f:facet&gt;</span>
    <span class="tag">&lt;f:facet</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">next</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;h:panelGroup&gt;</span>
            <span class="tag">&lt;h:outputText</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Next</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;h:graphicImage</span> <span class="attribute-name">url</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/images/arrow-right.gif</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;/h:panelGroup&gt;</span>
    <span class="tag">&lt;/f:facet&gt;</span>
    ...
<span class="tag">&lt;/d:dataScroller&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>dataScroller</code> component tag includes a component that will render the header and a component that will render the Next button.
If the renderer associated with this component renders the facets, you can include the following <code>facet</code> elements in the <code>renderer</code> element:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;facet&gt;</span>
    <span class="tag">&lt;description&gt;</span>This facet renders as the header of the table. It should be
         a panelGroup with the same number of columns as the data.
    <span class="tag">&lt;/description&gt;</span>
    <span class="tag">&lt;display-name&gt;</span>header<span class="tag">&lt;/display-name&gt;</span>
    <span class="tag">&lt;facet-name&gt;</span>header<span class="tag">&lt;/facet-name&gt;</span>
<span class="tag">&lt;/facet&gt;</span>
<span class="tag">&lt;facet&gt;</span>
    <span class="tag">&lt;description&gt;</span>This facet renders as the content of the &quot;next&quot; button in
         the scroller. It should be a panelGroup that includes an outputText
         tag that has the text &quot;Next&quot; and a right arrow icon.
    <span class="tag">&lt;/description&gt;</span>
    <span class="tag">&lt;display-name&gt;</span>Next<span class="tag">&lt;/display-name&gt;</span>
    <span class="tag">&lt;facet-name&gt;</span>next<span class="tag">&lt;/facet-name&gt;</span>
<span class="tag">&lt;/facet&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If a component that supports facets provides its own rendering and you want to include <code>facet</code> elements in the application configuration resource file, you need to put them in the component&#8217;s configuration rather than the renderer&#8217;s configuration.</p>
</div>
</div>
<div class="sect2">
<h3 id="registering-a-custom-component"><a class="anchor" href="#registering-a-custom-component"></a>Registering a Custom Component</h3>
<div class="paragraph">
<p>In addition to registering custom renderers (as explained in the preceding section), you also must register the custom components that are usually associated with the custom renderers.
You use either a <code>@FacesComponent</code> annotation, as described in <a href="#creating-custom-component-classes">Creating Custom Component Classes</a>, or the <code>component</code> element of the application configuration resource file.</p>
</div>
<div class="paragraph">
<p>Here is a hypothetical <code>component</code> element from the application configuration resource file that registers <code>AreaComponent</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;component&gt;</span>
    <span class="tag">&lt;component-type&gt;</span>DemoArea<span class="tag">&lt;/component-type&gt;</span>
    <span class="tag">&lt;component-class&gt;</span>
        dukesbookstore.components.AreaComponent
    <span class="tag">&lt;/component-class&gt;</span>
    <span class="tag">&lt;property&gt;</span>
        <span class="tag">&lt;property-name&gt;</span>alt<span class="tag">&lt;/property-name&gt;</span>
        <span class="tag">&lt;property-class&gt;</span>java.lang.String<span class="tag">&lt;/property-class&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
    <span class="tag">&lt;property&gt;</span>
        <span class="tag">&lt;property-name&gt;</span>coords<span class="tag">&lt;/property-name&gt;</span>
        <span class="tag">&lt;property-class&gt;</span>java.lang.String<span class="tag">&lt;/property-class&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
    <span class="tag">&lt;property&gt;</span>
        <span class="tag">&lt;property-name&gt;</span>shape<span class="tag">&lt;/property-name&gt;</span>
        <span class="tag">&lt;property-class&gt;</span>java.lang.String<span class="tag">&lt;/property-class&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/component&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Attributes specified in a <code>component</code> tag override any settings in the <code>@FacesComponent</code> annotation.</p>
</div>
<div class="paragraph">
<p>The <code>component-type</code> element indicates the name under which the component should be registered.
Other objects referring to this component use this name.
For example, the <code>component-type</code> element in the configuration for <code>AreaComponent</code> defines a value of <code>DemoArea</code>, which matches the value returned by the <code>AreaTag</code> class&#8217;s <code>getComponentType</code> method.</p>
</div>
<div class="paragraph">
<p>The <code>component-class</code> element indicates the fully qualified class name of the component.
The <code>property</code> elements specify the component properties and their types.</p>
</div>
<div class="paragraph">
<p>If the custom component can include facets, you can configure the facets in the component configuration using <code>facet</code> elements, which are allowed after the <code>component-class</code> elements.
See <a href="#registering-a-custom-renderer-with-a-render-kit">Registering a Custom Renderer with a Render Kit</a> for further details on configuring facets.</p>
</div>
</div>
<div class="sect2">
<h3 id="basic-requirements-of-a-jakarta-faces-application"><a class="anchor" href="#basic-requirements-of-a-jakarta-faces-application"></a>Basic Requirements of a Jakarta Faces Application</h3>
<div class="paragraph">
<p>In addition to configuring your application, you must satisfy other requirements of Jakarta Faces applications, including properly packaging all the necessary files and providing a deployment descriptor.
This section describes how to perform these administrative tasks.</p>
</div>
<div class="paragraph">
<p>Jakarta Faces applications can be packaged in a WAR file, which must conform to specific requirements to execute across different containers.
At a minimum, a WAR file for a Jakarta Faces application may contain the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A web application deployment descriptor, called <code>web.xml</code>, to configure resources required by a web application (required)</p>
</li>
<li>
<p>A specific set of JAR files containing essential classes (optional)</p>
</li>
<li>
<p>A set of application classes, Jakarta Faces pages, and other required resources, such as image files</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A WAR file may also contain:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An application configuration resource file, which configures application resources</p>
</li>
<li>
<p>A set of tag library descriptor files</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, a Jakarta Faces web application WAR file using Facelets typically has the following directory structure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$PROJECT_DIR
[Web Pages]
+- /[xhtml or html documents]
+- /resources
+- /WEB-INF
   +- /web.xml
   +- /beans.xml (optional)
   +- /classes (optional)
   +- /lib (optional)
   +- /faces-config.xml (optional)
   +- /*.taglib.xml (optional)
   +- /glassfish-web.xml (optional)</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>web.xml</code> file (or web deployment descriptor), the set of JAR files, and the set of application files must be contained in the <code>WEB-INF</code> directory of the WAR file.</p>
</div>
<div class="sect3">
<h4 id="configuring-an-application-with-a-web-deployment-descriptor"><a class="anchor" href="#configuring-an-application-with-a-web-deployment-descriptor"></a>Configuring an Application with a Web Deployment Descriptor</h4>
<div class="paragraph">
<p>Web applications are commonly configured using elements contained in the web application deployment descriptor, <code>web.xml</code>.
The deployment descriptor for a Jakarta Faces application must specify certain configurations, including the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The servlet used to process Jakarta Faces requests</p>
</li>
<li>
<p>The servlet mapping for the processing servlet</p>
</li>
<li>
<p>The path to the configuration resource file, if it exists and is not located in a default location</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The deployment descriptor can also include other, optional configurations, such as those that</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Specify where component state is saved</p>
</li>
<li>
<p>Encrypt state saved on the client</p>
</li>
<li>
<p>Compress state saved on the client</p>
</li>
<li>
<p>Restrict access to pages containing Jakarta Faces tags</p>
</li>
<li>
<p>Turn on XML validation</p>
</li>
<li>
<p>Specify the Project Stage</p>
</li>
<li>
<p>Verify custom objects</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This section gives more details on these configurations.
Where appropriate, it also describes how you can make these configurations using NetBeans IDE.</p>
</div>
<div class="sect4">
<h5 id="identifying-the-servlet-for-lifecycle-processing"><a class="anchor" href="#identifying-the-servlet-for-lifecycle-processing"></a>Identifying the Servlet for Lifecycle Processing</h5>
<div class="paragraph">
<p>A requirement of a Jakarta Faces application is that all requests to the application that reference previously saved Jakarta Faces components must go through <code>jakarta.faces.webapp.FacesServlet</code>.
A <code>FacesServlet</code> instance manages the request-processing lifecycle for web applications and initializes the resources required by Jakarta Faces technology.</p>
</div>
<div class="paragraph">
<p>Before a Jakarta Faces application can launch its first web page, the web container must invoke the <code>FacesServlet</code> instance in order for the application lifecycle process to start.
See <a href="#the-lifecycle-of-a-jakarta-faces-application">The Lifecycle of a Jakarta Faces Application</a> for more information.</p>
</div>
<div class="paragraph">
<p>The following example shows the default configuration of the <code>FacesServlet</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;servlet&gt;</span>
    <span class="tag">&lt;servlet-name&gt;</span>Faces Servlet<span class="tag">&lt;/servlet-name&gt;</span>
    <span class="tag">&lt;servlet-class&gt;</span>jakarta.faces.webapp.FacesServlet<span class="tag">&lt;/servlet-class&gt;</span>
<span class="tag">&lt;/servlet&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You will provide a mapping configuration entry to make sure that the <code>FacesServlet</code> instance is invoked.
The mapping to <code>FacesServlet</code> can be a prefix mapping, such as <code>/faces/<strong></code>, or an extension mapping, such as <code></strong>.xhtml</code>.
The mapping is used to identify a page as having Jakarta Faces content.
Because of this, the URL to the first page of the application must include the URL pattern mapping.</p>
</div>
<div class="paragraph">
<p>The following elements specify a prefix mapping:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;servlet-mapping&gt;</span>
    <span class="tag">&lt;servlet-name&gt;</span>Faces Servlet<span class="tag">&lt;/servlet-name&gt;</span>
    <span class="tag">&lt;url-pattern&gt;</span>/faces/*<span class="tag">&lt;/url-pattern&gt;</span>
<span class="tag">&lt;/servlet-mapping&gt;</span>
...
<span class="tag">&lt;welcome-file-list&gt;</span>
    <span class="tag">&lt;welcome-file&gt;</span>faces/greeting.xhtml<span class="tag">&lt;/welcome-file&gt;</span>
<span class="tag">&lt;/welcome-file-list&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following elements, used in the tutorial examples, specify an extension mapping:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;servlet-mapping&gt;</span>
    <span class="tag">&lt;servlet-name&gt;</span>Faces Servlet<span class="tag">&lt;/servlet-name&gt;</span>
    <span class="tag">&lt;url-pattern&gt;</span>*.xhtml<span class="tag">&lt;/url-pattern&gt;</span>
<span class="tag">&lt;/servlet-mapping&gt;</span>
...
<span class="tag">&lt;welcome-file-list&gt;</span>
    <span class="tag">&lt;welcome-file&gt;</span>index.xhtml<span class="tag">&lt;/welcome-file&gt;</span>
<span class="tag">&lt;/welcome-file-list&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When you use this mechanism, users access the application as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080/guessNumber</pre>
</div>
</div>
<div class="paragraph">
<p>In the case of extension mapping, if a request comes to the server for a page with an <code>.xhtml</code> extension, the container will send the request to the <code>FacesServlet</code> instance, which will expect a corresponding page of the same name containing the content to exist.</p>
</div>
<div class="paragraph">
<p>To minimize clutter and allow simple, friendly URLs, you can have extensionless URLs by manually exact mapping the <code>FacesServlet</code> to the existing prefix and suffix mapping options in <code>web.xml</code>, one or more times.</p>
</div>
<div class="paragraph">
<p>If you are using NetBeans IDE to create your application, a web deployment descriptor is automatically created for you with default configurations.
If you created your application without an IDE, you can create a web deployment descriptor.</p>
</div>
</div>
<div class="sect4">
<h5 id="to-specify-a-path-to-an-application-configuration-resource-file"><a class="anchor" href="#to-specify-a-path-to-an-application-configuration-resource-file"></a>To Specify a Path to an Application Configuration Resource File</h5>
<div class="paragraph">
<p>As explained in <a href="#application-configuration-resource-file">Application Configuration Resource File</a>, an application can have multiple application configuration resource files.
If these files are not located in the directories that the implementation searches by default or the files are not named <code>faces-config.xml</code>, you need to specify paths to these files.</p>
</div>
<div class="paragraph">
<p>To specify these paths using NetBeans IDE, do the following.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Expand the node of your project in the <strong>Projects</strong> tab.</p>
</li>
<li>
<p>Expand the <strong>Web Pages</strong> and <strong>WEB-INF</strong> nodes that are under the project node.</p>
</li>
<li>
<p>Double-click <code>web.xml</code>.</p>
</li>
<li>
<p>After the <code>web.xml</code> file appears in the editor, click <strong>General</strong> at the top of the editor window.</p>
</li>
<li>
<p>Expand the <strong>Context Parameters</strong> node.</p>
</li>
<li>
<p>Click <strong>Add</strong>.</p>
</li>
<li>
<p>In the Add Context Parameter dialog box:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Enter <code>jakarta.faces.CONFIG_FILES</code> in the <strong>Parameter Name</strong> field.</p>
</li>
<li>
<p>Enter the path to your configuration file in the <strong>Parameter Value</strong> field.</p>
</li>
<li>
<p>Click <strong>OK</strong>.</p>
</li>
<li>
<p>Repeat steps 1 through 7 for each configuration file.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-specify-where-state-is-saved"><a class="anchor" href="#to-specify-where-state-is-saved"></a>To Specify Where State Is Saved</h5>
<div class="paragraph">
<p>For all the components in a web application, you can specify in your deployment descriptor where you want the state to be saved, on either client or server.
You do this by setting a context parameter in your deployment descriptor.
By default, state is saved on the server, so you need to specify this context parameter only if you want to save state on the client.
See <a href="#saving-and-restoring-state">Saving and Restoring State</a> for information on the advantages and disadvantages of each location.</p>
</div>
<div class="paragraph">
<p>To specify where state is saved using NetBeans IDE, do the following.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Expand the node of your project in the <strong>Projects</strong> tab.</p>
</li>
<li>
<p>Expand the <strong>Web Pages</strong> and <strong>WEB-INF</strong> nodes under the project node.</p>
</li>
<li>
<p>Double-click <code>web.xml</code>.</p>
</li>
<li>
<p>After the <code>web.xml</code> file appears in the editor window, click <strong>General</strong> at the top of the editor window.</p>
</li>
<li>
<p>Expand the <strong>Context Parameters</strong> node.</p>
</li>
<li>
<p>Click <strong>Add</strong>.</p>
</li>
<li>
<p>In the Add Context Parameter dialog box:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Enter <code>jakarta.faces.STATE_SAVING_METHOD</code> in the <strong>Parameter Name</strong> field.</p>
</li>
<li>
<p>Enter <code>client</code> or <code>server</code> in the <strong>Parameter Value</strong> field.</p>
</li>
<li>
<p>Click <strong>OK</strong>.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>If state is saved on the client, the state of the entire view is rendered to a hidden field on the page.
The Jakarta Faces implementation saves the state on the server by default.
Duke&#8217;s Forest saves its state on the client.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configuring-project-stage"><a class="anchor" href="#configuring-project-stage"></a>Configuring Project Stage</h4>
<div class="paragraph">
<p>Project Stage is a context parameter identifying the status of a Jakarta Faces application in the software lifecycle.
The stage of an application can affect the behavior of the application.
For example, error messages can be displayed during the Development stage but suppressed during the Production stage.</p>
</div>
<div class="paragraph">
<p>The possible Project Stage values are as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Development</code></p>
</li>
<li>
<p><code>UnitTest</code></p>
</li>
<li>
<p><code>SystemTest</code></p>
</li>
<li>
<p><code>Production</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Project Stage is configured through a context parameter in the web deployment descriptor file.
Here is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;context-param&gt;
    &lt;param-name&gt;jakarta.faces.PROJECT_STAGE&lt;/param-name&gt;
    &lt;param-value&gt;Development&lt;/param-value&gt;
&lt;/context-param&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If no Project Stage is defined, the default stage is <code>Production</code>.
You can also add custom stages according to your requirements.</p>
</div>
</div>
<div class="sect3">
<h4 id="including-the-classes-pages-and-other-resources"><a class="anchor" href="#including-the-classes-pages-and-other-resources"></a>Including the Classes, Pages, and Other Resources</h4>
<div class="paragraph">
<p>When packaging web applications using the included build scripts, you&#8217;ll notice that the scripts package resources in the following ways.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>All web pages are placed at the top level of the WAR file.</p>
</li>
<li>
<p>The <code>faces-config.xml</code> file and the <code>web.xml</code> file are packaged in the <code>WEB-INF</code> directory.</p>
</li>
<li>
<p>All packages are stored in the <code>WEB-INF/classes/</code> directory.</p>
</li>
<li>
<p>All application JAR files are packaged in the <code>WEB-INF/lib/</code> directory.</p>
</li>
<li>
<p>All resource files are either under the root of the web application <code>/resources</code> directory or in the web application&#8217;s classpath, the <code>META-INF/resources/<em>resourceIdentifier</em></code> directory.
For more information on resources, see <a href="#web-resources">Web Resources</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When packaging your own applications, you can use NetBeans IDE or you can use XML files such as those created for Maven.
You can modify the XML files to fit your situation.
However, you can continue to package your WAR files by using the directory structure described in this section, because this technique complies with the commonly accepted practice for packaging web applications.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using-websockets-with-jakarta-faces-technology"><a class="anchor" href="#using-websockets-with-jakarta-faces-technology"></a>Chapter 17. Using WebSockets with Jakarta Faces Technology</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter describes using WebSockets in Jakarta Faces web applications.</p>
</div>
<div class="sect2">
<h3 id="about-websockets-in-jakarta-faces"><a class="anchor" href="#about-websockets-in-jakarta-faces"></a>About WebSockets in Jakarta Faces</h3>
<div class="paragraph">
<p>You use the <code>f:websocket tag</code> in a view to allow server-side communications to be pushed to all instances of a socket containing the same channel name.
When the communication is received, an <code>onmessage</code>, client-side JavaScript event handler can be set that is called whenever a push arrives from the server.</p>
</div>
<div class="paragraph">
<p>The server side of a WebSocket communication has the ability to push out messages.
You can do this using <code>jakarta.faces.push.PushContext</code>, which is an injectable context, allowing a server push to a named channel.</p>
</div>
</div>
<div class="sect2">
<h3 id="configuring-websockets"><a class="anchor" href="#configuring-websockets"></a>Configuring WebSockets</h3>
<div class="paragraph">
<p>To configure WebSockets for use in faces web applications, first enable the WebSocket endpoint using the context parameter in <code>web.xml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;context-param&gt;</span>
    <span class="tag">&lt;param-name&gt;</span>jakarta.faces.ENABLE_WEBSOCKET_ENDPOINT<span class="tag">&lt;/param-name&gt;</span>
    <span class="tag">&lt;param-value&gt;</span>true<span class="tag">&lt;/param-value&gt;</span>
<span class="tag">&lt;/context-param&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If your server is configured to run a WebSocket container on a different TCP port than the HTTP container, you can use the optional <code>jakarta.faces.WEBSOCKET_ENDPOINT_PORT</code> integer context parameter to explicitly specify the port:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;context-param&gt;</span>
    <span class="tag">&lt;param-name&gt;</span>jakarta.faces.WEBSOCKET_ENDPOINT_PORT<span class="tag">&lt;/param-name&gt;</span>
    <span class="tag">&lt;param-value&gt;</span>8000<span class="tag">&lt;/param-value&gt;</span>
<span class="tag">&lt;/context-param&gt;</span></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="websocket-usage-client-side"><a class="anchor" href="#websocket-usage-client-side"></a>WebSocket Usage: Client Side</h4>
<div class="paragraph">
<p>Declare the <code>f:websocket tag</code> in the faces view with a channel name and an <code>onmessage</code> JavaScript listener function.</p>
</div>
<div class="paragraph">
<p>The following example refers to an existing JavaScript listener function:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="tag">&lt;f:websocket</span> <span class="attribute-name">channel</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">someChannel</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">onmessage</span>=<span class="string"><span class="delimiter">&quot;</span>someWebsocketListener<span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>

<span class="keyword">function</span> <span class="function">someWebsocketListener</span>(message, channel, event) { console.log(message); }</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example declares an inline JavaScript listener function:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;f:websocket</span> <span class="attribute-name">channel</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">someChannel</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">onmessage</span>=<span class="string"><span class="delimiter">&quot;</span><span class="keyword">function</span>(m){console.log(m);}<span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>onmessage</code> JavaScript listener function is invoked with three arguments:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>message</code>: The push message as a JSON object</p>
</li>
<li>
<p><code>channel</code>: The channel name</p>
</li>
<li>
<p><code>event</code>: The <code>MessageEvent</code> instance</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When successfully connected, the WebSocket is open by default for as long as the document is open, and it will auto-reconnect, at increasing intervals, when the connection is closed, or aborted, as a result of events such as a network error or server restart.
It will not auto-reconnect when the very first connection attempt fails.
The WebSocket will be implicitly closed after the document is unloaded.</p>
</div>
</div>
<div class="sect3">
<h4 id="websocket-usage-server-side"><a class="anchor" href="#websocket-usage-server-side"></a>WebSocket Usage: Server Side</h4>
<div class="paragraph">
<p>On the Java programming side, inject a <code>PushContext</code> using the <code>@Push</code> annotation on the given channel in any CDI or container managed artifact, such as <code>@Named</code>, or <code>@WebServlet</code>, where you want to send a push message.
Then invoke <code>PushContext.send(Object)</code> with any Java object representing the push message.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span> <span class="annotation">@Push</span>
<span class="directive">private</span> PushContext someChannel;

<span class="directive">public</span> <span class="type">void</span> sendMessage(<span class="predefined-type">Object</span> message) {
    someChannel.send(message);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, the name of the channel is taken from the name of the variable into which the injection takes place.</p>
</div>
<div class="paragraph">
<p>Optionally, the channel name can be specified using the <code>channel</code> attribute.
The following example injects the push context for channel name <code>foo</code> into a variable named <code>bar</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
<span class="annotation">@Push</span>(channel=<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> PushContext bar;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The message object will be encoded as JSON and delivered as a message argument of the <code>onmessage</code> JavaScript listener function associated with the channel name.
It can be a String, but it can also be a collection, map, or a JavaBean.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-the-fwebsocket-tag"><a class="anchor" href="#using-the-fwebsocket-tag"></a>Using the f:websocket Tag</h3>
<div class="paragraph">
<p><a href="#attributes-of-the-fwebsocket-tag">Table 17-1</a> describes the attributes of the <code>f:websocket</code> tag.</p>
</div>
<table id="attributes-of-the-fwebsocket-tag" class="tableblock frame-all grid-all" style="width: 85%;">
<caption class="title">Table 17-1 Attributes of the <code>f:websocket</code> Tag</caption>
<colgroup>
<col style="width: 17.647%;">
<col style="width: 17.647%;">
<col style="width: 64.706%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>channel</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required.
The name of the WebSocket channel.
It may not be an EL expression and may only contain alphanumeric characters, hyphens, underscores, and periods.
All open WebSockets on the same channel name will receive the same push notification from the server.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional.
The identifier of the UIWebSocket component to be created.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>scope</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional.
The scope of the WebSocket channel.
It may not be an EL expression.
Allowed values (case insensitive) are: <code>application</code>, <code>session</code>, and <code>view</code>.</p>
<p class="tableblock">When the value is <code>application</code>, all channels with the same name throughout the application receive the same push message.
When the value is <code>session</code>, only the channels with the same name in the current user session receive the same push message.
When the value is <code>view</code>, only the channel in the current view receives the push message.</p>
<p class="tableblock">The default scope is <code>application</code>.
When the <code>user</code> attribute is specified, then the default scope is <code>session</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>user</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Serializable</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Optional.
The user identifier of the WebSocket channel, so that user-targeted push messages can be sent.
It must implement Serializable and preferably have a low memory footprint.</p>
</div>
<div class="paragraph">
<p><strong>Hint</strong>: Use <code>#{request.remoteUser}</code> or <code>#{someLoggedInUser.id}</code>.</p>
</div>
<div class="paragraph">
<p>All open WebSockets on the same channel and user will receive the same push message from the server.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>onopen</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional.
The JavaScript event handler function that is invoked when the WebSocket is opened.
The function is invoked with one argument: the channel name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>onmessage</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional.
The JavaScript event handler function that is invoked when a push message is received from the server.
The function is invoked with three arguments: the push message, the channel name, and the <code>MessageEvent</code> instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>onclose</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional.
The JavaScript event handler function that is invoked when the WebSocket is closed.
The function is invoked with three arguments: the close reason code, the channel name, and the <code>CloseEvent</code>.</p>
<p class="tableblock">Note that this will also be invoked on errors.
If an error occurred, you can inspect the close reason code and which code was given (for example, when the code is not <code>1000</code>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>connected</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional.
Specifies whether to auto-reconnect the WebSocket.
Defaults to <code>true</code>.
It is interpreted as a JavaScript instruction to open or close the WebSocket push connection.</p>
<p class="tableblock">This attribute is implicitly re-evaluated on every ajax request by a <code>PreRenderViewEvent</code> listener on the <code>UIViewRoot</code>.
You can also explicitly set it to <code>false</code> and then manually control it in JavaScript using <code>jsf.push.open(clientId)</code> and <code>jsf.push.close(clientId)</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rendered</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional.
Specifies whether to render the WebSocket scripts.
Defaults to <code>true</code>.</p>
<p class="tableblock">This attribute is implicitly re-evaluated on every ajax request by a <code>PreRenderViewEvent</code> listener on the <code>UIViewRoot</code>.
If the value changes to <code>false</code> while the WebSocket is already opened, then the WebSocket will implicitly be closed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>binding</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UIComponent</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional.
The value binding expression to a backing bean property bound to the component instance for the <code>UIComponent</code> created by this tag.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="websocket-scopes-and-users"><a class="anchor" href="#websocket-scopes-and-users"></a>WebSocket Scopes and Users</h3>
<div class="paragraph">
<p>By default, the WebSocket is application-scoped.
For example, any view or session throughout the web application having the same WebSocket channel open will receive the same push message.
The push message can be sent by all users and the application.
To restrict the push messages to all views in the current user session only, set the optional scope attribute to <code>session</code> .
In this case, the push message can only be sent by the user and not by the application.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;f:websocket</span> <span class="attribute-name">channel</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">someChannel</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">scope</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">session</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">...</span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To restrict the push messages to the current view only, you can set the scope attribute to <code>view</code>.
The push message will not show up in other views in the same session, even if it has the same URL.
This push message can be sent only by the user and not by the application.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;f:websocket</span> <span class="attribute-name">channel</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">someChannel</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">scope</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">view</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">...</span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The scope attribute may not be an EL expression.</p>
</div>
<div class="paragraph">
<p>Additionally, you can set the optional <code>user</code> attribute to the unique identifier of the logged-in user, usually the login name or the user ID. As such, the push message can be targeted to a specific user and can also be sent by other users and the application.
The value of the <code>user</code> attribute must implement <code>Serializable</code> and have a low memory footprint, so an entire user entity is not recommended.</p>
</div>
<div class="paragraph">
<p>For example, when you are using container managed authentication or a related framework or library:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;f:websocket</span> <span class="attribute-name">channel</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">someChannel</span><span class="delimiter">&quot;</span></span><span class="attribute-name">user</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{request.remoteUser}</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">...</span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Or, when you have a custom user entity accessible via EL, such as <code>#{someLoggedInUser}</code> which has an <code>id</code> property representing its identifier:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;f:websocket</span> <span class="attribute-name">channel</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">someChannel</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">user</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{someLoggedInUser.id}</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">...</span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When the <code>user</code> attribute is specified, the scope defaults to <code>session</code> and cannot be set to <code>application</code>.</p>
</div>
<div class="paragraph">
<p>On the server side, the push message can be targeted to the user specified in the <code>user</code> attribute using <code>PushContext.send(Object, Serializable)</code>.
The push message can be sent by all users and the application.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span> <span class="annotation">@Push</span>
<span class="directive">private</span> PushContext someChannel;

<span class="directive">public</span> <span class="type">void</span> sendMessage(<span class="predefined-type">Object</span> message, User recipientUser) {
    <span class="predefined-type">Long</span> recipientUserId = recipientUser.getId();
    someChannel.send(message, recipientUserId);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Multiple users can be targeted by passing a <code>Collection</code> holding user identifiers to <code>PushContext.send(Object, Collection)</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">void</span> sendMessage(<span class="predefined-type">Object</span> message, <span class="predefined-type">Group</span> recipientGroup) {
    <span class="predefined-type">Collection</span>&lt;<span class="predefined-type">Long</span>&gt; recipientUserIds = recipientGroup.getUserIds();
    someChannel.send(message, recipientUserIds);
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="conditionally-connecting-websockets"><a class="anchor" href="#conditionally-connecting-websockets"></a>Conditionally Connecting WebSockets</h3>
<div class="paragraph">
<p>You can use the optional connected attribute to control whether to auto-reconnect the WebSocket.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;f:websocket</span> <span class="attribute-name">...</span> <span class="attribute-name">connected</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{bean.pushable}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The connected attribute defaults to <code>true</code> and is interpreted as a JavaScript instruction to open or close the WebSocket push connection.
If the value is an EL expression and it becomes <code>false</code> during an ajax request, then the push connection will explicitly be closed during <code>oncomplete</code> of that ajax request.</p>
</div>
<div class="paragraph">
<p>You can also explicitly set it to <code>false</code> and manually open the push connection on the client side by invoking <code>jsf.push.open(clientId)</code>, passing the component&#8217;s client ID.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:commandButton</span> <span class="attribute-name">...</span> <span class="attribute-name">onclick</span>=<span class="string"><span class="delimiter">&quot;</span>jsf.push.open(<span class="string"><span class="delimiter">'</span><span class="content">foo</span><span class="delimiter">'</span></span>)<span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;f:ajax</span> <span class="attribute-name">...</span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/h:commandButton&gt;</span>
<span class="tag">&lt;f:websocket</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">channel</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">scope</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">view</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">...</span> <span class="attribute-name">connected</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you intend to have a one-time push and do not expect more messages, you can optionally explicitly close the push connection from the client side by invoking <code>jsf.push.close(clientId)</code>, passing the component&#8217;s client ID.
For example, in the <code>onmessage</code> JavaScript listener function, as seen below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="keyword">function</span> <span class="function">someWebsocketListener</span>(message) {
<span class="comment">// ... jsf.push.close('foo');</span>
}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="websocket-events-server"><a class="anchor" href="#websocket-events-server"></a>WebSocket Events: Server</h4>
<div class="paragraph">
<p>When a session or view-scoped socket is automatically closed with close reason code <code>1000</code> by the server (and thus, not manually closed by the client via <code>jsf.push.close(clientId)</code>), it means that the session or view has expired.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ApplicationScoped</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">WebsocketObserver</span> {

    <span class="directive">public</span> <span class="type">void</span> onOpen(<span class="annotation">@Observes</span> <span class="annotation">@Opened</span> WebsocketEvent event) {
        <span class="predefined-type">String</span> channel = event.getChannel();
        <span class="comment">// Returns &lt;f:websocket channel&gt;. Long userId = event.getUser();</span>
        <span class="comment">// Returns &lt;f:websocket user&gt;, if any.</span>
        <span class="comment">// ...</span>
    }

    <span class="directive">public</span> <span class="type">void</span> onClose(<span class="annotation">@Observes</span> <span class="annotation">@Closed</span> WebsocketEvent event) { <span class="predefined-type">String</span> channel = event.getChannel();
        <span class="comment">// Returns &lt;f:websocket channel&gt;. Long userId = event.getUser();</span>
        <span class="comment">// Returns &lt;f:websocket user&gt;, if any. CloseCode code = event.getCloseCode();</span>
        <span class="comment">// Returns close reason code.</span>
       <span class="comment">// ...</span>
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="websocket-events-clients"><a class="anchor" href="#websocket-events-clients"></a>WebSocket Events: Clients</h4>
<div class="paragraph">
<p>You can use the optional <code>onopen</code> JavaScript listener function to listen for the open of a WebSocket on the client side.
This function is invoked on the very first connection attempt, regardless of whether it will be successful.
It will not be invoked when the WebSocket auto-reconnects a broken connection after the first successful connection.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="tag">&lt;f:websocket</span> <span class="attribute-name">...</span> <span class="attribute-name">onopen</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">websocketOpenListener</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="keyword">function</span> <span class="function">websocketOpenListener</span>(channel) {
<span class="comment">// ...</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>onopen</code> JavaScript listener function is invoked with one argument: <code>channel</code> (the channel name, particularly useful if you have a global listener).</p>
</div>
<div class="paragraph">
<p>You can use the optional <code>onclose</code> JavaScript listener function to listen for a normal or abnormal close of a WebSocket.
This function is invoked when the very first connection attempt fails, or the server has returned close reason code <code>1000</code> (normal closure) or <code>1008</code> (policy violated), or the maximum reconnect attempts have been exceeded.
It will not be invoked if the WebSocket makes an auto-reconnect attempt on a broken connection after the first successful connection.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="tag">&lt;f:websocket</span> <span class="attribute-name">...</span> <span class="attribute-name">onclose</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">websocketCloseListener</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="keyword">function</span> <span class="function">websocketCloseListener</span>(code, channel, event) {
    <span class="keyword">if</span> (code == -<span class="integer">1</span>) {
        <span class="comment">// Websockets not supported by client.</span>
    } <span class="keyword">else</span> <span class="keyword">if</span> (code == <span class="integer">1000</span>) {
        <span class="comment">// Normal close (as result of expired session or view).</span>
    } <span class="keyword">else</span> {
        <span class="comment">// Abnormal close reason (as result of an error).</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>onclose</code> JavaScript listener function is invoked with three arguments:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>code</code>: The close reason code as an integer. If it is <code>-1</code>, the WebSocket is not supported by the client. If it is <code>1000</code>, then it was normally closed. Otherwise, if it is not <code>1000</code>, then there might be an error.</p>
</li>
<li>
<p><code>channel</code>: The channel name</p>
</li>
<li>
<p><code>event</code>: The <code>CloseEvent</code> instance</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="websocket-security-considerations"><a class="anchor" href="#websocket-security-considerations"></a>WebSocket Security Considerations</h3>
<div class="paragraph">
<p>If the WebSocket is declared in a page which is restricted to logged-in users only with a specific role, then you might want to add the push handshake request URL to the set of restricted URLs.</p>
</div>
<div class="paragraph">
<p>The push handshake request URL is composed of the URI prefix, <code>/jakarta.faces.push/</code>, followed by the channel name.
In the example of container managed security, which has already restricted an example page, <code>/user/foo.xhtml</code>, to logged-in users with the example role, <code>USER</code>, on the example URL pattern, <code>/user/*</code>, in <code>web.xml</code>, see below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;security-constraint&gt;</span>
    <span class="tag">&lt;web-resource-collection&gt;</span>
        <span class="tag">&lt;web-resource-name&gt;</span>Restrict access to role USER.<span class="tag">&lt;/web-resource-name&gt;</span>
        <span class="tag">&lt;url-pattern&gt;</span>/user/*<span class="tag">&lt;/url-pattern&gt;</span>
    <span class="tag">&lt;/web-resource-collection&gt;</span>
    <span class="tag">&lt;auth-constraint&gt;</span>
        <span class="tag">&lt;role-name&gt;</span>USER<span class="tag">&lt;/role-name&gt;</span>
    <span class="tag">&lt;/auth-constraint&gt;</span>
<span class="tag">&lt;/security-constraint&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If the page, <code>/user/foo.xhtml</code>, contains <code>&lt;f:websocket channel="foo"&gt;</code>, then you must add a restriction on the push handshake request URL pattern of <code>/jakarta.faces.push/foo</code>, as shown next:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;security-constraint&gt;</span>
    <span class="tag">&lt;web-resource-collection&gt;</span>
        <span class="tag">&lt;web-resource-name&gt;</span>Restrict access to role USER.<span class="tag">&lt;/web-resource-name&gt;</span>
        <span class="tag">&lt;url-pattern&gt;</span>/user/*<span class="tag">&lt;/url-pattern&gt;</span>
        <span class="tag">&lt;url-pattern&gt;</span>/jakarta.faces.push/foo<span class="tag">&lt;/url-pattern&gt;</span>
    <span class="tag">&lt;/web-resource-collection&gt;</span>
    <span class="tag">&lt;auth-constraint&gt;</span>
        <span class="tag">&lt;role-name&gt;</span>USER<span class="tag">&lt;/role-name&gt;</span>
    <span class="tag">&lt;/auth-constraint&gt;</span>
<span class="tag">&lt;/security-constraint&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As extra security, particularly for those public channels which cannot be restricted by security constraints, the <code>f:websocket</code> tag will register all previously declared channels in the current HTTP session, and any incoming WebSocket open request will be checked for whether it matches these channels in the current HTTP session.
If the channel is unknown (for example, randomly guessed or spoofed by end users or manually reconnected after the session is expired), then the WebSocket will immediately be closed with close reason code, <code>CloseCodes.VIOLATED_POLICY (1008)</code>.
Also, when the HTTP session gets destroyed, all session and view-scoped channels which are still open will explicitly be closed from the server side with close reason code, <code>CloseCodes.NORMAL_CLOSURE (1000)</code>.
Only application-scoped sockets remain open and are still reachable from the server even when the session or view associated with the page in the client side is expired.</p>
</div>
</div>
<div class="sect2">
<h3 id="using-ajax-with-websockets"><a class="anchor" href="#using-ajax-with-websockets"></a>Using Ajax With WebSockets</h3>
<div class="paragraph">
<p>If you want to perform complex UI updates depending on the received push message, you can nest the <code>f:ajax</code> tag inside the <code>f:websocket</code> tag.
See the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:panelGroup</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    ... (some complex UI here) ...
<span class="tag">&lt;/h:panelGroup&gt;</span>
<span class="tag">&lt;h:form&gt;</span>
    <span class="tag">&lt;f:websocket</span> <span class="attribute-name">channel</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">someChannel</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">scope</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">view</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;f:ajax</span> <span class="attribute-name">event</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">someEvent</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">listener</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{bean.pushed}</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">render</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">:foo</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;/f:websocket&gt;</span>
<span class="tag">&lt;/h:form&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, the push message simply represents the ajax event name.
You can use any custom event name.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">someChannel.send(<span class="string"><span class="delimiter">&quot;</span><span class="content">someEvent</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>An alternative is to combine the <code>f:websocket</code> tag with the <code>h:commandScript</code> tag.
The <code>&lt;f:websocket onmessage&gt;</code> references exactly the <code>&lt;h:commandScript name&gt;</code>.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:panelGroup</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    ... (some complex UI here) ...
<span class="tag">&lt;/h:panelGroup&gt;</span>
<span class="tag">&lt;f:websocket</span> <span class="attribute-name">channel</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">someChannel</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">scope</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">view</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">onmessage</span>=<span class="string"><span class="delimiter">&quot;</span>pushed<span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;h:form&gt;</span>
    <span class="tag">&lt;h:commandScript</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pushed</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{bean.pushed}</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">render</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">:foo</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/h:form&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you pass a <code>Map&lt;String,V&gt;</code> or a JavaBean as the push message object, then all entries or properties will transparently be available as request parameters in the command script method <code>#{bean.pushed}</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="jakarta-servlet-technology-2"><a class="anchor" href="#jakarta-servlet-technology-2"></a>Chapter 18. Jakarta Servlet Technology</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Jakarta Servlet technology provides dynamic, user-oriented content in web applications using a request-response programming model.</p>
</div>
<div class="sect2">
<h3 id="what-is-a-servlet"><a class="anchor" href="#what-is-a-servlet"></a>What Is a Servlet?</h3>
<div class="paragraph">
<p>A servlet is a Java programming language class used to extend the capabilities of servers that host applications accessed by means of a request-response programming model.
Although servlets can respond to any type of request, they are commonly used to extend the applications hosted by web servers.
For such applications, Jakarta Servlet technology defines HTTP-specific servlet classes.</p>
</div>
<div class="paragraph">
<p>The <code>jakarta.servlet</code> and <code>jakarta.servlet.http</code> packages provide interfaces and classes for writing servlets.
All servlets must implement the <code>Servlet</code> interface, which defines lifecycle methods.
When implementing a generic service, you can use or extend the <code>GenericServlet</code> class provided with the Jakarta Servlet API.
The <code>HttpServlet</code> class provides methods, such as <code>doGet</code> and <code>doPost</code>, for handling HTTP-specific services.</p>
</div>
</div>
<div class="sect2">
<h3 id="servlet-lifecycle"><a class="anchor" href="#servlet-lifecycle"></a>Servlet Lifecycle</h3>
<div class="paragraph">
<p>The lifecycle of a servlet is controlled by the container in which the servlet has been deployed.
When a request is mapped to a servlet, the container performs the following steps.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If an instance of the servlet does not exist, the web container:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Loads the servlet class</p>
</li>
<li>
<p>Creates an instance of the servlet class</p>
</li>
<li>
<p>Initializes the servlet instance by calling the <code>init</code> method (initialization is covered in <a href="#creating-and-initializing-a-servlet">Creating and Initializing a Servlet</a>)</p>
</li>
</ol>
</div>
</li>
<li>
<p>The container invokes the <code>service</code> method, passing request and response objects.
Service methods are discussed in <a href="#writing-service-methods">Writing Service Methods</a>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If it needs to remove the servlet, the container finalizes the servlet by calling the servlet&#8217;s <code>destroy</code> method.
For more information, see <a href="#finalizing-a-servlet">Finalizing a Servlet</a>.</p>
</div>
<div class="sect3">
<h4 id="handling-servlet-lifecycle-events"><a class="anchor" href="#handling-servlet-lifecycle-events"></a>Handling Servlet Lifecycle Events</h4>
<div class="paragraph">
<p>You can monitor and react to events in a servlet&#8217;s lifecycle by defining listener objects whose methods get invoked when lifecycle events occur.
To use these listener objects, you must define and specify the listener class.</p>
</div>
<div class="sect4">
<h5 id="defining-the-listener-class"><a class="anchor" href="#defining-the-listener-class"></a>Defining the Listener Class</h5>
<div class="paragraph">
<p>You define a listener class as an implementation of a listener interface.
<a href="#servlet-lifecycle-events">Table 18-1</a> lists the events that can be monitored and the corresponding interface that must be implemented.
When a listener method is invoked, it is passed an event that contains information appropriate to the event.
For example, the methods in the <code>HttpSessionListener</code> interface are passed an <code>HttpSessionEvent</code>, which contains an <code>HttpSession</code>.</p>
</div>
<table id="servlet-lifecycle-events" class="tableblock frame-all grid-all" style="width: 90%;">
<caption class="title">Table 18-1 Servlet Lifecycle Events</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 33.3333%;">
<col style="width: 50.0001%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Object</th>
<th class="tableblock halign-left valign-top">Event</th>
<th class="tableblock halign-left valign-top">Listener Interface and Event Class</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Web context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Initialization and destruction</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jakarta.servlet.ServletContextListener</code> and <code>ServletContextEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Web context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Attribute added, removed, or replaced</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jakarta.servlet.ServletContextAttributeListener</code> and <code>ServletContextAttributeEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Session</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Creation, invalidation, activation, passivation, and timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jakarta.servlet.http.HttpSessionListener</code>, <code>jakarta.servlet.http.HttpSessionActivationListener</code>, and <code>HttpSessionEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Session</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Attribute added, removed, or replaced</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jakarta.servlet.http.HttpSessionAttributeListener</code> and <code>HttpSessionBindingEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Request</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A servlet request has started being processed by web components</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jakarta.servlet.ServletRequestListener</code> and <code>ServletRequestEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Request</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Attribute added, removed, or replaced</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jakarta.servlet.ServletRequestAttributeListener</code> and <code>ServletRequestAttributeEvent</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Use the <code>@WebListener</code> annotation to define a listener to get events for various operations on the particular web application context.
Classes annotated with <code>@WebListener</code> must implement one of the following interfaces:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">jakarta.servlet.ServletContextListener
jakarta.servlet.ServletContextAttributeListener
jakarta.servlet.ServletRequestListener
jakarta.servlet.ServletRequestAttributeListener
jakarta.servlet..http.HttpSessionListener
jakarta.servlet..http.HttpSessionAttributeListener</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example, the following code snippet defines a listener that implements two of these interfaces:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">jakarta.servlet.ServletContextAttributeListener</span>;
<span class="keyword">import</span> <span class="include">jakarta.servlet.ServletContextListener</span>;
<span class="keyword">import</span> <span class="include">jakarta.servlet.annotation.WebListener</span>;

<span class="annotation">@WebListener</span>()
<span class="directive">public</span> <span class="type">class</span> <span class="class">SimpleServletListener</span> <span class="directive">implements</span> ServletContextListener,
        ServletContextAttributeListener {
    ...
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="handling-servlet-errors"><a class="anchor" href="#handling-servlet-errors"></a>Handling Servlet Errors</h4>
<div class="paragraph">
<p>Any number of exceptions can occur when a servlet executes.
When an exception occurs, the web container generates a default page containing the following message:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>A Servlet Exception Has Occurred</pre>
</div>
</div>
<div class="paragraph">
<p>But you can also specify that the container should return a specific error page for a given exception.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sharing-information"><a class="anchor" href="#sharing-information"></a>Sharing Information</h3>
<div class="paragraph">
<p>Web components, like most objects, usually work with other objects to accomplish their tasks.
Web components can do so by doing the following.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Using private helper objects (for example, JavaBeans components).</p>
</li>
<li>
<p>Sharing objects that are attributes of a public scope.</p>
</li>
<li>
<p>Using a database.</p>
</li>
<li>
<p>Invoking other web resources.
The Jakarta Servlet technology mechanisms that allow a web component to invoke other web resources are described in <a href="#invoking-other-web-resources">Invoking Other Web Resources</a>.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="using-scope-objects"><a class="anchor" href="#using-scope-objects"></a>Using Scope Objects</h4>
<div class="paragraph">
<p>Collaborating web components share information by means of objects that are maintained as attributes of four scope objects.
You access these attributes by using the <code>getAttribute</code> and <code>setAttribute</code> methods of the class representing the scope.
<a href="#scope-objects">Table 18-2</a> lists the scope objects.</p>
</div>
<table id="scope-objects" class="tableblock frame-all grid-all" style="width: 90%;">
<caption class="title">Table 18-2 Scope Objects</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 27.7777%;">
<col style="width: 55.5557%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Scope Object</th>
<th class="tableblock halign-left valign-top">Class</th>
<th class="tableblock halign-left valign-top">Accessible From</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Web context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jakarta.servlet.ServletContext</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Web components within a web context.
See <a href="#accessing-the-web-context">Accessing the Web Context</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Session</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jakarta.servlet.http.HttpSession</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Web components handling a request that belongs to the session.
See <a href="#maintaining-client-state">Maintaining Client State</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Request</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Subtype of <code>jakarta.servlet.ServletRequest</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Web components handling the request.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Page</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jakarta.servlet.jsp.JspContext</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Jakarta Server Pages page that creates the object.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="controlling-concurrent-access-to-shared-resources"><a class="anchor" href="#controlling-concurrent-access-to-shared-resources"></a>Controlling Concurrent Access to Shared Resources</h4>
<div class="paragraph">
<p>In a multithreaded server, shared resources can be accessed concurrently.
In addition to scope object attributes, shared resources include in-memory data, such as instance or class variables, and external objects, such as files, database connections, and network connections.</p>
</div>
<div class="paragraph">
<p>Concurrent access can arise in several situations.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Multiple web components accessing objects stored in the web context.</p>
</li>
<li>
<p>Multiple web components accessing objects stored in a session.</p>
</li>
<li>
<p>Multiple threads within a web component accessing instance variables.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A web container will typically create a thread to handle each request.
To ensure that a servlet instance handles only one request at a time, a servlet can implement the <code>SingleThreadModel</code> interface.
If a servlet implements this interface, no two threads will execute concurrently in the servlet&#8217;s service method.
A web container can implement this guarantee by synchronizing access to a single instance of the servlet or by maintaining a pool of web component instances and dispatching each new request to a free instance.
This interface does not prevent synchronization problems that result from web components' accessing shared resources, such as static class variables or external objects.</p>
</div>
<div class="paragraph">
<p>When resources can be accessed concurrently, they can be used in an inconsistent fashion.
You prevent this by controlling the access using the synchronization techniques described in the Threads lesson at <a href="https://docs.oracle.com/javase/tutorial/essential/concurrency/" class="bare" target="_blank" rel="noopener">https://docs.oracle.com/javase/tutorial/essential/concurrency/</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="creating-and-initializing-a-servlet"><a class="anchor" href="#creating-and-initializing-a-servlet"></a>Creating and Initializing a Servlet</h3>
<div class="paragraph">
<p>Use the <code>@WebServlet</code> annotation to define a servlet component in a web application.
This annotation is specified on a class and contains metadata about the servlet being declared.
The annotated servlet must specify at least one URL pattern.
This is done by using the <code>urlPatterns</code> or <code>value</code> attribute on the annotation.
All other attributes are optional, with default settings.
Use the <code>value</code> attribute when the only attribute on the annotation is the URL pattern; otherwise, use the <code>urlPatterns</code> attribute when other attributes are also used.</p>
</div>
<div class="paragraph">
<p>Classes annotated with <code>@WebServlet</code> must extend the <code>jakarta.servlet.http.HttpServlet</code> class.
For example, the following code snippet defines a servlet with the URL pattern <code>/report</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">jakarta.servlet.annotation.WebServlet</span>;
<span class="keyword">import</span> <span class="include">jakarta.servlet.http.HttpServlet</span>;

<span class="annotation">@WebServlet</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/report</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">MoodServlet</span> <span class="directive">extends</span> HttpServlet {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The web container initializes a servlet after loading and instantiating the servlet class and before delivering requests from clients.
To customize this process to allow the servlet to read persistent configuration data, initialize resources, and perform any other one-time activities, you can either override the <code>init</code> method of the <code>Servlet</code> interface or specify the <code>initParams</code> attribute of the <code>@WebServlet</code> annotation.
The <code>initParams</code> attribute contains a <code>@WebInitParam</code> annotation.
If it cannot complete its initialization process, a servlet throws an <code>UnavailableException</code>.</p>
</div>
<div class="paragraph">
<p>Use an initialization parameter to provide data needed by a particular servlet.
By contrast, a context parameter provides data that is available to all components of a web application.</p>
</div>
</div>
<div class="sect2">
<h3 id="writing-service-methods"><a class="anchor" href="#writing-service-methods"></a>Writing Service Methods</h3>
<div class="paragraph">
<p>The service provided by a servlet is implemented in the <code>service</code> method of a <code>GenericServlet</code>, in the <code>do<em>Method</em></code> methods (where <em>Method</em> can take the value <code>Get</code>, <code>Delete</code>, <code>Options</code>, <code>Post</code>, <code>Put</code>, or <code>Trace</code>) of an <code>HttpServlet</code> object, or in any other protocol-specific methods defined by a class that implements the <code>Servlet</code> interface.
The term service method is used for any method in a servlet class that provides a service to a client.</p>
</div>
<div class="paragraph">
<p>The general pattern for a service method is to extract information from the request, access external resources, and then populate the response, based on that information.
For HTTP servlets, the correct procedure for populating the response is to do the following:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Retrieve an output stream from the response.</p>
</li>
<li>
<p>Fill in the response headers.</p>
</li>
<li>
<p>Write any body content to the output stream.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Response headers must always be set before the response has been committed.
The web container will ignore any attempt to set or add headers after the response has been committed.
The next two sections describe how to get information from requests and generate responses.</p>
</div>
<div class="sect3">
<h4 id="getting-information-from-requests"><a class="anchor" href="#getting-information-from-requests"></a>Getting Information from Requests</h4>
<div class="paragraph">
<p>A request contains data passed between a client and the servlet.
All requests implement the <code>ServletRequest</code> interface.
This interface defines methods for accessing the following information:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Parameters, which are typically used to convey information between clients and servlets</p>
</li>
<li>
<p>Object-valued attributes, which are typically used to pass information between the web container and a servlet or between collaborating servlets</p>
</li>
<li>
<p>Information about the protocol used to communicate the request and about the client and server involved in the request</p>
</li>
<li>
<p>Information relevant to localization</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can also retrieve an input stream from the request and manually parse the data.
To read character data, use the <code>BufferedReader</code> object returned by the request&#8217;s <code>getReader</code> method.
To read binary data, use the <code>ServletInputStream</code> returned by <code>getInputStream</code>.</p>
</div>
<div class="paragraph">
<p>HTTP servlets are passed an HTTP request object, <code>HttpServletRequest</code>, which contains the request URL, HTTP headers, query string, and so on.
An HTTP request URL contains the following parts:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>http://[host]:[port][request-path]?[query-string]</pre>
</div>
</div>
<div class="paragraph">
<p>The request path is further composed of the following elements.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Context path: A concatenation of a forward slash (<code>/</code>) with the context root of the servlet&#8217;s web application.</p>
</li>
<li>
<p>Servlet path: The path section that corresponds to the component alias that activated this request.
This path starts with a forward slash (<code>/</code>).</p>
</li>
<li>
<p>Path info: The part of the request path that is not part of the context path or the servlet path.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can use the <code>getContextPath</code>, <code>getServletPath</code>, and <code>getPathInfo</code> methods of the <code>HttpServletRequest</code> interface to access this information.
Except for URL encoding differences between the request URI and the path parts, the request URI is always comprised of the context path plus the servlet path plus the path info.</p>
</div>
<div class="paragraph">
<p>Query strings are composed of a set of parameters and values.
Individual parameters are retrieved from a request by using the <code>getParameter</code> method.
There are two ways to generate query strings.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A query string can explicitly appear in a web page.</p>
</li>
<li>
<p>A query string is appended to a URL when a form with a <code>GET</code> HTTP method is submitted.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="constructing-responses"><a class="anchor" href="#constructing-responses"></a>Constructing Responses</h4>
<div class="paragraph">
<p>A response contains data passed between a server and the client.
All responses implement the <code>ServletResponse</code> interface.
This interface defines methods that allow you to do the following.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Retrieve an output stream to use to send data to the client.
To send character data, use the <code>PrintWriter</code> returned by the response&#8217;s <code>getWriter</code> method.
To send binary data in a Multipurpose Internet Mail Extensions (MIME) body response, use the <code>ServletOutputStream</code> returned by <code>getOutputStream</code>.
To mix binary and text data, as in a multipart response, use a <code>ServletOutputStream</code> and manage the character sections manually.</p>
</li>
<li>
<p>Indicate the content type (for example, <code>text/html</code>) being returned by the response with the <code>setContentType(String)</code> method.
This method must be called before the response is committed.
A registry of content type names is kept by the Internet Assigned Numbers Authority (IANA) at <a href="https://www.iana.org/assignments/media-types/" class="bare" target="_blank" rel="noopener">https://www.iana.org/assignments/media-types/</a>.</p>
</li>
<li>
<p>Indicate whether to buffer output with the <code>setBufferSize(int)</code> method.
By default, any content written to the output stream is immediately sent to the client.
Buffering allows content to be written before anything is sent back to the client, thus providing the servlet with more time to set appropriate status codes and headers or forward to another web resource.
The method must be called before any content is written or before the response is committed.</p>
</li>
<li>
<p>Set localization information, such as locale and character encoding.
See <a href="#internationalizing-and-localizing-web-applications">Chapter 22, <em>Internationalizing and Localizing Web Applications</em></a> for details.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>HTTP response objects, <code>jakarta.servlet.http.HttpServletResponse</code>, have fields representing HTTP headers, such as the following.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Status codes, which are used to indicate the reason a request is not satisfied or that a request has been redirected.</p>
</li>
<li>
<p>Cookies, which are used to store application-specific information at the client.
Sometimes, cookies are used to maintain an identifier for tracking a user&#8217;s session (see <a href="#session-tracking">Session Tracking</a>).</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="filtering-requests-and-responses"><a class="anchor" href="#filtering-requests-and-responses"></a>Filtering Requests and Responses</h3>
<div class="paragraph">
<p>A filter is an object that can transform the header and content (or both) of a request or response.
Filters differ from web components in that filters usually do not themselves create a response.
Instead, a filter provides functionality that can be "attached" to any kind of web resource.
Consequently, a filter should not have any dependencies on a web resource for which it is acting as a filter; this way, it can be composed with more than one type of web resource.</p>
</div>
<div class="paragraph">
<p>The main tasks that a filter can perform are as follows.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Query the request and act accordingly.</p>
</li>
<li>
<p>Block the request-and-response pair from passing any further.</p>
</li>
<li>
<p>Modify the request headers and data.
You do this by providing a customized version of the request.</p>
</li>
<li>
<p>Modify the response headers and data.
You do this by providing a customized version of the response.</p>
</li>
<li>
<p>Interact with external resources.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Applications of filters include authentication, logging, image conversion, data compression, encryption, tokenizing streams, XML transformations, and so on.</p>
</div>
<div class="paragraph">
<p>You can configure a web resource to be filtered by a chain of zero, one, or more filters in a specific order.
This chain is specified when the web application containing the component is deployed and is instantiated when a web container loads the component.</p>
</div>
<div class="sect3">
<h4 id="programming-filters"><a class="anchor" href="#programming-filters"></a>Programming Filters</h4>
<div class="paragraph">
<p>The filtering API is defined by the <code>Filter</code>, <code>FilterChain</code>, and <code>FilterConfig</code> interfaces in the <code>jakarta.servlet</code> package.
You define a filter by implementing the <code>Filter</code> interface.</p>
</div>
<div class="paragraph">
<p>Use the <code>@WebFilter</code> annotation to define a filter in a web application.
This annotation is specified on a class and contains metadata about the filter being declared.
The annotated filter must specify at least one URL pattern.
This is done by using the <code>urlPatterns</code> or <code>value</code> attribute on the annotation.
All other attributes are optional, with default settings.
Use the <code>value</code> attribute when the only attribute on the annotation is the URL pattern; use the <code>urlPatterns</code> attribute when other attributes are also used.</p>
</div>
<div class="paragraph">
<p>Classes annotated with the <code>@WebFilter</code> annotation must implement the <code>jakarta.servlet.Filter</code> interface.</p>
</div>
<div class="paragraph">
<p>To add configuration data to the filter, specify the <code>initParams</code> attribute of the <code>@WebFilter</code> annotation.
The <code>initParams</code> attribute contains a <code>@WebInitParam</code> annotation.
The following code snippet defines a filter, specifying an initialization parameter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">jakarta.servlet.Filter</span>;
<span class="keyword">import</span> <span class="include">jakarta.servlet.annotation.WebFilter</span>;
<span class="keyword">import</span> <span class="include">jakarta.servlet.annotation.WebInitParam</span>;

<span class="annotation">@WebFilter</span>(filterName = <span class="string"><span class="delimiter">&quot;</span><span class="content">TimeOfDayFilter</span><span class="delimiter">&quot;</span></span>, urlPatterns = {<span class="string"><span class="delimiter">&quot;</span><span class="content">/*</span><span class="delimiter">&quot;</span></span>},
initParams = {<span class="annotation">@WebInitParam</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">mood</span><span class="delimiter">&quot;</span></span>, value = <span class="string"><span class="delimiter">&quot;</span><span class="content">awake</span><span class="delimiter">&quot;</span></span>)})
<span class="directive">public</span> <span class="type">class</span> <span class="class">TimeOfDayFilter</span> <span class="directive">implements</span> <span class="predefined-type">Filter</span> {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The most important method in the <code>Filter</code> interface is <code>doFilter</code>, which is passed request, response, and filter chain objects.
This method can perform the following actions.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Examine the request headers.</p>
</li>
<li>
<p>Customize the request object if the filter wishes to modify request headers or data.</p>
</li>
<li>
<p>Customize the response object if the filter wishes to modify response headers or data.</p>
</li>
<li>
<p>Invoke the next entity in the filter chain.
If the current filter is the last filter in the chain that ends with the target web component or static resource, the next entity is the resource at the end of the chain; otherwise, it is the next filter that was configured in the WAR.
The filter invokes the next entity by calling the <code>doFilter</code> method on the chain object, passing in the request and response it was called with or the wrapped versions it may have created.
Alternatively, the filter can choose to block the request by not making the call to invoke the next entity.
In the latter case, the filter is responsible for filling out the response.</p>
</li>
<li>
<p>Examine response headers after invoking the next filter in the chain.</p>
</li>
<li>
<p>Throw an exception to indicate an error in processing.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In addition to <code>doFilter</code>, you must implement the <code>init</code> and <code>destroy</code> methods.
The <code>init</code> method is called by the container when the filter is instantiated.
If you wish to pass initialization parameters to the filter, you retrieve them from the <code>FilterConfig</code> object passed to <code>init</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="programming-customized-requests-and-responses"><a class="anchor" href="#programming-customized-requests-and-responses"></a>Programming Customized Requests and Responses</h4>
<div class="paragraph">
<p>There are many ways for a filter to modify a request or a response.
For example, a filter can add an attribute to the request or can insert data in the response.</p>
</div>
<div class="paragraph">
<p>A filter that modifies a response must usually capture the response before it is returned to the client.
To do this, you pass a stand-in stream to the servlet that generates the response.
The stand-in stream prevents the servlet from closing the original response stream when it completes and allows the filter to modify the servlet&#8217;s response.</p>
</div>
<div class="paragraph">
<p>To pass this stand-in stream to the servlet, the filter creates a response wrapper that overrides the <code>getWriter</code> or <code>getOutputStream</code> method to return this stand-in stream.
The wrapper is passed to the <code>doFilter</code> method of the filter chain.
Wrapper methods default to calling through to the wrapped request or response object.</p>
</div>
<div class="paragraph">
<p>To override request methods, you wrap the request in an object that extends either <code>ServletRequestWrapper</code> or <code>HttpServletRequestWrapper</code>.
To override response methods, you wrap the response in an object that extends either <code>ServletResponseWrapper</code> or <code>HttpServletResponseWrapper</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="specifying-filter-mappings"><a class="anchor" href="#specifying-filter-mappings"></a>Specifying Filter Mappings</h4>
<div class="paragraph">
<p>A web container uses filter mappings to decide how to apply filters to web resources.
A filter mapping matches a filter to a web component by name or to web resources by URL pattern.
The filters are invoked in the order in which filter mappings appear in the filter mapping list of a WAR.
You specify a filter mapping list for a WAR in its deployment descriptor by either using NetBeans IDE or coding the list by hand with XML.</p>
</div>
<div class="paragraph">
<p>If you want to log every request to a web application, you map the hit counter filter to the URL pattern <code>/*</code>.</p>
</div>
<div class="paragraph">
<p>You can map a filter to one or more web resources, and you can map more than one filter to a web resource.
This is illustrated in <a href="#filter-to-servlet-mapping">Figure 18-1</a>, in which filter F1 is mapped to servlets S1, S2, and S3; filter F2 is mapped to servlet S2; and filter F3 is mapped to servlets S1 and S2.</p>
</div>
<div id="filter-to-servlet-mapping" class="imageblock">
<div class="content">
<img src="images/jakartaeett_dt_018.svg" alt="Diagram of filter-to-servlet mapping with filters F1-F3 and servlets S1-S3. F1 filters S1-S3, then F2 filters S2, then F3 filters S1 and S2.">
</div>
<div class="title">Figure 18-1 Filter-to-Servlet Mapping</div>
</div>
<div class="paragraph">
<p>Recall that a filter chain is one of the objects passed to the <code>doFilter</code> method of a filter.
This chain is formed indirectly by means of filter mappings.
The order of the filters in the chain is the same as the order in which filter mappings appear in the web application deployment descriptor.</p>
</div>
<div class="paragraph">
<p>When a filter is mapped to servlet S1, the web container invokes the <code>doFilter</code> method of F1.
The <code>doFilter</code> method of each filter in S1&#8217;s filter chain is invoked by the preceding filter in the chain by means of the <code>chain.doFilter</code> method.
Because S1&#8217;s filter chain contains filters F1 and F3, F1&#8217;s call to <code>chain.doFilter</code> invokes the <code>doFilter</code> method of filter F3.
When F3&#8217;s <code>doFilter</code> method completes, control returns to F1&#8217;s <code>doFilter</code> method.</p>
</div>
<div class="sect4">
<h5 id="to-specify-filter-mappings-using-netbeans-ide"><a class="anchor" href="#to-specify-filter-mappings-using-netbeans-ide"></a>To Specify Filter Mappings Using NetBeans IDE</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Expand the application&#8217;s project node in the <strong>Project</strong> tab.</p>
</li>
<li>
<p>Expand the <strong>Web Pages</strong> and <strong>WEB-INF</strong> nodes under the project node.</p>
</li>
<li>
<p>Double-click <code>web.xml</code>.</p>
</li>
<li>
<p>Click <strong>Filters</strong> at the top of the editor window.</p>
</li>
<li>
<p>Expand the <strong>Servlet Filters</strong> node in the editor window.</p>
</li>
<li>
<p>Click <strong>Add Filter Element</strong> to map the filter to a web resource by name or by URL pattern.</p>
</li>
<li>
<p>In the Add Servlet Filter dialog box, enter the name of the filter in the <strong>Filter Name</strong> field.</p>
</li>
<li>
<p>Click <strong>Browse</strong> to locate the servlet class to which the filter applies.</p>
<div class="paragraph">
<p>You can include wildcard characters so that you can apply the filter to more than one servlet.</p>
</div>
</li>
<li>
<p>Click <strong>OK</strong>.</p>
</li>
<li>
<p>To constrain how the filter is applied to requests, follow these steps:</p>
<div class="openblock">
<div class="content">
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Expand the <strong>Filter Mappings</strong> node.</p>
</li>
<li>
<p>Select the filter from the list of filters.</p>
</li>
<li>
<p>Click <strong>Add</strong>.</p>
</li>
<li>
<p>In the Add Filter Mapping dialog box, select one of the following dispatcher types:</p>
</li>
</ol>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
REQUEST
</td>
<td class="hdlist2">
<p>Only when the request comes directly from the client</p>
</td>
</tr>
<tr>
<td class="hdlist1">
ASYNC
</td>
<td class="hdlist2">
<p>Only when the asynchronous request comes from the client</p>
</td>
</tr>
<tr>
<td class="hdlist1">
FORWARD
</td>
<td class="hdlist2">
<p>Only when the request has been forwarded to a component (see <a href="#transferring-control-to-another-web-component">Transferring Control to Another Web Component</a>)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
INCLUDE
</td>
<td class="hdlist2">
<p>Only when the request is being processed by a component that has been included (see <a href="#including-other-resources-in-the-response">Including Other Resources in the Response</a>)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
ERROR
</td>
<td class="hdlist2">
<p>Only when the request is being processed with the error page mechanism (see <a href="#handling-servlet-errors">Handling Servlet Errors</a>)</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can direct the filter to be applied to any combination of the preceding situations by selecting multiple dispatcher types.
If no types are specified, the default option is <strong>REQUEST</strong>.</p>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="invoking-other-web-resources"><a class="anchor" href="#invoking-other-web-resources"></a>Invoking Other Web Resources</h3>
<div class="paragraph">
<p>Web components can invoke other web resources both indirectly and directly.
A web component indirectly invokes another web resource by embedding a URL that points to another web component in content returned to a client.
While it is executing, a web component directly invokes another resource by either including the content of another resource or forwarding a request to another resource.</p>
</div>
<div class="paragraph">
<p>To invoke a resource available on the server that is running a web component, you must first obtain a <code>RequestDispatcher</code> object by using the <code>getRequestDispatcher("URL")</code> method.
You can get a <code>RequestDispatcher</code> object from either a request or the web context; however, the two methods have slightly different behavior.
The method takes the path to the requested resource as an argument.
A request can take a relative path (that is, one that does not begin with a <code>/</code>), but the web context requires an absolute path.
If the resource is not available or if the server has not implemented a <code>RequestDispatcher</code> object for that type of resource, <code>getRequestDispatcher</code> will return null.
Your servlet should be prepared to deal with this condition.</p>
</div>
<div class="sect3">
<h4 id="including-other-resources-in-the-response"><a class="anchor" href="#including-other-resources-in-the-response"></a>Including Other Resources in the Response</h4>
<div class="paragraph">
<p>It is often useful to include another web resource, such as banner content or copyright information, in the response returned from a web component.
To include another resource, invoke the <code>include</code> method of a <code>RequestDispatcher</code> object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">include(request, response);</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the resource is static, the <code>include</code> method enables programmatic server-side includes.
If the resource is a web component, the effect of the method is to send the request to the included web component, execute the web component, and then include the result of the execution in the response from the containing servlet.
An included web component has access to the request object but is limited in what it can do with the response object.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It can write to the body of the response and commit a response.</p>
</li>
<li>
<p>It cannot set headers or call any method, such as <code>setCookie</code>, that affects the headers of the response.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="transferring-control-to-another-web-component"><a class="anchor" href="#transferring-control-to-another-web-component"></a>Transferring Control to Another Web Component</h4>
<div class="paragraph">
<p>In some applications, you might want to have one web component do preliminary processing of a request and have another component generate the response.
For example, you might want to partially process a request and then transfer to another component, depending on the nature of the request.</p>
</div>
<div class="paragraph">
<p>To transfer control to another web component, you invoke the <code>forward</code> method of a <code>RequestDispatcher</code>.
When a request is forwarded, the request URL is set to the path of the forwarded page.
The original URI and its constituent parts are saved as the following request attributes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">jakarta.servlet.forward.request_uri
jakarta.servlet.forward.context_path
jakarta.servlet.forward.servlet_path
jakarta.servlet.forward.path_info
jakarta.servlet.forward.query_string</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>forward</code> method should be used to give another resource responsibility for replying to the user.
If you have already accessed a <code>ServletOutputStream</code> or <code>PrintWriter</code> object within the servlet, you cannot use this method; doing so throws an <code>IllegalStateException</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="accessing-the-web-context"><a class="anchor" href="#accessing-the-web-context"></a>Accessing the Web Context</h3>
<div class="paragraph">
<p>The context in which web components execute is an object that implements the <code>ServletContext</code> interface.
You retrieve the web context by using the <code>getServletContext</code> method.
The web context provides methods for accessing</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Initialization parameters</p>
</li>
<li>
<p>Resources associated with the web context</p>
</li>
<li>
<p>Object-valued attributes</p>
</li>
<li>
<p>Logging capabilities</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The counter&#8217;s access methods are synchronized to prevent incompatible operations by servlets that are running concurrently.
A filter retrieves the counter object by using the context&#8217;s <code>getAttribute</code> method.
The incremented value of the counter is recorded in the log.</p>
</div>
</div>
<div class="sect2">
<h3 id="maintaining-client-state"><a class="anchor" href="#maintaining-client-state"></a>Maintaining Client State</h3>
<div class="paragraph">
<p>Many applications require that a series of requests from a client be associated with one another.
For example, a web application can save the state of a user&#8217;s shopping cart across requests.
Web-based applications are responsible for maintaining such state, called a session, because HTTP is stateless.
To support applications that need to maintain state, Jakarta Servlet technology provides an API for managing sessions and allows several mechanisms for implementing sessions.</p>
</div>
<div class="sect3">
<h4 id="accessing-a-session"><a class="anchor" href="#accessing-a-session"></a>Accessing a Session</h4>
<div class="paragraph">
<p>Sessions are represented by an <code>HttpSession</code> object.
You access a session by calling the <code>getSession</code> method of a request object.
This method returns the current session associated with this request; or, if the request does not have a session, this method creates one.</p>
</div>
</div>
<div class="sect3">
<h4 id="associating-objects-with-a-session"><a class="anchor" href="#associating-objects-with-a-session"></a>Associating Objects with a Session</h4>
<div class="paragraph">
<p>You can associate object-valued attributes with a session by name.
Such attributes are accessible by any web component that belongs to the same web context and is handling a request that is part of the same session.</p>
</div>
<div class="paragraph">
<p>Recall that your application can notify web context and session listener objects of servlet lifecycle events (<a href="#handling-servlet-lifecycle-events">Handling Servlet Lifecycle Events</a>).
You can also notify objects of certain events related to their association with a session, such as the following.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When the object is added to or removed from a session.
To receive this notification, your object must implement the <code>jakarta.servlet.http.HttpSessionBindingListener</code> interface.</p>
</li>
<li>
<p>When the session to which the object is attached will be passivated or activated.
A session will be passivated or activated when it is moved between virtual machines or saved to and restored from persistent storage.
To receive this notification, your object must implement the <code>jakarta.servlet.http.HttpSessionActivationListener</code> interface.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="session-management"><a class="anchor" href="#session-management"></a>Session Management</h4>
<div class="paragraph">
<p>Because an HTTP client has no way to signal that it no longer needs a session, each session has an associated timeout so that its resources can be reclaimed.
The timeout period can be accessed by using a session&#8217;s <code>getMaxInactiveInterval</code> and <code>setMaxInactiveInterval</code> methods.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To ensure that an active session is not timed out, you should periodically access the session by using service methods because this resets the session&#8217;s time-to-live counter.</p>
</li>
<li>
<p>When a particular client interaction is finished, you use the session&#8217;s <code>invalidate</code> method to invalidate a session on the server side and remove any session data.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="to-set-the-timeout-period-using-netbeans-ide"><a class="anchor" href="#to-set-the-timeout-period-using-netbeans-ide"></a>To Set the Timeout Period Using NetBeans IDE</h5>
<div class="paragraph">
<p>To set the timeout period in the deployment descriptor using NetBeans IDE, follow these steps.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open the project if you haven&#8217;t already.</p>
</li>
<li>
<p>Expand the node of your project in the <strong>Projects</strong> tab.</p>
</li>
<li>
<p>Expand the <strong>Web Pages</strong> and <strong>WEB-INF</strong> nodes that are under the project node.</p>
</li>
<li>
<p>Double-click <code>web.xml</code>.</p>
</li>
<li>
<p>Click <strong>General</strong> at the top of the editor.</p>
</li>
<li>
<p>In the <strong>Session Timeout</strong> field, enter an integer value.</p>
<div class="paragraph">
<p>The integer value represents the number of minutes of inactivity that must pass before the session times out.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="session-tracking"><a class="anchor" href="#session-tracking"></a>Session Tracking</h4>
<div class="paragraph">
<p>To associate a session with a user, a web container can use several methods, all of which involve passing an identifier between the client and the server.
The identifier can be maintained on the client as a cookie, or the web component can include the identifier in every URL that is returned to the client.</p>
</div>
<div class="paragraph">
<p>If your application uses session objects, you must ensure that session tracking is enabled by having the application rewrite URLs whenever the client turns off cookies.
You do this by calling the response&#8217;s <code>encodeURL(URL)</code> method on all URLs returned by a servlet.
This method includes the session ID in the URL only if cookies are disabled; otherwise, the method returns the URL unchanged.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="finalizing-a-servlet"><a class="anchor" href="#finalizing-a-servlet"></a>Finalizing a Servlet</h3>
<div class="paragraph">
<p>The web container may determine that a servlet should be removed from service (for example, when a container wants to reclaim memory resources or when it is being shut down).
In such a case, the container calls the <code>destroy</code> method of the <code>Servlet</code> interface.
In this method, you release any resources the servlet is using and save any persistent state.
The <code>destroy</code> method releases the database object created in the <code>init</code> method.</p>
</div>
<div class="paragraph">
<p>A servlet&#8217;s service methods should all be complete when a servlet is removed.
The server tries to ensure this by calling the <code>destroy</code> method only after all service requests have returned or after a server-specific grace period, whichever comes first.
If your servlet has operations that may run longer than the server&#8217;s grace period, the operations could still be running when <code>destroy</code> is called.
You must make sure that any threads still handling client requests complete.</p>
</div>
<div class="paragraph">
<p>The remainder of this section explains how to do the following.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Keep track of how many threads are currently running the <code>service</code> method.</p>
</li>
<li>
<p>Provide a clean shutdown by having the <code>destroy</code> method notify long-running threads of the shutdown and wait for them to complete.</p>
</li>
<li>
<p>Have the long-running methods poll periodically to check for shutdown and, if necessary, stop working, clean up, and return.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="tracking-service-requests"><a class="anchor" href="#tracking-service-requests"></a>Tracking Service Requests</h4>
<div class="paragraph">
<p>To track service requests:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Include a field in your servlet class that counts the number of service methods that are running.</p>
<div class="paragraph">
<p>The field should have synchronized access methods to increment, decrement, and return its value:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ShutdownExample</span> <span class="directive">extends</span> HttpServlet {
    <span class="directive">private</span> <span class="type">int</span> serviceCounter = <span class="integer">0</span>;
    ...
    <span class="comment">// Access methods for serviceCounter</span>
    protected <span class="directive">synchronized</span> <span class="type">void</span> enteringServiceMethod() {
        serviceCounter++;
    }
    <span class="directive">protected</span> <span class="directive">synchronized</span> <span class="type">void</span> leavingServiceMethod() {
        serviceCounter--;
    }
    <span class="directive">protected</span> <span class="directive">synchronized</span> <span class="type">int</span> numServices() {
        <span class="keyword">return</span> serviceCounter;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>service</code> method should increment the service counter each time the method is entered and should decrement the counter each time the method returns.
This is one of the few times that your <code>HttpServlet</code> subclass should override the <code>service</code> method.
The new method should call <code>super.service</code> to preserve the functionality of the original <code>service</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">protected</span> <span class="type">void</span> service(HttpServletRequest req,
                       HttpServletResponse resp)
                       <span class="directive">throws</span> ServletException,<span class="exception">IOException</span> {
    enteringServiceMethod();
    <span class="keyword">try</span> {
        <span class="local-variable">super</span>.service(req, resp);
    } <span class="keyword">finally</span> {
        leavingServiceMethod();
    }
}</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="notifying-methods-to-shut-down"><a class="anchor" href="#notifying-methods-to-shut-down"></a>Notifying Methods to Shut Down</h4>
<div class="paragraph">
<p>To ensure a clean shutdown, your <code>destroy</code> method should not release any shared resources until all the service requests have completed:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Check the service counter.</p>
</li>
<li>
<p>Notify long-running methods that it is time to shut down.</p>
<div class="paragraph">
<p>For this notification, another field is required.
The field should have the usual access methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ShutdownExample</span> <span class="directive">extends</span> HttpServlet {
    <span class="directive">private</span> <span class="type">boolean</span> shuttingDown;
    ...
    <span class="comment">//Access methods for shuttingDown</span>
    protected <span class="directive">synchronized</span> <span class="type">void</span> setShuttingDown(<span class="type">boolean</span> flag) {
        shuttingDown = flag;
    }
    <span class="directive">protected</span> <span class="directive">synchronized</span> <span class="type">boolean</span> isShuttingDown() {
        <span class="keyword">return</span> shuttingDown;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is an example of the <code>destroy</code> method using these fields to provide a clean shutdown:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">void</span> destroy() {
    <span class="comment">/* Check to see whether there are still service methods /*
    /* running, and if there are, tell them to stop. */</span>
    <span class="keyword">if</span> (numServices() &gt; <span class="integer">0</span>) {
        setShuttingDown(<span class="predefined-constant">true</span>);
    }

    <span class="comment">/* Wait for the service methods to stop. */</span>
    <span class="keyword">while</span> (numServices() &gt; <span class="integer">0</span>) {
        <span class="keyword">try</span> {
            <span class="predefined-type">Thread</span>.sleep(interval);
        } <span class="keyword">catch</span> (<span class="exception">InterruptedException</span> e) {
        }
    }
}</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="creating-polite-long-running-methods"><a class="anchor" href="#creating-polite-long-running-methods"></a>Creating Polite Long-Running Methods</h4>
<div class="paragraph">
<p>The final step in providing a clean shutdown is to make any long-running methods behave politely.
Methods that might run for a long time should check the value of the field that notifies them of shutdowns and should interrupt their work, if necessary:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">void</span> doPost(...) {
    ...
    for(i = <span class="integer">0</span>; ((i &lt; lotsOfStuffToDo) &amp;&amp;
         !isShuttingDown()); i++) {
        <span class="keyword">try</span> {
            partOfLongRunningOperation(i);
        } <span class="keyword">catch</span> (<span class="exception">InterruptedException</span> e) {
            ...
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="uploading-files-with-jakarta-servlet-technology"><a class="anchor" href="#uploading-files-with-jakarta-servlet-technology"></a>Uploading Files with Jakarta Servlet Technology</h3>
<div class="paragraph">
<p>Supporting file uploads is a very basic and common requirement for many web applications.
In prior versions of the Servlet specification, implementing file upload required the use of external libraries or complex input processing.
The Jakarta Servlet specification now helps to provide a viable solution to the problem in a generic and portable way.
Jakarta Servlet technology now supports file upload out of the box, so any web container that implements the specification can parse multipart requests and make mime attachments available through the <code>HttpServletRequest</code> object.</p>
</div>
<div class="paragraph">
<p>A new annotation, <code>jakarta.servlet.annotation.MultipartConfig</code>, is used to indicate that the servlet on which it is declared expects requests to be made using the <code>multipart/form-data</code> MIME type.
Servlets that are annotated with <code>@MultipartConfig</code> can retrieve the <code>Part</code> components of a given <code>multipart/form-data</code> request by calling the <code>request.getPart(String name)</code> or <code>request.getParts()</code> method.</p>
</div>
<div class="sect3">
<h4 id="the-multipartconfig-annotation"><a class="anchor" href="#the-multipartconfig-annotation"></a>The @MultipartConfig Annotation</h4>
<div class="paragraph">
<p>The <code>@MultipartConfig</code> annotation supports the following optional attributes.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>location</code>: An absolute path to a directory on the file system.
The <code>location</code> attribute does not support a path relative to the application context.
This location is used to store files temporarily while the parts are processed or when the size of the file exceeds the specified <code>fileSizeThreshold</code> setting.
The default location is <code>""</code>.</p>
</li>
<li>
<p><code>fileSizeThreshold</code>: The file size in bytes after which the file will be temporarily stored on disk.
The default size is 0 bytes.</p>
</li>
<li>
<p><code>maxFileSize</code>: The maximum size allowed for uploaded files, in bytes.
If the size of any uploaded file is greater than this size, the web container will throw an exception (<code>IllegalStateException</code>).
The default size is unlimited.</p>
</li>
<li>
<p><code>maxRequestSize</code>: The maximum size allowed for a <code>multipart/form-data</code> request, in bytes.
The web container will throw an exception if the overall size of all uploaded files exceeds this threshold.
The default size is unlimited.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For, example, the <code>@MultipartConfig</code> annotation could be constructed as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@MultipartConfig</span>(location=<span class="string"><span class="delimiter">&quot;</span><span class="content">/tmp</span><span class="delimiter">&quot;</span></span>, fileSizeThreshold=<span class="integer">1024</span>*<span class="integer">1024</span>,
    maxFileSize=<span class="integer">1024</span>*<span class="integer">1024</span>*<span class="integer">5</span>, maxRequestSize=<span class="integer">1024</span>*<span class="integer">1024</span>*<span class="integer">5</span>*<span class="integer">5</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Instead of using the <code>@MultipartConfig</code> annotation to hard-code these attributes in your file upload servlet, you could add the following as a child element of the servlet configuration element in the <code>web.xml</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;multipart-config&gt;</span>
    <span class="tag">&lt;location&gt;</span>/tmp<span class="tag">&lt;/location&gt;</span>
    <span class="tag">&lt;max-file-size&gt;</span>20848820<span class="tag">&lt;/max-file-size&gt;</span>
    <span class="tag">&lt;max-request-size&gt;</span>418018841<span class="tag">&lt;/max-request-size&gt;</span>
    <span class="tag">&lt;file-size-threshold&gt;</span>1048576<span class="tag">&lt;/file-size-threshold&gt;</span>
<span class="tag">&lt;/multipart-config&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="the-getparts-and-getpart-methods"><a class="anchor" href="#the-getparts-and-getpart-methods"></a>The getParts and getPart Methods</h4>
<div class="paragraph">
<p>The Servlet specification supports two additional <code>HttpServletRequest</code> methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Collection&lt;Part&gt; getParts()</code></p>
</li>
<li>
<p><code>Part getPart(String name)</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>request.getParts()</code> method returns collections of all <code>Part</code> objects.
If you have more than one input of type file, multiple <code>Part</code> objects are returned.
Because <code>Part</code> objects are named, the <code>getPart(String name)</code> method can be used to access a particular <code>Part</code>.
Alternatively, the <code>getParts()</code> method, which returns an <code>Iterable&lt;Part&gt;</code>, can be used to get an <code>Iterator</code> over all the <code>Part</code> objects.</p>
</div>
<div class="paragraph">
<p>The <code>jakarta.servlet.http.Part</code> interface is a simple one, providing methods that allow introspection of each <code>Part</code>.
The methods do the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Retrieve the name, size, and content-type of the <code>Part</code></p>
</li>
<li>
<p>Query the headers submitted with a <code>Part</code></p>
</li>
<li>
<p>Delete a <code>Part</code></p>
</li>
<li>
<p>Write a <code>Part</code> out to disk</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, the <code>Part</code> interface provides the <code>write(String filename)</code> method to write the file with the specified name.
The file can then be saved in the directory that is specified with the <code>location</code> attribute of the <code>@MultipartConfig</code> annotation or, in the case of the <code>fileupload</code> example, in the location specified by the Destination field in the form.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="asynchronous-processing"><a class="anchor" href="#asynchronous-processing"></a>Asynchronous Processing</h3>
<div class="paragraph">
<p>Web containers in application servers normally use a server thread per client request.
Under heavy load conditions, containers need a large amount of threads to serve all the client requests.
Scalability limitations include running out of memory or exhausting the pool of container threads.
To create scalable web applications, you must ensure that no threads associated with a request are sitting idle, so the container can use them to process new requests.</p>
</div>
<div class="paragraph">
<p>There are two common scenarios in which a thread associated with a request can be sitting idle.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The thread needs to wait for a resource to become available or process data before building the response.
For example, an application may need to query a database or access data from a remote web service before generating the response.</p>
</li>
<li>
<p>The thread needs to wait for an event before generating the response.
For example, an application may have to wait for a Jakarta Messaging message, new information from another client, or new data available in a queue before generating the response.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These scenarios represent blocking operations that limit the scalability of web applications.
Asynchronous processing refers to assigning these blocking operations to a new thread and retuning the thread associated with the request immediately to the container.</p>
</div>
<div class="sect3">
<h4 id="asynchronous-processing-in-servlets"><a class="anchor" href="#asynchronous-processing-in-servlets"></a>Asynchronous Processing in Servlets</h4>
<div class="paragraph">
<p>Jakarta EE provides asynchronous processing support for servlets and filters.
If a servlet or a filter reaches a potentially blocking operation when processing a request, it can assign the operation to an asynchronous execution context and return the thread associated with the request immediately to the container without generating a response.
The blocking operation completes in the asynchronous execution context in a different thread, which can generate a response or dispatch the request to another servlet.</p>
</div>
<div class="paragraph">
<p>To enable asynchronous processing on a servlet, set the parameter <code>asyncSupported</code> to <code>true</code> on the <code>@WebServlet</code> annotation as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@WebServlet</span>(urlPatterns={<span class="string"><span class="delimiter">&quot;</span><span class="content">/asyncservlet</span><span class="delimiter">&quot;</span></span>}, asyncSupported=<span class="predefined-constant">true</span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">AsyncServlet</span> <span class="directive">extends</span> HttpServlet { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>jakarta.servlet.AsyncContext</code> class provides the functionality that you need to perform asynchronous processing inside service methods.
To obtain an instance of <code>AsyncContext</code>, call the <code>startAsync()</code> method on the request object of your service method; for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">void</span> doGet(HttpServletRequest req, HttpServletResponse resp) {
   ...
   AsyncContext acontext = req.startAsync();
   ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This call puts the request into asynchronous mode and ensures that the response is not committed after exiting the service method.
You have to generate the response in the asynchronous context after the blocking operation completes or dispatch the request to another servlet.</p>
</div>
<div class="paragraph">
<p><a href="#functionality-provided-by-the-asynccontext-class">Table 18-3</a> describes the basic functionality provided by the <code>AsyncContext</code> class.</p>
</div>
<table id="functionality-provided-by-the-asynccontext-class" class="tableblock frame-all grid-all" style="width: 90%;">
<caption class="title">Table 18-3 Functionality Provided by the AsyncContext Class</caption>
<colgroup>
<col style="width: 22.2222%;">
<col style="width: 77.7778%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Method Signature</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>void start(Runnable run)</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The container provides a different thread in which the blocking operation can be processed.</p>
</div>
<div class="paragraph">
<p>You provide code for the blocking operation as a class that implements the <code>Runnable</code> interface.
You can provide this class as an inner class when calling the <code>start</code> method or use another mechanism to pass the <code>AsyncContext</code> instance to your class.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ServletRequest getRequest()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns the request used to initialize this asynchronous context.
In the example above, the request is the same as in the service method.</p>
<p class="tableblock">You can use this method inside the asynchronous context to obtain parameters from the request.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ServletResponse getResponse()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns the response used to initialize this asynchronous context.
In the example above, the response is the same as in the service method.</p>
<p class="tableblock">You can use this method inside the asynchronous context to write to the response with the results of the blocking operation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>void complete()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Completes the asynchronous operation and closes the response associated with this asynchronous context.</p>
<p class="tableblock">You call this method after writing to the response object inside the asynchronous context.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>void dispatch(String path)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dispatches the request and response objects to the given path.</p>
<p class="tableblock">You use this method to have another servlet write to the response after the blocking operation completes.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="waiting-for-a-resource"><a class="anchor" href="#waiting-for-a-resource"></a>Waiting for a Resource</h4>
<div class="paragraph">
<p>This section demonstrates how to use the functionality provided by the <code>AsyncContext</code> class for the following use case:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A servlet receives a parameter from a GET request.</p>
</li>
<li>
<p>The servlet uses a resource, such as a database or a web service, to retrieve information based on the value of the parameter.
The resource can be slow at times, so this may be a blocking operation.</p>
</li>
<li>
<p>The servlet generates a response using the result from the resource.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The following code shows a basic servlet that does not use asynchronous processing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@WebServlet</span>(urlPatterns={<span class="string"><span class="delimiter">&quot;</span><span class="content">/syncservlet</span><span class="delimiter">&quot;</span></span>})
<span class="directive">public</span> <span class="type">class</span> <span class="class">SyncServlet</span> <span class="directive">extends</span> HttpServlet {
   <span class="directive">private</span> MyRemoteResource resource;
   <span class="annotation">@Override</span>
   <span class="directive">public</span> <span class="type">void</span> init(ServletConfig config) {
      resource = MyRemoteResource.create(<span class="string"><span class="delimiter">&quot;</span><span class="content">config1=x,config2=y</span><span class="delimiter">&quot;</span></span>);
   }

   <span class="annotation">@Override</span>
   <span class="directive">public</span> <span class="type">void</span> doGet(HttpServletRequest request,
                     HttpServletResponse response) {
      response.setContentType(<span class="string"><span class="delimiter">&quot;</span><span class="content">text/html;charset=UTF-8</span><span class="delimiter">&quot;</span></span>);
      <span class="predefined-type">String</span> param = request.getParameter(<span class="string"><span class="delimiter">&quot;</span><span class="content">param</span><span class="delimiter">&quot;</span></span>);
      <span class="predefined-type">String</span> result = resource.process(param);
      <span class="comment">/* ... print to the response ... */</span>
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following code shows the same servlet using asynchronous processing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@WebServlet</span>(urlPatterns={<span class="string"><span class="delimiter">&quot;</span><span class="content">/asyncservlet</span><span class="delimiter">&quot;</span></span>}, asyncSupported=<span class="predefined-constant">true</span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">AsyncServlet</span> <span class="directive">extends</span> HttpServlet {
   <span class="comment">/* ... Same variables and init method as in SyncServlet ... */</span>
   <span class="annotation">@Override</span>
   <span class="directive">public</span> <span class="type">void</span> doGet(HttpServletRequest request,
                     HttpServletResponse response) {
      response.setContentType(<span class="string"><span class="delimiter">&quot;</span><span class="content">text/html;charset=UTF-8</span><span class="delimiter">&quot;</span></span>);
      <span class="directive">final</span> AsyncContext acontext = request.startAsync();
      acontext.start(<span class="keyword">new</span> <span class="predefined-type">Runnable</span>() {
         <span class="directive">public</span> <span class="type">void</span> run() {
            <span class="predefined-type">String</span> param = acontext.getRequest().getParameter(<span class="string"><span class="delimiter">&quot;</span><span class="content">param</span><span class="delimiter">&quot;</span></span>);
            <span class="predefined-type">String</span> result = resource.process(param);
            HttpServletResponse response = acontext.getResponse();
            <span class="comment">/* ... print to the response ... */</span>
            acontext.complete();
         }
      });
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>AsyncServlet</code> adds <code>asyncSupported=true</code> to the <code>@WebServlet</code> annotation. The rest of the differences are inside the service method.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>request.startAsync()</code> causes the request to be processed asynchronously; the response is not sent to the client at the end of the service method.</p>
</li>
<li>
<p><code>acontext.start(new Runnable() {&#8230;&#8203;})</code> gets a new thread from the container.</p>
</li>
<li>
<p>The code inside the <code>run()</code> method of the inner class executes in the new thread.
The inner class has access to the asynchronous context to read parameters from the request and write to the response.
Calling the <code>complete()</code> method of the asynchronous context commits the response and sends it to the client.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The service method of <code>AsyncServlet</code> returns immediately, and the request is processed in the asynchronous context.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="nonblocking-io"><a class="anchor" href="#nonblocking-io"></a>Nonblocking I/O</h3>
<div class="paragraph">
<p>Web containers in application servers normally use a server thread per client request.
To develop scalable web applications, you must ensure that threads associated with client requests are never sitting idle waiting for a blocking operation to complete.
<a href="#asynchronous-processing">Asynchronous Processing</a> provides a mechanism to execute application-specific blocking operations in a new thread, returning the thread associated with the request immediately to the container.
Even if you use asynchronous processing for all the application-specific blocking operations inside your service methods, threads associated with client requests can be momentarily sitting idle because of input/output considerations.</p>
</div>
<div class="paragraph">
<p>For example, if a client is submitting a large HTTP POST request over a slow network connection, the server can read the request faster than the client can provide it.
Using traditional I/O, the container thread associated with this request would be sometimes sitting idle waiting for the rest of the request.</p>
</div>
<div class="paragraph">
<p>Jakarta EE provides nonblocking I/O support for servlets and filters when processing requests in asynchronous mode.
The following steps summarize how to use nonblocking I/O to process requests and write responses inside service methods.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Put the request in asynchronous mode as described in <a href="#asynchronous-processing">Asynchronous Processing</a>.</p>
</li>
<li>
<p>Obtain an input stream and/or an output stream from the request and response objects in the service method.</p>
</li>
<li>
<p>Assign a read listener to the input stream and/or a write listener to the output stream.</p>
</li>
<li>
<p>Process the request and the response inside the listener&#8217;s callback methods.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><a href="#nonblocking-io-support-in-servletoutputstream">Table 18-5</a> describe the methods available in the servlet input and output streams for nonblocking I/O support.
<a href="#listener-interfaces-for-nonblocking-io-support">Table 18-6</a> describes the interfaces for read listeners and write listeners.</p>
</div>
<table id="nonblocking-io-support-in-servletinputstream" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 18-4 Nonblocking I/O Support in jakarta.servlet.ServletInputStream</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Method</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>void setReadListener(ReadListener rl)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Associates this input stream with a listener object that contains callback methods to read data asynchronously.
You provide the listener object as an anonymous class or use another mechanism to pass the input stream to the read listener object.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boolean isReady()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns true if data can be read without blocking.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boolean isFinished()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns true when all the data has been read.</p></td>
</tr>
</tbody>
</table>
<table id="nonblocking-io-support-in-servletoutputstream" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 18-5 Nonblocking I/O Support in jakarta.servlet.ServletOutputStream</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Method</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>void setWriteListener(WriteListener wl)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Associates this output stream with a listener object that contains callback methods to write data asynchronously.
You provide the write listener object as an anonymous class or use another mechanism to pass the output stream to the write listener object.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boolean isReady()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns true if data can be written without blocking.</p></td>
</tr>
</tbody>
</table>
<table id="listener-interfaces-for-nonblocking-io-support" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 18-6 Listener Interfaces for Nonblocking I/O Support</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 30%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Interface</th>
<th class="tableblock halign-left valign-top">Methods</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ReadListener</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>void onDataAvailable()</code></p>
<p class="tableblock"><code>void onAllDataRead()</code></p>
<p class="tableblock"><code>void onError(Throwable t)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <code>ServletInputStream</code> instance calls these methods on its listener when there is data available to read, when all the data has been read, or when there is an error.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>WriteListener</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>void onWritePossible()</code></p>
<p class="tableblock"><code>void onError(Throwable t)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <code>ServletOutputStream</code> instance calls these methods on its listener when it is possible to write data without blocking or when there is an error.</p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="reading-a-large-http-post-request-using-nonblocking-io"><a class="anchor" href="#reading-a-large-http-post-request-using-nonblocking-io"></a>Reading a Large HTTP POST Request Using Nonblocking I/O</h4>
<div class="paragraph">
<p>The code in this section shows how to read a large HTTP POST request inside a servlet by putting the request in asynchronous mode (as described in <a href="#asynchronous-processing">Asynchronous Processing</a>) and using the nonblocking I/O functionality from <a href="#nonblocking-io-support-in-servletinputstream">Table 18-4</a> and <a href="#listener-interfaces-for-nonblocking-io-support">Table 18-6</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@WebServlet</span>(urlPatterns={<span class="string"><span class="delimiter">&quot;</span><span class="content">/asyncioservlet</span><span class="delimiter">&quot;</span></span>}, asyncSupported=<span class="predefined-constant">true</span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">AsyncIOServlet</span> <span class="directive">extends</span> HttpServlet {
   <span class="annotation">@Override</span>
   <span class="directive">public</span> <span class="type">void</span> doPost(HttpServletRequest request,
                      HttpServletResponse response)
                      <span class="directive">throws</span> <span class="exception">IOException</span> {
      <span class="directive">final</span> AsyncContext acontext = request.startAsync();
      <span class="directive">final</span> ServletInputStream input = request.getInputStream();

      input.setReadListener(<span class="keyword">new</span> ReadListener() {
         <span class="type">byte</span> buffer<span class="type">[]</span> = <span class="keyword">new</span> <span class="type">byte</span>[<span class="integer">4</span>*<span class="integer">1024</span>];
         <span class="predefined-type">StringBuilder</span> sbuilder = <span class="keyword">new</span> <span class="predefined-type">StringBuilder</span>();
         <span class="annotation">@Override</span>
         <span class="directive">public</span> <span class="type">void</span> onDataAvailable() {
            <span class="keyword">try</span> {
               <span class="keyword">do</span> {
                  <span class="type">int</span> length = input.read(buffer);
                  sbuilder.append(<span class="keyword">new</span> <span class="predefined-type">String</span>(buffer, <span class="integer">0</span>, length));
               } <span class="keyword">while</span>(input.isReady());
            } <span class="keyword">catch</span> (<span class="exception">IOException</span> ex) { ... }
         }
         <span class="annotation">@Override</span>
         <span class="directive">public</span> <span class="type">void</span> onAllDataRead() {
            <span class="keyword">try</span> {
               acontext.getResponse().getWriter()
                                     .write(<span class="string"><span class="delimiter">&quot;</span><span class="content">...the response...</span><span class="delimiter">&quot;</span></span>);
            } <span class="keyword">catch</span> (<span class="exception">IOException</span> ex) { ... }
            acontext.complete();
         }
         <span class="annotation">@Override</span>
         <span class="directive">public</span> <span class="type">void</span> onError(<span class="predefined-type">Throwable</span> t) { ... }
      });
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example declares the web servlet with asynchronous support using the <code>@WebServlet</code> annotation parameter <code>asyncSupported=true</code>.
The service method first puts the request in asynchronous mode by calling the <code>startAsync()</code> method of the request object, which is required in order to use nonblocking I/O.
Then, the service method obtains an input stream associated with the request and assigns a read listener defined as an inner class.
The listener reads parts of the request as they become available and then writes some response to the client when it finishes reading the request.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="server-push"><a class="anchor" href="#server-push"></a>Server Push</h3>
<div class="paragraph">
<p>Server push is the ability of the server to anticipate what will be needed by the client in advance of the client&#8217;s request.
It lets the server pre-populate the browser&#8217;s cache in advance of the browser asking for the resource to put in the cache.</p>
</div>
<div class="paragraph">
<p>Server push is the most visible of the improvements in HTTP/2 to appear in the servlet API.
All of the new features in HTTP/2, including server push, are aimed at improving the performance of the web browsing experience.</p>
</div>
<div class="paragraph">
<p>Server push derives its contribution to improved browser performance from the fact that servers know what additional assets (such as images, stylesheets, and scripts) go along with initial requests.
For example, servers might know that whenever a browser requests <code>index.html</code>, it will shortly thereafter request <code>header.gif</code>, <code>footer.gif</code>, and <code>style.css</code>.
Servers can preemptively start sending the bytes of these assets along with the bytes of the <code>index.html</code>.</p>
</div>
<div class="paragraph">
<p>To use server push, obtain a reference to a <code>PushBuilder</code> from an <code>HttpServletRequest</code>, edit the builder as desired, then call <code>push()</code>.
See the <a href="https://jakarta.ee/specifications/platform/9/apidocs/" target="_blank" rel="noopener">javadoc</a> for the class <code>jakarta.servlet.http.PushBuilder</code> and the method <code>jakarta.servlet.http.HttpServletRequest.newPushBuilder()</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="protocol-upgrade-processing"><a class="anchor" href="#protocol-upgrade-processing"></a>Protocol Upgrade Processing</h3>
<div class="paragraph">
<p>In HTTP/1.1, clients can request to switch to a different protocol on the current connection by using the <code>Upgrade</code> header field.
If the server accepts the request to switch to the protocol indicated by the client, it generates an HTTP response with status 101 (switching protocols).
After this exchange, the client and the server communicate using the new protocol.</p>
</div>
<div class="paragraph">
<p>For example, a client can make an HTTP request to switch to the XYZP protocol as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="http">GET /xyzpresource HTTP/1.1
Host: localhost:8080
Accept: text/html
Upgrade: XYZP
Connection: Upgrade
OtherHeaderA: Value</code></pre>
</div>
</div>
<div class="paragraph">
<p>The client can specify parameters for the new protocol using HTTP headers.
The server can accept the request and generate a response as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="http">HTTP/1.1 101 Switching Protocols
Upgrade: XYZP
Connection: Upgrade
OtherHeaderB: Value

(XYZP data)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Jakarta EE supports the HTTP protocol upgrade functionality in servlets, as described in <a href="#protocol-upgrade-support">Table 18-7</a>.</p>
</div>
<table id="protocol-upgrade-support" class="tableblock frame-all grid-all" style="width: 80%;">
<caption class="title">Table 18-7 Protocol Upgrade Support</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Class or Interface</th>
<th class="tableblock halign-left valign-top">Method</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>HttpServletRequest</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>HttpUpgradeHandler upgrade(Class handler)</code></p>
<p class="tableblock">The upgrade method starts the protocol upgrade processing.
This method instantiates a class that implements the <code>HttpUpgradeHandler</code> interface and delegates the connection to it.</p>
<p class="tableblock">You call the <code>upgrade</code> method inside a service method when accepting a request from a client to switch protocols.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>HttpUpgradeHandler</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>void init(WebConnection wc)</code></p>
<p class="tableblock">The <code>init</code> method is called when the servlet accepts the request to switch protocols.
You implement this method and obtain input and output streams from the <code>WebConnection</code> object to implement the new protocol.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>HttpUpgradeHandler</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>void destroy()</code></p>
<p class="tableblock">The <code>destroy</code> method is called when the client disconnects.
You implement this method and free any resources associated with processing the new protocol.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>WebConnection</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ServletInputStream getInputStream()</code></p>
<p class="tableblock">The <code>getInputStream</code> method provides access to the input stream of the connection.
You can use <a href="#nonblocking-io">Nonblocking I/O</a> with the returned stream to implement the new protocol.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>WebConnection</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ServletOutputStream getOutputStream()</code></p>
<p class="tableblock">The <code>getOutputStream</code> method provides access to the output stream of the connection.
You can use <a href="#nonblocking-io">Nonblocking I/O</a> with the returned stream to implement the new protocol.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The following code demonstrates how to accept an HTTP protocol upgrade request from a client:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@WebServlet</span>(urlPatterns={<span class="string"><span class="delimiter">&quot;</span><span class="content">/xyzpresource</span><span class="delimiter">&quot;</span></span>})
<span class="directive">public</span> <span class="type">class</span> <span class="class">XYZPUpgradeServlet</span> <span class="directive">extends</span> HttpServlet {
   <span class="annotation">@Override</span>
   <span class="directive">public</span> <span class="type">void</span> doGet(HttpServletRequest request,
                     HttpServletResponse response) {
      <span class="keyword">if</span> (<span class="string"><span class="delimiter">&quot;</span><span class="content">XYZP</span><span class="delimiter">&quot;</span></span>.equals(request.getHeader(<span class="string"><span class="delimiter">&quot;</span><span class="content">Upgrade</span><span class="delimiter">&quot;</span></span>))) {
         <span class="comment">/* Accept upgrade request */</span>
         response.setStatus(<span class="integer">101</span>);
         response.setHeader(<span class="string"><span class="delimiter">&quot;</span><span class="content">Upgrade</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">XYZP</span><span class="delimiter">&quot;</span></span>);
         response.setHeader(<span class="string"><span class="delimiter">&quot;</span><span class="content">Connection</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Upgrade</span><span class="delimiter">&quot;</span></span>);
         response.setHeader(<span class="string"><span class="delimiter">&quot;</span><span class="content">OtherHeaderB</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Value</span><span class="delimiter">&quot;</span></span>);
         <span class="comment">/* Delegate the connection to the upgrade handler */</span>
         XYZPUpgradeHandler = request.upgrade(XYZPUpgradeHandler.class);
         <span class="comment">/* (the service method returns immedately) */</span>
      } <span class="keyword">else</span> {
         <span class="comment">/* ... write error response ... */</span>
      }
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>XYZPUpgradeHandler</code> class handles the connection:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">XYZPUpgradeHandler</span> <span class="directive">implements</span> HttpUpgradeHandler {
   <span class="annotation">@Override</span>
   <span class="directive">public</span> <span class="type">void</span> init(WebConnection wc) {
      ServletInputStream input = wc.getInputStream();
      ServletOutputStream output = wc.getOutputStream();
      <span class="comment">/* ... implement XYZP using these streams (protocol-specific) ... */</span>
   }
   <span class="annotation">@Override</span>
   <span class="directive">public</span> <span class="type">void</span> destroy() { ... }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The class that implements <code>HttpUpgradeHandler</code> uses the streams from the current connection to communicate with the client using the new protocol.
See the Servlet 5.0 specification at <a href="https://jakarta.ee/specifications/servlet/5.0" class="bare" target="_blank" rel="noopener">https://jakarta.ee/specifications/servlet/5.0</a> for details on HTTP protocol upgrade support.</p>
</div>
</div>
<div class="sect2">
<h3 id="http-trailer"><a class="anchor" href="#http-trailer"></a>HTTP Trailer</h3>
<div class="paragraph">
<p>HTTP trailer is a collection of a special type of HTTP headers that comes after the response body.
The trailer response header allows the sender to include additional fields at the end of chunked messages in order to supply metadata that might be dynamically generated while the message body is sent, such as a message integrity check, digital signature, or post-processing status.</p>
</div>
<div class="paragraph">
<p>If trailer headers are ready for reading, <code>isTrailerFieldsReady()</code> will return <code>true</code>.
Then a servlet can read trailer headers of the HTTP request using the <code>getTrailerFields</code> method of the <code>HttpServletRequest</code> interface.
If trailer headers are not ready for reading, <code>isTrailerFieldsReady()</code> returns <code>false</code> and will cause an <code>IllegalStateException</code>.</p>
</div>
<div class="paragraph">
<p>A servlet can write trailer headers to the response by providing a supplier to the <code>setTrailerFields()</code> method of the <code>HttpServletResponse</code> interface.
The following headers and types of headers must <em>not</em> be included in the set of keys in the map passed to <code>setTrailerFields()</code>: <code>Transfer-Encoding</code>, <code>Content-Length</code>, <code>Host</code>, controls and conditional headers, authentication headers, <code>Content-Encoding</code>, <code>Content-Type</code>, <code>Content-Range</code>, and <code>Trailer</code>.
When sending response trailers, you must include a regular header, called <code>Trailer</code>, whose value is a comma-separated list of all the keys in the map that is supplied to the <code>setTrailerFields()</code> method.
The value of the <code>Trailer</code> header lets the client know what trailers to expect.</p>
</div>
<div class="paragraph">
<p>The supplier of the trailer headers can be obtained by accessing the <code>getTrailerFields()</code> method of the <code>HttpServletResponse</code> interface.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://jakarta.ee/specifications/platform/9/apidocs/" target="_blank" rel="noopener">javadoc</a> for <code>getTrailerFields()</code> and <code>isTrailerFieldsReady()</code> in <code>HttpServletRequest</code>, and <code>getTrailerFields()</code> and <code>setTrailerFields()</code> in <code>HttpServletResponse</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="the-mood-example-application"><a class="anchor" href="#the-mood-example-application"></a>The mood Example Application</h3>
<div class="paragraph">
<p>The <code>mood</code> example application, located in the <code><em>tut-install</em>/examples/web/servlet/mood/</code> directory, is a simple example that displays Duke&#8217;s moods at different times during the day.
The example shows how to develop a simple application by using the <code>@WebServlet</code>, <code>@WebFilter</code>, and <code>@WebListener</code> annotations to create a servlet, a listener, and a filter.</p>
</div>
<div class="sect3">
<h4 id="components-of-the-mood-example-application"><a class="anchor" href="#components-of-the-mood-example-application"></a>Components of the mood Example Application</h4>
<div class="paragraph">
<p>The <code>mood</code> example application is comprised of three components: <code>mood.web.MoodServlet</code>, <code>mood.web.TimeOfDayFilter</code>, and <code>mood.web.SimpleServletListener</code>.</p>
</div>
<div class="paragraph">
<p><code>MoodServlet</code>, the presentation layer of the application, displays Duke&#8217;s mood in a graphic, based on the time of day.
The <code>@WebServlet</code> annotation specifies the URL pattern:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@WebServlet</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/report</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">MoodServlet</span> <span class="directive">extends</span> HttpServlet {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>TimeOfDayFilter</code> sets an initialization parameter indicating that Duke is awake:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@WebFilter</span>(filterName = <span class="string"><span class="delimiter">&quot;</span><span class="content">TimeOfDayFilter</span><span class="delimiter">&quot;</span></span>,
urlPatterns = {<span class="string"><span class="delimiter">&quot;</span><span class="content">/*</span><span class="delimiter">&quot;</span></span>},
initParams = {
    <span class="annotation">@WebInitParam</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">mood</span><span class="delimiter">&quot;</span></span>, value = <span class="string"><span class="delimiter">&quot;</span><span class="content">awake</span><span class="delimiter">&quot;</span></span>)})
<span class="directive">public</span> <span class="type">class</span> <span class="class">TimeOfDayFilter</span> <span class="directive">implements</span> <span class="predefined-type">Filter</span> {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The filter calls the <code>doFilter</code> method, which contains a <code>switch</code> statement that sets Duke&#8217;s mood based on the current time.</p>
</div>
<div class="paragraph">
<p><code>SimpleServletListener</code> logs changes in the servlet&#8217;s lifecycle.
The log entries appear in the server log.</p>
</div>
</div>
<div class="sect3">
<h4 id="running-the-mood-example"><a class="anchor" href="#running-the-mood-example"></a>Running the mood Example</h4>
<div class="paragraph">
<p>You can use either NetBeans IDE or Maven to build, package, deploy, and run the <code>mood</code> example.</p>
</div>
<div class="sect4">
<h5 id="to-run-the-mood-example-using-netbeans-ide"><a class="anchor" href="#to-run-the-mood-example-using-netbeans-ide"></a>To Run the mood Example Using NetBeans IDE</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>From the <strong>File</strong> menu, choose <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the Open Project dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/web/servlet</pre>
</div>
</div>
</li>
<li>
<p>Select the <code>mood</code> folder.</p>
</li>
<li>
<p>Click <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the <strong>Projects</strong> tab, right-click the <code>mood</code> project and select <strong>Build</strong>.</p>
</li>
<li>
<p>In a web browser, enter the following URL:</p>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080/mood/report</pre>
</div>
</div>
<div class="paragraph">
<p>The URL specifies the context root, followed by the URL pattern.</p>
</div>
<div class="paragraph">
<p>A web page appears with the title "Servlet MoodServlet at /mood", a text string describing Duke&#8217;s mood, and an illustrative graphic.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-run-the-mood-example-using-maven"><a class="anchor" href="#to-run-the-mood-example-using-maven"></a>To Run the mood Example Using Maven</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>In a terminal window, go to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/web/servlet/mood/</pre>
</div>
</div>
</li>
<li>
<p>Enter the following command to deploy the application:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">mvn install</code></pre>
</div>
</div>
</li>
<li>
<p>In a web browser, enter the following URL:</p>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080/mood/report</pre>
</div>
</div>
<div class="paragraph">
<p>The URL specifies the context root, followed by the URL pattern.</p>
</div>
<div class="paragraph">
<p>A web page appears with the title "Servlet MoodServlet at /mood", a text string describing Duke&#8217;s mood, and an illustrative graphic.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="the-fileupload-example-application"><a class="anchor" href="#the-fileupload-example-application"></a>The fileupload Example Application</h3>
<div class="paragraph">
<p>The <code>fileupload</code> example, located in the <code><em>tut-install</em>/examples/web/servlet/fileupload/</code> directory, illustrates how to implement and use the file upload feature.</p>
</div>
<div class="paragraph">
<p>The Duke&#8217;s Forest case study provides a more complex example that uploads an image file and stores its content in a database.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Except where expressly provided otherwise, the site, and all content provided on or through the site, are provided on an "as is" and "as available" basis.
Oracle expressly disclaims all warranties of any kind, whether express or implied, including, but not limited to, the implied warranties of merchantability, fitness for a particular purpose and non-infringement with respect to the site and all content provided on or through the site.
Oracle makes no warranty that: (a) the site or content will meet your requirements; (b) the site will be available on an uninterrupted, timely, secure, or error-free basis; (c) the results that may be obtained from the use of the site or any content provided on or through the site will be accurate or reliable; or (d) the quality of any content purchased or obtained by you on or through the site will meet your expectations.</p>
</div>
<div class="paragraph">
<p>Any content accessed, downloaded or otherwise obtained on or through the use of the site is used at your own discretion and risk.
Oracle shall have no responsibility for any damage to your computer system or loss of data that results from the download or use of content.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="architecture-of-the-fileupload-example-application"><a class="anchor" href="#architecture-of-the-fileupload-example-application"></a>Architecture of the fileupload Example Application</h4>
<div class="paragraph">
<p>The <code>fileupload</code> example application consists of a single servlet and an HTML form that makes a file upload request to the servlet.</p>
</div>
<div class="paragraph">
<p>This example includes a very simple HTML form with two fields, File and Destination.
The input type, <code>file</code>, enables a user to browse the local file system to select the file.
When the file is selected, it is sent to the server as a part of a POST request.
During this process, two mandatory restrictions are applied to the form with input type <code>file</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>enctype</code> attribute must be set to a value of <code>multipart/form-data</code>.</p>
</li>
<li>
<p>Its method must be POST.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When the form is specified in this manner, the entire request is sent to the server in encoded form.
The servlet then uses its own means to handle the request to process the incoming file data and extract a file from the stream.
The destination is the path to the location where the file will be saved on your computer.
Pressing the Upload button at the bottom of the form posts the data to the servlet, which saves the file in the specified destination.</p>
</div>
<div class="paragraph">
<p>The HTML form in <code>index.html</code> is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><span class="doctype">&lt;!DOCTYPE html&gt;</span>
<span class="tag">&lt;html</span> <span class="attribute-name">lang</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;head&gt;</span>
        <span class="tag">&lt;title&gt;</span>File Upload<span class="tag">&lt;/title&gt;</span>
        <span class="tag">&lt;meta</span> <span class="attribute-name">http-equiv</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Content-Type</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">content</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text/html; charset=UTF-8</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;/head&gt;</span>
    <span class="tag">&lt;body&gt;</span>
        <span class="tag">&lt;form</span> <span class="attribute-name">method</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">POST</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">upload</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">enctype</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">multipart/form-data</span><span class="delimiter">&quot;</span></span> <span class="tag">&gt;</span>
            File:
            <span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">file</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">file</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">file</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span> <span class="tag">&lt;br</span><span class="tag">/&gt;</span>
            Destination:
            <span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/tmp</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">destination</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;br</span><span class="tag">/&gt;</span>
            <span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">submit</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Upload</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">upload</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">upload</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;/form&gt;</span>
    <span class="tag">&lt;/body&gt;</span>
<span class="tag">&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A POST request method is used when the client needs to send data to the server as part of the request, such as when uploading a file or submitting a completed form.
In contrast, a GET request method sends a URL and headers only to the server, whereas POST requests also include a message body.
This allows arbitrary length data of any type to be sent to the server.
A header field in the POST request usually indicates the message body&#8217;s Internet media type.</p>
</div>
<div class="paragraph">
<p>When submitting a form, the browser streams the content in, combining all parts, with each part representing a field of a form.
Parts are named after the <code>input</code> elements and are separated from each other with string delimiters named <code>boundary</code>.</p>
</div>
<div class="paragraph">
<p>This is what submitted data from the <code>fileupload</code> form looks like, after selecting <code>sample.txt</code> as the file that will be uploaded to the <code>tmp</code> directory on the local file system:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="http">POST /fileupload/upload HTTP/1.1
Host: localhost:8080
Content-Type: multipart/form-data;
boundary=---------------------------263081694432439 Content-Length: 441
-----------------------------263081694432439
Content-Disposition: form-data; name=&quot;file&quot;; filename=&quot;sample.txt&quot;
Content-Type: text/plain
 Data from sample file
-----------------------------263081694432439
Content-Disposition: form-data; name=&quot;destination&quot;
 /tmp
-----------------------------263081694432439
Content-Disposition: form-data; name=&quot;upload&quot;
 Upload
-----------------------------263081694432439--</code></pre>
</div>
</div>
<div class="paragraph">
<p>The servlet <code>FileUploadServlet.java</code> begins as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@WebServlet</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">FileUploadServlet</span><span class="delimiter">&quot;</span></span>, urlPatterns = {<span class="string"><span class="delimiter">&quot;</span><span class="content">/upload</span><span class="delimiter">&quot;</span></span>})
<span class="annotation">@MultipartConfig</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">FileUploadServlet</span> <span class="directive">extends</span> HttpServlet {
    <span class="directive">private</span> <span class="directive">final</span> <span class="directive">static</span> <span class="predefined-type">Logger</span> LOGGER =
            <span class="predefined-type">Logger</span>.getLogger(FileUploadServlet.class.getCanonicalName());
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>@WebServlet</code> annotation uses the <code>urlPatterns</code> property to define servlet mappings.</p>
</div>
<div class="paragraph">
<p>The <code>@MultipartConfig</code> annotation indicates that the servlet expects requests to be made using the <code>multipart/form-data</code> MIME type.</p>
</div>
<div class="paragraph">
<p>The <code>processRequest</code> method retrieves the destination and file part from the request, then calls the <code>getFileName</code> method to retrieve the file name from the file part.
The method then creates a <code>FileOutputStream</code> and copies the file to the specified destination.
The error-handling section of the method catches and handles some of the most common reasons why a file would not be found.
The <code>processRequest</code> and <code>getFileName</code> methods look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">protected</span> <span class="type">void</span> processRequest(HttpServletRequest request,
        HttpServletResponse response)
        <span class="directive">throws</span> ServletException, <span class="exception">IOException</span> {
    response.setContentType(<span class="string"><span class="delimiter">&quot;</span><span class="content">text/html;charset=UTF-8</span><span class="delimiter">&quot;</span></span>);

    <span class="comment">// Create path components to save the file</span>
    <span class="directive">final</span> <span class="predefined-type">String</span> path = request.getParameter(<span class="string"><span class="delimiter">&quot;</span><span class="content">destination</span><span class="delimiter">&quot;</span></span>);
    <span class="directive">final</span> Part filePart = request.getPart(<span class="string"><span class="delimiter">&quot;</span><span class="content">file</span><span class="delimiter">&quot;</span></span>);
    <span class="directive">final</span> <span class="predefined-type">String</span> fileName = getFileName(filePart);

    <span class="predefined-type">OutputStream</span> out = <span class="predefined-constant">null</span>;
    <span class="predefined-type">InputStream</span> filecontent = <span class="predefined-constant">null</span>;
    <span class="directive">final</span> <span class="predefined-type">PrintWriter</span> writer = response.getWriter();

    <span class="keyword">try</span> {
        out = <span class="keyword">new</span> <span class="predefined-type">FileOutputStream</span>(<span class="keyword">new</span> <span class="predefined-type">File</span>(path + <span class="predefined-type">File</span>.separator
                + fileName));
        filecontent = filePart.getInputStream();

        <span class="type">int</span> read = <span class="integer">0</span>;
        <span class="directive">final</span> <span class="type">byte</span><span class="type">[]</span> bytes = <span class="keyword">new</span> <span class="type">byte</span>[<span class="integer">1024</span>];

        <span class="keyword">while</span> ((read = filecontent.read(bytes)) != -<span class="integer">1</span>) {
            out.write(bytes, <span class="integer">0</span>, read);
        }
        writer.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">New file </span><span class="delimiter">&quot;</span></span> + fileName + <span class="string"><span class="delimiter">&quot;</span><span class="content"> created at </span><span class="delimiter">&quot;</span></span> + path);
        LOGGER.log(<span class="predefined-type">Level</span>.INFO, <span class="string"><span class="delimiter">&quot;</span><span class="content">File{0}being uploaded to {1}</span><span class="delimiter">&quot;</span></span>,
                <span class="keyword">new</span> <span class="predefined-type">Object</span><span class="type">[]</span>{fileName, path});
    } <span class="keyword">catch</span> (<span class="exception">FileNotFoundException</span> fne) {
        writer.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">You either did not specify a file to upload or are </span><span class="delimiter">&quot;</span></span>
                + <span class="string"><span class="delimiter">&quot;</span><span class="content">trying to upload a file to a protected or nonexistent </span><span class="delimiter">&quot;</span></span>
                + <span class="string"><span class="delimiter">&quot;</span><span class="content">location.</span><span class="delimiter">&quot;</span></span>);
        writer.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;br/&gt; ERROR: </span><span class="delimiter">&quot;</span></span> + fne.getMessage());

        LOGGER.log(<span class="predefined-type">Level</span>.SEVERE, <span class="string"><span class="delimiter">&quot;</span><span class="content">Problems during file upload. Error: {0}</span><span class="delimiter">&quot;</span></span>,
                <span class="keyword">new</span> <span class="predefined-type">Object</span><span class="type">[]</span>{fne.getMessage()});
    } <span class="keyword">finally</span> {
        <span class="keyword">if</span> (out != <span class="predefined-constant">null</span>) {
            out.close();
        }
        <span class="keyword">if</span> (filecontent != <span class="predefined-constant">null</span>) {
            filecontent.close();
        }
        <span class="keyword">if</span> (writer != <span class="predefined-constant">null</span>) {
            writer.close();
        }
    }
}

<span class="directive">private</span> <span class="predefined-type">String</span> getFileName(<span class="directive">final</span> Part part) {
    <span class="directive">final</span> <span class="predefined-type">String</span> partHeader = part.getHeader(<span class="string"><span class="delimiter">&quot;</span><span class="content">content-disposition</span><span class="delimiter">&quot;</span></span>);
    LOGGER.log(<span class="predefined-type">Level</span>.INFO, <span class="string"><span class="delimiter">&quot;</span><span class="content">Part Header = {0}</span><span class="delimiter">&quot;</span></span>, partHeader);
    <span class="keyword">for</span> (<span class="predefined-type">String</span> content : part.getHeader(<span class="string"><span class="delimiter">&quot;</span><span class="content">content-disposition</span><span class="delimiter">&quot;</span></span>).split(<span class="string"><span class="delimiter">&quot;</span><span class="content">;</span><span class="delimiter">&quot;</span></span>)) {
        <span class="keyword">if</span> (content.trim().startsWith(<span class="string"><span class="delimiter">&quot;</span><span class="content">filename</span><span class="delimiter">&quot;</span></span>)) {
            <span class="keyword">return</span> content.substring(
                    content.indexOf(<span class="string"><span class="delimiter">'</span><span class="content">=</span><span class="delimiter">'</span></span>) + <span class="integer">1</span>).trim().replace(<span class="string"><span class="delimiter">&quot;</span><span class="char">\&quot;</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>);
        }
    }
    <span class="keyword">return</span> <span class="predefined-constant">null</span>;
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="running-the-fileupload-example"><a class="anchor" href="#running-the-fileupload-example"></a>Running the fileupload Example</h4>
<div class="paragraph">
<p>You can use either NetBeans IDE or Maven to build, package, deploy, and run the <code>fileupload</code> example.</p>
</div>
<div class="sect4">
<h5 id="to-build-package-and-deploy-the-fileupload-example-using-netbeans-ide"><a class="anchor" href="#to-build-package-and-deploy-the-fileupload-example-using-netbeans-ide"></a>To Build, Package, and Deploy the fileupload Example Using NetBeans IDE</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>From the <strong>File</strong> menu, choose <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the Open Project dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/web/servlet</pre>
</div>
</div>
</li>
<li>
<p>Select the <code>fileupload</code> folder.</p>
</li>
<li>
<p>Click <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the <strong>Projects</strong> tab, right-click the <code>fileupload</code> project and select <strong>Build</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-build-package-and-deploy-the-fileupload-example-using-maven"><a class="anchor" href="#to-build-package-and-deploy-the-fileupload-example-using-maven"></a>To Build, Package, and Deploy the fileupload Example Using Maven</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>In a terminal window, go to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/web/servlet/fileupload/</pre>
</div>
</div>
</li>
<li>
<p>Enter the following command to deploy the application:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">mvn install</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-run-the-fileupload-example"><a class="anchor" href="#to-run-the-fileupload-example"></a>To Run the fileupload Example</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In a web browser, enter the following URL:</p>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080/fileupload/</pre>
</div>
</div>
</li>
<li>
<p>On the File Upload page, click Choose File to display a file browser
window.</p>
</li>
<li>
<p>Select a file to upload and click Open.</p>
<div class="paragraph">
<p>The name of the file you selected is displayed in the File field.
If you do not select a file, an exception will be thrown.</p>
</div>
</li>
<li>
<p>In the Destination field, type a directory name.</p>
<div class="paragraph">
<p>The directory must have already been created and must also be writable.
If you do not enter a directory name or if you enter the name of a nonexistent or protected directory, an exception will be thrown.</p>
</div>
</li>
<li>
<p>Click Upload to upload the file that you selected to the directory that you specified in the Destination field.</p>
<div class="paragraph">
<p>A message reports that the file was created in the directory that you specified.</p>
</div>
</li>
<li>
<p>Go to the directory that you specified in the Destination field and verify that the uploaded file is present.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="the-dukeetf-example-application"><a class="anchor" href="#the-dukeetf-example-application"></a>The dukeetf Example Application</h3>
<div class="paragraph">
<p>The <code>dukeetf</code> example application, located in the <code><em>tut-install</em>/examples/web/dukeetf/</code> directory, demonstrates how to use asynchronous processing in a servlet to provide data updates to web clients.
The example resembles a service that provides periodic updates on the price and trading volume of an electronically traded fund (ETF).</p>
</div>
<div class="sect3">
<h4 id="architecture-of-the-dukeetf-example-application"><a class="anchor" href="#architecture-of-the-dukeetf-example-application"></a>Architecture of the dukeetf Example Application</h4>
<div class="paragraph">
<p>The <code>dukeetf</code> example application consists of a servlet, an enterprise bean, and an HTML page.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The servlet puts requests in asynchronous mode, stores them in a queue, and writes the responses when new data for price and trading volume becomes available.</p>
</li>
<li>
<p>The enterprise bean updates the price and volume information once every second.</p>
</li>
<li>
<p>The HTML page uses JavaScript code to make requests to the servlet for new data, parse the response from the servlet, and update the price and volume information without reloading the page.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>dukeetf</code> example application uses a programming model known as long polling.
In the traditional HTTP request and response model, the user must make an explicit request (such as clicking a link or submitting a form) to get any new information from the server, and the page has to be reloaded.
Long polling provides a mechanism for web applications to push updates to clients using HTTP without the user making an explicit request.
The server handles connections asynchronously, and the client uses JavaScript to make new connections.
In this model, clients make a new request immediately after receiving new data, and the server keeps the connection open until new data becomes available.</p>
</div>
<div class="sect4">
<h5 id="the-servlet"><a class="anchor" href="#the-servlet"></a>The Servlet</h5>
<div class="paragraph">
<p>The <code>DukeETFServlet</code> class uses asynchronous processing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@WebServlet</span>(urlPatterns={<span class="string"><span class="delimiter">&quot;</span><span class="content">/dukeetf</span><span class="delimiter">&quot;</span></span>}, asyncSupported=<span class="predefined-constant">true</span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">DukeETFServlet</span> <span class="directive">extends</span> HttpServlet {
...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the following code, the <code>init</code> method initializes a queue to hold client requests and registers the servlet with the enterprise bean that provides the price and volume updates.
The <code>send</code> method gets called once per second by the <code>PriceVolumeBean</code> to send updates and close the connection:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> init(ServletConfig config) {
   <span class="comment">/* Queue for requests */</span>
   requestQueue = <span class="keyword">new</span> <span class="predefined-type">ConcurrentLinkedQueue</span>&lt;&gt;();
   <span class="comment">/* Register with the enterprise bean that provides price/volume updates */</span>
   pvbean.registerServlet(<span class="local-variable">this</span>);
}

<span class="comment">/* PriceVolumeBean calls this method every second to send updates */</span>
<span class="directive">public</span> <span class="type">void</span> send(<span class="type">double</span> price, <span class="type">int</span> volume) {
   <span class="comment">/* Send update to all connected clients */</span>
   <span class="keyword">for</span> (AsyncContext acontext : requestQueue) {
      <span class="keyword">try</span> {
         <span class="predefined-type">String</span> msg = <span class="predefined-type">String</span>.format(<span class="string"><span class="delimiter">&quot;</span><span class="content">%.2f / %d</span><span class="delimiter">&quot;</span></span>, price, volume);
         <span class="predefined-type">PrintWriter</span> writer = acontext.getResponse().getWriter();
         writer.write(msg);
         logger.log(<span class="predefined-type">Level</span>.INFO, <span class="string"><span class="delimiter">&quot;</span><span class="content">Sent: {0}</span><span class="delimiter">&quot;</span></span>, msg);
         <span class="comment">/* Close the connection
          * The client (JavaScript) makes a new one instantly */</span>
         acontext.complete();
      } <span class="keyword">catch</span> (<span class="exception">IOException</span> ex) {
         logger.log(<span class="predefined-type">Level</span>.INFO, ex.toString());
      }
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The service method puts client requests in asynchronous mode and adds a listener to each request.
The listener is implemented as an anonymous class that removes the request from the queue when the servlet finishes writing a response or when there is an error.
Finally, the service method adds the request to the request queue created in the <code>init</code> method.
The service method is the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> doGet(HttpServletRequest request,
                  HttpServletResponse response) {
   response.setContentType(<span class="string"><span class="delimiter">&quot;</span><span class="content">text/html</span><span class="delimiter">&quot;</span></span>);
   <span class="comment">/* Put request in async mode */</span>
   <span class="directive">final</span> AsyncContext acontext = request.startAsync();
   <span class="comment">/* Remove from the queue when done */</span>
   acontext.addListener(<span class="keyword">new</span> AsyncListener() {
      <span class="directive">public</span> <span class="type">void</span> onComplete(AsyncEvent ae) <span class="directive">throws</span> <span class="exception">IOException</span> {
         requestQueue.remove(acontext);
      }
      <span class="directive">public</span> <span class="type">void</span> onTimeout(AsyncEvent ae) <span class="directive">throws</span> <span class="exception">IOException</span> {
         requestQueue.remove(acontext);
      }
      <span class="directive">public</span> <span class="type">void</span> onError(AsyncEvent ae) <span class="directive">throws</span> <span class="exception">IOException</span> {
         requestQueue.remove(acontext);
      }
      <span class="directive">public</span> <span class="type">void</span> onStartAsync(AsyncEvent ae) <span class="directive">throws</span> <span class="exception">IOException</span> {}
   });
   <span class="comment">/* Add to the queue */</span>
   requestQueue.add(acontext);
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="the-enterprise-bean"><a class="anchor" href="#the-enterprise-bean"></a>The Enterprise Bean</h5>
<div class="paragraph">
<p>The <code>PriceVolumeBean</code> class is an enterprise bean that uses the timer service from the container to update the price and volume information and call the servlet&#8217;s <code>send</code> method once every second:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Startup</span>
<span class="annotation">@Singleton</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">PriceVolumeBean</span> {
    <span class="comment">/* Use the container's timer service */</span>
    <span class="annotation">@Resource</span> TimerService tservice;
    <span class="directive">private</span> DukeETFServlet servlet;
    ...

    <span class="annotation">@PostConstruct</span>
    <span class="directive">public</span> <span class="type">void</span> init() {
        <span class="comment">/* Initialize the EJB and create a timer */</span>
        random = <span class="keyword">new</span> <span class="predefined-type">Random</span>();
        servlet = <span class="predefined-constant">null</span>;
        tservice.createIntervalTimer(<span class="integer">1000</span>, <span class="integer">1000</span>, <span class="keyword">new</span> TimerConfig());
    }

    <span class="directive">public</span> <span class="type">void</span> registerServlet(DukeETFServlet servlet) {
        <span class="comment">/* Associate a servlet to send updates to */</span>
        <span class="local-variable">this</span>.servlet = servlet;
    }

    <span class="annotation">@Timeout</span>
    <span class="directive">public</span> <span class="type">void</span> timeout() {
        <span class="comment">/* Adjust price and volume and send updates */</span>
        price += <span class="float">1.0</span>*(random.nextInt(<span class="integer">100</span>)-<span class="integer">50</span>)/<span class="float">100.0</span>;
        volume += random.nextInt(<span class="integer">5000</span>) - <span class="integer">2500</span>;
        <span class="keyword">if</span> (servlet != <span class="predefined-constant">null</span>)
            servlet.send(price, volume);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>See <a href="#using-the-timer-service">Using the Timer Service</a> in <a href="#running-the-enterprise-bean-examples">Chapter 37, <em>Running the Enterprise Bean Examples</em></a> for more information on the timer service.</p>
</div>
</div>
<div class="sect4">
<h5 id="the-html-page"><a class="anchor" href="#the-html-page"></a>The HTML Page</h5>
<div class="paragraph">
<p>The HTML page consists of a table and some JavaScript code.
The table contains two fields referenced from JavaScript code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><span class="tag">&lt;html</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/1999/xhtml</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="tag">&lt;head&gt;</span>...<span class="tag">&lt;/head&gt;</span>
<span class="tag">&lt;body</span> <span class="attribute-name">onload</span>=<span class="string"><span class="delimiter">&quot;</span>makeAjaxRequest();<span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  ...
  <span class="tag">&lt;table&gt;</span>
    ...
    <span class="tag">&lt;td</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">price</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>--.--<span class="tag">&lt;/td&gt;</span>
    ...
    <span class="tag">&lt;td</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">volume</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>--<span class="tag">&lt;/td&gt;</span>
    ...
  <span class="tag">&lt;/table&gt;</span>
<span class="tag">&lt;/body&gt;</span>
<span class="tag">&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The JavaScript code uses the <code>XMLHttpRequest</code> API, which provides functionality for transferring data between a client and a server.
The script makes an asynchronous request to the servlet and designates a callback method.
When the server provides a response, the callback method updates the fields in the table and makes a new request.
The JavaScript code is the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="keyword">var</span> ajaxRequest;
<span class="keyword">function</span> <span class="function">updatePage</span>() {
   <span class="keyword">if</span> (ajaxRequest.readyState === <span class="integer">4</span>) {
      <span class="keyword">var</span> arraypv = ajaxRequest.responseText.split(<span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="delimiter">&quot;</span></span>);
      document.getElementById(<span class="string"><span class="delimiter">&quot;</span><span class="content">price</span><span class="delimiter">&quot;</span></span>).innerHTML = arraypv[<span class="integer">0</span>];
      document.getElementById(<span class="string"><span class="delimiter">&quot;</span><span class="content">volume</span><span class="delimiter">&quot;</span></span>).innerHTML = arraypv[<span class="integer">1</span>];
      makeAjaxRequest();
   }
}
<span class="keyword">function</span> <span class="function">makeAjaxRequest</span>() {
   ajaxRequest = <span class="keyword">new</span> XMLHttpRequest();
   ajaxRequest.onreadystatechange = updatePage;
   ajaxRequest.open(<span class="string"><span class="delimiter">&quot;</span><span class="content">GET</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8080/dukeetf/dukeetf</span><span class="delimiter">&quot;</span></span>,
                    <span class="predefined-constant">true</span>);
   ajaxRequest.send(<span class="predefined-constant">null</span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>XMLHttpRequest</code> API is supported by most modern browsers, and it is widely used in Ajax web client development (Asynchronous JavaScript and XML).</p>
</div>
<div class="paragraph">
<p>See <a href="#the-dukeetf2-example-application">The dukeetf2 Example Application</a> in <a href="#jakarta-websocket-2">Chapter 19, <em>Jakarta WebSocket</em></a> for an equivalent version of this example implemented using a WebSocket endpoint.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="running-the-dukeetf-example-application"><a class="anchor" href="#running-the-dukeetf-example-application"></a>Running the dukeetf Example Application</h4>
<div class="paragraph">
<p>This section describes how to run the <code>dukeetf</code> example application using NetBeans IDE and from the command line.</p>
</div>
<div class="sect4">
<h5 id="to-run-the-dukeetf-example-application-using-netbeans-ide"><a class="anchor" href="#to-run-the-dukeetf-example-application-using-netbeans-ide"></a>To Run the dukeetf Example Application Using NetBeans IDE</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>From the <strong>File</strong> menu, choose <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the Open Project dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/web/servlet</pre>
</div>
</div>
</li>
<li>
<p>Select the <code>dukeetf</code> folder.</p>
</li>
<li>
<p>Click <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the <strong>Projects</strong> tab, right-click the <code>dukeetf</code> project and select <strong>Run</strong>.</p>
<div class="paragraph">
<p>This command builds and packages the application into a WAR file (<code>dukeetf.war</code>) located in the <code>target</code> directory, deploys it to the server, and launches a web browser window with the following URL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080/dukeetf/</pre>
</div>
</div>
<div class="paragraph">
<p>Open the same URL in a different web browser to see how both pages get price and volume updates simultaneously.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-run-the-dukeetf-example-application-using-maven"><a class="anchor" href="#to-run-the-dukeetf-example-application-using-maven"></a>To Run the dukeetf Example Application Using Maven</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>In a terminal window, go to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/web/servlet/dukeetf/</pre>
</div>
</div>
</li>
<li>
<p>Enter the following command to deploy the application:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">mvn install</code></pre>
</div>
</div>
</li>
<li>
<p>Open a web browser window and type the following address:</p>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080/dukeetf/</pre>
</div>
</div>
<div class="paragraph">
<p>Open the same URL in a different web browser to see how both pages get price and volume updates simultaneously.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="further-information-about-jakarta-servlet-technology"><a class="anchor" href="#further-information-about-jakarta-servlet-technology"></a>Further Information about Jakarta Servlet Technology</h3>
<div class="paragraph">
<p>For more information on Jakarta Servlet technology, see the Jakarta Servlet 5.0 specification at <a href="https://jakarta.ee/specifications/servlet/5.0/" class="bare" target="_blank" rel="noopener">https://jakarta.ee/specifications/servlet/5.0/</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="jakarta-websocket-2"><a class="anchor" href="#jakarta-websocket-2"></a>Chapter 19. Jakarta WebSocket</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter describes Jakarta WebSocket, which provides support for creating WebSocket applications.
WebSocket is an application protocol that provides full-duplex communications between two peers over the TCP protocol.</p>
</div>
<div class="sect2">
<h3 id="introduction-to-websocket"><a class="anchor" href="#introduction-to-websocket"></a>Introduction to WebSocket</h3>
<div class="paragraph">
<p>In the traditional request-response model used in HTTP, the client requests resources, and the server provides responses.
The exchange is always initiated by the client; the server cannot send any data without the client requesting it first.
This model worked well for the World Wide Web when clients made occasional requests for documents that changed infrequently, but the limitations of this approach are increasingly relevant as content changes quickly and users expect a more interactive experience on the Web.
The WebSocket protocol addresses these limitations by providing a full-duplex communication channel between the client and the server.
Combined with other client technologies, such as JavaScript and HTML5, WebSocket enables web applications to deliver a richer user experience.</p>
</div>
<div class="paragraph">
<p>In a WebSocket application, the server publishes a WebSocket endpoint, and the client uses the endpoint&#8217;s URI to connect to the server.
The WebSocket protocol is symmetrical after the connection has been established; the client and the server can send messages to each other at any time while the connection is open, and they can close the connection at any time.
Clients usually connect only to one server, and servers accept connections from multiple clients.</p>
</div>
<div class="paragraph">
<p>The WebSocket protocol has two parts: handshake and data transfer.
The client initiates the handshake by sending a request to a WebSocket endpoint using its URI.
The handshake is compatible with existing HTTP-based infrastructure: web servers interpret it as an HTTP connection upgrade request.
An example handshake from a client looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="http">GET /path/to/websocket/endpoint HTTP/1.1
Host: localhost
Upgrade: websocket
Connection: Upgrade
Sec-WebSocket-Key: xqBt3ImNzJbYqRINxEFlkg==
Origin: http://localhost
Sec-WebSocket-Version: 13</code></pre>
</div>
</div>
<div class="paragraph">
<p>An example handshake from the server in response to the client looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="http">HTTP/1.1 101 Switching Protocols
Upgrade: websocket
Connection: Upgrade
Sec-WebSocket-Accept: K7DJLdLooIwIG/MOpvWFB3y3FE8=</code></pre>
</div>
</div>
<div class="paragraph">
<p>The server applies a known operation to the value of the <code>Sec-WebSocket-Key</code> header to generate the value of the <code>Sec-WebSocket-Accept</code> header.
The client applies the same operation to the value of the <code>Sec-WebSocket-Key</code> header, and the connection is established successfully if the result matches the value received from the server.
The client and the server can send messages to each other after a successful handshake.</p>
</div>
<div class="paragraph">
<p>WebSocket supports text messages (encoded as UTF-8) and binary messages.
The control frames in WebSocket are close, ping, and pong (a response to a ping frame).
Ping and pong frames may also contain application data.</p>
</div>
<div class="paragraph">
<p>WebSocket endpoints are represented by URIs that have the following form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>ws://host:port/path?query
wss://host:port/path?query</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>ws</code> scheme represents an unencrypted WebSocket connection, and the <code>wss</code> scheme represents an encrypted connection.
The <code>port</code> component is optional; the default port number is 80 for unencrypted connections and 443 for encrypted connections.
The <code>path</code> component indicates the location of an endpoint within a server.
The <code>query</code> component is optional.</p>
</div>
<div class="paragraph">
<p>Modern web browsers implement the WebSocket protocol and provide a JavaScript API to connect to endpoints, send messages, and assign callback methods for WebSocket events (such as opened connections, received messages, and closed connections).</p>
</div>
</div>
<div class="sect2">
<h3 id="creating-websocket-applications-in-the-jakarta-ee-platform"><a class="anchor" href="#creating-websocket-applications-in-the-jakarta-ee-platform"></a>Creating WebSocket Applications in the Jakarta EE Platform</h3>
<div class="paragraph">
<p>The Jakarta EE platform includes Jakarta WebSocket, which enables you to create, configure, and deploy WebSocket endpoints in web applications.
The WebSocket client API specified in Jakarta WebSocket also enables you to access remote WebSocket endpoints from any Java application.</p>
</div>
<div class="paragraph">
<p>Jakarta WebSocket consists of the following packages.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>jakarta.websocket.server</code> package contains annotations, classes, and interfaces to create and configure server endpoints.</p>
</li>
<li>
<p>The <code>jakarta.websocket</code> package contains annotations, classes, interfaces, and exceptions that are common to client and server endpoints.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>WebSocket endpoints are instances of the <code>jakarta.websocket.Endpoint</code> class.
Jakarta WebSocket enables you to create two kinds of endpoints: programmatic endpoints and annotated endpoints.
To create a programmatic endpoint, you extend the <code>Endpoint</code> class and override its lifecycle methods.
To create an annotated endpoint, you decorate a Java class and some of its methods with the annotations provided by the packages mentioned previously.
After you have created an endpoint, you deploy it to an specific URI in the application so that remote clients can connect to it.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In most cases, it is easier to create and deploy an annotated endpoint than a programmatic endpoint.
This chapter provides a simple example of a programmatic endpoint, but it focuses on annotated endpoints.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="creating-and-deploying-a-websocket-endpoint"><a class="anchor" href="#creating-and-deploying-a-websocket-endpoint"></a>Creating and Deploying a WebSocket Endpoint</h4>
<div class="paragraph">
<p>The process for creating and deploying a WebSocket endpoint:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create an endpoint class.</p>
</li>
<li>
<p>Implement the lifecycle methods of the endpoint.</p>
</li>
<li>
<p>Add your business logic to the endpoint.</p>
</li>
<li>
<p>Deploy the endpoint inside a web application.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The process is slightly different for programmatic endpoints and annotated endpoints, and it is covered in detail in the following sections.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
As opposed to servlets, WebSocket endpoints are instantiated multiple times.
The container creates an instance of an endpoint per connection to its deployment URI.
Each instance is associated with one and only one connection.
This facilitates keeping user state for each connection and makes development easier, because there is only one thread executing the code of an endpoint instance at any given time.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="programmatic-endpoints"><a class="anchor" href="#programmatic-endpoints"></a>Programmatic Endpoints</h3>
<div class="paragraph">
<p>The following example shows how to create an endpoint by extending the <code>Endpoint</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">EchoEndpoint</span> <span class="directive">extends</span> Endpoint {
   <span class="annotation">@Override</span>
   <span class="directive">public</span> <span class="type">void</span> onOpen(<span class="directive">final</span> Session session, EndpointConfig config) {
      session.addMessageHandler(<span class="keyword">new</span> MessageHandler.Whole&lt;<span class="predefined-type">String</span>&gt;() {
         <span class="annotation">@Override</span>
         <span class="directive">public</span> <span class="type">void</span> onMessage(<span class="predefined-type">String</span> msg) {
            <span class="keyword">try</span> {
               session.getBasicRemote().sendText(msg);
            } <span class="keyword">catch</span> (<span class="exception">IOException</span> e) { ... }
         }
      });
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This endpoint echoes every message received.
The <code>Endpoint</code> class defines three lifecycle methods: <code>onOpen</code>, <code>onClose</code>, and <code>onError</code>.
The <code>EchoEndpoint</code> class implements the <code>onOpen</code> method, which is the only abstract method in the <code>Endpoint</code> class.</p>
</div>
<div class="paragraph">
<p>The <code>Session</code> parameter represents a conversation between this endpoint and the remote endpoint.
The <code>addMessageHandler</code> method registers message handlers, and the <code>getBasicRemote</code> method returns an object that represents the remote endpoint.
The <code>Session</code> interface is covered in detail in the rest of this chapter.</p>
</div>
<div class="paragraph">
<p>The message handler is implemented as an anonymous inner class.
The <code>onMessage</code> method of the message handler is invoked when the endpoint receives a text message.</p>
</div>
<div class="paragraph">
<p>To deploy this programmatic endpoint, use the following code in your Jakarta EE application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ServerEndpointConfig.Builder.create(EchoEndpoint.class, <span class="string"><span class="delimiter">&quot;</span><span class="content">/echo</span><span class="delimiter">&quot;</span></span>).build();</code></pre>
</div>
</div>
<div class="paragraph">
<p>When you deploy your application, the endpoint is available at <code>ws://&lt;host&gt;:&lt;port&gt;/&lt;application&gt;/echo</code>; for example, <code>ws://localhost:8080/echoapp/echo</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="annotated-endpoints"><a class="anchor" href="#annotated-endpoints"></a>Annotated Endpoints</h3>
<div class="paragraph">
<p>The following example shows how to create the same endpoint from <a href="#programmatic-endpoints">Programmatic Endpoints</a> using annotations instead:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ServerEndpoint</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/echo</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">EchoEndpoint</span> {
   <span class="annotation">@OnMessage</span>
   <span class="directive">public</span> <span class="type">void</span> onMessage(Session session, <span class="predefined-type">String</span> msg) {
      <span class="keyword">try</span> {
         session.getBasicRemote().sendText(msg);
      } <span class="keyword">catch</span> (<span class="exception">IOException</span> e) { ... }
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The annotated endpoint is simpler than the equivalent programmatic endpoint, and it is deployed automatically with the application to the relative path defined in the <code>ServerEndpoint</code> annotation.
Instead of having to create an additional class for the message handler, this example uses the <code>OnMessage</code> annotation to designate the method invoked to handle messages.</p>
</div>
<div class="paragraph">
<p><a href="#websocket-endpoint-lifecycle-annotations">Table 19-1</a> lists the annotations available in the <code>jakarta.websocket</code> package to designate the methods that handle lifecycle events.
The examples in the table show the most common parameters for these methods.
See the API reference for details on what combinations of parameters are allowed in each case.</p>
</div>
<table id="websocket-endpoint-lifecycle-annotations" class="tableblock frame-all grid-all" style="width: 80%;">
<caption class="title">Table 19-1 WebSocket Endpoint Lifecycle Annotations</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Annotation</th>
<th class="tableblock halign-left valign-top">Event</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OnOpen</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Connection opened</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@OnOpen</span>
<span class="directive">public</span> <span class="type">void</span> open(Session session,
                 EndpointConfig conf) { }</code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OnMessage</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Message received</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@OnMessage</span>
<span class="directive">public</span> <span class="type">void</span> message(Session session,
                    <span class="predefined-type">String</span> msg) { }</code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OnError</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Connection error</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@OnError</span>
<span class="directive">public</span> <span class="type">void</span> error(Session session,
                  <span class="predefined-type">Throwable</span> error) { }</code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OnClose</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Connection closed</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@OnClose</span>
<span class="directive">public</span> <span class="type">void</span> close(Session session,
                  CloseReason reason) { }</code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="sending-and-receiving-messages"><a class="anchor" href="#sending-and-receiving-messages"></a>Sending and Receiving Messages</h3>
<div class="paragraph">
<p>WebSocket endpoints can send and receive text and binary messages.
In addition, they can also send ping frames and receive pong frames.
This section describes how to use the <code>Session</code> and <code>RemoteEndpoint</code> interfaces to send messages to the connected peer and how to use the <code>OnMessage</code> annotation to receive messages from it.</p>
</div>
<div class="sect3">
<h4 id="sending-messages"><a class="anchor" href="#sending-messages"></a>Sending Messages</h4>
<div class="paragraph">
<p>Follow these steps to send messages in an endpoint.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Obtain the <code>Session</code> object from the connection.</p>
<div class="paragraph">
<p>The <code>Session</code> object is available as a parameter in the annotated lifecycle methods of the endpoint, like those in <a href="#websocket-endpoint-lifecycle-annotations">Table 19-1</a>.
When your message is a response to a message from the peer, you have the <code>Session</code> object available inside the method that received the message (the method annotated with <code>@OnMessage</code>).
If you have to send messages that are not responses, store the <code>Session</code> object as an instance variable of the endpoint class in the method annotated with <code>@OnOpen</code> so that you can access it from other methods.</p>
</div>
</li>
<li>
<p>Use the <code>Session</code> object to obtain a <code>RemoteEndpoint</code> object.</p>
<div class="paragraph">
<p>The <code>Session.getBasicRemote</code> method and the <code>Session.getAsyncRemote</code> method return <code>RemoteEndpoint.Basic</code> and <code>RemoteEndpoint.Async</code> objects respectively.
The <code>RemoteEndpoint.Basic</code> interface provides blocking methods to send messages; the <code>RemoteEndpoint.Async</code> interface provides nonblocking methods.</p>
</div>
</li>
<li>
<p>Use the <code>RemoteEndpoint</code> object to send messages to the peer.</p>
<div class="paragraph">
<p>The following list shows some of the methods you can use to send messages to the peer.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>void RemoteEndpoint.Basic.sendText(String text)</code></p>
<div class="paragraph">
<p>Send a text message to the peer.
This method blocks until the whole message has been transmitted.</p>
</div>
</li>
<li>
<p><code>void RemoteEndpoint.Basic.sendBinary(ByteBuffer data)</code></p>
<div class="paragraph">
<p>Send a binary message to the peer.
This method blocks until the whole message has been transmitted.</p>
</div>
</li>
<li>
<p><code>void RemoteEndpoint.sendPing(ByteBuffer appData)</code></p>
<div class="paragraph">
<p>end a ping frame to the peer.</p>
</div>
</li>
<li>
<p><code>void RemoteEndpoint.sendPong(ByteBuffer appData)</code></p>
<div class="paragraph">
<p>Send a pong frame to the peer.</p>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The example in <a href="#annotated-endpoints">Annotated Endpoints</a> demonstrates how to use this procedure to reply to every incoming text message.</p>
</div>
<div class="sect4">
<h5 id="sending-messages-to-all-peers-connected-to-an-endpoint"><a class="anchor" href="#sending-messages-to-all-peers-connected-to-an-endpoint"></a>Sending Messages to All Peers Connected to an Endpoint</h5>
<div class="paragraph">
<p>Each instance of an endpoint class is associated with one and only one connection and peer; however, there are cases in which an endpoint instance needs to send messages to all connected peers.
Examples include chat applications and online auctions.
The <code>Session</code> interface provides the <code>getOpenSessions</code> method for this purpose.
The following example demonstrates how to use this method to forward incoming text messages to all connected peers:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ServerEndpoint</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/echoall</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">EchoAllEndpoint</span> {
   <span class="annotation">@OnMessage</span>
   <span class="directive">public</span> <span class="type">void</span> onMessage(Session session, <span class="predefined-type">String</span> msg) {
      <span class="keyword">try</span> {
         <span class="keyword">for</span> (Session sess : session.getOpenSessions()) {
            <span class="keyword">if</span> (sess.isOpen())
               sess.getBasicRemote().sendText(msg);
         }
      } <span class="keyword">catch</span> (<span class="exception">IOException</span> e) { ... }
   }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="receiving-messages"><a class="anchor" href="#receiving-messages"></a>Receiving Messages</h4>
<div class="paragraph">
<p>The <code>OnMessage</code> annotation designates methods that handle incoming messages.
You can have at most three methods annotated with <code>@OnMessage</code> in an endpoint, one for each message type: text, binary, and pong.
The following example demonstrates how to designate methods to receive all three types of messages:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ServerEndpoint</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/receive</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">ReceiveEndpoint</span> {
   <span class="annotation">@OnMessage</span>
   <span class="directive">public</span> <span class="type">void</span> textMessage(Session session, <span class="predefined-type">String</span> msg) {
      <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Text message: </span><span class="delimiter">&quot;</span></span> + msg);
   }
   <span class="annotation">@OnMessage</span>
   <span class="directive">public</span> <span class="type">void</span> binaryMessage(Session session, <span class="predefined-type">ByteBuffer</span> msg) {
      <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Binary message: </span><span class="delimiter">&quot;</span></span> + msg.toString());
   }
   <span class="annotation">@OnMessage</span>
   <span class="directive">public</span> <span class="type">void</span> pongMessage(Session session, PongMessage msg) {
      <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Pong message: </span><span class="delimiter">&quot;</span></span> +
                          msg.getApplicationData().toString());
   }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="maintaining-client-state-2"><a class="anchor" href="#maintaining-client-state-2"></a>Maintaining Client State</h3>
<div class="paragraph">
<p>Because the container creates an instance of the endpoint class for every connection, you can define and use instance variables to store client state information.
In addition, the <code>Session.getUserProperties</code> method provides a modifiable map to store user properties.
For example, the following endpoint replies to incoming text messages with the contents of the previous message from each client:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ServerEndpoint</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/delayedecho</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">DelayedEchoEndpoint</span> {
   <span class="annotation">@OnOpen</span>
   <span class="directive">public</span> <span class="type">void</span> open(Session session) {
      session.getUserProperties().put(<span class="string"><span class="delimiter">&quot;</span><span class="content">previousMsg</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content"> </span><span class="delimiter">&quot;</span></span>);
   }
   <span class="annotation">@OnMessage</span>
   <span class="directive">public</span> <span class="type">void</span> message(Session session, <span class="predefined-type">String</span> msg) {
      <span class="predefined-type">String</span> prev = (<span class="predefined-type">String</span>) session.getUserProperties()
                                    .get(<span class="string"><span class="delimiter">&quot;</span><span class="content">previousMsg</span><span class="delimiter">&quot;</span></span>);
      session.getUserProperties().put(<span class="string"><span class="delimiter">&quot;</span><span class="content">previousMsg</span><span class="delimiter">&quot;</span></span>, msg);
      <span class="keyword">try</span> {
         session.getBasicRemote().sendText(prev);
      } <span class="keyword">catch</span> (<span class="exception">IOException</span> e) { ... }
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To store information common to all connected clients, you can use class (static) variables; however, you are responsible for ensuring thread-safe access to them.</p>
</div>
</div>
<div class="sect2">
<h3 id="using-encoders-and-decoders"><a class="anchor" href="#using-encoders-and-decoders"></a>Using Encoders and Decoders</h3>
<div class="paragraph">
<p>Jakarta WebSocket provides support for converting between WebSocket messages and custom Java types using encoders and decoders.
An encoder takes a Java object and produces a representation that can be transmitted as a WebSocket message; for example, encoders typically produce JSON, XML, or binary representations.
A decoder performs the reverse function; it reads a WebSocket message and creates a Java object.</p>
</div>
<div class="paragraph">
<p>This mechanism simplifies WebSocket applications, because it decouples the business logic from the serialization and deserialization of objects.</p>
</div>
<div class="sect3">
<h4 id="implementing-encoders-to-convert-java-objects-into-websocket-messages"><a class="anchor" href="#implementing-encoders-to-convert-java-objects-into-websocket-messages"></a>Implementing Encoders to Convert Java Objects into WebSocket Messages</h4>
<div class="paragraph">
<p>The procedure to implement and use encoders in endpoints follows.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Implement one of the following interfaces:</p>
<div class="ulist">
<ul>
<li>
<p><code>Encoder.Text&lt;T&gt;</code> for text messages</p>
</li>
<li>
<p><code>Encoder.Binary&lt;T&gt;</code> for binary messages</p>
<div class="paragraph">
<p>These interfaces specify the <code>encode</code> method.
Implement an encoder class for each custom Java type that you want to send as a WebSocket message.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Add the names of your encoder implementations to the <code>encoders</code> optional parameter of the <code>ServerEndpoint</code> annotation.</p>
</li>
<li>
<p>Use the <code>sendObject(Object data)</code> method of the <code>RemoteEndpoint.Basic</code> or <code>RemoteEndpoint.Async</code> interfaces to send your objects as messages.
The container looks for an encoder that matches your type and uses it to convert the object to a WebSocket message.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For example, if you have two Java types (<code>MessageA</code> and <code>MessageB</code>) that you want to send as text messages, implement the <code>Encoder.Text&lt;MessageA&gt;</code> and <code>Encoder.Text&lt;MessageB&gt;</code> interfaces as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">MessageATextEncoder</span> <span class="directive">implements</span> <span class="predefined-type">Encoder</span>.Text&lt;MessageA&gt; {
   <span class="annotation">@Override</span>
   <span class="directive">public</span> <span class="type">void</span> init(EndpointConfig ec) { }
   <span class="annotation">@Override</span>
   <span class="directive">public</span> <span class="type">void</span> destroy() { }
   <span class="annotation">@Override</span>
   <span class="directive">public</span> <span class="predefined-type">String</span> encode(MessageA msgA) <span class="directive">throws</span> EncodeException {
      <span class="comment">// Access msgA's properties and convert to JSON text...</span>
      <span class="keyword">return</span> msgAJsonString;
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Implement <code>Encoder.Text&lt;MessageB&gt;</code> similarly.
Then, add the <code>encoders</code> parameter to the <code>ServerEndpoint</code> annotation as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ServerEndpoint</span>(
   value = <span class="string"><span class="delimiter">&quot;</span><span class="content">/myendpoint</span><span class="delimiter">&quot;</span></span>,
   encoders = { MessageATextEncoder.class, MessageBTextEncoder.class }
)
<span class="directive">public</span> <span class="type">class</span> <span class="class">EncEndpoint</span> { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, you can send <code>MessageA</code> and <code>MessageB</code> objects as WebSocket messages using the <code>sendObject</code> method as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">MessageA msgA = <span class="keyword">new</span> MessageA(...);
MessageB msgB = <span class="keyword">new</span> MessageB(...);
session.getBasicRemote.sendObject(msgA);
session.getBasicRemote.sendObject(msgB);</code></pre>
</div>
</div>
<div class="paragraph">
<p>As in this example, you can have more than one encoder for text messages and more than one encoder for binary messages.
Like endpoints, encoder instances are associated with one and only one WebSocket connection and peer, so there is only one thread executing the code of an encoder instance at any given time.</p>
</div>
</div>
<div class="sect3">
<h4 id="implementing-decoders-to-convert-websocket-messages-into-java-objects"><a class="anchor" href="#implementing-decoders-to-convert-websocket-messages-into-java-objects"></a>Implementing Decoders to Convert WebSocket Messages into Java Objects</h4>
<div class="paragraph">
<p>The procedure to implement and use decoders in endpoints follows.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Implement one of the following interfaces:</p>
<div class="ulist">
<ul>
<li>
<p><code>Decoder.Text&lt;T&gt;</code> for text messages</p>
</li>
<li>
<p><code>Decoder.Binary&lt;T&gt;</code> for binary messages</p>
<div class="paragraph">
<p>These interfaces specify the <code>willDecode</code> and <code>decode</code> methods.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Unlike with encoders, you can specify at most one decoder for binary messages and one decoder for text messages.
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Add the names of your decoder implementations to the <code>decoders</code> optional parameter of the <code>ServerEndpoint</code> annotation.</p>
</li>
<li>
<p>Use the <code>OnMessage</code> annotation in the endpoint to designate a method that takes your custom Java type as a parameter.
When the endpoint receives a message that can be decoded by one of the decoders you specified, the container calls the method annotated with <code>@OnMessage</code> that takes your custom Java type as a parameter if this method exists.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For example, if you have two Java types (<code>MessageA</code> and <code>MessageB</code>) that you want to send and receive as text messages, define them so that they extend a common class (<code>Message</code>).
Because you can only define one decoder for text messages, implement a decoder for the <code>Message</code> class as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">MessageTextDecoder</span> <span class="directive">implements</span> Decoder.Text&lt;Message&gt; {
   <span class="annotation">@Override</span>
   <span class="directive">public</span> <span class="type">void</span> init(EndpointConfig ec) { }
   <span class="annotation">@Override</span>
   <span class="directive">public</span> <span class="type">void</span> destroy() { }
   <span class="annotation">@Override</span>
   <span class="directive">public</span> Message decode(<span class="predefined-type">String</span> string) <span class="directive">throws</span> DecodeException {
      <span class="comment">// Read message...</span>
      <span class="keyword">if</span> ( <span class="comment">/* message is an A message */</span> )
         <span class="keyword">return</span> <span class="keyword">new</span> MessageA(...);
      <span class="keyword">else</span> <span class="keyword">if</span> ( <span class="comment">/* message is a B message */</span> )
         <span class="keyword">return</span> <span class="keyword">new</span> MessageB(...);
   }
   <span class="annotation">@Override</span>
   <span class="directive">public</span> <span class="type">boolean</span> willDecode(<span class="predefined-type">String</span> string) {
      <span class="comment">// Determine if the message can be converted into either a</span>
      <span class="comment">// MessageA object or a MessageB object...</span>
      <span class="keyword">return</span> canDecode;
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, add the <code>decoder</code> parameter to the <code>ServerEndpoint</code> annotation as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ServerEndpoint</span>(
   value = <span class="string"><span class="delimiter">&quot;</span><span class="content">/myendpoint</span><span class="delimiter">&quot;</span></span>,
   encoders = { MessageATextEncoder.class, MessageBTextEncoder.class },
   decoders = { MessageTextDecoder.class }
)
<span class="directive">public</span> <span class="type">class</span> <span class="class">EncDecEndpoint</span> { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, define a method in the endpoint class that receives <code>MessageA</code> and <code>MessageB</code> objects as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@OnMessage</span>
<span class="directive">public</span> <span class="type">void</span> message(Session session, Message msg) {
   <span class="keyword">if</span> (msg <span class="keyword">instanceof</span> MessageA) {
      <span class="comment">// We received a MessageA object...</span>
   } <span class="keyword">else</span> <span class="keyword">if</span> (msg <span class="keyword">instanceof</span> MessageB) {
      <span class="comment">// We received a MessageB object...</span>
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Like endpoints, decoder instances are associated with one and only one WebSocket connection and peer, so there is only one thread executing the code of a decoder instance at any given time.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="path-parameters"><a class="anchor" href="#path-parameters"></a>Path Parameters</h3>
<div class="paragraph">
<p>The <code>ServerEndpoint</code> annotation enables you to use URI templates to specify parts of an endpoint deployment URI as application parameters.
For example, consider this endpoint:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ServerEndpoint</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/chatrooms/{room-name}</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">ChatEndpoint</span> {
   ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the endpoint is deployed inside a web application called <code>chatapp</code> at a local Jakarta EE server in port 8080, clients can connect to the endpoint using any of the following URIs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080/chatapp/chatrooms/currentnews
http://localhost:8080/chatapp/chatrooms/music
http://localhost:8080/chatapp/chatrooms/cars
http://localhost:8080/chatapp/chatrooms/technology</pre>
</div>
</div>
<div class="paragraph">
<p>Annotated endpoints can receive path parameters as arguments in methods annotated with <code>@OnOpen</code>, <code>@OnMessage</code>, and <code>@OnClose</code>.
In this example, the endpoint uses the parameter in the <code>@OnOpen</code> method to determine which chat room the client wants to join:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ServerEndpoint</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/chatrooms/{room-name}</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">ChatEndpoint</span> {
   <span class="annotation">@OnOpen</span>
   <span class="directive">public</span> <span class="type">void</span> open(Session session,
                    EndpointConfig c,
                    <span class="annotation">@PathParam</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">room-name</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">String</span> roomName) {
      <span class="comment">// Add the client to the chat room of their choice ...</span>
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The path parameters used as arguments in these methods can be strings, primitive types, or the corresponding wrapper types.</p>
</div>
</div>
<div class="sect2">
<h3 id="handling-errors-2"><a class="anchor" href="#handling-errors-2"></a>Handling Errors</h3>
<div class="paragraph">
<p>To designate a method that handles errors in an annotated WebSocket endpoint, decorate it with <code>@OnError</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ServerEndpoint</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/testendpoint</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">TestEndpoint</span> {
   ...
   <span class="annotation">@OnError</span>
   <span class="directive">public</span> <span class="type">void</span> error(Session session, <span class="predefined-type">Throwable</span> t) {
      t.printStackTrace();
      ...
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This method is invoked when there are connection problems, runtime errors from message handlers, or conversion errors when decoding messages.</p>
</div>
</div>
<div class="sect2">
<h3 id="specifying-an-endpoint-configurator-class"><a class="anchor" href="#specifying-an-endpoint-configurator-class"></a>Specifying an Endpoint Configurator Class</h3>
<div class="paragraph">
<p>Jakarta WebSocket enables you to configure how the container creates server endpoint instances.
You can provide custom endpoint configuration logic to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Access the details of the initial HTTP request for a WebSocket connection</p>
</li>
<li>
<p>Perform custom checks on the <code>Origin</code> HTTP header</p>
</li>
<li>
<p>Modify the WebSocket handshake response</p>
</li>
<li>
<p>Choose a WebSocket subprotocol from those requested by the client</p>
</li>
<li>
<p>Control the instantiation and initialization of endpoint instances</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To provide custom endpoint configuration logic, you extend the <code>ServerEndpointConfig.Configurator</code> class and override some of its methods.
In the endpoint class, you specify the configurator class using the <code>configurator</code> parameter of the <code>ServerEndpoint</code> annotation.</p>
</div>
<div class="paragraph">
<p>For example, the following configurator class makes the handshake request object available to endpoint instances:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">CustomConfigurator</span> <span class="directive">extends</span> ServerEndpointConfig.Configurator {

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> modifyHandshake(ServerEndpointConfig conf,
                                HandshakeRequest req,
                                HandshakeResponse resp) {

        conf.getUserProperties().put(<span class="string"><span class="delimiter">&quot;</span><span class="content">handshakereq</span><span class="delimiter">&quot;</span></span>, req);
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following endpoint class configures endpoint instances with the custom configurator, which enables them to access the handshake request object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ServerEndpoint</span>(
    value = <span class="string"><span class="delimiter">&quot;</span><span class="content">/myendpoint</span><span class="delimiter">&quot;</span></span>,
    configurator = CustomConfigurator.class
)
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyEndpoint</span> {

    <span class="annotation">@OnOpen</span>
    <span class="directive">public</span> <span class="type">void</span> open(Session s, EndpointConfig conf) {
        HandshakeRequest req = (HandshakeRequest) conf.getUserProperties()
                                                      .get(<span class="string"><span class="delimiter">&quot;</span><span class="content">handshakereq</span><span class="delimiter">&quot;</span></span>);
        <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>,<span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt;&gt; headers = req.getHeaders();
        ...
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The endpoint class can use the handshake request object to access the details of the initial HTTP request, such as its headers or the <code>HttpSession</code> object.</p>
</div>
<div class="paragraph">
<p>For more information on endpoint configuration, see the API reference for the <code>ServerEndpointConfig.Configurator</code> class.</p>
</div>
</div>
<div class="sect2">
<h3 id="the-dukeetf2-example-application"><a class="anchor" href="#the-dukeetf2-example-application"></a>The dukeetf2 Example Application</h3>
<div class="paragraph">
<p>The <code>dukeetf2</code> example application, located in the <code><em>tut-install</em>/examples/web/websocket/dukeetf2/</code> directory, demonstrates how to use a WebSocket endpoint to provide data updates to web clients.
The example resembles a service that provides periodic updates on the price and trading volume of an electronically traded fund (ETF).</p>
</div>
<div class="sect3">
<h4 id="architecture-of-the-dukeetf2-sample-application"><a class="anchor" href="#architecture-of-the-dukeetf2-sample-application"></a>Architecture of the dukeetf2 Sample Application</h4>
<div class="paragraph">
<p>The <code>dukeetf2</code> example application consists of a WebSocket endpoint, an enterprise bean, and an HTML page.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The endpoint accepts connections from clients and sends them updates when new data for price and trading volume becomes available.</p>
</li>
<li>
<p>The enterprise bean updates the price and volume information once every second.</p>
</li>
<li>
<p>The HTML page uses JavaScript code to connect to the WebSocket endpoint, parse incoming messages, and update the price and volume information without reloading the page.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="the-endpoint"><a class="anchor" href="#the-endpoint"></a>The Endpoint</h5>
<div class="paragraph">
<p>The WebSocket endpoint is implemented in the <code>ETFEndpoint</code> class, which stores all connected sessions in a queue and provides a method that the enterprise bean calls when there is new information available to send:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ServerEndpoint</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/dukeetf</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">ETFEndpoint</span> {
   <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">Logger</span> logger = <span class="predefined-type">Logger</span>.getLogger(<span class="string"><span class="delimiter">&quot;</span><span class="content">ETFEndpoint</span><span class="delimiter">&quot;</span></span>);
   <span class="comment">/* Queue for all open WebSocket sessions */</span>
   <span class="directive">static</span> <span class="predefined-type">Queue</span>&lt;Session&gt; queue = <span class="keyword">new</span> <span class="predefined-type">ConcurrentLinkedQueue</span>&lt;&gt;();

   <span class="comment">/* PriceVolumeBean calls this method to send updates */</span>
   <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> send(<span class="type">double</span> price, <span class="type">int</span> volume) {
      <span class="predefined-type">String</span> msg = <span class="predefined-type">String</span>.format(<span class="string"><span class="delimiter">&quot;</span><span class="content">%.2f / %d</span><span class="delimiter">&quot;</span></span>, price, volume);
      <span class="keyword">try</span> {
         <span class="comment">/* Send updates to all open WebSocket sessions */</span>
         <span class="keyword">for</span> (Session session : queue) {
            session.getBasicRemote().sendText(msg);
            logger.log(<span class="predefined-type">Level</span>.INFO, <span class="string"><span class="delimiter">&quot;</span><span class="content">Sent: {0}</span><span class="delimiter">&quot;</span></span>, msg);
         }
      } <span class="keyword">catch</span> (<span class="exception">IOException</span> e) {
         logger.log(<span class="predefined-type">Level</span>.INFO, e.toString());
      }
    }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The lifecycle methods of the endpoint add and remove sessions to and from the queue:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ServerEndpoint</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/dukeetf</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">ETFEndpoint</span> {
   ...
   <span class="annotation">@OnOpen</span>
   <span class="directive">public</span> <span class="type">void</span> openConnection(Session session) {
      <span class="comment">/* Register this connection in the queue */</span>
      queue.add(session);
      logger.log(<span class="predefined-type">Level</span>.INFO, <span class="string"><span class="delimiter">&quot;</span><span class="content">Connection opened.</span><span class="delimiter">&quot;</span></span>);
   }

   <span class="annotation">@OnClose</span>
   <span class="directive">public</span> <span class="type">void</span> closedConnection(Session session) {
      <span class="comment">/* Remove this connection from the queue */</span>
      queue.remove(session);
      logger.log(<span class="predefined-type">Level</span>.INFO, <span class="string"><span class="delimiter">&quot;</span><span class="content">Connection closed.</span><span class="delimiter">&quot;</span></span>);
   }

   <span class="annotation">@OnError</span>
   <span class="directive">public</span> <span class="type">void</span> error(Session session, <span class="predefined-type">Throwable</span> t) {
      <span class="comment">/* Remove this connection from the queue */</span>
      queue.remove(session);
      logger.log(<span class="predefined-type">Level</span>.INFO, t.toString());
      logger.log(<span class="predefined-type">Level</span>.INFO, <span class="string"><span class="delimiter">&quot;</span><span class="content">Connection error.</span><span class="delimiter">&quot;</span></span>);
   }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="the-enterprise-bean-2"><a class="anchor" href="#the-enterprise-bean-2"></a>The Enterprise Bean</h5>
<div class="paragraph">
<p>The enterprise bean uses the timer service to generate new price and volume information every second:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Startup</span>
<span class="annotation">@Singleton</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">PriceVolumeBean</span> {
   <span class="comment">/* Use the container's timer service */</span>
   <span class="annotation">@Resource</span> TimerService tservice;
   <span class="directive">private</span> <span class="predefined-type">Random</span> random;
   <span class="directive">private</span> <span class="directive">volatile</span> <span class="type">double</span> price = <span class="float">100.0</span>;
   <span class="directive">private</span> <span class="directive">volatile</span> <span class="type">int</span> volume = <span class="integer">300000</span>;
   <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">Logger</span> logger = <span class="predefined-type">Logger</span>.getLogger(<span class="string"><span class="delimiter">&quot;</span><span class="content">PriceVolumeBean</span><span class="delimiter">&quot;</span></span>);

   <span class="annotation">@PostConstruct</span>
   <span class="directive">public</span> <span class="type">void</span> init() {
       <span class="comment">/* Initialize the EJB and create a timer */</span>
       logger.log(<span class="predefined-type">Level</span>.INFO, <span class="string"><span class="delimiter">&quot;</span><span class="content">Initializing EJB.</span><span class="delimiter">&quot;</span></span>);
       random = <span class="keyword">new</span> <span class="predefined-type">Random</span>();
       tservice.createIntervalTimer(<span class="integer">1000</span>, <span class="integer">1000</span>, <span class="keyword">new</span> TimerConfig());
   }

   <span class="annotation">@Timeout</span>
   <span class="directive">public</span> <span class="type">void</span> timeout() {
       <span class="comment">/* Adjust price and volume and send updates */</span>
       price += <span class="float">1.0</span>*(random.nextInt(<span class="integer">100</span>)-<span class="integer">50</span>)/<span class="float">100.0</span>;
       volume += random.nextInt(<span class="integer">5000</span>) - <span class="integer">2500</span>;
       ETFEndpoint.send(price, volume);
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The enterprise bean calls the <code>send</code> method of the <code>ETFEndpoint</code> class in the timeout method.
See <a href="#using-the-timer-service">Using the Timer Service</a> in xref: <a href="#running-the-enterprise-bean-examples">Running the Enterprise Bean Examples</a> for more information on the timer service.</p>
</div>
</div>
<div class="sect4">
<h5 id="the-html-page-2"><a class="anchor" href="#the-html-page-2"></a>The HTML Page</h5>
<div class="paragraph">
<p>The HTML page consists of a table and some JavaScript code.
The table contains two fields referenced from JavaScript code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><span class="doctype">&lt;!DOCTYPE html&gt;</span>
<span class="tag">&lt;html&gt;</span>
<span class="tag">&lt;head&gt;</span>...<span class="tag">&lt;/head&gt;</span>
<span class="tag">&lt;body&gt;</span>
  ...
  <span class="tag">&lt;table&gt;</span>
    ...
    <span class="tag">&lt;td</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">price</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>--.--<span class="tag">&lt;/td&gt;</span>
    ...
    <span class="tag">&lt;td</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">volume</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>--<span class="tag">&lt;/td&gt;</span>
    ...
  <span class="tag">&lt;/table&gt;</span>
<span class="tag">&lt;/body&gt;</span>
<span class="tag">&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The JavaScript code uses the WebSocket API to connect to the server endpoint and to designate a callback method for incoming messages.
The callback method updates the page with the new information.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="keyword">var</span> wsocket;
<span class="keyword">function</span> <span class="function">connect</span>() {
   wsocket = <span class="keyword">new</span> WebSocket(<span class="string"><span class="delimiter">&quot;</span><span class="content">ws://localhost:8080/dukeetf2/dukeetf</span><span class="delimiter">&quot;</span></span>);
   wsocket.onmessage = onMessage;
}
<span class="keyword">function</span> <span class="function">onMessage</span>(evt) {
   <span class="keyword">var</span> arraypv = evt.data.split(<span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="delimiter">&quot;</span></span>);
   document.getElementById(<span class="string"><span class="delimiter">&quot;</span><span class="content">price</span><span class="delimiter">&quot;</span></span>).innerHTML = arraypv[<span class="integer">0</span>];
   document.getElementById(<span class="string"><span class="delimiter">&quot;</span><span class="content">volume</span><span class="delimiter">&quot;</span></span>).innerHTML = arraypv[<span class="integer">1</span>];
}
window.addEventListener(<span class="string"><span class="delimiter">&quot;</span><span class="content">load</span><span class="delimiter">&quot;</span></span>, connect, <span class="predefined-constant">false</span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The WebSocket API is supported by most modern browsers, and it is widely used in HTML5 web client development.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="running-the-dukeetf2-example-application"><a class="anchor" href="#running-the-dukeetf2-example-application"></a>Running the dukeetf2 Example Application</h4>
<div class="paragraph">
<p>This section describes how to run the <code>dukeetf2</code> example application using NetBeans IDE and from the command line.</p>
</div>
<div class="sect4">
<h5 id="to-run-the-dukeetf2-example-application-using-netbeans-ide"><a class="anchor" href="#to-run-the-dukeetf2-example-application-using-netbeans-ide"></a>To Run the dukeetf2 Example Application Using NetBeans IDE</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>From the <strong>File</strong> menu, choose <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the Open Project dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/web/websocket</pre>
</div>
</div>
</li>
<li>
<p>Select the <code>dukeetf2</code> folder.</p>
</li>
<li>
<p>Click <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the <strong>Projects</strong> tab, right-click the <code>dukeetf2</code> project and select <strong>Run</strong>.</p>
<div class="paragraph">
<p>This command builds and packages the application into a WAR file (<code>dukeetf2.war</code>) located in the <code>target/</code> directory, deploys it to the server, and launches a web browser window with the following URL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080/dukeetf2/</pre>
</div>
</div>
<div class="paragraph">
<p>Open the same URL on a different web browser tab or window to see how both pages get price and volume updates simultaneously.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-run-the-dukeetf2-example-application-using-maven"><a class="anchor" href="#to-run-the-dukeetf2-example-application-using-maven"></a>To Run the dukeetf2 Example Application Using Maven</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>In a terminal window, go to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/web/websocket/dukeetf2/</pre>
</div>
</div>
</li>
<li>
<p>Enter the following command to deploy the application:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">mvn install</code></pre>
</div>
</div>
</li>
<li>
<p>Open a web browser window and enter the following URL:</p>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080/dukeetf2/</pre>
</div>
</div>
<div class="paragraph">
<p>Open the same URL on a different web browser tab or window to see how both pages get price and volume updates simultaneously.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="the-websocketbot-example-application"><a class="anchor" href="#the-websocketbot-example-application"></a>The websocketbot Example Application</h3>
<div class="paragraph">
<p>The <code>websocketbot</code> example application, located in the <code><em>tut-install</em>/examples/web/websocket/websocketbot/</code> directory, demonstrates how to use a WebSocket endpoint to implement a chat.
The example resembles a chat room in which many users can join and have a conversation.
Users can ask simple questions to a bot agent that is always available in the chat room.</p>
</div>
<div class="sect3">
<h4 id="architecture-of-the-websocketbot-example-application"><a class="anchor" href="#architecture-of-the-websocketbot-example-application"></a>Architecture of the websocketbot Example Application</h4>
<div class="paragraph">
<p>The <code>websocketbot</code> example application consists of the following elements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#the-cdi-bean">The CDI Bean</a>  A CDI bean (<code>BotBean</code>) that contains the logic for the bot agent to reply to messages</p>
</li>
<li>
<p><a href="#the-websocket-endpoint">The WebSocket Endpoint</a>  A WebSocket endpoint (<code>BotEndpoint</code>) that implements the chat room</p>
</li>
<li>
<p><a href="#the-application-messages">The Application Messages</a>  A set of classes (<code>Message</code>, <code>ChatMessage</code>, <code>InfoMessage</code>, <code>JoinMessage</code>, and <code>UsersMessage</code>) that represent application messages</p>
</li>
<li>
<p><a href="#the-encoder-classes">The Encoder Classes</a>  A set of classes (<code>ChatMessageEncoder</code>, <code>InfoMessageEncoder</code>, <code>JoinMessageEncoder</code>, and <code>UsersMessageEncoder</code>) that encode application messages into WebSocket text messages as JSON data</p>
</li>
<li>
<p><a href="#the-message-decoder">The Message Decoder</a>  A class (<code>MessageDecoder</code>) the parses WebSocket text messages as JSON data and decodes them into <code>JoinMessage</code> or <code>ChatMessage</code> objects</p>
</li>
<li>
<p><a href="#the-html-page-3">The HTML Page</a>  An HTML page (<code>index.html</code>) that uses JavaScript code to implement the client for the chat room</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="the-cdi-bean"><a class="anchor" href="#the-cdi-bean"></a>The CDI Bean</h5>
<div class="paragraph">
<p>The CDI bean (<code>BotBean</code>) is a Java class that contains the <code>respond</code> method.
This method compares the incoming chat message with a set of predefined questions and returns a chat response.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Named</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">BotBean</span> {
    <span class="directive">public</span> <span class="predefined-type">String</span> respond(<span class="predefined-type">String</span> msg) { ... }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="the-websocket-endpoint"><a class="anchor" href="#the-websocket-endpoint"></a>The WebSocket Endpoint</h5>
<div class="paragraph">
<p>The WebSocket endpoint (<code>BotEndpoint</code>) is an annotated endpoint that performs the following functions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Receives messages from clients</p>
</li>
<li>
<p>Forwards messages to clients</p>
</li>
<li>
<p>Maintains a list of connected clients</p>
</li>
<li>
<p>Invokes the bot agent functionality</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The endpoint specifies its deployment URI and the message encoders and decoders using the <code>ServerEndpoint</code> annotation.
The endpoint obtains an instance of the <code>BotBean</code> class and a managed executor service resource through dependency injection:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ServerEndpoint</span>(
   value = <span class="string"><span class="delimiter">&quot;</span><span class="content">/websocketbot</span><span class="delimiter">&quot;</span></span>,
   decoders = { MessageDecoder.class },
   encoders = { JoinMessageEncoder.class, ChatMessageEncoder.class,
                InfoMessageEncoder.class, UsersMessageEncoder.class }
)
<span class="comment">/* There is a BotEndpoint instance per connection */</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">BotEndpoint</span> {
   <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">Logger</span> logger = <span class="predefined-type">Logger</span>.getLogger(<span class="string"><span class="delimiter">&quot;</span><span class="content">BotEndpoint</span><span class="delimiter">&quot;</span></span>);
   <span class="comment">/* Bot functionality bean */</span>
   <span class="annotation">@Inject</span> <span class="directive">private</span> BotBean botbean;
   <span class="comment">/* Executor service for asynchronous processing */</span>
   <span class="annotation">@Resource</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">comp/DefaultManagedExecutorService</span><span class="delimiter">&quot;</span></span>)
   <span class="directive">private</span> ManagedExecutorService mes;

   <span class="annotation">@OnOpen</span>
   <span class="directive">public</span> <span class="type">void</span> openConnection(Session session) {
       logger.log(<span class="predefined-type">Level</span>.INFO, <span class="string"><span class="delimiter">&quot;</span><span class="content">Connection opened.</span><span class="delimiter">&quot;</span></span>);
   }
   ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>message</code> method processes incoming messages from clients.
The decoder converts incoming text messages into <code>JoinMessage</code> or <code>ChatMessage</code> objects, which inherit from the <code>Message</code> class.
The <code>message</code> method receives a <code>Message</code> object as a parameter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@OnMessage</span>
<span class="directive">public</span> <span class="type">void</span> message(Session session, Message msg) {
   logger.log(<span class="predefined-type">Level</span>.INFO, <span class="string"><span class="delimiter">&quot;</span><span class="content">Received: {0}</span><span class="delimiter">&quot;</span></span>, msg.toString());

   <span class="keyword">if</span> (msg <span class="keyword">instanceof</span> JoinMessage) {
      <span class="comment">/* Add the new user and notify everybody */</span>
      JoinMessage jmsg = (JoinMessage) msg;
      session.getUserProperties().put(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, jmsg.getName());
      session.getUserProperties().put(<span class="string"><span class="delimiter">&quot;</span><span class="content">active</span><span class="delimiter">&quot;</span></span>, <span class="predefined-constant">true</span>);
      logger.log(<span class="predefined-type">Level</span>.INFO, <span class="string"><span class="delimiter">&quot;</span><span class="content">Received: {0}</span><span class="delimiter">&quot;</span></span>, jmsg.toString());
      sendAll(session, <span class="keyword">new</span> InfoMessage(jmsg.getName() +
              <span class="string"><span class="delimiter">&quot;</span><span class="content"> has joined the chat</span><span class="delimiter">&quot;</span></span>));
      sendAll(session, <span class="keyword">new</span> ChatMessage(<span class="string"><span class="delimiter">&quot;</span><span class="content">Duke</span><span class="delimiter">&quot;</span></span>, jmsg.getName(),
              <span class="string"><span class="delimiter">&quot;</span><span class="content">Hi there!!</span><span class="delimiter">&quot;</span></span>));
      sendAll(session, <span class="keyword">new</span> UsersMessage(<span class="local-variable">this</span>.getUserList(session)));

   } <span class="keyword">else</span> <span class="keyword">if</span> (msg <span class="keyword">instanceof</span> ChatMessage) {
      <span class="comment">/* Forward the message to everybody */</span>
      ChatMessage cmsg = (ChatMessage) msg;
      logger.log(<span class="predefined-type">Level</span>.INFO, <span class="string"><span class="delimiter">&quot;</span><span class="content">Received: {0}</span><span class="delimiter">&quot;</span></span>, cmsg.toString());
      sendAll(session, cmsg);
      <span class="keyword">if</span> (cmsg.getTarget().compareTo(<span class="string"><span class="delimiter">&quot;</span><span class="content">Duke</span><span class="delimiter">&quot;</span></span>) == <span class="integer">0</span>) {
         <span class="comment">/* The bot replies to the message */</span>
         mes.submit(<span class="keyword">new</span> <span class="predefined-type">Runnable</span>() {
            <span class="annotation">@Override</span>
            <span class="directive">public</span> <span class="type">void</span> run() {
               <span class="predefined-type">String</span> resp = botbean.respond(cmsg.getMessage());
               sendAll(session, <span class="keyword">new</span> ChatMessage(<span class="string"><span class="delimiter">&quot;</span><span class="content">Duke</span><span class="delimiter">&quot;</span></span>,
                       cmsg.getName(), resp));
            }
         });
      }
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the message is a join message, the endpoint adds the new user to the list and notifies all connected clients.
If the message is a chat message, the endpoint forwards it to all connected clients.</p>
</div>
<div class="paragraph">
<p>If a chat message is for the bot agent, the endpoint obtains a response using the <code>BotBean</code> instance and sends it to all connected clients.
The <code>sendAll</code> method is similar to the example in <a href="#sending-messages-to-all-peers-connected-to-an-endpoint">Sending Messages to All Peers Connected to an Endpoint</a>.</p>
</div>
<div class="sect5">
<h6 id="asynchronous-processing-and-concurrency-considerations"><a class="anchor" href="#asynchronous-processing-and-concurrency-considerations"></a>Asynchronous Processing and Concurrency Considerations</h6>
<div class="paragraph">
<p>The WebSocket endpoint calls the <code>BotBean.respond</code> method to obtain a response from the bot.
In this example, this is a blocking operation; the user that sent the associated message would not be able to send or receive other chat messages until the operation completes.
To avoid this problem, the endpoint obtains an executor service from the container and executes the blocking operation in a different thread using the <code>ManagedExecutorService.submit</code> method from Concurrency Utilities for Jakarta EE.</p>
</div>
<div class="paragraph">
<p>Jakarta WebSocket specification requires that Jakarta EE implementations instantiate endpoint classes once per connection.
This facilitates the development of WebSocket endpoints, because you are guaranteed that only one thread is executing the code in a WebSocket endpoint class at any given time.
When you introduce a new thread in an endpoint, as in this example, you must ensure that variables and methods accessed by more than one thread are thread safe.
In this example, the code in <code>BotBean</code> is thread safe, and the <code>BotEndpoint.sendAll</code> method has been declared <code>synchronized</code>.</p>
</div>
<div class="paragraph">
<p>Refer to <a href="#jakarta-concurrency-2">Chapter 60, <em>Jakarta Concurrency</em></a> for more information on the managed executor service and Concurrency Utilities for Jakarta EE.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="the-application-messages"><a class="anchor" href="#the-application-messages"></a>The Application Messages</h5>
<div class="paragraph">
<p>The classes that represent application messages (<code>Message</code>, <code>ChatMessage</code>, <code>InfoMessage</code>, <code>JoinMessage</code>, and <code>UsersMessage</code>) contain only properties and getter and setter methods.
For example, the <code>ChatMessage</code> class looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ChatMessage</span> <span class="directive">extends</span> Message {
    <span class="directive">private</span> <span class="predefined-type">String</span> name;
    <span class="directive">private</span> <span class="predefined-type">String</span> target;
    <span class="directive">private</span> <span class="predefined-type">String</span> message;
    <span class="comment">/* ... Constructor, getters, and setters ... */</span>
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="the-encoder-classes"><a class="anchor" href="#the-encoder-classes"></a>The Encoder Classes</h5>
<div class="paragraph">
<p>The encoder classes convert application message objects into JSON text using the Java API for JSON Processing.
For example, the <code>ChatMessageEncoder</code> class is implemented as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">/* Encode a ChatMessage as JSON.
 * For example, (new ChatMessage(&quot;Peter&quot;,&quot;Duke&quot;,&quot;How are you?&quot;))
 * is encoded as follows:
 * {&quot;type&quot;:&quot;chat&quot;,&quot;target&quot;:&quot;Duke&quot;,&quot;message&quot;:&quot;How are you?&quot;}
 */</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">ChatMessageEncoder</span> <span class="directive">implements</span> <span class="predefined-type">Encoder</span>.Text&lt;ChatMessage&gt; {
   <span class="annotation">@Override</span>
   <span class="directive">public</span> <span class="type">void</span> init(EndpointConfig ec) { }
   <span class="annotation">@Override</span>
   <span class="directive">public</span> <span class="type">void</span> destroy() { }
   <span class="annotation">@Override</span>
   <span class="directive">public</span> <span class="predefined-type">String</span> encode(ChatMessage chatMessage) <span class="directive">throws</span> EncodeException {
      <span class="comment">// Access properties in chatMessage and write JSON text...</span>
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>See <a href="#json-processing">Chapter 20, <em>JSON Processing</em></a> for more information on the Jakarta JSON Processing.</p>
</div>
</div>
<div class="sect4">
<h5 id="the-message-decoder"><a class="anchor" href="#the-message-decoder"></a>The Message Decoder</h5>
<div class="paragraph">
<p>The message decoder (<code>MessageDecoder</code>) class converts WebSocket text messages into application messages by parsing JSON text.
It is implemented as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">/* Decode a JSON message into a JoinMessage or a ChatMessage.
 * For example, the incoming message
 * {&quot;type&quot;:&quot;chat&quot;,&quot;name&quot;:&quot;Peter&quot;,&quot;target&quot;:&quot;Duke&quot;,&quot;message&quot;:&quot;How are you?&quot;}
 * is decoded as (new ChatMessage(&quot;Peter&quot;, &quot;Duke&quot;, &quot;How are you?&quot;))
 */</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">MessageDecoder</span> <span class="directive">implements</span> Decoder.Text&lt;Message&gt; {
    <span class="comment">/* Stores the name-value pairs from a JSON message as a Map */</span>
    <span class="directive">private</span> <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>,<span class="predefined-type">String</span>&gt; messageMap;

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> init(EndpointConfig ec) { }
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> destroy() { }

    <span class="comment">/* Create a new Message object if the message can be decoded */</span>
    <span class="annotation">@Override</span>
    <span class="directive">public</span> Message decode(<span class="predefined-type">String</span> string) <span class="directive">throws</span> DecodeException {
       Message msg = <span class="predefined-constant">null</span>;
       <span class="keyword">if</span> (willDecode(string)) {
          <span class="keyword">switch</span> (messageMap.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>)) {
             <span class="keyword">case</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">join</span><span class="delimiter">&quot;</span></span>:
                msg = <span class="keyword">new</span> JoinMessage(messageMap.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>));
                <span class="keyword">break</span>;
             <span class="keyword">case</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">chat</span><span class="delimiter">&quot;</span></span>:
                msg = <span class="keyword">new</span> ChatMessage(messageMap.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>),
                                      messageMap.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">target</span><span class="delimiter">&quot;</span></span>),
                                      messageMap.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">message</span><span class="delimiter">&quot;</span></span>));
          }
       } <span class="keyword">else</span> {
          <span class="keyword">throw</span> <span class="keyword">new</span> DecodeException(string, <span class="string"><span class="delimiter">&quot;</span><span class="content">[Message] Can't decode.</span><span class="delimiter">&quot;</span></span>);
       }
       <span class="keyword">return</span> msg;
   }

   <span class="comment">/* Decode a JSON message into a Map and check if it contains
    * all the required fields according to its type. */</span>
   <span class="annotation">@Override</span>
   <span class="directive">public</span> <span class="type">boolean</span> willDecode(<span class="predefined-type">String</span> string) {
      <span class="comment">// Convert JSON data from the message into a name-value map...</span>
      <span class="comment">// Check if the message has all the fields for its message type...</span>
   }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="the-html-page-3"><a class="anchor" href="#the-html-page-3"></a>The HTML Page</h5>
<div class="paragraph">
<p>The HTML page (<code>index.html</code>) contains a field for the user name.
After the user types a name and clicks Join, three text areas are available: one to type and send messages, one for the chat room, and one with the list of users.
The page also contains a WebSocket console that shows the messages sent and received as JSON text.</p>
</div>
<div class="paragraph">
<p>The JavaScript code on the page uses the WebSocket API to connect to the endpoint, send messages, and designate callback methods.
The WebSocket API is supported by most modern browsers and is widely used for web client development with HTML5.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="running-the-websocketbot-example-application"><a class="anchor" href="#running-the-websocketbot-example-application"></a>Running the websocketbot Example Application</h4>
<div class="paragraph">
<p>This section describes how to run the <code>websocketbot</code> example application using NetBeans IDE and from the command line.</p>
</div>
<div class="sect4">
<h5 id="to-run-the-websocketbot-example-application-using-netbeans-ide"><a class="anchor" href="#to-run-the-websocketbot-example-application-using-netbeans-ide"></a>To Run the websocketbot Example Application Using NetBeans IDE</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>From the <strong>File</strong> menu, choose <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the Open Project dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/web/websocket</pre>
</div>
</div>
</li>
<li>
<p>Select the <code>websocketbot</code> folder.</p>
</li>
<li>
<p>Click <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the <strong>Projects</strong> tab, right-click the <code>websocketbot</code> project and select <strong>Run</strong>.</p>
<div class="paragraph">
<p>This command builds and packages the application into a WAR file, <code>websocketbot.war</code>, located in the <code>target/</code> directory; deploys it to the server; and launches a web browser window with the following URL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080/websocketbot/</pre>
</div>
</div>
<div class="paragraph">
<p>See <a href="#to-test-the-websocketbot-example-application">To Test the websocketbot Example Application</a> for more information.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-run-the-websocketbot-example-application-using-maven"><a class="anchor" href="#to-run-the-websocketbot-example-application-using-maven"></a>To Run the websocketbot Example Application Using Maven</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>In a terminal window, go to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/web/websocket/websocketbot/</pre>
</div>
</div>
</li>
<li>
<p>Enter the following command to deploy the application:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">mvn install</code></pre>
</div>
</div>
</li>
<li>
<p>Open a web browser window and type the following address:</p>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080/websocketbot/</pre>
</div>
</div>
<div class="paragraph">
<p>See <a href="#to-test-the-websocketbot-example-application">To Test the websocketbot Example Application</a> for more information.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-test-the-websocketbot-example-application"><a class="anchor" href="#to-test-the-websocketbot-example-application"></a>To Test the websocketbot Example Application</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>On the main page, type your name on the first text field and press the Enter key.</p>
<div class="paragraph">
<p>The list of connected users appears on the text area on the right.
The text area on the left is the chat room.</p>
</div>
</li>
<li>
<p>Type a message on the text area below the login button.
For example, type the messages in bold and press enter to obtain responses similar to the following:</p>
<div class="listingblock">
<div class="content">
<pre>[--Peter has joined the chat--]
Duke: @Peter Hi there!!
Peter: @Duke how are you?
Duke: @Peter I'm doing great, thank you!
Peter: @Duke when is your birthday?
Duke: @Peter My birthday is on May 23rd. Thanks for asking!</pre>
</div>
</div>
</li>
<li>
<p>Join the chat from another browser window by copying and pasting the URI on the address bar and joining with a different name.</p>
<div class="paragraph">
<p>The new user name appears in the list of users in both browser windows.
You can send messages from either window and see how they appear in the other.</p>
</div>
</li>
<li>
<p>Click Show WebSocket Console.</p>
<div class="paragraph">
<p>The console shows the messages sent and received as JSON text.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="further-information-about-websocket"><a class="anchor" href="#further-information-about-websocket"></a>Further Information about WebSocket</h3>
<div class="paragraph">
<p>For more information on WebSocket in Jakarta EE, see the Jakarta WebSocket specification:</p>
</div>
<div class="paragraph">
<p><a href="https://jakarta.ee/specifications/websocket/2.0/" class="bare" target="_blank" rel="noopener">https://jakarta.ee/specifications/websocket/2.0/</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="json-processing"><a class="anchor" href="#json-processing"></a>Chapter 20. JSON Processing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter describes Jakarta JSON Processing.
JSON is a data exchange format widely used in web services and other connected applications.
Jakarta JSON Processing provides an API to parse, transform, and query JSON data using the object model or the streaming model.</p>
</div>
<div class="sect2">
<h3 id="introduction-to-json"><a class="anchor" href="#introduction-to-json"></a>Introduction to JSON</h3>
<div class="paragraph">
<p>JSON is a text-based data exchange format derived from JavaScript that is used in web services and other connected applications.
The following sections provide an introduction to JSON syntax, an overview of JSON uses, and a description of the most common approaches to generate and parse JSON.</p>
</div>
<div class="sect3">
<h4 id="json-syntax"><a class="anchor" href="#json-syntax"></a>JSON Syntax</h4>
<div class="paragraph">
<p>JSON defines only two data structures: objects and arrays.
An object is a set of name-value pairs, and an array is a list of values.
JSON defines seven value types: string, number, object, array, true, false, and null.</p>
</div>
<div class="paragraph">
<p>The following example shows JSON data for a sample object that contains name-value pairs.
The value for the name <code>"phoneNumbers"</code> is an array whose elements are two objects.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
   <span class="key"><span class="delimiter">&quot;</span><span class="content">firstName</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Duke</span><span class="delimiter">&quot;</span></span>,
   <span class="key"><span class="delimiter">&quot;</span><span class="content">lastName</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Java</span><span class="delimiter">&quot;</span></span>,
   <span class="key"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>: <span class="integer">18</span>,
   <span class="key"><span class="delimiter">&quot;</span><span class="content">streetAddress</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">100 Internet Dr</span><span class="delimiter">&quot;</span></span>,
   <span class="key"><span class="delimiter">&quot;</span><span class="content">city</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">JavaTown</span><span class="delimiter">&quot;</span></span>,
   <span class="key"><span class="delimiter">&quot;</span><span class="content">state</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">JA</span><span class="delimiter">&quot;</span></span>,
   <span class="key"><span class="delimiter">&quot;</span><span class="content">postalCode</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">12345</span><span class="delimiter">&quot;</span></span>,
   <span class="key"><span class="delimiter">&quot;</span><span class="content">phoneNumbers</span><span class="delimiter">&quot;</span></span>: [
      { <span class="key"><span class="delimiter">&quot;</span><span class="content">Mobile</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">111-111-1111</span><span class="delimiter">&quot;</span></span> },
      { <span class="key"><span class="delimiter">&quot;</span><span class="content">Home</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">222-222-2222</span><span class="delimiter">&quot;</span></span> }
   ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>JSON has the following syntax.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Objects are enclosed in braces (<code>{}</code>), their name-value pairs are separated by a comma (<code>,</code>), and the name and value in a pair are separated by a colon (<code>:</code>).
Names in an object are strings, whereas values may be of any of the seven value types, including another object or an array.</p>
</li>
<li>
<p>Arrays are enclosed in brackets (<code>[]</code>), and their values are separated by a comma (<code>,</code>).
Each value in an array may be of a different type, including another array or an object.</p>
</li>
<li>
<p>When objects and arrays contain other objects or arrays, the data has a tree-like structure.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="uses-of-json"><a class="anchor" href="#uses-of-json"></a>Uses of JSON</h4>
<div class="paragraph">
<p>JSON is often used as a common format to serialize and deserialize data in applications that communicate with each other over the Internet.
These applications are created using different programming languages and run in very different environments.
JSON is suited to this scenario because it is an open standard, it is easy to read and write, and it is more compact than other representations.</p>
</div>
<div class="paragraph">
<p>RESTful web services use JSON extensively as the format for the data inside requests and responses.
The HTTP header used to indicate that the content of a request or a response is JSON data is</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="http">Content-Type: application/json</code></pre>
</div>
</div>
<div class="paragraph">
<p>JSON representations are usually more compact than XML representations because JSON does not have closing tags.
Unlike XML, JSON does not have a widely accepted schema for defining and validating the structure of JSON data.</p>
</div>
</div>
<div class="sect3">
<h4 id="generating-and-parsing-json-data"><a class="anchor" href="#generating-and-parsing-json-data"></a>Generating and Parsing JSON Data</h4>
<div class="paragraph">
<p>For generating and parsing JSON data, there are two programming models, which are similar to those used for XML documents.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The object model creates a tree that represents the JSON data in memory.
The tree can then be navigated, analyzed, or modified.
This approach is the most flexible and allows for processing that requires access to the complete contents of the tree.
However, it is often slower than the streaming model and requires more memory.
The object model generates JSON output by navigating the entire tree at once.</p>
</li>
<li>
<p>The streaming model uses an event-based parser that reads JSON data one element at a time.
The parser generates events and stops for processing when an object or an array begins or ends, when it finds a key, or when it finds a value.
Each element can be processed or discarded by the application code, and then the parser proceeds to the next event.
This approach is adequate for local processing, in which the processing of an element does not require information from the rest of the data.
The streaming model generates JSON output to a given stream by making a function call with one element at a time.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There are many JSON generators and parsers available for different programming languages and environments. <a href="#json-processing-in-the-jakarta-ee-platform">JSON Processing in the Jakarta EE Platform</a> describes the functionality provided by Jakarta JSON Processing.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="json-processing-in-the-jakarta-ee-platform"><a class="anchor" href="#json-processing-in-the-jakarta-ee-platform"></a>JSON Processing in the Jakarta EE Platform</h3>
<div class="paragraph">
<p>Jakarta EE includes support for the Jakarta JSON Processing spec, which provides an API to parse, transform, and query JSON data using the object model or the streaming model described in <a href="#generating-and-parsing-json-data">Generating and Parsing JSON Data</a>.
Jakarta JSON Processing contains the following packages:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>jakarta.json</code> package contains a reader interface, a writer interface, a model builder interface for the object model, and utility classes and Java types for JSON elements.
This package also includes several classes that implement other JSON-related standards: <a href="https://tools.ietf.org/html/rfc6901" target="_blank" rel="noopener">JSON Pointer</a>, <a href="https://tools.ietf.org/html/rfc6902" target="_blank" rel="noopener">JSON Patch</a>, and <a href="https://tools.ietf.org/html/rfc7396" target="_blank" rel="noopener">JSON Merge Patch</a>.
These standards are used to retrieve, transform or manipulate values in an object model.
<a href="#main-classes-and-interfaces-in-jakarta.json">Table 20-1</a> lists the main classes and interfaces in this package.</p>
</li>
<li>
<p>The <code>jakarta.json.stream</code> package contains a parser interface and a generator interface for the streaming model.
<a href="#main-classes-and-interfaces-in-jakarta.json.stream">Table 20-2</a> lists the main classes and interfaces in this package.</p>
</li>
<li>
<p>The <code>jakarta.json.spi</code> package contains a Service Provider Interface (SPI) to plug in implementations for JSON processing objects.
This package contains the <code>JsonProvider</code> class, which contains the methods that a service provider implements.</p>
</li>
</ul>
</div>
<table id="main-classes-and-interfaces-in-jakarta.json" class="tableblock frame-all grid-all" style="width: 99%;">
<caption class="title">Table 20-1 Main Classes and Interfaces in jakarta.json</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Class or Interface</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Json</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contains static methods to create instances of JSON parsers, builders, and generators.
This class also contains methods to create parser, builder, and generator factory objects.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JsonReader</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reads JSON data from a stream and creates an object model in memory.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JsonObjectBuilder</code>, <code>JsonArrayBuilder</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Create an object model or an array model in memory by adding elements from application code.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JsonWriter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Writes an object model from memory to a stream.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JsonValue</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Represents an element (such as an object, an array, or a value) in JSON data.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JsonStructure</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Represents an object or an array in JSON data.
This interface is a subtype of <code>JsonValue</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JsonObject</code>, <code>JsonArray</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Represent an object or an array in JSON data.
These two interfaces are subtypes of <code>JsonStructure</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JsonPointer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contains methods for operating on specific targets within JSON documents.
The targets can be <code>JsonValue</code>, <code>JsonObject</code>, or <code>JsonArray</code> objects.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JsonPatch</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An interface for supporting a sequence of operations to be applied to a target JSON resource.
The operations are defined within a JSON patch document.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JsonMergePatch</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An interface for supporting updates to target JSON resources.
A JSON patch document is compared with the target resource to determine the specific set of change operations to be applied.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JsonString</code>, <code>JsonNumber</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Represent data types for elements in JSON data.
These two interfaces are subtypes of <code>JsonValue</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JsonException</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates that a problem occurred during JSON processing.</p></td>
</tr>
</tbody>
</table>
<table id="main-classes-and-interfaces-in-jakarta.json.stream" class="tableblock frame-all grid-all" style="width: 99%;">
<caption class="title">Table 20-2 Main Classes and Interfaces in jakarta.json.stream</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Class or Interface</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JsonParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Represents an event-based parser that can read JSON data from a stream or from an object model.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JsonGenerator</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Writes JSON data to a stream one element at a time.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="using-the-object-model-api"><a class="anchor" href="#using-the-object-model-api"></a>Using the Object Model API</h3>
<div class="paragraph">
<p>This section describes four use cases of the object model API: creating an object model from JSON data, creating an object model from application code, navigating an object model, and writing an object model to a stream.</p>
</div>
<div class="sect3">
<h4 id="creating-an-object-model-from-json-data"><a class="anchor" href="#creating-an-object-model-from-json-data"></a>Creating an Object Model from JSON Data</h4>
<div class="paragraph">
<p>The following code demonstrates how to create an object model from JSON data in a text file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">java.io.FileReader</span>;
<span class="keyword">import</span> <span class="include">jakarta.json.Json</span>;
<span class="keyword">import</span> <span class="include">jakarta.json.JsonReader</span>;
<span class="keyword">import</span> <span class="include">jakarta.json.JsonStructure</span>;
...
JsonReader reader = Json.createReader(<span class="keyword">new</span> <span class="predefined-type">FileReader</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">jsondata.txt</span><span class="delimiter">&quot;</span></span>));
JsonStructure jsonst = reader.read();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The object reference <code>jsonst</code> can be either of type <code>JsonObject</code> or of type <code>JsonArray</code>, depending on the contents of the file.
<code>JsonObject</code> and <code>JsonArray</code> are subtypes of <code>JsonStructure</code>.
This reference represents the top of the tree and can be used to navigate the tree or to write it to a stream as JSON data.</p>
</div>
</div>
<div class="sect3">
<h4 id="creating-an-object-model-from-application-code"><a class="anchor" href="#creating-an-object-model-from-application-code"></a>Creating an Object Model from Application Code</h4>
<div class="paragraph">
<p>The following code demonstrates how to create an object model from application code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">jakarta.json.Json</span>;
<span class="keyword">import</span> <span class="include">jakarta.json.JsonObject</span>;
...
JsonObject model = Json.createObjectBuilder()
   .add(<span class="string"><span class="delimiter">&quot;</span><span class="content">firstName</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Duke</span><span class="delimiter">&quot;</span></span>)
   .add(<span class="string"><span class="delimiter">&quot;</span><span class="content">lastName</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Java</span><span class="delimiter">&quot;</span></span>)
   .add(<span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>, <span class="integer">18</span>)
   .add(<span class="string"><span class="delimiter">&quot;</span><span class="content">streetAddress</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">100 Internet Dr</span><span class="delimiter">&quot;</span></span>)
   .add(<span class="string"><span class="delimiter">&quot;</span><span class="content">city</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">JavaTown</span><span class="delimiter">&quot;</span></span>)
   .add(<span class="string"><span class="delimiter">&quot;</span><span class="content">state</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">JA</span><span class="delimiter">&quot;</span></span>)
   .add(<span class="string"><span class="delimiter">&quot;</span><span class="content">postalCode</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">12345</span><span class="delimiter">&quot;</span></span>)
   .add(<span class="string"><span class="delimiter">&quot;</span><span class="content">phoneNumbers</span><span class="delimiter">&quot;</span></span>, Json.createArrayBuilder()
      .add(Json.createObjectBuilder()
         .add(<span class="string"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">mobile</span><span class="delimiter">&quot;</span></span>)
         .add(<span class="string"><span class="delimiter">&quot;</span><span class="content">number</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">111-111-1111</span><span class="delimiter">&quot;</span></span>))
      .add(Json.createObjectBuilder()
         .add(<span class="string"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">home</span><span class="delimiter">&quot;</span></span>)
         .add(<span class="string"><span class="delimiter">&quot;</span><span class="content">number</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">222-222-2222</span><span class="delimiter">&quot;</span></span>)))
   .build();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The object reference <code>model</code> represents the top of the tree, which is created by nesting calls to the <code>add</code> methods and built by calling the <code>build</code> method.
The <code>JsonObjectBuilder</code> class contains the following <code>add</code> methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">JsonObjectBuilder add(<span class="predefined-type">String</span> name, <span class="predefined-type">BigDecimal</span> value)
JsonObjectBuilder add(<span class="predefined-type">String</span> name, <span class="predefined-type">BigInteger</span> value)
JsonObjectBuilder add(<span class="predefined-type">String</span> name, <span class="type">boolean</span> value)
JsonObjectBuilder add(<span class="predefined-type">String</span> name, <span class="type">double</span> value)
JsonObjectBuilder add(<span class="predefined-type">String</span> name, <span class="type">int</span> value)
JsonObjectBuilder add(<span class="predefined-type">String</span> name, JsonArrayBuilder builder)
JsonObjectBuilder add(<span class="predefined-type">String</span> name, JsonObjectBuilder builder)
JsonObjectBuilder add(<span class="predefined-type">String</span> name, JsonValue value)
JsonObjectBuilder add(<span class="predefined-type">String</span> name, <span class="type">long</span> value)
JsonObjectBuilder add(<span class="predefined-type">String</span> name, <span class="predefined-type">String</span> value)
JsonObjectBuilder addNull(<span class="predefined-type">String</span> name)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>JsonArrayBuilder</code> class contains similar <code>add</code> methods that do not have a name (key) parameter.
You can nest arrays and objects by passing a new <code>JsonArrayBuilder</code> object or a new <code>JsonObjectBuilder</code> object to the corresponding <code>add</code> method, as shown in this example.</p>
</div>
<div class="paragraph">
<p>The resulting tree represents the JSON data from <a href="#json-syntax">JSON Syntax</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="navigating-an-object-model"><a class="anchor" href="#navigating-an-object-model"></a>Navigating an Object Model</h4>
<div class="paragraph">
<p>The following code demonstrates a simple approach to navigating an object model:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">jakarta.json.JsonValue</span>;
<span class="keyword">import</span> <span class="include">jakarta.json.JsonObject</span>;
<span class="keyword">import</span> <span class="include">jakarta.json.JsonArray</span>;
<span class="keyword">import</span> <span class="include">jakarta.json.JsonNumber</span>;
<span class="keyword">import</span> <span class="include">jakarta.json.JsonString</span>;
...
public <span class="directive">static</span> <span class="type">void</span> navigateTree(JsonValue tree, <span class="predefined-type">String</span> key) {
   <span class="keyword">if</span> (key != <span class="predefined-constant">null</span>)
      <span class="predefined-type">System</span>.out.print(<span class="string"><span class="delimiter">&quot;</span><span class="content">Key </span><span class="delimiter">&quot;</span></span> + key + <span class="string"><span class="delimiter">&quot;</span><span class="content">: </span><span class="delimiter">&quot;</span></span>);
   <span class="keyword">switch</span>(tree.getValueType()) {
      <span class="keyword">case</span> OBJECT:
         <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">OBJECT</span><span class="delimiter">&quot;</span></span>);
         JsonObject object = (JsonObject) tree;
         <span class="keyword">for</span> (<span class="predefined-type">String</span> name : object.keySet())
            navigateTree(object.get(name), name);
         <span class="keyword">break</span>;
      <span class="keyword">case</span> ARRAY:
         <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">ARRAY</span><span class="delimiter">&quot;</span></span>);
         JsonArray array = (JsonArray) tree;
         <span class="keyword">for</span> (JsonValue val : array)
            navigateTree(val, <span class="predefined-constant">null</span>);
         <span class="keyword">break</span>;
      <span class="keyword">case</span> STRING:
         JsonString st = (JsonString) tree;
         <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">STRING </span><span class="delimiter">&quot;</span></span> + st.getString());
         <span class="keyword">break</span>;
      <span class="keyword">case</span> NUMBER:
         JsonNumber num = (JsonNumber) tree;
         <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">NUMBER </span><span class="delimiter">&quot;</span></span> + num.toString());
         <span class="keyword">break</span>;
      <span class="keyword">case</span> TRUE:
      <span class="keyword">case</span> FALSE:
      <span class="keyword">case</span> NULL:
         <span class="predefined-type">System</span>.out.println(tree.getValueType().toString());
         <span class="keyword">break</span>;
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The method <code>navigateTree</code> can be used with the models built in <a href="#creating-an-object-model-from-json-data">Creating an Object Model from JSON Data</a> and <a href="#creating-an-object-model-from-application-code">Creating an Object Model from Application Code</a> as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">navigateTree(model, <span class="predefined-constant">null</span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>navigateTree</code> method takes two arguments: a JSON element and a key.
The key is used only to help print the key-value pairs inside objects.
Elements in a tree are represented by the <code>JsonValue</code> type.
If the element is an object or an array, a new call to this method is made for every element contained in the object or array.
If the element is a value, it is printed to the standard output.</p>
</div>
<div class="paragraph">
<p>The <code>JsonValue.getValueType</code> method identifies the element as an object, an array, or a value.
For objects, the <code>JsonObject.keySet</code> method returns a set of strings that contains the keys in the object, and the <code>JsonObject.get(String name)</code> method returns the value of the element whose key is <code>name</code>.
For arrays, <code>JsonArray</code> implements the <code>List&lt;JsonValue&gt;</code> interface.
You can use enhanced <code>for</code> loops with the <code>Set&lt;String&gt;</code> instance returned by <code>JsonObject.keySet</code> and with instances of <code>JsonArray</code>, as shown in this example.</p>
</div>
<div class="paragraph">
<p>The <code>navigateTree</code> method for the model built in <a href="#creating-an-object-model-from-application-code">Creating an Object Model from Application Code</a> produces the following output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>OBJECT
   Key firstName: STRING Duke
   Key lastName: STRING Java
   Key age: NUMBER 18
   Key streetAddress: STRING 100 Internet Dr
   Key city: STRING JavaTown
   Key state: STRING JA
   Key postalCode: STRING 12345
   Key phoneNumbers: ARRAY
      OBJECT
         Key type: STRING mobile
         Key number: STRING 111-111-1111
      OBJECT
         Key type: STRING home
         Key number: STRING 222-222-2222</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="writing-an-object-model-to-a-stream"><a class="anchor" href="#writing-an-object-model-to-a-stream"></a>Writing an Object Model to a Stream</h4>
<div class="paragraph">
<p>The object models created in <a href="#creating-an-object-model-from-json-data">Creating an Object Model from JSON Data</a> and <a href="#creating-an-object-model-from-application-code">Creating an Object Model from Application Code</a> can be written to a stream using the <code>JsonWriter</code> class as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">java.io.StringWriter</span>;
<span class="keyword">import</span> <span class="include">jakarta.json.JsonWriter</span>;
...
StringWriter stWriter = <span class="keyword">new</span> <span class="predefined-type">StringWriter</span>();
JsonWriter jsonWriter = Json.createWriter(stWriter);
jsonWriter.writeObject(model);
jsonWriter.close();

<span class="predefined-type">String</span> jsonData = stWriter.toString();
<span class="predefined-type">System</span>.out.println(jsonData);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Json.createWriter</code> method takes an output stream as a parameter.
The <code>JsonWriter.writeObject</code> method writes the object to the stream.
The <code>JsonWriter.close</code> method closes the underlying output stream.</p>
</div>
<div class="paragraph">
<p>The following example uses <code>try-with-resources</code> to close the JSON writer automatically:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">StringWriter</span> stWriter = <span class="keyword">new</span> <span class="predefined-type">StringWriter</span>();
<span class="keyword">try</span> (JsonWriter jsonWriter = Json.createWriter(stWriter)) {
   jsonWriter.writeObject(model);
}

<span class="predefined-type">String</span> jsonData = stWriter.toString();
<span class="predefined-type">System</span>.out.println(jsonData);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-the-streaming-api"><a class="anchor" href="#using-the-streaming-api"></a>Using the Streaming API</h3>
<div class="paragraph">
<p>This section describes two use cases of the streaming API.</p>
</div>
<div class="sect3">
<h4 id="reading-json-data-using-a-parser"><a class="anchor" href="#reading-json-data-using-a-parser"></a>Reading JSON Data Using a Parser</h4>
<div class="paragraph">
<p>The streaming API is the most efficient approach for parsing JSON text.
The following code demonstrates how to create a <code>JsonParser</code> object and how to parse JSON data using events:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">jakarta.json.Json</span>;
<span class="keyword">import</span> <span class="include">jakarta.json.stream.JsonParser</span>;
...
JsonParser parser = Json.createParser(<span class="keyword">new</span> <span class="predefined-type">StringReader</span>(jsonData));
<span class="keyword">while</span> (parser.hasNext()) {
   JsonParser.Event event = parser.next();
   <span class="keyword">switch</span>(event) {
      <span class="keyword">case</span> START_ARRAY:
      <span class="keyword">case</span> END_ARRAY:
      <span class="keyword">case</span> START_OBJECT:
      <span class="keyword">case</span> END_OBJECT:
      <span class="keyword">case</span> VALUE_FALSE:
      <span class="keyword">case</span> VALUE_NULL:
      <span class="keyword">case</span> VALUE_TRUE:
         <span class="predefined-type">System</span>.out.println(event.toString());
         <span class="keyword">break</span>;
      <span class="keyword">case</span> KEY_NAME:
         <span class="predefined-type">System</span>.out.print(event.toString() + <span class="string"><span class="delimiter">&quot;</span><span class="content"> </span><span class="delimiter">&quot;</span></span> +
                          parser.getString() + <span class="string"><span class="delimiter">&quot;</span><span class="content"> - </span><span class="delimiter">&quot;</span></span>);
         <span class="keyword">break</span>;
      <span class="keyword">case</span> VALUE_STRING:
      <span class="keyword">case</span> VALUE_NUMBER:
         <span class="predefined-type">System</span>.out.println(event.toString() + <span class="string"><span class="delimiter">&quot;</span><span class="content"> </span><span class="delimiter">&quot;</span></span> +
                            parser.getString());
         <span class="keyword">break</span>;
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example consists of three steps.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Obtain a parser instance by calling the <code>Json.createParser</code> static method.</p>
</li>
<li>
<p>Iterate over the parser events with the <code>JsonParser.hasNext</code> and the <code>JsonParser.next</code> methods.</p>
</li>
<li>
<p>Perform local processing for each element.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The example shows the ten possible event types from the parser.
The parser&#8217;s <code>next</code> method advances it to the next event.
For the event types <code>KEY_NAME</code>, <code>VALUE_STRING</code>, and <code>VALUE_NUMBER</code>, you can obtain the content of the element by calling the method <code>JsonParser.getString</code>.
For <code>VALUE_NUMBER</code> events, you can also use the following methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>JsonParser.isIntegralNumber</code></p>
</li>
<li>
<p><code>JsonParser.getInt</code></p>
</li>
<li>
<p><code>JsonParser.getLong</code></p>
</li>
<li>
<p><code>JsonParser.getBigDecimal</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See the Jakarta EE API reference for the <code>jakarta.json.stream.JsonParser</code> interface for more information.</p>
</div>
<div class="paragraph">
<p>The output of this example is the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>START_OBJECT
KEY_NAME firstName - VALUE_STRING Duke
KEY_NAME lastName - VALUE_STRING Java
KEY_NAME age - VALUE_NUMBER 18
KEY_NAME streetAddress - VALUE_STRING 100 Internet Dr
KEY_NAME city - VALUE_STRING JavaTown
KEY_NAME state - VALUE_STRING JA
KEY_NAME postalCode - VALUE_STRING 12345
KEY_NAME phoneNumbers - START_ARRAY
START_OBJECT
KEY_NAME type - VALUE_STRING mobile
KEY_NAME number - VALUE_STRING 111-111-1111
END_OBJECT
START_OBJECT
KEY_NAME type - VALUE_STRING home
KEY_NAME number - VALUE_STRING 222-222-2222
END_OBJECT
END_ARRAY
END_OBJECT</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="writing-json-data-using-a-generator"><a class="anchor" href="#writing-json-data-using-a-generator"></a>Writing JSON Data Using a Generator</h4>
<div class="paragraph">
<p>The following code demonstrates how to write JSON data to a file using the streaming API:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">FileWriter</span> writer = <span class="keyword">new</span> <span class="predefined-type">FileWriter</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">test.txt</span><span class="delimiter">&quot;</span></span>);
JsonGenerator gen = Json.createGenerator(writer);
gen.writeStartObject()
   .write(<span class="string"><span class="delimiter">&quot;</span><span class="content">firstName</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Duke</span><span class="delimiter">&quot;</span></span>)
   .write(<span class="string"><span class="delimiter">&quot;</span><span class="content">lastName</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Java</span><span class="delimiter">&quot;</span></span>)
   .write(<span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>, <span class="integer">18</span>)
   .write(<span class="string"><span class="delimiter">&quot;</span><span class="content">streetAddress</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">100 Internet Dr</span><span class="delimiter">&quot;</span></span>)
   .write(<span class="string"><span class="delimiter">&quot;</span><span class="content">city</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">JavaTown</span><span class="delimiter">&quot;</span></span>)
   .write(<span class="string"><span class="delimiter">&quot;</span><span class="content">state</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">JA</span><span class="delimiter">&quot;</span></span>)
   .write(<span class="string"><span class="delimiter">&quot;</span><span class="content">postalCode</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">12345</span><span class="delimiter">&quot;</span></span>)
   .writeStartArray(<span class="string"><span class="delimiter">&quot;</span><span class="content">phoneNumbers</span><span class="delimiter">&quot;</span></span>)
      .writeStartObject()
         .write(<span class="string"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">mobile</span><span class="delimiter">&quot;</span></span>)
         .write(<span class="string"><span class="delimiter">&quot;</span><span class="content">number</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">111-111-1111</span><span class="delimiter">&quot;</span></span>)
      .writeEnd()
      .writeStartObject()
         .write(<span class="string"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">home</span><span class="delimiter">&quot;</span></span>)
         .write(<span class="string"><span class="delimiter">&quot;</span><span class="content">number</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">222-222-2222</span><span class="delimiter">&quot;</span></span>)
      .writeEnd()
   .writeEnd()
.writeEnd();
gen.close();</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example obtains a JSON generator by calling the <code>Json.createGenerator</code> static method, which takes a writer or an output stream as a parameter.
The example writes JSON data to the <code>test.txt</code> file by nesting calls to the <code>write</code>, <code>writeStartArray</code>, <code>writeStartObject</code>, and <code>writeEnd</code> methods.
The <code>JsonGenerator.close</code> method closes the underlying writer or output stream.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="json-in-jakarta-ee-restful-web-services"><a class="anchor" href="#json-in-jakarta-ee-restful-web-services"></a>JSON in Jakarta EE RESTful Web Services</h3>
<div class="paragraph">
<p>This section explains how the Jakarta JSON Processing is related to other Jakarta EE packages that provide JSON support for RESTful web services.
See <a href="#building-restful-web-services-with-jakarta-rest">Chapter 32, <em>Building RESTful Web Services with Jakarta REST</em></a> for more information on RESTful web services.</p>
</div>
<div class="paragraph">
<p>Jersey, the Jakarta RESTful Web Services implementation included in GlassFish Server, provides support for binding JSON data from RESTful resource methods to Java objects using Jakarta XML Binding, as described in <a href="#using-jakarta-rest-with-jakarta-xml-binding">Using Jakarta REST with Jakarta XML Binding</a> in <a href="#jakarta-rest-advanced-topics-and-an-example">Chapter 34, <em>Jakarta REST: Advanced Topics and an Example</em></a>.
However, JSON support is not part of Jakarta RESTful Web Services or Jakarta XML Binding, so that procedure may not work for Jakarta EE implementations other than GlassFish Server.</p>
</div>
<div class="paragraph">
<p>You can still use the Jakarta JSON Processing with Jakarta RESTful Web Services resource methods.
For more information, see the sample code for JSON Processing included with the Jakarta EE tutorial examples.</p>
</div>
</div>
<div class="sect2">
<h3 id="the-jsonpmodel-example-application"><a class="anchor" href="#the-jsonpmodel-example-application"></a>The jsonpmodel Example Application</h3>
<div class="paragraph">
<p>This section describes how to build and run the <code>jsonpmodel</code> example application.
This example is a web application that demonstrates how to create an object model from form data, how to parse JSON data, and how write JSON data using the object model API.</p>
</div>
<div class="paragraph">
<p>The <code>jsonpmodel</code> example application is in the <code><em>tut-install</em>/examples/web/jsonp/jsonpmodel</code> directory.</p>
</div>
<div class="sect3">
<h4 id="components-of-the-jsonpmodel-example-application"><a class="anchor" href="#components-of-the-jsonpmodel-example-application"></a>Components of the jsonpmodel Example Application</h4>
<div class="paragraph">
<p>The <code>jsonpmodel</code> example application contains the following files.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Three Jakarta Faces pages.</p>
<div class="ulist">
<ul>
<li>
<p>The <code>index.xhtml</code> page contains a form to collect information.</p>
</li>
<li>
<p>The <code>modelcreated.xhtml</code> page contains a text area that displays JSON data.</p>
</li>
<li>
<p>The <code>parsejson.xhtml</code> page contains a table that shows the elements of the object model.</p>
</li>
</ul>
</div>
</li>
<li>
<p>The <code>ObjectModelBean.java</code> managed bean, which is a session-scoped managed bean that stores the data from the form and directs the navigation between the Facelets pages.
This file also contains code that uses the JSON object model API.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The code used in <code>ObjectModelBean.java</code> to create an object model from the data in the form is similar to the example in <a href="#creating-an-object-model-from-application-code">Creating an Object Model from Application Code</a>.
The code to write JSON output from the model is similar to the example in <a href="#writing-an-object-model-to-a-stream">Writing an Object Model to a Stream</a>.
The code to navigate the object model tree is similar to the example in <a href="#navigating-an-object-model">Navigating an Object Model</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="running-the-jsonpmodel-example-application"><a class="anchor" href="#running-the-jsonpmodel-example-application"></a>Running the jsonpmodel Example Application</h4>
<div class="paragraph">
<p>This section describes how to run the <code>jsonpmodel</code> example application using NetBeans IDE and from the command line.</p>
</div>
<div class="sect4">
<h5 id="to-run-the-jsonpmodel-example-application-using-netbeans-ide"><a class="anchor" href="#to-run-the-jsonpmodel-example-application-using-netbeans-ide"></a>To Run the jsonpmodel Example Application Using NetBeans IDE</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>From the <strong>File</strong> menu, choose <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the Open Project dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/web/jsonp</pre>
</div>
</div>
</li>
<li>
<p>Select the <code>jsonpmodel</code> folder.</p>
</li>
<li>
<p>Click <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the <strong>Projects</strong> tab, right-click the <code>jsonpmodel</code> project and select <strong>Run</strong>.</p>
<div class="paragraph">
<p>This command builds and packages the application into a WAR file (<code>jsonpmodel.war</code>) located in the <code>target</code> directory, deploys it to the server, and opens a web browser window with the following URL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080/jsonpmodel/</pre>
</div>
</div>
</li>
<li>
<p>Edit the data on the page and click Create a JSON Object to submit the form.
The following page shows a JSON object that contains the data from the form.</p>
</li>
<li>
<p>Click Parse JSON.
The following page contains a table that lists the nodes of the object model tree.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-run-the-jsonpmodel-example-application-using-maven"><a class="anchor" href="#to-run-the-jsonpmodel-example-application-using-maven"></a>To Run the jsonpmodel Example Application Using Maven</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>In a terminal window, go to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/web/jsonp/jsonpmodel</pre>
</div>
</div>
</li>
<li>
<p>Enter the following command to deploy the application:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">mvn install</code></pre>
</div>
</div>
</li>
<li>
<p>Open a web browser window and enter the following address:</p>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080/jsonpmodel/</pre>
</div>
</div>
</li>
<li>
<p>Edit the data on the page and click Create a JSON Object to submit the form.
The following page shows a JSON object that contains the data from the form.</p>
</li>
<li>
<p>Click Parse JSON.
The following page contains a table that lists the nodes of the object model tree.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="the-jsonpstreaming-example-application"><a class="anchor" href="#the-jsonpstreaming-example-application"></a>The jsonpstreaming Example Application</h3>
<div class="paragraph">
<p>This section describes how to build and run the <code>jsonpstreaming</code> example application.
This example is a web application that demonstrates how to create JSON data from form data, how to parse JSON data, and how to write JSON output using the streaming API.</p>
</div>
<div class="paragraph">
<p>The <code>jsonpstreaming</code> example application is in the <code><em>tut-install</em>/examples/web/jsonp/jsonpstreaming</code> directory.</p>
</div>
<div class="sect3">
<h4 id="components-of-the-jsonpstreaming-example-application"><a class="anchor" href="#components-of-the-jsonpstreaming-example-application"></a>Components of the jsonpstreaming Example Application</h4>
<div class="paragraph">
<p>The <code>jsonpstreaming</code> example application contains the following files.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Three Jakarta Faces pages.</p>
<div class="ulist">
<ul>
<li>
<p>The <code>index.xhtml</code> page contains a form to collect information.</p>
</li>
<li>
<p>The <code>filewritten.xhtml</code> page contains a text area that displays JSON data.</p>
</li>
<li>
<p>The <code>parsed.xhtml</code> page contains a table that lists the events from the parser.</p>
</li>
</ul>
</div>
</li>
<li>
<p>The <code>StreamingBean.java</code> managed bean, a session-scoped managed bean that stores the data from the form and directs the navigation between the Facelets pages.
This file also contains code that uses the JSON streaming API.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The code used in <code>StreamingBean.java</code> to write JSON data to a file is similar to the example in <a href="#writing-json-data-using-a-generator">Writing JSON Data Using a Generator</a>.
The code to parse JSON data from a file is similar to the example in <a href="#reading-json-data-using-a-parser">Reading JSON Data Using a Parser</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="running-the-jsonpstreaming-example-application"><a class="anchor" href="#running-the-jsonpstreaming-example-application"></a>Running the jsonpstreaming Example Application</h4>
<div class="paragraph">
<p>This section describes how to run the <code>jsonpstreaming</code> example application using NetBeans IDE and from the command line.</p>
</div>
<div class="sect4">
<h5 id="to-run-the-jsonpstreaming-example-application-using-netbeans-ide"><a class="anchor" href="#to-run-the-jsonpstreaming-example-application-using-netbeans-ide"></a>To Run the jsonpstreaming Example Application Using NetBeans IDE</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>From the <strong>File</strong> menu, choose <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the Open Project dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/web/jsonp</pre>
</div>
</div>
</li>
<li>
<p>Select the <code>jsonpstreaming</code> folder.</p>
</li>
<li>
<p>Click <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the <strong>Projects</strong> tab, right-click the <code>jsonpstreaming</code> project and select <strong>Run</strong>.</p>
<div class="paragraph">
<p>This command builds and packages the application into a WAR file (<code>jsonpstreaming.war</code>) located in the <code>target</code> directory, deploys it to the server, and opens a web browser window with the following URL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080/jsonpstreaming/</pre>
</div>
</div>
</li>
<li>
<p>Edit the data on the page and click Write a JSON Object to a File to submit the form and write a JSON object to a text file.
The following page shows the contents of the text file.</p>
</li>
<li>
<p>Click Parse JSON from File.
The following page contains a table that lists the parser events for the JSON data in the text file.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-run-the-jsonpstreaming-example-application-using-maven"><a class="anchor" href="#to-run-the-jsonpstreaming-example-application-using-maven"></a>To Run the jsonpstreaming Example Application Using Maven</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>In a terminal window, go to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/web/jsonp/jsonpstreaming/</pre>
</div>
</div>
</li>
<li>
<p>Enter the following command to deploy the application:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">mvn install</code></pre>
</div>
</div>
</li>
<li>
<p>Open a web browser window and enter the following URL:</p>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080/jsonpstreaming/</pre>
</div>
</div>
</li>
<li>
<p>Edit the data on the page and click Write a JSON Object to a File to submit the form and write a JSON object to a text file.
The following page shows the contents of the text file.</p>
</li>
<li>
<p>Click Parse JSON from File.
The following page contains a table that lists the parser events for the JSON data in the text file.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="further-information-about-the-jakarta-json-processing"><a class="anchor" href="#further-information-about-the-jakarta-json-processing"></a>Further Information about the Jakarta JSON Processing</h3>
<div class="paragraph">
<p>For more information on JSON processing in Jakarta EE, see the Jakarta JSON Processing specification:</p>
</div>
<div class="paragraph">
<p><a href="https://jakarta.ee/specifications/jsonp/2.0/" class="bare" target="_blank" rel="noopener">https://jakarta.ee/specifications/jsonp/2.0/</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="json-binding"><a class="anchor" href="#json-binding"></a>Chapter 21. JSON Binding</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter describes the Jakarta JSON Binding.
JSON is a data exchange format widely used in web services and other connected applications.
For a brief overview of JSON, see <a href="#introduction-to-json">Introduction to JSON</a>.</p>
</div>
<div class="paragraph">
<p>The <a href="https://jakarta.ee/specifications/jsonb/" target="_blank" rel="noopener">Jakarta JSON Binding</a> specification provides a standard binding layer (metadata and runtime) between Java classes and JSON documents.
One Jakarta JSON Binding reference implementation is Yasson, which is developed through Eclipse.org and is included as part of GlassFish Server.</p>
</div>
<div class="paragraph">
<p>You can learn more about Yasson at <a href="https://projects.eclipse.org/projects/ee4j.yasson" class="bare" target="_blank" rel="noopener">https://projects.eclipse.org/projects/ee4j.yasson</a>.</p>
</div>
<div class="sect2">
<h3 id="json-binding-in-the-jakarta-ee-platform"><a class="anchor" href="#json-binding-in-the-jakarta-ee-platform"></a>JSON Binding in the Jakarta EE Platform</h3>
<div class="paragraph">
<p>Jakarta EE includes support for the Jakarta JSON Binding spec, which provides an API that can serialize Java objects to JSON documents and deserialize JSON documents to Java objects.
Jakarta JSON Binding contains the following packages:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>jakarta.json.bind</code> package contains the binding interface, the builder interface, and a configuration class.
<a href="#main-classes-and-interfaces-in-bind">Table 21-1</a> lists the main classes and interfaces in this package.</p>
</li>
<li>
<p>The <code>jakarta.json.bind.adapter</code> package contains the <code>JsonbAdapter</code> interface, which provides methods for binding custom Java types by converting them to known types.</p>
</li>
<li>
<p>The <code>jakarta.json.bind.annotation</code> package defines annotations that can be used to customize default binding behavior.
Annotations can be used for field, JavaBean property, type, or package elements.</p>
</li>
<li>
<p>The <code>jakarta.json.bind.config</code> package interfaces and classes for customizing default binding behavior.
<a href="#main-classes-and-interfaces-in-config">Table 21-2</a> lists the main classes and interfaces in this package.</p>
</li>
<li>
<p>The <code>jakarta.json.bind.serializer</code> package contains interfaces that are used to create serialization and deserialization routines for custom types that cannot be easily mapped using the <code>JsonbAdapter</code> methods.
<a href="#main-classes-and-interfaces-in-serializer">Table 21-3</a> lists the main interfaces in this package.</p>
</li>
<li>
<p>The <code>jakarta.json.bind.spi</code> package contains a Service Provider Interface (SPI) for creating JSON Binding implementations.
This package contains the <code>JsonbProvider</code> class, which contains the methods that a service provider implements.</p>
</li>
</ul>
</div>
<table id="main-classes-and-interfaces-in-bind" class="tableblock frame-all grid-all" style="width: 99%;">
<caption class="title">Table 21-1 Main Classes and Interfaces in jakarta.json.bind</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Class or Interface</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Jsonb</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contains the JSON binding methods for serializing Java objects to JSON and deserailizing JSON to Java objects.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JsonBuilder</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used by clients to create <code>Jsonb</code> instances.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JsonbConfig</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used to set configuration properties on <code>Jsonb</code> instances.
Properties include binding strategies and properties for configuring custom serializers and deserializers.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JsonbException</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates that a problem occurred during JSON binding.</p></td>
</tr>
</tbody>
</table>
<table id="main-classes-and-interfaces-in-config" class="tableblock frame-all grid-all" style="width: 99%;">
<caption class="title">Table 21-2 Main Classes and Interfaces in jakarta.json.bind.config</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Class or Interface</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PropertyNamingStrategy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used to set how property names are translated.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PropertyVisibilityStrategy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used to set whether fields and methods should be considered properties overriding the default scope and field access behavior.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BinaryDataStrategy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used to set binary encoding.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PropertyOrderStrategy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used to set how properties are ordered during serialization.</p></td>
</tr>
</tbody>
</table>
<table id="main-classes-and-interfaces-in-serializer" class="tableblock frame-all grid-all" style="width: 99%;">
<caption class="title">Table 21-3 Main Classes and Interfaces in jakarta.json.bind.serializer</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Class or Interface</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JsonbDeserializer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used to create a deserialization routine for a custom type.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JsonbSerializer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used to create a serialization routine for a custom type.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="overview-of-the-json-binding-api"><a class="anchor" href="#overview-of-the-json-binding-api"></a>Overview of the JSON Binding API</h3>
<div class="paragraph">
<p>This section provides basic instructions for using the Jakarta JSON Binding client API.
The instructions provide a basis for understanding the <a href="#running-the-jsonbbasics-example-application">Running the jsonbbasics Example Application</a>.
Refer to the <a href="http://json-b.net/index.html" target="_blank" rel="noopener">Jakarta JSON Binding</a> project page for API documentation and a more detailed User Guide.</p>
</div>
<div class="sect3">
<h4 id="creating-a-jasonb-instance"><a class="anchor" href="#creating-a-jasonb-instance"></a>Creating a jasonb Instance</h4>
<div class="paragraph">
<p>A <code>jsonb</code> instance provides access to methods for binding objects to JSON.
A single <code>jsonb</code> instance is required for most applications.
A <code>jsonb</code> instance is created using the <code>JsonbBuilder</code> interface, which is a client&#8217;s entry point to the JSON Binding API.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Jsonb jsonb = JsonbBuilder.create();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="using-the-default-mapping"><a class="anchor" href="#using-the-default-mapping"></a>Using the Default Mapping</h4>
<div class="paragraph">
<p>Jakarta JSON Binding provides default mappings for serializing and deserializing basic Java and Java SE types as well Java date and time classes.
To use the default mappings and mapping behavior, create a josnb instance and use the <code>toJson</code> method to serialize to JSON and the <code>fromJson</code> method to deserialize back to an object.
The following example binds a simple <code>Person</code> object that contains a single <code>name</code> field.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Jsonb jsonb = JsonbBuilder.create();

Person person = <span class="keyword">new</span> Person();
person.name = <span class="string"><span class="delimiter">&quot;</span><span class="content">Fred</span><span class="delimiter">&quot;</span></span>;

Jsonb jsonb = JsonbBuilder.create();

<span class="comment">// serialize to JSON</span>
<span class="predefined-type">String</span> result = jsonb.toJson(person);

<span class="comment">// deserialize from JSON</span>
person = jsonb.fromJson(<span class="string"><span class="delimiter">&quot;</span><span class="content">{name:</span><span class="char">\&quot;</span><span class="content">joe</span><span class="char">\&quot;</span><span class="content">}</span><span class="delimiter">&quot;</span></span>, Person.class);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="using-customizations"><a class="anchor" href="#using-customizations"></a>Using Customizations</h4>
<div class="paragraph">
<p>Jakarta JSON Binding supports many ways to customize the default mapping behavior.
For runtime customizations, a <code>JsonbConfig</code> configuration object is used when creating the <code>jsonbinstance</code>.
The <code>JsonbConfig</code> class supports many configuration options and also includes advanced options for binding custom types.
For advanced options, see the <code>JsonbAdapter</code> interface and the <code>JsonbSerializer</code> and <code>JsonbDeserializer</code> interfaces.</p>
</div>
<div class="paragraph">
<p>The following example creates a configuration object that sets the <code>FORMATTING</code> property to specify whether or not the serialized JSON data is formatted with linefeeds and indentation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">JsonbConfig config = <span class="keyword">new</span> JsonbConfig()
    .withFormatting(<span class="predefined-constant">true</span>);

Jsonb jsonb = JsonbBuilder.create(config);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="using-annotations"><a class="anchor" href="#using-annotations"></a>Using Annotations</h4>
<div class="paragraph">
<p>Jakarta JSON Binding includes many annotations that can be used at compile time to customize the default mapping behavior.
The following example uses the <code>@JsonbProperty</code> annotation to change the <code>name</code> field to <code>person-name</code> when the object is serialized to JSON.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Person</span> {
    <span class="annotation">@JsonbProperty</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">person-name</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">private</span> <span class="predefined-type">String</span> name;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The resulting JSON document is written as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">person-name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Fred</span><span class="delimiter">&quot;</span></span>,
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="running-the-jsonbbasics-example-application"><a class="anchor" href="#running-the-jsonbbasics-example-application"></a>Running the jsonbbasics Example Application</h3>
<div class="paragraph">
<p>This section describes how to build and run the <code>jsonbbasics</code> example application.
This example is a web application that demonstrates how to serialize an object to JSON and how to deserialize JSON to an object.</p>
</div>
<div class="paragraph">
<p>The <code>jsonbbasics</code> example application is in the <code><em>tut-install</em>/examples/web/jsonb/jsonbbasics</code> directory.</p>
</div>
<div class="sect3">
<h4 id="components-of-the-jsonbbasics-example-application"><a class="anchor" href="#components-of-the-jsonbbasics-example-application"></a>Components of the jsonbbasics Example Application</h4>
<div class="paragraph">
<p>The <code>jsonbbasics</code> example application contains the following files.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Two Jakarta Faces pages.</p>
<div class="ulist">
<ul>
<li>
<p>The <code>index.xhtml</code> page contains a form to collect data that is used to create a <code>Person</code> object.</p>
</li>
<li>
<p>The <code>jsongenerated.xhtml</code> page contains a text area that displays the data in JSON format.</p>
</li>
</ul>
</div>
</li>
<li>
<p>The <code>JsonbBean.java</code> managed bean, which is a session-scoped managed bean that stores the data from the form and directs the navigation between the Facelets pages.
This file contains code that uses the JSON Binding API.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="running-the-jsonbbasics-example-application-2"><a class="anchor" href="#running-the-jsonbbasics-example-application-2"></a>Running the jsonbbasics Example Application</h4>
<div class="paragraph">
<p>This section describes how to run the <code>jsonbbasics</code> example application from the command line using Maven.</p>
</div>
<div class="paragraph">
<p>To run the jsonbbasics example application using Maven:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>In a terminal window, go to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/web/jsonb/jsonbbasics</pre>
</div>
</div>
</li>
<li>
<p>Enter the following command to deploy the application:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">mvn install</code></pre>
</div>
</div>
</li>
<li>
<p>Open a web browser window and enter the following address:</p>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080/jsonbbasics/</pre>
</div>
</div>
</li>
<li>
<p>Enter data on form and click Serialize to JSON to submit the form.
The following page shows the JSON format of the object data.</p>
</li>
<li>
<p>Click Deserialize JSON.
The index page displays and contains the fields populated from the object data.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="further-information-about-the-jakarta-json-binding"><a class="anchor" href="#further-information-about-the-jakarta-json-binding"></a>Further Information about the Jakarta JSON Binding</h3>
<div class="paragraph">
<p>For more information on Jakarta JSON Binding, see:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Jakarta JSON Binding spec:<br>
<a href="https://jakarta.ee/specifications/jsonb/" class="bare" target="_blank" rel="noopener">https://jakarta.ee/specifications/jsonb/</a></p>
</li>
<li>
<p>Specification project:<br>
<a href="https://github.com/eclipse-ee4j/jsonb-api" class="bare" target="_blank" rel="noopener">https://github.com/eclipse-ee4j/jsonb-api</a></p>
</li>
<li>
<p>Yasson (Implementation):<br>
<a href="https://projects.eclipse.org/projects/ee4j.yasson" class="bare" target="_blank" rel="noopener">https://projects.eclipse.org/projects/ee4j.yasson</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="internationalizing-and-localizing-web-applications"><a class="anchor" href="#internationalizing-and-localizing-web-applications"></a>Chapter 22. Internationalizing and Localizing Web Applications</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The process of preparing an application to support more than one language and data format is called internationalization.
Localization is the process of adapting an internationalized application to support a specific region or locale.
Examples of locale-dependent information include messages and user interface labels, character sets and encoding, and date and currency formats.
Although all client user interfaces should be internationalized and localized, it is particularly important for web applications because of the global nature of the web.</p>
</div>
<div class="sect2">
<h3 id="java-platform-localization-classes"><a class="anchor" href="#java-platform-localization-classes"></a>Java Platform Localization Classes</h3>
<div class="paragraph">
<p>In the Java platform, <code>java.util.Locale</code> (<a href="https://docs.oracle.com/javase/8/docs/api/java/util/Locale.html" class="bare" target="_blank" rel="noopener">https://docs.oracle.com/javase/8/docs/api/java/util/Locale.html</a>) represents a specific geographical, political, or cultural region.
The string representation of a locale consists of the international standard two-character abbreviation for language and country and an optional variant, all separated by underscore (<code>_</code>) characters.
Examples of locale strings include <code>fr</code> (French), <code>de_CH</code> (Swiss German), and <code>en_US_POSIX</code> (English on a POSIX-compliant platform).</p>
</div>
<div class="paragraph">
<p>Locale-sensitive data is stored in a <code>java.util.ResourceBundle</code> (<a href="https://docs.oracle.com/javase/8/docs/api/java/util/ResourceBundle.html" class="bare" target="_blank" rel="noopener">https://docs.oracle.com/javase/8/docs/api/java/util/ResourceBundle.html</a>).
A resource bundle contains key-value pairs, where the keys uniquely identify a locale-specific object in the bundle.
A resource bundle can be backed by a text file (properties resource bundle) or a class (list resource bundle) containing the pairs.
You construct a resource bundle instance by appending a locale string representation to a base name.</p>
</div>
<div class="paragraph">
<p>The Duke&#8217;s Bookstore application (see <a href="#dukes-bookstore-case-study-example">Chapter 61, <em>Duke&#8217;s Bookstore Case Study Example</em></a>) contains resource bundles with the base name <code>messages.properties</code> for the locales <code>de</code> (German), <code>es</code> (Spanish), and <code>fr</code> (French).
The default locale, <code>en</code> (English), which is specified in the <code>faces-config.xml</code> file, uses the resource bundle with the base name, <code>messages.properties</code>.</p>
</div>
<div class="paragraph">
<p>For more details on internationalization and localization in the Java platform, see <a href="https://docs.oracle.com/javase/tutorial/i18n/index.html" class="bare" target="_blank" rel="noopener">https://docs.oracle.com/javase/tutorial/i18n/index.html</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="providing-localized-messages-and-labels"><a class="anchor" href="#providing-localized-messages-and-labels"></a>Providing Localized Messages and Labels</h3>
<div class="paragraph">
<p>Messages and labels should be tailored according to the conventions of a user&#8217;s language and region.
There are two approaches to providing localized messages and labels in a web application.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Provide a version of the web page in each of the target locales and have a controller servlet dispatch the request to the appropriate page depending on the requested locale.
This approach is useful if large amounts of data on a page or an entire web application need to be internationalized.</p>
</li>
<li>
<p>Isolate any locale-sensitive data on a page into resource bundles, and access the data so that the corresponding translated message is fetched automatically and inserted into the page.
Thus, instead of creating strings directly in your code, you create a resource bundle that contains translations and read the translations from that bundle using the corresponding key.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Duke&#8217;s Bookstore application follows the second approach.
Here are a few lines from the default resource bundle <code>messages</code>.<code>properties</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>TitleShoppingCart=Shopping Cart
TitleReceipt=Receipt
TitleBookCatalog=Book Catalog
TitleCashier=Cashier
TitleBookDescription=Book Description
Visitor=You are visitor number
What=What We\'re Reading</pre>
</div>
</div>
<div class="sect3">
<h4 id="establishing-the-locale"><a class="anchor" href="#establishing-the-locale"></a>Establishing the Locale</h4>
<div class="paragraph">
<p>To get the correct strings for a given user, a web application either retrieves the locale (set by a browser language preference) from the request using the <code>getLocale</code> method, or allows the user to explicitly select the locale.</p>
</div>
<div class="paragraph">
<p>A component can explicitly set the locale by using the <code>fmt:setLocale</code> tag.</p>
</div>
<div class="paragraph">
<p>The <code>locale-config</code> element in the configuration file registers the default locale and also registers other supported locales.
This element in Duke&#8217;s Bookstore registers English as the default locale and indicates that German, French, and Spanish are supported locales.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;locale-config&gt;</span>
    <span class="tag">&lt;default-locale&gt;</span>en<span class="tag">&lt;/default-locale&gt;</span>
    <span class="tag">&lt;supported-locale&gt;</span>es<span class="tag">&lt;/supported-locale&gt;</span>
    <span class="tag">&lt;supported-locale&gt;</span>de<span class="tag">&lt;/supported-locale&gt;</span>
    <span class="tag">&lt;supported-locale&gt;</span>fr<span class="tag">&lt;/supported-locale&gt;</span>
<span class="tag">&lt;/locale-config&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>LocaleBean</code> in the Duke&#8217;s Bookstore application uses the <code>getLocale</code> method to retrieve the locale.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">LocaleBean</span> {

    ...
    private FacesContext ctx = FacesContext.getCurrentInstance();
    <span class="directive">private</span> <span class="predefined-type">Locale</span> locale = ctx.getViewRoot().getLocale();;

    ...
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="setting-the-resource-bundle"><a class="anchor" href="#setting-the-resource-bundle"></a>Setting the Resource Bundle</h4>
<div class="paragraph">
<p>The resource bundle is set with the <code>resource-bundle</code> element in the configuration file.
The setting for Duke&#8217;s Bookstore looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;resource-bundle&gt;</span>
    <span class="tag">&lt;base-name&gt;</span>
        ee.jakarta.tutorial.dukesbookstore.web.messages.Messages
    <span class="tag">&lt;/base-name&gt;</span>
    <span class="tag">&lt;var&gt;</span>bundle<span class="tag">&lt;/var&gt;</span>
<span class="tag">&lt;/resource-bundle&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>After the locale is set, the controller of a web application could retrieve the resource bundle for that locale and save it as a session attribute (see <a href="#associating-objects-with-a-session">Associating Objects with a Session</a>) for use by other components or simply be used to return a text string appropriate for the selected locale:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="predefined-type">String</span> toString(<span class="predefined-type">Locale</span> locale) {
    <span class="predefined-type">ResourceBundle</span> res =
        <span class="predefined-type">ResourceBundle</span>.getBundle(
            <span class="string"><span class="delimiter">&quot;</span><span class="content">ee.jakarta.tutorial.dukesbookstore.web.messages.Messages</span><span class="delimiter">&quot;</span></span>, locale);
    <span class="keyword">return</span> res.getString(name() + <span class="string"><span class="delimiter">&quot;</span><span class="content">.string</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, an application could use the <code>f:loadBundle</code> tag to set the resource bundle.
This tag loads the correct resource bundle according to the locale stored in <code>FacesContext</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;f:loadBundle</span> <span class="attribute-name">basename</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ee.jakarta.tutorial.dukesbookstore.web.messages.Messages</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">var</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bundle</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Resource bundles containing messages that are explicitly referenced from a Jakarta Faces tag attribute using a value expression must be registered using the <code>resource-bundle</code> element of the configuration file.</p>
</div>
<div class="paragraph">
<p>For more information on using this element, see <a href="#registering-application-messages">Registering Application Messages</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="retrieving-localized-messages"><a class="anchor" href="#retrieving-localized-messages"></a>Retrieving Localized Messages</h4>
<div class="paragraph">
<p>A web component written in the Java programming language retrieves the resource bundle from the session:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">ResourceBundle</span> messages = (<span class="predefined-type">ResourceBundle</span>)session.getAttribute(<span class="string"><span class="delimiter">&quot;</span><span class="content">messages</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then it looks up the string associated with the key <code>person.lastName</code> as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">messages.getString(<span class="string"><span class="delimiter">&quot;</span><span class="content">person.lastName</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can only use a <code>message</code> or <code>messages</code> tag to display messages that are queued onto a component as a result of a converter or validator being registered on the component.
The following example shows a <code>message</code> tag that displays the error message queued on the <code>userNo</code> input component if the validator registered on the component fails to validate the value the user enters into the component.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:inputText</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">userNo</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{UserNumberBean.userNumber}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;f:validateLongRange</span> <span class="attribute-name">minimum</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">maximum</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/h:inputText&gt;</span>
...
<span class="tag">&lt;h:message</span> <span class="attribute-name">style</span>=<span class="string"><span class="delimiter">&quot;</span><span class="key">color</span>: <span class="value">red</span>; <span class="key">text-decoration</span>: <span class="value">overline</span><span class="delimiter">&quot;</span></span>
           <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">errors1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">for</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">userNo</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information on using the <code>message</code> or <code>messages</code> tags, see <a href="#displaying-error-messages-with-the-hmessage-and-hmessages-tags">Displaying Error Messages with the h:message and h:messages Tags</a>.</p>
</div>
<div class="paragraph">
<p>Messages that are not queued on a component and are therefore not loaded automatically are referenced using a value expression.
You can reference a localized message from almost any Jakarta Faces tag attribute.</p>
</div>
<div class="paragraph">
<p>The value expression that references a message has the same notation whether you loaded the resource bundle with the <code>loadBundle</code> tag or registered it with the <code>resource-bundle</code> element in the configuration file.</p>
</div>
<div class="paragraph">
<p>The value expression notation is <code>var.message</code>, in which <code>var</code> matches the <code>var</code> attribute of the <code>loadBundle</code> tag or the <code>var</code> element defined in the <code>resource-bundle</code> element of the configuration file, and <code>message</code> matches the key of the message contained in the resource bundle, referred to by the <code>var</code> attribute.</p>
</div>
<div class="paragraph">
<p>Here is an example from <code>bookcashier.xhtml</code> in Duke&#8217;s Bookstore:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:outputLabel</span> <span class="attribute-name">for</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{bundle.Name}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that <code>bundle</code> matches the <code>var</code> element from the configuration file and that <code>Name</code> matches the key in the resource bundle.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="date-and-number-formatting"><a class="anchor" href="#date-and-number-formatting"></a>Date and Number Formatting</h3>
<div class="paragraph">
<p>Java programs use the <code>DateFormat.getDateInstance(int, locale)</code> method to parse and format dates in a locale-sensitive manner.
Java programs use the <code>NumberFormat.get<em>XXX</em>Instance(locale)</code> method, where <em>XXX</em> can be <code>Currency</code>, <code>Number</code>, or <code>Percent</code>, to parse and format numerical values in a locale-sensitive manner.</p>
</div>
<div class="paragraph">
<p>An application can use date/time and number converters to format dates and numbers in a locale-sensitive manner.
For example, a shipping date could be converted as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:outputText</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{cashier.shipDate}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;f:convertDateTime</span> <span class="attribute-name">dateStyle</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">full</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/h:outputText&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For information on Jakarta Faces converters, see <a href="#using-the-standard-converters">Using the Standard Converters</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="character-sets-and-encodings"><a class="anchor" href="#character-sets-and-encodings"></a>Character Sets and Encodings</h3>
<div class="paragraph">
<p>The following sections describe character sets and character encodings.</p>
</div>
<div class="sect3">
<h4 id="character-sets"><a class="anchor" href="#character-sets"></a>Character Sets</h4>
<div class="paragraph">
<p>A character set is a set of textual and graphic symbols, each of which is mapped to a set of nonnegative integers.</p>
</div>
<div class="paragraph">
<p>The first character set used in computing was US-ASCII.
It is limited in that it can represent only American English.
US-ASCII contains uppercase and lowercase Latin alphabets, numerals, punctuation, a set of control codes, and a few miscellaneous symbols.</p>
</div>
<div class="paragraph">
<p>Unicode defines a standardized, universal character set that can be extended to accommodate additions.
When the Java program source file encoding doesn&#8217;t support Unicode, you can represent Unicode characters as escape sequences by using the notation <code>\u</code><em>XXXX</em>, where <em>XXXX</em> is the character&#8217;s 16-bit representation in hexadecimal.
For example, the Spanish version of a message file could use Unicode for non-ASCII characters, as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>admin.nav.main=P\u00e1gina principal de administraci\u00f3n</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="character-encoding"><a class="anchor" href="#character-encoding"></a>Character Encoding</h4>
<div class="paragraph">
<p>A character encoding maps a character set to units of a specific width and defines byte serialization and ordering rules.
Many character sets have more than one encoding.
For example, Java programs can represent Japanese character sets using the <code>EUC-JP</code> or <code>Shift-JIS</code> encodings, among others.
Each encoding has rules for representing and serializing a character set.</p>
</div>
<div class="paragraph">
<p>The ISO 8859 series defines 13 character encodings that can represent texts in dozens of languages.
Each ISO 8859 character encoding can have up to 256 characters.
ISO-8859-1 (Latin-1) comprises the ASCII character set, characters with diacritics (accents, diaereses, cedillas, circumflexes, and so on), and additional symbols.</p>
</div>
<div class="paragraph">
<p>UTF-8 (Unicode Transformation Format, 8-bit form) is a variable-width character encoding that encodes 16-bit Unicode characters as one to four bytes.
A byte in UTF-8 is equivalent to 7-bit ASCII if its high-order bit is zero; otherwise, the character comprises a variable number of bytes.</p>
</div>
<div class="paragraph">
<p>UTF-8 is compatible with the majority of existing web content and provides access to the Unicode character set.
Current versions of browsers and email clients support UTF-8.
In addition, many web standards specify UTF-8 as their character encoding.
For example, UTF-8 is one of the two required encodings for XML documents (the other is UTF-16).</p>
</div>
<div class="paragraph">
<p>Web components usually use <code>PrintWriter</code> to produce responses; <code>PrintWriter</code> automatically encodes using ISO-8859-1.
Servlets can also output binary data using <code>OutputStream</code> classes, which perform no encoding.
An application that uses a character set that cannot use the default encoding must explicitly set a different encoding.</p>
</div>
</div>
</div>
</div>
</div>
<h1 id="bean-validation" class="sect0"><a class="anchor" href="#bean-validation"></a>Part IV: Bean Validation</h1>
<div class="openblock partintro">
<div class="content">
Part IV explores Jakarta Bean Validation.
</div>
</div>
<div class="sect1">
<h2 id="introduction-to-jakarta-bean-validation"><a class="anchor" href="#introduction-to-jakarta-bean-validation"></a>Chapter 23. Introduction to Jakarta Bean Validation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter describes Jakarta Bean Validation available as part of the Jakarta EE platform and the facility for validating objects, object members, methods, and constructors.</p>
</div>
<div class="sect2">
<h3 id="overview-of-jakarta-bean-validation"><a class="anchor" href="#overview-of-jakarta-bean-validation"></a>Overview of Jakarta Bean Validation</h3>
<div class="paragraph">
<p>Validating input received from the user to maintain data integrity is an important part of application logic.
Validation of data can take place at different layers in even the simplest of applications, as shown in <a href="#developing-a-simple-facelets-application-the-guessnumber-jsf-example-application">Developing a Simple Facelets Application: The guessnumber-jsf Example Application</a>.
The <code>guessnumber-jsf</code> example application validates the user input (in the <code>h:inputText</code> tag) for numerical data at the presentation layer and for a valid range of numbers at the business layer.</p>
</div>
<div class="paragraph">
<p>Jakarta Bean Validation provides a facility for validating objects, object members, methods, and constructors.
In Jakarta EE environments, Jakarta Bean Validation integrates with Jakarta EE containers and services to allow developers to easily define and enforce validation constraints.
Jakarta Bean Validation is available as part of the Jakarta EE platform.</p>
</div>
</div>
<div class="sect2">
<h3 id="using-jakarta-bean-validation-constraints"><a class="anchor" href="#using-jakarta-bean-validation-constraints"></a>Using Jakarta Bean Validation Constraints</h3>
<div class="paragraph">
<p>The Jakarta Bean Validation model is supported by constraints in the form of annotations placed on a field, method, or class of a JavaBeans component, such as a managed bean.</p>
</div>
<div class="paragraph">
<p>Constraints can be built in or user defined.
User-defined constraints are called custom constraints.
Several built-in constraints are available in the <code>jakarta.validation.constraints</code> package.
<a href="#built-in-jakarta-bean-validation-constraints">Table 23-1</a> lists all the built-in constraints.
See <a href="#creating-custom-constraints">Creating Custom Constraints</a> for information on creating custom constraints.</p>
</div>
<table id="built-in-jakarta-bean-validation-constraints" class="tableblock frame-all grid-all" style="width: 99%;">
<caption class="title">Table 23-1 Built-In Jakarta Bean Validation Constraints</caption>
<colgroup>
<col style="width: 22.2222%;">
<col style="width: 59.5959%;">
<col style="width: 18.1819%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Constraint</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@AssertFalse</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The value of the field or property must be <code>false</code>.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@AssertFalse</span>
<span class="type">boolean</span> isUnsupported;</code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@AssertTrue</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The value of the field or property must be <code>true</code>.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@AssertTrue</span>
<span class="type">boolean</span> isActive;</code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@DecimalMax</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The value of the field or property must be a decimal value lower than or equal to the number in the value element.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DecimalMax</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">30.00</span><span class="delimiter">&quot;</span></span>)
<span class="predefined-type">BigDecimal</span> discount;</code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@DecimalMin</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The value of the field or property must be a decimal value greater than or equal to the number in the value element.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DecimalMin</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">5.00</span><span class="delimiter">&quot;</span></span>)
<span class="predefined-type">BigDecimal</span> discount;</code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Digits</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The value of the field or property must be a number within a specified range.
The <code>integer</code> element specifies the maximum integral digits for the number, and the <code>fraction</code> element specifies the maximum fractional digits for the number.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Digits</span>(integer=<span class="integer">6</span>, fraction=<span class="integer">2</span>)
<span class="predefined-type">BigDecimal</span> price;</code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Email</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The value of the field or property must be a valid email address.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Email</span>
<span class="predefined-type">String</span> emailaddress;</code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Future</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The value of the field or property must be a date in the future.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Future</span>
<span class="predefined-type">Date</span> eventDate;</code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@FutureOrPresent</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TThe value of the field or property must be a date or time in present or future.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@FutureOrPresent</span>
<span class="predefined-type">Time</span> travelTime;</code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Max</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The value of the field or property must be an integer value lower than or equal to the number in the value element.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Max</span>(<span class="integer">10</span>)
<span class="type">int</span> quantity;</code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Min</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The value of the field or property must be an integer value greater than or equal to the number in the value element.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Min</span>(<span class="integer">5</span>)
<span class="type">int</span> quantity;</code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Negative</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The value of the field or property must be a negative number.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Negative</span>
<span class="type">int</span> basementFloor;</code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@NegativeOrZero</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The value of the field or property must be negative or zero.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@NegativeOrZero</span>
<span class="type">int</span> debtValue;</code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@NotBlank</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The value of the field or property must contain atleast one non-white space character.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@NotBlank</span>
<span class="predefined-type">String</span> message;</code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@NotEmpty</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The value of the field or property must not be empty. The length of the characters or array, and the size of a collection or map are evaluated.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@NotEmpty</span>
<span class="predefined-type">String</span> message;;</code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@NotNull</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The value of the field or property must not be null.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@NotNull</span>
<span class="predefined-type">String</span> username;</code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Null</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The value of the field or property must be null.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Null</span>
<span class="predefined-type">String</span> unusedString;</code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Past</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The value of the field or property must be a date in the past.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Past</span>
<span class="predefined-type">Date</span> birthday;</code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@PastOrPresent</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The value of the field or property must be a date or time in the past or present.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@PastOrPresent</span>
<span class="predefined-type">Date</span> travelDate;</code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Pattern</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The value of the field or property must match the regular expression defined in the <code>regexp</code> element.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Pattern</span>(regexp=<span class="string"><span class="delimiter">&quot;</span><span class="char">\\</span><span class="content">(</span><span class="char">\\</span><span class="content">d{3}</span><span class="char">\\</span><span class="content">)</span><span class="char">\\</span><span class="content">d{3}-</span><span class="char">\\</span><span class="content">d{4}</span><span class="delimiter">&quot;</span></span>)
<span class="predefined-type">String</span> phoneNumber;</code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Positive</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The value of the field or property must be a positive number.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Positive</span>
<span class="predefined-type">BigDecimal</span> area;</code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@PositiveOrZero</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The value of the field or property must be a positive number or zero.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@PositiveOrZero</span>
<span class="type">int</span> totalGoals;</code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Size</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The size of the field or property is evaluated and must match the specified boundaries.
If the field or property is a <code>String</code>, the size of the string is evaluated.
If the field or property is a <code>Collection</code>, the size of the <code>Collection</code> is evaluated.
If the field or property is a <code>Map</code>, the size of the <code>Map</code> is evaluated.
If the field or property is an array, the size of the array is evaluated.
Use one of the optional <code>max</code> or <code>min</code> elements to specify the boundaries.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Size</span>(min=<span class="integer">2</span>, max=<span class="integer">240</span>)
<span class="predefined-type">String</span> briefMessage;</code></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In the following example, a constraint is placed on a field using the built-in <code>@NotNull</code> constraint:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Name</span> {
    <span class="annotation">@NotNull</span>
    <span class="directive">private</span> <span class="predefined-type">String</span> firstname;

    <span class="annotation">@NotNull</span>
    <span class="directive">private</span> <span class="predefined-type">String</span> lastname;
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also place more than one constraint on a single JavaBeans component object.
For example, you can place an additional constraint for size of field on the <code>firstname</code> and the <code>lastname</code> fields:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Name</span> {
    <span class="annotation">@NotNull</span>
    <span class="annotation">@Size</span>(min=<span class="integer">1</span>, max=<span class="integer">16</span>)
    <span class="directive">private</span> <span class="predefined-type">String</span> firstname;

    <span class="annotation">@NotNull</span>
    <span class="annotation">@Size</span>(min=<span class="integer">1</span>, max=<span class="integer">16</span>)
    <span class="directive">private</span> <span class="predefined-type">String</span> lastname;
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example shows a method with a user-defined constraint that checks user-defined constraint that checks for a predefined phone number pattern, such as a country specific phone number:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@USPhoneNumber</span>
<span class="directive">public</span> <span class="predefined-type">String</span> getPhone() {
    <span class="keyword">return</span> phone;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For a built-in constraint, a default implementation is available.
A user-defined or custom constraint needs a validation implementation.
In the preceding example, the <code>@USPhoneNumber</code> custom constraint needs an implementation class.</p>
</div>
</div>
<div class="sect2">
<h3 id="repeating-annotations"><a class="anchor" href="#repeating-annotations"></a>Repeating Annotations</h3>
<div class="paragraph">
<p>From Bean Validation 2.0 onwards, you can specify the same constraint several times on a validation target using repeating annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Account</span> {

    <span class="annotation">@Max</span> (value = <span class="integer">2000</span>, groups = Default.class, message = <span class="string"><span class="delimiter">&quot;</span><span class="content">max.value</span><span class="delimiter">&quot;</span></span>)
    <span class="annotation">@Max</span> (value = <span class="integer">5000</span>, groups = GoldCustomer.class, message = <span class="string"><span class="delimiter">&quot;</span><span class="content">max.value</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">private</span> <span class="type">long</span> withdrawalAmount;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>All in-built constraints from <code>jakarta.validation.constraints</code> package support repeatable annotations.
Similarly, custom constraints can use <code>@Repeatable</code> annotation.
In the following sample, depending on whether the group is <code>PeakHour</code> or <code>NonPeakHour</code>, the car instance is validated as either two passengers or three passengers based car, and then listed as eligible in the car pool lane:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">/**
 * Validate whether a car is eligible for car pool lane
 */</span>
<span class="annotation">@Documented</span>
<span class="annotation">@Constraint</span>(validatedBy = CarPoolValidator.class)
<span class="annotation">@Target</span>({ METHOD, FIELD, ANNOTATION_TYPE, CONSTRUCTOR, PARAMETER, TYPE_USE })
<span class="annotation">@Retention</span>(RUNTIME)
<span class="annotation">@Repeatable</span>(<span class="predefined-type">List</span>.class)
<span class="directive">public</span> <span class="annotation">@interface</span> CarPool {

    <span class="predefined-type">String</span> message() <span class="keyword">default</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">{CarPool.message}</span><span class="delimiter">&quot;</span></span>;

    <span class="predefined-type">Class</span>&lt;?&gt;<span class="type">[]</span> groups() <span class="keyword">default</span> {};

    <span class="type">int</span> value();

    <span class="predefined-type">Class</span>&lt;? <span class="directive">extends</span> Payload&gt;<span class="type">[]</span> payload() <span class="keyword">default</span> {};

    <span class="comment">/**
     * Defines several @CarPool annotations on the same element
     * @see (@link CarPool}
     */</span>
    <span class="annotation">@Target</span>({ METHOD, FIELD, ANNOTATION_TYPE, CONSTRUCTOR, PARAMETER, TYPE_USE })
    <span class="annotation">@Retention</span>(RUNTIME)
    <span class="annotation">@Documented</span>
    <span class="annotation">@interface</span> <span class="predefined-type">List</span> {
        CarPool<span class="type">[]</span> value();
    }
}
<span class="directive">public</span> <span class="type">class</span> <span class="class">Car</span>{

  <span class="directive">private</span> <span class="predefined-type">String</span> registrationNumber;

  <span class="annotation">@CarPool</span>(value = <span class="integer">2</span>, group = NonPeakHour.class)
  <span class="annotation">@CarPool</span>(value = <span class="integer">3</span>, group = {Default.class, PeakHour.class})
  <span class="directive">private</span> <span class="type">int</span> totalPassengers;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Any validation failures are gracefully handled and can be displayed by the <code>h:messages</code> tag.</p>
</div>
<div class="paragraph">
<p>Any managed bean that contains Bean Validation annotations automatically gets validation constraints placed on the fields on a Jakarta Faces application&#8217;s web pages.</p>
</div>
<div class="paragraph">
<p>For more information on using validation constraints, see the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#bean-validation-advanced-topics">Chapter 24, <em>Bean Validation: Advanced Topics</em></a></p>
</li>
<li>
<p><a href="#validating-resource-data-with-bean-validation">Validating Resource Data with Bean Validation</a></p>
</li>
<li>
<p><a href="#validating-persistent-fields-and-properties">Validating Persistent Fields and Properties</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="validating-null-and-empty-strings"><a class="anchor" href="#validating-null-and-empty-strings"></a>Validating Null and Empty Strings</h3>
<div class="paragraph">
<p>The Java programming language distinguishes between null and empty strings.
An empty string is a string instance of zero length, whereas a null string has no value at all.</p>
</div>
<div class="paragraph">
<p>An empty string is represented as <code>""</code>.
It is a character sequence of zero characters.
A null string is represented by <code>null</code>.
It can be described as the absence of a string instance.</p>
</div>
<div class="paragraph">
<p>Managed bean elements represented as a Jakarta Faces text component such as <code>inputText</code> are initialized with the value of the empty string by the Jakarta Faces implementation.
Validating these strings can be an issue when user input for such fields is not required.
Consider the following example, in which the string <code>testString</code> is a bean variable that will be set using input entered by the user.
In this case, the user input for the field is not required.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">if</span> (testString==<span class="predefined-constant">null</span>) {
    doSomething();
} <span class="keyword">else</span> {
    doAnotherThing();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, the <code>doAnotherThing</code> method is called even when the user enters no data, because the <code>testString</code> element has been initialized with the value of an empty string.</p>
</div>
<div class="paragraph">
<p>In order for the Bean Validation model to work as intended, you must set the context parameter <code>jakarta.faces.INTERPRET_EMPTY_STRING_SUBMITTED_VALUES_AS_NULL</code> to <code>true</code> in the web deployment descriptor file, <code>web.xml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;context-param&gt;</span>
    <span class="tag">&lt;param-name&gt;</span>jakarta.faces.INTERPRET_EMPTY_STRING_SUBMITTED_VALUES_AS_NULL<span class="tag">&lt;/param-name&gt;</span>
    <span class="tag">&lt;param-value&gt;</span>true<span class="tag">&lt;/param-value&gt;</span>
<span class="tag">&lt;/context-param&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This parameter enables the Jakarta Faces implementation to treat empty strings as null.</p>
</div>
<div class="paragraph">
<p>Suppose, on the other hand, that you have a <code>@NotNull</code> constraint on an element, meaning that input is required.
In this case, an empty string will pass this validation constraint.
However, if you set the context parameter <code>jakarta.faces.INTERPRET_EMPTY_STRING_SUBMITTED_VALUES_AS_NULL</code> to <code>true</code>, the value of the managed bean attribute is passed to the Jakarta Bean Validation runtime as a null value, causing the <code>@NotNull</code> constraint to fail.</p>
</div>
</div>
<div class="sect2">
<h3 id="validating-constructors-and-methods"><a class="anchor" href="#validating-constructors-and-methods"></a>Validating Constructors and Methods</h3>
<div class="paragraph">
<p>Jakarta Bean Validation constraints may be placed on the parameters of nonstatic methods and constructors and on the return values of nonstatic methods.
Static methods and constructors will not be validated.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Employee</span> {
...
  public Employee (<span class="annotation">@NotNull</span> <span class="predefined-type">String</span> name) { ... }

  <span class="directive">public</span> <span class="type">void</span> setSalary(
      <span class="annotation">@NotNull</span>
      <span class="annotation">@Digits</span>(integer=<span class="integer">6</span>, fraction=<span class="integer">2</span>) <span class="predefined-type">BigDecimal</span> salary,
      <span class="annotation">@NotNull</span>
      <span class="annotation">@ValidCurrency</span>
      <span class="predefined-type">String</span> currencyType) {
    ...
  }
...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the <code>Employee</code> class has a constructor constraint requiring a name and has two sets of method parameter constraints.
The amount of the salary for the employee must not be null, cannot be greater than six digits to the left of the decimal point, and cannot have more than two digits to the right of the decimal place.
The currency type must not be null and is validated using a custom constraint.</p>
</div>
<div class="paragraph">
<p>If you add method constraints to classes in an object hierarchy, special care must be taken to avoid unintended behavior by subtypes.
See <a href="#using-method-constraints-in-type-hierarchies">Using Method Constraints in Type Hierarchies</a> for more information.</p>
</div>
<div class="sect3">
<h4 id="cross-parameter-constraints"><a class="anchor" href="#cross-parameter-constraints"></a>Cross-Parameter Constraints</h4>
<div class="paragraph">
<p>Constraints that apply to multiple parameters are called cross-parameter constraints, and may be applied at the method or constructor level.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ConsistentPhoneParameters</span>
<span class="annotation">@NotNull</span>
<span class="directive">public</span> Employee (<span class="predefined-type">String</span> name, <span class="predefined-type">String</span> officePhone, <span class="predefined-type">String</span> mobilePhone) {
  ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, a custom cross-parameter constraint, <code>@ConsistentPhoneParameters</code>, validates that the format of the phone numbers passed into the constructor match.
The <code>@NotNull</code> constraint applies to all the parameters in the constructor.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Cross-parameter constraint annotations are applied directly to the method or constructor.
Return value constraints are also applied directly to the method or constructor.
To avoid confusion as to where the constraint applies, parameter or return value, choose a name for any custom constraints that identifies where the constraint applies.
For instance, the preceding example applies a custom constraint, <code>@ConsistentPhoneParameters</code>, that indicates that it applies to the parameters of the method or constructor.</p>
</div>
<div class="paragraph">
<p>When you create a custom constraint that applies to both method parameters and return values, the <code>validationAppliesTo</code> element of the constraint annotation may be set to <code>ConstraintTarget.RETURN_VALUE</code> or <code>ConstraintTarget.PARAMETERS</code> to explicitly set the target of the validation constraint.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="validating-type-arguments-of-parameterized-types"><a class="anchor" href="#validating-type-arguments-of-parameterized-types"></a>Validating Type Arguments of Parameterized Types</h4>
<div class="paragraph">
<p>From Bean Validation 2.0 onwards, you can apply constraints to the type arguments of parameterized types.
For example: <code>List&lt;@NotNull Long&gt; numbers;</code> Constraints can be applied to elements of container types such as <code>List</code>, <code>Map</code>, <code>Optional</code>, and others.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">List</span>&lt;<span class="annotation">@Email</span> <span class="predefined-type">String</span>&gt; emails;
<span class="directive">public</span> <span class="predefined-type">Map</span>&lt;<span class="annotation">@NotNull</span> <span class="predefined-type">String</span>, <span class="annotation">@USPhoneNumber</span> <span class="predefined-type">String</span>&gt; getAddressesByType() { }</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this sample, <code>@Email</code> is an in-built constraint supported by Bean Validation, and <code>@USPhoneNumber</code> is a user-defined constraint.
See <a href="#using-the-built-in-constraints-to-make-a-new-constraint">Using the Built-In Constraints to Make a New Constraint</a>.</p>
</div>
<div class="paragraph">
<p><code>@USPhoneNumber</code> has <code>ElementType.TYPE_USE</code> as one of its <code>@Target</code>, and therefore it is possible to use <code>@USPhoneNumber</code> constraint for validating type arguments of parameterized types.</p>
</div>
</div>
<div class="sect3">
<h4 id="identifying-parameter-constraint-violations"><a class="anchor" href="#identifying-parameter-constraint-violations"></a>Identifying Parameter Constraint Violations</h4>
<div class="paragraph">
<p>If a <code>ConstraintViolationException</code> occurs during a method call, the Bean Validation runtime returns a parameter index to identify which parameter caused the constraint violation.
The parameter index is in the form <code>arg<em>PARAMETER_INDEX</em></code>, where <em>PARAMETER_INDEX</em> is an integer that starts at 0 for the first parameter of the method or constructor.</p>
</div>
</div>
<div class="sect3">
<h4 id="adding-constraints-to-method-return-values"><a class="anchor" href="#adding-constraints-to-method-return-values"></a>Adding Constraints to Method Return Values</h4>
<div class="paragraph">
<p>To validate the return value for a method, you can apply constraints directly to the method or constructor declaration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@NotNull</span>
<span class="directive">public</span> Employee getEmployee() { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Cross-parameter constraints are also applied at the method level.
Custom constraints that could be applied to both the return value and the method parameters have an ambiguous constraint target.
To avoid this ambiguity, add a <code>validationAppliesTo</code> element to the constraint annotation definition with the default set to either <code>ConstraintTarget.RETURN_VALUE</code> or <code>ConstraintTarget.PARAMETERS</code> to explicitly set the target of the validation constraint.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Manager</span>(validationAppliesTo=ConstraintTarget.RETURN_VALUE)
<span class="directive">public</span> Employee getManager(Employee employee) { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>See <a href="#removing-ambiguity-in-constraint-targets">Removing Ambiguity in Constraint Targets</a> for more information.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="further-information-about-jakarta-bean-validation"><a class="anchor" href="#further-information-about-jakarta-bean-validation"></a>Further Information about Jakarta Bean Validation</h3>
<div class="paragraph">
<p>For more information on Jakarta Bean Validation, see</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Jakarta Bean Validation 3.0 Specification:<br>
<a href="https://jakarta.ee/specifications/bean-validation/3.0/" class="bare" target="_blank" rel="noopener">https://jakarta.ee/specifications/bean-validation/3.0/</a></p>
</li>
<li>
<p>Bean Validation Specification website:<br>
<a href="https://beanvalidation.org/" class="bare" target="_blank" rel="noopener">https://beanvalidation.org/</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="bean-validation-advanced-topics"><a class="anchor" href="#bean-validation-advanced-topics"></a>Chapter 24. Bean Validation: Advanced Topics</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter describes how to create custom constraints, custom validator messages, and constraint groups using the Jakarta Bean Validation (Bean Validation).</p>
</div>
<div class="sect2">
<h3 id="creating-custom-constraints"><a class="anchor" href="#creating-custom-constraints"></a>Creating Custom Constraints</h3>
<div class="paragraph">
<p>Jakarta Bean Validation defines annotations, interfaces, and classes to allow developers to create custom constraints.</p>
</div>
<div class="sect3">
<h4 id="using-the-built-in-constraints-to-make-a-new-constraint"><a class="anchor" href="#using-the-built-in-constraints-to-make-a-new-constraint"></a>Using the Built-In Constraints to Make a New Constraint</h4>
<div class="paragraph">
<p>Jakarta Bean Validation includes several built-in constraints that can be combined to create new, reusable constraints.
This can simplify constraint definition by allowing developers to define a custom constraint made up of several built-in constraints that may then be applied to component attributes with a single annotation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Pattern</span>.List({
  <span class="comment">/* A number of format +1-NNN-NNN-NNNN */</span>
  <span class="annotation">@Pattern</span>(regexp = <span class="error"></span><span class="error">\</span><span class="error">\</span>+<span class="integer">1</span>-<span class="error">\</span><span class="error">\</span>d{<span class="integer">3</span>}-<span class="error">\</span><span class="error">\</span>d{<span class="integer">3</span>}-<span class="error">\</span><span class="error">\</span>d{<span class="integer">4</span>})
})
<span class="annotation">@Constraint</span>(validatedBy = {})
<span class="annotation">@Documented</span>
<span class="annotation">@Target</span>({<span class="predefined-type">ElementType</span>.METHOD,
    <span class="predefined-type">ElementType</span>.FIELD,
    <span class="predefined-type">ElementType</span>.ANNOTATION_TYPE,
    <span class="predefined-type">ElementType</span>.CONSTRUCTOR,
    <span class="predefined-type">ElementType</span>.PARAMETER
    <span class="predefined-type">ElementType</span>.Type_Use})
<span class="annotation">@Retention</span>(<span class="predefined-type">RetentionPolicy</span>.RUNTIME)
<span class="annotation">@Repeatable</span>(<span class="predefined-type">List</span>.class)
<span class="directive">public</span> <span class="annotation">@interface</span> USPhoneNumber {

  <span class="predefined-type">String</span> message() <span class="keyword">default</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Not a valid US Phone Number</span><span class="delimiter">&quot;</span></span>;

  <span class="predefined-type">Class</span>&lt;?&gt;<span class="type">[]</span> groups() <span class="keyword">default</span> {};

  <span class="predefined-type">Class</span>&lt;? <span class="directive">extends</span> Payload&gt;<span class="type">[]</span> payload() <span class="keyword">default</span> {};

  <span class="annotation">@Target</span>({<span class="predefined-type">ElementType</span>.METHOD,
     <span class="predefined-type">ElementType</span>.FIELD,
     <span class="predefined-type">ElementType</span>.ANNOTATION_TYPE,
     <span class="predefined-type">ElementType</span>.CONSTRUCTOR,
     <span class="predefined-type">ElementType</span>.PARAMETER
     <span class="predefined-type">ElementType</span>.Type_Use })
  <span class="annotation">@Retention</span>(<span class="predefined-type">RetentionPolicy</span>.RUNTIME)
  <span class="annotation">@Documented</span>
  <span class="annotation">@interface</span> <span class="predefined-type">List</span> {
  USPhoneNumber<span class="type">[]</span> value();

  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also implement a <code>Constraint Validator</code> to validate the constraint <code>@USPhoneNumber</code>.
For more information about using <code>Constraint Validator</code>, see <code>jakarta.validation.ConstraintValidator</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@USPhoneNumber</span>
<span class="directive">protected</span> <span class="predefined-type">String</span> phone;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="removing-ambiguity-in-constraint-targets"><a class="anchor" href="#removing-ambiguity-in-constraint-targets"></a>Removing Ambiguity in Constraint Targets</h4>
<div class="paragraph">
<p>Custom constraints that can be applied to both return values and method parameters require a <code>validationAppliesTo</code> element to identify the target of the constraint.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Constraint</span>(validatedBy=MyConstraintValidator.class)
<span class="annotation">@Target</span>({ METHOD, FIELD, TYPE, ANNOTATION_TYPE, CONSTRUCTOR, PARAMETER })
<span class="annotation">@Retention</span>(RUNTIME)
<span class="directive">public</span> <span class="annotation">@interface</span> MyConstraint {
  <span class="predefined-type">String</span> message() <span class="keyword">default</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">{com.example.constraint.MyConstraint.message}</span><span class="delimiter">&quot;</span></span>;
  <span class="predefined-type">Class</span>&lt;?&gt;<span class="type">[]</span> groups() <span class="keyword">default</span> {};
  ConstraintTarget validationAppliesTo() <span class="keyword">default</span> ConstraintTarget.PARAMETERS;
...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This constraint sets the <code>validationAppliesTo</code> target by default to the method parameters.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@MyConstraint</span>(validationAppliesTo=ConstraintTarget.RETURN_TYPE)
<span class="directive">public</span> <span class="predefined-type">String</span> doSomething(<span class="predefined-type">String</span> param1, <span class="predefined-type">String</span> param2) { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the preceding example, the target is set to the return value of the method.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="implementing-temporal-constraints-using-clockprovider"><a class="anchor" href="#implementing-temporal-constraints-using-clockprovider"></a>Implementing Temporal Constraints Using ClockProvider</h3>
<div class="paragraph">
<p>From Bean Validation 2.0 onwards, a <code>Clock</code> instance is available for validator implementations to validate any temporal date or time based constraints.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ValidatorFactory validatorFactory = Validation.buildDefaultValidatorFactory();
ClockProvider clockProvider = validatorFactory.getClockProvider();
java.time.Clock Clock = clockProvider.getClock();</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also register a custom <code>ClockProvider</code> with a <code>ValidatorFactory</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">//Register a custom clock provider implementation with validator factory</span>
ValidatorFactory factory = Validation
       .byDefaultProvider().configure()
          .clockProvider( <span class="keyword">new</span> CustomClockProvider() )
          .buildValidatorFactory();

<span class="comment">//Retrieve and use the custom Clock Provider and Clock in the Validator implementation</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">CustomConstraintValidator</span> <span class="directive">implements</span> ConstraintValidator&lt;CustomConstraint, <span class="predefined-type">Object</span>&gt; {

    <span class="directive">public</span> <span class="type">boolean</span> isValid(<span class="predefined-type">Object</span> value, ConstraintValidatorContext context){
        java.time.Clock clock = context.getClockProvider().getClock();
        ...
        ...

    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>See ClockProvider in <a href="https://jakarta.ee/specifications/platform/9/apidocs/" class="bare" target="_blank" rel="noopener">https://jakarta.ee/specifications/platform/9/apidocs/</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="custom-constraints"><a class="anchor" href="#custom-constraints"></a>Custom Constraints</h3>
<div class="paragraph">
<p>Consider an employee in a firm located in U.S.A.
When you register the phone number of an employee or modify the phone number, the phone number needs to be validated to ensure that the phone number conforms to US phone number pattern.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Employee</span> <span class="directive">extends</span> Person {

  <span class="annotation">@USPhoneNumber</span>
  <span class="directive">protected</span> <span class="predefined-type">String</span> phone;

  <span class="directive">public</span> Employee(<span class="predefined-type">String</span> name, <span class="predefined-type">String</span> phone, <span class="type">int</span> age){
    <span class="local-variable">super</span>(name, age);
    <span class="local-variable">this</span>.phone = phone;
  }

  <span class="directive">public</span> <span class="predefined-type">String</span> getPhone() {
    <span class="keyword">return</span> phone;
  }

  <span class="directive">public</span> <span class="type">void</span> setPhone(<span class="predefined-type">String</span> phone) {
    <span class="local-variable">this</span>.phone = phone;
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The constraint definition <code>@USPhoneNumber</code> is define in the sample listed under <a href="#using-the-built-in-constraints-to-make-a-new-constraint">Using the Built-In Constraints to Make a New Constraint</a>.
In the sample, another constraint <code>@Pattern</code> is used to validate the phone number.</p>
</div>
</div>
<div class="sect2">
<h3 id="using-in-built-value-extractors-in-custom-containers"><a class="anchor" href="#using-in-built-value-extractors-in-custom-containers"></a>Using In-Built Value Extractors in Custom Containers</h3>
<div class="dlist">
<dl>
<dt class="hdlist1">Cascading validation</dt>
<dd>
<p>Bean Validation supports cascading validation for various entities.
You can specify <code>@Valid</code> on a member of the object that is validated to ensure that the member is also validated in a cascading fashion.
You can validate type arguments, for example, parameterized types and its members if the members have the specified <code>@Valid</code> annotation.</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Department</span> {
    <span class="directive">private</span> <span class="predefined-type">List</span>&lt;<span class="annotation">@Valid</span> Employee&gt; employeesList;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>By specifying <code>@Valid</code> on a parameterized type, when an instance of <code>Department</code> is validated, all elements such as <code>Employee</code> in the <code>employeesList</code> are also validated.
In this example, each employee&#8217;s "phone" is validated against the constraint <code>@USPhoneNumber</code>.</p>
</div>
<div class="paragraph">
<p>For more information see <a href="https://jakarta.ee/specifications/platform/9/apidocs/" class="bare" target="_blank" rel="noopener">https://jakarta.ee/specifications/platform/9/apidocs/</a></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Value Extractor</dt>
<dd>
<p>While validating the object or the object graph, it may be necessary to validate the constraints in the parameterized types of a container as well.
To validate the elements of the container, the validator must extract the values of these elements in the container.
For example, in order to validate the element values of <code>List</code> against one or more constraints such as <code>List&lt;@NotOnVacation Employee&gt;</code> or to apply cascading validation to <code>List&lt;@Valid Employee&gt;</code>, you need a value extractor for the container <code>List</code>.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Jakarta Bean validation provides in-built value extractors for most commonly used container types such as List, Iterable, and others.
However, it is also possible to implement and register value-extractor implementations for custom container types or override the in-built value-extractor implementations.</p>
</div>
<div class="paragraph">
<p>Consider a Statistics Calculator for a group of <code>Person</code> entity and <code>Employee</code> is one of the sub-type of the entity <code>Person</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">StatsCalculator</span>&lt;T <span class="directive">extends</span> Person&gt; {

  <span class="comment">/* Cascading validation as well as @NotNull constraint */</span>
  <span class="directive">private</span> <span class="predefined-type">List</span>&lt;<span class="annotation">@NotNull</span> <span class="annotation">@Valid</span> T&gt; members = <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;T&gt;();


  <span class="directive">public</span> <span class="type">void</span> addMember(T member) {
    members.add(member);
  }

  <span class="directive">public</span> <span class="type">boolean</span> removeMember(T member) {
    <span class="keyword">return</span> members.remove(member);
  }

  <span class="directive">public</span> <span class="type">int</span> getAverageAge() {

    <span class="keyword">if</span> (members.size() == <span class="integer">0</span>)
      <span class="keyword">return</span> <span class="integer">0</span>;

    <span class="type">short</span> sum = <span class="integer">0</span>;
    <span class="keyword">for</span> (T member : members) {
      <span class="keyword">if</span>(member != <span class="predefined-constant">null</span>) {
        sum += member.getAge();
      }
    }
    <span class="keyword">return</span> sum / members.size();
  }

  <span class="directive">public</span> <span class="type">int</span> getOldest() {
    <span class="type">int</span> oldest = -<span class="integer">1</span>;

    <span class="keyword">for</span> (T member : members) {
      <span class="keyword">if</span>(member != <span class="predefined-constant">null</span>) {
        <span class="keyword">if</span> (member.getAge() &gt; oldest) {
          oldest = member.getAge();
        }
      }
    }
    <span class="keyword">return</span> oldest;
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When the <code>StatsCalculator</code> is validated, the "members" field is also validated.
The in-built value extractor for <code>List</code> is used to extract the values of <code>List</code> to validate the elements in <code>List</code>.
In the case of an employee based List, each "Employee" element is validated.
For example, an employees "phone" is validated using the <code>@USPhoneNumber</code> constraint.</p>
</div>
<div class="paragraph">
<p>In the following example, let us consider a <code>StatisticsPrinter</code> that prints the statistics or displays the statistics on screen.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">StatisticsPrinter</span> {
  <span class="directive">private</span> StatsCalculator&lt;<span class="annotation">@Valid</span> Employee&gt; calculator;

  <span class="directive">public</span> StatisticsPrinter(StatsCalculator&lt;Employee&gt; statsCalculator){
    <span class="local-variable">this</span>.calculator = statsCalculator;
  }

  <span class="directive">public</span> <span class="type">void</span> displayStatistics(){
    <span class="comment">//Use StatsCalculator, get stats, format and display them.</span>
  }

  <span class="directive">public</span> <span class="type">void</span> printStatistics(){
    <span class="comment">//Use StatsCalculator, get stats, format and print them.</span>
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The container <code>StatisticsPrinter</code> uses <code>StatisticsCalculator</code>.
When <code>StatisticsPrinter</code> is validated, the <code>StatisticsCalculator</code> is also validated by using the cascading validation such as <code>@Valid</code> annotation.
However, in order to retrieve the values of <code>StatsCalculator</code> container type, a value extractor is required.
An implementation of <code>ValueExtractor</code> for <code>StatsCalculator</code> is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ExtractorForStatsCalculator</span> <span class="directive">implements</span> ValueExtractor&lt;StatsCalculator&lt;<span class="annotation">@ExtractedValue</span> ?&gt;&gt; {

  <span class="annotation">@Override</span>
  <span class="directive">public</span> <span class="type">void</span> extractValues(StatsCalculator&lt;<span class="annotation">@ExtractedValue</span> ?&gt; statsCalculator,
      ValueReceiver valueReceiver) {
      <span class="comment">/* Simple value retrieval is done here.
          It is possible to adapt or unwrap the value if required.*/</span>
    valueReceiver.value(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;extracted value&gt;</span><span class="delimiter">&quot;</span></span>, statsCalculator);
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>There are multiple mechanisms to register the <code>ValueExtractor</code> with Jakarta Bean Validation.
See, &#8220;Registering ValueExtractor&#8221; implementations section in the Jakarta Bean Validation specification <a href="https://jakarta.ee/specifications/bean-validation/3.0/" class="bare" target="_blank" rel="noopener">https://jakarta.ee/specifications/bean-validation/3.0/</a>.
One of the mechanisms is to register the value extractor with Jakarta Bean Validation Context.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ValidatorFactory validatorFactory = Validation
        .buildDefaultValidatorFactory();

    ValidatorContext context = validatorFactory.
        usingContext()
        .addValueExtractor(<span class="keyword">new</span> ExtractorForStatsCalculator());


    <span class="predefined-type">Validator</span> validator = context.getValidator();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using this validator, <code>StatsisticsPrinter</code> is validated in the following sequence of operations:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>StatisticsPrinter</code> is validated.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>The members of <code>StatisticsPrinter</code> that need cascading validation are validated.</p>
</li>
<li>
<p>For container types, value extractor is determined. In the case of <code>StatsCalculator</code>, <code>ExtractorForStatsCalculator</code> is found and then values are retrieved for validation.</p>
</li>
<li>
<p><code>StatsCalculator</code> and its members such as <code>List</code> are validated.</p>
</li>
<li>
<p>In-built <code>ValueExtractor</code> for <code>java.util.List</code> is used to retrieve the values of elements of the list and the validated.
In this case, Employee and the field "phone" that is annotated with <code>@USPhoneNumber</code> constraint is validated.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="customizing-validator-messages"><a class="anchor" href="#customizing-validator-messages"></a>Customizing Validator Messages</h3>
<div class="paragraph">
<p>Jakarta Bean Validation includes a resource bundle of default messages for the built-in constraints.
These messages can be customized and can be localized for non-English-speaking locales.</p>
</div>
<div class="sect3">
<h4 id="the-validationmessages-resource-bundle"><a class="anchor" href="#the-validationmessages-resource-bundle"></a>The ValidationMessages Resource Bundle</h4>
<div class="paragraph">
<p>The <code>ValidationMessages</code> resource bundle and the locale variants of this resource bundle contain strings that override the default validation messages.
The <code>ValidationMessages</code> resource bundle is typically a properties file, <code>ValidationMessages.properties</code>, in the default package of an application.</p>
</div>
<div class="sect4">
<h5 id="localizing-validation-messages"><a class="anchor" href="#localizing-validation-messages"></a>Localizing Validation Messages</h5>
<div class="paragraph">
<p>Locale variants of <code>ValidationMessages.properties</code> are added by appending an underscore and the locale prefix to the base name of the file.
For example, the Spanish locale variant resource bundle would be <code>ValidationMessages_es.properties</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="grouping-constraints"><a class="anchor" href="#grouping-constraints"></a>Grouping Constraints</h3>
<div class="paragraph">
<p>Constraints may be added to one or more groups.
Constraint groups are used to create subsets of constraints so that only certain constraints will be validated for a particular object.
By default, all constraints are included in the <code>Default</code> constraint group.</p>
</div>
<div class="paragraph">
<p>Constraint groups are represented by interfaces.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">Employee</span> {}

<span class="directive">public</span> <span class="type">interface</span> <span class="class">Contractor</span> {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Constraint groups can inherit from other groups.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">Manager</span> <span class="directive">extends</span> Employee {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When a constraint is added to an element, the constraint declares the groups to which that constraint belongs by specifying the class name of the group interface name in the <code>groups</code> element of the constraint.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@NotNull</span>(groups=Employee.class)
Phone workPhone;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Multiple groups can be declared by surrounding the groups with braces (<code>{</code> and <code>}</code>) and separating the groups' class names with commas.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@NotNull</span>(groups={ Employee.class, Contractor.class })
Phone workPhone;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If a group inherits from another group, validating that group results in validating all constraints declared as part of the supergroup.
For example, validating the <code>Manager</code> group results in the <code>workPhone</code> field being validated, because <code>Employee</code> is a superinterface of <code>Manager</code>.</p>
</div>
<div class="sect3">
<h4 id="customizing-group-validation-order"><a class="anchor" href="#customizing-group-validation-order"></a>Customizing Group Validation Order</h4>
<div class="paragraph">
<p>By default, constraint groups are validated in no particular order.
There are cases in which some groups should be validated before others.
For example, in a particular class, basic data should be validated before more advanced data.</p>
</div>
<div class="paragraph">
<p>To set the validation order for a group, add a <code>jakarta.validation.GroupSequence</code> annotation to the interface definition, listing the order in which the validation should occur.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@GroupSequence</span>({Default.class, ExpensiveValidationGroup.class})
<span class="directive">public</span> <span class="type">interface</span> <span class="class">FullValidationGroup</span> {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When validating <code>FullValidationGroup</code>, first the <code>Default</code> group is validated.
If all the data passes validation, then the <code>ExpensiveValidationGroup</code> group is validated.
If a constraint is part of both the <code>Default</code> and the <code>ExpensiveValidationGroup</code> groups, the constraint is validated as part of the <code>Default</code> group and will not be validated on the subsequent <code>ExpensiveValidationGroup</code> pass.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-method-constraints-in-type-hierarchies"><a class="anchor" href="#using-method-constraints-in-type-hierarchies"></a>Using Method Constraints in Type Hierarchies</h3>
<div class="paragraph">
<p>If you add validation constraints to objects in an inheritance hierarchy, take special care to avoid unintended errors when using subtypes.</p>
</div>
<div class="paragraph">
<p>For a given type, subtypes should be able to be substituted without encountering errors.
For example, if you have a <code>Person</code> class and an <code>Employee</code> subclass that extends <code>Person</code>, you should be able to use <code>Employee</code> instances wherever you might use <code>Person</code> instances.
If <code>Employee</code> overrides a method in <code>Person</code> by adding method parameter constraints, code that works correctly with <code>Person</code> objects may throw validation exceptions with <code>Employee</code> objects.</p>
</div>
<div class="paragraph">
<p>The following code shows an incorrect use of method parameter constraints within a class hierarchy:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Person</span> {
...
  public <span class="type">void</span> setPhone(<span class="predefined-type">String</span> phone) { ... }
}

<span class="directive">public</span> <span class="type">class</span> <span class="class">Employee</span> <span class="directive">extends</span> Person {
...
  <span class="annotation">@Override</span>
  <span class="directive">public</span> <span class="type">void</span> setPhone(<span class="annotation">@Verified</span> <span class="predefined-type">String</span> phone) { ... }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>By adding the <code>@Verified</code> constraint to <code>Employee.setPhone</code>, parameters that were valid with <code>Person.setPhone</code> will not be valid with <code>Employee.setPhone</code>.
This is called strengthening the preconditions (that is, the method parameters) of a subtype&#8217;s method.
You may not strengthen the preconditions of subtype method calls.</p>
</div>
<div class="paragraph">
<p>Similarly, the return values from method calls should not be weakened in subtypes.
The following code shows an incorrect use of constraints on method return values in a class hierarchy:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Person</span> {
...
  <span class="annotation">@Verified</span>
  <span class="directive">public</span> USPhoneNumber getPhone() { ... }
}

<span class="directive">public</span> <span class="type">class</span> <span class="class">Employee</span> <span class="directive">extends</span> Person {
...
  <span class="annotation">@Override</span>
  <span class="directive">public</span> USPhoneNumber getPhone() { ... }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the <code>Employee.getPhone</code> method removes the <code>@Verified</code> constraint on the return value.
Return values that would be not pass validation when calling <code>Person.getEmail</code> are allowed when calling <code>Employee.getPhone</code>.
This is called weakening the postconditions (that is, return values) of a subtype.
You may not weaken the postconditions of a subtype method call.</p>
</div>
<div class="paragraph">
<p>If your type hierarchy strengthens the preconditions or weakens the postconditions of subtype method calls, a <code>jakarta.validation.ConstraintDeclarationException</code> will be thrown by the Jakarta Bean Validation runtime.</p>
</div>
<div class="paragraph">
<p>Classes that implement several interfaces that each have the same method signature, known as parallel types, need to be aware of the constraints applied to the interfaces that they implement to avoid strengthening the preconditions.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">PaymentService</span> {
  <span class="type">void</span> processOrder(Order order, <span class="type">double</span> amount);
...
}

<span class="directive">public</span> <span class="type">interface</span> <span class="class">CreditCardPaymentService</span> {
  <span class="type">void</span> processOrder(<span class="annotation">@NotNull</span> Order order, <span class="annotation">@NotNull</span> <span class="type">double</span> amount);
...
}

<span class="directive">public</span> <span class="type">class</span> <span class="class">MyPaymentService</span> <span class="directive">implements</span> PaymentService,
        CreditCardPaymentService {

  <span class="annotation">@Override</span>
  <span class="directive">public</span> <span class="type">void</span> processOrder(Order order, <span class="type">double</span> amount) { ... }
...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, <code>MyPaymentService</code> has the constraints from the <code>processOrder</code> method in <code>CreditCardPaymentService</code>, but client code that calls <code>PaymentService.processOrder</code> doesn&#8217;t expect these constraints.
This is another example of strengthening the preconditions of a subtype and will result in a <code>ConstraintDeclarationException</code>.</p>
</div>
<div class="sect3">
<h4 id="rules-for-using-method-constraints-in-type-hierarchies"><a class="anchor" href="#rules-for-using-method-constraints-in-type-hierarchies"></a>Rules for Using Method Constraints in Type Hierarchies</h4>
<div class="paragraph">
<p>The following rules define how method validation constraints should be used in type hierarchies.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Do not add method parameter constraints to overridden or implemented methods in a subtype.</p>
</li>
<li>
<p>Do not add method parameter constraints to overridden or implemented methods in a subtype that was originally declared in several parallel types.</p>
</li>
<li>
<p>You may add return value constraints to an overridden or implemented method in a subtype.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<h1 id="jakarta-ee-contexts-and-dependency-injection" class="sect0"><a class="anchor" href="#jakarta-ee-contexts-and-dependency-injection"></a>Part V: Jakarta EE Contexts and Dependency Injection</h1>
<div class="openblock partintro">
<div class="content">
Part V explores Jakarta EE Contexts and Dependency Injection (CDI).
</div>
</div>
<div class="sect1">
<h2 id="introduction-to-jakarta-contexts-and-dependency-injection"><a class="anchor" href="#introduction-to-jakarta-contexts-and-dependency-injection"></a>Chapter 25. Introduction to Jakarta Contexts and Dependency Injection</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter describes Jakarta Contexts and Dependency Injection (CDI) which is one of several Jakarta EE features that help to knit together the web tier and the transactional tier of the Jakarta EE platform.</p>
</div>
<div class="sect2">
<h3 id="getting-started"><a class="anchor" href="#getting-started"></a>Getting Started</h3>
<div class="paragraph">
<p>Contexts and Dependency Injection (CDI) enables your objects to have their dependencies provided to them automatically, instead of creating them or receiving them as parameters.
CDI also manages the lifecycle of those dependencies for you.</p>
</div>
<div class="paragraph">
<p>For example, consider the following servlet:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@WebServlet</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/cdiservlet</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">NewServlet</span> <span class="directive">extends</span> HttpServlet {
    <span class="directive">private</span> Message message;

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> init() {
        message = <span class="keyword">new</span> MessageB();
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> doGet(HttpServletRequest request, HttpServletResponse response)
                  <span class="directive">throws</span> <span class="exception">IOException</span> {
        response.getWriter().write(message.get());
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This servlet needs an instance of an object that implements the <code>Message</code> interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">Message</span> {
    <span class="directive">public</span> <span class="predefined-type">String</span> get();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The servlet creates itself an instance of the following object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">MessageB</span> <span class="directive">implements</span> Message {
    <span class="directive">public</span> MessageB() { }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> get() {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">message B</span><span class="delimiter">&quot;</span></span>;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using CDI, this servlet can declare its dependency on a <code>Message</code> instance and have it injected automatically by the CDI runtime.
The new servlet code is the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@WebServlet</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/cdiservlet</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">NewServlet</span> <span class="directive">extends</span> HttpServlet {
    <span class="annotation">@Inject</span> <span class="directive">private</span> Message message;

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> doGet(HttpServletRequest request, HttpServletResponse response)
                  <span class="directive">throws</span> <span class="exception">IOException</span> {
        response.getWriter().write(message.get());
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The CDI runtime looks for classes that implement the <code>Message</code> interface, finds the <code>MessageB</code> class, creates a new instance of it, and injects it into the servlet at runtime.
To manage the lifecycle of the new instance, the CDI runtime needs to know what the scope of the instance should be.
In this example, the servlet only needs the instance to process an HTTP request; the instance can then be garbage collected.
This is specified using the <code>jakarta.enterprise.context.RequestScoped</code> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RequestScoped</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">MessageB</span> <span class="directive">implements</span> Message { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information on scopes, see <a href="#using-scopes">Using Scopes</a>.</p>
</div>
<div class="paragraph">
<p>The <code>MessageB</code> class is a CDI bean.
CDI beans are classes that CDI can instantiate, manage, and inject automatically to satisfy the dependencies of other objects.
Almost any Java class can be managed and injected by CDI.
For more information on beans, see <a href="#about-beans">About Beans</a>.
A JAR or WAR file that contains a CDI bean is a bean archive.
For more information on packaging bean archives, see <a href="#configuring-a-cdi-application">Configuring a CDI Application</a> in this chapter and <a href="#packaging-cdi-applications">Packaging CDI Applications</a> in <a href="#jakarta-contexts-and-dependency-injection-advanced-topics">Chapter 27, <em>Jakarta Contexts and Dependency Injection: Advanced Topics</em></a>.</p>
</div>
<div class="paragraph">
<p>In this example, <code>MessageB</code> is the only class that implements the <code>Message</code> interface.
If an application has more than one implementation of an interface, CDI provides mechanisms that you can use to select which implementation to inject.
For more information, see <a href="#using-qualifiers">Using Qualifiers</a> in this chapter and <a href="#using-alternatives-in-cdi-applications">Using Alternatives in CDI Applications</a> in <a href="#jakarta-contexts-and-dependency-injection-advanced-topics">Chapter 27, <em>Jakarta Contexts and Dependency Injection: Advanced Topics</em></a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="overview-of-cdi"><a class="anchor" href="#overview-of-cdi"></a>Overview of CDI</h3>
<div class="paragraph">
<p>CDI is a set of services that, used together, make it easy for developers to use enterprise beans along with Jakarta Faces technology in web applications.
Designed for use with stateful objects, CDI also has many broader uses, allowing developers a great deal of flexibility to integrate various kinds of components in a loosely coupled but typesafe way.</p>
</div>
<div class="paragraph">
<p>CDI 3.0 is specified in a Jakarta EE specification.
Related specifications that CDI uses include the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Jakarta Dependency Injection</p>
</li>
<li>
<p>The Managed Beans specification, an offshoot of the Jakarta EE platform specification</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The most fundamental services provided by CDI are as follows.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Contexts: This service enables you to bind the lifecycle and interactions of stateful components to well-defined but extensible lifecycle contexts.</p>
</li>
<li>
<p>Dependency injection: This service enables you to inject components into an application in a typesafe way and to choose at deployment time which implementation of a particular interface to inject.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In addition, CDI provides the following services:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Integration with the Expression Language (EL), which allows any component to be used directly within a Jakarta Faces page or a Jakarta Server Pages page</p>
</li>
<li>
<p>The ability to decorate injected components</p>
</li>
<li>
<p>The ability to associate interceptors with components using typesafe interceptor bindings</p>
</li>
<li>
<p>An event-notification model</p>
</li>
<li>
<p>A web conversation scope in addition to the three standard scopes (request, session, and application) defined by the Jakarta Servlet specification</p>
</li>
<li>
<p>A complete Service Provider Interface (SPI) that allows third-party frameworks to integrate cleanly in the Jakarta EE environment</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A major theme of CDI is loose coupling.
CDI does the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Decouples the server and the client by means of well-defined types and qualifiers, so that the server implementation may vary</p>
</li>
<li>
<p>Decouples the lifecycles of collaborating components by</p>
<div class="ulist">
<ul>
<li>
<p>Making components contextual, with automatic lifecycle management</p>
</li>
<li>
<p>Allowing stateful components to interact like services, purely by message passing</p>
</li>
</ul>
</div>
</li>
<li>
<p>Completely decouples message producers from consumers, by means of events</p>
</li>
<li>
<p>Decouples orthogonal concerns by means of Jakarta EE interceptors</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Along with loose coupling, CDI provides strong typing by</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Eliminating lookup using string-based names for wiring and correlations so that the compiler will detect typing errors</p>
</li>
<li>
<p>Allowing the use of declarative Java annotations to specify everything, largely eliminating the need for XML deployment descriptors, and making it easy to provide tools that introspect the code and understand the dependency structure at development time</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="about-beans"><a class="anchor" href="#about-beans"></a>About Beans</h3>
<div class="paragraph">
<p>CDI redefines the concept of a bean beyond its use in other Java technologies, such as the JavaBeans and Jakarta Enterprise Beans technologies.
In CDI, a bean is a source of contextual objects that define application state or logic.
A Jakarta EE component is a bean if the lifecycle of its instances may be managed by the container according to the lifecycle context model defined in the CDI specification.</p>
</div>
<div class="paragraph">
<p>More specifically, a bean has the following attributes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A (nonempty) set of bean types</p>
</li>
<li>
<p>A (nonempty) set of qualifiers (see <a href="#using-qualifiers">Using Qualifiers</a>)</p>
</li>
<li>
<p>A scope (see <a href="#using-scopes">Using Scopes</a>)</p>
</li>
<li>
<p>Optionally, a bean EL name (see <a href="#giving-beans-el-names">Giving Beans EL Names</a>)</p>
</li>
<li>
<p>A set of interceptor bindings</p>
</li>
<li>
<p>A bean implementation</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A bean type defines a client-visible type of the bean. Almost any Java type may be a bean type of a bean.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A bean type may be an interface, a concrete class, or an abstract
class and may be declared final or have final methods.</p>
</li>
<li>
<p>A bean type may be a parameterized type with type parameters and type variables.</p>
</li>
<li>
<p>A bean type may be an array type.
Two array types are considered identical only if the element type is identical.</p>
</li>
<li>
<p>A bean type may be a primitive type.
Primitive types are considered to be identical to their corresponding wrapper types in <code>java.lang</code>.</p>
</li>
<li>
<p>A bean type may be a raw type.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="about-cdi-managed-beans"><a class="anchor" href="#about-cdi-managed-beans"></a>About CDI Managed Beans</h3>
<div class="paragraph">
<p>A managed bean is implemented by a Java class, which is called its bean class.
A top-level Java class is a managed bean if it is defined to be a managed bean by any other Jakarta EE technology specification, such as the Jakarta Faces technology specification, or if it meets all the following conditions.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It is not a nonstatic inner class.</p>
</li>
<li>
<p>It is a concrete class or is annotated <code>@Decorator</code>.</p>
</li>
<li>
<p>It is not annotated with an enterprise bean component-defining annotation or declared as an enterprise bean class in <code>ejb-jar.xml</code>.</p>
</li>
<li>
<p>It has an appropriate constructor.
That is, one of the following is the case.</p>
<div class="ulist">
<ul>
<li>
<p>The class has a constructor with no parameters.</p>
</li>
<li>
<p>The class declares a constructor annotated <code>@Inject</code>.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>No special declaration, such as an annotation, is required to define a managed bean.</p>
</div>
</div>
<div class="sect2">
<h3 id="beans-as-injectable-objects"><a class="anchor" href="#beans-as-injectable-objects"></a>Beans as Injectable Objects</h3>
<div class="paragraph">
<p>The concept of injection has been part of Java technology for some time.
Since the Java EE 5 platform was introduced, annotations have made it possible to inject resources and some other kinds of objects into container-managed objects.
CDI makes it possible to inject more kinds of objects and to inject them into objects that are not container-managed.</p>
</div>
<div class="paragraph">
<p>The following kinds of objects can be injected:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Almost any Java class</p>
</li>
<li>
<p>Session beans</p>
</li>
<li>
<p>Jakarta EE resources: data sources, Messaging topics, queues, connection factories, and the like</p>
</li>
<li>
<p>Persistence contexts (Jakarta Persistence <code>EntityManager</code> objects)</p>
</li>
<li>
<p>Producer fields</p>
</li>
<li>
<p>Objects returned by producer methods</p>
</li>
<li>
<p>Web service references</p>
</li>
<li>
<p>Remote enterprise bean references</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, suppose that you create a simple Java class with a method that returns a string:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">greetings</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">Greeting</span> {
    <span class="directive">public</span> <span class="predefined-type">String</span> greet(<span class="predefined-type">String</span> name) {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello, </span><span class="delimiter">&quot;</span></span> + name + <span class="string"><span class="delimiter">&quot;</span><span class="content">.</span><span class="delimiter">&quot;</span></span>;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This class becomes a bean that you can then inject into another class.
This bean is not exposed to the EL in this form.
<a href="#giving-beans-el-names">Giving Beans EL Names</a> explains how you can make a bean accessible to the EL.</p>
</div>
</div>
<div class="sect2">
<h3 id="using-qualifiers"><a class="anchor" href="#using-qualifiers"></a>Using Qualifiers</h3>
<div class="paragraph">
<p>You can use qualifiers to provide various implementations of a particular bean type.
A qualifier is an annotation that you apply to a bean.
A qualifier type is a Java annotation defined as <code>@Target({METHOD, FIELD, PARAMETER, TYPE})</code> and <code>@Retention(RUNTIME)</code>.</p>
</div>
<div class="paragraph">
<p>For example, you could declare an <code>@Informal</code> qualifier type and apply it to another class that extends the <code>Greeting</code> class.
To declare this qualifier type, use the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">greetings</span>;

<span class="keyword">import</span> <span class="include">static</span> <span class="include">java.lang.annotation.ElementType.FIELD</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">java.lang.annotation.ElementType.METHOD</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">java.lang.annotation.ElementType.PARAMETER</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">java.lang.annotation.ElementType.TYPE</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">java.lang.annotation.RetentionPolicy.RUNTIME</span>;

<span class="keyword">import</span> <span class="include">java.lang.annotation.Retention</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">java.lang.annotation.RetentionPolicy.RUNTIME</span>;
<span class="keyword">import</span> <span class="include">java.lang.annotation.Target</span>;

<span class="keyword">import</span> <span class="include">jakarta.inject.Qualifier</span>;

<span class="annotation">@Qualifier</span>
<span class="annotation">@Retention</span>(RUNTIME)
<span class="annotation">@Target</span>({TYPE, METHOD, FIELD, PARAMETER})
<span class="directive">public</span> <span class="annotation">@interface</span> Informal {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can then define a bean class that extends the <code>Greeting</code> class and uses this qualifier:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">greetings</span>;

<span class="annotation">@Informal</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">InformalGreeting</span> <span class="directive">extends</span> Greeting {
    <span class="directive">public</span> <span class="predefined-type">String</span> greet(<span class="predefined-type">String</span> name) {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Hi, </span><span class="delimiter">&quot;</span></span> + name + <span class="string"><span class="delimiter">&quot;</span><span class="content">!</span><span class="delimiter">&quot;</span></span>;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Both implementations of the bean can now be used in the application.</p>
</div>
<div class="paragraph">
<p>If you define a bean with no qualifier, then the bean automatically has the qualifier <code>@Default</code>.
The unannotated <code>Greeting</code> class could be declared as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">greetings</span>;

<span class="keyword">import</span> <span class="include">jakarta.enterprise.inject.Default</span>;

<span class="annotation">@Default</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Greeting</span> {
    <span class="directive">public</span> <span class="predefined-type">String</span> greet(<span class="predefined-type">String</span> name) {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello, </span><span class="delimiter">&quot;</span></span> + name + <span class="string"><span class="delimiter">&quot;</span><span class="content">.</span><span class="delimiter">&quot;</span></span>;
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="injecting-beans"><a class="anchor" href="#injecting-beans"></a>Injecting Beans</h3>
<div class="paragraph">
<p>To use the beans you create, you inject them into yet another bean that can then be used by an application, such as a Jakarta Faces application.
For example, you might create a bean called <code>Printer</code> into which you would inject one of the <code>Greeting</code> beans:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">jakarta.inject.Inject</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">Printer</span> {

    <span class="annotation">@Inject</span> Greeting greeting;
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This code injects the <code>@Default</code> <code>Greeting</code> implementation into the bean.
The following code injects the <code>@Informal</code> implementation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">jakarta.inject.Inject</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">Printer</span> {

    <span class="annotation">@Inject</span> <span class="annotation">@Informal</span> Greeting greeting;
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>More is needed for the complete picture of this bean.
Its use of scope needs to be understood.
In addition, for a Jakarta Faces application, the bean needs to be accessible through the EL.</p>
</div>
<div class="paragraph">
<p>Now that you can identify the target of the injection, it is important to understand what can be injected and in what context.
Faces 2.3 and above provides producers that enable most important Faces artifacts to be injected.
For detailed information, see the package <a href="https://jakarta.ee/specifications/faces/3.0/apidocs/" target="_blank" rel="noopener">javadoc</a> for <code>jakarta.faces.annotation</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="using-scopes"><a class="anchor" href="#using-scopes"></a>Using Scopes</h3>
<div class="paragraph">
<p>For a web application to use a bean that injects another bean class, the bean needs to be able to hold state over the duration of the user&#8217;s interaction with the application.
The way to define this state is to give the bean a scope.
You can give an object any of the scopes described in <a href="#scopes">Table 25-1</a>, depending on how you are using it.</p>
</div>
<table id="scopes" class="tableblock frame-all grid-all" style="width: 99%;">
<caption class="title">Table 25-1 Scopes</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Scope</th>
<th class="tableblock halign-left valign-top">Annotation</th>
<th class="tableblock halign-left valign-top">Duration</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Request</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@RequestScoped</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A user&#8217;s interaction with a web application in a single HTTP request.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Session</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@SessionScoped</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A user&#8217;s interaction with a web application across multiple HTTP requests.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Application</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@ApplicationScoped</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Shared state across all users' interactions with a web application.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dependent</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Dependent</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The default scope if none is specified; it means that an object exists to serve exactly one client (bean) and has the same lifecycle as that client (bean).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Conversation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@ConversationScoped</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A user&#8217;s interaction with a servlet, including Jakarta Faces applications.
The conversation scope exists within developer-controlled boundaries that extend it across multiple requests for long-running conversations.
All long-running conversations are scoped to a particular HTTP servlet session and may not cross session boundaries.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The first three scopes are defined by both Jakarta Context and Dependency Injection and the Jakarta Faces specification.
The last two are defined by Jakarta Context and Dependency Injection.</p>
</div>
<div class="paragraph">
<p>All predefined scopes except <code>@Dependent</code> are contextual scopes.
CDI places beans of contextual scope in the context whose lifecycle is defined by the Jakarta EE specifications.
For example, a session context and its beans exist during the lifetime of an HTTP session.
Injected references to the beans are contextually aware.
The references always apply to the bean that is associated with the context for the thread that is making the reference.
The CDI container ensures that the objects are created and injected at the correct time as determined by the scope that is specified for these objects.</p>
</div>
<div class="paragraph">
<p>You can also define and implement custom scopes, but that is an advanced topic.
Custom scopes are likely to be used by those who implement and extend the CDI specification.</p>
</div>
<div class="paragraph">
<p>A scope gives an object a well-defined lifecycle context.
A scoped object can be automatically created when it is needed and automatically destroyed when the context in which it was created ends.
Moreover, its state is automatically shared by any clients that execute in the same context.</p>
</div>
<div class="paragraph">
<p>Jakarta EE components, such as servlets and enterprise beans, and JavaBeans components do not by definition have a well-defined scope.
These components are one of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Singletons, such as enterprise singleton beans, whose state is shared among all clients</p>
</li>
<li>
<p>Stateless objects, such as servlets and stateless session beans, which do not contain client-visible state</p>
</li>
<li>
<p>Objects that must be explicitly created and destroyed by their client, such as JavaBeans components and stateful session beans, whose state is shared by explicit reference passing between clients</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>However, if you create a Jakarta EE component that is a managed bean, then it becomes a scoped object, which exists in a well-defined lifecycle context.</p>
</div>
<div class="paragraph">
<p>The web application for the <code>Printer</code> bean will use a simple request and response mechanism, so the managed bean can be annotated as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">jakarta.enterprise.context.RequestScoped</span>;
<span class="keyword">import</span> <span class="include">jakarta.inject.Inject</span>;

<span class="annotation">@RequestScoped</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Printer</span> {

    <span class="annotation">@Inject</span> <span class="annotation">@Informal</span> Greeting greeting;
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Beans that use session, application, or conversation scope must be serializable, but beans that use request scope do not have to be serializable.</p>
</div>
</div>
<div class="sect2">
<h3 id="giving-beans-el-names"><a class="anchor" href="#giving-beans-el-names"></a>Giving Beans EL Names</h3>
<div class="paragraph">
<p>To make a bean accessible through the EL, use the <code>@Named</code> built-in qualifier:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">jakarta.enterprise.context.RequestScoped</span>;
<span class="keyword">import</span> <span class="include">jakarta.inject.Inject</span>;
<span class="keyword">import</span> <span class="include">jakarta.inject.Named</span>;

<span class="annotation">@Named</span>
<span class="annotation">@RequestScoped</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Printer</span> {

    <span class="annotation">@Inject</span> <span class="annotation">@Informal</span> Greeting greeting;
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>@Named</code> qualifier allows you to access the bean by using the bean name, with the first letter in lowercase.
For example, a Facelets page would refer to the bean as <code>printer</code>.</p>
</div>
<div class="paragraph">
<p>You can specify an argument to the <code>@Named</code> qualifier to use a nondefault name:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Named</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">MyPrinter</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>With this annotation, the Facelets page would refer to the bean as <code>MyPrinter</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="adding-setter-and-getter-methods"><a class="anchor" href="#adding-setter-and-getter-methods"></a>Adding Setter and Getter Methods</h3>
<div class="paragraph">
<p>To make the state of the managed bean accessible, add setter and getter methods for that state.
The <code>createSalutation</code> method calls the bean&#8217;s <code>greet</code> method, and the <code>getSalutation</code> method retrieves the result.</p>
</div>
<div class="paragraph">
<p>Once the setter and getter methods have been added, the bean is complete.
The final code looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">greetings</span>;

<span class="keyword">import</span> <span class="include">jakarta.enterprise.context.RequestScoped</span>;
<span class="keyword">import</span> <span class="include">jakarta.inject.Inject</span>;
<span class="keyword">import</span> <span class="include">jakarta.inject.Named</span>;

<span class="annotation">@Named</span>
<span class="annotation">@RequestScoped</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Printer</span> {

    <span class="annotation">@Inject</span> <span class="annotation">@Informal</span> Greeting greeting;

    <span class="directive">private</span> <span class="predefined-type">String</span> name;
    <span class="directive">private</span> <span class="predefined-type">String</span> salutation;

    <span class="directive">public</span> <span class="type">void</span> createSalutation() {
        <span class="local-variable">this</span>.salutation = greeting.greet(name);
    }

    <span class="directive">public</span> <span class="predefined-type">String</span> getSalutation() {
        <span class="keyword">return</span> salutation;
    }

    <span class="directive">public</span> <span class="type">void</span> setName(<span class="predefined-type">String</span> name) {
        <span class="local-variable">this</span>.name = name;
    }

    <span class="directive">public</span> <span class="predefined-type">String</span> getName() {
        <span class="keyword">return</span> name;
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-a-managed-bean-in-a-facelets-page"><a class="anchor" href="#using-a-managed-bean-in-a-facelets-page"></a>Using a Managed Bean in a Facelets Page</h3>
<div class="paragraph">
<p>To use the managed bean in a Facelets page, create a form that uses user interface elements to call its methods and to display their results.
The following example provides a button that asks the user to type a name, retrieves the salutation, and then displays the text in a paragraph below the button:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:form</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">greetme</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   <span class="tag">&lt;p&gt;</span><span class="tag">&lt;h:outputLabel</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Enter your name: </span><span class="delimiter">&quot;</span></span> <span class="attribute-name">for</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;h:inputText</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{printer.name}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span><span class="tag">&lt;/p&gt;</span>
   <span class="tag">&lt;p&gt;</span><span class="tag">&lt;h:commandButton</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Say Hello</span><span class="delimiter">&quot;</span></span>
                       <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{printer.createSalutation}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span><span class="tag">&lt;/p&gt;</span>
   <span class="tag">&lt;p&gt;</span><span class="tag">&lt;h:outputText</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{printer.salutation}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span><span class="tag">&lt;/p&gt;</span>
<span class="tag">&lt;/h:form&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="injecting-objects-by-using-producer-methods"><a class="anchor" href="#injecting-objects-by-using-producer-methods"></a>Injecting Objects by Using Producer Methods</h3>
<div class="paragraph">
<p>Producer methods provide a way to inject objects that are not beans, objects whose values may vary at runtime, and objects that require custom initialization.
For example, if you want to initialize a numeric value defined by a qualifier named <code>@MaxNumber</code>, then you can define the value in a managed bean and then define a producer method, <code>getMaxNumber</code>, for it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">private</span> <span class="type">int</span> maxNumber = <span class="integer">100</span>;
...
<span class="annotation">@Produces</span> <span class="annotation">@MaxNumber</span> <span class="type">int</span> getMaxNumber() {
    <span class="keyword">return</span> maxNumber;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When you inject the object in another managed bean, the container automatically invokes the producer method, initializing the value to 100:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span> <span class="annotation">@MaxNumber</span> <span class="directive">private</span> <span class="type">int</span> maxNumber;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the value can vary at runtime, then the process is slightly different.
For example, the following code defines a producer method that generates a random number defined by a qualifier called <code>@Random</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">private</span> java.util.Random random =
    <span class="keyword">new</span> java.util.Random( <span class="predefined-type">System</span>.currentTimeMillis() );

java.util.Random getRandom() {
        <span class="keyword">return</span> random;
}

<span class="annotation">@Produces</span> <span class="annotation">@Random</span> <span class="type">int</span> next() {
    <span class="keyword">return</span> getRandom().nextInt(maxNumber);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When you inject this object in another managed bean, you declare a contextual instance of the object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span> <span class="annotation">@Random</span> Instance&lt;<span class="predefined-type">Integer</span>&gt; randomInt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>You then call the <code>get</code> method of the <code>Instance</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="local-variable">this</span>.number = randomInt.get();</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-a-cdi-application"><a class="anchor" href="#configuring-a-cdi-application"></a>Configuring a CDI Application</h3>
<div class="paragraph">
<p>When your beans are annotated with a scope type, the server recognizes the application as a bean archive and no additional configuration is required.
The possible scope types for CDI beans are listed in <a href="#using-scopes">Using Scopes</a>.</p>
</div>
<div class="paragraph">
<p>CDI uses an optional deployment descriptor named <code>beans.xml</code>.
Like other Jakarta EE deployment descriptors, the configuration settings in <code>beans.xml</code> are used in addition to annotation settings in CDI classes.
The settings in <code>beans.xml</code> override the annotation settings if there is a conflict.
An archive must contain the <code>beans.xml</code> deployment descriptor only in certain limited situations, described in <a href="#jakarta-contexts-and-dependency-injection-advanced-topics">Chapter 27, <em>Jakarta Contexts and Dependency Injection: Advanced Topics</em></a>.</p>
</div>
<div class="paragraph">
<p>For a web application, the <code>beans.xml</code> deployment descriptor, if present, must be in the <code>WEB-INF</code> directory.
For EJB modules or JAR files, the <code>beans.xml</code> deployment descriptor, if present, must be in the <code>META-INF</code> directory.</p>
</div>
</div>
<div class="sect2">
<h3 id="using-the-postconstruct-and-predestroy-annotations-with-cdi-managed-bean-classes"><a class="anchor" href="#using-the-postconstruct-and-predestroy-annotations-with-cdi-managed-bean-classes"></a>Using the @PostConstruct and @PreDestroy Annotations with CDI Managed Bean Classes</h3>
<div class="paragraph">
<p>CDI managed bean classes and their superclasses support the annotations for initializing and for preparing for the destruction of a bean.
These annotations are defined in Jakarta Annotations (<a href="https://jakarta.ee/specifications/annotations/2.0/" class="bare" target="_blank" rel="noopener">https://jakarta.ee/specifications/annotations/2.0/</a>).</p>
</div>
<div class="sect3">
<h4 id="to-initialize-a-managed-bean-using-the-postconstruct-annotation"><a class="anchor" href="#to-initialize-a-managed-bean-using-the-postconstruct-annotation"></a>To Initialize a Managed Bean Using the @PostConstruct Annotation</h4>
<div class="paragraph">
<p>Initializing a managed bean specifies the lifecycle callback method that the CDI framework should call after dependency injection but before the class is put into service.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the managed bean class or any of its superclasses, define a method that performs the initialization that you require.</p>
</li>
<li>
<p>Annotate the declaration of the method with the <code>jakarta.annotation.PostConstruct</code> annotation.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>When the managed bean is injected into a component, CDI calls the method after all injection has occurred and after all initializers have been called.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
As mandated in Jakarta Annotations, if the annotated method is declared in a superclass, the method is called unless a subclass of the declaring class overrides the method.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>UserNumberBean</code> managed bean in <a href="#the-guessnumber-cdi-cdi-example">The guessnumber-cdi CDI Example</a> uses <code>@PostConstruct</code> to annotate a method that resets all bean fields:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@PostConstruct</span>
<span class="directive">public</span> <span class="type">void</span> reset () {
    <span class="local-variable">this</span>.minimum = <span class="integer">0</span>;
    <span class="local-variable">this</span>.userNumber = <span class="integer">0</span>;
    <span class="local-variable">this</span>.remainingGuesses = <span class="integer">0</span>;
    <span class="local-variable">this</span>.maximum = maxNumber;
    <span class="local-variable">this</span>.number = randomInt.get();
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="to-prepare-for-the-destruction-of-a-managed-bean-using-the-predestroy-annotation"><a class="anchor" href="#to-prepare-for-the-destruction-of-a-managed-bean-using-the-predestroy-annotation"></a>To Prepare for the Destruction of a Managed Bean Using the @PreDestroy Annotation</h4>
<div class="paragraph">
<p>Preparing for the destruction of a managed bean specifies the lifecycle call back method that signals that an application component is about to be destroyed by the container.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the managed bean class or any of its superclasses, prepare for the destruction of the managed bean.</p>
<div class="paragraph">
<p>In this method, perform any cleanup that is required before the bean is destroyed, such as releasing a resource that the bean has been holding.</p>
</div>
</li>
<li>
<p>Annotate the declaration of the method with the <code>jakarta.annotation.PreDestroy</code> annotation.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>CDI calls this method before starting to destroy the bean.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="further-information-about-cdi"><a class="anchor" href="#further-information-about-cdi"></a>Further Information about CDI</h3>
<div class="paragraph">
<p>For more information about CDI, see</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Jakarta Contexts and Dependency Injection specification:<br>
<a href="https://jakarta.ee/specifications/cdi/3.0/" class="bare" target="_blank" rel="noopener">https://jakarta.ee/specifications/cdi/3.0/</a></p>
</li>
<li>
<p>Weld - CDI Implementation:<br>
<a href="https://docs.jboss.org/weld/reference/latest/en-US/html/" class="bare" target="_blank" rel="noopener">https://docs.jboss.org/weld/reference/latest/en-US/html/</a></p>
</li>
<li>
<p>Jakarta Dependency Injection specification:<br>
<a href="https://jakarta.ee/specifications/dependency-injection/2.0/" class="bare" target="_blank" rel="noopener">https://jakarta.ee/specifications/dependency-injection/2.0/</a></p>
</li>
<li>
<p>Jakarta Managed beans specification, which is part of the Jakarta EE Platform Specification:<br>
<a href="https://jakarta.ee/specifications/managedbeans/2.0/" class="bare" target="_blank" rel="noopener">https://jakarta.ee/specifications/managedbeans/2.0/</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="running-the-basic-contexts-and-dependency-injection-examples"><a class="anchor" href="#running-the-basic-contexts-and-dependency-injection-examples"></a>Chapter 26. Running the Basic Contexts and Dependency Injection Examples</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter describes in detail how to build and run simple examples that use CDI.</p>
</div>
<div class="sect2">
<h3 id="building-and-running-the-cdi-samples"><a class="anchor" href="#building-and-running-the-cdi-samples"></a>Building and Running the CDI Samples</h3>
<div class="paragraph">
<p>The examples are in the <code><em>tut-install</em>/examples/cdi/</code> directory.</p>
</div>
<div class="paragraph">
<p>To build and run the examples, you will do the following:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Use NetBeans IDE or the Maven tool to compile and package the example.</p>
</li>
<li>
<p>Use NetBeans IDE or the Maven tool to deploy the example.</p>
</li>
<li>
<p>Run the example in a web browser.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>See <a href="#using-the-tutorial-examples">Chapter 2, <em>Using the Tutorial Examples</em></a>, for basic information on installing, building, and running the examples.</p>
</div>
</div>
<div class="sect2">
<h3 id="the-simplegreeting-cdi-example"><a class="anchor" href="#the-simplegreeting-cdi-example"></a>The simplegreeting CDI Example</h3>
<div class="paragraph">
<p>The <code>simplegreeting</code> example illustrates some of the most basic features of CDI: scopes, qualifiers, bean injection, and accessing a managed bean in a Jakarta Faces application.
When you run the example, you click a button that presents either a formal or an informal greeting, depending on how you edited one of the classes.
The example includes four source files, a Facelets page and template, and configuration files.</p>
</div>
<div class="sect3">
<h4 id="the-simplegreeting-source-files"><a class="anchor" href="#the-simplegreeting-source-files"></a>The simplegreeting Source Files</h4>
<div class="paragraph">
<p>The four source files for the <code>simplegreeting</code> example are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The default <code>Greeting</code> class, shown in <a href="#beans-as-injectable-objects">Beans as Injectable Objects</a></p>
</li>
<li>
<p>The <code>@Informal</code> qualifier interface definition and the <code>InformalGreeting</code> class that implements the interface, both shown in <a href="#using-qualifiers">Using Qualifiers</a></p>
</li>
<li>
<p>The <code>Printer</code> managed bean class, which injects one of the two interfaces, shown in full in <a href="#adding-setter-and-getter-methods">Adding Setter and Getter Methods</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The source files are located in the <code><em>tut-install</em>/examples/cdi/simplegreeting/src/main/java/ee/jakarta/tutorial/simplegreeting</code> directory.</p>
</div>
</div>
<div class="sect3">
<h4 id="the-facelets-template-and-page"><a class="anchor" href="#the-facelets-template-and-page"></a>The Facelets Template and Page</h4>
<div class="paragraph">
<p>To use the managed bean in a simple Facelets application:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Use a very simple template file and <code>index.xhtml</code> page.</p>
<div class="paragraph">
<p>The template page, <code>template.xhtml</code>, looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version='1.0' encoding='UTF-8' ?&gt;</span>
<span class="doctype">&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;
          &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;&gt;</span>
<span class="tag">&lt;html</span> <span class="attribute-name">lang</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/1999/xhtml</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xmlns:h</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://xmlns.jcp.org/jsf/html</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xmlns:ui</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://xmlns.jcp.org/jsf/facelets</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;h:head&gt;</span>
        <span class="tag">&lt;meta</span> <span class="attribute-name">http-equiv</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Content-Type</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">content</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text/html; charset=UTF-8</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;h:outputStylesheet</span> <span class="attribute-name">library</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">css</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default.css</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;title&gt;</span><span class="tag">&lt;ui:insert</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>Default Title<span class="tag">&lt;/ui:insert&gt;</span><span class="tag">&lt;/title&gt;</span>
    <span class="tag">&lt;/h:head&gt;</span>

    <span class="tag">&lt;body&gt;</span>
        <span class="tag">&lt;div</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">container</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;div</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">header</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;h2&gt;</span><span class="tag">&lt;ui:insert</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">head</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>Head<span class="tag">&lt;/ui:insert&gt;</span><span class="tag">&lt;/h2&gt;</span>
            <span class="tag">&lt;/div&gt;</span>

            <span class="tag">&lt;div</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">space</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;p&gt;</span><span class="tag">&lt;/p&gt;</span>
            <span class="tag">&lt;/div&gt;</span>

            <span class="tag">&lt;div</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">content</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;ui:insert</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">content</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/div&gt;</span>
        <span class="tag">&lt;/div&gt;</span>
    <span class="tag">&lt;/body&gt;</span>
<span class="tag">&lt;/html&gt;</span></code></pre>
</div>
</div>
</li>
<li>
<p>To create the Facelets page, redefine the title and head, then add a small form to the content:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version='1.0' encoding='UTF-8' ?&gt;</span>
<span class="doctype">&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;
          &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;&gt;</span>
<span class="tag">&lt;html</span> <span class="attribute-name">lang</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/1999/xhtml</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xmlns:ui</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://xmlns.jcp.org/jsf/facelets</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xmlns:h</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://xmlns.jcp.org/jsf/html</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;ui:composition</span> <span class="attribute-name">template</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/template.xhtml</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

        <span class="tag">&lt;ui:define</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>Simple Greeting<span class="tag">&lt;/ui:define&gt;</span>
        <span class="tag">&lt;ui:define</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">head</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>Simple Greeting<span class="tag">&lt;/ui:define&gt;</span>
        <span class="tag">&lt;ui:define</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">content</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;h:form</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">greetme</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
               <span class="tag">&lt;p&gt;</span><span class="tag">&lt;h:outputLabel</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Enter your name: </span><span class="delimiter">&quot;</span></span> <span class="attribute-name">for</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                  <span class="tag">&lt;h:inputText</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{printer.name}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span><span class="tag">&lt;/p&gt;</span>
               <span class="tag">&lt;p&gt;</span><span class="tag">&lt;h:commandButton</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Say Hello</span><span class="delimiter">&quot;</span></span>
                                   <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{printer.createSalutation}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span><span class="tag">&lt;/p&gt;</span>
               <span class="tag">&lt;p&gt;</span><span class="tag">&lt;h:outputText</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{printer.salutation}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span> <span class="tag">&lt;/p&gt;</span>
            <span class="tag">&lt;/h:form&gt;</span>
        <span class="tag">&lt;/ui:define&gt;</span>

    <span class="tag">&lt;/ui:composition&gt;</span>
<span class="tag">&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The form asks the user to enter a name.
The button is labeled <strong>Say Hello</strong>, and the action defined for it is to call the <code>createSalutation</code> method of the <code>Printer</code> managed bean.
This method in turn calls the <code>greet</code> method of the defined <code>Greeting</code> class.</p>
</div>
<div class="paragraph">
<p>The output text for the form is the value of the greeting returned by the setter method.
Depending on whether the default or the <code>@Informal</code> version of the greeting is injected, this is one of the following, where <code>name</code> is the name entered by the user:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Hello, name.

Hi, name!</pre>
</div>
</div>
<div class="paragraph">
<p>The Facelets page and template are located in the <code><em>tut-install</em>/examples/cdi/simplegreeting/src/main/webapp/</code> directory.</p>
</div>
<div class="paragraph">
<p>The simple CSS file that is used by the Facelets page is in the following location:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/cdi/simplegreeting/src/main/webapp/resources/css/default.css</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="running-the-simplegreeting-example"><a class="anchor" href="#running-the-simplegreeting-example"></a>Running the simplegreeting Example</h4>
<div class="paragraph">
<p>You can use either NetBeans IDE or Maven to build, package, deploy, and run the <code>simplegreeting</code> application.</p>
</div>
<div class="sect4">
<h5 id="to-build-package-and-run-the-simplegreeting-example-using-netbeans-ide"><a class="anchor" href="#to-build-package-and-run-the-simplegreeting-example-using-netbeans-ide"></a>To Build, Package, and Run the simplegreeting Example Using NetBeans IDE</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>From the <strong>File</strong> menu, choose <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the <strong>Open Project</strong> dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/cdi</pre>
</div>
</div>
</li>
<li>
<p>Select the <code>simplegreeting</code> folder.</p>
</li>
<li>
<p>Click <strong>Open Project</strong>.</p>
</li>
<li>
<p>To modify the <code>Printer.java</code> file, perform these steps:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Expand the <strong>Source Packages</strong> node.</p>
</li>
<li>
<p>Expand the <code>greetings</code> node.</p>
</li>
<li>
<p>Double-click the <code>Printer.java</code> file.</p>
</li>
<li>
<p>In the editor, comment out the <code>@Informal</code> annotation:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
<span class="comment">//@Informal</span>
Greeting greeting;</code></pre>
</div>
</div>
</li>
<li>
<p>Save the file.</p>
</li>
</ol>
</div>
</li>
<li>
<p>In the <strong>Projects</strong> tab, right-click the <code>simplegreeting</code> project and select <strong>Build</strong>.</p>
<div class="paragraph">
<p>This command builds and packages the application into a WAR file, <code>simplegreeting.war</code>, located in the <code>target</code> directory, and then deploys it to GlassFish Server.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-build-package-and-deploy-the-simplegreeting-example-using-maven"><a class="anchor" href="#to-build-package-and-deploy-the-simplegreeting-example-using-maven"></a>To Build, Package, and Deploy the simplegreeting Example Using Maven</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>In a terminal window, go to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/cdi/simplegreeting/</pre>
</div>
</div>
</li>
<li>
<p>Enter the following command to deploy the application:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">mvn install</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command builds and packages the application into a WAR file, <code>simplegreeting.war</code>, located in the <code>target</code> directory, and then deploys it to GlassFish Server.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-run-the-simplegreeting-example"><a class="anchor" href="#to-run-the-simplegreeting-example"></a>To Run the simplegreeting Example</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In a web browser, enter the following URL:</p>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080/simplegreeting</pre>
</div>
</div>
<div class="paragraph">
<p>The <strong>Simple Greeting</strong> page opens.</p>
</div>
</li>
<li>
<p>Enter a name in the field.</p>
<div class="paragraph">
<p>For example, suppose that you enter <code>Duke</code>.</p>
</div>
</li>
<li>
<p>Click <strong>Say Hello</strong>.</p>
<div class="paragraph">
<p>If you did not modify the <code>Printer.java</code> file, then the following text string appears below the button:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Hi, Duke!</pre>
</div>
</div>
<div class="paragraph">
<p>If you commented out the <code>@Informal</code> annotation in the <code>Printer.java</code> file, then the following text string appears below the button:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Hello, Duke.</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="the-guessnumber-cdi-cdi-example"><a class="anchor" href="#the-guessnumber-cdi-cdi-example"></a>The guessnumber-cdi CDI Example</h3>
<div class="paragraph">
<p>The <code>guessnumber-cdi</code> example, somewhat more complex than the <code>simplegreeting</code> example, illustrates the use of producer methods and of session and application scope.
The example is a game in which you try to guess a number in fewer than ten attempts.
It is similar to the <code>guessnumber-jsf</code> example described in <a href="#introduction-to-facelets">Chapter 8, <em>Introduction to Facelets</em></a>, except that you can keep guessing until you get the right answer or until you use up your ten attempts.</p>
</div>
<div class="paragraph">
<p>The example includes four source files, a Facelets page and template, and configuration files.
The configuration files and the template are the same as those used for the <code>simplegreeting</code> example.</p>
</div>
<div class="sect3">
<h4 id="the-guessnumber-cdi-source-files"><a class="anchor" href="#the-guessnumber-cdi-source-files"></a>The guessnumber-cdi Source Files</h4>
<div class="paragraph">
<p>The four source files for the <code>guessnumber-cdi</code> example are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>@MaxNumber</code> qualifier interface</p>
</li>
<li>
<p>The <code>@Random</code> qualifier interface</p>
</li>
<li>
<p>The <code>Generator</code> managed bean, which defines producer methods</p>
</li>
<li>
<p>The <code>UserNumberBean</code> managed bean</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The source files are located in the <code><em>tut-install</em>/examples/cdi/guessnumber-cdi/src/main/java/ee/jakarta/tutorial/guessnumber</code> directory.</p>
</div>
<div class="sect4">
<h5 id="the-maxnumber-and-random-qualifier-interfaces"><a class="anchor" href="#the-maxnumber-and-random-qualifier-interfaces"></a>The @MaxNumber and @Random Qualifier Interfaces</h5>
<div class="paragraph">
<p>The <code>@MaxNumber</code> qualifier interface is defined as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">guessnumber</span>;

<span class="keyword">import</span> <span class="include">java.lang.annotation.Documented</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">java.lang.annotation.ElementType.FIELD</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">java.lang.annotation.ElementType.METHOD</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">java.lang.annotation.ElementType.PARAMETER</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">java.lang.annotation.ElementType.TYPE</span>;
<span class="keyword">import</span> <span class="include">java.lang.annotation.Retention</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">java.lang.annotation.RetentionPolicy.RUNTIME</span>;
<span class="keyword">import</span> <span class="include">java.lang.annotation.Target</span>;
<span class="keyword">import</span> <span class="include">jakarta.inject.Qualifier</span>;

<span class="annotation">@Target</span>({TYPE, METHOD, PARAMETER, FIELD})
<span class="annotation">@Retention</span>(RUNTIME)
<span class="annotation">@Documented</span>
<span class="annotation">@Qualifier</span>
<span class="directive">public</span> <span class="annotation">@interface</span> MaxNumber {
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>@Random</code> qualifier interface is defined as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">guessnumber</span>;

<span class="keyword">import</span> <span class="include">java.lang.annotation.Documented</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">java.lang.annotation.ElementType.FIELD</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">java.lang.annotation.ElementType.METHOD</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">java.lang.annotation.ElementType.PARAMETER</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">java.lang.annotation.ElementType.TYPE</span>;
<span class="keyword">import</span> <span class="include">java.lang.annotation.Retention</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">java.lang.annotation.RetentionPolicy.RUNTIME</span>;
<span class="keyword">import</span> <span class="include">java.lang.annotation.Target</span>;
<span class="keyword">import</span> <span class="include">jakarta.inject.Qualifier</span>;

<span class="annotation">@Target</span>({TYPE, METHOD, PARAMETER, FIELD})
<span class="annotation">@Retention</span>(RUNTIME)
<span class="annotation">@Documented</span>
<span class="annotation">@Qualifier</span>
<span class="directive">public</span> <span class="annotation">@interface</span> <span class="predefined-type">Random</span> {
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="the-generator-managed-bean"><a class="anchor" href="#the-generator-managed-bean"></a>The Generator Managed Bean</h5>
<div class="paragraph">
<p>The <code>Generator</code> managed bean contains the two producer methods for the application.
The bean has the <code>@ApplicationScoped</code> annotation to specify that its context extends for the duration of the user&#8217;s interaction with the application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">guessnumber</span>;

<span class="keyword">import</span> <span class="include">java.io.Serializable</span>;
<span class="keyword">import</span> <span class="include">jakarta.enterprise.context.ApplicationScoped</span>;
<span class="keyword">import</span> <span class="include">jakarta.enterprise.inject.Produces</span>;

<span class="annotation">@ApplicationScoped</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Generator</span> <span class="directive">implements</span> <span class="predefined-type">Serializable</span> {

    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="type">long</span> serialVersionUID = -<span class="integer">7213673465118041882L</span>;

    <span class="directive">private</span> <span class="directive">final</span> java.util.Random random =
        <span class="keyword">new</span> java.util.Random( <span class="predefined-type">System</span>.currentTimeMillis() );

    <span class="directive">private</span> <span class="directive">final</span> <span class="type">int</span> maxNumber = <span class="integer">100</span>;

    java.util.Random getRandom() {
        <span class="keyword">return</span> random;
    }

    <span class="annotation">@Produces</span> <span class="annotation">@Random</span> <span class="type">int</span> next() {
        <span class="keyword">return</span> getRandom().nextInt(maxNumber + <span class="integer">1</span>);
    }

    <span class="annotation">@Produces</span> <span class="annotation">@MaxNumber</span> <span class="type">int</span> getMaxNumber() {
        <span class="keyword">return</span> maxNumber;
    }

}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="the-usernumberbean-managed-bean"><a class="anchor" href="#the-usernumberbean-managed-bean"></a>The UserNumberBean Managed Bean</h5>
<div class="paragraph">
<p>The <code>UserNumberBean</code> managed bean, the managed bean for the Jakarta Faces application, provides the basic logic for the game.
This bean does the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Implements setter and getter methods for the bean fields</p>
</li>
<li>
<p>Injects the two qualifier objects</p>
</li>
<li>
<p>Provides a <code>reset</code> method that allows you to begin a new game after you complete one</p>
</li>
<li>
<p>Provides a <code>check</code> method that determines whether the user has guessed the number</p>
</li>
<li>
<p>Provides a <code>validateNumberRange</code> method that determines whether the user&#8217;s input is correct</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The bean is defined as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">guessnumber</span>;

<span class="keyword">import</span> <span class="include">java.io.Serializable</span>;
<span class="keyword">import</span> <span class="include">jakarta.annotation.PostConstruct</span>;
<span class="keyword">import</span> <span class="include">jakarta.enterprise.context.SessionScoped</span>;
<span class="keyword">import</span> <span class="include">jakarta.enterprise.inject.Instance</span>;
<span class="keyword">import</span> <span class="include">jakarta.faces.application.FacesMessage</span>;
<span class="keyword">import</span> <span class="include">jakarta.faces.component.UIComponent</span>;
<span class="keyword">import</span> <span class="include">jakarta.faces.component.UIInput</span>;
<span class="keyword">import</span> <span class="include">jakarta.faces.context.FacesContext</span>;
<span class="keyword">import</span> <span class="include">jakarta.inject.Inject</span>;
<span class="keyword">import</span> <span class="include">jakarta.inject.Named</span>;

<span class="annotation">@Named</span>
<span class="annotation">@SessionScoped</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">UserNumberBean</span> <span class="directive">implements</span> <span class="predefined-type">Serializable</span> {

    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="type">long</span> serialVersionUID = -<span class="integer">7698506329160109476L</span>;

    <span class="directive">private</span> <span class="type">int</span> number;
    <span class="directive">private</span> <span class="predefined-type">Integer</span> userNumber;
    <span class="directive">private</span> <span class="type">int</span> minimum;
    <span class="directive">private</span> <span class="type">int</span> remainingGuesses;

    <span class="annotation">@MaxNumber</span>
    <span class="annotation">@Inject</span>
    <span class="directive">private</span> <span class="type">int</span> maxNumber;

    <span class="directive">private</span> <span class="type">int</span> maximum;

    <span class="annotation">@Random</span>
    <span class="annotation">@Inject</span>
    Instance&lt;<span class="predefined-type">Integer</span>&gt; randomInt;

    <span class="directive">public</span> UserNumberBean() {
    }

    <span class="directive">public</span> <span class="type">int</span> getNumber() {
        <span class="keyword">return</span> number;
    }

    <span class="directive">public</span> <span class="type">void</span> setUserNumber(<span class="predefined-type">Integer</span> user_number) {
        userNumber = user_number;
    }

    <span class="directive">public</span> <span class="predefined-type">Integer</span> getUserNumber() {
        <span class="keyword">return</span> userNumber;
    }

    <span class="directive">public</span> <span class="type">int</span> getMaximum() {
        <span class="keyword">return</span> (<span class="local-variable">this</span>.maximum);
    }

    <span class="directive">public</span> <span class="type">void</span> setMaximum(<span class="type">int</span> maximum) {
        <span class="local-variable">this</span>.maximum = maximum;
    }

    <span class="directive">public</span> <span class="type">int</span> getMinimum() {
        <span class="keyword">return</span> (<span class="local-variable">this</span>.minimum);
    }

    <span class="directive">public</span> <span class="type">void</span> setMinimum(<span class="type">int</span> minimum) {
        <span class="local-variable">this</span>.minimum = minimum;
    }

    <span class="directive">public</span> <span class="type">int</span> getRemainingGuesses() {
        <span class="keyword">return</span> remainingGuesses;
    }

    <span class="directive">public</span> <span class="predefined-type">String</span> check() <span class="directive">throws</span> <span class="exception">InterruptedException</span> {
        <span class="keyword">if</span> (userNumber &gt; number) {
            maximum = userNumber - <span class="integer">1</span>;
        }
        <span class="keyword">if</span> (userNumber &lt; number) {
            minimum = userNumber + <span class="integer">1</span>;
        }
        <span class="keyword">if</span> (userNumber == number) {
            FacesContext.getCurrentInstance().addMessage(<span class="predefined-constant">null</span>,
                <span class="keyword">new</span> FacesMessage(<span class="string"><span class="delimiter">&quot;</span><span class="content">Correct!</span><span class="delimiter">&quot;</span></span>));
        }
        remainingGuesses--;
        <span class="keyword">return</span> <span class="predefined-constant">null</span>;
    }

    <span class="annotation">@PostConstruct</span>
    <span class="directive">public</span> <span class="type">void</span> reset() {
        <span class="local-variable">this</span>.minimum = <span class="integer">0</span>;
        <span class="local-variable">this</span>.userNumber = <span class="integer">0</span>;
        <span class="local-variable">this</span>.remainingGuesses = <span class="integer">10</span>;
        <span class="local-variable">this</span>.maximum = maxNumber;
        <span class="local-variable">this</span>.number = randomInt.get();
    }

    <span class="directive">public</span> <span class="type">void</span> validateNumberRange(FacesContext context,
                                    UIComponent toValidate,
                                    <span class="predefined-type">Object</span> value) {
        <span class="type">int</span> input = (<span class="predefined-type">Integer</span>) value;

        <span class="keyword">if</span> (input &lt; minimum || input &gt; maximum) {
            ((UIInput) toValidate).setValid(<span class="predefined-constant">false</span>);

            FacesMessage message = <span class="keyword">new</span> FacesMessage(<span class="string"><span class="delimiter">&quot;</span><span class="content">Invalid guess</span><span class="delimiter">&quot;</span></span>);
            context.addMessage(toValidate.getClientId(context), message);
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="the-facelets-page"><a class="anchor" href="#the-facelets-page"></a>The Facelets Page</h4>
<div class="paragraph">
<p>This example uses the same template that the <code>simplegreeting</code> example uses.
The <code>index.xhtml</code> file, however, is more complex.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version='1.0' encoding='UTF-8' ?&gt;</span>
<span class="doctype">&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;
          &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;&gt;</span>
<span class="tag">&lt;html</span> <span class="attribute-name">lang</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/1999/xhtml</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xmlns:ui</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://xmlns.jcp.org/jsf/facelets</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xmlns:h</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://xmlns.jcp.org/jsf/html</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;ui:composition</span> <span class="attribute-name">template</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/template.xhtml</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

        <span class="tag">&lt;ui:define</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>Guess My Number<span class="tag">&lt;/ui:define&gt;</span>
        <span class="tag">&lt;ui:define</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">head</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>Guess My Number<span class="tag">&lt;/ui:define&gt;</span>
        <span class="tag">&lt;ui:define</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">content</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;h:form</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">GuessMain</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;div</span> <span class="attribute-name">style</span>=<span class="string"><span class="delimiter">&quot;</span><span class="key">color</span>: <span class="value">black</span>; <span class="key">font-size</span>: <span class="float">24px</span>;<span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                    <span class="tag">&lt;p&gt;</span>I'm thinking of a number from
                    <span class="tag">&lt;span</span> <span class="attribute-name">style</span>=<span class="string"><span class="delimiter">&quot;</span><span class="key">color</span>: <span class="value">blue</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>#{userNumberBean.minimum}<span class="tag">&lt;/span&gt;</span>
                    to
                    <span class="tag">&lt;span</span> <span class="attribute-name">style</span>=<span class="string"><span class="delimiter">&quot;</span><span class="key">color</span>: <span class="value">blue</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>#{userNumberBean.maximum}<span class="tag">&lt;/span&gt;</span>.
                    You have
                    <span class="tag">&lt;span</span> <span class="attribute-name">style</span>=<span class="string"><span class="delimiter">&quot;</span><span class="key">color</span>: <span class="value">blue</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                        #{userNumberBean.remainingGuesses}
                    <span class="tag">&lt;/span&gt;</span>
                    guesses.<span class="tag">&lt;/p&gt;</span>
                <span class="tag">&lt;/div&gt;</span>
                <span class="tag">&lt;h:panelGrid</span> <span class="attribute-name">border</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">columns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">5</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">style</span>=<span class="string"><span class="delimiter">&quot;</span><span class="key">font-size</span>: <span class="float">18px</span>;<span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                    <span class="tag">&lt;h:outputLabel</span> <span class="attribute-name">for</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">inputGuess</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>Number:<span class="tag">&lt;/h:outputLabel&gt;</span>
                    <span class="tag">&lt;h:inputText</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">inputGuess</span><span class="delimiter">&quot;</span></span>
                                 <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{userNumberBean.userNumber}</span><span class="delimiter">&quot;</span></span>
                                 <span class="attribute-name">required</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">3</span><span class="delimiter">&quot;</span></span>
<span class="attribute-name">disabled</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{userNumberBean.number eq userNumberBean.userNumber or userNumberBean.remainingGuesses le 0}</span><span class="delimiter">&quot;</span></span>
                               <span class="attribute-name">validator</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{userNumberBean.validateNumberRange}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                    <span class="tag">&lt;/h:inputText&gt;</span>
                    <span class="tag">&lt;h:commandButton</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">GuessButton</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Guess</span><span class="delimiter">&quot;</span></span>
                                     <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{userNumberBean.check}</span><span class="delimiter">&quot;</span></span>
<span class="attribute-name">disabled</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{userNumberBean.number eq userNumberBean.userNumber or userNumberBean.remainingGuesses le 0}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                    <span class="tag">&lt;h:commandButton</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">RestartButton</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Reset</span><span class="delimiter">&quot;</span></span>
                                     <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{userNumberBean.reset}</span><span class="delimiter">&quot;</span></span>
                                     <span class="attribute-name">immediate</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
                    <span class="tag">&lt;h:outputText</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Higher</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Higher!</span><span class="delimiter">&quot;</span></span>
<span class="attribute-name">rendered</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{userNumberBean.number gt userNumberBean.userNumber and userNumberBean.userNumber ne 0}</span><span class="delimiter">&quot;</span></span>
                                  <span class="attribute-name">style</span>=<span class="string"><span class="delimiter">&quot;</span><span class="key">color</span>: <span class="color">#d20005</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                    <span class="tag">&lt;h:outputText</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Lower</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Lower!</span><span class="delimiter">&quot;</span></span>
<span class="attribute-name">rendered</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{userNumberBean.number lt userNumberBean.userNumber and userNumberBean.userNumber ne 0}</span><span class="delimiter">&quot;</span></span>
                                  <span class="attribute-name">style</span>=<span class="string"><span class="delimiter">&quot;</span><span class="key">color</span>: <span class="color">#d20005</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;/h:panelGrid&gt;</span>
                <span class="tag">&lt;div</span> <span class="attribute-name">style</span>=<span class="string"><span class="delimiter">&quot;</span><span class="key">color</span>: <span class="color">#d20005</span>; <span class="key">font-size</span>: <span class="float">14px</span>;<span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                    <span class="tag">&lt;h:messages</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">messages</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">globalOnly</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;/div&gt;</span>
            <span class="tag">&lt;/h:form&gt;</span>
        <span class="tag">&lt;/ui:define&gt;</span>

    <span class="tag">&lt;/ui:composition&gt;</span>
<span class="tag">&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The Facelets page presents the user with the minimum and maximum values and the number of guesses remaining.
The user&#8217;s interaction with the game takes place within the <code>panelGrid</code> table, which contains an input field, <strong>Guess</strong> and <strong>Reset</strong> buttons, and a field that appears if the guess is higher or lower than the correct number.
Every time the user clicks <strong>Guess</strong>, the <code>userNumberBean.check</code> method is called to reset the maximum or minimum value or, if the guess is correct, to generate a <code>FacesMessage</code> to that effect.
The method that determines whether each guess is valid is <code>userNumberBean.validateNumberRange</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="running-the-guessnumber-cdi-example"><a class="anchor" href="#running-the-guessnumber-cdi-example"></a>Running the guessnumber-cdi Example</h4>
<div class="paragraph">
<p>You can use either NetBeans IDE or Maven to build, package, deploy, and run the <code>guessnumber-cdi</code> application.</p>
</div>
<div class="sect4">
<h5 id="to-build-package-and-deploy-the-guessnumber-cdi-example-using-netbeans-ide"><a class="anchor" href="#to-build-package-and-deploy-the-guessnumber-cdi-example-using-netbeans-ide"></a>To Build, Package, and Deploy the guessnumber-cdi Example Using NetBeans IDE</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>From the <strong>File</strong> menu, choose <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the <strong>Open Project</strong> dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">tut-install/examples/cdi</code></pre>
</div>
</div>
</li>
<li>
<p>Select the <code>guessnumber-cdi</code> folder.</p>
</li>
<li>
<p>Click <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the <strong>Projects</strong> tab, right-click the <code>guessnumber-cdi</code> project and select <strong>Build</strong>.</p>
<div class="paragraph">
<p>This command builds and packages the application into a WAR file, <code>guessnumber-cdi.war</code>, located in the <code>target</code> directory, and then deploys it to GlassFish Server.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-build-package-and-deploy-the-guessnumber-cdi-example-using-maven"><a class="anchor" href="#to-build-package-and-deploy-the-guessnumber-cdi-example-using-maven"></a>To Build, Package, and Deploy the guessnumber-cdi Example Using Maven</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>In a terminal window, change to the following directory:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">tut-install/examples/cdi/guessnumber-cdi/</code></pre>
</div>
</div>
</li>
<li>
<p>Enter the following command to deploy the application:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">mvn install</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command builds and packages the application into a WAR file, <code>guessnumber-cdi.war</code>, located in the <code>target</code> directory, and then deploys it to GlassFish Server.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-run-the-guessnumber-example"><a class="anchor" href="#to-run-the-guessnumber-example"></a>To Run the guessnumber Example</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In a web browser, enter the following URL:</p>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080/guessnumber-cdi</pre>
</div>
</div>
<div class="paragraph">
<p>The <strong>Guess My Number</strong> page opens.</p>
</div>
</li>
<li>
<p>On the <strong>Guess My Number</strong> page, enter a number in the <strong>Number</strong> field and click <strong>Guess</strong>.</p>
<div class="paragraph">
<p>The minimum and maximum values are modified, along with the remaining number of guesses.</p>
</div>
</li>
<li>
<p>Keep guessing numbers until you get the right answer or run out of guesses.</p>
<div class="paragraph">
<p>If you get the right answer or run out of guesses, the input field and <strong>Guess</strong> button are grayed out.</p>
</div>
</li>
<li>
<p>Click <strong>Reset</strong> to play the game again with a new random number.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="jakarta-contexts-and-dependency-injection-advanced-topics"><a class="anchor" href="#jakarta-contexts-and-dependency-injection-advanced-topics"></a>Chapter 27. Jakarta Contexts and Dependency Injection: Advanced Topics</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter describes more advanced features of Jakarta Contexts and Dependency Injection.
Specifically, it covers additional features CDI provides to enable loose coupling of components with strong typing, in addition to those described in <a href="#overview-of-cdi">Overview of CDI</a>.</p>
</div>
<div class="sect2">
<h3 id="packaging-cdi-applications"><a class="anchor" href="#packaging-cdi-applications"></a>Packaging CDI Applications</h3>
<div class="paragraph">
<p>When you deploy a Jakarta EE application, CDI looks for beans inside bean archives.
A bean archive is any module that contains beans that the CDI runtime can manage and inject.
There are two kinds of bean archives: explicit bean archives and implicit bean archives.</p>
</div>
<div class="paragraph">
<p>An explicit bean archive is an archive that contains a <code>beans.xml</code> deployment descriptor, which can be an empty file, contain no version number, or contain the version number 3.0 with the <code>bean-discovery-mode</code> attribute set to <code>all</code>.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">https://jakarta.ee/xml/ns/jakartaee</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">https://jakarta.ee/xml/ns/jakartaee</span>
                           <span class="content">https://jakarta.ee/xml/ns/jakartaee/beans_3_0.xsd</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">version</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">3.0</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">bean-discovery-mode</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">all</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    ...
<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>CDI can manage and inject any bean in an explicit archive, except those annotated with <code>@Vetoed</code>.</p>
</div>
<div class="paragraph">
<p>An implicit bean archive is an archive that contains some beans annotated with a scope type, contains no <code>beans.xml</code> deployment descriptor, or contains a <code>beans.xml</code> deployment descriptor with the <code>bean-discovery-mode</code> attribute set to <code>annotated</code>.</p>
</div>
<div class="paragraph">
<p>In an implicit archive, CDI can only manage and inject beans annotated with a scope type.</p>
</div>
<div class="paragraph">
<p>For a web application, the <code>beans.xml</code> deployment descriptor, if present, must be in the <code>WEB-INF</code> directory.
For enterprise bean modules or JAR files, the <code>beans.xml</code> deployment descriptor, if present, must be in the <code>META-INF</code> directory.</p>
</div>
</div>
<div class="sect2">
<h3 id="using-alternatives-in-cdi-applications"><a class="anchor" href="#using-alternatives-in-cdi-applications"></a>Using Alternatives in CDI Applications</h3>
<div class="paragraph">
<p>When you have more than one version of a bean that you use for different purposes, you can choose between them during the development phase by injecting one qualifier or another, as shown in <a href="#the-simplegreeting-cdi-example">The simplegreeting CDI Example</a>.</p>
</div>
<div class="paragraph">
<p>Instead of having to change the source code of your application, however, you can make the choice at deployment time by using alternatives.</p>
</div>
<div class="paragraph">
<p>Alternatives are commonly used for purposes such as the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To handle client-specific business logic that is determined at runtime</p>
</li>
<li>
<p>To specify beans that are valid for a particular deployment scenario (for example, when country-specific sales tax laws require country-specific sales tax business logic)</p>
</li>
<li>
<p>To create dummy (mock) versions of beans to be used for testing</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To make a bean available for lookup, injection, or EL resolution using this mechanism, give it a <code>jakarta.enterprise.inject.Alternative</code> annotation and then use the <code>alternatives</code> element to specify it in the <code>beans.xml</code> file.</p>
</div>
<div class="paragraph">
<p>For example, you might want to create a full version of a bean and also a simpler version that you use only for certain kinds of testing.
The example described in <a href="#the-encoder-example-using-alternatives">The encoder Example: Using Alternatives</a> contains two such beans, <code>CoderImpl</code> and <code>TestCoderImpl</code>.
The test bean is annotated as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Alternative</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">TestCoderImpl</span> <span class="directive">implements</span> Coder { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The full version is not annotated:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">CoderImpl</span> <span class="directive">implements</span> Coder { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The managed bean injects an instance of the <code>Coder</code> interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
Coder coder;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The alternative version of the bean is used by the application only if that version is declared as follows in the <code>beans.xml</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;beans</span> <span class="attribute-name">...</span><span class="tag">&gt;</span>
    <span class="tag">&lt;alternatives&gt;</span>
        <span class="tag">&lt;class&gt;</span>ee.jakarta.tutorial.encoder.TestCoderImpl<span class="tag">&lt;/class&gt;</span>
    <span class="tag">&lt;/alternatives&gt;</span>
<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If the <code>alternatives</code> element is commented out in the <code>beans.xml</code> file, the <code>CoderImpl</code> class is used.</p>
</div>
<div class="paragraph">
<p>You can also have several beans that implement the same interface, all annotated <code>@Alternative</code>.
In this case, you must specify in the <code>beans.xml</code> file which of these alternative beans you want to use.
If <code>CoderImpl</code> were also annotated <code>@Alternative</code>, one of the two beans would always have to be specified in the <code>beans.xml</code> file.</p>
</div>
<div class="paragraph">
<p>The alternatives that you specify in the <code>beans.xml</code> file apply only to classes in the same archive.
Use the <code>@Priority</code> annotation to specify alternatives globally for an application that consists of multiple modules, as in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Alternative</span>
<span class="annotation">@Priority</span>(Interceptor.Priority.APPLICATION+<span class="integer">10</span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">TestCoderImpl</span> <span class="directive">implements</span> Coder { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The alternative with higher priority value is selected if several alternative beans that implement the same interface are annotated with <code>@Priority</code>.
You do not need to specify the alternative in the <code>beans.xml</code> file when you use the <code>@Priority</code> annotation.</p>
</div>
<div class="sect3">
<h4 id="using-specialization"><a class="anchor" href="#using-specialization"></a>Using Specialization</h4>
<div class="paragraph">
<p>Specialization has a function similar to that of alternatives in that it allows you to substitute one bean for another.
However, you might want to make one bean override the other in all cases.
Suppose you defined the following two beans:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Default</span> <span class="annotation">@Asynchronous</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">AsynchronousService</span> <span class="directive">implements</span> Service { ... }

<span class="annotation">@Alternative</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">MockAsynchronousService</span> <span class="directive">extends</span> AsynchronousService { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you then declared <code>MockAsynchronousService</code> as an alternative in your <code>beans.xml</code> file, the following injection point would resolve to <code>MockAsynchronousService</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span> Service service;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following, however, would resolve to <code>AsynchronousService</code> rather than <code>MockAsynchronousService</code>, because <code>MockAsynchronousService</code> does not have the <code>@Asynchronous</code> qualifier:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span> <span class="annotation">@Asynchronous</span> Service service;</code></pre>
</div>
</div>
<div class="paragraph">
<p>To make sure that <code>MockAsynchronousService</code> was always injected, you would have to implement all bean types and bean qualifiers of <code>AsynchronousService</code>.
However, if <code>AsynchronousService</code> declared a producer method or observer method, even this cumbersome mechanism would not ensure that the other bean was never invoked.
Specialization provides a simpler mechanism.</p>
</div>
<div class="paragraph">
<p>Specialization happens at development time as well as at runtime.
If you declare that one bean specializes another, it extends the other bean class, and at runtime the specialized bean completely replaces the other bean.
If the first bean is produced by means of a producer method, you must also override the producer method.</p>
</div>
<div class="paragraph">
<p>You specialize a bean by giving it the <code>jakarta.enterprise.inject.Specializes</code> annotation.
For example, you might declare a bean as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Specializes</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">MockAsynchronousService</span> <span class="directive">extends</span> AsynchronousService { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, the <code>MockAsynchronousService</code> class will always be invoked instead of the <code>AsynchronousService</code> class.</p>
</div>
<div class="paragraph">
<p>Usually, a bean marked with the <code>@Specializes</code> annotation is also an alternative and is declared as an alternative in the <code>beans.xml</code> file.
Such a bean is meant to stand in as a replacement for the default implementation, and the alternative implementation automatically inherits all qualifiers of the default implementation as well as its EL name, if it has one.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-producer-methods-producer-fields-and-disposer-methods-in-cdi-applications"><a class="anchor" href="#using-producer-methods-producer-fields-and-disposer-methods-in-cdi-applications"></a>Using Producer Methods, Producer Fields, and Disposer Methods in CDI Applications</h3>
<div class="paragraph">
<p>A producer method generates an object that can then be injected. Typically, you use producer methods in the following situations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When you want to inject an object that is not itself a bean</p>
</li>
<li>
<p>When the concrete type of the object to be injected may vary at runtime</p>
</li>
<li>
<p>When the object requires some custom initialization that the bean constructor does not perform</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information on producer methods, see <a href="#injecting-objects-by-using-producer-methods">Injecting Objects by Using Producer Methods</a>.</p>
</div>
<div class="paragraph">
<p>A producer field is a simpler alternative to a producer method; it is a field of a bean that generates an object.
It can be used instead of a simple getter method.
Producer fields are particularly useful for declaring Jakarta EE resources such as data sources, JMS resources, and web service references.</p>
</div>
<div class="paragraph">
<p>A producer method or field is annotated with the <code>jakarta.enterprise.inject.Produces</code> annotation.</p>
</div>
<div class="sect3">
<h4 id="using-producer-methods"><a class="anchor" href="#using-producer-methods"></a>Using Producer Methods</h4>
<div class="paragraph">
<p>A producer method can allow you to select a bean implementation at runtime instead of at development time or deployment time.
For example, in the example described in <a href="#the-producermethods-example-using-a-producer-method-to-choose-a-bean-implementation">The producermethods Example: Using a Producer Method to Choose a Bean Implementation</a>, the managed bean defines the following producer method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Produces</span>
<span class="annotation">@Chosen</span>
<span class="annotation">@RequestScoped</span>
<span class="directive">public</span> Coder getCoder() {

    <span class="keyword">switch</span> (coderType) {
        <span class="keyword">case</span> TEST:
            <span class="keyword">return</span> <span class="keyword">new</span> TestCoderImpl();
        <span class="keyword">case</span> SHIFT:
            <span class="keyword">return</span> <span class="keyword">new</span> CoderImpl();
        <span class="keyword">default</span>:
            <span class="keyword">return</span> <span class="predefined-constant">null</span>;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, <code>getCoder</code> becomes in effect a getter method, and when the <code>coder</code> property is injected with the same qualifier and other annotations as the method, the selected version of the interface is used.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
<span class="annotation">@Chosen</span>
<span class="annotation">@RequestScoped</span>
Coder coder;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Specifying the qualifier is essential: It tells CDI which <code>Coder</code> to inject.
Without it, the CDI implementation would not be able to choose between <code>CoderImpl</code>, <code>TestCoderImpl</code>, and the one returned by <code>getCoder</code> and would cancel deployment, informing the user of the ambiguous dependency.</p>
</div>
</div>
<div class="sect3">
<h4 id="using-producer-fields-to-generate-resources"><a class="anchor" href="#using-producer-fields-to-generate-resources"></a>Using Producer Fields to Generate Resources</h4>
<div class="paragraph">
<p>A common use of a producer field is to generate an object such as a JDBC <code>DataSource</code> or a Jakarta Persistence <code>EntityManager</code> (see <a href="#introduction-to-jakarta-persistence">Chapter 40, <em>Introduction to Jakarta Persistence</em></a>, for more information).
The object can then be managed by the container.
For example, you could create a <code>@UserDatabase</code> qualifier and then declare a producer field for an entity manager as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Produces</span>
<span class="annotation">@UserDatabase</span>
<span class="annotation">@PersistenceContext</span>
<span class="directive">private</span> EntityManager em;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>@UserDatabase</code> qualifier can be used when you inject the object into another bean, <code>RequestBean</code>, elsewhere in the application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    <span class="annotation">@Inject</span>
    <span class="annotation">@UserDatabase</span>
    EntityManager em;
    ...</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#the-producerfields-example-using-producer-fields-to-generate-resources">The producerfields Example: Using Producer Fields to Generate Resources</a> shows how to use producer fields to generate an entity manager.
You can use a similar mechanism to inject <code>@Resource</code>, <code>@EJB</code>, or <code>@WebServiceRef</code> objects.</p>
</div>
<div class="paragraph">
<p>To minimize the reliance on resource injection, specify the producer field for the resource in one place in the application, and then inject the object wherever in the application you need it.</p>
</div>
</div>
<div class="sect3">
<h4 id="using-a-disposer-method"><a class="anchor" href="#using-a-disposer-method"></a>Using a Disposer Method</h4>
<div class="paragraph">
<p>You can use a producer method or a producer field to generate an object that needs to be removed when its work is completed.
If you do, you need a corresponding disposer method, annotated with a <code>@Disposes</code> annotation.
For example, you can close the entity manager as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">void</span> close(<span class="annotation">@Disposes</span> <span class="annotation">@UserDatabase</span> EntityManager em) {
    em.close();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The disposer method is called automatically when the context ends (in this case, at the end of the conversation, because <code>RequestBean</code> has conversation scope), and the parameter in the <code>close</code> method receives the object produced by the producer field.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-predefined-beans-in-cdi-applications"><a class="anchor" href="#using-predefined-beans-in-cdi-applications"></a>Using Predefined Beans in CDI Applications</h3>
<div class="paragraph">
<p>Jakarta EE provides predefined beans that implement the following interfaces.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>jakarta.transaction.UserTransaction</code>: A Jakarta Transactions user transaction.</p>
</li>
<li>
<p><code>java.security.Principal</code>: The abstract notion of a principal, which represents any entity, such as an individual, a corporation, or a login ID.
Whenever the injected principal is accessed, it always represents the identity of the current caller.
For example, a principal is injected into a field at initialization.
Later, a method that uses the injected principal is called on the object into which the principal was injected.
In this situation, the injected principal represents the identity of the current caller when the method is run.</p>
</li>
<li>
<p><code>jakarta.validation.Validator</code>: A validator for bean instances.
The bean that implements this interface enables a <code>Validator</code> object for the default bean validation object <code>ValidatorFactory</code> to be injected.</p>
</li>
<li>
<p><code>jakarta.validation.ValidatorFactory</code>: A factory class for returning initialized <code>Validator</code> instances.
The bean that implements this interface enables the default bean validation <code>ValidatorFactory</code> object to be injected.</p>
</li>
<li>
<p><code>jakarta.servlet.http.HttpServletRequest</code>: An HTTP request from a client.
The bean that implements this interface enables a servlet to obtain all the details of a request.</p>
</li>
<li>
<p><code>jakarta.servlet.http.HttpSession</code>: An HTTP session between a client and a server.
The bean that implements this interface enables a servlet to access information about a session and to bind objects to a session.</p>
</li>
<li>
<p><code>jakarta.servlet.ServletContext</code>: A context object that servlets can use to communicate with the servlet container.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To inject a predefined bean, create an injection point to obtain an instance of the bean by using the <code>jakarta.annotation.Resource</code> annotation for resources or the <code>jakarta.inject.Inject</code> annotation for CDI beans.
For the bean type, specify the class name of the interface the bean implements.</p>
</div>
<table id="injection-of-predefined-beans" class="tableblock frame-all grid-all" style="width: 80%;">
<caption class="title">Table 27-1 Injection of Predefined Beans</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Predefined Bean</th>
<th class="tableblock halign-left valign-top">Resource or CDI Bean</th>
<th class="tableblock halign-left valign-top">Injection Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>UserTransaction</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resource</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Resource UserTransaction transaction;</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Principal</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resource</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Resource Principal principal;</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Validator</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resource</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Resource Validator validator;</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ValidatorFactory</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resource</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Resource ValidatorFactory factory;</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>HttpServletRequest</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CDI bean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Inject HttpServletRequest req;</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>HttpSession</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CDI bean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Inject HttpSession session;</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ServletContext</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CDI bean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Inject ServletContext context;</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Predefined beans are injected with dependent scope and the predefined default qualifier <code>@Default</code>.</p>
</div>
<div class="paragraph">
<p>For more information about injecting resources, see <a href="#resource-injection">Resource Injection</a>.</p>
</div>
<div class="paragraph">
<p>The following code snippet shows how to use the <code>@Resource</code> and <code>@Inject</code> annotations to inject predefined beans.
This code snippet injects a user transaction and a context object into the servlet class <code>TransactionServlet</code>.
The user transaction is an instance of the predefined bean that implements the <code>jakarta.transaction.UserTransaction</code> interface.
The context object is an instance of the predefined bean that implements the <code>jakarta.servlet.ServletContext</code> interface.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">jakarta.annotation.Resource</span>;
<span class="keyword">import</span> <span class="include">jakarta.inject.Inject</span>;
<span class="keyword">import</span> <span class="include">jakarta.servlet.http.HttpServlet</span>;
<span class="keyword">import</span> <span class="include">jakarta.transaction.UserTransaction</span>;
...
public <span class="type">class</span> <span class="class">TransactionServlet</span> <span class="directive">extends</span> HttpServlet {
    <span class="annotation">@Resource</span> UserTransaction transaction;
    <span class="annotation">@Inject</span> ServletContext context;
    ...
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-events-in-cdi-applications"><a class="anchor" href="#using-events-in-cdi-applications"></a>Using Events in CDI Applications</h3>
<div class="paragraph">
<p>Events allow beans to communicate without any compile-time dependency.
One bean can define an event, another bean can fire the event, and yet another bean can handle the event.
In addition, events can be fired asynchronously.
The beans can be in separate packages and even in separate tiers of the application.</p>
</div>
<div class="sect3">
<h4 id="defining-events"><a class="anchor" href="#defining-events"></a>Defining Events</h4>
<div class="paragraph">
<p>An event consists of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The event object, a Java object</p>
</li>
<li>
<p>Zero or more qualifier types, the event qualifiers</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, in the <code>billpayment</code> example described in <a href="#the-billpayment-example-using-events-and-interceptors">The billpayment Example: Using Events and Interceptors</a>, a <code>PaymentEvent</code> bean defines an event using three properties, which have setter and getter methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="predefined-type">String</span> paymentType;
<span class="directive">public</span> <span class="predefined-type">BigDecimal</span> value;
<span class="directive">public</span> <span class="predefined-type">Date</span> datetime;

<span class="directive">public</span> PaymentEvent() {
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The example also defines qualifiers that distinguish between two kinds of <code>PaymentEvent</code>.
Every event also has the default qualifier <code>@Any</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="using-observer-methods-to-handle-events"><a class="anchor" href="#using-observer-methods-to-handle-events"></a>Using Observer Methods to Handle Events</h4>
<div class="paragraph">
<p>An event handler uses an observer method to consume events.</p>
</div>
<div class="paragraph">
<p>Each observer method takes as a parameter an event of a specific event type that is annotated with the <code>@Observes</code> annotation and with any qualifiers for that event type.
The observer method is notified of an event if the event object matches the event type and if all the qualifiers of the event match the observer method event qualifiers.</p>
</div>
<div class="paragraph">
<p>The observer method can take other parameters in addition to the event parameter.
The additional parameters are injection points and can declare qualifiers.</p>
</div>
<div class="paragraph">
<p>The event handler for the <code>billpayment</code> example, <code>PaymentHandler</code>, defines two observer methods, one for each type of <code>PaymentEvent</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">void</span> creditPayment(<span class="annotation">@Observes</span> <span class="annotation">@Credit</span> PaymentEvent event) {
    ...
}

<span class="directive">public</span> <span class="type">void</span> debitPayment(<span class="annotation">@Observes</span> <span class="annotation">@Debit</span> PaymentEvent event) {
    ...
}</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="conditional-and-transactional-observer-methods"><a class="anchor" href="#conditional-and-transactional-observer-methods"></a>Conditional and Transactional Observer Methods</h5>
<div class="paragraph">
<p>Observer methods can also be conditional or transactional:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A conditional observer method is notified of an event only if an instance of the bean that defines the observer method already exists in the current context.
To declare a conditional observer method, specify <code>notifyObserver=IF_EXISTS</code> as an argument to <code>@Observes</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Observes</span>(notifyObserver=IF_EXISTS)</code></pre>
</div>
</div>
<div class="paragraph">
<p>To obtain the default unconditional behavior, you can specify <code>@Observes(notifyObserver=ALWAYS)</code>.</p>
</div>
</li>
<li>
<p>A transactional observer method is notified of an event during the before-completion or after-completion phase of the transaction in which the event was fired.
You can also specify that the notification is to occur only after the transaction has completed successfully or unsuccessfully.
To specify a transactional observer method, use any of the following arguments to <code>@Observes</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Observes</span>(during=BEFORE_COMPLETION)

<span class="annotation">@Observes</span>(during=AFTER_COMPLETION)

<span class="annotation">@Observes</span>(during=AFTER_SUCCESS)

<span class="annotation">@Observes</span>(during=AFTER_FAILURE)</code></pre>
</div>
</div>
<div class="paragraph">
<p>To obtain the default nontransactional behavior, specify <code>@Observes(during=IN_PROGRESS)</code>.</p>
</div>
<div class="paragraph">
<p>An observer method that is called before completion of a transaction may call the <code>setRollbackOnly</code> method on the transaction instance to force a transaction rollback.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Observer methods may throw exceptions.
If a transactional observer method throws an exception, the exception is caught by the container.
If the observer method is nontransactional, the exception terminates processing of the event, and no other observer methods for the event are called.</p>
</div>
</div>
<div class="sect4">
<h5 id="observer-method-ordering"><a class="anchor" href="#observer-method-ordering"></a>Observer Method Ordering</h5>
<div class="paragraph">
<p>Before a certain observer event notification is generated, the container determines the order in which observer methods for that event are invoked.
Observer method order is established through the declaration of the <code>@Priority</code> annotation on an event parameter of an observer method, as in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">void</span> afterLogin(<span class="annotation">@Observes</span> <span class="annotation">@Priority</span>(jakarta.interceptor.Interceptor.Priority.APPLICATION) LoggedInEvent event) { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the <code>@Priority</code> annotation is not specified, the default value is <code>jakarta.interceptor.Interceptor.Priority.APPLICATION + 500</code>.</p>
</li>
<li>
<p>If two or more observer methods are assigned the same priority, the order in which they are invoked is undefined and is therefore unpredictable.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="firing-events"><a class="anchor" href="#firing-events"></a>Firing Events</h4>
<div class="paragraph">
<p>Beans fire events by implementing an instance of the <code>jakarta.enterprise.event.Event</code> interface.
Events can be fired synchronously or asynchronously.</p>
</div>
<div class="sect4">
<h5 id="firing-events-synchronously"><a class="anchor" href="#firing-events-synchronously"></a>Firing Events Synchronously</h5>
<div class="paragraph">
<p>To activate an event synchronously, call the <code>jakarta.enterprise.event.Event.fire</code> method.
This method fires an event and notifies any observer methods.</p>
</div>
<div class="paragraph">
<p>In the <code>billpayment</code> example, a managed bean called <code>PaymentBean</code> fires the appropriate event by using information it receives from the user interface.
There are actually four event beans, two for the event object and two for the payload.
The managed bean injects the two event beans.
The <code>pay</code> method uses a <code>switch</code> statement to choose which event to fire, using <code>new</code> to create the payload.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
<span class="annotation">@Credit</span>
<span class="predefined-type">Event</span>&lt;PaymentEvent&gt; creditEvent;

<span class="annotation">@Inject</span>
<span class="annotation">@Debit</span>
<span class="predefined-type">Event</span>&lt;PaymentEvent&gt; debitEvent;

<span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="type">int</span> DEBIT = <span class="integer">1</span>;
<span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="type">int</span> CREDIT = <span class="integer">2</span>;
<span class="directive">private</span> <span class="type">int</span> paymentOption = DEBIT;
...

<span class="annotation">@Logged</span>
<span class="directive">public</span> <span class="predefined-type">String</span> pay() {
    ...
    switch (paymentOption) {
        <span class="keyword">case</span> DEBIT:
            PaymentEvent debitPayload = <span class="keyword">new</span> PaymentEvent();
            <span class="comment">// populate payload ...</span>
            debitEvent.fire(debitPayload);
            <span class="keyword">break</span>;
        <span class="keyword">case</span> CREDIT:
            PaymentEvent creditPayload = <span class="keyword">new</span> PaymentEvent();
            <span class="comment">// populate payload ...</span>
            creditEvent.fire(creditPayload);
            <span class="keyword">break</span>;
        <span class="keyword">default</span>:
            logger.severe(<span class="string"><span class="delimiter">&quot;</span><span class="content">Invalid payment option!</span><span class="delimiter">&quot;</span></span>);
    }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The argument to the <code>fire</code> method is a <code>PaymentEvent</code> that contains the payload.
The fired event is then consumed by the observer methods.</p>
</div>
</div>
<div class="sect4">
<h5 id="firing-events-asynchronously"><a class="anchor" href="#firing-events-asynchronously"></a>Firing Events Asynchronously</h5>
<div class="paragraph">
<p>To activate an event asynchronously, call the <code>jakarta.enterprise.event.Event.fireAsync</code> method.
This method calls all resolved asynchronous observers in one or more different threads.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span> <span class="predefined-type">Event</span>&lt;LoggedInEvent&gt; loggedInEvent;

<span class="directive">public</span> <span class="type">void</span> login() {
    ...
    loggedInEvent.fireAsync( <span class="keyword">new</span> LoggedInEvent(user) );
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The invocation of the <code>fireAsync()</code> method returns immediately.</p>
</div>
<div class="paragraph">
<p>When events are fired asynchronously, observer methods are notified asynchronously.
Consequently, observer method ordering cannot be guaranteed, because observer method invocation and the firing of asynchronous events occur on separate threads.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-interceptors-in-cdi-applications"><a class="anchor" href="#using-interceptors-in-cdi-applications"></a>Using Interceptors in CDI Applications</h3>
<div class="paragraph">
<p>An interceptor is a class used to interpose in method invocations or lifecycle events that occur in an associated target class.
The interceptor performs tasks, such as logging or auditing, that are separate from the business logic of the application and are repeated often within an application.
Such tasks are often called cross-cutting tasks.
Interceptors allow you to specify the code for these tasks in one place for easy maintenance.
When interceptors were first introduced to the Jakarta EE platform, they were specific to enterprise beans.
On the Jakarta EE platform, you can use them with Jakarta EE managed objects of all kinds, including managed beans.</p>
</div>
<div class="paragraph">
<p>For information on Jakarta EE interceptors, see <a href="#using-jakarta-ee-interceptors">Chapter 58, <em>Using Jakarta EE Interceptors</em></a>.</p>
</div>
<div class="paragraph">
<p>An interceptor class often contains a method annotated <code>@AroundInvoke</code>, which specifies the tasks the interceptor will perform when intercepted methods are invoked.
It can also contain a method annotated <code>@PostConstruct</code>, <code>@PreDestroy</code>, <code>@PrePassivate</code>, or <code>@PostActivate</code>, to specify lifecycle callback interceptors, and a method annotated <code>@AroundTimeout</code>, to specify enterprise bean timeout interceptors.
An interceptor class can contain more than one interceptor method, but it must have no more than one method of each type.</p>
</div>
<div class="paragraph">
<p>Along with an interceptor, an application defines one or more interceptor binding types, which are annotations that associate an interceptor with target beans or methods.
For example, the <code>billpayment</code> example contains an interceptor binding type named <code>@Logged</code> and an interceptor named <code>LoggedInterceptor</code>.
The interceptor binding type declaration looks something like a qualifier declaration, but it is annotated with <code>jakarta.interceptor.InterceptorBinding</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inherited</span>
<span class="annotation">@InterceptorBinding</span>
<span class="annotation">@Retention</span>(RUNTIME)
<span class="annotation">@Target</span>({METHOD, TYPE})
<span class="directive">public</span> <span class="annotation">@interface</span> Logged {
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>An interceptor binding also has the <code>java.lang.annotation.Inherited</code> annotation, to specify that the annotation can be inherited from superclasses.
The <code>@Inherited</code> annotation also applies to custom scopes (not discussed in this tutorial) but does not apply to qualifiers.</p>
</div>
<div class="paragraph">
<p>An interceptor binding type may declare other interceptor bindings.</p>
</div>
<div class="paragraph">
<p>The interceptor class is annotated with the interceptor binding as well as with the <code>@Interceptor</code> annotation.
For an example, see <a href="#the-loggedinterceptor-interceptor-class">The LoggedInterceptor Interceptor Class</a>.</p>
</div>
<div class="paragraph">
<p>Every <code>@AroundInvoke</code> method takes a <code>jakarta.interceptor.InvocationContext</code> argument, returns a <code>java.lang.Object</code>, and throws an <code>Exception</code>.
It can call <code>InvocationContext</code> methods.
The <code>@AroundInvoke</code> method must call the <code>proceed</code> method, which causes the target class method to be invoked.</p>
</div>
<div class="paragraph">
<p>Once an interceptor and binding type are defined, you can annotate beans and individual methods with the binding type to specify that the interceptor is to be invoked either on all methods of the bean or on specific methods.
For example, in the <code>billpayment</code> example, the <code>PaymentHandler</code> bean is annotated <code>@Logged</code>, which means that any invocation of its business methods will cause the interceptor&#8217;s <code>@AroundInvoke</code> method to be invoked:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Logged</span>
<span class="annotation">@SessionScoped</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">PaymentHandler</span> <span class="directive">implements</span> <span class="predefined-type">Serializable</span> {...}</code></pre>
</div>
</div>
<div class="paragraph">
<p>However, in the <code>PaymentBean</code> bean, only the <code>pay</code> and <code>reset</code> methods have the <code>@Logged</code> annotation, so the interceptor is invoked only when these methods are invoked:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Logged</span>
<span class="directive">public</span> <span class="predefined-type">String</span> pay() {...}

<span class="annotation">@Logged</span>
<span class="directive">public</span> <span class="type">void</span> reset() {...}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In order for an interceptor to be invoked in a CDI application, it must, like an alternative, be specified in the <code>beans.xml</code> file.
For example, the <code>LoggedInterceptor</code> class is specified as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;interceptors&gt;</span>
    <span class="tag">&lt;class&gt;</span>ee.jakarta.tutorial.billpayment.interceptors.LoggedInterceptor<span class="tag">&lt;/class&gt;</span>
<span class="tag">&lt;/interceptors&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If an application uses more than one interceptor, the interceptors are invoked in the order specified in the <code>beans.xml</code> file.</p>
</div>
<div class="paragraph">
<p>The interceptors that you specify in the <code>beans.xml</code> file apply only to classes in the same archive.
Use the <code>@Priority</code> annotation to specify interceptors globally for an application that consists of multiple modules, as in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Logged</span>
<span class="annotation">@Interceptor</span>
<span class="annotation">@Priority</span>(Interceptor.Priority.APPLICATION)
<span class="directive">public</span> <span class="type">class</span> <span class="class">LoggedInterceptor</span> <span class="directive">implements</span> <span class="predefined-type">Serializable</span> { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Interceptors with lower priority values are called first.
You do not need to specify the interceptor in the <code>beans.xml</code> file when you use the <code>@Priority</code> annotation.</p>
</div>
</div>
<div class="sect2">
<h3 id="using-decorators-in-cdi-applications"><a class="anchor" href="#using-decorators-in-cdi-applications"></a>Using Decorators in CDI Applications</h3>
<div class="paragraph">
<p>A decorator is a Java class that is annotated <code>jakarta.decorator.Decorator</code> and that has a corresponding <code>decorators</code> element in the <code>beans.xml</code> file.</p>
</div>
<div class="paragraph">
<p>A decorator bean class must also have a delegate injection point, which is annotated <code>jakarta.decorator.Delegate</code>.
This injection point can be a field, a constructor parameter, or an initializer method parameter of the decorator class.</p>
</div>
<div class="paragraph">
<p>Decorators are outwardly similar to interceptors.
However, they actually perform tasks complementary to those performed by interceptors.
Interceptors perform cross-cutting tasks associated with method invocation and with the lifecycles of beans, but cannot perform any business logic.
Decorators, on the other hand, do perform business logic by intercepting business methods of beans.
This means that instead of being reusable for different kinds of applications, as are interceptors, their logic is specific to a particular application.</p>
</div>
<div class="paragraph">
<p>For example, instead of using an alternative <code>TestCoderImpl</code> class for the <code>encoder</code> example, you could create a decorator as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Decorator</span>
<span class="directive">public</span> <span class="directive">abstract</span> <span class="type">class</span> <span class="class">CoderDecorator</span> <span class="directive">implements</span> Coder {

    <span class="annotation">@Inject</span>
    <span class="annotation">@Delegate</span>
    <span class="annotation">@Any</span>
    Coder coder;

    <span class="directive">public</span> <span class="predefined-type">String</span> codeString(<span class="predefined-type">String</span> s, <span class="type">int</span> tval) {
        <span class="type">int</span> len = s.length();

        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="char">\&quot;</span><span class="delimiter">&quot;</span></span> + s + <span class="string"><span class="delimiter">&quot;</span><span class="char">\&quot;</span><span class="content"> becomes </span><span class="delimiter">&quot;</span></span> + <span class="string"><span class="delimiter">&quot;</span><span class="char">\&quot;</span><span class="delimiter">&quot;</span></span> + coder.codeString(s, tval)
                + <span class="string"><span class="delimiter">&quot;</span><span class="char">\&quot;</span><span class="content">, </span><span class="delimiter">&quot;</span></span> + len + <span class="string"><span class="delimiter">&quot;</span><span class="content"> characters in length</span><span class="delimiter">&quot;</span></span>;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>See <a href="#the-decorators-example-decorating-a-bean">The decorators Example: Decorating a Bean</a> for an example that uses this decorator.</p>
</div>
<div class="paragraph">
<p>This simple decorator returns more detailed output than the encoded string returned by the <code>CoderImpl.codeString</code> method.
A more complex decorator could store information in a database or perform some other business logic.</p>
</div>
<div class="paragraph">
<p>A decorator can be declared as an abstract class so that it does not have to implement all the business methods of the interface.</p>
</div>
<div class="paragraph">
<p>In order for a decorator to be invoked in a CDI application, it must, like an interceptor or an alternative, be specified in the <code>beans.xml</code> file.
For example, the <code>CoderDecorator</code> class is specified as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;decorators&gt;</span>
    <span class="tag">&lt;class&gt;</span>ee.jakarta.tutorial.decorators.CoderDecorator<span class="tag">&lt;/class&gt;</span>
<span class="tag">&lt;/decorators&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If an application uses more than one decorator, the decorators are invoked in the order in which they are specified in the <code>beans.xml</code> file.</p>
</div>
<div class="paragraph">
<p>If an application has both interceptors and decorators, the interceptors are invoked first.
This means, in effect, that you cannot intercept a decorator.</p>
</div>
<div class="paragraph">
<p>The decorators that you specify in the <code>beans.xml</code> file apply only to classes in the same archive.
Use the <code>@Priority</code> annotation to specify decorators globally for an application that consists of multiple modules, as in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Decorator</span>
<span class="annotation">@Priority</span>(Interceptor.Priority.APPLICATION)
<span class="directive">public</span> <span class="directive">abstract</span> <span class="type">class</span> <span class="class">CoderDecorator</span> <span class="directive">implements</span> Coder { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Decorators with lower priority values are called first.
You do not need to specify the decorator in the <code>beans.xml</code> when you use the <code>@Priority</code> annotation.</p>
</div>
</div>
<div class="sect2">
<h3 id="using-stereotypes-in-cdi-applications"><a class="anchor" href="#using-stereotypes-in-cdi-applications"></a>Using Stereotypes in CDI Applications</h3>
<div class="paragraph">
<p>A stereotype is a kind of annotation, applied to a bean, that incorporates other annotations.
Stereotypes can be particularly useful in large applications in which you have a number of beans that perform similar functions.
A stereotype is a kind of annotation that specifies the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A default scope</p>
</li>
<li>
<p>Zero or more interceptor bindings</p>
</li>
<li>
<p>Optionally, a <code>@Named</code> annotation, guaranteeing default EL naming</p>
</li>
<li>
<p>Optionally, an <code>@Alternative</code> annotation, specifying that all beans with this stereotype are alternatives</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A bean annotated with a particular stereotype will always use the specified annotations, so you do not have to apply the same annotations to many beans.</p>
</div>
<div class="paragraph">
<p>For example, you might create a stereotype named <code>Action</code>, using the <code>jakarta.enterprise.inject.Stereotype</code> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RequestScoped</span>
<span class="annotation">@Secure</span>
<span class="annotation">@Transactional</span>
<span class="annotation">@Named</span>
<span class="annotation">@Stereotype</span>
<span class="annotation">@Target</span>(TYPE)
<span class="annotation">@Retention</span>(RUNTIME)
<span class="directive">public</span> <span class="annotation">@interface</span> <span class="predefined-type">Action</span> {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>All beans annotated <code>@Action</code> will have request scope, use default EL naming, and have the interceptor bindings <code>@Transactional</code> and <code>@Secure</code>.</p>
</div>
<div class="paragraph">
<p>You could also create a stereotype named <code>Mock</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Alternative</span>
<span class="annotation">@Stereotype</span>
<span class="annotation">@Target</span>(TYPE)
<span class="annotation">@Retention</span>(RUNTIME)
<span class="directive">public</span> <span class="annotation">@interface</span> Mock {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>All beans with this annotation are alternatives.</p>
</div>
<div class="paragraph">
<p>It is possible to apply multiple stereotypes to the same bean, so you can annotate a bean as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Action</span>
<span class="annotation">@Mock</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">MockLoginAction</span> <span class="directive">extends</span> LoginAction { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is also possible to override the scope specified by a stereotype, simply by specifying a different scope for the bean.
The following declaration gives the <code>MockLoginAction</code> bean session scope instead of request scope:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@SessionScoped</span>
<span class="annotation">@Action</span>
<span class="annotation">@Mock</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">MockLoginAction</span> <span class="directive">extends</span> LoginAction { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>CDI makes available a built-in stereotype called <code>Model</code>, which is intended for use with beans that define the model layer of a model-view-controller application architecture.
This stereotype specifies that a bean is both <code>@Named</code> and <code>@RequestScoped</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Named</span>
<span class="annotation">@RequestScoped</span>
<span class="annotation">@Stereotype</span>
<span class="annotation">@Target</span>({TYPE, METHOD, FIELD})
<span class="annotation">@Retention</span>(RUNTIME)
<span class="directive">public</span> <span class="annotation">@interface</span> Model {}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-the-built-in-annotation-literals"><a class="anchor" href="#using-the-built-in-annotation-literals"></a>Using the Built-In Annotation Literals</h3>
<div class="paragraph">
<p>The following built-in annotations define a <code>Literal</code> static nested class, which can be used as a convenience feature for creating instances of annotations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>jakarta.enterprise.inject.Any</code></p>
</li>
<li>
<p><code>jakarta.enterprise.inject.Default</code></p>
</li>
<li>
<p><code>jakarta.enterprise.inject.New</code></p>
</li>
<li>
<p><code>jakarta.enterprise.inject.Specializes</code></p>
</li>
<li>
<p><code>jakarta.enterprise.inject.Vetoed</code></p>
</li>
<li>
<p><code>jakarta.enterprise.util.Nonbinding</code></p>
</li>
<li>
<p><code>jakarta.enterprise.context.Initialized</code></p>
</li>
<li>
<p><code>jakarta.enterprise.context.Destroyed</code></p>
</li>
<li>
<p><code>jakarta.enterprise.context.RequestScoped</code></p>
</li>
<li>
<p><code>jakarta.enterprise.context.SessionScoped</code></p>
</li>
<li>
<p><code>jakarta.enterprise.context.ApplicationScoped</code></p>
</li>
<li>
<p><code>jakarta.enterprise.context.Dependent</code></p>
</li>
<li>
<p><code>jakarta.enterprise.context.ConversationScoped</code></p>
</li>
<li>
<p><code>jakarta.enterprise.inject.Alternative</code></p>
</li>
<li>
<p><code>jakarta.enterprise.inject.Typed</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Default defaultLiteral = <span class="keyword">new</span> Default.Literal();

RequestScoped requestScopedLiteral = RequestScoped.Literal.INSTANCE;

Initialized initializedForApplicationScoped = <span class="keyword">new</span> Initialized.Literal(ApplicationScoped.class);

Initialized initializedForRequestScoped = Initialized.Literal.of(RequestScoped.class);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-the-configurators-interfaces"><a class="anchor" href="#using-the-configurators-interfaces"></a>Using the Configurators Interfaces</h3>
<div class="paragraph">
<p>The CDI 2.0 specification defines the following Configurators interfaces, which are used for dynamically defining and modifying CDI objects:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 99%;">
<colgroup>
<col style="width: 30%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Interface</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AnnotatedTypeConfigurator</code> SPI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Helps create and configure the following type metadata:</p>
<p class="tableblock"><code>AnnotatedType</code></p>
<p class="tableblock"><code>AnnotatedField</code></p>
<p class="tableblock"><code>AnnotatedConstructor</code></p>
<p class="tableblock"><code>AnnotatedMethod</code></p>
<p class="tableblock"><code>AnnotatedParameter</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>InjectionPointConfigurator</code> interface</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Helps configure an existing <code>InjectionPoint</code> instance</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BeanAttributesConfigurator</code> interface</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Helps configure a new <code>BeanAttributes</code> instance</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BeanConfigurator</code> interface</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Helps configure a new <code>Bean</code> instance</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ObserverMethodConfigurator</code> interface</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Helps configure an <code>ObserverMethod</code> instance</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ProducerConfigurator</code> interface</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Helps configure a <code>Producer</code> instance</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="bootstrapping-a-cdi-container-in-java-se"><a class="anchor" href="#bootstrapping-a-cdi-container-in-java-se"></a>Chapter 28. Bootstrapping a CDI Container in Java SE</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter explains how to use the API for bootstrapping a CDI container in Java SE.
This capability allows you to run CDI applications on Java SE and obtain beans, independently of an application server or any Jakarta EE APIs.</p>
</div>
<div class="paragraph">
<p>For more information about bootstrapping a CDI container in Java SE, see the <em>Weld Reference Guide</em> at <a href="https://weld.cdi-spec.org/documentation/" class="bare" target="_blank" rel="noopener">https://weld.cdi-spec.org/documentation/</a>.</p>
</div>
<div class="sect2">
<h3 id="the-bootstrap-api"><a class="anchor" href="#the-bootstrap-api"></a>The Bootstrap API</h3>
<div class="paragraph">
<p>The API for bootstrapping a CDI container in Java SE consists of the following entities:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>jakarta.enterprise.inject.se.SeContainerInitializer</code> class  Allows you to configure and bootstrap the CDI container.
This class includes the following key methods:</p>
<div class="ulist">
<ul>
<li>
<p><code>newInstance()</code> obtains a <code>SeContainerInitializer</code> instance, which allows you to configure the container prior to bootstrapping it.</p>
</li>
<li>
<p><code>initialize()</code> bootstraps the container.</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>jakarta.enterprise.inject.se.SeContainer</code> interface  Provides access to the <code>BeanManager</code> instance for programmatic lookup, as defined in the <code>SeContainer</code> interface, which is described at <a href="https://jakarta.ee/specifications/cdi/3.0/jakarta-cdi-spec-3.0.html#se_container" class="bare" target="_blank" rel="noopener">https://jakarta.ee/specifications/cdi/3.0/jakarta-cdi-spec-3.0.html#se_container</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="configuring-the-cdi-container"><a class="anchor" href="#configuring-the-cdi-container"></a>Configuring the CDI Container</h3>
<div class="paragraph">
<p>The configuration of the <code>SeContainerInitializer</code> instance allows the explicit addition of elements into an internal <strong>synthetic bean archive</strong>.
The synthetic bean archive represents the set of beans that have been loaded while initializing the container.
The contents of the synthetic bean archive depend on whether discovery is enabled:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If discovery is enabled, the synthetic bean archive is created using standard bean discovery rules and contains a superset of all JAR files on the classpath.
Archives that do not include a <code>beans.xml</code> file are excluded.</p>
</li>
<li>
<p>If discovery is disabled, and beans are added programmatically, the synthetic bean archive contains only the beans that have been programmatically added.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="running-the-advanced-contexts-and-dependency-injection-examples"><a class="anchor" href="#running-the-advanced-contexts-and-dependency-injection-examples"></a>Chapter 29. Running the Advanced Contexts and Dependency Injection Examples</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter describes in detail how to build and run several advanced examples that use CDI.</p>
</div>
<div class="sect2">
<h3 id="building-and-running-the-cdi-advanced-examples"><a class="anchor" href="#building-and-running-the-cdi-advanced-examples"></a>Building and Running the CDI Advanced Examples</h3>
<div class="paragraph">
<p>The examples are in the <code><em>tut-install</em>/examples/cdi/</code> directory.
To build and run the examples, you will do the following.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Use NetBeans IDE or the Maven tool to compile, package, and deploy the example.</p>
</li>
<li>
<p>Run the example in a web browser.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>See <a href="#using-the-tutorial-examples">Chapter 2, <em>Using the Tutorial Examples</em></a>, for basic information on installing, building, and running the examples.</p>
</div>
</div>
<div class="sect2">
<h3 id="the-encoder-example-using-alternatives"><a class="anchor" href="#the-encoder-example-using-alternatives"></a>The encoder Example: Using Alternatives</h3>
<div class="paragraph">
<p>The <code>encoder</code> example shows how to use alternatives to choose between two beans at deployment time, as described in <a href="#using-alternatives-in-cdi-applications">Using Alternatives in CDI Applications</a>.
The example includes an interface and two implementations of it, a managed bean, a Facelets page, and configuration files.</p>
</div>
<div class="paragraph">
<p>The source files are located in the <code><em>tut-install</em>/examples/cdi/encoder/src/main/java/ee/jakarta/tutorial/encoder/</code> directory.</p>
</div>
<div class="sect3">
<h4 id="the-coder-interface-and-implementations"><a class="anchor" href="#the-coder-interface-and-implementations"></a>The Coder Interface and Implementations</h4>
<div class="paragraph">
<p>The <code>Coder</code> interface contains just one method, <code>codeString</code>, that takes two arguments: a string, and an integer value that specifies how the letters in the string should be transposed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">Coder</span> {

    <span class="directive">public</span> <span class="predefined-type">String</span> codeString(<span class="predefined-type">String</span> s, <span class="type">int</span> tval);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The interface has two implementation classes, <code>CoderImpl</code> and <code>TestCoderImpl</code>.
The implementation of <code>codeString</code> in <code>CoderImpl</code> shifts the string argument forward in the alphabet by the number of letters specified in the second argument; any characters that are not letters are left unchanged.
(This simple shift code is known as a Caesar cipher because Julius Caesar reportedly used it to communicate with his generals.)
The implementation in <code>TestCoderImpl</code> merely displays the values of the arguments.
The <code>TestCoderImpl</code> implementation is annotated <code>@Alternative</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">jakarta.enterprise.inject.Alternative</span>;

<span class="annotation">@Alternative</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">TestCoderImpl</span> <span class="directive">implements</span> Coder {

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> codeString(<span class="predefined-type">String</span> s, <span class="type">int</span> tval) {
        <span class="keyword">return</span> (<span class="string"><span class="delimiter">&quot;</span><span class="content">input string is </span><span class="delimiter">&quot;</span></span> + s + <span class="string"><span class="delimiter">&quot;</span><span class="content">, shift value is </span><span class="delimiter">&quot;</span></span> + tval);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>beans.xml</code> file for the <code>encoder</code> example contains an <code>alternatives</code> element for the <code>TestCoderImpl</code> class, but by default the element is commented out:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;beans</span> <span class="attribute-name">...</span><span class="tag">&gt;</span>
    <span class="comment">&lt;!--&lt;alternatives&gt;
        &lt;class&gt;ee.jakarta.tutorial.encoder.TestCoderImpl&lt;/class&gt;
    &lt;/alternatives&gt;--&gt;</span>
<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This means that by default, the <code>TestCoderImpl</code> class, annotated <code>@Alternative</code>, will not be used.
Instead, the <code>CoderImpl</code> class will be used.</p>
</div>
</div>
<div class="sect3">
<h4 id="the-encoder-facelets-page-and-managed-bean"><a class="anchor" href="#the-encoder-facelets-page-and-managed-bean"></a>The encoder Facelets Page and Managed Bean</h4>
<div class="paragraph">
<p>The simple Facelets page for the <code>encoder</code> example, <code>index.xhtml</code>, asks the user to enter the string and integer values and passes them to the managed bean, <code>CoderBean</code>, as <code>coderBean.inputString</code> and <code>coderBean.transVal</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;html</span> <span class="attribute-name">lang</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/1999/xhtml</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xmlns:h</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://java.sun.com/jsf/html</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;h:head&gt;</span>
        <span class="tag">&lt;h:outputStylesheet</span> <span class="attribute-name">library</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">css</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default.css</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;title&gt;</span>String Encoder<span class="tag">&lt;/title&gt;</span>
    <span class="tag">&lt;/h:head&gt;</span>
    <span class="tag">&lt;h:body&gt;</span>
        <span class="tag">&lt;h2&gt;</span>String Encoder<span class="tag">&lt;/h2&gt;</span>
        <span class="tag">&lt;p&gt;</span>Type a string and an integer, then click Encode.<span class="tag">&lt;/p&gt;</span>
        <span class="tag">&lt;p&gt;</span>Depending on which alternative is enabled, the coder bean
            will either display the argument values or return a string that
            shifts the letters in the original string by the value you
            specify. The value must be between 0 and 26.<span class="tag">&lt;/p&gt;</span>
        <span class="tag">&lt;h:form</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">encodeit</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;p&gt;</span><span class="tag">&lt;h:outputLabel</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Enter a string: </span><span class="delimiter">&quot;</span></span> <span class="attribute-name">for</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">inputString</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;h:inputText</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">inputString</span><span class="delimiter">&quot;</span></span>
                             <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{coderBean.inputString}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;h:outputLabel</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Enter the number of letters to shift by: </span><span class="delimiter">&quot;</span></span>
                               <span class="attribute-name">for</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">transVal</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;h:inputText</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">transVal</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{coderBean.transVal}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span><span class="tag">&lt;/p&gt;</span>
            <span class="tag">&lt;p&gt;</span><span class="tag">&lt;h:commandButton</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Encode</span><span class="delimiter">&quot;</span></span>
                                <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{coderBean.encodeString()}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span><span class="tag">&lt;/p&gt;</span>
            <span class="tag">&lt;p&gt;</span><span class="tag">&lt;h:outputLabel</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Result: </span><span class="delimiter">&quot;</span></span> <span class="attribute-name">for</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">outputString</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;h:outputText</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">outputString</span><span class="delimiter">&quot;</span></span>
                              <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{coderBean.codedString}</span><span class="delimiter">&quot;</span></span>
                              <span class="attribute-name">style</span>=<span class="string"><span class="delimiter">&quot;</span><span class="key">color</span>:<span class="value">blue</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span><span class="tag">&lt;/p&gt;</span>
            <span class="tag">&lt;p&gt;</span><span class="tag">&lt;h:commandButton</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Reset</span><span class="delimiter">&quot;</span></span>
                                <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{coderBean.reset}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span><span class="tag">&lt;/p&gt;</span>
        <span class="tag">&lt;/h:form&gt;</span>
        ...
    <span class="tag">&lt;/h:body&gt;</span>
<span class="tag">&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When the user clicks the Encode button, the page invokes the managed bean&#8217;s <code>encodeString</code> method and displays the result, <code>coderBean.codedString</code>, in blue.
The page also has a Reset button that clears the fields.</p>
</div>
<div class="paragraph">
<p>The managed bean, <code>CoderBean</code>, is a <code>@RequestScoped</code> bean that declares its input and output properties.
The <code>transVal</code> property has three Bean Validation constraints that enforce limits on the integer value, so that if the user enters an invalid value, a default error message appears on the Facelets page.
The bean also injects an instance of the <code>Coder</code> interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Named</span>
<span class="annotation">@RequestScoped</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">CoderBean</span> {

    <span class="directive">private</span> <span class="predefined-type">String</span> inputString;
    <span class="directive">private</span> <span class="predefined-type">String</span> codedString;
    <span class="annotation">@Max</span>(<span class="integer">26</span>)
    <span class="annotation">@Min</span>(<span class="integer">0</span>)
    <span class="annotation">@NotNull</span>
    <span class="directive">private</span> <span class="type">int</span> transVal;

    <span class="annotation">@Inject</span>
    Coder coder;
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition to simple getter and setter methods for the three properties, the bean defines the <code>encodeString</code> action method called by the Facelets page.
This method sets the <code>codedString</code> property to the value returned by a call to the <code>codeString</code> method of the <code>Coder</code> implementation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">void</span> encodeString() {
    setCodedString(coder.codeString(inputString, transVal));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, the bean defines the <code>reset</code> method to empty the fields of the Facelets page:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">void</span> reset() {
    setInputString(<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>);
    setTransVal(<span class="integer">0</span>);
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="running-the-encoder-example"><a class="anchor" href="#running-the-encoder-example"></a>Running the encoder Example</h4>
<div class="paragraph">
<p>You can use either NetBeans IDE or Maven to build, package, deploy, and run the <code>encoder</code> application.</p>
</div>
<div class="sect4">
<h5 id="to-build-package-and-deploy-the-encoder-example-using-netbeans-ide"><a class="anchor" href="#to-build-package-and-deploy-the-encoder-example-using-netbeans-ide"></a>To Build, Package, and Deploy the encoder Example Using NetBeans IDE</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>From the <strong>File</strong> menu, choose <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the <strong>Open Project</strong> dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/cdi</pre>
</div>
</div>
</li>
<li>
<p>Select the <code>encoder</code> folder.</p>
</li>
<li>
<p>Click <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the <strong>Projects</strong> tab, right-click the <code>encoder</code> project and select <strong>Build</strong>.</p>
<div class="paragraph">
<p>This command builds and packages the application into a WAR file, <code>encoder.war</code>, located in the <code>target</code> directory, and then deploys it to GlassFish Server.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-run-the-encoder-example-using-netbeans-ide"><a class="anchor" href="#to-run-the-encoder-example-using-netbeans-ide"></a>To Run the encoder Example Using NetBeans IDE</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In a web browser, enter the following URL:</p>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080/encoder</pre>
</div>
</div>
</li>
<li>
<p>On the String Encoder page, enter a string and the number of letters to shift by, and then click Encode.</p>
<div class="paragraph">
<p>The encoded string appears in blue on the Result line.
For example, if you enter <code>Java</code> and <code>4</code>, the result is <code>Neze</code>.</p>
</div>
</li>
<li>
<p>Now, edit the <code>beans.xml</code> file to enable the alternative implementation of <code>Coder</code>.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>In the Projects tab, under the <code>encoder</code> project, expand the Web Pages node, then expand the WEB-INF node.</p>
</li>
<li>
<p>Double-click the <code>beans.xml</code> file to open it.</p>
</li>
<li>
<p>Remove the comment characters that surround the <code>alternatives</code> element, so that it looks like this:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;alternatives&gt;</span>
    <span class="tag">&lt;class&gt;</span>ee.jakarta.tutorial.encoder.TestCoderImpl<span class="tag">&lt;/class&gt;</span>
<span class="tag">&lt;/alternatives&gt;</span></code></pre>
</div>
</div>
</li>
<li>
<p>Save the file.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Right-click the <code>encoder</code> project and select Clean and Build.</p>
</li>
<li>
<p>In the web browser, reenter the URL to show the String Encoder page for the redeployed project:</p>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080/encoder/</pre>
</div>
</div>
</li>
<li>
<p>Enter a string and the number of letters to shift by, and then click Encode.</p>
<div class="paragraph">
<p>This time, the Result line displays your arguments.
For example, if you enter <code>Java</code> and <code>4</code>, the result is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Result: input string is Java, shift value is 4</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-build-package-and-deploy-the-encoder-example-using-maven"><a class="anchor" href="#to-build-package-and-deploy-the-encoder-example-using-maven"></a>To Build, Package, and Deploy the encoder Example Using Maven</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>In a terminal window, go to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/cdi/encoder/</pre>
</div>
</div>
</li>
<li>
<p>Enter the following command to deploy the application:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">mvn install</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command builds and packages the application into a WAR file, <code>encoder.war</code>, located in the <code>target</code> directory, and then deploys it to GlassFish Server.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-run-the-encoder-example-using-maven"><a class="anchor" href="#to-run-the-encoder-example-using-maven"></a>To Run the encoder Example Using Maven</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In a web browser, enter the following URL:</p>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080/encoder/</pre>
</div>
</div>
<div class="paragraph">
<p>The String Encoder page opens.</p>
</div>
</li>
<li>
<p>Enter a string and the number of letters to shift by, and then click Encode.</p>
<div class="paragraph">
<p>The encoded string appears in blue on the Result line.
For example, if you enter <code>Java</code> and <code>4</code>, the result is <code>Neze</code>.</p>
</div>
</li>
<li>
<p>Now, edit the <code>beans.xml</code> file to enable the alternative implementation of <code>Coder</code>.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>In a text editor, open the following file:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/cdi/encoder/src/main/webapp/WEB-INF/beans.xml</pre>
</div>
</div>
</li>
<li>
<p>Remove the comment characters that surround the <code>alternatives</code> element, so that it looks like this:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;alternatives&gt;</span>
    <span class="tag">&lt;class&gt;</span>ee.jakarta.tutorial.encoder.TestCoderImpl<span class="tag">&lt;/class&gt;</span>
<span class="tag">&lt;/alternatives&gt;</span></code></pre>
</div>
</div>
</li>
<li>
<p>Save and close the file.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">mvn clean install</code></pre>
</div>
</div>
</li>
<li>
<p>In the web browser, reenter the URL to show the String Encoder page for the redeployed project:</p>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080/encoder</pre>
</div>
</div>
</li>
<li>
<p>Enter a string and the number of letters to shift by, and then click Encode.</p>
<div class="paragraph">
<p>This time, the Result line displays your arguments.
For example, if you enter <code>Java</code> and <code>4</code>, the result is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Result: input string is Java, shift value is 4</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="the-producermethods-example-using-a-producer-method-to-choose-a-bean-implementation"><a class="anchor" href="#the-producermethods-example-using-a-producer-method-to-choose-a-bean-implementation"></a>The producermethods Example: Using a Producer Method to Choose a Bean Implementation</h3>
<div class="paragraph">
<p>The <code>producermethods</code> example shows how to use a producer method to choose between two beans at runtime, as described in <a href="#using-producer-methods-producer-fields-and-disposer-methods-in-cdi-applications">Using Producer Methods, Producer Fields, and Disposer Methods in CDI Applications</a>.
It is very similar to the <code>encoder</code> example described in <a href="#the-encoder-example-using-alternatives">The encoder Example: Using Alternatives</a>.
The example includes the same interface and two implementations of it, a managed bean, a Facelets page, and configuration files.
It also contains a qualifier type.
When you run it, you do not need to edit the <code>beans.xml</code> file and redeploy the application to change its behavior.</p>
</div>
<div class="sect3">
<h4 id="components-of-the-producermethods-example"><a class="anchor" href="#components-of-the-producermethods-example"></a>Components of the producermethods Example</h4>
<div class="paragraph">
<p>The components of <code>producermethods</code> are very much like those for <code>encoder</code>, with some significant differences.</p>
</div>
<div class="paragraph">
<p>Neither implementation of the <code>Coder</code> bean is annotated <code>@Alternative</code>, and there is no <code>beans.xml</code> file, because it is not needed.</p>
</div>
<div class="paragraph">
<p>The Facelets page and the managed bean, <code>CoderBean</code>, have an additional property, <code>coderType</code>, that allows the user to specify at runtime which implementation to use.
In addition, the managed bean has a producer method that selects the implementation using a qualifier type, <code>@Chosen</code>.</p>
</div>
<div class="paragraph">
<p>The bean declares two constants that specify whether the coder type is the test implementation or the implementation that actually shifts letters:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">private</span> <span class="directive">final</span> <span class="directive">static</span> <span class="type">int</span> TEST = <span class="integer">1</span>;
<span class="directive">private</span> <span class="directive">final</span> <span class="directive">static</span> <span class="type">int</span> SHIFT = <span class="integer">2</span>;
<span class="directive">private</span> <span class="type">int</span> coderType = SHIFT; <span class="comment">// default value</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The producer method, annotated with <code>@Produces</code> and <code>@Chosen</code> as well as <code>@RequestScoped</code> (so that it lasts only for the duration of a single request and response), returns one of the two implementations based on the <code>coderType</code> supplied by the user.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Produces</span>
<span class="annotation">@Chosen</span>
<span class="annotation">@RequestScoped</span>
<span class="directive">public</span> Coder getCoder() {

    <span class="keyword">switch</span> (coderType) {
        <span class="keyword">case</span> TEST:
            <span class="keyword">return</span> <span class="keyword">new</span> TestCoderImpl();
        <span class="keyword">case</span> SHIFT:
            <span class="keyword">return</span> <span class="keyword">new</span> CoderImpl();
        <span class="keyword">default</span>:
            <span class="keyword">return</span> <span class="predefined-constant">null</span>;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, the managed bean injects the chosen implementation, specifying the same qualifier as that returned by the producer method to resolve ambiguities:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
<span class="annotation">@Chosen</span>
<span class="annotation">@RequestScoped</span>
Coder coder;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Facelets page contains modified instructions and a pair of options whose selected value is assigned to the property <code>coderBean.coderType</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">    <span class="tag">&lt;h2&gt;</span>String Encoder<span class="tag">&lt;/h2&gt;</span>
        <span class="tag">&lt;p&gt;</span>Select Test or Shift, type a string and an integer, then click
            Encode.<span class="tag">&lt;/p&gt;</span>
        <span class="tag">&lt;p&gt;</span>If you select Test, the TestCoderImpl bean will display the
            argument values.<span class="tag">&lt;/p&gt;</span>
        <span class="tag">&lt;p&gt;</span>If you select Shift, the CoderImpl bean will return a string that
            shifts the letters in the original string by the value you specify.
            The value must be between 0 and 26.<span class="tag">&lt;/p&gt;</span>
        <span class="tag">&lt;h:form</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">encodeit</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;h:selectOneRadio</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">coderType</span><span class="delimiter">&quot;</span></span>
                              <span class="attribute-name">required</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
                              <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{coderBean.coderType}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;f:selectItem</span>
                    <span class="attribute-name">itemValue</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>
                    <span class="attribute-name">itemLabel</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Test</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;f:selectItem</span>
                    <span class="attribute-name">itemValue</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span>
                    <span class="attribute-name">itemLabel</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Shift Letters</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/h:selectOneRadio&gt;</span>
            ...</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="running-the-producermethods-example"><a class="anchor" href="#running-the-producermethods-example"></a>Running the producermethods Example</h4>
<div class="paragraph">
<p>You can use either NetBeans IDE or Maven to build, package, deploy, and run the <code>producermethods</code> application.</p>
</div>
<div class="sect4">
<h5 id="to-build-package-and-deploy-the-producermethods-example-using-netbeans-ide"><a class="anchor" href="#to-build-package-and-deploy-the-producermethods-example-using-netbeans-ide"></a>To Build, Package, and Deploy the producermethods Example Using NetBeans IDE</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>From the <strong>File</strong> menu, choose <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the <strong>Open Project</strong> dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/cdi</pre>
</div>
</div>
</li>
<li>
<p>Select the <code>producermethods</code> folder.</p>
</li>
<li>
<p>Click <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the <strong>Projects</strong> tab, right-click the <code>producermethods</code> project and select <strong>Build</strong>.</p>
<div class="paragraph">
<p>This command builds and packages the application into a WAR file, <code>producermethods.war</code>, located in the <code>target</code> directory, and then deploys it to GlassFish Server.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-build-package-and-deploy-the-producermethods-example-using-maven"><a class="anchor" href="#to-build-package-and-deploy-the-producermethods-example-using-maven"></a>To Build, Package, and Deploy the producermethods Example Using Maven</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>In a terminal window, go to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/cdi/producermethods/</pre>
</div>
</div>
</li>
<li>
<p>Enter the following command to deploy the application:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">mvn install</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command builds and packages the application into a WAR file, <code>producermethods.war</code>, located in the <code>target</code> directory, and then deploys it to GlassFish Server.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-run-the-producermethods-example"><a class="anchor" href="#to-run-the-producermethods-example"></a>To Run the producermethods Example</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In a web browser, enter the following URL:</p>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080/producermethods</pre>
</div>
</div>
</li>
<li>
<p>On the String Encoder page, select either the Test or Shift Letters option, enter a string and the number of letters to shift by, and then click Encode.</p>
<div class="paragraph">
<p>Depending on your selection, the Result line displays either the encoded string or the input values you specified.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="the-producerfields-example-using-producer-fields-to-generate-resources"><a class="anchor" href="#the-producerfields-example-using-producer-fields-to-generate-resources"></a>The producerfields Example: Using Producer Fields to Generate Resources</h3>
<div class="paragraph">
<p>The <code>producerfields</code> example, which allows you to create a to-do list, shows how to use a producer field to generate objects that can then be managed by the container.
This example generates an <code>EntityManager</code> object, but resources such as JDBC connections and datasources can also be generated this way.</p>
</div>
<div class="paragraph">
<p>The <code>producerfields</code> example is the simplest possible entity example.
It also contains a qualifier and a class that generates the entity manager.
It also contains a single entity, a stateful session bean, a Facelets page, and a managed bean.</p>
</div>
<div class="paragraph">
<p>The source files are located in the <code><em>tut-install</em>/examples/cdi/producerfields/src/main/java/ee/jakarta/tutorial/producerfields/</code> directory.</p>
</div>
<div class="sect3">
<h4 id="the-producer-field-for-the-producerfields-example"><a class="anchor" href="#the-producer-field-for-the-producerfields-example"></a>The Producer Field for the producerfields Example</h4>
<div class="paragraph">
<p>The most important component of the <code>producerfields</code> example is the smallest, the <code>db.UserDatabaseEntityManager</code> class, which isolates the generation of the <code>EntityManager</code> object so it can easily be used by other components in the application.
The class uses a producer field to inject an <code>EntityManager</code> annotated with the <code>@UserDatabase</code> qualifier, also defined in the <code>db</code> package:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Singleton</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">UserDatabaseEntityManager</span> {

    <span class="annotation">@Produces</span>
    <span class="annotation">@PersistenceContext</span>
    <span class="annotation">@UserDatabase</span>
    <span class="directive">private</span> EntityManager em;
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The class does not explicitly produce a persistence unit field, but the application has a <code>persistence.xml</code> file that specifies a persistence unit.
The class is annotated <code>jakarta.inject.Singleton</code> to specify that the injector should instantiate it only once.</p>
</div>
<div class="paragraph">
<p>The <code>db.UserDatabaseEntityManager</code> class also contains commented-out code that uses <code>create</code> and <code>close</code> methods to generate and remove the producer field:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">/*
@PersistenceContext
private EntityManager em;

@Produces
@UserDatabase
public EntityManager create() {
    return em;
}
*/</span>

<span class="directive">public</span> <span class="type">void</span> close(<span class="annotation">@Disposes</span> <span class="annotation">@UserDatabase</span> EntityManager em) {
    em.close();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can remove the comment indicators from this code and place them around the field declaration to test how the methods work.
The behavior of the application is the same with either mechanism.</p>
</div>
<div class="paragraph">
<p>The advantage of producing the <code>EntityManager</code> in a separate class rather than simply injecting it into an enterprise bean is that the object can easily be reused in a typesafe way.
Also, a more complex application can create multiple entity managers using multiple persistence units, and this mechanism isolates this code for easy maintenance, as in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Singleton</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">JPAResourceProducer</span> {
    <span class="annotation">@Produces</span>
    <span class="annotation">@PersistenceUnit</span>(unitName=<span class="string"><span class="delimiter">&quot;</span><span class="content">pu3</span><span class="delimiter">&quot;</span></span>)
    <span class="annotation">@TestDatabase</span>
    EntityManagerFactory customerDatabasePersistenceUnit;

    <span class="annotation">@Produces</span>
    <span class="annotation">@PersistenceContext</span>(unitName=<span class="string"><span class="delimiter">&quot;</span><span class="content">pu3</span><span class="delimiter">&quot;</span></span>)
    <span class="annotation">@TestDatabase</span>
    EntityManager customerDatabasePersistenceContext;

    <span class="annotation">@Produces</span>
    <span class="annotation">@PersistenceUnit</span>(unitName=<span class="string"><span class="delimiter">&quot;</span><span class="content">pu4</span><span class="delimiter">&quot;</span></span>)
    <span class="annotation">@Documents</span>
    EntityManagerFactory customerDatabasePersistenceUnit;

    <span class="annotation">@Produces</span>
    <span class="annotation">@PersistenceContext</span>(unitName=<span class="string"><span class="delimiter">&quot;</span><span class="content">pu4</span><span class="delimiter">&quot;</span></span>)
    <span class="annotation">@Documents</span>
    EntityManager docDatabaseEntityManager;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>EntityManagerFactory</code> declarations also allow applications to use an application-managed entity manager.</p>
</div>
</div>
<div class="sect3">
<h4 id="the-producerfields-entity-and-session-bean"><a class="anchor" href="#the-producerfields-entity-and-session-bean"></a>The producerfields Entity and Session Bean</h4>
<div class="paragraph">
<p>The <code>producerfields</code> example contains a simple entity class, <code>entity.ToDo</code>, and a stateful session bean, <code>ejb.RequestBean</code>, that uses it.</p>
</div>
<div class="paragraph">
<p>The entity class contains three fields: an autogenerated <code>id</code> field, a string specifying the task, and a timestamp.
The timestamp field, <code>timeCreated</code>, is annotated with <code>@Temporal</code>, which is required for persistent <code>Date</code> fields.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Entity</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">ToDo</span> <span class="directive">implements</span> <span class="predefined-type">Serializable</span> {

    ...
    <span class="annotation">@Id</span>
    <span class="annotation">@GeneratedValue</span>(strategy = GenerationType.AUTO)
    <span class="directive">private</span> <span class="predefined-type">Long</span> id;
    <span class="directive">protected</span> <span class="predefined-type">String</span> taskText;
    <span class="annotation">@Temporal</span>(TIMESTAMP)
    <span class="directive">protected</span> <span class="predefined-type">Date</span> timeCreated;

    <span class="directive">public</span> ToDo() {
    }

    <span class="directive">public</span> ToDo(<span class="predefined-type">Long</span> id, <span class="predefined-type">String</span> taskText, <span class="predefined-type">Date</span> timeCreated) {
        <span class="local-variable">this</span>.id = id;
        <span class="local-variable">this</span>.taskText = taskText;
        <span class="local-variable">this</span>.timeCreated = timeCreated;
    }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The remainder of the <code>ToDo</code> class contains the usual getters, setters, and other entity methods.</p>
</div>
<div class="paragraph">
<p>The <code>RequestBean</code> class injects the <code>EntityManager</code> generated by the producer method, annotated with the <code>@UserDatabase</code> qualifier:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ConversationScoped</span>
<span class="annotation">@Stateful</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">RequestBean</span> {

    <span class="annotation">@Inject</span>
    <span class="annotation">@UserDatabase</span>
    EntityManager em;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>It then defines two methods, one that creates and persists a single <code>ToDo</code> list item, and another that retrieves all the <code>ToDo</code> items created so far by creating a query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> ToDo createToDo(<span class="predefined-type">String</span> inputString) {
    ToDo toDo = <span class="predefined-constant">null</span>;
    <span class="predefined-type">Date</span> currentTime = <span class="predefined-type">Calendar</span>.getInstance().getTime();

    <span class="keyword">try</span> {
        toDo = <span class="keyword">new</span> ToDo();
        toDo.setTaskText(inputString);
        toDo.setTimeCreated(currentTime);
        em.persist(toDo);
        <span class="keyword">return</span> toDo;
    } <span class="keyword">catch</span> (<span class="exception">Exception</span> e) {
        <span class="keyword">throw</span> <span class="keyword">new</span> EJBException(e.getMessage());
    }
}

<span class="directive">public</span> <span class="predefined-type">List</span>&lt;ToDo&gt; getToDos() {
    <span class="keyword">try</span> {
            <span class="predefined-type">List</span>&lt;ToDo&gt; toDos =
                (<span class="predefined-type">List</span>&lt;ToDo&gt;) em.createQuery(
                <span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT t FROM ToDo t ORDER BY t.timeCreated</span><span class="delimiter">&quot;</span></span>)
                .getResultList();
        <span class="keyword">return</span> toDos;
    } <span class="keyword">catch</span> (<span class="exception">Exception</span> e) {
        <span class="keyword">throw</span> <span class="keyword">new</span> EJBException(e.getMessage());
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="the-producerfields-facelets-pages-and-managed-bean"><a class="anchor" href="#the-producerfields-facelets-pages-and-managed-bean"></a>The producerfields Facelets Pages and Managed Bean</h4>
<div class="paragraph">
<p>The <code>producerfields</code> example has two Facelets pages, <code>index.xhtml</code> and <code>todolist.xhtml</code>.
The simple form on the <code>index.xhtml</code> page asks the user only for the task.
When the user clicks the Submit button, the <code>listBean.createTask</code> method is called.
When the user clicks the Show Items button, the action specifies that the <code>todolist.xhtml</code> file should be displayed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">    <span class="tag">&lt;h:body&gt;</span>
        <span class="tag">&lt;h2&gt;</span>To Do List<span class="tag">&lt;/h2&gt;</span>
        <span class="tag">&lt;p&gt;</span>Enter a task to be completed.<span class="tag">&lt;/p&gt;</span>
        <span class="tag">&lt;h:form</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">todolist</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;p&gt;</span><span class="tag">&lt;h:outputLabel</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Enter a string: </span><span class="delimiter">&quot;</span></span> <span class="attribute-name">for</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">inputString</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;h:inputText</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">inputString</span><span class="delimiter">&quot;</span></span>
                             <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{listBean.inputString}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span><span class="tag">&lt;/p&gt;</span>
            <span class="tag">&lt;p&gt;</span><span class="tag">&lt;h:commandButton</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Submit</span><span class="delimiter">&quot;</span></span>
                                <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{listBean.createTask()}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span><span class="tag">&lt;/p&gt;</span>
            <span class="tag">&lt;p&gt;</span><span class="tag">&lt;h:commandButton</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Show Items</span><span class="delimiter">&quot;</span></span>
                                <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">todolist</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span><span class="tag">&lt;/p&gt;</span>
        <span class="tag">&lt;/h:form&gt;</span>
        ...
    <span class="tag">&lt;/h:body&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The managed bean, <code>web.ListBean</code>, injects the <code>ejb.RequestBean</code> session bean.
It declares the <code>entity.ToDo</code> entity and a list of the entity along with the input string that it passes to the session bean.
The <code>inputString</code> is annotated with the <code>@NotNull</code> Bean Validation constraint, so an attempt to submit an empty string results in an error.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Named</span>
<span class="annotation">@ConversationScoped</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">ListBean</span> <span class="directive">implements</span> <span class="predefined-type">Serializable</span> {

    ...
    <span class="annotation">@EJB</span>
    <span class="directive">private</span> RequestBean request;
    <span class="annotation">@NotNull</span>
    <span class="directive">private</span> <span class="predefined-type">String</span> inputString;
    <span class="directive">private</span> ToDo toDo;
    <span class="directive">private</span> <span class="predefined-type">List</span>&lt;ToDo&gt; toDos;
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>createTask</code> method called by the Submit button calls the <code>createToDo</code> method of <code>RequestBean</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">void</span> createTask() {
    <span class="local-variable">this</span>.toDo = request.createToDo(inputString);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>getToDos</code> method, which is called by the <code>todolist.xhtml</code> page, calls the <code>getToDos</code> method of <code>RequestBean</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="predefined-type">List</span>&lt;ToDo&gt; getToDos() {
    <span class="keyword">return</span> request.getToDos();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To force the Facelets page to recognize an empty string as a null value and return an error, the <code>web.xml</code> file sets the context parameter <code>jakarta.faces.INTERPRET_EMPTY_STRING_SUBMITTED_VALUES_AS_NULL</code> to <code>true</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;context-param&gt;</span>
  <span class="tag">&lt;param-name&gt;</span>jakarta.faces.INTERPRET_EMPTY_STRING_SUBMITTED_VALUES_AS_NULL<span class="tag">&lt;/param-name&gt;</span>
  <span class="tag">&lt;param-value&gt;</span>true<span class="tag">&lt;/param-value&gt;</span>
<span class="tag">&lt;/context-param&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>todolist.xhtml</code> page is a little more complicated than the <code>index.html</code> page.
It contains a <code>dataTable</code> element that displays the contents of the <code>ToDo</code> list.
The body of the page looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">    <span class="tag">&lt;body&gt;</span>
        <span class="tag">&lt;h2&gt;</span>To Do List<span class="tag">&lt;/h2&gt;</span>
        <span class="tag">&lt;h:form</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">showlist</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;h:dataTable</span> <span class="attribute-name">var</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">toDo</span><span class="delimiter">&quot;</span></span>
                         <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{listBean.toDos}</span><span class="delimiter">&quot;</span></span>
                         <span class="attribute-name">rules</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">all</span><span class="delimiter">&quot;</span></span>
                         <span class="attribute-name">border</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>
                         <span class="attribute-name">cellpadding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">5</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;h:column&gt;</span>
                    <span class="tag">&lt;f:facet</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">header</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                        <span class="tag">&lt;h:outputText</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Time Stamp</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
                    <span class="tag">&lt;/f:facet&gt;</span>
                    <span class="tag">&lt;h:outputText</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{toDo.timeCreated}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
                <span class="tag">&lt;/h:column&gt;</span>
                <span class="tag">&lt;h:column&gt;</span>
                    <span class="tag">&lt;f:facet</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">header</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                        <span class="tag">&lt;h:outputText</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Task</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
                    <span class="tag">&lt;/f:facet&gt;</span>
                    <span class="tag">&lt;h:outputText</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{toDo.taskText}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
                <span class="tag">&lt;/h:column&gt;</span>
            <span class="tag">&lt;/h:dataTable&gt;</span>
            <span class="tag">&lt;p&gt;</span><span class="tag">&lt;h:commandButton</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">back</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Back</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">index</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span><span class="tag">&lt;/p&gt;</span>
        <span class="tag">&lt;/h:form&gt;</span>
    <span class="tag">&lt;/body&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The value of the <code>dataTable</code> is <code>listBean.toDos</code>, the list returned by the managed bean&#8217;s <code>getToDos</code> method, which in turn calls the session bean&#8217;s <code>getToDos</code> method.
Each row of the table displays the <code>timeCreated</code> and <code>taskText</code> fields of the individual task.
Finally, a Back button returns the user to the <code>index.xhtml</code> page.</p>
</div>
</div>
<div class="sect3">
<h4 id="running-the-producerfields-example"><a class="anchor" href="#running-the-producerfields-example"></a>Running the producerfields Example</h4>
<div class="paragraph">
<p>You can use either NetBeans IDE or Maven to build, package, deploy, and run the <code>producerfields</code> application.</p>
</div>
<div class="sect4">
<h5 id="to-build-package-and-deploy-the-producerfields-example-using-netbeans-ide"><a class="anchor" href="#to-build-package-and-deploy-the-producerfields-example-using-netbeans-ide"></a>To Build, Package, and Deploy the producerfields Example Using NetBeans IDE</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>If the database server is not already running, start it by following the instructions in <a href="#starting-and-stopping-apache-derby">Starting and Stopping Apache Derby</a>.</p>
</li>
<li>
<p>From the <strong>File</strong> menu, choose <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the <strong>Open Project</strong> dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/cdi</pre>
</div>
</div>
</li>
<li>
<p>Select the <code>producerfields</code> folder.</p>
</li>
<li>
<p>Click <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the <strong>Projects</strong> tab, right-click the <code>producerfields</code> project and select <strong>Build</strong>.</p>
<div class="paragraph">
<p>This command builds and packages the application into a WAR file, <code>producerfields.war</code>, located in the <code>target</code> directory, and then deploys it to GlassFish Server.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-build-package-and-deploy-the-producerfields-example-using-maven"><a class="anchor" href="#to-build-package-and-deploy-the-producerfields-example-using-maven"></a>To Build, Package, and Deploy the producerfields Example Using Maven</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>If the database server is not already running, start it by following the instructions in <a href="#starting-and-stopping-apache-derby">Starting and Stopping Apache Derby</a>.</p>
</li>
<li>
<p>In a terminal window, go to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/cdi/producerfields/</pre>
</div>
</div>
</li>
<li>
<p>Enter the following command to deploy the application:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">mvn install</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command builds and packages the application into a WAR file, <code>producerfields.war</code>, located in the <code>target</code> directory, and then deploys it to GlassFish Server.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-run-the-producerfields-example"><a class="anchor" href="#to-run-the-producerfields-example"></a>To Run the producerfields Example</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In a web browser, enter the following URL:</p>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080/producerfields</pre>
</div>
</div>
</li>
<li>
<p>On the Create To Do List page, enter a string in the field and click Submit.</p>
<div class="paragraph">
<p>You can enter additional strings and click Submit to create a task list with multiple items.</p>
</div>
</li>
<li>
<p>Click Show Items.</p>
<div class="paragraph">
<p>The To Do List page opens, showing the timestamp and text for each item you created.</p>
</div>
</li>
<li>
<p>Click Back to return to the Create To Do List page.</p>
<div class="paragraph">
<p>On this page, you can enter more items in the list.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="the-billpayment-example-using-events-and-interceptors"><a class="anchor" href="#the-billpayment-example-using-events-and-interceptors"></a>The billpayment Example: Using Events and Interceptors</h3>
<div class="paragraph">
<p>The <code>billpayment</code> example shows how to use both events and interceptors.</p>
</div>
<div class="paragraph">
<p>The source files are located in the <code><em>tut-install</em>/examples/cdi/billpayment/src/main/java/ee/jakarta/tutorial/billpayment/</code> directory.</p>
</div>
<div class="sect3">
<h4 id="overview-of-the-billpayment-example"><a class="anchor" href="#overview-of-the-billpayment-example"></a>Overview of the billpayment Example</h4>
<div class="paragraph">
<p>The example simulates paying an amount using a debit card or credit card.
When the user chooses a payment method, the managed bean creates an appropriate event, supplies its payload, and fires it.
A simple event listener handles the event using observer methods.</p>
</div>
<div class="paragraph">
<p>The example also defines an interceptor that is set on a class and on two methods of another class.</p>
</div>
</div>
<div class="sect3">
<h4 id="the-paymentevent-event-class"><a class="anchor" href="#the-paymentevent-event-class"></a>The PaymentEvent Event Class</h4>
<div class="paragraph">
<p>The event class, <code>event.PaymentEvent</code>, is a simple bean class that contains a no-argument constructor.
It also has a <code>toString</code> method and getter and setter methods for the payload components: a <code>String</code> for the payment type, a <code>BigDecimal</code> for the payment amount, and a <code>Date</code> for the timestamp.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">PaymentEvent</span> <span class="directive">implements</span> <span class="predefined-type">Serializable</span> {

    ...
    public <span class="predefined-type">String</span> paymentType;
    <span class="directive">public</span> <span class="predefined-type">BigDecimal</span> value;
    <span class="directive">public</span> <span class="predefined-type">Date</span> datetime;

    <span class="directive">public</span> PaymentEvent() {
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> toString() {
        <span class="keyword">return</span> <span class="local-variable">this</span>.paymentType
                + <span class="string"><span class="delimiter">&quot;</span><span class="content"> = $</span><span class="delimiter">&quot;</span></span> + <span class="local-variable">this</span>.value.toString()
                + <span class="string"><span class="delimiter">&quot;</span><span class="content"> at </span><span class="delimiter">&quot;</span></span> + <span class="local-variable">this</span>.datetime.toString();
    }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The event class is a simple bean that is instantiated by the managed bean using <code>new</code> and then populated.
For this reason, the CDI container cannot intercept the creation of the bean, and hence it cannot allow interception of its getter and setter methods.</p>
</div>
</div>
<div class="sect3">
<h4 id="the-paymenthandler-event-listener"><a class="anchor" href="#the-paymenthandler-event-listener"></a>The PaymentHandler Event Listener</h4>
<div class="paragraph">
<p>The event listener, <code>listener.PaymentHandler</code>, contains two observer methods, one for each of the two event types:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Logged</span>
<span class="annotation">@SessionScoped</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">PaymentHandler</span> <span class="directive">implements</span> <span class="predefined-type">Serializable</span> {

    ...
    public <span class="type">void</span> creditPayment(<span class="annotation">@Observes</span> <span class="annotation">@Credit</span> PaymentEvent event) {
        logger.log(<span class="predefined-type">Level</span>.INFO, <span class="string"><span class="delimiter">&quot;</span><span class="content">PaymentHandler - Credit Handler: {0}</span><span class="delimiter">&quot;</span></span>,
                event.toString());

        <span class="comment">// call a specific Credit handler class...</span>
    }

    <span class="directive">public</span> <span class="type">void</span> debitPayment(<span class="annotation">@Observes</span> <span class="annotation">@Debit</span> PaymentEvent event) {
        logger.log(<span class="predefined-type">Level</span>.INFO, <span class="string"><span class="delimiter">&quot;</span><span class="content">PaymentHandler - Debit Handler: {0}</span><span class="delimiter">&quot;</span></span>,
                event.toString());

        <span class="comment">// call a specific Debit handler class...</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Each observer method takes as an argument the event, annotated with <code>@Observes</code> and with the qualifier for the type of payment.
In a real application, the observer methods would pass the event information on to another component that would perform business logic on the payment.</p>
</div>
<div class="paragraph">
<p>The qualifiers are defined in the <code>payment</code> package, described in <a href="#the-billpayment-facelets-pages-and-managed-bean">The billpayment Facelets Pages and Managed Bean</a>.</p>
</div>
<div class="paragraph">
<p>The <code>PaymentHandler</code> bean is annotated <code>@Logged</code> so that all its methods can be intercepted.</p>
</div>
</div>
<div class="sect3">
<h4 id="the-billpayment-facelets-pages-and-managed-bean"><a class="anchor" href="#the-billpayment-facelets-pages-and-managed-bean"></a>The billpayment Facelets Pages and Managed Bean</h4>
<div class="paragraph">
<p>The <code>billpayment</code> example contains two Facelets pages, <code>index.xhtml</code> and the very simple <code>response.xhtml</code>.
The body of <code>index.xhtml</code> looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">    <span class="tag">&lt;h:body&gt;</span>
        <span class="tag">&lt;h3&gt;</span>Bill Payment Options<span class="tag">&lt;/h3&gt;</span>
        <span class="tag">&lt;p&gt;</span>Enter an amount, select Debit Card or Credit Card,
            then click Pay.<span class="tag">&lt;/p&gt;</span>
        <span class="tag">&lt;h:form&gt;</span>
            <span class="tag">&lt;p&gt;</span>
            <span class="tag">&lt;h:outputLabel</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Amount: $</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">for</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">amt</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;h:inputText</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">amt</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{paymentBean.value}</span><span class="delimiter">&quot;</span></span>
                         <span class="attribute-name">required</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
                         <span class="attribute-name">requiredMessage</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">An amount is required.</span><span class="delimiter">&quot;</span></span>
                         <span class="attribute-name">maxlength</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">15</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
            <span class="tag">&lt;/p&gt;</span>
            <span class="tag">&lt;h:outputLabel</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Options:</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">for</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">opt</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;h:selectOneRadio</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">opt</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{paymentBean.paymentOption}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;f:selectItem</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">debit</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">itemLabel</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Debit Card</span><span class="delimiter">&quot;</span></span>
                              <span class="attribute-name">itemValue</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;f:selectItem</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">credit</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">itemLabel</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Credit Card</span><span class="delimiter">&quot;</span></span>
                              <span class="attribute-name">itemValue</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
            <span class="tag">&lt;/h:selectOneRadio&gt;</span>
            <span class="tag">&lt;p&gt;</span><span class="tag">&lt;h:commandButton</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">submit</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Pay</span><span class="delimiter">&quot;</span></span>
                                <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{paymentBean.pay}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span><span class="tag">&lt;/p&gt;</span>
            <span class="tag">&lt;p&gt;</span><span class="tag">&lt;h:commandButton</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Reset</span><span class="delimiter">&quot;</span></span>
                                <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{paymentBean.reset}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span><span class="tag">&lt;/p&gt;</span>
        <span class="tag">&lt;/h:form&gt;</span>
        ...
    <span class="tag">&lt;/h:body&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The input field takes a payment amount, passed to <code>paymentBean.value</code>.
Two options ask the user to select a Debit Card or Credit Card payment, passing the integer value to <code>paymentBean.paymentOption</code>.
Finally, the Pay command button&#8217;s action is set to the method <code>paymentBean.pay</code>, and the Reset button&#8217;s action is set to the <code>paymentBean.reset</code> method.</p>
</div>
<div class="paragraph">
<p>The <code>payment.PaymentBean</code> managed bean uses qualifiers to differentiate between the two kinds of payment event:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Named</span>
<span class="annotation">@SessionScoped</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">PaymentBean</span> <span class="directive">implements</span> <span class="predefined-type">Serializable</span> {

   ...
    <span class="annotation">@Inject</span>
    <span class="annotation">@Credit</span>
    <span class="predefined-type">Event</span>&lt;PaymentEvent&gt; creditEvent;

    <span class="annotation">@Inject</span>
    <span class="annotation">@Debit</span>
    <span class="predefined-type">Event</span>&lt;PaymentEvent&gt; debitEvent;
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The qualifiers, <code>@Credit</code> and <code>@Debit</code>, are defined in the <code>payment</code> package along with <code>PaymentBean</code>.</p>
</div>
<div class="paragraph">
<p>Next, the <code>PaymentBean</code> defines the properties it obtains from the Facelets page and will pass on to the event:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">static</span> <span class="directive">final</span> <span class="type">int</span> DEBIT = <span class="integer">1</span>;
<span class="directive">public</span> <span class="directive">static</span> <span class="directive">final</span> <span class="type">int</span> CREDIT = <span class="integer">2</span>;
<span class="directive">private</span> <span class="type">int</span> paymentOption = DEBIT;

<span class="annotation">@Digits</span>(integer = <span class="integer">10</span>, fraction = <span class="integer">2</span>, message = <span class="string"><span class="delimiter">&quot;</span><span class="content">Invalid value</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> <span class="predefined-type">BigDecimal</span> value;

<span class="directive">private</span> <span class="predefined-type">Date</span> datetime;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>paymentOption</code> value is an integer passed in from the option component; the default value is <code>DEBIT</code>.
The <code>value</code> is a <code>BigDecimal</code> with a Bean Validation constraint that enforces a currency value with a maximum number of digits.
The timestamp for the event, <code>datetime</code>, is a <code>Date</code> object initialized when the <code>pay</code> method is called.</p>
</div>
<div class="paragraph">
<p>The <code>pay</code> method of the bean first sets the timestamp for this payment event.
It then creates and populates the event payload, using the constructor for the <code>PaymentEvent</code> and calling the event&#8217;s setter methods, using the bean properties as arguments.
It then fires the event.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Logged</span>
<span class="directive">public</span> <span class="predefined-type">String</span> pay() {
    <span class="local-variable">this</span>.setDatetime(<span class="predefined-type">Calendar</span>.getInstance().getTime());
    <span class="keyword">switch</span> (paymentOption) {
        <span class="keyword">case</span> DEBIT:
            PaymentEvent debitPayload = <span class="keyword">new</span> PaymentEvent();
            debitPayload.setPaymentType(<span class="string"><span class="delimiter">&quot;</span><span class="content">Debit</span><span class="delimiter">&quot;</span></span>);
            debitPayload.setValue(value);
            debitPayload.setDatetime(datetime);
            debitEvent.fire(debitPayload);
            <span class="keyword">break</span>;
        <span class="keyword">case</span> CREDIT:
            PaymentEvent creditPayload = <span class="keyword">new</span> PaymentEvent();
            creditPayload.setPaymentType(<span class="string"><span class="delimiter">&quot;</span><span class="content">Credit</span><span class="delimiter">&quot;</span></span>);
            creditPayload.setValue(value);
            creditPayload.setDatetime(datetime);
            creditEvent.fire(creditPayload);
            <span class="keyword">break</span>;
        <span class="keyword">default</span>:
            logger.severe(<span class="string"><span class="delimiter">&quot;</span><span class="content">Invalid payment option!</span><span class="delimiter">&quot;</span></span>);
    }
    <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">response</span><span class="delimiter">&quot;</span></span>;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>pay</code> method returns the page to which the action is redirected, <code>response.xhtml</code>.</p>
</div>
<div class="paragraph">
<p>The <code>PaymentBean</code> class also contains a <code>reset</code> method that empties the value field on the <code>index.xhtml</code> page and sets the payment option to the default:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Logged</span>
<span class="directive">public</span> <span class="type">void</span> reset() {
    setPaymentOption(DEBIT);
    setValue(<span class="predefined-type">BigDecimal</span>.ZERO);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this bean, only the <code>pay</code> and <code>reset</code> methods are intercepted.</p>
</div>
<div class="paragraph">
<p>The <code>response.xhtml</code> page displays the amount paid.
It uses a <code>rendered</code> expression to display the payment method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">    <span class="tag">&lt;h:body&gt;</span>
        <span class="tag">&lt;h:form&gt;</span>
            <span class="tag">&lt;h2&gt;</span>Bill Payment: Result<span class="tag">&lt;/h2&gt;</span>
            <span class="tag">&lt;h3&gt;</span>Amount Paid with
                <span class="tag">&lt;h:outputText</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">debit</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Debit Card: </span><span class="delimiter">&quot;</span></span>
                              <span class="attribute-name">rendered</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{paymentBean.paymentOption eq 1}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
                <span class="tag">&lt;h:outputText</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">credit</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Credit Card: </span><span class="delimiter">&quot;</span></span>
                              <span class="attribute-name">rendered</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{paymentBean.paymentOption eq 2}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
                <span class="tag">&lt;h:outputText</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">result</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{paymentBean.value}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                    <span class="tag">&lt;f:convertNumber</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">currency</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;/h:outputText&gt;</span>
            <span class="tag">&lt;/h3&gt;</span>
            <span class="tag">&lt;p&gt;</span><span class="tag">&lt;h:commandButton</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">back</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Back</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">index</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span><span class="tag">&lt;/p&gt;</span>
        <span class="tag">&lt;/h:form&gt;</span>
    <span class="tag">&lt;/h:body&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="the-loggedinterceptor-interceptor-class"><a class="anchor" href="#the-loggedinterceptor-interceptor-class"></a>The LoggedInterceptor Interceptor Class</h4>
<div class="paragraph">
<p>The interceptor class, <code>LoggedInterceptor</code>, and its interceptor binding, <code>Logged</code>, are both defined in the <code>interceptor</code> package.
The <code>Logged</code> interceptor binding is defined as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inherited</span>
<span class="annotation">@InterceptorBinding</span>
<span class="annotation">@Retention</span>(RUNTIME)
<span class="annotation">@Target</span>({METHOD, TYPE})
<span class="directive">public</span> <span class="annotation">@interface</span> Logged {
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>LoggedInterceptor</code> class looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Logged</span>
<span class="annotation">@Interceptor</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">LoggedInterceptor</span> <span class="directive">implements</span> <span class="predefined-type">Serializable</span> {

    ...

    public LoggedInterceptor() {
    }

    <span class="annotation">@AroundInvoke</span>
    <span class="directive">public</span> <span class="predefined-type">Object</span> logMethodEntry(InvocationContext invocationContext)
            <span class="directive">throws</span> <span class="exception">Exception</span> {
        <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Entering method: </span><span class="delimiter">&quot;</span></span>
                + invocationContext.getMethod().getName() + <span class="string"><span class="delimiter">&quot;</span><span class="content"> in class </span><span class="delimiter">&quot;</span></span>
                + invocationContext.getMethod().getDeclaringClass().getName());

        <span class="keyword">return</span> invocationContext.proceed();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The class is annotated with both the <code>@Logged</code> and the <code>@Interceptor</code> annotations.
The <code>@AroundInvoke</code> method, <code>logMethodEntry</code>, takes the required <code>InvocationContext</code> argument and calls the required <code>proceed</code> method.
When a method is intercepted, <code>logMethodEntry</code> displays the name of the method being invoked as well as its class.</p>
</div>
<div class="paragraph">
<p>To enable the interceptor, the <code>beans.xml</code> file defines it as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;interceptors&gt;</span>
    <span class="tag">&lt;class&gt;</span>ee.jakarta.tutorial.billpayment.interceptor.LoggedInterceptor<span class="tag">&lt;/class&gt;</span>
<span class="tag">&lt;/interceptors&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this application, the <code>PaymentEvent</code> and <code>PaymentHandler</code> classes are annotated <code>@Logged</code>, so all their methods are intercepted.
In <code>PaymentBean</code>, only the <code>pay</code> and <code>reset</code> methods are annotated <code>@Logged</code>, so only those methods are intercepted.</p>
</div>
</div>
<div class="sect3">
<h4 id="running-the-billpayment-example"><a class="anchor" href="#running-the-billpayment-example"></a>Running the billpayment Example</h4>
<div class="paragraph">
<p>You can use either NetBeans IDE or Maven to build, package, deploy, and run the <code>billpayment</code> application.</p>
</div>
<div class="sect4">
<h5 id="to-build-package-and-deploy-the-billpayment-example-using-netbeans-ide"><a class="anchor" href="#to-build-package-and-deploy-the-billpayment-example-using-netbeans-ide"></a>To Build, Package, and Deploy the billpayment Example Using NetBeans IDE</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>From the <strong>File</strong> menu, choose <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the <strong>Open Project</strong> dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/cdi</pre>
</div>
</div>
</li>
<li>
<p>Select the <code>billpayment</code> folder.</p>
</li>
<li>
<p>Click <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the <strong>Projects</strong> tab, right-click the <code>billpayment</code> project and select <strong>Build</strong>.</p>
<div class="paragraph">
<p>This command builds and packages the application into a WAR file, <code>billpayment.war</code>, located in the <code>target</code> directory, and then deploys it to GlassFish Server.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-build-package-and-deploy-the-billpayment-example-using-maven"><a class="anchor" href="#to-build-package-and-deploy-the-billpayment-example-using-maven"></a>To Build, Package, and Deploy the billpayment Example Using Maven</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>In a terminal window, go to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/cdi/billpayment/</pre>
</div>
</div>
</li>
<li>
<p>Enter the following command to deploy the application:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">mvn install</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command builds and packages the application into a WAR file, <code>billpayment.war</code>, located in the <code>target</code> directory, and then deploys it to GlassFish Server.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-run-the-billpayment-example"><a class="anchor" href="#to-run-the-billpayment-example"></a>To Run the billpayment Example</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In a web browser, enter the following URL:</p>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080/billpayment</pre>
</div>
</div>
</li>
<li>
<p>On the Bill Payment Options page, enter a value in the Amount field.</p>
<div class="paragraph">
<p>The amount can contain up to 10 digits and include up to two decimal places.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>9876.54</pre>
</div>
</div>
</li>
<li>
<p>Select Debit Card or Credit Card and click Pay.</p>
<div class="paragraph">
<p>The Bill Payment: Result page opens, displaying the amount paid and the method of payment:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Amount Paid with Credit Card: $9,876.34</pre>
</div>
</div>
</li>
<li>
<p>Click Back to return to the Bill Payment Options page.</p>
<div class="paragraph">
<p>You can also click Reset to return to the initial page values.</p>
</div>
</li>
<li>
<p>Examine the server log output.</p>
<div class="paragraph">
<p>In NetBeans IDE, the output is visible in the GlassFish Server Output tab.
Otherwise, view <code><em>domain-dir</em>/logs/server.log</code>.</p>
</div>
<div class="paragraph">
<p>The output from each interceptor appears in the log, followed by the additional logger output defined by the constructor and methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>INFO: Entering method: pay in class billpayment.payment.PaymentBean
INFO: PaymentHandler created.
INFO: Entering method: debitPayment in class billpayment.listener.PaymentHandler
INFO: PaymentHandler - Debit Handler: Debit = $1234.56 at Tue Dec 14 14:50:28 EST 2010</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="the-decorators-example-decorating-a-bean"><a class="anchor" href="#the-decorators-example-decorating-a-bean"></a>The decorators Example: Decorating a Bean</h3>
<div class="paragraph">
<p>The <code>decorators</code> example, which is yet another variation on the <code>encoder</code> example, shows how to use a decorator to implement additional business logic for a bean.</p>
</div>
<div class="paragraph">
<p>The source files are located in the <code><em>tut-install</em>/examples/cdi/decorators/src/main/java/ee/jakarta/tutorial/decorators/</code> directory.</p>
</div>
<div class="sect3">
<h4 id="overview-of-the-decorators-example"><a class="anchor" href="#overview-of-the-decorators-example"></a>Overview of the decorators Example</h4>
<div class="paragraph">
<p>Instead of having the user choose between two alternative implementations of an interface at deployment time or runtime, a decorator adds some additional logic to a single implementation of the interface.</p>
</div>
<div class="paragraph">
<p>The example includes an interface, an implementation of it, a decorator, an interceptor, a managed bean, a Facelets page, and configuration files.</p>
</div>
</div>
<div class="sect3">
<h4 id="components-of-the-decorators-example"><a class="anchor" href="#components-of-the-decorators-example"></a>Components of the decorators Example</h4>
<div class="paragraph">
<p>The <code>decorators</code> example is very similar to the <code>encoder</code> example described in <a href="#the-encoder-example-using-alternatives">The encoder Example: Using Alternatives</a>.
Instead of providing two implementations of the <code>Coder</code> interface, however, this example provides only the <code>CoderImpl</code> class.
The decorator class, <code>CoderDecorator</code>, rather than simply return the coded string, displays the input and output strings' values and length.</p>
</div>
<div class="paragraph">
<p>The <code>CoderDecorator</code> class, like <code>CoderImpl</code>, implements the business method of the <code>Coder</code> interface, <code>codeString</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Decorator</span>
<span class="directive">public</span> <span class="directive">abstract</span> <span class="type">class</span> <span class="class">CoderDecorator</span> <span class="directive">implements</span> Coder {

    <span class="annotation">@Inject</span>
    <span class="annotation">@Delegate</span>
    <span class="annotation">@Any</span>
    Coder coder;

    <span class="directive">public</span> <span class="predefined-type">String</span> codeString(<span class="predefined-type">String</span> s, <span class="type">int</span> tval) {
        <span class="type">int</span> len = s.length();

        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="char">\&quot;</span><span class="delimiter">&quot;</span></span> + s + <span class="string"><span class="delimiter">&quot;</span><span class="char">\&quot;</span><span class="content"> becomes </span><span class="delimiter">&quot;</span></span> + <span class="string"><span class="delimiter">&quot;</span><span class="char">\&quot;</span><span class="delimiter">&quot;</span></span> + coder.codeString(s, tval)
                + <span class="string"><span class="delimiter">&quot;</span><span class="char">\&quot;</span><span class="content">, </span><span class="delimiter">&quot;</span></span> + len + <span class="string"><span class="delimiter">&quot;</span><span class="content"> characters in length</span><span class="delimiter">&quot;</span></span>;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The decorator&#8217;s <code>codeString</code> method calls the delegate object&#8217;s <code>codeString</code> method to perform the actual encoding.</p>
</div>
<div class="paragraph">
<p>The <code>decorators</code> example includes the <code>Logged</code> interceptor binding and <code>LoggedInterceptor</code> class from the <code>billpayment</code> example.
For this example, the interceptor is set on the <code>CoderBean.encodeString</code> method and the <code>CoderImpl.codeString</code> method.
The interceptor code is unchanged; interceptors are usually reusable for different applications.</p>
</div>
<div class="paragraph">
<p>Except for the interceptor annotations, the <code>CoderBean</code> and <code>CoderImpl</code> classes are identical to the versions in the <code>encoder</code> example.</p>
</div>
<div class="paragraph">
<p>The <code>beans.xml</code> file specifies both the decorator and the interceptor:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;decorators&gt;</span>
    <span class="tag">&lt;class&gt;</span>ee.jakarta.tutorial.decorators.CoderDecorator<span class="tag">&lt;/class&gt;</span>
<span class="tag">&lt;/decorators&gt;</span>
<span class="tag">&lt;interceptors&gt;</span>
    <span class="tag">&lt;class&gt;</span>ee.jakarta.tutorial.decorators.LoggedInterceptor<span class="tag">&lt;/class&gt;</span>
<span class="tag">&lt;/interceptors&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="running-the-decorators-example"><a class="anchor" href="#running-the-decorators-example"></a>Running the decorators Example</h4>
<div class="paragraph">
<p>You can use either NetBeans IDE or Maven to build, package, deploy, and run the <code>decorators</code> application.</p>
</div>
<div class="sect4">
<h5 id="to-build-package-and-deploy-the-decorators-example-using-netbeans-ide"><a class="anchor" href="#to-build-package-and-deploy-the-decorators-example-using-netbeans-ide"></a>To Build, Package, and Deploy the decorators Example Using NetBeans IDE</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>From the <strong>File</strong> menu, choose <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the <strong>Open Project</strong> dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/cdi</pre>
</div>
</div>
</li>
<li>
<p>Select the <code>decorators</code> folder.</p>
</li>
<li>
<p>Click <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the <strong>Projects</strong> tab, right-click the <code>decorators</code> project and select <strong>Build</strong>.</p>
<div class="paragraph">
<p>This command builds and packages the application into a WAR file, <code>decorators.war</code>, located in the <code>target</code> directory, and then deploys it to GlassFish Server.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-build-package-and-deploy-the-decorators-example-using-maven"><a class="anchor" href="#to-build-package-and-deploy-the-decorators-example-using-maven"></a>To Build, Package, and Deploy the decorators Example Using Maven</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>In a terminal window, go to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/cdi/decorators/</pre>
</div>
</div>
</li>
<li>
<p>Enter the following command to deploy the application:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">mvn install</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command builds and packages the application into a WAR file, <code>decorators.war</code>, located in the <code>target</code> directory, and then deploys it to GlassFish Server.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-run-the-decorators-example"><a class="anchor" href="#to-run-the-decorators-example"></a>To Run the decorators Example</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In a web browser, enter the following URL:</p>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080/decorators</pre>
</div>
</div>
</li>
<li>
<p>On the Decorated String Encoder page, enter a string and the number of letters to shift by, and then click Encode.</p>
<div class="paragraph">
<p>The output from the decorator method appears in blue on the Result line.
For example, if you entered <code>Java</code> and <code>4</code>, you would see the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>"Java" becomes "Neze", 4 characters in length</pre>
</div>
</div>
</li>
<li>
<p>Examine the server log output.</p>
<div class="paragraph">
<p>In NetBeans IDE, the output is visible in the GlassFish Server Output tab.
Otherwise, view <code><em>domain-dir</em>/logs/server.log</code>.</p>
</div>
<div class="paragraph">
<p>The output from the interceptors appears:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>INFO: Entering method: encodeString in class ee.jakarta.tutorial.decorators.CoderBean
INFO: Entering method: codeString in class ee.jakarta.tutorial.decorators.CoderImpl</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
</div>
<h1 id="web-services" class="sect0"><a class="anchor" href="#web-services"></a>Part VI: Web Services</h1>
<div class="openblock partintro">
<div class="content">
Part VI explores web services.
</div>
</div>
<div class="sect1">
<h2 id="introduction-to-web-services"><a class="anchor" href="#introduction-to-web-services"></a>Chapter 30. Introduction to Web Services</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This part of the tutorial discusses Jakarta EE web services technologies.
These technologies include Jakarta XML Web Services and Jakarta RESTful Web Services.</p>
</div>
<div class="sect2">
<h3 id="what-are-web-services"><a class="anchor" href="#what-are-web-services"></a>What Are Web Services?</h3>
<div class="paragraph">
<p>Web services are client and server applications that communicate over the World Wide Web&#8217;s (WWW) HyperText Transfer Protocol (HTTP).
As described by the World Wide Web Consortium (W3C), web services provide a standard means of interoperating between software applications running on a variety of platforms and frameworks.
Web services are characterized by their great interoperability and extensibility as well as their machine-processable descriptions, thanks to the use of XML.
Web services can be combined in a loosely coupled way to achieve complex operations.
Programs providing simple services can interact with each other to deliver sophisticated added-value services.</p>
</div>
</div>
<div class="sect2">
<h3 id="types-of-web-services"><a class="anchor" href="#types-of-web-services"></a>Types of Web Services</h3>
<div class="paragraph">
<p>On the conceptual level, a service is a software component provided through a network-accessible endpoint.
The service consumer and provider use messages to exchange invocation request and response information in the form of self-containing documents that make very few assumptions about the technological capabilities of the receiver.</p>
</div>
<div class="paragraph">
<p>On a technical level, web services can be implemented in various ways.
The two types of web services discussed in this section can be distinguished as "big" web services and "RESTful" web services.</p>
</div>
<div class="sect3">
<h4 id="big-web-services"><a class="anchor" href="#big-web-services"></a>"Big" Web Services</h4>
<div class="paragraph">
<p>Jakarta XML Web Services provides the functionality for "big" web services, which are described in <a href="#building-web-services-with-jakarta-xml-web-services">Chapter 31, <em>Building Web Services with Jakarta XML Web Services</em></a>.
Big web services use XML messages that follow the Simple Object Access Protocol (SOAP) standard, an XML language defining a message architecture and message formats.
Such systems often contain a machine-readable description of the operations offered by the service, written in the Web Services Description Language (WSDL), an XML language for defining interfaces syntactically.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Historically the Java API for XML Web Services (JAX-WS) was moved to Java SE 8 but was later removed in Java SE 11.
Jakarta XML Web Services is now included in the Jakarta EE platform as an optional technology under the <code>jakarta</code> namespace.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The SOAP message format and the WSDL interface definition language have gained widespread adoption.
Many development tools, such as NetBeans IDE, can reduce the complexity of developing web service applications.</p>
</div>
<div class="paragraph">
<p>A SOAP-based design must include the following elements.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A formal contract must be established to describe the interface that the web service offers.
WSDL can be used to describe the details of the contract, which may include messages, operations, bindings, and the location of the web service.
You may also process SOAP messages in a JAX-WS service without publishing a WSDL.</p>
</li>
<li>
<p>The architecture must address complex nonfunctional requirements.
Many web service specifications address such requirements and establish a common vocabulary for them.
Examples include transactions, security, addressing, trust, coordination, and so on.</p>
</li>
<li>
<p>The architecture needs to handle asynchronous processing and invocation.
In such cases, the infrastructure provided by standards, such as Web Services Reliable Messaging (WSRM), and APIs, such as JAX-WS, with their client-side asynchronous invocation support, can be leveraged out of the box.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="restful-web-services"><a class="anchor" href="#restful-web-services"></a>RESTful Web Services</h4>
<div class="paragraph">
<p>In Jakarta EE, Jakarta RESTful Web Services provides the functionality for Representational State Transfer (RESTful) web services.
REST is well suited for basic, ad hoc integration scenarios.
RESTful web services, often better integrated with HTTP than SOAP-based services are, do not require XML messages or WSDL service-API definitions.</p>
</div>
<div class="paragraph">
<p>Project Jersey is a production-ready implementation for the Jakarta RESTful Web Services specification.
Jersey implements support for the annotations defined in the Jakarta RESTful Web Services specification, making it easy for developers to build RESTful web services with Java and the Java Virtual Machine (JVM).</p>
</div>
<div class="paragraph">
<p>Because RESTful web services use existing well-known W3C and Internet Engineering Task Force (IETF) standards (HTTP, XML, URI, MIME) and have a lightweight infrastructure that allows services to be built with minimal tooling, developing RESTful web services is inexpensive and thus has a very low barrier for adoption.
You can use a development tool such as NetBeans IDE to further reduce the complexity of developing RESTful web services.</p>
</div>
<div class="paragraph">
<p>A RESTful design may be appropriate when the following conditions are met.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The web services are completely stateless.
A good test is to consider whether the interaction can survive a restart of the server.</p>
</li>
<li>
<p>A caching infrastructure can be leveraged for performance.
If the data that the web service returns is not dynamically generated and can be cached, the caching infrastructure that web servers and other intermediaries inherently provide can be leveraged to improve performance.
However, the developer must take care because such caches are limited to the HTTP <code>GET</code> method for most servers.</p>
</li>
<li>
<p>The service producer and service consumer have a mutual understanding of the context and content being passed along.
Because there is no formal way to describe the web services interface, both parties must agree out of band on the schemas that describe the data being exchanged and on ways to process it meaningfully.
In the real world, most commercial applications that expose services as RESTful implementations also distribute so-called value-added toolkits that describe the interfaces to developers in popular programming languages.</p>
</li>
<li>
<p>Bandwidth is particularly important and needs to be limited.
REST is particularly useful for limited-profile devices, such as PDAs and mobile phones, for which the overhead of headers and additional layers of SOAP elements on the XML payload must be restricted.</p>
</li>
<li>
<p>Web service delivery or aggregation into existing websites can be enabled easily with a RESTful style.
Developers can use such technologies as JAX-RS and Asynchronous JavaScript with XML (Ajax) and such toolkits as Direct Web Remoting (DWR) to consume the services in their web applications.
Rather than starting from scratch, services can be exposed with XML and consumed by HTML pages without significantly refactoring the existing website architecture.
Existing developers will be more productive because they are adding to something they are already familiar with rather than having to start from scratch with new technology.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>RESTful web services are discussed in <a href="#building-restful-web-services-with-jakarta-rest">Chapter 32, <em>Building RESTful Web Services with Jakarta REST</em></a>.
This chapter contains information about generating the skeleton of a RESTful web service using both NetBeans IDE and the Maven project-management tool.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="deciding-which-type-of-web-service-to-use"><a class="anchor" href="#deciding-which-type-of-web-service-to-use"></a>Deciding Which Type of Web Service to Use</h3>
<div class="paragraph">
<p>Basically, you want to use RESTful web services for integration over the web and big web services in enterprise applicationintegration scenarios that have advanced quality-of-service (QoS) requirements.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Jakarta XML Web Services</dt>
<dd>
<p>Addresses advanced QoS requirements that commonly occur in enterprise computing.
When compared to Jakarta RESTful Web Services, XML Web Services makes it easier to support the WS-* set of protocols, which provide standards for security and reliability, among other things, and interoperate with other WS-* conforming clients and servers.</p>
</dd>
<dt class="hdlist1">Jakarta RESTful Web Services</dt>
<dd>
<p>Makes it easier to write web applications that apply some or all of the constraints of the REST style to induce desirable properties in the application, such as loose coupling (evolving the server is easier without breaking existing clients), scalability (start small and grow), and architectural simplicity (use off-the-shelf components, such as proxies or HTTP routers).
You would choose to use Jakarta RESTful Web Services for your web application because it is easier for many types of clients to consume RESTful web services while enabling the server side to evolve and scale.
Clients can choose to consume some or all aspects of the service and mash it up with other web-based services.</p>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="building-web-services-with-jakarta-xml-web-services"><a class="anchor" href="#building-web-services-with-jakarta-xml-web-services"></a>Chapter 31. Building Web Services with Jakarta XML Web Services</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter describes Jakarta XML Web Services, a technology for building web services and clients that communicate using XML.
XML Web Services allows developers to write message-oriented as well as Remote Procedure Calloriented (RPC-oriented) web services.</p>
</div>
<div class="sect2">
<h3 id="overview-of-jakarta-xml-web-services"><a class="anchor" href="#overview-of-jakarta-xml-web-services"></a>Overview of Jakarta XML Web Services</h3>
<div class="paragraph">
<p>In Jakarta XML Web Services, a web service operation invocation is represented by an XML-based protocol, such as SOAP.
The SOAP specification defines the envelope structure, encoding rules, and conventions for representing web service invocations and responses.
These calls and responses are transmitted as SOAP messages (XML files) over HTTP.</p>
</div>
<div class="paragraph">
<p>Although SOAP messages are complex, the XML Web Services API hides this complexity from the application developer.
On the server side, the developer specifies the web service operations by defining methods in an interface written in the Java programming language.
The developer also codes one or more classes that implement those methods.
Client programs are also easy to code.
A client creates a proxy (a local object representing the service) and then simply invokes methods on the proxy.
With XML Web Services, the developer does not generate or parse SOAP messages.
It is the XML Web Services runtime system that converts the API calls and responses to and from SOAP messages.</p>
</div>
<div class="paragraph">
<p>With XML Web Services, clients and web services have a big advantage: the platform independence of the Java programming language.
In addition, XML Web Services is not restrictive: A XML Web Services client can access a web service that is not running on the Java platform and vice versa.
This flexibility is possible because XML Web Services uses technologies defined by the W3C: HTTP, SOAP, and WSDL.
WSDL specifies an XML format for describing a service as a set of endpoints operating on messages.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Several files in the XML Web Services examples depend on the port that you specified when you installed GlassFish Server.
These tutorial examples assume that the server runs on the default port, 8080.
They do not run with a nondefault port setting.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="creating-a-simple-web-service-and-clients-with-xml-web-services"><a class="anchor" href="#creating-a-simple-web-service-and-clients-with-xml-web-services"></a>Creating a Simple Web Service and Clients with XML Web Services</h3>
<div class="paragraph">
<p>This section shows how to build and deploy a simple web service and two clients: an application client and a web client.
The source code for the service is in the <code><em>tut-install</em>/examples/jaxws/helloservice-war/</code> directory, and the clients are in the <code><em>tut-install</em>/examples/jaxws/hello-appclient/</code> and <code><em>tut-install</em>/examples/jaxws/hello-webclient/</code> directories.</p>
</div>
<div class="paragraph">
<p><a href="#communication-between-a-xml-web-service-and-a-client">Figure 31-1</a> illustrates how XML Web Services technology manages communication between a web service and a client.</p>
</div>
<div id="communication-between-a-xml-web-service-and-a-client" class="imageblock">
<div class="content">
<img src="images/jakartaeett_dt_019.svg" alt="Diagram showing a client and web service communicating through a SOAP message.">
</div>
<div class="title">Figure 31-1 Communication between a XML Web Service and a Client</div>
</div>
<div class="paragraph">
<p>The starting point for developing a XML Web Services web service is a Java class annotated with the <code>jakarta.jws.WebService</code> annotation.
The <code>@WebService</code> annotation defines the class as a web service endpoint.</p>
</div>
<div class="paragraph">
<p>A service endpoint interface or service endpoint implementation (SEI) is a Java interface or class, respectively, that declares the methods that a client can invoke on the service.
An interface is not required when building a XML Web Services endpoint.
The web service implementation class implicitly defines an SEI.</p>
</div>
<div class="paragraph">
<p>You may specify an explicit interface by adding the <code>endpointInterface</code> element to the <code>@WebService</code> annotation in the implementation class.
You must then provide an interface that defines the public methods made available in the endpoint implementation class.</p>
</div>
<div class="sect3">
<h4 id="basic-steps-for-creating-a-web-service-and-client"><a class="anchor" href="#basic-steps-for-creating-a-web-service-and-client"></a>Basic Steps for Creating a Web Service and Client</h4>
<div class="paragraph">
<p>The basic steps for creating a web service and client are as follows.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Code the implementation class.</p>
</li>
<li>
<p>Compile the implementation class.</p>
</li>
<li>
<p>Package the files into a WAR file.</p>
</li>
<li>
<p>Deploy the WAR file.
The web service artifacts, which are used to communicate with clients, are generated by GlassFish Server during deployment.</p>
</li>
<li>
<p>Code the client class.</p>
</li>
<li>
<p>Use the <code>wsimport</code> Maven goal to generate and compile the web service artifacts needed to connect to the service.</p>
</li>
<li>
<p>Compile the client class.</p>
</li>
<li>
<p>Run the client.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If you use NetBeans IDE to create a service and client, the IDE performs the <code>wsimport</code> task for you.</p>
</div>
<div class="paragraph">
<p>The sections that follow cover these steps in greater detail.</p>
</div>
</div>
<div class="sect3">
<h4 id="requirements-of-a-xml-web-services-endpoint"><a class="anchor" href="#requirements-of-a-xml-web-services-endpoint"></a>Requirements of a XML Web Services Endpoint</h4>
<div class="paragraph">
<p>XML Web Services endpoints must follow these requirements.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The implementing class must be annotated with either the <code>jakarta.jws.WebService</code> or the <code>jakarta.jws.WebServiceProvider</code> annotation.</p>
</li>
<li>
<p>The implementing class may explicitly reference an SEI through the <code>endpointInterface</code> element of the <code>@WebService</code> annotation but is not required to do so.
If no <code>endpointInterface</code> is specified in <code>@WebService</code>, an SEI is implicitly defined for the implementing class.</p>
</li>
<li>
<p>The business methods of the implementing class must be public and must not be declared <code>static</code> or <code>final</code>.</p>
</li>
<li>
<p>Business methods that are exposed to web service clients must be annotated with <code>jakarta.jws.WebMethod</code>.</p>
</li>
<li>
<p>Business methods that are exposed to web service clients must have Jakarta XML Binding-compatible parameters and return types.
See the list of Jakarta XML Binding default data type bindings in <a href="#types-supported-by-xml-web-services">Types Supported by XML Web Services</a>.</p>
</li>
<li>
<p>The implementing class must not be declared <code>final</code> and must not be <code>abstract</code>.</p>
</li>
<li>
<p>The implementing class must have a default public constructor.</p>
</li>
<li>
<p>The implementing class must not define the <code>finalize</code> method.</p>
</li>
<li>
<p>The implementing class may use the <code>jakarta.annotation.PostConstruct</code> or the <code>jakarta.annotation.PreDestroy</code> annotations on its methods for lifecycle event callbacks.</p>
<div class="paragraph">
<p>The <code>@PostConstruct</code> method is called by the container before the implementing class begins responding to web service clients.</p>
</div>
<div class="paragraph">
<p>The <code>@PreDestroy</code> method is called by the container before the endpoint is removed from operation.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="coding-the-service-endpoint-implementation-class"><a class="anchor" href="#coding-the-service-endpoint-implementation-class"></a>Coding the Service Endpoint Implementation Class</h4>
<div class="paragraph">
<p>In this example, the implementation class, <code>Hello</code>, is annotated as a web service endpoint using the <code>@WebService</code> annotation.
<code>Hello</code> declares a single method named <code>sayHello</code>, annotated with the <code>@WebMethod</code> annotation, which exposes the annotated method to web service clients.
The <code>sayHello</code> method returns a greeting to the client, using the name passed to it to compose the greeting.
The implementation class also must define a default, public, no-argument constructor.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">ee.jakarta.tutorial.helloservice</span>;

<span class="keyword">import</span> <span class="include">jakarta.jws.WebService</span>;
<span class="keyword">import</span> <span class="include">jakarta.jws.WebMethod</span>;

<span class="annotation">@WebService</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Hello</span> {
    <span class="directive">private</span> <span class="directive">final</span> <span class="predefined-type">String</span> message = <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello, </span><span class="delimiter">&quot;</span></span>;

    <span class="directive">public</span> Hello() {
    }

    <span class="annotation">@WebMethod</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> sayHello(<span class="predefined-type">String</span> name) {
        <span class="keyword">return</span> message + name + <span class="string"><span class="delimiter">&quot;</span><span class="content">.</span><span class="delimiter">&quot;</span></span>;
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="building-packaging-and-deploying-the-service"><a class="anchor" href="#building-packaging-and-deploying-the-service"></a>Building, Packaging, and Deploying the Service</h4>
<div class="paragraph">
<p>You can use either NetBeans IDE or Maven to build, package, and deploy the <code>helloservice-war</code> application.</p>
</div>
<div class="sect4">
<h5 id="to-build-package-and-deploy-the-service-using-netbeans-ide"><a class="anchor" href="#to-build-package-and-deploy-the-service-using-netbeans-ide"></a>To Build, Package, and Deploy the Service Using NetBeans IDE</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>From the <strong>File</strong> menu, choose <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the <strong>Open Project</strong> dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/jaxws</pre>
</div>
</div>
</li>
<li>
<p>Select the <code>helloservice-war</code> folder.</p>
</li>
<li>
<p>Click <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the <strong>Projects</strong> tab, right-click the <code>helloservice-war</code> project and select <strong>Run</strong>.</p>
<div class="paragraph">
<p>This command builds and packages the application into a WAR file, <code>helloservice-war.war</code>, located in <code><em>tut-install</em>/examples/jaxws/helloservice-war/target/</code>, and deploys this WAR file to your GlassFish Server instance.
It also opens the web service test interface at the URL shown in <a href="#to-test-the-service-without-a-client">To Test the Service without a Client</a>.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>You can view the WSDL file of the deployed service by requesting the URL <a href="http://localhost:8080/helloservice-war/HelloService?wsdl" class="bare" target="_blank" rel="noopener">http://localhost:8080/helloservice-war/HelloService?wsdl</a> in a web browser.
Now you are ready to create a client that accesses this service.</p>
</div>
</div>
<div class="sect4">
<h5 id="to-build-package-and-deploy-the-service-using-maven"><a class="anchor" href="#to-build-package-and-deploy-the-service-using-maven"></a>To Build, Package, and Deploy the Service Using Maven</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>In a terminal window, go to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/jaxws/helloservice-war/</pre>
</div>
</div>
</li>
<li>
<p>Enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">mvn install</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command builds and packages the application into a WAR file, <code>helloservice-war.war</code>, located in the <code>target</code> directory, and then deploys the WAR to GlassFish Server.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>You can view the WSDL file of the deployed service by requesting the URL <a href="http://localhost:8080/helloservice-war/HelloService?wsdl" class="bare" target="_blank" rel="noopener">http://localhost:8080/helloservice-war/HelloService?wsdl</a> in a web browser.
Now you are ready to create a client that accesses this service.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="testing-the-methods-of-a-web-service-endpoint"><a class="anchor" href="#testing-the-methods-of-a-web-service-endpoint"></a>Testing the Methods of a Web Service Endpoint</h4>
<div class="paragraph">
<p>GlassFish Server allows you to test the methods of a web service endpoint.</p>
</div>
<div class="sect4">
<h5 id="to-test-the-service-without-a-client"><a class="anchor" href="#to-test-the-service-without-a-client"></a>To Test the Service without a Client</h5>
<div class="paragraph">
<p>To test the <code>sayHello</code> method of <code>HelloService</code>, follow these steps.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open the web service test interface by entering the following URL in a web browser:</p>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080/helloservice-war/HelloService?Tester</pre>
</div>
</div>
</li>
<li>
<p>Under Methods, enter a name as the parameter to the <code>sayHello</code> method.</p>
</li>
<li>
<p>Click sayHello.</p>
<div class="paragraph">
<p>This takes you to the <code>sayHello</code> Method invocation page.</p>
</div>
<div class="paragraph">
<p>Under Method returned, you&#8217;ll see the response from the endpoint.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="a-simple-xml-web-services-application-client"><a class="anchor" href="#a-simple-xml-web-services-application-client"></a>A Simple XML Web Services Application Client</h4>
<div class="paragraph">
<p>The <code>HelloAppClient</code> class is a stand-alone application client that accesses the <code>sayHello</code> method of <code>HelloService</code>.
This call is made through a port, a local object that acts as a proxy for the remote service.
The port is created at development time by the <code>wsimport</code> Maven goal, which generates XML Web Services portable artifacts based on a WSDL file.</p>
</div>
<div class="sect4">
<h5 id="coding-the-application-client"><a class="anchor" href="#coding-the-application-client"></a>Coding the Application Client</h5>
<div class="paragraph">
<p>When invoking the remote methods on the port, the client performs these steps.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>It uses the generated <code>helloservice.endpoint.HelloService</code> class, which represents the service at the URI of the deployed service&#8217;s WSDL file:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">ee.jakarta.tutorial.helloservice.endpoint.HelloService</span>;
<span class="keyword">import</span> <span class="include">jakarta.xml.ws.WebServiceRef</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">HelloAppClient</span> {
    <span class="annotation">@WebServiceRef</span>(wsdlLocation =
      <span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8080/helloservice-war/HelloService?WSDL</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">private</span> <span class="directive">static</span> HelloService service;
    ...
}</code></pre>
</div>
</div>
</li>
<li>
<p>It retrieves a proxy to the service, also known as a port, by invoking <code>getHelloPort</code> on the service:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ee.jakarta.tutorial.helloservice.endpoint.Hello port = service.getHelloPort();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The port implements the SEI defined by the service.</p>
</div>
</li>
<li>
<p>It invokes the port&#8217;s <code>sayHello</code> method, passing a string to the service:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">return</span> port.sayHello(arg0);</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Here is the full source of <code>HelloAppClient.java</code>, which is located in the <code><em>tut-install</em>/examples/jaxws/hello-appclient/src/main/java/ee/jakarta/tutorial/hello/appclient/</code> directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">ee.jakarta.tutorial.hello.appclient</span>;

<span class="keyword">import</span> <span class="include">ee.jakarta.tutorial.helloservice.endpoint.HelloService</span>;
<span class="keyword">import</span> <span class="include">jakarta.xml.ws.WebServiceRef</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">HelloAppClient</span> {
    <span class="annotation">@WebServiceRef</span>(wsdlLocation =
      <span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8080/helloservice-war/HelloService?WSDL</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">private</span> <span class="directive">static</span> HelloService service;

    <span class="comment">/**
     * @param args the command line arguments
     */</span>
    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) {
       <span class="predefined-type">System</span>.out.println(sayHello(<span class="string"><span class="delimiter">&quot;</span><span class="content">world</span><span class="delimiter">&quot;</span></span>));
    }

    <span class="directive">private</span> <span class="directive">static</span> <span class="predefined-type">String</span> sayHello(java.lang.String arg0) {
        ee.jakarta.tutorial.helloservice.endpoint.Hello port =
                service.getHelloPort();
        <span class="keyword">return</span> port.sayHello(arg0);
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="running-the-application-client"><a class="anchor" href="#running-the-application-client"></a>Running the Application Client</h5>
<div class="paragraph">
<p>You can use either NetBeans IDE or Maven to build, package, deploy, and run the <code>hello-appclient</code> application.
To build the client, you must first have deployed <code>helloservice-war</code>, as described in <a href="#building-packaging-and-deploying-the-service">Building, Packaging, and Deploying the Service</a>.</p>
</div>
<div class="sect5">
<h6 id="to-run-the-application-client-using-netbeans-ide"><a class="anchor" href="#to-run-the-application-client-using-netbeans-ide"></a>To Run the Application Client Using NetBeans IDE</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>From the <strong>File</strong> menu, choose <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the <strong>Open Project</strong> dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/jaxws</pre>
</div>
</div>
</li>
<li>
<p>Select the <code>hello-appclient</code> folder.</p>
</li>
<li>
<p>Click <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the <strong>Projects</strong> tab, right-click the <code>hello-appclient</code> project and select <strong>Build</strong>.</p>
<div class="paragraph">
<p>This command runs the <code>wsimport</code> goal, then builds, packages, and runs the client.
You will see the output of the application client in the hello-appclient output tab:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>--- exec-maven-plugin:1.2.1:exec (run-appclient) @ hello-appclient ---
Hello, world.</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect5">
<h6 id="to-run-the-application-client-using-maven"><a class="anchor" href="#to-run-the-application-client-using-maven"></a>To Run the Application Client Using Maven</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In a terminal window, go to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/jaxws/hello-appclient/</pre>
</div>
</div>
</li>
<li>
<p>Enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">mvn install</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command runs the <code>wsimport</code> goal, then builds, packages, and runs the client.
The application client output looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>--- exec-maven-plugin:1.2.1:exec (run-appclient) @ hello-appclient ---
Hello, world.</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="a-simple-xml-web-services-web-client"><a class="anchor" href="#a-simple-xml-web-services-web-client"></a>A Simple XML Web Services Web Client</h4>
<div class="paragraph">
<p><code>HelloServlet</code> is a servlet that, like the Java client, calls the <code>sayHello</code> method of the web service.
Like the application client, it makes this call through a port.</p>
</div>
<div class="sect4">
<h5 id="coding-the-servlet"><a class="anchor" href="#coding-the-servlet"></a>Coding the Servlet</h5>
<div class="paragraph">
<p>To invoke the method on the port, the client performs these steps.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>It imports the <code>HelloService</code> endpoint and the <code>WebServiceRef</code> annotation:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">ee.jakarta.tutorial.helloservice.endpoint.HelloService</span>;
...
import jakarta.xml.ws.WebServiceRef;</code></pre>
</div>
</div>
</li>
<li>
<p>It defines a reference to the web service by specifying the WSDL location:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@WebServiceRef</span>(wsdlLocation =
  <span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8080/helloservice-war/HelloService?WSDL</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
</li>
<li>
<p>It declares the web service, then defines a private method that calls the <code>sayHello</code> method on the port:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">private</span> HelloService service;
...
private <span class="predefined-type">String</span> sayHello(java.lang.String arg0) {
    ee.jakarta.tutorial.helloservice.endpoint.Hello port =
            service.getHelloPort();
    <span class="keyword">return</span> port.sayHello(arg0);
}</code></pre>
</div>
</div>
</li>
<li>
<p>In the servlet, it calls this private method:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;p&gt;</span><span class="delimiter">&quot;</span></span> + sayHello(<span class="string"><span class="delimiter">&quot;</span><span class="content">world</span><span class="delimiter">&quot;</span></span>) + <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/p&gt;</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The significant parts of the <code>HelloServlet</code> code follow.
The code is located in the <code><em>tut-install</em>/examples/jaxws/hello-webclient/src/java/ee/jakarta/tutorial/hello/ webclient/</code> directory.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">ee.jakarta.tutorial.hello.webclient</span>;

<span class="keyword">import</span> <span class="include">ee.jakarta.tutorial.helloservice.endpoint.HelloService</span>;
<span class="keyword">import</span> <span class="include">java.io.IOException</span>;
<span class="keyword">import</span> <span class="include">java.io.PrintWriter</span>;
<span class="keyword">import</span> <span class="include">jakarta.servlet.ServletException</span>;
<span class="keyword">import</span> <span class="include">jakarta.servlet.annotation.WebServlet</span>;
<span class="keyword">import</span> <span class="include">jakarta.servlet.http.HttpServlet</span>;
<span class="keyword">import</span> <span class="include">jakarta.servlet.http.HttpServletRequest</span>;
<span class="keyword">import</span> <span class="include">jakarta.servlet.http.HttpServletResponse</span>;
<span class="keyword">import</span> <span class="include">jakarta.xml.ws.WebServiceRef</span>;

<span class="annotation">@WebServlet</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">HelloServlet</span><span class="delimiter">&quot;</span></span>, urlPatterns={<span class="string"><span class="delimiter">&quot;</span><span class="content">/HelloServlet</span><span class="delimiter">&quot;</span></span>})
<span class="directive">public</span> <span class="type">class</span> <span class="class">HelloServlet</span> <span class="directive">extends</span> HttpServlet {
    <span class="annotation">@WebServiceRef</span>(wsdlLocation =
      <span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8080/helloservice-war/HelloService?WSDL</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">private</span> HelloService service;

    <span class="comment">/**
     * Processes requests for both HTTP &lt;code&gt;GET&lt;/code&gt;
     *   and &lt;code&gt;POST&lt;/code&gt; methods.
     * @param request servlet request
     * @param response servlet response
     * @throws ServletException if a servlet-specific error occurs
     * @throws IOException if an I/O error occurs
     */</span>
    <span class="directive">protected</span> <span class="type">void</span> processRequest(HttpServletRequest request,
            HttpServletResponse response)
    <span class="directive">throws</span> ServletException, <span class="exception">IOException</span> {
        response.setContentType(<span class="string"><span class="delimiter">&quot;</span><span class="content">text/html;charset=UTF-8</span><span class="delimiter">&quot;</span></span>);
        <span class="keyword">try</span> (<span class="predefined-type">PrintWriter</span> out = response.getWriter()) {

            out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;html lang=</span><span class="char">\&quot;</span><span class="content">en</span><span class="char">\&quot;</span><span class="content">&gt;</span><span class="delimiter">&quot;</span></span>);
            out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;head&gt;</span><span class="delimiter">&quot;</span></span>);
            out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;title&gt;Servlet HelloServlet&lt;/title&gt;</span><span class="delimiter">&quot;</span></span>);
            out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/head&gt;</span><span class="delimiter">&quot;</span></span>);
            out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;body&gt;</span><span class="delimiter">&quot;</span></span>);
            out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;h1&gt;Servlet HelloServlet at </span><span class="delimiter">&quot;</span></span> +
                request.getContextPath () + <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/h1&gt;</span><span class="delimiter">&quot;</span></span>);
            out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;p&gt;</span><span class="delimiter">&quot;</span></span> + sayHello(<span class="string"><span class="delimiter">&quot;</span><span class="content">world</span><span class="delimiter">&quot;</span></span>) + <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/p&gt;</span><span class="delimiter">&quot;</span></span>);
            out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/body&gt;</span><span class="delimiter">&quot;</span></span>);
            out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/html&gt;</span><span class="delimiter">&quot;</span></span>);
        }
    }

    <span class="comment">// doGet and doPost methods, which call processRequest, and</span>
    <span class="comment">//   getServletInfo method</span>

    <span class="directive">private</span> <span class="predefined-type">String</span> sayHello(java.lang.String arg0) {
        ee.jakarta.tutorial.helloservice.endpoint.Hello port =
                service.getHelloPort();
        <span class="keyword">return</span> port.sayHello(arg0);
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="running-the-web-client"><a class="anchor" href="#running-the-web-client"></a>Running the Web Client</h5>
<div class="paragraph">
<p>You can use either NetBeans IDE or Maven to build, package, deploy, and run the <code>hello-webclient</code> application.
To build the client, you must first have deployed <code>helloservice-war</code>, as described in <a href="#building-packaging-and-deploying-the-service">Building, Packaging, and Deploying the Service</a>.</p>
</div>
<div class="sect5">
<h6 id="to-run-the-web-client-using-netbeans-ide"><a class="anchor" href="#to-run-the-web-client-using-netbeans-ide"></a>To Run the Web Client Using NetBeans IDE</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>From the <strong>File</strong> menu, choose <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the <strong>Open Project</strong> dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/jaxws</pre>
</div>
</div>
</li>
<li>
<p>Select the <code>hello-webclient</code> folder.</p>
</li>
<li>
<p>Click <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the <strong>Projects</strong> tab, right-click the <code>hello-webclient</code> project and select <strong>Build</strong>.</p>
<div class="paragraph">
<p>This task runs the <code>wsimport</code> goal, builds and packages the application into a WAR file, <code>hello-webclient.war</code>, located in the <code>target</code> directory, and deploys it to GlassFish Server.</p>
</div>
</li>
<li>
<p>In a web browser, enter the following URL:</p>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080/hello-webclient/HelloServlet</pre>
</div>
</div>
<div class="paragraph">
<p>The output of the <code>sayHello</code> method appears in the window.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect5">
<h6 id="to-run-the-web-client-using-maven"><a class="anchor" href="#to-run-the-web-client-using-maven"></a>To Run the Web Client Using Maven</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In a terminal window, go to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/jaxws/hello-webclient/</pre>
</div>
</div>
</li>
<li>
<p>Enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">mvn install</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command runs the <code>wsimport</code> goal, then build and packages the application into a WAR file, <code>hello-webclient.war</code>, located in the <code>target</code> directory.
The WAR file is then deployed to GlassFish Server.</p>
</div>
</li>
<li>
<p>In a web browser, enter the following URL:</p>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080/hello-webclient/HelloServlet</pre>
</div>
</div>
<div class="paragraph">
<p>The output of the <code>sayHello</code> method appears in the window.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="types-supported-by-xml-web-services"><a class="anchor" href="#types-supported-by-xml-web-services"></a>Types Supported by XML Web Services</h3>
<div class="paragraph">
<p>XML Web Services delegates the mapping of Java programming language types to and from XML definitions to Jakarta XML Binding.
Application developers don&#8217;t need to know the details of these mappings but should be aware that not every class in the Java language can be used as a method parameter or return type in XML Web Services.</p>
</div>
<div class="paragraph">
<p>The following sections explain the default schema-to-Java and Java-to-schema data type bindings:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#schema-to-java-mapping">Schema-to-Java Mapping</a></p>
</li>
<li>
<p><a href="#java-to-schema-mapping">Java-to-Schema Mapping</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="schema-to-java-mapping"><a class="anchor" href="#schema-to-java-mapping"></a>Schema-to-Java Mapping</h4>
<div class="paragraph">
<p>The Java language provides a richer set of data types than XML schema.
<a href="#mapping-of-xml-data-types-to-java-data-types">Table 31-1</a> lists the mapping of XML data types to Java data types.</p>
</div>
<table id="mapping-of-xml-data-types-to-java-data-types" class="tableblock frame-all grid-all" style="width: 50%;">
<caption class="title">Table 31-1 Mapping of XML Data Types to Java Data Types</caption>
<colgroup>
<col style="width: 40%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">XML Schema Type</th>
<th class="tableblock halign-left valign-top">Java Data Type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xsd:string</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.lang.String</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xsd:integer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.math.BigInteger</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xsd:int</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>int</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xsd.long</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>long</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xsd:short</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>short</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xsd:decimal</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.math.BigDecimal</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xsd:float</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>float</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xsd:double</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>double</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xsd:boolean</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boolean</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xsd:byte</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>byte</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xsd:QName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>javax.xml.namespace.QName</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xsd:dateTime</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>javax.xml.datatype.XMLGregorianCalendar</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xsd:base64Binary</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>byte[]</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xsd:hexBinary</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>byte[]</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xsd:unsignedInt</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>long</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xsd:unsignedShort</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>int</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xsd:unsignedByte</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>short</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xsd:time</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>javax.xml.datatype.XMLGregorianCalendar</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xsd:date</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>javax.xml.datatype.XMLGregorianCalendar</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xsd:g</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>javax.xml.datatype.XMLGregorianCalendar</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xsd:anySimpleType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.lang.Object</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xsd:anySimpleType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.lang.String</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xsd:duration</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>javax.xml.datatype.Duration</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xsd:NOTATION</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>javax.xml.namespace.QName</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="java-to-schema-mapping"><a class="anchor" href="#java-to-schema-mapping"></a>Java-to-Schema Mapping</h4>
<div class="paragraph">
<p><a href="#mapping-of-java-classes-to-xml-data-types">Table 31-2</a> shows the default mapping of Java classes to XML data types.</p>
</div>
<table id="mapping-of-java-classes-to-xml-data-types" class="tableblock frame-all grid-all" style="width: 50%;">
<caption class="title">Table 31-2 Mapping of Java Classes to XML Data Types</caption>
<colgroup>
<col style="width: 60%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Java Class</th>
<th class="tableblock halign-left valign-top">XML Data Type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.lang.String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xs:string</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.math.BigInteger</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xs:integer</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.math.BigDecimal</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xs:decimal</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.util.Calendar</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xs:dateTime</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.util.Date</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xs:dateTime</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>javax.xml.namespace.QName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xs:QName</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.net.URI</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xs:string</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>javax.xml.datatype.XMLGregorianCalendar</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xs:anySimpleType</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>javax.xml.datatype.Duration</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xs:duration</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.lang.Object</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xs:anyType</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.awt.Image</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xs:base64Binary</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jakarta.activation.DataHandler</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xs:base64Binary</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>javax.xml.transform.Source</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xs:base64Binary</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.util.UUID</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xs:string</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="web-services-interoperability-and-jakarta-xml-web-services"><a class="anchor" href="#web-services-interoperability-and-jakarta-xml-web-services"></a>Web Services Interoperability and Jakarta XML Web Services</h3>
<div class="paragraph">
<p>Jakarta XML Web Services supports the Web Services Interoperability (WS-I) Basic Profile Version 1.1.
The WS-I Basic Profile is a document that clarifies the SOAP 1.1 and WSDL 1.1 specifications to promote SOAP interoperability.
For links related to WS-I, see <a href="#further-information-about-jakarta-xml-web-services">Further Information about Jakarta XML Web Services</a>.</p>
</div>
<div class="paragraph">
<p>To support WS-I Basic Profile Version 1.1, the JAX-WS runtime supports doc/literal and rpc/literal encodings for services, static ports, dynamic proxies, and the Dynamic Invocation Interface (DII).</p>
</div>
</div>
<div class="sect2">
<h3 id="further-information-about-jakarta-xml-web-services"><a class="anchor" href="#further-information-about-jakarta-xml-web-services"></a>Further Information about Jakarta XML Web Services</h3>
<div class="paragraph">
<p>For more information about Jakarta XML Web Services and related technologies, see</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Jakarta XML Web Services 3.0 specification:<br>
<a href="https://jakarta.ee/specifications/xml-web-services/3.0/" class="bare" target="_blank" rel="noopener">https://jakarta.ee/specifications/xml-web-services/3.0/</a></p>
</li>
<li>
<p>Jakarta XML Web Services home:<br>
<a href="https://eclipse-ee4j.github.io/metro-jax-ws/" class="bare" target="_blank" rel="noopener">https://eclipse-ee4j.github.io/metro-jax-ws/</a></p>
</li>
<li>
<p>Simple Object Access Protocol (SOAP) 1.2 W3C Note:<br>
<a href="https://www.w3.org/TR/soap/" class="bare" target="_blank" rel="noopener">https://www.w3.org/TR/soap/</a></p>
</li>
<li>
<p>Web Services Description Language (WSDL) 1.1 W3C Note:<br>
<a href="https://www.w3.org/TR/wsdl" class="bare" target="_blank" rel="noopener">https://www.w3.org/TR/wsdl</a></p>
</li>
<li>
<p>WS-I Basic Profile 1.2 and 2.0:<br>
<a href="http://www.ws-i.org" class="bare" target="_blank" rel="noopener">http://www.ws-i.org</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="building-restful-web-services-with-jakarta-rest"><a class="anchor" href="#building-restful-web-services-with-jakarta-rest"></a>Chapter 32. Building RESTful Web Services with Jakarta REST</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter describes the REST architecture, RESTful web services, and the Jakarta RESTful Web Services.</p>
</div>
<div class="paragraph">
<p>Jakarta REST makes it easy for developers to build RESTful web services using the Java programming language.</p>
</div>
<div class="sect2">
<h3 id="what-are-restful-web-services"><a class="anchor" href="#what-are-restful-web-services"></a>What Are RESTful Web Services?</h3>
<div class="paragraph">
<p>RESTful web services are loosely coupled, lightweight web services that are particularly well suited for creating APIs for clients spread out across the internet.
Representational State Transfer (REST) is an architectural style of client-server application centered around the transfer of representations of resources through requests and responses.
In the REST architectural style, data and functionality are considered resources and are accessed using Uniform Resource Identifiers (URIs), typically links on the Web.
The resources are represented by documents and are acted upon by using a set of simple, well-defined operations.</p>
</div>
<div class="paragraph">
<p>For example, a REST resource might be the current weather conditions for a city.
The representation of that resource might be an XML document, an image file, or an HTML page.
A client might retrieve a particular representation, modify the resource by updating its data, or delete the resource entirely.</p>
</div>
<div class="paragraph">
<p>The REST architectural style is designed to use a stateless communication protocol, typically HTTP.
In the REST architecture style, clients and servers exchange representations of resources by using a standardized interface and protocol.</p>
</div>
<div class="paragraph">
<p>The following principles encourage RESTful applications to be simple, lightweight, and fast:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Resource identification through URI: A RESTful web service exposes a set of resources that identify the targets of the interaction with its clients.
Resources are identified by URIs, which provide a global addressing space for resource and service discovery.
See <a href="#the-path-annotation-and-uri-path-templates">The @Path Annotation and URI Path Templates</a> for more information.</p>
</li>
<li>
<p>Uniform interface: Resources are manipulated using a fixed set of four create, read, update, delete operations: PUT, GET, POST, and DELETE.
PUT creates a new resource, which can be then deleted by using DELETE.
GET retrieves the current state of a resource in some representation.
POST transfers a new state onto a resource.
See <a href="#responding-to-http-methods-and-requests">Responding to HTTP Methods and Requests</a> for more information.</p>
</li>
<li>
<p>Self-descriptive messages: Resources are decoupled from their representation so that their content can be accessed in a variety of formats, such as HTML, XML, plain text, PDF, JPEG, JSON, and other document formats.
Metadata about the resource is available and used, for example, to control caching, detect transmission errors, negotiate the appropriate representation format, and perform authentication or access control.
See <a href="#responding-to-http-methods-and-requests">Responding to HTTP Methods and Requests</a> and <a href="#using-entity-providers-to-map-http-response-and-request-entity-bodies">Using Entity Providers to Map HTTP Response and Request Entity Bodies</a> for more information.</p>
</li>
<li>
<p>Stateful interactions through links: Every interaction with a resource is stateless; that is, request messages are self-contained.
Stateful interactions are based on the concept of explicit state transfer.
Several techniques exist to exchange state, such as URI rewriting, cookies, and hidden form fields.
State can be embedded in response messages to point to valid future states of the interaction.
See <a href="#using-entity-providers-to-map-http-response-and-request-entity-bodies">Using Entity Providers to Map HTTP Response and Request Entity Bodies</a> and <a href="#extracting-request-parameters">Extracting Request Parameters</a> in the Jakarta REST Overview document for more information.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="creating-a-restful-root-resource-class"><a class="anchor" href="#creating-a-restful-root-resource-class"></a>Creating a RESTful Root Resource Class</h3>
<div class="paragraph">
<p>Root resource classes are "plain old Java objects" (POJOs) that are either annotated with <code>@Path</code> or have at least one method annotated with <code>@Path</code> or a request method designator, such as <code>@GET</code>, <code>@PUT</code>, <code>@POST</code>, or <code>@DELETE</code>.
Resource methods are methods of a resource class annotated with a request method designator.
This section explains how to use Jakarta REST to annotate Java classes to create RESTful web services.</p>
</div>
<div class="sect3">
<h4 id="developing-restful-web-services-with-jakarta-rest"><a class="anchor" href="#developing-restful-web-services-with-jakarta-rest"></a>Developing RESTful Web Services with Jakarta REST</h4>
<div class="paragraph">
<p>Jakarta REST is a Java programming language API designed to make it easy to develop applications that use the REST architecture.</p>
</div>
<div class="paragraph">
<p>The Jakarta REST API uses Java programming language annotations to simplify the development of RESTful web services.
Developers decorate Java programming language class files with Jakarta REST annotations to define resources and the actions that can be performed on those resources.
Jakarta REST annotations are runtime annotations; therefore, runtime reflection will generate the helper classes and artifacts for the resource.
A Jakarta EE application archive containing Jakarta REST resource classes will have the resources configured, the helper classes and artifacts generated, and the resource exposed to clients by deploying the archive to a Jakarta EE server.</p>
</div>
<div class="paragraph">
<p><a href="#summary-of-jakarta-rest-annotations">Table 32-1</a> lists some of the Java programming annotations that are defined by Jakarta REST, with a brief description of how each is used.
Further information on the Jakarta REST APIs can be viewed at <a href="https://jakarta.ee/specifications/platform/9/apidocs/" class="bare" target="_blank" rel="noopener">https://jakarta.ee/specifications/platform/9/apidocs/</a>.</p>
</div>
<table id="summary-of-jakarta-rest-annotations" class="tableblock frame-all grid-all" style="width: 99%;">
<caption class="title">Table 32-1 Summary of Jakarta REST Annotations</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 90%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Annotation</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Path</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>@Path</code> annotation&#8217;s value is a relative URI path indicating where the Java class will be hosted: for example, <code>/helloworld</code>.
You can also embed variables in the URIs to make a URI path template.
For example, you could ask for the name of a user and pass it to the application as a variable in the URI: <code>/helloworld/{username}</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@GET</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>@GET</code> annotation is a request method designator and corresponds to the similarly named HTTP method.
The Java method annotated with this request method designator will process HTTP GET requests.
The behavior of a resource is determined by the HTTP method to which the resource is responding.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@POST</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>@POST</code> annotation is a request method designator and corresponds to the similarly named HTTP method.
The Java method annotated with this request method designator will process HTTP POST requests.
The behavior of a resource is determined by the HTTP method to which the resource is responding.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@PUT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>@PUT</code> annotation is a request method designator and corresponds to the similarly named HTTP method.
The Java method annotated with this request method designator will process HTTP PUT requests.
The behavior of a resource is determined by the HTTP method to which the resource is responding.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@DELETE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>@DELETE</code> annotation is a request method designator and corresponds to the similarly named HTTP method.
The Java method annotated with this request method designator will process HTTP DELETE requests.
The behavior of a resource is determined by the HTTP method to which the resource is responding.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@HEAD</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>@HEAD</code> annotation is a request method designator and corresponds to the similarly named HTTP method.
The Java method annotated with this request method designator will process HTTP HEAD requests.
The behavior of a resource is determined by the HTTP method to which the resource is responding.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@OPTIONS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>@OPTIONS</code> annotation is a request method designator and corresponds to the similarly named HTTP method.
The Java method annotated with this request method designator will process HTTP OPTIONS requests.
The behavior of a resource is determined by the HTTP method to which the resource is responding.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@PATCH</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>@PATCH</code> annotation is a request method designator and corresponds to the similarly named HTTP method.
The Java method annotated with this request method designator will process HTTP PATCH requests.
The behavior of a resource is determined by the HTTP method to which the resource is responding.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@PathParam</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>@PathParam</code> annotation is a type of parameter that you can extract for use in your resource class.
URI path parameters are extracted from the request URI, and the parameter names correspond to the URI path template variable names specified in the <code>@Path</code> class-level annotation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@QueryParam</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>@QueryParam</code> annotation is a type of parameter that you can extract for use in your resource class.
Query parameters are extracted from the request URI query parameters.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Consumes</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>@Consumes</code> annotation is used to specify the MIME media types of representations a resource can consume that were sent by the client.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Produces</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>@Produces</code> annotation is used to specify the MIME media types of representations a resource can produce and send back to the client: for example, <code>"text/plain"</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Provider</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>@Provider</code> annotation is used for anything that is of interest to the Jakarta REST runtime, such as <code>MessageBodyReader</code> and <code>MessageBodyWriter</code>.
For HTTP requests, the <code>MessageBodyReader</code> is used to map an HTTP request entity body to method parameters.
On the response side, a return value is mapped to an HTTP response entity body by using a <code>MessageBodyWriter</code>.
If the application needs to supply additional metadata, such as HTTP headers or a different status code, a method can return a <code>Response</code> that wraps the entity and that can be built using <code>Response.ResponseBuilder</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@ApplicationPath</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>@ApplicationPath</code> annotation is used to define the URL mapping for the application.
The path specified by <code>@ApplicationPath</code> is the base URI for all resource URIs specified by <code>@Path</code> annotations in the resource class.
You may only apply <code>@ApplicationPath</code> to a subclass of <code>jakarta.ws.rs.core.Application</code>.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="overview-of-a-jakarta-rest-application"><a class="anchor" href="#overview-of-a-jakarta-rest-application"></a>Overview of a Jakarta REST Application</h4>
<div class="paragraph">
<p>The following code sample is a very simple example of a root resource class that uses Jakarta REST annotations:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">ee.jakarta.tutorial.hello</span>;

<span class="keyword">import</span> <span class="include">jakarta.ws.rs.Consumes</span>;
<span class="keyword">import</span> <span class="include">jakarta.ws.rs.GET</span>;
<span class="keyword">import</span> <span class="include">jakarta.ws.rs.PUT</span>;
<span class="keyword">import</span> <span class="include">jakarta.ws.rs.Path</span>;
<span class="keyword">import</span> <span class="include">jakarta.ws.rs.Produces</span>;
<span class="keyword">import</span> <span class="include">jakarta.ws.rs.core.Context</span>;
<span class="keyword">import</span> <span class="include">jakarta.ws.rs.core.UriInfo</span>;

<span class="comment">/**
 * Root resource (exposed at &quot;helloworld&quot; path)
 */</span>
<span class="annotation">@Path</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">helloworld</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">HelloWorld</span> {
    <span class="annotation">@Context</span>
    <span class="directive">private</span> UriInfo context;

    <span class="comment">/** Creates a new instance of HelloWorld */</span>
    <span class="directive">public</span> HelloWorld() {
    }

    <span class="comment">/**
     * Retrieves representation of an instance of helloWorld.HelloWorld
     * @return an instance of java.lang.String
     */</span>
    <span class="annotation">@GET</span>
    <span class="annotation">@Produces</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">text/html</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="predefined-type">String</span> getHtml() {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;html lang=</span><span class="char">\&quot;</span><span class="content">en</span><span class="char">\&quot;</span><span class="content">&gt;&lt;body&gt;&lt;h1&gt;Hello, World!!&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;</span><span class="delimiter">&quot;</span></span>;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following sections describe the annotations used in this example.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>@Path</code> annotation&#8217;s value is a relative URI path.
In the preceding example, the Java class will be hosted at the URI path <code>/helloworld</code>.
This is an extremely simple use of the <code>@Path</code> annotation, with a static URI path.
Variables can be embedded in the URIs.
URI path templates are URIs with variables embedded within the URI syntax.</p>
</li>
<li>
<p>The <code>@GET</code> annotation is a request method designator, along with <code>@POST</code>, <code>@PUT</code>, <code>@DELETE</code>, and <code>@HEAD</code>, defined by Jakarta REST and corresponding to the similarly named HTTP methods.
In the example, the annotated Java method will process HTTP GET requests.
The behavior of a resource is determined by the HTTP method to which the resource is responding.</p>
</li>
<li>
<p>The <code>@Produces</code> annotation is used to specify the MIME media types a resource can produce and send back to the client.
In this example, the Java method will produce representations identified by the MIME media type <code>"text/html"</code>.</p>
</li>
<li>
<p>The <code>@Consumes</code> annotation is used to specify the MIME media types a resource can consume that were sent by the client.
The example could be modified to set the message returned by the <code>getHtml</code> method, as shown in this code example:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@POST</span>
<span class="annotation">@Consumes</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">text/plain</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">void</span> postHtml(<span class="predefined-type">String</span> message) {
    <span class="comment">// Store the message</span>
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="the-path-annotation-and-uri-path-templates"><a class="anchor" href="#the-path-annotation-and-uri-path-templates"></a>The @Path Annotation and URI Path Templates</h4>
<div class="paragraph">
<p>The <code>@Path</code> annotation identifies the URI path template to which the resource responds and is specified at the class or method level of a resource.
The <code>@Path</code> annotation&#8217;s value is a partial URI path template relative to the base URI of the server on which the resource is deployed, the context root of the application, and the URL pattern to which the Jakarta REST runtime responds.</p>
</div>
<div class="paragraph">
<p>URI path templates are URIs with variables embedded within the URI syntax.
These variables are substituted at runtime in order for a resource to respond to a request based on the substituted URI.
Variables are denoted by braces (<code>{</code> and <code>}</code>).
For example, look at the following <code>@Path</code> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Path</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/users/{username}</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this kind of example, a user is prompted to type his or her name, and then a Jakarta REST web service configured to respond to requests to this URI path template responds.
For example, if the user types the user name "Galileo," the web service responds to the following URL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>http://example.com/users/Galileo</pre>
</div>
</div>
<div class="paragraph">
<p>To obtain the value of the user name, the <code>@PathParam</code> annotation may be used on the method parameter of a request method, as shown in the following code example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Path</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/users/{username}</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">UserResource</span> {

    <span class="annotation">@GET</span>
    <span class="annotation">@Produces</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">text/xml</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="predefined-type">String</span> getUser(<span class="annotation">@PathParam</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">username</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">String</span> userName) {
        ...
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, the URI variable must match the regular expression <code>"[^/]+?"</code>.
This variable may be customized by specifying a different regular expression after the variable name.
For example, if a user name must consist only of lowercase and uppercase alphanumeric characters, override the default regular expression in the variable definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Path</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">users/{username: [a-zA-Z][a-zA-Z_0-9]*}</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the <code>username</code> variable will match only user names that begin with one uppercase or lowercase letter and zero or more alphanumeric characters and the underscore character.
If a user name does not match that template, a 404 (Not Found) response will be sent to the client.</p>
</div>
<div class="paragraph">
<p>A <code>@Path</code> value isn&#8217;t required to have leading or trailing slashes (/).
The Jakarta REST runtime parses URI path templates the same way, whether or not they have leading or trailing slashes.</p>
</div>
<div class="paragraph">
<p>A URI path template has one or more variables, with each variable name surrounded by braces: <code>{</code> to begin the variable name and <code>}</code> to end it.
In the preceding example, <code>username</code> is the variable name.
At runtime, a resource configured to respond to the preceding URI path template will attempt to process the URI data that corresponds to the location of <code>{username}</code> in the URI as the variable data for <code>username</code>.</p>
</div>
<div class="paragraph">
<p>For example, if you want to deploy a resource that responds to the URI path template <code>http://example.com/myContextRoot/resources/{name1}/{name2}/</code>, you must first deploy the application to a Jakarta EE server that responds to requests to the <code>http://example.com/myContextRoot</code> URI and then decorate your resource with the following <code>@Path</code> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Path</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/{name1}/{name2}/</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">SomeResource</span> {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the URL pattern for the Jakarta REST helper servlet, specified in <code>web.xml</code>, is the default:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;servlet-mapping&gt;</span>
      <span class="tag">&lt;servlet-name&gt;</span>jakarta.ws.rs.core.Application<span class="tag">&lt;/servlet-name&gt;</span>
      <span class="tag">&lt;url-pattern&gt;</span>/resources/*<span class="tag">&lt;/url-pattern&gt;</span>
<span class="tag">&lt;/servlet-mapping&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A variable name can be used more than once in the URI path template.</p>
</div>
<div class="paragraph">
<p>If a character in the value of a variable would conflict with the reserved characters of a URI, the conflicting character should be substituted with percent encoding.
For example, spaces in the value of a variable should be substituted with <code>%20</code>.</p>
</div>
<div class="paragraph">
<p>When defining URI path templates, be careful that the resulting URI after substitution is valid.</p>
</div>
<div class="paragraph">
<p><a href="#examples-of-uri-path-templates">Table 32-2</a> lists some examples of URI path template variables and how the URIs are resolved after substitution.
The following variable names and values are used in the examples:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>name1</code>: <code>james</code></p>
</li>
<li>
<p><code>name2</code>: <code>gatz</code></p>
</li>
<li>
<p><code>name3</code>:</p>
</li>
<li>
<p><code>location</code>: <code>Main%20Street</code></p>
</li>
<li>
<p><code>question</code>: <code>why</code></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The value of the <code>name3</code> variable is an empty string.
</td>
</tr>
</table>
</div>
<table id="examples-of-uri-path-templates" class="tableblock frame-all grid-all" style="width: 80%;">
<caption class="title">Table 32-2 Examples of URI Path Templates</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">URI Path Template</th>
<th class="tableblock halign-left valign-top">URI After Substitution</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">http://example.com/{name1}/{name2}/</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">http://example.com/james/gatz/</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">http://example.com/{question}/{question}/{question}/</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">http://example.com/why/why/why/</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">http://example.com/maps/{location}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">http://example.com/maps/Main%20Street</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">http://example.com/{name3}/home/</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">http://example.com//home/</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="responding-to-http-methods-and-requests"><a class="anchor" href="#responding-to-http-methods-and-requests"></a>Responding to HTTP Methods and Requests</h4>
<div class="paragraph">
<p>The behavior of a resource is determined by the HTTP methods (typically, GET, POST, PUT, or DELETE) to which the resource is responding.</p>
</div>
<div class="sect4">
<h5 id="the-request-method-designator-annotations"><a class="anchor" href="#the-request-method-designator-annotations"></a>The Request Method Designator Annotations</h5>
<div class="paragraph">
<p>Request method designator annotations are runtime annotations, defined by Jakarta REST, that correspond to the similarly named HTTP methods.
Within a resource class file, HTTP methods are mapped to Java programming language methods by using the request method designator annotations.
The behavior of a resource is determined by which HTTP method the resource is responding to.
Jakarta REST defines a set of request method designators for the common HTTP methods GET, POST, PUT, DELETE, and HEAD; you can also create your own custom request method designators.
Creating custom request method designators is outside the scope of this document.</p>
</div>
<div class="paragraph">
<p>The following example shows the use of the PUT method to create or update a storage container:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@PUT</span>
<span class="directive">public</span> Response putContainer() {
    <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">PUT CONTAINER </span><span class="delimiter">&quot;</span></span> + container);

    <span class="predefined-type">URI</span> uri =  uriInfo.getAbsolutePath();
    <span class="predefined-type">Container</span> c = <span class="keyword">new</span> <span class="predefined-type">Container</span>(container, uri.toString());

    Response r;
    <span class="keyword">if</span> (!MemoryStore.MS.hasContainer(c)) {
        r = Response.created(uri).build();
    } <span class="keyword">else</span> {
        r = Response.noContent().build();
    }

    MemoryStore.MS.createContainer(c);
    <span class="keyword">return</span> r;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, the Jakarta REST runtime will automatically support the methods HEAD and OPTIONS if not explicitly implemented.
For HEAD, the runtime will invoke the implemented GET method, if present, and ignore the response entity, if set.
For OPTIONS, the <code>Allow</code> response header will be set to the set of HTTP methods supported by the resource.
In addition, the Jakarta REST runtime will return a Web Application Definition Language (WADL) document describing the resource; see <a href="https://www.w3.org/Submission/wadl/" class="bare" target="_blank" rel="noopener">https://www.w3.org/Submission/wadl/</a> for more information.</p>
</div>
<div class="paragraph">
<p>Methods decorated with request method designators must return <code>void</code>, a Java programming language type, or a <code>jakarta.ws.rs.core.Response</code> object.
Multiple parameters may be extracted from the URI by using the <code>@PathParam</code> or <code>@QueryParam</code> annotations, as described in <a href="#extracting-request-parameters">Extracting Request Parameters</a>.
Conversion between Java types and an entity body is the responsibility of an entity provider, such as <code>MessageBodyReader</code> or <code>MessageBodyWriter</code>.
Methods that need to provide additional metadata with a response should return an instance of the <code>Response</code> class.
The <code>ResponseBuilder</code> class provides a convenient way to create a <code>Response</code> instance using a builder pattern.
The HTTP PUT and POST methods expect an HTTP request body, so you should use a <code>MessageBodyReader</code> for methods that respond to PUT and POST requests.</p>
</div>
<div class="paragraph">
<p>Both <code>@PUT</code> and <code>@POST</code> can be used to create or update a resource.
POST can mean anything, so when using POST, it is up to the application to define the semantics.
PUT has well-defined semantics.
When using PUT for creation, the client declares the URI for the newly created resource.</p>
</div>
<div class="paragraph">
<p>PUT has very clear semantics for creating and updating a resource.
The representation the client sends must be the same representation that is received using a GET, given the same media type.
PUT does not allow a resource to be partially updated, a common mistake when attempting to use the PUT method.
A common application pattern is to use POST to create a resource and return a <code>201</code> response with a location header whose value is the URI to the newly created resource.
In this pattern, the web service declares the URI for the newly created resource.</p>
</div>
</div>
<div class="sect4">
<h5 id="using-entity-providers-to-map-http-response-and-request-entity-bodies"><a class="anchor" href="#using-entity-providers-to-map-http-response-and-request-entity-bodies"></a>Using Entity Providers to Map HTTP Response and Request Entity Bodies</h5>
<div class="paragraph">
<p>Entity providers supply mapping services between representations and their associated Java types.
The two types of entity providers are <code>MessageBodyReader</code> and <code>MessageBodyWriter</code>.
For HTTP requests, the <code>MessageBodyReader</code> is used to map an HTTP request entity body to method parameters.
On the response side, a return value is mapped to an HTTP response entity body by using a <code>MessageBodyWriter</code>.
If the application needs to supply additional metadata, such as HTTP headers or a different status code, a method can return a <code>Response</code> that wraps the entity and that can be built by using <code>Response.ResponseBuilder</code>.</p>
</div>
<div class="paragraph">
<p><a href="#types-supported-for-http-request-and-response-entity-bodies">Table 32-3</a> shows the standard types that are supported automatically for HTTP request and response entity bodies.
You need to write an entity provider only if you are not choosing one of these standard types.</p>
</div>
<table id="types-supported-for-http-request-and-response-entity-bodies" class="tableblock frame-all grid-all" style="width: 50%;">
<caption class="title">Table 32-3 Types Supported for HTTP Request and Response Entity Bodies</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Java Type</th>
<th class="tableblock halign-left valign-top">Supported Media Types</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>byte[]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All media types (<code>*/*</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.lang.String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All text media types (<code>text/*</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.io.InputStream</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All media types (<code>*/*</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.io.Reader</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All media types (<code>*/*</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.io.File</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All media types (<code>*/*</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jakarta.activation.DataSource</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All media types (<code>*/*</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>javax.xml.transform.Source</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">XML media types (<code>text/xml</code>, <code>application/xml</code>, and <code>application/*+xml</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jakarta.xml.bind.JAXBElement</code> and application-supplied Jakarta XML Binding classes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">XML media types (<code>text/xml</code>, <code>application/xml</code>, and <code>application/*+xml</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MultivaluedMap&lt;String, String&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Form content (<code>application/x-www-form-urlencoded</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>StreamingOutput</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All media types (<code><strong>/</strong></code>), <code>MessageBodyWriter</code> only</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The following example shows how to use <code>MessageBodyReader</code> with the <code>@Consumes</code> and <code>@Provider</code> annotations:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Consumes</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">application/x-www-form-urlencoded</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@Provider</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">FormReader</span> <span class="directive">implements</span> MessageBodyReader&lt;NameValuePair&gt; { }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example shows how to use <code>MessageBodyWriter</code> with the <code>@Produces</code> and <code>@Provider</code> annotations:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Produces</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">text/html</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@Provider</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">FormWriter</span> <span class="directive">implements</span>
        MessageBodyWriter&lt;<span class="predefined-type">Hashtable</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt;&gt; { }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example shows how to use <code>ResponseBuilder</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@GET</span>
<span class="directive">public</span> Response getItem() {
    <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">GET ITEM </span><span class="delimiter">&quot;</span></span> + container + <span class="string"><span class="delimiter">&quot;</span><span class="content"> </span><span class="delimiter">&quot;</span></span> + item);

    Item i = MemoryStore.MS.getItem(container, item);
    <span class="keyword">if</span> (i == <span class="predefined-constant">null</span>)
        <span class="keyword">throw</span> <span class="keyword">new</span> NotFoundException(<span class="string"><span class="delimiter">&quot;</span><span class="content">Item not found</span><span class="delimiter">&quot;</span></span>);
    <span class="predefined-type">Date</span> lastModified = i.getLastModified().getTime();
    EntityTag et = <span class="keyword">new</span> EntityTag(i.getDigest());
    ResponseBuilder rb = request.evaluatePreconditions(lastModified, et);
    <span class="keyword">if</span> (rb != <span class="predefined-constant">null</span>)
        <span class="keyword">return</span> rb.build();

    <span class="type">byte</span><span class="type">[]</span> b = MemoryStore.MS.getItemData(container, item);
    <span class="keyword">return</span> Response.ok(b, i.getMimeType()).
            lastModified(lastModified).tag(et).build();
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="using-consumes-and-produces-to-customize-requests-and-responses"><a class="anchor" href="#using-consumes-and-produces-to-customize-requests-and-responses"></a>Using @Consumes and @Produces to Customize Requests and Responses</h4>
<div class="paragraph">
<p>The information sent to a resource and then passed back to the client is specified as a MIME media type in the headers of an HTTP request or response.
You can specify which MIME media types of representations a resource can respond to or produce by using the following annotations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>jakarta.ws.rs.Consumes</code></p>
</li>
<li>
<p><code>jakarta.ws.rs.Produces</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>By default, a resource class can respond to and produce all MIME media types of representations specified in the HTTP request and response headers.</p>
</div>
<div class="sect4">
<h5 id="the-produces-annotation"><a class="anchor" href="#the-produces-annotation"></a>The @Produces Annotation</h5>
<div class="paragraph">
<p>The <code>@Produces</code> annotation is used to specify the MIME media types or representations a resource can produce and send back to the client.
If <code>@Produces</code> is applied at the class level, all the methods in a resource can produce the specified MIME types by default.
If applied at the method level, the annotation overrides any <code>@Produces</code> annotations applied at the class level.</p>
</div>
<div class="paragraph">
<p>If no methods in a resource are able to produce the MIME type in a client request, the Jakarta REST runtime sends back an HTTP "406 Not Acceptable" error.</p>
</div>
<div class="paragraph">
<p>The value of <code>@Produces</code> is an array of <code>String</code> of MIME types or a comma-separated list of <code>MediaType</code> constants.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Produces</span>({<span class="string"><span class="delimiter">&quot;</span><span class="content">image/jpeg,image/png</span><span class="delimiter">&quot;</span></span>})</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example shows how to apply <code>@Produces</code> at both the class and method levels:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Path</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/myResource</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@Produces</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">text/plain</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">SomeResource</span> {
    <span class="annotation">@GET</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> doGetAsPlainText() {
        ...
    }

    <span class="annotation">@GET</span>
    <span class="annotation">@Produces</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">text/html</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="predefined-type">String</span> doGetAsHtml() {
        ...
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>doGetAsPlainText</code> method defaults to the MIME media type of the <code>@Produces</code> annotation at the class level.
The <code>doGetAsHtml</code> method&#8217;s <code>@Produces</code> annotation overrides the class-level <code>@Produces</code> setting and specifies that the method can produce HTML rather than plain text.</p>
</div>
<div class="paragraph">
<p><code>@Produces</code> can also use the constants defined in the <code>jakarta.ws.rs.core.MediaType</code> class to specify the media type.
For example, specifying <code>MediaType.APPLICATION_XML</code> is equivalent to specifying <code>"application/xml"</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Produces</span>(MediaType.APPLICATION_XML)
<span class="annotation">@GET</span>
<span class="directive">public</span> Customer getCustomer() { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>If a resource class is capable of producing more than one MIME media type, the resource method chosen will correspond to the most acceptable media type as declared by the client.
More specifically, the <code>Accept</code> header of the HTTP request declares what is most acceptable.
For example, if the <code>Accept</code> header is <code>Accept: text/plain</code>, the <code>doGetAsPlainText</code> method will be invoked.
Alternatively, if the <code>Accept</code> header is <code>Accept: text/plain;q=0.9, text/html</code>, which declares that the client can accept media types of <code>text/plain</code> and <code>text/html</code> but prefers the latter, the <code>doGetAsHtml</code> method will be invoked.</p>
</div>
<div class="paragraph">
<p>More than one media type may be declared in the same <code>@Produces</code> declaration.
The following code example shows how this is done:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Produces</span>({<span class="string"><span class="delimiter">&quot;</span><span class="content">application/xml</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">application/json</span><span class="delimiter">&quot;</span></span>})
<span class="directive">public</span> <span class="predefined-type">String</span> doGetAsXmlOrJson() {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>doGetAsXmlOrJson</code> method will get invoked if either of the media types <code>application/xml</code> or <code>application/json</code> is acceptable.
If both are equally acceptable, the former will be chosen because it occurs first.
The preceding examples refer explicitly to MIME media types for clarity.
It is possible to refer to constant values, which may reduce typographical errors.
For more information, see the API documentation for the constant field values of <code>jakarta.ws.rs.core.MediaType</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="the-consumes-annotation"><a class="anchor" href="#the-consumes-annotation"></a>The @Consumes Annotation</h5>
<div class="paragraph">
<p>The <code>@Consumes</code> annotation is used to specify which MIME media types of representations a resource can accept, or consume, from the client.
If <code>@Consumes</code> is applied at the class level, all the response methods accept the specified MIME types by default.
If applied at the method level, <code>@Consumes</code> overrides any <code>@Consumes</code> annotations applied at the class level.</p>
</div>
<div class="paragraph">
<p>If a resource is unable to consume the MIME type of a client request, the Jakarta REST runtime sends back an HTTP 415 ("Unsupported Media Type") error.</p>
</div>
<div class="paragraph">
<p>The value of <code>@Consumes</code> is an array of <code>String</code> of acceptable MIME types, or a comma-separated list of <code>MediaType</code> constants.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Consumes</span>({<span class="string"><span class="delimiter">&quot;</span><span class="content">text/plain,text/html</span><span class="delimiter">&quot;</span></span>})</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is the equivalent of:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Consumes</span>({MediaType.TEXT_PLAIN,MediaType.TEXT_HTML})</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example shows how to apply <code>@Consumes</code> at both the class and method levels:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Path</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/myResource</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@Consumes</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">multipart/related</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">SomeResource</span> {
    <span class="annotation">@POST</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> doPost(MimeMultipart mimeMultipartData) {
        ...
    }

    <span class="annotation">@POST</span>
    <span class="annotation">@Consumes</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">application/x-www-form-urlencoded</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="predefined-type">String</span> doPost2(FormURLEncodedProperties formData) {
        ...
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>doPost</code> method defaults to the MIME media type of the <code>@Consumes</code> annotation at the class level.
The <code>doPost2</code> method overrides the class level <code>@Consumes</code> annotation to specify that it can accept URL-encoded form data.</p>
</div>
<div class="paragraph">
<p>If no resource methods can respond to the requested MIME type, an HTTP 415 ("Unsupported Media Type") error is returned to the client.</p>
</div>
<div class="paragraph">
<p>The <code>HelloWorld</code> example discussed previously in this section can be modified to set the message by using <code>@Consumes</code>, as shown in the following code example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@POST</span>
<span class="annotation">@Consumes</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">text/html</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">void</span> postHtml(<span class="predefined-type">String</span> message) {
    <span class="comment">// Store the message</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the Java method will consume representations identified by the MIME media type <code>text/plain</code>.
Note that the resource method returns <code>void</code>.
This means that no representation is returned and that a response with a status code of HTTP 204 ("No Content") will be returned.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="extracting-request-parameters"><a class="anchor" href="#extracting-request-parameters"></a>Extracting Request Parameters</h4>
<div class="paragraph">
<p>Parameters of a resource method may be annotated with parameter-based annotations to extract information from a request.
A previous example presented the use of the <code>@PathParam</code> parameter to extract a path parameter from the path component of the request URL that matched the path declared in <code>@Path</code>.</p>
</div>
<div class="paragraph">
<p>You can extract the following types of parameters for use in your resource class:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Query</p>
</li>
<li>
<p>URI path</p>
</li>
<li>
<p>Form</p>
</li>
<li>
<p>Cookie</p>
</li>
<li>
<p>Header</p>
</li>
<li>
<p>Matrix</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Query parameters are extracted from the request URI query parameters and are specified by using the <code>jakarta.ws.rs.QueryParam</code> annotation in the method parameter arguments.
The following example demonstrates using <code>@QueryParam</code> to extract query parameters from the <code>Query</code> component of the request URL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Path</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">smooth</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@GET</span>
<span class="directive">public</span> Response smooth(
        <span class="annotation">@DefaultValue</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span>) <span class="annotation">@QueryParam</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">step</span><span class="delimiter">&quot;</span></span>) <span class="type">int</span> step,
        <span class="annotation">@DefaultValue</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>) <span class="annotation">@QueryParam</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">min-m</span><span class="delimiter">&quot;</span></span>) <span class="type">boolean</span> hasMin,
        <span class="annotation">@DefaultValue</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>) <span class="annotation">@QueryParam</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">max-m</span><span class="delimiter">&quot;</span></span>) <span class="type">boolean</span> hasMax,
        <span class="annotation">@DefaultValue</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>) <span class="annotation">@QueryParam</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">last-m</span><span class="delimiter">&quot;</span></span>) <span class="type">boolean</span> hasLast,
        <span class="annotation">@DefaultValue</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">blue</span><span class="delimiter">&quot;</span></span>) <span class="annotation">@QueryParam</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">min-color</span><span class="delimiter">&quot;</span></span>) ColorParam minColor,
        <span class="annotation">@DefaultValue</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">green</span><span class="delimiter">&quot;</span></span>) <span class="annotation">@QueryParam</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">max-color</span><span class="delimiter">&quot;</span></span>) ColorParam maxColor,
        <span class="annotation">@DefaultValue</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">red</span><span class="delimiter">&quot;</span></span>) <span class="annotation">@QueryParam</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">last-color</span><span class="delimiter">&quot;</span></span>) ColorParam lastColor
        ) { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the query parameter <code>step</code> exists in the query component of the request URI, the value of <code>step</code> will be extracted and parsed as a 32-bit signed integer and assigned to the <code>step</code> method parameter.
If <code>step</code> does not exist, a default value of 2, as declared in the <code>@DefaultValue</code> annotation, will be assigned to the <code>step</code> method parameter.
If the <code>step</code> value cannot be parsed as a 32-bit signed integer, an HTTP 400 ("Client Error") response is returned.</p>
</div>
<div class="paragraph">
<p>User-defined Java programming language types may be used as query parameters.
The following code example shows the <code>ColorParam</code> class used in the preceding query parameter example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ColorParam</span> <span class="directive">extends</span> <span class="predefined-type">Color</span> {
    <span class="directive">public</span> ColorParam(<span class="predefined-type">String</span> s) {
        <span class="local-variable">super</span>(getRGB(s));
    }

    <span class="directive">private</span> <span class="directive">static</span> <span class="type">int</span> getRGB(<span class="predefined-type">String</span> s) {
        <span class="keyword">if</span> (s.charAt(<span class="integer">0</span>) == <span class="string"><span class="delimiter">'</span><span class="content">#</span><span class="delimiter">'</span></span>) {
            <span class="keyword">try</span> {
                <span class="predefined-type">Color</span> c = <span class="predefined-type">Color</span>.decode(<span class="string"><span class="delimiter">&quot;</span><span class="content">0x</span><span class="delimiter">&quot;</span></span> + s.substring(<span class="integer">1</span>));
                <span class="keyword">return</span> c.getRGB();
            } <span class="keyword">catch</span> (<span class="exception">NumberFormatException</span> e) {
                <span class="keyword">throw</span> <span class="keyword">new</span> WebApplicationException(<span class="integer">400</span>);
            }
        } <span class="keyword">else</span> {
            <span class="keyword">try</span> {
                <span class="predefined-type">Field</span> f = <span class="predefined-type">Color</span>.class.getField(s);
                <span class="keyword">return</span> ((<span class="predefined-type">Color</span>)f.get(<span class="predefined-constant">null</span>)).getRGB();
            } <span class="keyword">catch</span> (<span class="exception">Exception</span> e) {
                <span class="keyword">throw</span> <span class="keyword">new</span> WebApplicationException(<span class="integer">400</span>);
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The constructor for <code>ColorParam</code> takes a single <code>String</code> parameter.</p>
</div>
<div class="paragraph">
<p>Both <code>@QueryParam</code> and <code>@PathParam</code> can be used only on the following Java types.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>All primitive types except <code>char</code>.</p>
</li>
<li>
<p>All wrapper classes of primitive types except <code>Character</code>.</p>
</li>
<li>
<p>Any class with a constructor that accepts a single <code>String</code> argument.</p>
</li>
<li>
<p>Any class with the static method named <code>valueOf(String)</code> that accepts a single <code>String</code> argument.</p>
</li>
<li>
<p><code>List&lt;T&gt;</code>, <code>Set&lt;T&gt;</code>, or <code>SortedSet&lt;T&gt;</code>, where T matches the already listed criteria.
Sometimes, parameters may contain more than one value for the same name.
If this is the case, these types may be used to obtain all values.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If <code>@DefaultValue</code> is not used in conjunction with <code>@QueryParam</code>, and the query parameter is not present in the request, the value will be an empty collection for <code>List</code>, <code>Set</code>, or <code>SortedSet</code>; null for other object types; and the default for primitive types.</p>
</div>
<div class="paragraph">
<p>URI path parameters are extracted from the request URI, and the parameter names correspond to the URI path template variable names specified in the <code>@Path</code> class-level annotation.
URI parameters are specified using the <code>jakarta.ws.rs.PathParam</code> annotation in the method parameter arguments.
The following example shows how to use <code>@Path</code> variables and the <code>@PathParam</code> annotation in a method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Path</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/{username}</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyResourceBean</span> {
    ...
    <span class="annotation">@GET</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> printUsername(<span class="annotation">@PathParam</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">username</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">String</span> userId) {
        ...
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the preceding snippet, the URI path template variable name <code>username</code> is specified as a parameter to the <code>printUsername</code> method.
The <code>@PathParam</code> annotation is set to the variable name <code>username</code>.
At runtime, before <code>printUsername</code> is called, the value of <code>username</code> is extracted from the URI and cast to a <code>String</code>.
The resulting <code>String</code> is then available to the method as the <code>userId</code> variable.</p>
</div>
<div class="paragraph">
<p>If the URI path template variable cannot be cast to the specified type, the Jakarta REST runtime returns an HTTP 400 ("Bad Request") error to the client.
If the <code>@PathParam</code> annotation cannot be cast to the specified type, the Jakarta REST runtime returns an HTTP 404 ("Not Found") error to the client.</p>
</div>
<div class="paragraph">
<p>The <code>@PathParam</code> parameter and the other parameter-based annotations (<code>@MatrixParam</code>, <code>@HeaderParam</code>, <code>@CookieParam</code>, and <code>@FormParam</code>) obey the same rules as <code>@QueryParam</code>.</p>
</div>
<div class="paragraph">
<p>Cookie parameters, indicated by decorating the parameter with <code>jakarta.ws.rs.CookieParam</code>, extract information from the cookies declared in cookie-related HTTP headers.
Header parameters, indicated by decorating the parameter with <code>jakarta.ws.rs.HeaderParam</code>, extract information from the HTTP headers.
Matrix parameters, indicated by decorating the parameter with <code>jakarta.ws.rs.MatrixParam</code>, extract information from URL path segments.</p>
</div>
<div class="paragraph">
<p>Form parameters, indicated by decorating the parameter with <code>jakarta.ws.rs.FormParam</code>, extract information from a request representation that is of the MIME media type <code>application/x-www-form-urlencoded</code> and conforms to the encoding specified by HTML forms, as described in <a href="https://www.w3.org/TR/html401/interact/forms.html#h-17.13.4.1" class="bare" target="_blank" rel="noopener">https://www.w3.org/TR/html401/interact/forms.html#h-17.13.4.1</a>.
This parameter is very useful for extracting information sent by POST in HTML forms.</p>
</div>
<div class="paragraph">
<p>The following example extracts the <code>name</code> form parameter from the POST form data:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@POST</span>
<span class="annotation">@Consumes</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">application/x-www-form-urlencoded</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">void</span> post(<span class="annotation">@FormParam</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">String</span> name) {
    <span class="comment">// Store the message</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To obtain a general map of parameter names and values for query and path parameters, use the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@GET</span>
<span class="directive">public</span> <span class="predefined-type">String</span> get(<span class="annotation">@Context</span> UriInfo ui) {
    MultivaluedMap&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; queryParams = ui.getQueryParameters();
    MultivaluedMap&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; pathParams = ui.getPathParameters();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following method extracts header and cookie parameter names and values into a map:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@GET</span>
<span class="directive">public</span> <span class="predefined-type">String</span> get(<span class="annotation">@Context</span> HttpHeaders hh) {
    MultivaluedMap&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; headerParams = hh.getRequestHeaders();
    <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, Cookie&gt; pathParams = hh.getCookies();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In general, <code>@Context</code> can be used to obtain contextual Java types related to the request or response.</p>
</div>
<div class="paragraph">
<p>For form parameters, it is possible to do the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@POST</span>
<span class="annotation">@Consumes</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">application/x-www-form-urlencoded</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">void</span> post(MultivaluedMap&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; formParams) {
    <span class="comment">// Store the message</span>
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configuring-jakarta-rest-applications"><a class="anchor" href="#configuring-jakarta-rest-applications"></a>Configuring Jakarta REST Applications</h4>
<div class="paragraph">
<p>A Jakarta REST application consists of at least one resource class packaged within a WAR file.
The base URI from which an application&#8217;s resources respond to requests can be set one of two ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Using the <code>@ApplicationPath</code> annotation in a subclass of <code>jakarta.ws.rs.core.Application</code> packaged within the WAR</p>
</li>
<li>
<p>Using the <code>servlet-mapping</code> tag within the WAR&#8217;s <code>web.xml</code> deployment descriptor</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="configuring-a-jakarta-rest-application-using-a-subclass-of-application"><a class="anchor" href="#configuring-a-jakarta-rest-application-using-a-subclass-of-application"></a>Configuring a Jakarta REST Application Using a Subclass of Application</h5>
<div class="paragraph">
<p>Create a subclass of <code>jakarta.ws.rs.core.Application</code> to manually configure the environment in which the REST resources defined in your resource classes are run, including the base URI.
Add a class-level <code>@ApplicationPath</code> annotation to set the base URI.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ApplicationPath</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/webapi</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyApplication</span> <span class="directive">extends</span> Application { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the preceding example, the base URI is set to <code>/webapi</code>, which means that all resources defined within the application are relative to <code>/webapi</code>.</p>
</div>
<div class="paragraph">
<p>By default, all the resources in an archive will be processed for resources.
Override the <code>getClasses</code> method to manually register the resource classes in the application with the Jakarta REST runtime.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Override</span>
<span class="directive">public</span> <span class="predefined-type">Set</span>&lt;<span class="predefined-type">Class</span>&lt;?&gt;&gt; getClasses() {
    <span class="directive">final</span> <span class="predefined-type">Set</span>&lt;<span class="predefined-type">Class</span>&lt;?&gt;&gt; classes = <span class="keyword">new</span> <span class="predefined-type">HashSet</span>&lt;&gt;();
    <span class="comment">// register root resource</span>
    classes.add(MyResource.class);
    <span class="keyword">return</span> classes;
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="configuring-the-base-uri-in-web-xml"><a class="anchor" href="#configuring-the-base-uri-in-web-xml"></a>Configuring the Base URI in web.xml</h5>
<div class="paragraph">
<p>The base URI for a Jakarta REST application can be set using a <code>servlet-mapping</code> tag in the <code>web.xml</code> deployment descriptor, using the <code>Application</code> class name as the servlet.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;servlet-mapping&gt;</span>
    <span class="tag">&lt;servlet-name&gt;</span>jakarta.ws.rs.core.Application<span class="tag">&lt;/servlet-name&gt;</span>
    <span class="tag">&lt;url-pattern&gt;</span>/webapi/*<span class="tag">&lt;/url-pattern&gt;</span>
<span class="tag">&lt;/servlet-mapping&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This setting will also override the path set by <code>@ApplicationPath</code> when using an <code>Application</code> subclass.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;servlet-mapping&gt;</span>
   <span class="tag">&lt;servlet-name&gt;</span>com.example.rest.MyApplication<span class="tag">&lt;/servlet-name&gt;</span>
   <span class="tag">&lt;url-pattern&gt;</span>/services/*<span class="tag">&lt;/url-pattern&gt;</span>
<span class="tag">&lt;/servlet-mapping&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="example-applications-for-jakarta-rest"><a class="anchor" href="#example-applications-for-jakarta-rest"></a>Example Applications for Jakarta REST</h3>
<div class="paragraph">
<p>This section provides an introduction to creating, deploying, and running your own Jakarta REST applications.
This section demonstrates the steps that are needed to create, build, deploy, and test a very simple web application that uses Jakarta REST annotations.</p>
</div>
<div class="sect3">
<h4 id="creating-a-simple-restful-web-service"><a class="anchor" href="#creating-a-simple-restful-web-service"></a>Creating a Simple RESTful Web Service</h4>
<div class="paragraph">
<p>This section explains how to use NetBeans IDE to create a RESTful web service using a Maven archetype.
The archetype generates a skeleton for the application, and you simply need to implement the appropriate method.</p>
</div>
<div class="paragraph">
<p>You can find a version of this application at <code><em>tut-install</em>/examples/jaxrs/hello/</code>.</p>
</div>
<div class="sect4">
<h5 id="to-create-a-restful-web-service-using-netbeans-ide"><a class="anchor" href="#to-create-a-restful-web-service-using-netbeans-ide"></a>To Create a RESTful Web Service Using NetBeans IDE</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Ensure you have installed the tutorial archetypes as described in <a href="#installing-the-tutorial-archetypes">Installing the Tutorial Archetypes</a>.</p>
</li>
<li>
<p>In NetBeans IDE, create a simple web application using the <code>jaxrs-service-archetype</code> Maven archetype.
This archetype creates a very simple "Hello, World" web application.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>From the File menu, choose New Project.</p>
</li>
<li>
<p>From Categories, select Maven.
From Projects, select Project From Archetype.
Click Next.</p>
</li>
<li>
<p>Under Search enter <code>jaxrs-service</code>, select the <code>jaxrs-service-archetype</code>, and click Next.</p>
</li>
<li>
<p>Under Project Name enter <code>HelloWorldApplication</code>, set the Project Location, and set the Package name to <code>ee.jakarta.tutorial.hello</code>, and click Finish.</p>
<div class="paragraph">
<p>The project is created.</p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>In <code>HelloWorld.java</code>, find the <code>getHtml()</code> method.
Replace the <code>//TODO</code> comment with the following text, so that the finished product resembles the following method:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@GET</span>
<span class="annotation">@Produces</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">text/html</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="predefined-type">String</span> getHtml() {
    <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;html lang=</span><span class="char">\&quot;</span><span class="content">en</span><span class="char">\&quot;</span><span class="content">&gt;&lt;body&gt;&lt;h1&gt;Hello, World!!&lt;/body&gt;&lt;/h1&gt;&lt;/html&gt;</span><span class="delimiter">&quot;</span></span>;
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Because the MIME type produced is HTML, you can use HTML tags in your return statement.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Right-click the <code>HelloWorldApplication</code> project in the Projects pane and select Run.</p>
<div class="paragraph">
<p>This will build and deploy the application to GlassFish Server.</p>
</div>
</li>
<li>
<p>In a browser, open the following URL:</p>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080/HelloWorldApplication/HelloWorldApplication</pre>
</div>
</div>
<div class="paragraph">
<p>A browser window opens and displays the return value of <code>Hello, World!!</code></p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>For other sample applications that demonstrate deploying and running Jakarta REST applications using NetBeans IDE, see <a href="#the-rsvp-example-application">The rsvp Example Application</a> and Your First Cup: An Introduction to the Jakarta EE Platform at <a href="https://eclipse-ee4j.github.io/jakartaee-firstcup/toc.html" class="bare" target="_blank" rel="noopener">https://eclipse-ee4j.github.io/jakartaee-firstcup/toc.html</a>.
You may also look at the tutorials on the NetBeans IDE tutorial site, such as the one titled "Getting Started with RESTful Web Services" at <a href="https://netbeans.apache.org/kb/docs/websvc/rest.html" class="bare" target="_blank" rel="noopener">https://netbeans.apache.org/kb/docs/websvc/rest.html</a>.
This tutorial includes a section on creating a CRUD application from a database.
Create, read, update, and delete (CRUD) are the four basic functions of persistent storage and relational databases.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="the-rsvp-example-application"><a class="anchor" href="#the-rsvp-example-application"></a>The rsvp Example Application</h4>
<div class="paragraph">
<p>The <code>rsvp</code> example application, located in the <code><em>tut-install</em>/examples/jaxrs/rsvp/</code> directory, allows invitees to an event to indicate whether they will attend.
The events, people invited to the event, and the responses to the invite are stored in Apache Derby using Jakarta Persistence.
The Jakarta REST resources in <code>rsvp</code> are exposed in a stateless session enterprise bean.</p>
</div>
<div class="sect4">
<h5 id="components-of-the-rsvp-example-application"><a class="anchor" href="#components-of-the-rsvp-example-application"></a>Components of the rsvp Example Application</h5>
<div class="paragraph">
<p>The three enterprise beans in the <code>rsvp</code> example application are <code>rsvp.ejb.ConfigBean</code>, <code>rsvp.ejb.StatusBean</code>, and <code>rsvp.ejb.ResponseBean</code>.</p>
</div>
<div class="paragraph">
<p><code>ConfigBean</code> is a singleton session bean that initializes the data in the database.</p>
</div>
<div class="paragraph">
<p><code>StatusBean</code> exposes a Jakarta REST resource for displaying the current status of all invitees to an event.
The URI path template is declared first on the class and then on the <code>getEvent</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Stateless</span>
<span class="annotation">@Named</span>
<span class="annotation">@Path</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/status</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">StatusBean</span> {
    ...
    <span class="annotation">@GET</span>
    <span class="annotation">@Produces</span>({MediaType.APPLICATION_XML, MediaType.APPLICATION_JSON})
    <span class="annotation">@Path</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">{eventId}/</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="predefined-type">Event</span> getEvent(<span class="annotation">@PathParam</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">eventId</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">Long</span> eventId) {
         ...
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The combination of the two <code>@Path</code> annotations results in the following URI path template:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Path</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/status/{eventId}/</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The URI path variable <code>eventId</code> is a <code>@PathParam</code> variable in the <code>getEvent</code> method, which responds to HTTP GET requests and has been annotated with <code>@GET</code>.
The <code>eventId</code> variable is used to look up all the current responses in the database for that particular event.</p>
</div>
<div class="paragraph">
<p><code>ResponseBean</code> exposes a Jakarta REST resource for setting an invitee&#8217;s response to a particular event.
The URI path template for <code>ResponseBean</code> is declared as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Path</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/{eventId}/{inviteId}</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Two URI path variables are declared in the path template: <code>eventId</code> and <code>inviteId</code>.
As in <code>StatusBean</code>, <code>eventId</code> is the unique ID for a particular event.
Each invitee to that event has a unique ID for the invitation, and that is the <code>inviteId</code>.
Both of these path variables are used in two Jakarta REST methods in <code>ResponseBean</code>: <code>getResponse</code> and <code>putResponse</code>.
The <code>getResponse</code> method responds to HTTP GET requests and displays the invitee&#8217;s current response and a form to change the response.</p>
</div>
<div class="paragraph">
<p>The <code>ee.jakarta.tutorial.rsvp.rest.RsvpApplication</code> class defines the root application path for the resources by applying the <code>jakarta.ws.rs.ApplicationPath</code> annotation at the class level.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ApplicationPath</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/webapi</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">RsvpApplication</span> <span class="directive">extends</span> Application {
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>An invitee who wants to change his or her response selects the new response and submits the form data, which is processed as an HTTP POST request by the <code>putResponse</code> method.
The new response is extracted from the HTTP POST request and stored as the <code>userResponse</code> string.
The <code>putResponse</code> method uses <code>userResponse</code>, <code>eventId</code>, and <code>inviteId</code> to update the invitee&#8217;s response in the database.</p>
</div>
<div class="paragraph">
<p>The events, people, and responses in <code>rsvp</code> are encapsulated in Jakarta Persistence entities.
The <code>rsvp.entity.Event</code>, <code>rsvp.entity.Person</code>, and <code>rsvp.entity.Response</code> entities respectively represent events, invitees, and responses to an event.</p>
</div>
<div class="paragraph">
<p>The <code>rsvp.util.ResponseEnum</code> class declares an enumerated type that represents all the possible response statuses an invitee may have.</p>
</div>
<div class="paragraph">
<p>The web application also includes two CDI managed beans, <code>StatusManager</code> and <code>EventManager</code>, which use the Jakarta REST Client API to call the resources exposed in <code>StatusBean</code> and <code>ResponseBean</code>.
For information on how the Client API is used in <code>rsvp</code>, see <a href="#the-client-api-in-the-rsvp-example-application">The Client API in the rsvp Example Application</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="running-the-rsvp-example-application"><a class="anchor" href="#running-the-rsvp-example-application"></a>Running the rsvp Example Application</h5>
<div class="paragraph">
<p>Both NetBeans IDE and Maven can be used to deploy and run the <code>rsvp</code> example application.</p>
</div>
<div class="sect5">
<h6 id="to-run-the-rsvp-example-application-using-netbeans-ide"><a class="anchor" href="#to-run-the-rsvp-example-application-using-netbeans-ide"></a>To Run the rsvp Example Application Using NetBeans IDE</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If the database server is not already running, start it by following the instructions in <a href="#starting-and-stopping-apache-derby">Starting and Stopping Apache Derby</a>.</p>
</li>
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>From the <strong>File</strong> menu, choose <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the <strong>Open Project</strong> dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/jaxrs</pre>
</div>
</div>
</li>
<li>
<p>Select the <code>rsvp</code> folder.</p>
</li>
<li>
<p>Click <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the <strong>Projects</strong> tab, right-click the <code>rsvp</code> project and select <strong>Run</strong>.</p>
<div class="paragraph">
<p>The project will be compiled, assembled, and deployed to GlassFish Server.
A web browser window will open to the following URL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080/rsvp/index.xhtml</pre>
</div>
</div>
</li>
<li>
<p>In the web browser window, click the Event status link for the Duke&#8217;s Birthday event.</p>
<div class="paragraph">
<p>You&#8217;ll see the current invitees and their responses.</p>
</div>
</li>
<li>
<p>Click the current response of one of the invitees in the Status column of the table, select a new response, and click Update your status.</p>
<div class="paragraph">
<p>The invitee&#8217;s new status should now be displayed in the table of invitees and their response statuses.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect5">
<h6 id="to-run-the-rsvp-example-application-using-maven"><a class="anchor" href="#to-run-the-rsvp-example-application-using-maven"></a>To Run the rsvp Example Application Using Maven</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If the database server is not already running, start it by following the instructions in <a href="#starting-and-stopping-apache-derby">Starting and Stopping Apache Derby</a>.</p>
</li>
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>In a terminal window, go to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/jaxrs/rsvp/</pre>
</div>
</div>
</li>
<li>
<p>Enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">mvn install</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command builds, assembles, and deploys <code>rsvp</code> to GlassFish Server.</p>
</div>
</li>
<li>
<p>Open a web browser window to the following URL:</p>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080/rsvp/</pre>
</div>
</div>
</li>
<li>
<p>In the web browser window, click the Event status link for the Duke&#8217;s Birthday event.</p>
<div class="paragraph">
<p>You&#8217;ll see the current invitees and their responses.</p>
</div>
</li>
<li>
<p>Click the current response of one of the invitees in the Status column of the table, select a new response, and click Update your status.</p>
<div class="paragraph">
<p>The invitee&#8217;s new status should now be displayed in the table of invitees and their response statuses.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="real-world-examples"><a class="anchor" href="#real-world-examples"></a>Real-World Examples</h4>
<div class="paragraph">
<p>Most blog sites use RESTful web services.
These sites involve downloading XML files, in RSS or Atom format, that contain lists of links to other resources.
Other websites and web applications that use REST-like developer interfaces to data include Twitter and Amazon S3 (Simple Storage Service).
With Amazon S3, buckets and objects can be created, listed, and retrieved using either a REST-style HTTP interface or a SOAP interface.
The examples that ship with Jersey include a storage service example with a RESTful interface.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="further-information-about-jakarta-rest"><a class="anchor" href="#further-information-about-jakarta-rest"></a>Further Information about Jakarta REST</h3>
<div class="paragraph">
<p>For more information about RESTful web services and Jakarta REST, see</p>
</div>
<div class="ulist">
<ul>
<li>
<p>"Fielding Dissertation: Chapter 5: Representational State Transfer (REST)":<br>
<a href="https://www.ics.uci.edu/~fielding/pubs/dissertation/rest_arch_style.htm" class="bare" target="_blank" rel="noopener">https://www.ics.uci.edu/~fielding/pubs/dissertation/rest_arch_style.htm</a></p>
</li>
<li>
<p>RESTful Web Services, by Leonard Richardson and Sam Ruby, available from O&#8217;Reilly Media at <a href="https://www.oreilly.com/library/view/restful-web-services/9780596529260/" class="bare" target="_blank" rel="noopener">https://www.oreilly.com/library/view/restful-web-services/9780596529260/</a></p>
</li>
<li>
<p>Jakarta RESTful Web Services 3.0 specification:<br>
<a href="https://jakarta.ee/specifications/restful-ws/3.0/" class="bare" target="_blank" rel="noopener">https://jakarta.ee/specifications/restful-ws/3.0/</a></p>
</li>
<li>
<p>Jersey project:<br>
<a href="https://eclipse-ee4j.github.io/jersey/" class="bare" target="_blank" rel="noopener">https://eclipse-ee4j.github.io/jersey/</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="accessing-rest-resources-with-the-jakarta-rest-client-api"><a class="anchor" href="#accessing-rest-resources-with-the-jakarta-rest-client-api"></a>Chapter 33. Accessing REST Resources with the Jakarta REST Client API</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter describes the Jakarta REST Client API and includes examples of how to access REST resources using the Java programming language.</p>
</div>
<div class="paragraph">
<p>Jakarta REST provides a client API for accessing REST resources from other Java applications.</p>
</div>
<div class="sect2">
<h3 id="overview-of-the-client-api"><a class="anchor" href="#overview-of-the-client-api"></a>Overview of the Client API</h3>
<div class="paragraph">
<p>The Jakarta REST Client API provides a high-level API for accessing any REST resources, not just Jakarta REST services.
The Client API is defined in the <code>jakarta.ws.rs.client</code> package.</p>
</div>
<div class="sect3">
<h4 id="creating-a-basic-client-request-using-the-client-api"><a class="anchor" href="#creating-a-basic-client-request-using-the-client-api"></a>Creating a Basic Client Request Using the Client API</h4>
<div class="paragraph">
<p>The following steps are needed to access a REST resource using the Client API.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Obtain an instance of the <code>jakarta.ws.rs.client.Client</code> interface.</p>
</li>
<li>
<p>Configure the <code>Client</code> instance with a target.</p>
</li>
<li>
<p>Create a request based on the target.</p>
</li>
<li>
<p>Invoke the request.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The Client API is designed to be fluent, with method invocations chained together to configure and submit a request to a REST resource in only a few lines of code.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Client client = ClientBuilder.newClient();
<span class="predefined-type">String</span> name = client.target(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://example.com/webapi/hello</span><span class="delimiter">&quot;</span></span>)
        .request(MediaType.TEXT_PLAIN)
        .get(<span class="predefined-type">String</span>.class);</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the client instance is first created by calling the <code>jakarta.ws.rs.client.ClientBuilder.newClient</code> method.
Then, the request is configured and invoked by chaining method calls together in one line of code.
The <code>Client.target</code> method sets the target based on a URI.
The <code>jakarta.ws.rs.client.WebTarget.request</code> method sets the media type for the returned entity.
The <code>jakarta.ws.rs.client.Invocation.Builder.get</code> method invokes the service using an HTTP <code>GET</code> request, setting the type of the returned entity to <code>String</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="obtaining-the-client-instance"><a class="anchor" href="#obtaining-the-client-instance"></a>Obtaining the Client Instance</h4>
<div class="paragraph">
<p>The <code>Client</code> interface defines the actions and infrastructure a REST client requires to consume a RESTful web service.
Instances of <code>Client</code> are obtained by calling the <code>ClientBuilder.newClient</code> method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Client client = ClientBuilder.newClient();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Use the <code>close</code> method to close <code>Client</code> instances after all the invocations for the target resource have been performed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Client client = ClientBuilder.newClient();
...
client.close();</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>Client</code> instances are heavyweight objects.
For performance reasons, limit the number of <code>Client</code> instances in your application, as the initialization and destruction of these instances may be expensive in your runtime environment.</p>
</div>
</div>
<div class="sect3">
<h4 id="setting-the-client-target"><a class="anchor" href="#setting-the-client-target"></a>Setting the Client Target</h4>
<div class="paragraph">
<p>The target of a client, the REST resource at a particular URI, is represented by an instance of the <code>jakarta.ws.rs.client.WebTarget</code> interface.
You obtain a <code>WebTarget</code> instance by calling the <code>Client.target</code> method and passing in the URI of the target REST resource.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Client client = ClientBuilder.newClient();
WebTarget myResource = client.target(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://example.com/webapi</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>For complex REST resources, it may be beneficial to create several instances of <code>WebTarget</code>.
In the following example, a base target is used to construct several other targets that represent different services provided by a REST resource.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Client client = ClientBuilder.newClient();
WebTarget base = client.target(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://example.com/webapi</span><span class="delimiter">&quot;</span></span>);
<span class="comment">// WebTarget at http://example.com/webapi/read</span>
WebTarget read = base.path(<span class="string"><span class="delimiter">&quot;</span><span class="content">read</span><span class="delimiter">&quot;</span></span>);
<span class="comment">// WebTarget at http://example.com/webapi/write</span>
WebTarget write = base.path(<span class="string"><span class="delimiter">&quot;</span><span class="content">write</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>WebTarget.path</code> method creates a new <code>WebTarget</code> instance by appending the current target URI with the path that was passed in.</p>
</div>
</div>
<div class="sect3">
<h4 id="setting-path-parameters-in-targets"><a class="anchor" href="#setting-path-parameters-in-targets"></a>Setting Path Parameters in Targets</h4>
<div class="paragraph">
<p>Path parameters in client requests can be specified as URI template parameters, similar to the template parameters used when defining a resource URI in a Jakarta REST service.
Template parameters are specified by surrounding the template variable with braces (<code>{}</code>).
Call the <code>resolveTemplate</code> method to substitute the <code>{username}</code>, and then call the <code>queryParam</code> method to add another variable to pass.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">WebTarget myResource = client.target(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://example.com/webapi/read</span><span class="delimiter">&quot;</span></span>)
        .path(<span class="string"><span class="delimiter">&quot;</span><span class="content">{userName}</span><span class="delimiter">&quot;</span></span>)
        .resolveTemplate(<span class="string"><span class="delimiter">&quot;</span><span class="content">userName</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">janedoe</span><span class="delimiter">&quot;</span></span>)
        .queryParam(<span class="string"><span class="delimiter">&quot;</span><span class="content">chapter</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>);
<span class="comment">// http://example.com/webapi/read/janedoe?chapter=1</span>
Response response = myResource.request(...).get();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="invoking-the-request"><a class="anchor" href="#invoking-the-request"></a>Invoking the Request</h4>
<div class="paragraph">
<p>After setting and applying any configuration options to the target, call one of the <code>WebTarget.request</code> methods to begin creating the request.
This is usually accomplished by passing to <code>WebTarget.request</code> the accepted media response type for the request either as a string of the MIME type or using one of the constants in <code>jakarta.ws.rs.core.MediaType</code>.
The <code>WebTarget.request</code> method returns an instance of <code>jakarta.ws.rs.client.Invocation.Builder</code>, a helper object that provides methods for preparing the client request.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Client client = ClientBuilder.newClient();
WebTarget myResource = client.target(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://example.com/webapi/read</span><span class="delimiter">&quot;</span></span>);
Invocation.Builder builder = myResource.request(MediaType.TEXT_PLAIN);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using a <code>MediaType</code> constant is equivalent to using the string defining the MIME type.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Invocation.Builder builder = myResource.request(<span class="string"><span class="delimiter">&quot;</span><span class="content">text/plain</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>After setting the media type, invoke the request by calling one of the methods of the <code>Invocation.Builder</code> instance that corresponds to the type of HTTP request the target REST resource expects.
These methods are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>get()</code></p>
</li>
<li>
<p><code>post()</code></p>
</li>
<li>
<p><code>delete()</code></p>
</li>
<li>
<p><code>put()</code></p>
</li>
<li>
<p><code>head()</code></p>
</li>
<li>
<p><code>options()</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, if the target REST resource is for an HTTP GET request, call the <code>Invocation.Builder.get</code> method.
The return type should correspond to the entity returned by the target REST resource.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Client client = ClientBuilder.newClient();
WebTarget myResource = client.target(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://example.com/webapi/read</span><span class="delimiter">&quot;</span></span>);
<span class="predefined-type">String</span> response = myResource.request(MediaType.TEXT_PLAIN)
        .get(<span class="predefined-type">String</span>.class);</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the target REST resource is expecting an HTTP POST request, call the <code>Invocation.Builder.post</code> method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Client client = ClientBuilder.newClient();
StoreOrder order = <span class="keyword">new</span> StoreOrder(...);
WebTarget myResource = client.target(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://example.com/webapi/write</span><span class="delimiter">&quot;</span></span>);
TrackingNumber trackingNumber = myResource.request(MediaType.APPLICATION_XML)
                                   .post(<span class="predefined-type">Entity</span>.xml(order), TrackingNumber.class);</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the preceding example, the return type is a custom class and is retrieved by setting the type in the <code>Invocation.Builder.post(Entity&lt;?&gt; entity, Class&lt;T&gt; responseType)</code> method as a parameter.</p>
</div>
<div class="paragraph">
<p>If the return type is a collection, use <code>jakarta.ws.rs.core.GenericType&lt;T&gt;</code> as the response type parameter, where <code>T</code> is the collection type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">List</span>&lt;StoreOrder&gt; orders = client.target(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://example.com/webapi/read</span><span class="delimiter">&quot;</span></span>)
        .path(<span class="string"><span class="delimiter">&quot;</span><span class="content">allOrders</span><span class="delimiter">&quot;</span></span>)
        .request(MediaType.APPLICATION_XML)
        .get(<span class="keyword">new</span> GenericType&lt;<span class="predefined-type">List</span>&lt;StoreOrder&gt;&gt;() {});</code></pre>
</div>
</div>
<div class="paragraph">
<p>This preceding example shows how methods are chained together in the Client API to simplify how requests are configured and invoked.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-the-client-api-in-the-jakarta-rest-example-applications"><a class="anchor" href="#using-the-client-api-in-the-jakarta-rest-example-applications"></a>Using the Client API in the Jakarta REST Example Applications</h3>
<div class="paragraph">
<p>The <code>rsvp</code> and <code>customer</code> examples use the Client API to call Jakarta REST services.
This section describes how each example application uses the Client API.</p>
</div>
<div class="sect3">
<h4 id="the-client-api-in-the-rsvp-example-application"><a class="anchor" href="#the-client-api-in-the-rsvp-example-application"></a>The Client API in the rsvp Example Application</h4>
<div class="paragraph">
<p>The <code>rsvp</code> application allows users to respond to event invitations using Jakarta REST resources, as explained in <a href="#the-rsvp-example-application">The rsvp Example Application</a>.
The web application uses the Client API in CDI backing beans to interact with the service resources, and the Facelets web interface displays the results.</p>
</div>
<div class="paragraph">
<p>The <code>StatusManager</code> CDI backing bean retrieves all the current events in the system.
The client instance used in the backing bean is obtained in the constructor:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> StatusManager() {
    <span class="local-variable">this</span>.client = ClientBuilder.newClient();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>StatusManager.getEvents</code> method returns a collection of all the current events in the system by calling the resource at <a href="http://localhost:8080/rsvp/webapi/status/all" class="bare" target="_blank" rel="noopener">http://localhost:8080/rsvp/webapi/status/all</a>, which returns an XML document with entries for each event.
The Client API automatically unmarshals the XML and creates a <code>List&lt;Event&gt;</code> instance.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">Event</span>&gt; getEvents() {
    <span class="predefined-type">List</span>&lt;<span class="predefined-type">Event</span>&gt; returnedEvents = <span class="predefined-constant">null</span>;
    <span class="keyword">try</span> {
        returnedEvents = client.target(baseUri)
                .path(<span class="string"><span class="delimiter">&quot;</span><span class="content">all</span><span class="delimiter">&quot;</span></span>)
                .request(MediaType.APPLICATION_XML)
                .get(<span class="keyword">new</span> GenericType&lt;<span class="predefined-type">List</span>&lt;<span class="predefined-type">Event</span>&gt;&gt;() {
        });
        <span class="keyword">if</span> (returnedEvents == <span class="predefined-constant">null</span>) {
            logger.log(<span class="predefined-type">Level</span>.SEVERE, <span class="string"><span class="delimiter">&quot;</span><span class="content">Returned events null.</span><span class="delimiter">&quot;</span></span>);
        } <span class="keyword">else</span> {
            logger.log(<span class="predefined-type">Level</span>.INFO, <span class="string"><span class="delimiter">&quot;</span><span class="content">Events have been returned.</span><span class="delimiter">&quot;</span></span>);
        }
    } <span class="keyword">catch</span> (WebApplicationException ex) {
        <span class="keyword">throw</span> <span class="keyword">new</span> WebApplicationException(Response.Status.NOT_FOUND);
    }
    ...
    return returnedEvents;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>StatusManager.changeStatus</code> method is used to update the attendee&#8217;s response.
It creates an HTTP <code>POST</code> request to the service with the new response.
The body of the request is an XML document.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="predefined-type">String</span> changeStatus(ResponseEnum userResponse,
        Person person, <span class="predefined-type">Event</span> event) {
    <span class="predefined-type">String</span> navigation;
    <span class="keyword">try</span> {
        logger.log(<span class="predefined-type">Level</span>.INFO,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">changing status to {0} for {1} {2} for event ID {3}.</span><span class="delimiter">&quot;</span></span>,
                <span class="keyword">new</span> <span class="predefined-type">Object</span><span class="type">[]</span>{userResponse,
                    person.getFirstName(),
                    person.getLastName(),
                    event.getId().toString()});
            client.target(baseUri)
                    .path(event.getId().toString())
                    .path(person.getId().toString())
                    .request(MediaType.APPLICATION_XML)
                    .post(<span class="predefined-type">Entity</span>.xml(userResponse.getLabel()));
        navigation = <span class="string"><span class="delimiter">&quot;</span><span class="content">changedStatus</span><span class="delimiter">&quot;</span></span>;
    } <span class="keyword">catch</span> (ResponseProcessingException ex) {
        logger.log(<span class="predefined-type">Level</span>.WARNING, <span class="string"><span class="delimiter">&quot;</span><span class="content">couldn''t change status for {0} {1}</span><span class="delimiter">&quot;</span></span>,
                <span class="keyword">new</span> <span class="predefined-type">Object</span><span class="type">[]</span>{person.getFirstName(),
                    person.getLastName()});
        logger.log(<span class="predefined-type">Level</span>.WARNING, ex.getMessage());
        navigation = <span class="string"><span class="delimiter">&quot;</span><span class="content">error</span><span class="delimiter">&quot;</span></span>;
    }
    <span class="keyword">return</span> navigation;
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="the-client-api-in-the-customer-example-application"><a class="anchor" href="#the-client-api-in-the-customer-example-application"></a>The Client API in the customer Example Application</h4>
<div class="paragraph">
<p>The <code>customer</code> example application stores customer data in a database and exposes the resource as XML, as explained in <a href="#the-customer-example-application">The customer Example Application</a>.
The service resource exposes methods that create customers and retrieve all the customers.
A Facelets web application acts as a client for the service resource, with a form for creating customers and displaying the list of customers in a table.</p>
</div>
<div class="paragraph">
<p>The <code>CustomerBean</code> stateless session bean uses the Jakarta REST Client API to interface with the service resource.
The <code>CustomerBean.createCustomer</code> method takes the <code>Customer</code> entity instance created by the Facelets form and makes a POST call to the service URI.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="predefined-type">String</span> createCustomer(Customer customer) {
    <span class="keyword">if</span> (customer == <span class="predefined-constant">null</span>) {
        logger.log(<span class="predefined-type">Level</span>.WARNING, <span class="string"><span class="delimiter">&quot;</span><span class="content">customer is null.</span><span class="delimiter">&quot;</span></span>);
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">customerError</span><span class="delimiter">&quot;</span></span>;
    }
    <span class="predefined-type">String</span> navigation;
    Response response =
            client.target(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8080/customer/webapi/Customer</span><span class="delimiter">&quot;</span></span>)
            .request(MediaType.APPLICATION_XML)
            .post(<span class="predefined-type">Entity</span>.entity(customer, MediaType.APPLICATION_XML),
                    Response.class);
    <span class="keyword">if</span> (response.getStatus() == Status.CREATED.getStatusCode()) {
        navigation = <span class="string"><span class="delimiter">&quot;</span><span class="content">customerCreated</span><span class="delimiter">&quot;</span></span>;
    } <span class="keyword">else</span> {
        logger.log(<span class="predefined-type">Level</span>.WARNING,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">couldn''t create customer with id {0}. Status returned was {1}</span><span class="delimiter">&quot;</span></span>,
                <span class="keyword">new</span> <span class="predefined-type">Object</span><span class="type">[]</span>{customer.getId(), response.getStatus()});
        FacesContext context = FacesContext.getCurrentInstance();
        context.addMessage(<span class="predefined-constant">null</span>,
                <span class="keyword">new</span> FacesMessage(<span class="string"><span class="delimiter">&quot;</span><span class="content">Could not create customer.</span><span class="delimiter">&quot;</span></span>));
        navigation = <span class="string"><span class="delimiter">&quot;</span><span class="content">customerError</span><span class="delimiter">&quot;</span></span>;
    }
    <span class="keyword">return</span> navigation;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The XML request entity is created by calling the <code>Invocation.Builder.post</code> method, passing in a new <code>Entity</code> instance from the <code>Customer</code> instance, and specifying the media type as <code>MediaType.APPLICATION_XML</code>.</p>
</div>
<div class="paragraph">
<p>The <code>CustomerBean.retrieveCustomer</code> method retrieves a <code>Customer</code> entity instance from the service by appending the customer&#8217;s ID to the service URI.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="predefined-type">String</span> retrieveCustomer(<span class="predefined-type">String</span> id) {
    <span class="predefined-type">String</span> navigation;
    Customer customer =
            client.target(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8080/customer/webapi/Customer</span><span class="delimiter">&quot;</span></span>)
            .path(id)
            .request(MediaType.APPLICATION_XML)
            .get(Customer.class);
    <span class="keyword">if</span> (customer == <span class="predefined-constant">null</span>) {
        navigation = <span class="string"><span class="delimiter">&quot;</span><span class="content">customerError</span><span class="delimiter">&quot;</span></span>;
    } <span class="keyword">else</span> {
        navigation = <span class="string"><span class="delimiter">&quot;</span><span class="content">customerRetrieved</span><span class="delimiter">&quot;</span></span>;
    }
    <span class="keyword">return</span> navigation;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>CustomerBean.retrieveAllCustomers</code> method retrieves a collection of customers as a <code>List&lt;Customer&gt;</code> instance.
This list is then displayed as a table in the Facelets web application.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="predefined-type">List</span>&lt;Customer&gt; retrieveAllCustomers() {
    <span class="predefined-type">List</span>&lt;Customer&gt; customers =
            client.target(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8080/customer/webapi/Customer</span><span class="delimiter">&quot;</span></span>)
            .path(<span class="string"><span class="delimiter">&quot;</span><span class="content">all</span><span class="delimiter">&quot;</span></span>)
            .request(MediaType.APPLICATION_XML)
            .get(<span class="keyword">new</span> GenericType&lt;<span class="predefined-type">List</span>&lt;Customer&gt;&gt;() {
            });
    <span class="keyword">return</span> customers;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Because the response type is a collection, the <code>Invocation.Builder.get</code> method is called by passing in a new instance of <code>GenericType&lt;List&lt;Customer&gt;&gt;</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="advanced-features-of-the-client-api"><a class="anchor" href="#advanced-features-of-the-client-api"></a>Advanced Features of the Client API</h3>
<div class="paragraph">
<p>This section describes some of the advanced features of the Jakarta REST Client API.</p>
</div>
<div class="sect3">
<h4 id="configuring-the-client-request"><a class="anchor" href="#configuring-the-client-request"></a>Configuring the Client Request</h4>
<div class="paragraph">
<p>Additional configuration options may be added to the client request after it is created but before it is invoked.</p>
</div>
<div class="sect4">
<h5 id="setting-message-headers-in-the-client-request"><a class="anchor" href="#setting-message-headers-in-the-client-request"></a>Setting Message Headers in the Client Request</h5>
<div class="paragraph">
<p>You can set HTTP headers on the request by calling the <code>Invocation.Builder.header</code> method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Client client = ClientBuilder.newClient();
WebTarget myResource = client.target(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://example.com/webapi/read</span><span class="delimiter">&quot;</span></span>);
<span class="predefined-type">String</span> response = myResource.request(MediaType.TEXT_PLAIN)
        .header(<span class="string"><span class="delimiter">&quot;</span><span class="content">myHeader</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">The header value</span><span class="delimiter">&quot;</span></span>)
        .get(<span class="predefined-type">String</span>.class);</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you need to set multiple headers on the request, call the <code>Invocation.Builder.headers</code> method and pass in a <code>jakarta.ws.rs.core.MultivaluedMap</code> instance with the name-value pairs of the HTTP headers.
Calling the <code>headers</code> method replaces all the existing headers with the headers supplied in the <code>MultivaluedMap</code> instance.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Client client = ClientBuilder.newClient();
WebTarget myResource = client.target(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://example.com/webapi/read</span><span class="delimiter">&quot;</span></span>);
MultivaluedMap&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; myHeaders =
    <span class="keyword">new</span> MultivaluedMap&lt;&gt;(<span class="string"><span class="delimiter">&quot;</span><span class="content">myHeader</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">The header value</span><span class="delimiter">&quot;</span></span>);
myHeaders.add(...);
<span class="predefined-type">String</span> response = myResource.request(MediaType.TEXT_PLAIN)
        .headers(myHeaders)
        .get(<span class="predefined-type">String</span>.class);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>MultivaluedMap</code> interface allows you to specify multiple values for a given key.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">MultivaluedMap&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; myHeaders =
    <span class="keyword">new</span> MultivaluedMap&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt;();
<span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; values = <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;&gt;();
values.add(...);
myHeaders.add(<span class="string"><span class="delimiter">&quot;</span><span class="content">myHeader</span><span class="delimiter">&quot;</span></span>, values);</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="setting-cookies-in-the-client-request"><a class="anchor" href="#setting-cookies-in-the-client-request"></a>Setting Cookies in the Client Request</h5>
<div class="paragraph">
<p>You can add HTTP cookies to the request by calling the <code>Invocation.Builder.cookie</code> method, which takes a name-value pair as parameters.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Client client = ClientBuilder.newClient();
WebTarget myResource = client.target(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://example.com/webapi/read</span><span class="delimiter">&quot;</span></span>);
<span class="predefined-type">String</span> response = myResource.request(MediaType.TEXT_PLAIN)
        .cookie(<span class="string"><span class="delimiter">&quot;</span><span class="content">myCookie</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">The cookie value</span><span class="delimiter">&quot;</span></span>)
        .get(<span class="predefined-type">String</span>.class);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>jakarta.ws.rs.core.Cookie</code> class encapsulates the attributes of an HTTP cookie, including the name, value, path, domain, and RFC specification version of the cookie.
In the following example, the <code>Cookie</code> object is configured with a name-value pair, a path, and a domain.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Client client = ClientBuilder.newClient();
WebTarget myResource = client.target(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://example.com/webapi/read</span><span class="delimiter">&quot;</span></span>);
Cookie myCookie = <span class="keyword">new</span> Cookie(<span class="string"><span class="delimiter">&quot;</span><span class="content">myCookie</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">The cookie value</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">/webapi/read</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">example.com</span><span class="delimiter">&quot;</span></span>);
<span class="predefined-type">String</span> response = myResource.request(MediaType.TEXT_PLAIN)
        .cookie(myCookie)
        .get(<span class="predefined-type">String</span>.class);</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="adding-filters-to-the-client"><a class="anchor" href="#adding-filters-to-the-client"></a>Adding Filters to the Client</h5>
<div class="paragraph">
<p>You can register custom filters with the client request or the response received from the target resource.
To register filter classes when the <code>Client</code> instance is created, call the <code>Client.register</code> method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Client client = ClientBuilder.newClient().register(MyLoggingFilter.class);</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the preceding example, all invocations that use this <code>Client</code> instance have the <code>MyLoggingFilter</code> filter registered with them.</p>
</div>
<div class="paragraph">
<p>You can also register the filter classes on the target by calling <code>WebTarget.register</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Client client = ClientBuilder.newClient().register(MyLoggingFilter.class);
WebTarget target = client.target(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://example.com/webapi/secure</span><span class="delimiter">&quot;</span></span>)
        .register(MyAuthenticationFilter.class);</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the preceding example, both the <code>MyLoggingFilter</code> and <code>MyAuthenticationFilter</code> filters are attached to the invocation.</p>
</div>
<div class="paragraph">
<p>Request and response filter classes implement the <code>jakarta.ws.rs.client.ClientRequestFilter</code> and <code>jakarta.ws.rs.client.ClientResponseFilter</code> interfaces, respectively.
Both of these interfaces define a single method, <code>filter</code>.
All filters must be annotated with <code>jakarta.ws.rs.ext.Provider</code>.</p>
</div>
<div class="paragraph">
<p>The following class is a logging filter for both client requests and client responses.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Provider</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyLoggingFilter</span> <span class="directive">implements</span> ClientRequestFilter,
        ClientResponseFilter {
    <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">Logger</span> logger = <span class="predefined-type">Logger</span>.getLogger(...);

    <span class="comment">// implement the ClientRequestFilter.filter method</span>
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> filter(ClientRequestContext requestContext)
            <span class="directive">throws</span> <span class="exception">IOException</span> {
        logger.log(...);
        ...
    }

    <span class="comment">// implement the ClientResponseFilter.filter method</span>
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> filter(ClientRequestContext requestContext,
           ClientResponseContext responseContext) <span class="directive">throws</span> <span class="exception">IOException</span> {
        logger.log(...);
        ...
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the invocation must be stopped while the filter is active, call the context object&#8217;s <code>abortWith</code> method, and pass in a <code>jakarta.ws.rs.core.Response</code> instance from within the filter.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> filter(ClientRequestContext requestContext) <span class="directive">throws</span> <span class="exception">IOException</span> {
    ...
    Response response = <span class="keyword">new</span> Response();
    response.status(<span class="integer">500</span>);
    requestContext.abortWith(response);
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="asynchronous-invocations-in-the-client-api"><a class="anchor" href="#asynchronous-invocations-in-the-client-api"></a>Asynchronous Invocations in the Client API</h4>
<div class="paragraph">
<p>In networked applications, network issues can affect the perceived performance of the application, particularly in long-running or complicated network calls.
Asynchronous processing helps prevent blocking and makes better use of an application&#8217;s resources.</p>
</div>
<div class="paragraph">
<p>In the Jakarta REST Client API, the <code>Invocation.Builder.async</code> method is used when constructing a client request to indicate that the call to the service should be performed asynchronously.
An asynchronous invocation returns control to the caller immediately, with a return type of <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/Future.html?is-external=true"><code>java.util.concurrent.Future&lt;T&gt;</code></a> (part of the Java SE concurrency API) and with the type set to the return type of the service call.
<code>Future&lt;T&gt;</code> objects have methods to check if the asynchronous call has been completed, to retrieve the final result, to cancel the invocation, and to check if the invocation has been cancelled.</p>
</div>
<div class="paragraph">
<p>The following example shows how to invoke an asynchronous request on a resource.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Client client = ClientBuilder.newClient();
WebTarget myResource = client.target(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://example.com/webapi/read</span><span class="delimiter">&quot;</span></span>);
<span class="predefined-type">Future</span>&lt;<span class="predefined-type">String</span>&gt; response = myResource.request(MediaType.TEXT_PLAIN)
        .async()
        .get(<span class="predefined-type">String</span>.class);</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="using-custom-callbacks-in-asynchronous-invocations"><a class="anchor" href="#using-custom-callbacks-in-asynchronous-invocations"></a>Using Custom Callbacks in Asynchronous Invocations</h5>
<div class="paragraph">
<p>The <code>InvocationCallback</code> interface defines two methods, <code>completed</code> and <code>failed</code>, that are called when an asynchronous invocation either completes successfully or fails, respectively.
You may register an <code>InvocationCallback</code> instance on your request by creating a new instance when specifying the request method.</p>
</div>
<div class="paragraph">
<p>The following example shows how to register a callback object on an asynchronous invocation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Client client = ClientBuilder.newClient();
WebTarget myResource = client.target(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://example.com/webapi/read</span><span class="delimiter">&quot;</span></span>);
<span class="predefined-type">Future</span>&lt;Customer&gt; fCustomer = myResource.request(MediaType.TEXT_PLAIN)
        .async()
        .get(<span class="keyword">new</span> InvocationCallback&lt;Customer&gt;() {
            <span class="annotation">@Override</span>
            <span class="directive">public</span> <span class="type">void</span> completed(Customer customer) {
            <span class="comment">// Do something with the customer object</span>
            }
            <span class="annotation">@Override</span>
             <span class="directive">public</span> <span class="type">void</span> failed(<span class="predefined-type">Throwable</span> throwable) {
            <span class="comment">// handle the error</span>
            }
        });</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="using-reactive-approach-in-asynchronous-invocations"><a class="anchor" href="#using-reactive-approach-in-asynchronous-invocations"></a>Using Reactive Approach in Asynchronous Invocations</h5>
<div class="paragraph">
<p>Using custom callbacks in asynchronous invocations is easy in simple cases and when there are many independent calls to make.
In nested calls, using custom callbacks becomes very difficult to implement, debug, and maintain.</p>
</div>
<div class="paragraph">
<p>Jakarta REST defines a new type of invoker called as <code>RxInvoker</code> and a default implementation of this type is <code>CompletionStageRxInvoker</code>.
The new <code>rx</code> method is used as in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">CompletionStage&lt;<span class="predefined-type">String</span>&gt; csf = client.target(<span class="string"><span class="delimiter">&quot;</span><span class="content">forecast/{destination}</span><span class="delimiter">&quot;</span></span>)
    .resolveTemplate(<span class="string"><span class="delimiter">&quot;</span><span class="content">destination</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">mars</span><span class="delimiter">&quot;</span></span>)
    .request().rx().get(<span class="predefined-type">String</span>.class);
csf.thenAccept(<span class="predefined-type">System</span>.out::println);</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example, an asynchronous processing of the interface <code>CompletionStage&lt;String&gt;</code> is created and waits till it is completed and the result is displayed.
The <code>CompletionStage</code> that is returned can then be used only to retrieve the result as shown in the above example or can be combined with other completion stages to ease and improve the processing of asynchronous tasks.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="using-server-sent-events"><a class="anchor" href="#using-server-sent-events"></a>Using Server-Sent Events</h4>
<div class="paragraph">
<p>Server-sent Events (SSE) technology is used to asynchronously push notifications to the client over standard HTTP or HTTPS protocol.
Clients can subscribe to event notifications that originate on a server.
Server generates events and sends these events back to the clients that are subscribed to receive the notifications.
The one-way communication channel connection is established by the client.
Once the connection is established, the server sends events to the client whenever new data is available.</p>
</div>
<div class="paragraph">
<p>The communication channel established by the client lasts till the client closes the connection and it is also re-used by the server to send multiple events from the server.</p>
</div>
</div>
<div class="sect3">
<h4 id="overview-of-the-sse-api"><a class="anchor" href="#overview-of-the-sse-api"></a>Overview of the SSE API</h4>
<div class="paragraph">
<p>The SSE API is defined in the <code>jakarta.ws.rs.sse</code> package that includes the interfaces <code>SseEventSink</code>, <code>SseEvent</code>, <code>Sse</code>, and <code>SseEventSource</code>.
To accept connections and send events to one or more clients, inject an <code>SseEventSink</code> in the resource method that produces the media type <code>text/event-stream</code>.</p>
</div>
<div class="paragraph">
<p>The following example shows how to accept the SSE connections and to send events to the clients:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@GET</span>
<span class="annotation">@Path</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">eventStream</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@Produces</span>(MediaType.SERVER_SENT_EVENTS)
<span class="directive">public</span> <span class="type">void</span> eventStream(<span class="annotation">@Context</span> SseEventSink eventSink, <span class="annotation">@Context</span> Sse sse) {
    executor.execute(() -&gt; {
        <span class="keyword">try</span> (SseEventSink sink = eventSink) {
            eventSink.send(sse.newEvent(<span class="string"><span class="delimiter">&quot;</span><span class="content">event1</span><span class="delimiter">&quot;</span></span>));
            eventSink.send(sse.newEvent(<span class="string"><span class="delimiter">&quot;</span><span class="content">event2</span><span class="delimiter">&quot;</span></span>));
            eventSink.send(sse.newEvent(<span class="string"><span class="delimiter">&quot;</span><span class="content">event3</span><span class="delimiter">&quot;</span></span>));
        }
    });
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>SseEventsink</code> is injected into the resource method and the underlying client connection is kept open and used to send events.
The connection persists until the client disconnects from the server.
The method <code>send</code> returns an instance of <code>CompletionStage&lt;T&gt;</code> which indicates the action of asynchronously sending a message to a client is enabled.</p>
</div>
<div class="paragraph">
<p>The events that are streamed to the clients can be defined with the details such as <code>event</code>, <code>data</code>, <code>id</code>, <code>retry</code>, and <code>comment</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="broadcasting-using-sse"><a class="anchor" href="#broadcasting-using-sse"></a>Broadcasting Using SSE</h4>
<div class="paragraph">
<p>Broadcasting is the action of sending events to multiple clients simultaneously.
Jakarta REST SSE API provides <code>SseBroadcaster</code> to register all <code>SseEventSink</code> instances and send events to all registered event outputs.
The life-cycle and scope of an <code>SseBroadcaster</code> is fully controlled by applications and not the Jakarta REST runtime.
The following example show the use of broadcasters:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Path</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@Singleton</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">SseResource</span> {
    <span class="annotation">@Context</span>
    <span class="directive">private</span> Sse sse;

    <span class="directive">private</span> <span class="directive">volatile</span> SseBroadcaster sseBroadcaster;

    <span class="annotation">@PostConstruct</span>
    <span class="directive">public</span> init() {
        <span class="local-variable">this</span>.sseBroadcaster = sse.newBroadcaster();
    }

    <span class="annotation">@GET</span>
    <span class="annotation">@Path</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">register</span><span class="delimiter">&quot;</span></span>)
    <span class="annotation">@Produces</span>(MediaType.SERVER_SENT_EVENTS)
        <span class="directive">public</span> <span class="type">void</span> register(<span class="annotation">@Context</span> SseEventSink eventSink) {
        eventSink.send(sse.newEvent(<span class="string"><span class="delimiter">&quot;</span><span class="content">welcome!</span><span class="delimiter">&quot;</span></span>));
        sseBroadcaster.register(eventSink);
    }

    <span class="annotation">@POST</span>
    <span class="annotation">@Path</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">broadcast</span><span class="delimiter">&quot;</span></span>)
    <span class="annotation">@Consumes</span>(MediaType.MULTIPART_FORM_DATA)
    <span class="directive">public</span> <span class="type">void</span> broadcast(<span class="annotation">@FormParam</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">event</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">String</span> event) {
        sseBroadcaster.broadcast(sse.newEvent(event));
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>@Singleton</code> annotation is defined for the resource class restricting the creation of multiple instances of the class.
The <code>register</code> method on a broadcaster is used to add a new <code>SseEventSink</code>; the <code>broadcast</code> method is used to send an SSE event to all registered clients.</p>
</div>
</div>
<div class="sect3">
<h4 id="listening-and-receiving-events"><a class="anchor" href="#listening-and-receiving-events"></a>Listening and Receiving Events</h4>
<div class="paragraph">
<p>Jakarta REST SSE provides the <code>SseEventSource</code> interface for the client to subscribe to notifications.
The client can get asynchronously notified about incoming events by invoking one of the <code>subscribe</code> methods in <code>jakarta.ws.rs.sse.SseEventSource</code>.</p>
</div>
<div class="paragraph">
<p>The following example shows how to use the <code>SseEventSource</code> API to open an SSE connection and read some of the messages for a period:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">WebTarget target = client.target(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://...</span><span class="delimiter">&quot;</span></span>);
<span class="keyword">try</span> (SseEventSource source = SseEventSource.target(target).build()) {
    source.register(<span class="predefined-type">System</span>.out::println);
    source.open();
    <span class="predefined-type">Thread</span>.sleep(<span class="integer">500</span>); <span class="comment">// Consume events for just 500 ms</span>
    source.close();
} <span class="keyword">catch</span> (<span class="exception">InterruptedException</span> e) {
    <span class="comment">// falls through</span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="jakarta-rest-advanced-topics-and-an-example"><a class="anchor" href="#jakarta-rest-advanced-topics-and-an-example"></a>Chapter 34. Jakarta REST: Advanced Topics and an Example</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Jakarta RESTful Web Services (Jakarta REST) is designed to make it easy to develop applications that use the REST architecture.
This chapter describes advanced features of Jakarta REST.
If you are new to Jakarta REST, see <a href="#building-restful-web-services-with-jakarta-rest">Chapter 32, <em>Building RESTful Web Services with Jakarta REST</em></a> before you proceed with this chapter.</p>
</div>
<div class="paragraph">
<p>Jakarta REST is integrated with Jakarta Contexts and Dependency Injection (CDI), Jakarta Enterprise Beans technology, and Jakarta Servlet technology.</p>
</div>
<div class="sect2">
<h3 id="annotations-for-field-and-bean-properties-of-resource-classes"><a class="anchor" href="#annotations-for-field-and-bean-properties-of-resource-classes"></a>Annotations for Field and Bean Properties of Resource Classes</h3>
<div class="paragraph">
<p>Jakarta REST annotations for resource classes let you extract specific parts or values from a Uniform Resource Identifier (URI) or request header.</p>
</div>
<div class="paragraph">
<p>Jakarta REST provides the annotations listed in <a href="#advanced-jakarta-rest-annotations">Table 34-1</a>.</p>
</div>
<table id="advanced-jakarta-rest-annotations" class="tableblock frame-all grid-all" style="width: 99%;">
<caption class="title">Table 34-1 Advanced Jakarta REST Annotations</caption>
<colgroup>
<col style="width: 5%;">
<col style="width: 95%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Annotation</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Context</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Injects information into a class field, bean property, or method parameter</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@CookieParam</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Extracts information from cookies declared in the cookie request header</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@FormParam</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Extracts information from a request representation whose content type is <code>application/x-www-form-urlencoded</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@HeaderParam</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Extracts the value of a header</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@MatrixParam</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Extracts the value of a URI matrix parameter</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@PathParam</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Extracts the value of a URI template parameter</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@QueryParam</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Extracts the value of a URI query parameter</p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="extracting-path-parameters"><a class="anchor" href="#extracting-path-parameters"></a>Extracting Path Parameters</h4>
<div class="paragraph">
<p>URI path templates are URIs with variables embedded within the URI syntax.
The <code>@PathParam</code> annotation lets you use variable URI path fragments when you call a method.</p>
</div>
<div class="paragraph">
<p>The following code snippet shows how to extract the last name of an employee when the employee&#8217;s email address is provided:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Path</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/employees/{firstname}.{lastname}@{domain}.com</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">EmpResource</span> {

    <span class="annotation">@GET</span>
    <span class="annotation">@Produces</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">text/xml</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="predefined-type">String</span> getEmployeelastname(<span class="annotation">@PathParam</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">lastname</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">String</span> lastName) {
      ...
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the <code>@Path</code> annotation defines the URI variables (or path parameters) <code>{firstname}</code>, <code>{lastname}</code>, and <code>{domain}</code>.
The <code>@PathParam</code> in the method parameter of the request method extracts the last name from the email address.</p>
</div>
<div class="paragraph">
<p>If your HTTP request is <code>GET</code> <code>/employees/john.doe@example.com</code>, the value &#8220;doe&#8221; is injected into <code>{lastname}</code>.</p>
</div>
<div class="paragraph">
<p>You can specify several path parameters in one URI.</p>
</div>
<div class="paragraph">
<p>You can declare a regular expression with a URI variable.
For example, if it is required that the last name must consist only of lowercase and uppercase characters, you can declare the following regular expression:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Path</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/employees/{firstname}.{lastname[a-zA-Z]*}@{domain}.com</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the last name does not match the regular expression, a 404 response is returned.</p>
</div>
</div>
<div class="sect3">
<h4 id="extracting-query-parameters"><a class="anchor" href="#extracting-query-parameters"></a>Extracting Query Parameters</h4>
<div class="paragraph">
<p>Use the <code>@QueryParam</code> annotation to extract query parameters from the query component of the request URI.</p>
</div>
<div class="paragraph">
<p>For instance, to query all employees who have joined within a specific range of years, use a method signature like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Path</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/employees/</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@GET</span>
<span class="directive">public</span> Response getEmployees(
        <span class="annotation">@DefaultValue</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">2003</span><span class="delimiter">&quot;</span></span>) <span class="annotation">@QueryParam</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">minyear</span><span class="delimiter">&quot;</span></span>) <span class="type">int</span> minyear,
        <span class="annotation">@DefaultValue</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">2013</span><span class="delimiter">&quot;</span></span>) <span class="annotation">@QueryParam</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">maxyear</span><span class="delimiter">&quot;</span></span>) <span class="type">int</span> maxyear)
    {...}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This code snippet defines two query parameters, <code>minyear</code> and <code>maxyear</code>.
The following HTTP request would query for all employees who have joined between 2003 and 2013:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="http">GET /employees?maxyear=2013&amp;minyear=2003</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>@DefaultValue</code> annotation defines a default value, which is to be used if no values are provided for the query parameters.
By default, Jakarta REST assigns a null value for <code>Object</code> values and zero for primitive data types.
You can use the <code>@DefaultValue</code> annotation to eliminate null or zero values and define your own default values for a parameter.</p>
</div>
</div>
<div class="sect3">
<h4 id="extracting-form-data"><a class="anchor" href="#extracting-form-data"></a>Extracting Form Data</h4>
<div class="paragraph">
<p>Use the <code>@FormParam</code> annotation to extract form parameters from HTML forms.
For example, the following form accepts the name, address, and manager&#8217;s name of an employee:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><span class="tag">&lt;FORM</span> <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://example.com/employees/</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">method</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">post</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;p&gt;</span>
    <span class="tag">&lt;fieldset&gt;</span>
      Employee name: <span class="tag">&lt;INPUT</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">empname</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">tabindex</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      Employee address: <span class="tag">&lt;INPUT</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">empaddress</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">tabindex</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      Manager name: <span class="tag">&lt;INPUT</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">managername</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">tabindex</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">3</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;/fieldset&gt;</span>
  <span class="tag">&lt;/p&gt;</span>
<span class="tag">&lt;/FORM&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Use the following code snippet to extract the manager name from this HTML form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@POST</span>
<span class="annotation">@Consumes</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">application/x-www-form-urlencoded</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">void</span> post(<span class="annotation">@FormParam</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">managername</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">String</span> managername) {
    <span class="comment">// Store the value</span>
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To obtain a map of form parameter names to values, use a code snippet like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@POST</span>
<span class="annotation">@Consumes</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">application/x-www-form-urlencoded</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">void</span> post(MultivaluedMap&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; formParams) {
    <span class="comment">// Store the message</span>
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="extracting-the-java-type-of-a-request-or-response"><a class="anchor" href="#extracting-the-java-type-of-a-request-or-response"></a>Extracting the Java Type of a Request or Response</h4>
<div class="paragraph">
<p>The <code>jakarta.ws.rs.core.Context</code> annotation retrieves the Java types related to a request or response.</p>
</div>
<div class="paragraph">
<p>The <code>jakarta.ws.rs.core.UriInfo</code> interface provides information about the components of a request URI.
The following code snippet shows how to obtain a map of query and path parameter names to values:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@GET</span>
<span class="directive">public</span> <span class="predefined-type">String</span> getParams(<span class="annotation">@Context</span> UriInfo ui) {
    MultivaluedMap&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; queryParams = ui.getQueryParameters();
    MultivaluedMap&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; pathParams = ui.getPathParameters();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>jakarta.ws.rs.core.HttpHeaders</code> interface provides information about request headers and cookies.
The following code snippet shows how to obtain a map of header and cookie parameter names to values:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@GET</span>
<span class="directive">public</span> <span class="predefined-type">String</span> getHeaders(<span class="annotation">@Context</span> HttpHeaders hh) {
    MultivaluedMap&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; headerParams = hh.getRequestHeaders();
    MultivaluedMap&lt;<span class="predefined-type">String</span>, Cookie&gt; pathParams = hh.getCookies();
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="validating-resource-data-with-bean-validation"><a class="anchor" href="#validating-resource-data-with-bean-validation"></a>Validating Resource Data with Bean Validation</h3>
<div class="paragraph">
<p>Jakarta REST supports Bean Validation to verify Jakarta REST resource classes.
This support consists of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Adding constraint annotations to resource method parameters</p>
</li>
<li>
<p>Ensuring entity data is valid when the entity is passed in as a parameter</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="using-constraint-annotations-on-resource-methods"><a class="anchor" href="#using-constraint-annotations-on-resource-methods"></a>Using Constraint Annotations on Resource Methods</h4>
<div class="paragraph">
<p>Bean Validation constraint annotations may be applied to parameters for a resource.
The server will validate the parameters and either pass or throw a <code>jakarta.validation.ValidationException</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@POST</span>
<span class="annotation">@Path</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/createUser</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@Consumes</span>(MediaType.APPLICATION_FORM_URLENCODED)
<span class="directive">public</span> <span class="type">void</span> createUser(<span class="annotation">@NotNull</span> <span class="annotation">@FormParam</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">username</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">String</span> username,
                       <span class="annotation">@NotNull</span> <span class="annotation">@FormParam</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">firstName</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">String</span> firstName,
                       <span class="annotation">@NotNull</span> <span class="annotation">@FormParam</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">lastName</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">String</span> lastName,
                       <span class="annotation">@Email</span> <span class="annotation">@FormParam</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">email</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">String</span> email) {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the preceding example, the built-in constraint <code>@NotNull</code> is applied to the <code>username</code>, <code>firstName</code>, and <code>lastName</code> form fields.
Another built-in constraint <code>@Email</code> validates that the email address supplied by the <code>email</code> form field is correctly formatted.</p>
</div>
<div class="paragraph">
<p>The constraints may also be applied to fields within a resource class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Path</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/createUser</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">CreateUserResource</span> {
  <span class="annotation">@NotNull</span>
  <span class="annotation">@FormParam</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">username</span><span class="delimiter">&quot;</span></span>)
  <span class="directive">private</span> <span class="predefined-type">String</span> username;

  <span class="annotation">@NotNull</span>
  <span class="annotation">@FormParam</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">firstName</span><span class="delimiter">&quot;</span></span>)
  <span class="directive">private</span> <span class="predefined-type">String</span> firstName;

  <span class="annotation">@NotNull</span>
  <span class="annotation">@FormParam</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">lastName</span><span class="delimiter">&quot;</span></span>)
  <span class="directive">private</span> <span class="predefined-type">String</span> lastName;

  <span class="annotation">@Email</span>
  <span class="annotation">@FormParam</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">email</span><span class="delimiter">&quot;</span></span>)
  <span class="directive">private</span> <span class="predefined-type">String</span> email;

  ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the preceding example, the same constraints that were applied to the method parameters in the previous example are applied to the class fields.
The behavior is the same in both examples.</p>
</div>
<div class="paragraph">
<p>Constraints may also be applied to a resource class&#8217;s JavaBeans properties by adding the constraint annotations to the getter method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Path</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/createuser</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">CreateUserResource</span> {
  <span class="directive">private</span> <span class="predefined-type">String</span> username;

  <span class="annotation">@FormParam</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">username</span><span class="delimiter">&quot;</span></span>)
  <span class="directive">public</span> <span class="type">void</span> setUsername(<span class="predefined-type">String</span> username) {
    <span class="local-variable">this</span>.username = username;
  }

  <span class="annotation">@NotNull</span>
  <span class="directive">public</span> <span class="predefined-type">String</span> getUsername() {
    <span class="keyword">return</span> username;
  }
  ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Constraints may also be applied at the resource class level.
In the following example, <code>@PhoneRequired</code> is a user-defined constraint that ensures that a user enters at least one phone number.
That is, either <code>homePhone</code> or <code>mobilePhone</code> can be null, but not both.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Path</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/createUser</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@PhoneRequired</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">CreateUserResource</span> {
  <span class="annotation">@FormParam</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">homePhone</span><span class="delimiter">&quot;</span></span>)
  <span class="directive">private</span> Phone homePhone;

  <span class="annotation">@FormParam</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">mobilePhone</span><span class="delimiter">&quot;</span></span>)
  <span class="directive">private</span> Phone mobilePhone;
  ...
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="validating-entity-data"><a class="anchor" href="#validating-entity-data"></a>Validating Entity Data</h4>
<div class="paragraph">
<p>Classes that contain validation constraint annotations may be used in method parameters in a resource class.
To validate these entity classes, use the <code>@Valid</code> annotation on the method parameter.
For example, the following class is a user-defined class containing both standard and user-defined validation constraints.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@PhoneRequired</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">User</span> {
  <span class="annotation">@NotNull</span>
  <span class="directive">private</span> <span class="predefined-type">String</span> username;

  <span class="directive">private</span> Phone homePhone;

  <span class="directive">private</span> Phone mobilePhone;
  ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This entity class is used as a parameter to a resource method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Path</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/createUser</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">CreateUserResource</span> {
  ...
  <span class="annotation">@POST</span>
  <span class="annotation">@Consumers</span>(MediaType.APPLICATION_XML)
  <span class="directive">public</span> <span class="type">void</span> createUser(<span class="annotation">@Valid</span> User user) {
    ...
  }
  ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>@Valid</code> annotation ensures that the entity class is validated at runtime.
Additional user-defined constraints can also trigger validation of an entity.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Path</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/createUser</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">CreateUserResource</span> {
  ...
  <span class="annotation">@POST</span>
  <span class="annotation">@Consumers</span>(MediaType.APPLICATION_XML)
  <span class="directive">public</span> <span class="type">void</span> createUser(<span class="annotation">@ActiveUser</span> User user) {
    ...
  }
  ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the preceding example, the user-defined <code>@ActiveUser</code> constraint is applied to the <code>User</code> class in addition to the <code>@PhoneRequired</code> and <code>@NotNull</code> constraints defined within the entity class.</p>
</div>
<div class="paragraph">
<p>If a resource method returns an entity class, validation may be triggered by applying the <code>@Valid</code> or any other user-defined constraint annotation to the resource method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Path</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/getUser</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">GetUserResource</span> {
  ...
  <span class="annotation">@GET</span>
  <span class="annotation">@Path</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">{username}</span><span class="delimiter">&quot;</span></span>)
  <span class="annotation">@Produces</span>(MediaType.APPLICATION_XML)
  <span class="annotation">@ActiveUser</span>
  <span class="annotation">@Valid</span>
  <span class="directive">public</span> User getUser(<span class="annotation">@PathParam</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">username</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">String</span> username) {
    <span class="comment">// find the User</span>
    <span class="keyword">return</span> user;
  }
  ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As in the previous example, the <code>@ActiveUser</code> constraint is applied to the returned entity class as well as the <code>@PhoneRequired</code> and <code>@NotNull</code> constraints defined within the entity class.</p>
</div>
</div>
<div class="sect3">
<h4 id="validation-exception-handling-and-response-codes"><a class="anchor" href="#validation-exception-handling-and-response-codes"></a>Validation Exception Handling and Response Codes</h4>
<div class="paragraph">
<p>If a <code>jakarta.validation.ValidationException</code> or any subclass of <code>ValidationException</code> except <code>ConstraintValidationException</code> is thrown, the Jakarta REST runtime will respond to the client request with a 500 (Internal Server Error) HTTP status code.</p>
</div>
<div class="paragraph">
<p>If a <code>ConstraintValidationException</code> is thrown, the Jakarta REST runtime will respond to the client with one of the following HTTP status codes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>500</code> (Internal Server Error) if the exception was thrown while validating a method return type</p>
</li>
<li>
<p><code>400</code> (Bad Request) in all other cases</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="subresources-and-runtime-resource-resolution"><a class="anchor" href="#subresources-and-runtime-resource-resolution"></a>Subresources and Runtime Resource Resolution</h3>
<div class="paragraph">
<p>You can use a resource class to process only a part of the URI request.
A root resource can then implement subresources that can process the remainder of the URI path.</p>
</div>
<div class="paragraph">
<p>A resource class method that is annotated with <code>@Path</code> is either a subresource method or a subresource locator.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A subresource method is used to handle requests on a subresource of the corresponding resource.</p>
</li>
<li>
<p>A subresource locator is used to locate subresources of the corresponding resource.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="subresource-methods"><a class="anchor" href="#subresource-methods"></a>Subresource Methods</h4>
<div class="paragraph">
<p>A subresource method handles an HTTP request directly.
The method must be annotated with a request method designator, such as <code>@GET</code> or <code>@POST</code>, in addition to <code>@Path</code>.
The method is invoked for request URIs that match a URI template created by concatenating the URI template of the resource class with the URI template of the method.</p>
</div>
<div class="paragraph">
<p>The following code snippet shows how a subresource method can be used to extract the last name of an employee when the employee&#8217;s email address is provided:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Path</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/employeeinfo</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">EmployeeInfo</span> {

    <span class="directive">public</span> employeeinfo() {}

    <span class="annotation">@GET</span>
    <span class="annotation">@Path</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/employees/{firstname}.{lastname}@{domain}.com</span><span class="delimiter">&quot;</span></span>)
    <span class="annotation">@Produces</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">text/xml</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="predefined-type">String</span> getEmployeeLastName(<span class="annotation">@PathParam</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">lastname</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">String</span> lastName) {
       ...
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>getEmployeeLastName</code> method returns <code>doe</code> for the following <code>GET</code> request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="http">GET /employeeinfo/employees/john.doe@example.com</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="subresource-locators"><a class="anchor" href="#subresource-locators"></a>Subresource Locators</h4>
<div class="paragraph">
<p>A subresource locator returns an object that will handle an HTTP request.
The method must not be annotated with a request method designator.
You must declare a subresource locator within a subresource class, and only subresource locators are used for runtime resource resolution.</p>
</div>
<div class="paragraph">
<p>The following code snippet shows a subresource locator:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// Root resource class</span>
<span class="annotation">@Path</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/employeeinfo</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">EmployeeInfo</span> {

    <span class="comment">// Subresource locator: obtains the subresource Employee</span>
    <span class="comment">// from the path /employeeinfo/employees/{empid}</span>
    <span class="annotation">@Path</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/employees/{empid}</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> Employee getEmployee(<span class="annotation">@PathParam</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">empid</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">String</span> id) {
        <span class="comment">// Find the Employee based on the id path parameter</span>
        Employee emp = ...;
        ...
        return emp;
    }
}

<span class="comment">// Subresource class</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Employee</span> {

    <span class="comment">// Subresource method: returns the employee's last name</span>
    <span class="annotation">@GET</span>
    <span class="annotation">@Path</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/lastname</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="predefined-type">String</span> getEmployeeLastName() {
        ...
        return lastName;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this code snippet, the <code>getEmployee</code> method is the subresource locator that provides the <code>Employee</code> object, which services requests for <code>lastname</code>.</p>
</div>
<div class="paragraph">
<p>If your HTTP request is <code>GET /employeeinfo/employees/as209/</code>, the <code>getEmployee</code> method returns an <code>Employee</code> object whose id is <code>as209</code>. At runtime, Jakarta REST sends a <code>GET /employeeinfo/employees/as209/lastname</code> request to the <code>getEmployeeLastName</code> method.
The <code>getEmployeeLastName</code> method retrieves and returns the last name of the employee whose id is <code>as209</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="integrating-jakarta-rest-with-jakarta-enterprise-beans-technology-and-cdi"><a class="anchor" href="#integrating-jakarta-rest-with-jakarta-enterprise-beans-technology-and-cdi"></a>Integrating Jakarta REST with Jakarta Enterprise Beans Technology and CDI</h3>
<div class="paragraph">
<p>Jakarta REST works with Jakarta Enterprise Beans technology and Jakarta Contexts and Dependency Injection (CDI).</p>
</div>
<div class="paragraph">
<p>In general, for Jakarta REST to work with enterprise beans, you need to annotate the class of a bean with <code>@Path</code> to convert it to a root resource class.
You can use the <code>@Path</code> annotation with stateless session beans and singleton POJO beans.</p>
</div>
<div class="paragraph">
<p>The following code snippet shows a stateless session bean and a singleton bean that have been converted to Jakarta REST root resource classes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Stateless</span>
<span class="annotation">@Path</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">stateless-bean</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">StatelessResource</span> {...}

<span class="annotation">@Singleton</span>
<span class="annotation">@Path</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">singleton-bean</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">SingletonResource</span> {...}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Session beans can also be used for subresources.</p>
</div>
<div class="paragraph">
<p>Jakarta REST and CDI have slightly different component models.
By default, Jakarta REST root resource classes are managed in the request scope, and no annotations are required for specifying the scope.
CDI managed beans annotated with <code>@RequestScoped</code> or <code>@ApplicationScoped</code> can be converted to Jakarta REST resource classes.</p>
</div>
<div class="paragraph">
<p>The following code snippet shows a Jakarta REST resource class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Path</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/employee/{id}</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">Employee</span> {
    <span class="directive">public</span> Employee(<span class="annotation">@PathParam</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">String</span> id) {...}
}

<span class="annotation">@Path</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">{lastname}</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="directive">final</span> <span class="type">class</span> <span class="class">EmpDetails</span> {...}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following code snippet shows this Jakarta REST resource class converted to a CDI bean.
The beans must be proxyable, so the <code>Employee</code> class requires a nonprivate constructor with no parameters, and the <code>EmpDetails</code> class must not be <code>final</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Path</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/employee/{id}</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@RequestScoped</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Employee</span> {
    <span class="directive">public</span> Employee() {...}

    <span class="annotation">@Inject</span>
    <span class="directive">public</span> Employee(<span class="annotation">@PathParam</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">String</span> id) {...}
}

<span class="annotation">@Path</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">{lastname}</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@RequestScoped</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">EmpDetails</span> {...}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="conditional-http-requests"><a class="anchor" href="#conditional-http-requests"></a>Conditional HTTP Requests</h3>
<div class="paragraph">
<p>Jakarta REST provides support for conditional <code>GET</code> and <code>PUT</code> HTTP requests.
Conditional <code>GET</code> requests help save bandwidth by improving the efficiency of client processing.</p>
</div>
<div class="paragraph">
<p>A <code>GET</code> request can return a Not Modified (304) response if the representation has not changed since the previous request.
For example, a website can return 304 responses for all its static images that have not changed since the previous request.</p>
</div>
<div class="paragraph">
<p>A <code>PUT</code> request can return a Precondition Failed (412) response if the representation has been modified since the last request.
The conditional <code>PUT</code> can help avoid the lost update problem.</p>
</div>
<div class="paragraph">
<p>Conditional HTTP requests can be used with the <code>Last-Modified</code> and <code>ETag</code> headers.
The <code>Last-Modified</code> header can represent dates with granularity of one second.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Path</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/employee/{joiningdate}</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">Employee</span> {

    <span class="predefined-type">Date</span> joiningdate;

    <span class="annotation">@GET</span>
    <span class="annotation">@Produces</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">application/xml</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> Employee(<span class="annotation">@PathParam</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">joiningdate</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">Date</span> joiningdate,
                    <span class="annotation">@Context</span> Request req,
                    <span class="annotation">@Context</span> UriInfo ui) {

        <span class="local-variable">this</span>.joiningdate = joiningdate;
        ...
        this.tag = computeEntityTag(ui.getRequestUri());
        <span class="keyword">if</span> (req.getMethod().equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">GET</span><span class="delimiter">&quot;</span></span>)) {
            Response.ResponseBuilder rb = req.evaluatePreconditions(tag);
            <span class="keyword">if</span> (rb != <span class="predefined-constant">null</span>) {
                <span class="keyword">throw</span> <span class="keyword">new</span> WebApplicationException(rb.build());
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this code snippet, the constructor of the <code>Employee</code> class computes the entity tag from the request URI and calls the <code>request.evaluatePreconditions</code> method with that tag.
If a client request returns an <code>If-none-match</code> header with a value that has the same entity tag that was computed, <code>evaluate.Preconditions</code> returns a pre-filled-out response with a 304 status code and an entity tag set that may be built and returned.</p>
</div>
</div>
<div class="sect2">
<h3 id="runtime-content-negotiation"><a class="anchor" href="#runtime-content-negotiation"></a>Runtime Content Negotiation</h3>
<div class="paragraph">
<p>The <code>@Produces</code> and <code>@Consumes</code> annotations handle static content negotiation in Jakarta REST.
These annotations specify the content preferences of the server.
HTTP headers such as <code>Accept</code>, <code>Content-Type</code>, and <code>Accept-Language</code> define the content negotiation preferences of the client.</p>
</div>
<div class="paragraph">
<p>For more details on the HTTP headers for content negotiation, see HTTP/1.1 - Content Negotiation (<a href="https://www.w3.org/Protocols/rfc2616/rfc2616-sec12.html" class="bare" target="_blank" rel="noopener">https://www.w3.org/Protocols/rfc2616/rfc2616-sec12.html</a>).</p>
</div>
<div class="paragraph">
<p>The following code snippet shows the server content preferences:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Produces</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">text/plain</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@Path</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/employee</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">Employee</span> {

    <span class="annotation">@GET</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> getEmployeeAddressText(<span class="predefined-type">String</span> address) {...}

    <span class="annotation">@Produces</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">text/xml</span><span class="delimiter">&quot;</span></span>)
    <span class="annotation">@GET</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> getEmployeeAddressXml(Address address) {...}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>getEmployeeAddressText</code> method is called for an HTTP request that looks like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="http">GET /employee
Accept: text/plain</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will produce the following response:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>500 Oracle Parkway, Redwood Shores, CA</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>getEmployeeAddressXml</code> method is called for an HTTP request that looks like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="http">GET /employee
Accept: text/xml</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will produce the following response:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;address</span> <span class="attribute-name">street</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">500 Oracle Parkway, Redwood Shores, CA</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">country</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">USA</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>With static content negotiation, you can also define multiple content and media types for the client and server.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Produces</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">text/plain</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">text/xml</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition to supporting static content negotiation, Jakarta REST also supports runtime content negotiation using the <code>jakarta.ws.rs.core.Variant</code> class and <code>Request</code> objects.
The <code>Variant</code> class specifies the resource representation of content negotiation.
Each instance of the <code>Variant</code> class may contain a media type, a language, and an encoding.
The <code>Variant</code> object defines the resource representation that is supported by the server.
The <code>Variant.VariantListBuilder</code> class is used to build a list of representation variants.</p>
</div>
<div class="paragraph">
<p>The following code snippet shows how to create a list of resource representation variants:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">List</span>&lt;Variant&gt; vs = Variant.mediatypes(<span class="string"><span class="delimiter">&quot;</span><span class="content">application/xml</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">application/json</span><span class="delimiter">&quot;</span></span>)
        .languages(<span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">fr</span><span class="delimiter">&quot;</span></span>).build();</code></pre>
</div>
</div>
<div class="paragraph">
<p>This code snippet calls the <code>build</code> method of the <code>VariantListBuilder</code> class.
The <code>VariantListBuilder</code> class is invoked when you call the <code>mediatypes</code>, <code>languages</code>, or <code>encodings</code> methods.
The <code>build</code> method builds a series of resource representations.
The <code>Variant</code> list created by the <code>build</code> method has all possible combinations of items specified in the <code>mediatypes</code>, <code>languages</code>, and <code>encodings</code> methods.</p>
</div>
<div class="paragraph">
<p>In this example, the size of the <code>vs</code> object as defined in this code snippet is 4, and the contents are as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">[[<span class="string"><span class="delimiter">&quot;</span><span class="content">application/xml</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span>], [<span class="string"><span class="delimiter">&quot;</span><span class="content">application/json</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span>],
    [<span class="string"><span class="delimiter">&quot;</span><span class="content">application/xml</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">fr</span><span class="delimiter">&quot;</span></span>],[<span class="string"><span class="delimiter">&quot;</span><span class="content">application/json</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">fr</span><span class="delimiter">&quot;</span></span>]]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>jakarta.ws.rs.core.Request.selectVariant</code> method accepts a list of <code>Variant</code> objects and chooses the <code>Variant</code> object that matches the HTTP request.
This method compares its list of <code>Variant</code> objects with the <code>Accept</code>, <code>Accept-Encoding</code>, <code>Accept-Language</code>, and <code>Accept-Charset</code> headers of the HTTP request.</p>
</div>
<div class="paragraph">
<p>The following code snippet shows how to use the <code>selectVariant</code> method to select the most acceptable <code>Variant</code> from the values in the client request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@GET</span>
<span class="directive">public</span> Response get(<span class="annotation">@Context</span> Request r) {
    <span class="predefined-type">List</span>&lt;Variant&gt; vs = ...;
    Variant v = r.selectVariant(vs);
    <span class="keyword">if</span> (v == <span class="predefined-constant">null</span>) {
        <span class="keyword">return</span> Response.notAcceptable(vs).build();
    } <span class="keyword">else</span> {
        <span class="predefined-type">Object</span> rep = selectRepresentation(v);
        <span class="keyword">return</span> Response.ok(rep, v);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>selectVariant</code> method returns the <code>Variant</code> object that matches the request or null if no matches are found.
In this code snippet, if the method returns null, a <code>Response</code> object for a nonacceptable response is built.
Otherwise, a <code>Response</code> object with an OK status and containing a representation in the form of an <code>Object</code> entity and a <code>Variant</code> is returned.</p>
</div>
</div>
<div class="sect2">
<h3 id="using-jakarta-rest-with-jakarta-xml-binding"><a class="anchor" href="#using-jakarta-rest-with-jakarta-xml-binding"></a>Using Jakarta REST with Jakarta XML Binding</h3>
<div class="paragraph">
<p>Jakarta XML Binding is an XML-to-Java binding technology that simplifies the development of web services by enabling transformations between schema and Java objects and between XML instance documents and Java object instances.
An XML schema defines the data elements and structure of an XML document.
You can use Jakarta XML Binding APIs and tools to establish mappings between Java classes and XML schema.
Jakarta XML Binding technology provides the tools that enable you to convert your XML documents to and from Java objects.</p>
</div>
<div class="paragraph">
<p>By using Jakarta XML Binding, you can manipulate data objects in the following ways.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You can start with an XML schema definition (XSD) and use <code>xjc</code>, the Jakarta XML Binding schema compiler tool, to create a set of Jakarta XML Binding annotated Java classes that map to the elements and types defined in the XSD schema.</p>
</li>
<li>
<p>You can start with a set of Java classes and use <code>schemagen</code>, the Jakarta XML Binding schema generator tool, to generate an XML schema.</p>
</li>
<li>
<p>Once a mapping between the XML schema and the Java classes exists, you can use the Jakarta XML Binding runtime to marshal and unmarshal your XML documents to and from Java objects and use the resulting Java classes to assemble a web services application.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>XML is a common media format that RESTful services consume and produce.
To deserialize and serialize XML, you can represent requests and responses by Jakarta XML Binding annotated objects.
Your Jakarta REST application can use the Jakarta XML Binding objects to manipulate XML data.
Jakarta XML Binding objects can be used as request entity parameters and response entities.
The Jakarta REST runtime environment includes standard <code>MessageBodyReader</code> and <code>MessageBodyWriter</code> provider interfaces for reading and writing Jakarta XML Binding objects as entities.</p>
</div>
<div class="paragraph">
<p>With Jakarta REST, you enable access to your services by publishing resources.
Resources are just simple Java classes with some additional Jakarta REST annotations.
These annotations express the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The path of the resource (the URL you use to access it)</p>
</li>
<li>
<p>The HTTP method you use to call a certain method (for example, the <code>GET</code> or <code>POST</code> method)</p>
</li>
<li>
<p>The MIME type with which a method accepts or responds</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As you define the resources for your application, consider the type of data you want to expose.
You may already have a relational database that contains information you want to expose to users, or you may have static content that does not reside in a database but does need to be distributed as resources.
Using Jakarta REST, you can distribute content from multiple sources.
RESTful web services can use various types of input/output formats for request and response.
The <code>customer</code> example, described in <a href="#the-customer-example-application">The customer Example Application</a>, uses XML.</p>
</div>
<div class="paragraph">
<p>Resources have representations.
A resource representation is the content in the HTTP message that is sent to, or returned from, the resource using the URI.
Each representation a resource supports has a corresponding media type.
For example, if a resource is going to return content formatted as XML, you can use <code>application/xml</code> as the associated media type in the HTTP message.Depending on the requirements of your application, resources can return representations in a preferred single format or in multiple formats.
Jakarta REST provides <code>@Consumes</code> and <code>@Produces</code> annotations to declare the media types that are acceptable for a resource method to read and write.</p>
</div>
<div class="paragraph">
<p>Jakarta REST also maps Java types to and from resource representations using entity providers.
A <code>MessageBodyReader</code> entity provider reads a request entity and deserializes the request entity into a Java type.
A <code>MessageBodyWriter</code> entity provider serializes from a Java type into a response entity.
For example, if a <code>String</code> value is used as the request entity parameter, the <code>MessageBodyReader</code> entity provider deserializes the request body into a new <code>String</code>.
If a Jakarta XML Binding type is used as the return type on a resource method, the <code>MessageBodyWriter</code> serializes the Jakarta XML Binding object into a response body.</p>
</div>
<div class="paragraph">
<p>By default, the Jakarta REST runtime environment attempts to create and use a default <code>JAXBContext</code> class for Jakarta XML Binding classes.
However, if the default <code>JAXBContext</code> class is not suitable, then you can supply a <code>JAXBContext</code> class for the application using a Jakarta REST <code>ContextResolver</code> provider interface.</p>
</div>
<div class="paragraph">
<p>The following sections explain how to use Jakarta XML Binding with Jakarta REST resource methods.</p>
</div>
<div class="sect3">
<h4 id="using-java-objects-to-model-your-data"><a class="anchor" href="#using-java-objects-to-model-your-data"></a>Using Java Objects to Model Your Data</h4>
<div class="paragraph">
<p>If you do not have an XML schema definition for the data you want to expose, you can model your data as Java classes, add Jakarta XML Binding annotations to these classes, and use Jakarta XML Binding to generate an XML schema for your data.
For example, if the data you want to expose is a collection of products and each product has an ID, a name, a description, and a price, you can model it as a Java class as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@XmlRootElement</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">product</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@XmlAccessorType</span>(XmlAccessType.FIELD)
<span class="directive">public</span> <span class="type">class</span> <span class="class">Product</span> {

    <span class="annotation">@XmlElement</span>(required=<span class="predefined-constant">true</span>)
    <span class="directive">protected</span> <span class="type">int</span> id;
    <span class="annotation">@XmlElement</span>(required=<span class="predefined-constant">true</span>)
    <span class="directive">protected</span> <span class="predefined-type">String</span> name;
    <span class="annotation">@XmlElement</span>(required=<span class="predefined-constant">true</span>)
    <span class="directive">protected</span> <span class="predefined-type">String</span> description;
    <span class="annotation">@XmlElement</span>(required=<span class="predefined-constant">true</span>)
    <span class="directive">protected</span> <span class="type">int</span> price;

    <span class="directive">public</span> Product() {}

    <span class="comment">// Getter and setter methods</span>
    <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Run the Jakarta XML Binding schema generator on the command line to generate the corresponding XML schema definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">schemagen Product.java</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command produces the XML schema as an <code>.xsd</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;yes&quot;?&gt;</span>
<span class="tag">&lt;xs:schema</span> <span class="attribute-name">version</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1.0</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">xmlns:xs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    <span class="tag">&lt;xs:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">product</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">product</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

    <span class="tag">&lt;xs:complexType</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">product</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;xs:sequence&gt;</span>
        <span class="tag">&lt;xs:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xs:int</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;xs:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xs:string</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;xs:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">description</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xs:string</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;xs:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">price</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xs:int</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/xs:sequence&gt;</span>
    <span class="tag">&lt;xs:complexType&gt;</span>
<span class="tag">&lt;/xs:schema&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Once you have this mapping, you can create <code>Product</code> objects in your application, return them, and use them as parameters in Jakarta REST resource methods.
The Jakarta REST runtime uses Jakarta XML Binding to convert the XML data from the request into a <code>Product</code> object and to convert a <code>Product</code> object into XML data for the response.
The following resource class provides a simple example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Path</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/product</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">ProductService</span> {
    <span class="annotation">@GET</span>
    <span class="annotation">@Path</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/get</span><span class="delimiter">&quot;</span></span>)
    <span class="annotation">@Produces</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">application/xml</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> Product getProduct() {
        Product prod = <span class="keyword">new</span> Product();
        prod.setId(<span class="integer">1</span>);
        prod.setName(<span class="string"><span class="delimiter">&quot;</span><span class="content">Mattress</span><span class="delimiter">&quot;</span></span>);
        prod.setDescription(<span class="string"><span class="delimiter">&quot;</span><span class="content">Queen size mattress</span><span class="delimiter">&quot;</span></span>);
        prod.setPrice(<span class="integer">500</span>);
        <span class="keyword">return</span> prod;
    }

    <span class="annotation">@POST</span>
    <span class="annotation">@Path</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/create</span><span class="delimiter">&quot;</span></span>)
    <span class="annotation">@Consumes</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">application/xml</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> Response createProduct(Product prod) {
        <span class="comment">// Process or store the product and return a response</span>
        <span class="comment">// ...</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Some IDEs, such as NetBeans IDE, will run the schema generator tool automatically during the build process if you add Java classes that have Jakarta XML Binding annotations to your project.
For a detailed example, see <a href="#the-customer-example-application">The customer Example Application</a>.
The <code>customer</code> example contains a more complex relationship between the Java classes that model the data, which results in a more hierarchical XML representation.</p>
</div>
</div>
<div class="sect3">
<h4 id="starting-from-an-existing-xml-schema-definition"><a class="anchor" href="#starting-from-an-existing-xml-schema-definition"></a>Starting from an Existing XML Schema Definition</h4>
<div class="paragraph">
<p>If you already have an XML schema definition in an <code>.xsd</code> file for the data you want to expose, use the Jakarta XML Binding schema compiler tool.
Consider this simple example of an <code>.xsd</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;xs:schema</span> <span class="attribute-name">targetNamespace</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://xml.product</span><span class="delimiter">&quot;</span></span>
           <span class="attribute-name">xmlns:xs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema</span><span class="delimiter">&quot;</span></span>
           <span class="attribute-name">elementFormDefault</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">qualified</span><span class="delimiter">&quot;</span></span>
           <span class="attribute-name">xmlns:myco</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://xml.product</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;xs:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">product</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myco:Product</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;xs:complexType</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Product</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;xs:sequence&gt;</span>
      <span class="tag">&lt;xs:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xs:int</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xs:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xs:string</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xs:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">description</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xs:string</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xs:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">price</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xs:int</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/xs:sequence&gt;</span>
  <span class="tag">&lt;/xs:complexType&gt;</span>
<span class="tag">&lt;/xs:schema&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Run the schema compiler tool on the command line as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">xjc Product.xsd</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command generates the source code for Java classes that correspond to the types defined in the <code>.xsd</code> file.
The schema compiler tool generates a Java class for each <code>complexType</code> defined in the <code>.xsd</code> file.
The fields of each generated Java class are the same as the elements inside the corresponding <code>complexType</code>, and the class contains getter and setter methods for these fields.</p>
</div>
<div class="paragraph">
<p>In this case, the schema compiler tool generates the classes <code>product.xml.Product</code> and <code>product.xml.ObjectFactory</code>.
The <code>Product</code> class contains Jakarta XML Binding annotations, and its fields correspond to those in the <code>.xsd</code> definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@XmlAccessorType</span>(XmlAccessType.FIELD)
<span class="annotation">@XmlType</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">Product</span><span class="delimiter">&quot;</span></span>, propOrder = {
    <span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">description</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">price</span><span class="delimiter">&quot;</span></span>
})
<span class="directive">public</span> <span class="type">class</span> <span class="class">Product</span> {
    <span class="directive">protected</span> <span class="type">int</span> id;
    <span class="annotation">@XmlElement</span>(required = <span class="predefined-constant">true</span>)
    <span class="directive">protected</span> <span class="predefined-type">String</span> name;
    <span class="annotation">@XmlElement</span>(required = <span class="predefined-constant">true</span>)
    <span class="directive">protected</span> <span class="predefined-type">String</span> description;
    <span class="directive">protected</span> <span class="type">int</span> price;

    <span class="comment">// Setter and getter methods</span>
    <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can create instances of the <code>Product</code> class from your application (for example, from a database).
The generated class <code>product.xml.ObjectFactory</code> contains a method that allows you to convert these objects to Jakarta XML Binding elements that can be returned as XML inside Jakarta REST resource methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@XmlElementDecl</span>(namespace = <span class="string"><span class="delimiter">&quot;</span><span class="content">http://xml.product</span><span class="delimiter">&quot;</span></span>, name = <span class="string"><span class="delimiter">&quot;</span><span class="content">product</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> JAXBElement&lt;Product&gt; createProduct(Product value) {
    <span class="keyword">return</span> <span class="keyword">new</span> JAXBElement&lt;Product&gt;(_Product_QNAME, Product.class, <span class="predefined-constant">null</span>, value);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following code shows how to use the generated classes to return a Jakarta XML Binding element as XML in a Jakarta REST resource method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Path</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/product</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">ProductService</span> {
    <span class="annotation">@GET</span>
    <span class="annotation">@Path</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/get</span><span class="delimiter">&quot;</span></span>)
    <span class="annotation">@Produces</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">application/xml</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> JAXBElement&lt;Product&gt; getProduct() {
        Product prod = <span class="keyword">new</span> Product();
        prod.setId(<span class="integer">1</span>);
        prod.setName(<span class="string"><span class="delimiter">&quot;</span><span class="content">Mattress</span><span class="delimiter">&quot;</span></span>);
        prod.setDescription(<span class="string"><span class="delimiter">&quot;</span><span class="content">Queen size mattress</span><span class="delimiter">&quot;</span></span>);
        prod.setPrice(<span class="integer">500</span>);
        <span class="keyword">return</span> <span class="keyword">new</span> <span class="predefined-type">ObjectFactory</span>().createProduct(prod);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For <code>@POST</code> and <code>@PUT</code> resource methods, you can use a <code>Product</code> object directly as a parameter.
Jakarta REST maps the XML data from the request into a <code>Product</code> object.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Path</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/product</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">ProductService</span> {
    <span class="annotation">@GET</span>
    <span class="comment">// ...</span>

    <span class="annotation">@POST</span>
    <span class="annotation">@Path</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/create</span><span class="delimiter">&quot;</span></span>)
    <span class="annotation">@Consumes</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">application/xml</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> Response createProduct(Product prod) {
        <span class="comment">// Process or store the product and return a response</span>
        <span class="comment">// ...</span>
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="using-json-with-jakarta-rest-and-jakarta-xml-binding"><a class="anchor" href="#using-json-with-jakarta-rest-and-jakarta-xml-binding"></a>Using JSON with Jakarta REST and Jakarta XML Binding</h4>
<div class="paragraph">
<p>Jakarta REST can automatically read and write XML using Jakarta XML Binding, but it can also work with JSON data.
JSON is a simple text-based format for data exchange derived from JavaScript.
For the preceding examples, the XML representation of a product is</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;product&gt;</span>
  <span class="tag">&lt;id&gt;</span>1<span class="tag">&lt;/id&gt;</span>
  <span class="tag">&lt;name&gt;</span>Mattress<span class="tag">&lt;/name&gt;</span>
  <span class="tag">&lt;description&gt;</span>Queen size mattress<span class="tag">&lt;/description&gt;</span>
  <span class="tag">&lt;price&gt;</span>500<span class="tag">&lt;/price&gt;</span>
<span class="tag">&lt;/product&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The equivalent JSON representation is</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Mattress</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">description</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Queen size mattress</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">price</span><span class="delimiter">&quot;</span></span>:<span class="integer">500</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can add the format <code>application/json</code> or <code>MediaType.APPLICATION_JSON</code> to the <code>@Produces</code> annotation in resource methods to produce responses with JSON data:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@GET</span>
<span class="annotation">@Path</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/get</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@Produces</span>({<span class="string"><span class="delimiter">&quot;</span><span class="content">application/xml</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">application/json</span><span class="delimiter">&quot;</span></span>})
<span class="directive">public</span> Product getProduct() { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the default response is XML, but the response is a JSON object if the client makes a <code>GET</code> request that includes this header:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="http">Accept: application/json</code></pre>
</div>
</div>
<div class="paragraph">
<p>The resource methods can also accept JSON data for Jakarta XML Binding annotated classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@POST</span>
<span class="annotation">@Path</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/create</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@Consumes</span>({<span class="string"><span class="delimiter">&quot;</span><span class="content">application/xml</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">application/json</span><span class="delimiter">&quot;</span></span>})
<span class="directive">public</span> Response createProduct(Product prod) { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The client should include the following header when submitting JSON data with a <code>POST</code> request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="http">Content-Type: application/json</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="the-customer-example-application"><a class="anchor" href="#the-customer-example-application"></a>The customer Example Application</h3>
<div class="paragraph">
<p>This section describes how to build and run the <code>customer</code> example application.
This application is a RESTful web service that uses Jakarta XML Binding to perform the create, read, update, delete (CRUD) operations for a specific entity.</p>
</div>
<div class="paragraph">
<p>The <code>customer</code> sample application is in the <code><em>tut-install</em>/examples/jaxrs/customer/</code> directory.
See <a href="#using-the-tutorial-examples">Chapter 2, <em>Using the Tutorial Examples</em></a>, for basic information on building and running sample applications.</p>
</div>
<div class="sect3">
<h4 id="overview-of-the-customer-example-application"><a class="anchor" href="#overview-of-the-customer-example-application"></a>Overview of the customer Example Application</h4>
<div class="paragraph">
<p>The source files of this application are at <code><em>tut-install</em>/examples/jaxrs/customer/src/main/java/</code>.
The application has three parts.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>Customer</code> and <code>Address</code> entity classes.
These classes model the data of the application and contain Jakarta XML Binding annotations.</p>
</li>
<li>
<p>The <code>CustomerService</code> resource class.
This class contains Jakarta REST resource methods that perform operations on <code>Customer</code> instances represented as XML or JSON data using Jakarta XML Binding.
See <a href="#the-customerservice-class">The CustomerService Class</a> for details.</p>
</li>
<li>
<p>The <code>CustomerBean</code> session bean that acts as a backing bean for the web client.
<code>CustomerBean</code> uses the Jakarta REST client API to call the methods of <code>CustomerService</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>customer</code> example application shows you how to model your data entities as Java classes with Jakarta XML Binding annotations.</p>
</div>
</div>
<div class="sect3">
<h4 id="the-customer-and-address-entity-classes"><a class="anchor" href="#the-customer-and-address-entity-classes"></a>The Customer and Address Entity Classes</h4>
<div class="paragraph">
<p>The following class represents a customer&#8217;s address:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Entity</span>
<span class="annotation">@Table</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">CUSTOMER_ADDRESS</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@XmlRootElement</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">address</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@XmlAccessorType</span>(XmlAccessType.FIELD)
<span class="directive">public</span> <span class="type">class</span> <span class="class">Address</span> {
    <span class="annotation">@Id</span>
    <span class="annotation">@GeneratedValue</span>(strategy = GenerationType.AUTO)
    <span class="directive">private</span> <span class="predefined-type">Long</span> id;

    <span class="annotation">@XmlElement</span>(required=<span class="predefined-constant">true</span>)
    <span class="directive">protected</span> <span class="type">int</span> number;

    <span class="annotation">@XmlElement</span>(required=<span class="predefined-constant">true</span>)
    <span class="directive">protected</span> <span class="predefined-type">String</span> street;

    <span class="annotation">@XmlElement</span>(required=<span class="predefined-constant">true</span>)
    <span class="directive">protected</span> <span class="predefined-type">String</span> city;

    <span class="annotation">@XmlElement</span>(required=<span class="predefined-constant">true</span>)
    <span class="directive">protected</span> <span class="predefined-type">String</span> province;

    <span class="annotation">@XmlElement</span>(required=<span class="predefined-constant">true</span>)
    <span class="directive">protected</span> <span class="predefined-type">String</span> zip;

    <span class="annotation">@XmlElement</span>(required=<span class="predefined-constant">true</span>)
    <span class="directive">protected</span> <span class="predefined-type">String</span> country;

    <span class="directive">public</span> Address() { }

    <span class="comment">// Getter and setter methods</span>
    <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>@XmlRootElement(name="address")</code> annotation maps this class to the <code>address</code> XML element.
The <code>@XmlAccessorType(XmlAccessType.FIELD)</code> annotation specifies that all the fields of this class are bound to XML by default.
The <code>@XmlElement(required=true)</code> annotation specifies that an element must be present in the XML representation.</p>
</div>
<div class="paragraph">
<p>The following class represents a customer:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Entity</span>
<span class="annotation">@Table</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">CUSTOMER_CUSTOMER</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@NamedQuery</span>(
    name=<span class="string"><span class="delimiter">&quot;</span><span class="content">findAllCustomers</span><span class="delimiter">&quot;</span></span>,
    query=<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT c FROM Customer c </span><span class="delimiter">&quot;</span></span> +
          <span class="string"><span class="delimiter">&quot;</span><span class="content">ORDER BY c.id</span><span class="delimiter">&quot;</span></span>
)
<span class="annotation">@XmlRootElement</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">customer</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@XmlAccessorType</span>(XmlAccessType.FIELD)
<span class="directive">public</span> <span class="type">class</span> <span class="class">Customer</span> {
    <span class="annotation">@Id</span>
    <span class="annotation">@GeneratedValue</span>(strategy = GenerationType.AUTO)
    <span class="annotation">@XmlAttribute</span>(required=<span class="predefined-constant">true</span>)
    <span class="directive">protected</span> <span class="type">int</span> id;

    <span class="annotation">@XmlElement</span>(required=<span class="predefined-constant">true</span>)
    <span class="directive">protected</span> <span class="predefined-type">String</span> firstname;

    <span class="annotation">@XmlElement</span>(required=<span class="predefined-constant">true</span>)
    <span class="directive">protected</span> <span class="predefined-type">String</span> lastname;

    <span class="annotation">@XmlElement</span>(required=<span class="predefined-constant">true</span>)
    <span class="annotation">@OneToOne</span>
    <span class="directive">protected</span> Address address;

    <span class="annotation">@XmlElement</span>(required=<span class="predefined-constant">true</span>)
    <span class="directive">protected</span> <span class="predefined-type">String</span> email;

    <span class="annotation">@XmlElement</span> (required=<span class="predefined-constant">true</span>)
    <span class="directive">protected</span> <span class="predefined-type">String</span> phone;

    <span class="directive">public</span> Customer() {...}

    <span class="comment">// Getter and setter methods</span>
    <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Customer</code> class contains the same Jakarta XML Binding annotations as the previous class, except for the <code>@XmlAttribute(required=true)</code> annotation, which maps a property to an attribute of the XML element representing the class.</p>
</div>
<div class="paragraph">
<p>The <code>Customer</code> class contains a property whose type is another entity, the <code>Address</code> class.
This mechanism allows you to define in Java code the hierarchical relationships between entities without having to write an <code>.xsd</code> file yourself.</p>
</div>
<div class="paragraph">
<p>Jakarta XML Binding generates the following XML schema definition for the two preceding classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;yes&quot;?&gt;</span>
<span class="tag">&lt;xs:schema</span> <span class="attribute-name">version</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1.0</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">xmlns:xs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

  <span class="tag">&lt;xs:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">address</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">address</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;xs:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">customer</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">customer</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

  <span class="tag">&lt;xs:complexType</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">address</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;xs:sequence&gt;</span>
      <span class="tag">&lt;xs:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xs:long</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xs:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">number</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xs:int</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xs:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">street</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xs:string</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xs:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">city</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xs:string</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xs:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">province</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xs:string</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xs:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">zip</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xs:string</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xs:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">country</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xs:string</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/xs:sequence&gt;</span>
  <span class="tag">&lt;/xs:complexType&gt;</span>

  <span class="tag">&lt;xs:complexType</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">customer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;xs:sequence&gt;</span>
      <span class="tag">&lt;xs:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">firstname</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xs:string</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xs:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">lastname</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xs:string</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xs:element</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">address</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xs:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">email</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xs:string</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xs:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">phone</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xs:string</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/xs:sequence&gt;</span>
    <span class="tag">&lt;xs:attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xs:int</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">use</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">required</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/xs:complexType&gt;</span>
<span class="tag">&lt;/xs:schema&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="the-customerservice-class"><a class="anchor" href="#the-customerservice-class"></a>The CustomerService Class</h4>
<div class="paragraph">
<p>The <code>CustomerService</code> class has a <code>createCustomer</code> method that creates a customer resource based on the <code>Customer</code> class and returns a URI for the new resource.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Stateless</span>
<span class="annotation">@Path</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/Customer</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">CustomerService</span> {
    <span class="directive">public</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">Logger</span> logger =
            <span class="predefined-type">Logger</span>.getLogger(CustomerService.class.getCanonicalName());
    <span class="annotation">@PersistenceContext</span>
    <span class="directive">private</span> EntityManager em;
    <span class="directive">private</span> CriteriaBuilder cb;

    <span class="annotation">@PostConstruct</span>
    <span class="directive">private</span> <span class="type">void</span> init() {
        cb = em.getCriteriaBuilder();
    }
    ...
    <span class="annotation">@POST</span>
    <span class="annotation">@Consumes</span>({MediaType.APPLICATION_XML, MediaType.APPLICATION_JSON})
    <span class="directive">public</span> Response createCustomer(Customer customer) {

        <span class="keyword">try</span> {
            <span class="type">long</span> customerId = persist(customer);
            <span class="keyword">return</span> Response.created(<span class="predefined-type">URI</span>.create(<span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="delimiter">&quot;</span></span> + customerId)).build();
        } <span class="keyword">catch</span> (<span class="exception">Exception</span> e) {
            logger.log(<span class="predefined-type">Level</span>.SEVERE,
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">Error creating customer for customerId {0}. {1}</span><span class="delimiter">&quot;</span></span>,
                    <span class="keyword">new</span> <span class="predefined-type">Object</span><span class="type">[]</span>{customer.getId(), e.getMessage()});
            <span class="keyword">throw</span> <span class="keyword">new</span> WebApplicationException(e,
                    Response.Status.INTERNAL_SERVER_ERROR);
        }
    }
    ...
    private <span class="type">long</span> persist(Customer customer) {
        <span class="keyword">try</span> {
            Address address = customer.getAddress();
            em.persist(address);
            em.persist(customer);
        } <span class="keyword">catch</span> (<span class="exception">Exception</span> ex) {
            logger.warning(<span class="string"><span class="delimiter">&quot;</span><span class="content">Something went wrong when persisting the customer</span><span class="delimiter">&quot;</span></span>);
        }
        <span class="keyword">return</span> customer.getId();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The response returned to the client has a URI to the newly created resource.
The return type is an entity body mapped from the property of the response with the status code specified by the status property of the response.
The <code>WebApplicationException</code> is a <code>RuntimeException</code> that is used to wrap the appropriate HTTP error status code, such as 404, 406, 415, or 500.</p>
</div>
<div class="paragraph">
<p>The <code>@Consumes({MediaType.APPLICATION_XML, MediaType.APPLICATION_JSON})</code> and <code>@Produces({MediaType.APPLICATION_XML, MediaType.APPLICATION_JSON})</code> annotations set the request and response media types to use the appropriate MIME client.
These annotations can be applied to a resource method, a resource class, or even an entity provider.
If you do not use these annotations, Jakarta REST allows the use of any media type (<code>"*/*"</code>).</p>
</div>
<div class="paragraph">
<p>The following code snippet shows the implementation of the
<code>getCustomer</code> and <code>findbyId</code> methods.
The <code>getCustomer</code> method uses the
<code>@Produces</code> annotation and returns a <code>Customer</code> object, which is
converted to an XML or JSON representation depending on the <code>Accept:</code>
header specified by the client.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    <span class="annotation">@GET</span>
    <span class="annotation">@Path</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">{id}</span><span class="delimiter">&quot;</span></span>)
    <span class="annotation">@Produces</span>({MediaType.APPLICATION_XML, MediaType.APPLICATION_JSON})
    <span class="directive">public</span> Customer getCustomer(<span class="annotation">@PathParam</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">String</span> customerId) {
        Customer customer = <span class="predefined-constant">null</span>;

        <span class="keyword">try</span> {
            customer = findById(customerId);
        } <span class="keyword">catch</span> (<span class="exception">Exception</span> ex) {
            logger.log(<span class="predefined-type">Level</span>.SEVERE,
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">Error calling findCustomer() for customerId {0}. {1}</span><span class="delimiter">&quot;</span></span>,
                    <span class="keyword">new</span> <span class="predefined-type">Object</span><span class="type">[]</span>{customerId, ex.getMessage()});
        }
        <span class="keyword">return</span> customer;
    }
    ...
    private Customer findById(<span class="predefined-type">String</span> customerId) {
        Customer customer = <span class="predefined-constant">null</span>;
        <span class="keyword">try</span> {
            customer = em.find(Customer.class, customerId);
            <span class="keyword">return</span> customer;
        } <span class="keyword">catch</span> (<span class="exception">Exception</span> ex) {
            logger.log(<span class="predefined-type">Level</span>.WARNING,
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">Couldn't find customer with ID of {0}</span><span class="delimiter">&quot;</span></span>, customerId);
        }
        <span class="keyword">return</span> customer;
    }</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="using-the-jakarta-rest-client-in-the-customerbean-classes"><a class="anchor" href="#using-the-jakarta-rest-client-in-the-customerbean-classes"></a>Using the Jakarta REST Client in the CustomerBean Classes</h4>
<div class="paragraph">
<p>Use the Jakarta REST Client API to write a client for the <code>customer</code> example application.</p>
</div>
<div class="paragraph">
<p>The <code>CustomerBean</code> enterprise bean class calls the Jakarta REST Client API to test the <code>CustomerService</code> web service:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Named</span>
<span class="annotation">@Stateless</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">CustomerBean</span> {
    <span class="directive">protected</span> Client client;
    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">Logger</span> logger =
            <span class="predefined-type">Logger</span>.getLogger(CustomerBean.class.getName());

    <span class="annotation">@PostConstruct</span>
    <span class="directive">private</span> <span class="type">void</span> init() {
        client = ClientBuilder.newClient();
    }

    <span class="annotation">@PreDestroy</span>
    <span class="directive">private</span> <span class="type">void</span> clean() {
        client.close();
    }

    <span class="directive">public</span> <span class="predefined-type">String</span> createCustomer(Customer customer) {
        <span class="keyword">if</span> (customer == <span class="predefined-constant">null</span>) {
            logger.log(<span class="predefined-type">Level</span>.WARNING, <span class="string"><span class="delimiter">&quot;</span><span class="content">customer is null.</span><span class="delimiter">&quot;</span></span>);
            <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">customerError</span><span class="delimiter">&quot;</span></span>;
        }
        <span class="predefined-type">String</span> navigation;
        Response response =
                client.target(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8080/customer/webapi/Customer</span><span class="delimiter">&quot;</span></span>)
                .request(MediaType.APPLICATION_XML)
                .post(<span class="predefined-type">Entity</span>.entity(customer, MediaType.APPLICATION_XML),
                        Response.class);
        <span class="keyword">if</span> (response.getStatus() == Status.CREATED.getStatusCode()) {
            navigation = <span class="string"><span class="delimiter">&quot;</span><span class="content">customerCreated</span><span class="delimiter">&quot;</span></span>;
        } <span class="keyword">else</span> {
            logger.log(<span class="predefined-type">Level</span>.WARNING, <span class="string"><span class="delimiter">&quot;</span><span class="content">couldn''t create customer with </span><span class="delimiter">&quot;</span></span> +
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">id {0}. Status returned was {1}</span><span class="delimiter">&quot;</span></span>,
                    <span class="keyword">new</span> <span class="predefined-type">Object</span><span class="type">[]</span>{customer.getId(), response.getStatus()});
            navigation = <span class="string"><span class="delimiter">&quot;</span><span class="content">customerError</span><span class="delimiter">&quot;</span></span>;
        }
        <span class="keyword">return</span> navigation;
    }

    <span class="directive">public</span> <span class="predefined-type">String</span> retrieveCustomer(<span class="predefined-type">String</span> id) {
        <span class="predefined-type">String</span> navigation;
        Customer customer =
                client.target(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8080/customer/webapi/Customer</span><span class="delimiter">&quot;</span></span>)
                .path(id)
                .request(MediaType.APPLICATION_XML)
                .get(Customer.class);
        <span class="keyword">if</span> (customer == <span class="predefined-constant">null</span>) {
            navigation = <span class="string"><span class="delimiter">&quot;</span><span class="content">customerError</span><span class="delimiter">&quot;</span></span>;
        } <span class="keyword">else</span> {
            navigation = <span class="string"><span class="delimiter">&quot;</span><span class="content">customerRetrieved</span><span class="delimiter">&quot;</span></span>;
        }
        <span class="keyword">return</span> navigation;
    }

    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;Customer&gt; retrieveAllCustomers() {
        <span class="predefined-type">List</span>&lt;Customer&gt; customers =
                client.target(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8080/customer/webapi/Customer</span><span class="delimiter">&quot;</span></span>)
                .path(<span class="string"><span class="delimiter">&quot;</span><span class="content">all</span><span class="delimiter">&quot;</span></span>)
                .request(MediaType.APPLICATION_XML)
                .get(<span class="keyword">new</span> GenericType&lt;<span class="predefined-type">List</span>&lt;Customer&gt;&gt;() {});
        <span class="keyword">return</span> customers;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This client uses the <code>POST</code> and <code>GET</code> methods.</p>
</div>
<div class="paragraph">
<p>All of these HTTP status codes indicate success: 201 for <code>POST</code>, 200 for <code>GET</code>, and 204 for <code>DELETE</code>. For details about the meanings of HTTP status codes, see <a href="https://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html" class="bare" target="_blank" rel="noopener">https://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="running-the-customer-example"><a class="anchor" href="#running-the-customer-example"></a>Running the customer Example</h4>
<div class="paragraph">
<p>You can use either NetBeans IDE or Maven to build, package, deploy, and run the <code>customer</code> application.</p>
</div>
<div class="sect4">
<h5 id="to-build-package-and-deploy-the-customer-example-using-netbeans-ide"><a class="anchor" href="#to-build-package-and-deploy-the-customer-example-using-netbeans-ide"></a>To Build, Package, and Deploy the customer Example Using NetBeans IDE</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>From the <strong>File</strong> menu, choose <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the <strong>Open Project</strong> dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/jaxrs</pre>
</div>
</div>
</li>
<li>
<p>Select the <code>customer</code> folder.</p>
</li>
<li>
<p>Click <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the <strong>Projects</strong> tab, right-click the <code>customer</code> project and select <strong>Build</strong>.</p>
<div class="paragraph">
<p>This command builds and packages the application into a WAR file, <code>customer.war</code>, located in the <code>target</code> directory.
Then, the WAR file is deployed to GlassFish Server.</p>
</div>
</li>
<li>
<p>Open the web client in a browser at the following URL:</p>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080/customer/</pre>
</div>
</div>
<div class="paragraph">
<p>The web client allows you to create and view customers.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-build-package-and-deploy-the-customer-example-using-maven"><a class="anchor" href="#to-build-package-and-deploy-the-customer-example-using-maven"></a>To Build, Package, and Deploy the customer Example Using Maven</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see
<a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>In a terminal window, go to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/jaxrs/customer/</pre>
</div>
</div>
</li>
<li>
<p>Enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">mvn install</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command builds and packages the application into a WAR file, <code>customer.war</code>, located in the <code>target</code> directory.
Then, the WAR file is deployed to GlassFish Server.</p>
</div>
</li>
<li>
<p>Open the web client in a browser at the following URL:</p>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080/customer/</pre>
</div>
</div>
<div class="paragraph">
<p>The web client allows you to create and view customers.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
</div>
<h1 id="enterprise-beans" class="sect0"><a class="anchor" href="#enterprise-beans"></a>Part VII: Enterprise Beans</h1>
<div class="openblock partintro">
<div class="content">
Part VII explores Jakarta Enterprise Beans components.
</div>
</div>
<div class="sect1">
<h2 id="enterprise-beans-2"><a class="anchor" href="#enterprise-beans-2"></a>Chapter 35. Enterprise Beans</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Enterprise beans are Jakarta EE components that implement Jakarta Enterprise Beans technology.
Enterprise beans run in the Enterprise Bean container, a runtime environment within GlassFish Server (see <a href="#container-types">Container Types</a>).
Although transparent to the application developer, the Enterprise Bean container provides system-level services, such as transactions and security, to its enterprise beans.
These services enable you to quickly build and deploy enterprise beans, which form the core of transactional Jakarta EE applications.</p>
</div>
<div class="sect2">
<h3 id="what-is-an-enterprise-bean"><a class="anchor" href="#what-is-an-enterprise-bean"></a>What Is an Enterprise Bean?</h3>
<div class="paragraph">
<p>Written in the Java programming language, an enterprise bean is a server-side component that encapsulates the business logic of an application.
The business logic is the code that fulfills the purpose of the application.
In an inventory control application, for example, the enterprise beans might implement the business logic in methods called <code>checkInventoryLevel</code> and <code>orderProduct</code>.
By invoking these methods, clients can access the inventory services provided by the application.</p>
</div>
<div class="sect3">
<h4 id="benefits-of-enterprise-beans"><a class="anchor" href="#benefits-of-enterprise-beans"></a>Benefits of Enterprise Beans</h4>
<div class="paragraph">
<p>For several reasons, enterprise beans simplify the development of large, distributed applications.
First, because the Enterprise Bean container provides system-level services to enterprise beans, the bean developer can concentrate on solving business problems.
The Enterprise Bean container, rather than the bean developer, is responsible for system-level services, such as transaction management and security authorization.</p>
</div>
<div class="paragraph">
<p>Second, because the beans rather than the clients contain the application&#8217;s business logic, the client developer can focus on the presentation of the client.
The client developer does not have to code the routines that implement business rules or access databases.
As a result, the clients are thinner, a benefit that is particularly important for clients that run on small devices.</p>
</div>
<div class="paragraph">
<p>Third, because enterprise beans are portable components, the application assembler can build new applications from existing beans.
Provided that they use the standard APIs, these applications can run on any compliant Jakarta EE server.</p>
</div>
</div>
<div class="sect3">
<h4 id="when-to-use-enterprise-beans"><a class="anchor" href="#when-to-use-enterprise-beans"></a>When to Use Enterprise Beans</h4>
<div class="paragraph">
<p>You should consider using enterprise beans if your application has any of the following requirements.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The application must be scalable.
To accommodate a growing number of users, you may need to distribute an application&#8217;s components across multiple machines.
Not only can the enterprise beans of an application run on different machines, but also their location will remain transparent to the clients.</p>
</li>
<li>
<p>Transactions must ensure data integrity.
Enterprise beans support transactions, the mechanisms that manage the concurrent access of shared objects.</p>
</li>
<li>
<p>The application will have a variety of clients.
With only a few lines of code, remote clients can easily locate enterprise beans.
These clients can be thin, various, and numerous.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="types-of-enterprise-beans"><a class="anchor" href="#types-of-enterprise-beans"></a>Types of Enterprise Beans</h4>
<div class="paragraph">
<p><a href="#enterprise-bean-types">Table 35-1</a> summarizes the two types of enterprise beans.
The following sections discuss each type in more detail.</p>
</div>
<table id="enterprise-bean-types" class="tableblock frame-all grid-all" style="width: 75%;">
<caption class="title">Table 35-1 Enterprise Bean Types</caption>
<colgroup>
<col style="width: 35%;">
<col style="width: 65%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Enterprise Bean Type</th>
<th class="tableblock halign-left valign-top">Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Session</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Performs a task for a client; optionally, may implement a web service</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Message-driven</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Acts as a listener for a particular messaging type, such as Jakarta Messaging</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="what-is-a-session-bean"><a class="anchor" href="#what-is-a-session-bean"></a>What Is a Session Bean?</h3>
<div class="paragraph">
<p>A session bean encapsulates business logic that can be invoked programmatically by a client over local, remote, or web service client views.
To access an application that is deployed on the server, the client invokes the session bean&#8217;s methods.
The session bean performs work for its client, shielding it from complexity by executing business tasks inside the server.</p>
</div>
<div class="paragraph">
<p>A session bean is not persistent.
(That is, its data is not saved to a database.)</p>
</div>
<div class="paragraph">
<p>For code samples, see <a href="#running-the-enterprise-bean-examples">Chapter 37, <em>Running the Enterprise Bean Examples</em></a>.</p>
</div>
<div class="sect3">
<h4 id="types-of-session-beans"><a class="anchor" href="#types-of-session-beans"></a>Types of Session Beans</h4>
<div class="paragraph">
<p>Session beans are of three types: stateful, stateless, and singleton.</p>
</div>
<div class="sect4">
<h5 id="stateful-session-beans"><a class="anchor" href="#stateful-session-beans"></a>Stateful Session Beans</h5>
<div class="paragraph">
<p>The state of an object consists of the values of its instance variables.
In a stateful session bean, the instance variables represent the state of a unique client/bean session.
Because the client interacts ("talks") with its bean, this state is often called the conversational state.</p>
</div>
<div class="paragraph">
<p>As its name suggests, a session bean is similar to an interactive session.
A session bean is not shared; it can have only one client, in the same way that an interactive session can have only one user.
When the client terminates, its session bean appears to terminate and is no longer associated with the client.</p>
</div>
<div class="paragraph">
<p>The state is retained for the duration of the client/bean session.
If the client removes the bean, the session ends and the state disappears.
This transient nature of the state is not a problem, however, because when the conversation between the client and the bean ends, there is no need to retain the state.</p>
</div>
</div>
<div class="sect4">
<h5 id="stateless-session-beans"><a class="anchor" href="#stateless-session-beans"></a>Stateless Session Beans</h5>
<div class="paragraph">
<p>A stateless session bean does not maintain a conversational state with the client.
When a client invokes the methods of a stateless bean, the bean&#8217;s instance variables may contain a state specific to that client but only for the duration of the invocation.
When the method is finished, the client-specific state should not be retained.
Clients may, however, change the state of instance variables in pooled stateless beans, and this state is held over to the next invocation of the pooled stateless bean.
Except during method invocation, all instances of a stateless bean are equivalent, allowing the Enterprise Bean container to assign an instance to any client.
That is, the state of a stateless session bean should apply across all clients.</p>
</div>
<div class="paragraph">
<p>Because they can support multiple clients, stateless session beans can offer better scalability for applications that require large numbers of clients.
Typically, an application requires fewer stateless session beans than stateful session beans to support the same number of clients.</p>
</div>
<div class="paragraph">
<p>A stateless session bean can implement a web service, but a stateful session bean cannot.</p>
</div>
</div>
<div class="sect4">
<h5 id="singleton-session-beans"><a class="anchor" href="#singleton-session-beans"></a>Singleton Session Beans</h5>
<div class="paragraph">
<p>A singleton session bean is instantiated once per application and exists for the lifecycle of the application.
Singleton session beans are designed for circumstances in which a single enterprise bean instance is shared across and concurrently accessed by clients.</p>
</div>
<div class="paragraph">
<p>Singleton session beans offer similar functionality to stateless session beans but differ from them in that there is only one singleton session bean per application, as opposed to a pool of stateless session beans, any of which may respond to a client request.
Like stateless session beans, singleton session beans can implement web service endpoints.</p>
</div>
<div class="paragraph">
<p>Singleton session beans maintain their state between client invocations but are not required to maintain their state across server crashes or shutdowns.</p>
</div>
<div class="paragraph">
<p>Applications that use a singleton session bean may specify that the singleton should be instantiated upon application startup, which allows the singleton to perform initialization tasks for the application.
The singleton may perform cleanup tasks on application shutdown as well, because the singleton will operate throughout the lifecycle of the application.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="when-to-use-session-beans"><a class="anchor" href="#when-to-use-session-beans"></a>When to Use Session Beans</h4>
<div class="paragraph">
<p>Stateful session beans are appropriate if any of the following conditions are true.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The bean&#8217;s state represents the interaction between the bean and a specific client.</p>
</li>
<li>
<p>The bean needs to hold information about the client across method invocations.</p>
</li>
<li>
<p>The bean mediates between the client and the other components of the application, presenting a simplified view to the client.</p>
</li>
<li>
<p>Behind the scenes, the bean manages the work flow of several enterprise beans.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To improve performance, you might choose a stateless session bean if it has any of these traits.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The bean&#8217;s state has no data for a specific client.</p>
</li>
<li>
<p>In a single method invocation, the bean performs a generic task for all clients.
For example, you might use a stateless session bean to send an email that confirms an online order.</p>
</li>
<li>
<p>The bean implements a web service.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Singleton session beans are appropriate in the following circumstances.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>State needs to be shared across the application.</p>
</li>
<li>
<p>A single enterprise bean needs to be accessed by multiple threads concurrently.</p>
</li>
<li>
<p>The application needs an enterprise bean to perform tasks upon application startup and shutdown.</p>
</li>
<li>
<p>The bean implements a web service.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="what-is-a-message-driven-bean"><a class="anchor" href="#what-is-a-message-driven-bean"></a>What Is a Message-Driven Bean?</h3>
<div class="paragraph">
<p>A message-driven bean is an enterprise bean that allows Jakarta EE applications to process messages asynchronously.
This type of bean normally acts as a Jakarta Messaging message listener, which is similar to an event listener but receives Jakarta Messaging messages instead of events.
The messages can be sent by any Jakarta EE component (an application client, another enterprise bean, or a web component) or by a Jakarta Messaging application or system that does not use Jakarta EE technology.
Message-driven beans can process Jakarta Messaging messages or other kinds of messages.</p>
</div>
<div class="sect3">
<h4 id="what-makes-message-driven-beans-different-from-session-beans"><a class="anchor" href="#what-makes-message-driven-beans-different-from-session-beans"></a>What Makes Message-Driven Beans Different from Session Beans?</h4>
<div class="paragraph">
<p>The most visible difference between message-driven beans and session beans is that clients do not access message-driven beans through interfaces.
Interfaces are described in the section <a href="#accessing-enterprise-beans">Accessing Enterprise Beans</a>.
Unlike a session bean, a message-driven bean has only a bean class.</p>
</div>
<div class="paragraph">
<p>In several respects, a message-driven bean resembles a stateless session bean.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A message-driven bean&#8217;s instances retain no data or conversational state for a specific client.</p>
</li>
<li>
<p>All instances of a message-driven bean are equivalent, allowing the Enterprise Bean container to assign a message to any message-driven bean instance.
The container can pool these instances to allow streams of messages to be processed concurrently.</p>
</li>
<li>
<p>A single message-driven bean can process messages from multiple clients.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The instance variables of the message-driven bean instance can contain some state across the handling of client messages, such as a Jakarta Messaging connection, an open database connection, or an object reference to an enterprise bean object.</p>
</div>
<div class="paragraph">
<p>Client components do not locate message-driven beans and invoke methods directly on them.
Instead, a client accesses a message-driven bean through, for example, Jakarta Messaging by sending messages to the message destination for which the message-driven bean class is the <code>MessageListener</code>.
You assign a message-driven bean&#8217;s destination during deployment by using GlassFish Server resources.</p>
</div>
<div class="paragraph">
<p>Message-driven beans have the following characteristics.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>They execute upon receipt of a single client message.</p>
</li>
<li>
<p>They are invoked asynchronously.</p>
</li>
<li>
<p>They are relatively short-lived.</p>
</li>
<li>
<p>They do not represent directly shared data in the database, but they can access and update this data.</p>
</li>
<li>
<p>They can be transaction-aware.</p>
</li>
<li>
<p>They are stateless.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When a message arrives, the container calls the message-driven bean&#8217;s <code>onMessage</code> method to process the message.
The <code>onMessage</code> method normally casts the message to one of the five Jakarta Messaging message types and handles it in accordance with the application&#8217;s business logic.
The <code>onMessage</code> method can call helper methods or can invoke a session bean to process the information in the message or to store it in a database.</p>
</div>
<div class="paragraph">
<p>A message can be delivered to a message-driven bean within a transaction context, so all operations within the <code>onMessage</code> method are part of a single transaction.
If message processing is rolled back, the message will be redelivered.
For more information, see <a href="#receiving-messages-asynchronously-using-a-message-driven-bean">Receiving Messages Asynchronously Using a Message-Driven Bean</a> and <a href="#transactions">Chapter 55, <em>Transactions</em></a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="when-to-use-message-driven-beans"><a class="anchor" href="#when-to-use-message-driven-beans"></a>When to Use Message-Driven Beans</h4>
<div class="paragraph">
<p>Session beans allow you to send Jakarta Messaging messages and to receive them synchronously but not asynchronously.
To avoid tying up server resources, do not to use blocking synchronous receives in a server-side component; in general, Jakarta Messaging messages should not be sent or received synchronously.
To receive messages asynchronously, use a message-driven bean.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="accessing-enterprise-beans"><a class="anchor" href="#accessing-enterprise-beans"></a>Accessing Enterprise Beans</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The material in this section applies only to session beans and not to message-driven beans.
Because they have a different programming model, message-driven beans do not have interfaces or no-interface views that define client access.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Clients access enterprise beans either through a no-interface view or through a business interface.
A no-interface view of an enterprise bean exposes the public methods of the enterprise bean implementation class to clients.
Clients using the no-interface view of an enterprise bean may invoke any public methods in the enterprise bean implementation class or any superclasses of the implementation class.
A business interface is a standard Java programming language interface that contains the business methods of the enterprise bean.</p>
</div>
<div class="paragraph">
<p>A client can access a session bean only through the methods defined in the bean&#8217;s business interface or through the public methods of an enterprise bean that has a no-interface view.
The business interface or no-interface view defines the client&#8217;s view of an enterprise bean.
All other aspects of the enterprise bean (method implementations and deployment settings) are hidden from the client.</p>
</div>
<div class="paragraph">
<p>Well-designed interfaces and no-interface views simplify the development and maintenance of Jakarta EE applications.
Not only do clean interfaces and no-interface views shield the clients from any complexities in the Enterprise Bean tier, but they also allow the enterprise beans to change internally without affecting the clients.
For example, if you change the implementation of a session bean business method, you won&#8217;t have to alter the client code.
But if you were to change the method definitions in the interfaces, you might have to modify the client code as well.
Therefore, it is important that you design the interfaces and no-interface views carefully to isolate your clients from possible changes in the enterprise beans.</p>
</div>
<div class="paragraph">
<p>Session beans can have more than one business interface.
Session beans should, but are not required to, implement their business interface or interfaces.</p>
</div>
<div class="sect3">
<h4 id="using-enterprise-beans-in-clients"><a class="anchor" href="#using-enterprise-beans-in-clients"></a>Using Enterprise Beans in Clients</h4>
<div class="paragraph">
<p>The client of an enterprise bean obtains a reference to an instance of an enterprise bean through either dependency injection, using Java programming language annotations, or JNDI lookup, using the Java Naming and Directory Interface syntax to find the enterprise bean instance.</p>
</div>
<div class="paragraph">
<p>Dependency injection is the simplest way of obtaining an enterprise bean reference.
Clients that run within a Jakarta EE server-managed environment, Jakarta Faces web applications, Jakarta RESTful web services, other enterprise beans, or Jakarta EE application clients support dependency injection using the <code>jakarta.ejb.EJB</code> annotation.</p>
</div>
<div class="paragraph">
<p>Applications that run outside a Jakarta EE server-managed environment, such as Java SE applications, must perform an explicit lookup.
JNDI supports a global syntax for identifying Jakarta EE components to simplify this explicit lookup.</p>
</div>
<div class="sect4">
<h5 id="portable-jndi-syntax"><a class="anchor" href="#portable-jndi-syntax"></a>Portable JNDI Syntax</h5>
<div class="paragraph">
<p>Three JNDI namespaces are used for portable JNDI lookups: <code>java:global</code>, <code>java:module</code>, and <code>java:app</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>java:global</code> JNDI namespace is the portable way of finding remote enterprise beans using JNDI lookups.
JNDI addresses are of the following form:</p>
<div class="listingblock">
<div class="content">
<pre>java:global[/application name]/module name/enterprise bean name[/interface name]</pre>
</div>
</div>
<div class="paragraph">
<p>Application name and module name default to the name of the application and module minus the file extension.
Application names are required only if the application is packaged within an EAR.
The interface name is required only if the enterprise bean implements more than one business interface.</p>
</div>
</li>
<li>
<p>The <code>java:module</code> namespace is used to look up local enterprise beans within the same module.
JNDI addresses using the <code>java:module</code> namespace are of the following form:</p>
<div class="listingblock">
<div class="content">
<pre>java:module/enterprise bean name/[interface name]</pre>
</div>
</div>
<div class="paragraph">
<p>The interface name is required only if the enterprise bean implements more than one business interface.</p>
</div>
</li>
<li>
<p>The <code>java:app</code> namespace is used to look up local enterprise beans packaged within the same application.
That is, the enterprise bean is packaged within an EAR file containing multiple Jakarta EE modules.
JNDI addresses using the <code>java:app</code> namespace are of the following form:</p>
<div class="listingblock">
<div class="content">
<pre>java:app[/module name]/enterprise bean name[/interface name]</pre>
</div>
</div>
<div class="paragraph">
<p>The module name is optional.
The interface name is required only if the enterprise bean implements more than one business interface.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, if an enterprise bean, <code>MyBean</code>, is packaged within the web application archive <code>myApp.war</code>, the module name is <code>myApp</code>.
The portable JNDI name is <code>java:module/MyBean</code>.
An equivalent JNDI name using the <code>java:global</code> namespace is <code>java:global/myApp/MyBean</code>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="deciding-on-remote-or-local-access"><a class="anchor" href="#deciding-on-remote-or-local-access"></a>Deciding on Remote or Local Access</h4>
<div class="paragraph">
<p>When you design a Jakarta EE application, one of the first decisions you make is the type of client access allowed by the enterprise beans: remote, local, or web service.</p>
</div>
<div class="paragraph">
<p>Whether to allow local or remote access depends on the following factors.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Tight or loose coupling of related beans: Tightly coupled beans depend on one another.
For example, if a session bean that processes sales orders calls a session bean that emails a confirmation message to the customer, these beans are tightly coupled.
Tightly coupled beans are good candidates for local access.
Because they fit together as a logical unit, they typically call each other often and would benefit from the increased performance that is possible with local access.</p>
</li>
<li>
<p>Type of client: If an enterprise bean is accessed by application clients, it should allow remote access.
In a production environment, these clients almost always run on machines other than those on which GlassFish Server is running.
If an enterprise bean&#8217;s clients are web components or other enterprise beans, the type of access depends on how you want to distribute your components.</p>
</li>
<li>
<p>Component distribution: Jakarta EE applications are scalable because their server-side components can be distributed across multiple machines.
In a distributed application, for example, the server that the web components run on may not be the one on which the enterprise beans they access are deployed.
In this distributed scenario, the enterprise beans should allow remote access.</p>
</li>
<li>
<p>Performance: Owing to such factors as network latency, remote calls may be slower than local calls.
On the other hand, if you distribute components among different servers, you may improve the application&#8217;s overall performance.
Both of these statements are generalizations; performance can vary in different operational environments.
Nevertheless, you should keep in mind how your application design might affect performance.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you aren&#8217;t sure which type of access an enterprise bean should have, choose remote access.
This decision gives you more flexibility.
In the future, you can distribute your components to accommodate the growing demands on your application.</p>
</div>
<div class="paragraph">
<p>Although it is uncommon, it is possible for an enterprise bean to allow both remote and local access.
If this is the case, either the business interface of the bean must be explicitly designated as a business interface by being decorated with the <code>@Remote</code> or <code>@Local</code> annotations, or the bean class must explicitly designate the business interfaces by using the <code>@Remote</code> and <code>@Local</code> annotations.
The same business interface cannot be both a local and a remote business interface.</p>
</div>
</div>
<div class="sect3">
<h4 id="local-clients"><a class="anchor" href="#local-clients"></a>Local Clients</h4>
<div class="paragraph">
<p>A local client has these characteristics.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It must run in the same application as the enterprise bean it accesses.</p>
</li>
<li>
<p>It can be a web component or another enterprise bean.</p>
</li>
<li>
<p>To the local client, the location of the enterprise bean it accesses is not transparent.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The no-interface view of an enterprise bean is a local view.
The public methods of the enterprise bean implementation class are exposed to local clients that access the no-interface view of the enterprise bean.
Enterprise beans that use the no-interface view do not implement a business interface.</p>
</div>
<div class="paragraph">
<p>The local business interface defines the bean&#8217;s business and lifecycle methods.
If the bean&#8217;s business interface is not decorated with <code>@Local</code> or <code>@Remote</code>, and if the bean class does not specify the interface using <code>@Local</code> or <code>@Remote</code>, the business interface is by default a local interface.</p>
</div>
<div class="paragraph">
<p>To build an enterprise bean that allows only local access, you may, but are not required to, do one of the following.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create an enterprise bean implementation class that does not implement a business interface, indicating that the bean exposes a no-interface view to clients.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Session</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyBean</span> { ... }</code></pre>
</div>
</div>
</li>
<li>
<p>Annotate the business interface of the enterprise bean as a <code>@Local</code> interface.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Local</span>
<span class="directive">public</span> <span class="type">interface</span> <span class="class">InterfaceName</span> { ... }</code></pre>
</div>
</div>
</li>
<li>
<p>Specify the interface by decorating the bean class with <code>@Local</code> and specify the interface name.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Local</span>(InterfaceName.class)
<span class="directive">public</span> <span class="type">class</span> <span class="class">BeanName</span> <span class="directive">implements</span> InterfaceName  { ... }</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="accessing-local-enterprise-beans-using-the-no-interface-view"><a class="anchor" href="#accessing-local-enterprise-beans-using-the-no-interface-view"></a>Accessing Local Enterprise Beans Using the No-Interface View</h5>
<div class="paragraph">
<p>Client access to an enterprise bean that exposes a local, no-interface view is accomplished through either dependency injection or JNDI lookup.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To obtain a reference to the no-interface view of an enterprise bean through dependency injection, use the <code>jakarta.ejb.EJB</code> annotation and specify the enterprise bean&#8217;s implementation class:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@EJB</span>
ExampleBean exampleBean;</code></pre>
</div>
</div>
</li>
<li>
<p>To obtain a reference to the no-interface view of an enterprise bean through JNDI lookup, use the <code>javax.naming.InitialContext</code> interface&#8217;s <code>lookup</code> method:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ExampleBean exampleBean = (ExampleBean)
        <span class="predefined-type">InitialContext</span>.lookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">java:module/ExampleBean</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Clients do not use the <code>new</code> operator to obtain a new instance of an enterprise bean that uses a no-interface view.</p>
</div>
</div>
<div class="sect4">
<h5 id="accessing-local-enterprise-beans-that-implement-business-interfaces"><a class="anchor" href="#accessing-local-enterprise-beans-that-implement-business-interfaces"></a>Accessing Local Enterprise Beans That Implement Business Interfaces</h5>
<div class="paragraph">
<p>Client access to enterprise beans that implement local business interfaces is accomplished through either dependency injection or JNDI lookup.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To obtain a reference to the local business interface of an enterprise bean through dependency injection, use the <code>jakarta.ejb.EJB</code> annotation and specify the enterprise bean&#8217;s local business interface name:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@EJB</span>
Example example;</code></pre>
</div>
</div>
</li>
<li>
<p>To obtain a reference to a local business interface of an enterprise bean through JNDI lookup, use the <code>javax.naming.InitialContext</code> interface&#8217;s <code>lookup</code> method:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ExampleLocal example = (ExampleLocal)
         <span class="predefined-type">InitialContext</span>.lookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">java:module/ExampleLocal</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="remote-clients"><a class="anchor" href="#remote-clients"></a>Remote Clients</h4>
<div class="paragraph">
<p>A remote client of an enterprise bean has the following traits.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It can run on a different machine and a different JVM from the enterprise bean it accesses.
(It is not required to run on a different JVM.)</p>
</li>
<li>
<p>It can be a web component, an application client, or another enterprise bean.</p>
</li>
<li>
<p>To a remote client, the location of the enterprise bean is transparent.</p>
</li>
<li>
<p>The enterprise bean must implement a business interface.
That is, remote clients may not access an enterprise bean through a no-interface view.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To create an enterprise bean that allows remote access, you must either</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Decorate the business interface of the enterprise bean with the <code>@Remote</code> annotation:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Remote</span>
<span class="directive">public</span> <span class="type">interface</span> <span class="class">InterfaceName</span> { ... }</code></pre>
</div>
</div>
</li>
<li>
<p>Or decorate the bean class with <code>@Remote</code>, specifying the business interface or interfaces:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Remote</span>(InterfaceName.class)
<span class="directive">public</span> <span class="type">class</span> <span class="class">BeanName</span> <span class="directive">implements</span> InterfaceName { ... }</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The remote interface defines the business and lifecycle methods that are specific to the bean.
For example, the remote interface of a bean named <code>BankAccountBean</code> might have business methods named <code>deposit</code> and <code>credit</code>.
<a href="#interfaces-for-an-enterprise-bean-with-remote-access">Figure 35-1</a> shows how the interface controls the client&#8217;s view of an enterprise bean.</p>
</div>
<div id="interfaces-for-an-enterprise-bean-with-remote-access" class="imageblock">
<div class="content">
<img src="images/jakartaeett_dt_020.svg" alt="Diagram showing a remote client accessing an enterprise bean&#8217;s methods through its remote interface.">
</div>
<div class="title">Figure 35-1 Interfaces for an Enterprise Bean with Remote Access</div>
</div>
<div class="paragraph">
<p>Client access to an enterprise bean that implements a remote business interface is accomplished through either dependency injection or JNDI lookup.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To obtain a reference to the remote business interface of an enterprise bean through dependency injection, use the <code>jakarta.ejb.EJB</code> annotation and specify the enterprise bean&#8217;s remote business interface name:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@EJB</span>
Example example;</code></pre>
</div>
</div>
</li>
<li>
<p>To obtain a reference to a remote business interface of an enterprise bean through JNDI lookup, use the <code>javax.naming.InitialContext</code> interface&#8217;s <code>lookup</code> method:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ExampleRemote example = (ExampleRemote)
        <span class="predefined-type">InitialContext</span>.lookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">java:global/myApp/ExampleRemote</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="web-service-clients"><a class="anchor" href="#web-service-clients"></a>Web Service Clients</h4>
<div class="paragraph">
<p>A web service client can access a Jakarta EE application in two ways.
First, the client can access a web service created with Jakarta XML Web Services.
(For more information on Jakarta XML Web Services, see <a href="#building-web-services-with-jakarta-xml-web-services">Chapter 31, <em>Building Web Services with Jakarta XML Web Services</em></a>.)
Second, a web service client can invoke the business methods of a stateless session bean.
Message beans cannot be accessed by web service clients.</p>
</div>
<div class="paragraph">
<p>Provided that it uses the correct protocols (SOAP, HTTP, WSDL), any web service client can access a stateless session bean, whether or not the client is written in the Java programming language.
The client doesn&#8217;t even "know" what technology implements the service: stateless session bean, Jakarta XML Web Services, or some other technology.
In addition, enterprise beans and web components can be clients of web services.
This flexibility enables you to integrate Jakarta EE applications with web services.</p>
</div>
<div class="paragraph">
<p>A web service client accesses a stateless session bean through the bean&#8217;s web service endpoint implementation class.
By default, all public methods in the bean class are accessible to web service clients.
The <code>@WebMethod</code> annotation may be used to customize the behavior of web service methods.
If the <code>@WebMethod</code> annotation is used to decorate the bean class&#8217;s methods, only those methods decorated with <code>@WebMethod</code> are exposed to web service clients.</p>
</div>
<div class="paragraph">
<p>For a code sample, see <a href="#a-web-service-example-helloservice">A Web Service Example: helloservice</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="method-parameters-and-access"><a class="anchor" href="#method-parameters-and-access"></a>Method Parameters and Access</h4>
<div class="paragraph">
<p>The type of access affects the parameters of the bean methods that are called by clients.
The following sections apply not only to method parameters but also to method return values.</p>
</div>
<div class="sect4">
<h5 id="isolation"><a class="anchor" href="#isolation"></a>Isolation</h5>
<div class="paragraph">
<p>The parameters of remote calls are more isolated than those of local calls.
With remote calls, the client and the bean operate on different copies of a parameter object.
If the client changes the value of the object, the value of the copy in the bean does not change.
This layer of isolation can help protect the bean if the client accidentally modifies the data.</p>
</div>
<div class="paragraph">
<p>In a local call, both the client and the bean can modify the same parameter object.
In general, you should not rely on this side effect of local calls.
Perhaps someday you will want to distribute your components, replacing the local calls with remote ones.</p>
</div>
<div class="paragraph">
<p>As with remote clients, web service clients operate on different copies of parameters than does the bean that implements the web service.</p>
</div>
</div>
<div class="sect4">
<h5 id="granularity-of-accessed-data"><a class="anchor" href="#granularity-of-accessed-data"></a>Granularity of Accessed Data</h5>
<div class="paragraph">
<p>Because remote calls are likely to be slower than local calls, the parameters in remote methods should be relatively coarse-grained.
A coarse-grained object contains more data than a fine-grained one, so fewer access calls are required.
For the same reason, the parameters of the methods called by web service clients should also be coarse-grained.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="the-contents-of-an-enterprise-bean"><a class="anchor" href="#the-contents-of-an-enterprise-bean"></a>The Contents of an Enterprise Bean</h3>
<div class="paragraph">
<p>To develop an enterprise bean, you must provide the following files.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Enterprise bean class: Implements the business methods of the enterprise bean and any lifecycle callback methods.</p>
</li>
<li>
<p>Business interfaces: Define the business methods implemented by the enterprise bean class.
A business interface is not required if the enterprise bean exposes a local, no-interface view.</p>
</li>
<li>
<p>Helper classes: Other classes needed by the enterprise bean class, such as exception and utility classes.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Package the programming artifacts in the preceding list either into an Enterprise Bean JAR file (a stand-alone module that stores the enterprise bean) or within a web application archive (WAR) module.
See <a href="#packaging-enterprise-beans-in-enterprise-bean-jar-modules">Packaging Enterprise Beans in enterprise bean JAR Modules</a> and <a href="#packaging-enterprise-beans-in-war-modules">Packaging Enterprise Beans in WAR Modules</a> for more information.</p>
</div>
</div>
<div class="sect2">
<h3 id="naming-conventions-for-enterprise-beans"><a class="anchor" href="#naming-conventions-for-enterprise-beans"></a>Naming Conventions for Enterprise Beans</h3>
<div class="paragraph">
<p>Because enterprise beans are composed of multiple parts, it&#8217;s useful to follow a naming convention for your applications.
<a href="#naming-conventions-for-enterprise-beans-2">Table 35-2</a> summarizes the conventions for the example beans in this tutorial.</p>
</div>
<table id="naming-conventions-for-enterprise-beans-2" class="tableblock frame-all grid-all" style="width: 63%;">
<caption class="title">Table 35-2 Naming Conventions for Enterprise Beans</caption>
<colgroup>
<col style="width: 40%;">
<col style="width: 30%;">
<col style="width: 30%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Item</th>
<th class="tableblock halign-left valign-top">Syntax</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enterprise bean name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>name</em>Bean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AccountBean</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enterprise bean class</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>name</em>Bean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AccountBean</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Business interface</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>name</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Account</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="the-lifecycles-of-enterprise-beans"><a class="anchor" href="#the-lifecycles-of-enterprise-beans"></a>The Lifecycles of Enterprise Beans</h3>
<div class="paragraph">
<p>An enterprise bean goes through various stages during its lifetime, or lifecycle.
Each type of enterprise bean (stateful session, stateless session, singleton session, or message-driven) has a different lifecycle.</p>
</div>
<div class="paragraph">
<p>The descriptions that follow refer to methods that are explained along with the code examples in the next two chapters.
If you are new to enterprise beans, you should skip this section and run the code examples first.</p>
</div>
<div class="sect3">
<h4 id="the-lifecycle-of-a-stateful-session-bean"><a class="anchor" href="#the-lifecycle-of-a-stateful-session-bean"></a>The Lifecycle of a Stateful Session Bean</h4>
<div class="paragraph">
<p><a href="#lifecycle-of-a-stateful-session-bean">Figure 35-2</a> illustrates the stages that a stateful session bean passes through during its lifetime.
The client initiates the lifecycle by obtaining a reference to a stateful session bean.
The container performs any dependency injection and then invokes the method annotated with <code>@PostConstruct</code>, if any.
The bean is now ready to have its business methods invoked by the client.</p>
</div>
<div id="lifecycle-of-a-stateful-session-bean" class="imageblock">
<div class="content">
<img src="images/jakartaeett_dt_021.svg" alt="Diagram showing the lifecycle of a stateful session bean.">
</div>
<div class="title">Figure 35-2 Lifecycle of a Stateful Session Bean</div>
</div>
<div class="paragraph">
<p>While in the ready stage, the Enterprise Bean container may decide to deactivate, or passivate, the bean by moving it from memory to secondary storage.
(Typically, the Enterprise Bean container uses a least-recently-used algorithm to select a bean for passivation.)
The Enterprise Bean container invokes the method annotated <code>@PrePassivate</code>, if any, immediately before passivating it.
If a client invokes a business method on the bean while it is in the passive stage, the Enterprise Bean container activates the bean, calls the method annotated <code>@PostActivate</code>, if any, and then moves it to the ready stage.</p>
</div>
<div class="paragraph">
<p>At the end of the lifecycle, the client invokes a method annotated <code>@Remove</code>, and the Enterprise Bean container calls the method annotated <code>@PreDestroy</code>, if any.
The bean&#8217;s instance is then ready for garbage collection.</p>
</div>
<div class="paragraph">
<p>Your code controls the invocation of only one lifecycle method: the method annotated <code>@Remove</code>.
All other methods in <a href="#lifecycle-of-a-stateful-session-bean">Figure 35-2</a> are invoked by the Enterprise Bean container.
See <a href="#resource-adapters-and-contracts">Chapter 56, <em>Resource Adapters and Contracts</em></a> for more information.</p>
</div>
</div>
<div class="sect3">
<h4 id="the-lifecycle-of-a-stateless-session-bean"><a class="anchor" href="#the-lifecycle-of-a-stateless-session-bean"></a>The Lifecycle of a Stateless Session Bean</h4>
<div class="paragraph">
<p>Because a stateless session bean is never passivated, its lifecycle has only two stages: nonexistent and ready for the invocation of business methods.
<a href="#lifecycle-of-a-stateless-or-singleton-session-bean">Figure 35-3</a> illustrates the stages of a stateless session bean.</p>
</div>
<div id="lifecycle-of-a-stateless-or-singleton-session-bean" class="imageblock">
<div class="content">
<img src="images/jakartaeett_dt_022.svg" alt="Diagram showing the lifecycle of a stateless or singleton session bean.">
</div>
<div class="title">Figure 35-3 Lifecycle of a Stateless or Singleton Session Bean</div>
</div>
<div class="paragraph">
<p>The Enterprise Bean container typically creates and maintains a pool of stateless session beans, beginning the stateless session bean&#8217;s lifecycle.
The container performs any dependency injection and then invokes the method annotated <code>@PostConstruct</code>, if it exists.
The bean is now ready to have its business methods invoked by a client.</p>
</div>
<div class="paragraph">
<p>At the end of the lifecycle, the Enterprise Bean container calls the method annotated <code>@PreDestroy</code>, if it exists.
The bean&#8217;s instance is then ready for garbage collection.</p>
</div>
</div>
<div class="sect3">
<h4 id="the-lifecycle-of-a-singleton-session-bean"><a class="anchor" href="#the-lifecycle-of-a-singleton-session-bean"></a>The Lifecycle of a Singleton Session Bean</h4>
<div class="paragraph">
<p>Like a stateless session bean, a singleton session bean is never passivated and has only two stages, nonexistent and ready for the invocation of business methods, as shown in <a href="#lifecycle-of-a-stateless-or-singleton-session-bean">Figure 35-3</a>.</p>
</div>
<div class="paragraph">
<p>The Enterprise Bean container initiates the singleton session bean lifecycle by creating the singleton instance.
This occurs upon application deployment if the singleton is annotated with the <code>@Startup</code> annotation.
The container performs any dependency injection and then invokes the method annotated <code>@PostConstruct</code>, if it exists.
The singleton session bean is now ready to have its business methods invoked by the client.</p>
</div>
<div class="paragraph">
<p>At the end of the lifecycle, the Enterprise Bean container calls the method annotated <code>@PreDestroy</code>, if it exists.
The singleton session bean is now ready for garbage collection.</p>
</div>
</div>
<div class="sect3">
<h4 id="the-lifecycle-of-a-message-driven-bean"><a class="anchor" href="#the-lifecycle-of-a-message-driven-bean"></a>The Lifecycle of a Message-Driven Bean</h4>
<div class="paragraph">
<p><a href="#lifecycle-of-a-message-driven-bean">Figure 35-4</a> illustrates the stages in the lifecycle of a message-driven bean.</p>
</div>
<div id="lifecycle-of-a-message-driven-bean" class="imageblock">
<div class="content">
<img src="images/jakartaeett_dt_023.svg" alt="Diagram showing the lifecycle of a message-driven bean.">
</div>
<div class="title">Figure 35-4 Lifecycle of a Message-Driven Bean</div>
</div>
<div class="paragraph">
<p>The Enterprise Bean container usually creates a pool of message-driven bean instances.
For each instance, the Enterprise Bean container performs these tasks.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If the message-driven bean uses dependency injection, the container injects these references before instantiating the instance.</p>
</li>
<li>
<p>The container calls the method annotated <code>@PostConstruct</code>, if any.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Like a stateless session bean, a message-driven bean is never passivated and has only two states: nonexistent and ready to receive messages.</p>
</div>
<div class="paragraph">
<p>At the end of the lifecycle, the container calls the method annotated <code>@PreDestroy</code>, if any.
The bean&#8217;s instance is then ready for garbage collection.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="further-information-about-enterprise-beans"><a class="anchor" href="#further-information-about-enterprise-beans"></a>Further Information about Enterprise Beans</h3>
<div class="paragraph">
<p>For more information on Jakarta Enterprise Beans technology, see the Jakarta Enterprise Beans 4.0 specification:<br>
<a href="https://jakarta.ee/specifications/enterprise-beans/4.0/" class="bare" target="_blank" rel="noopener">https://jakarta.ee/specifications/enterprise-beans/4.0/</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="getting-started-with-enterprise-beans"><a class="anchor" href="#getting-started-with-enterprise-beans"></a>Chapter 36. Getting Started with Enterprise Beans</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter shows how to develop, deploy, and run a simple Jakarta EE application named <code>converter</code> that uses an enterprise bean for its business logic.
The purpose of <code>converter</code> is to calculate currency conversions among Japanese yen, euros, and US dollars.
The <code>converter</code> application consists of an enterprise bean, which performs the calculations, and a web client.</p>
</div>
<div class="sect2">
<h3 id="starting-with-enterprise-beans"><a class="anchor" href="#starting-with-enterprise-beans"></a>Starting With Enterprise Beans</h3>
<div class="paragraph">
<p>Here&#8217;s an overview of the steps you&#8217;ll follow:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create the enterprise bean: <code>ConverterBean</code>.</p>
</li>
<li>
<p>Create the web client.</p>
</li>
<li>
<p>Deploy <code>converter</code> onto the server.</p>
</li>
<li>
<p>Using a browser, run the web client.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Before proceeding, make sure that you&#8217;ve done the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Read <a href="#overview">Chapter 1, <em>Overview</em></a></p>
</li>
<li>
<p>Become familiar with enterprise beans (see <a href="#enterprise-beans">Part VII, &#8220;Enterprise Beans&#8221;</a>)</p>
</li>
<li>
<p>Started the server (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>)</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="creating-the-enterprise-bean"><a class="anchor" href="#creating-the-enterprise-bean"></a>Creating the Enterprise Bean</h3>
<div class="paragraph">
<p>The enterprise bean in our example is a stateless session bean called <code>ConverterBean</code>.
The source code for <code>ConverterBean</code> is in the <code><em>tut-install</em>/examples/ejb/converter/src/main/java/</code> directory.</p>
</div>
<div class="paragraph">
<p>Creating <code>ConverterBean</code> requires these steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Coding the bean&#8217;s implementation class (the source code is provided)</p>
</li>
<li>
<p>Compiling the source code</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="coding-the-enterprise-bean-class"><a class="anchor" href="#coding-the-enterprise-bean-class"></a>Coding the Enterprise Bean Class</h4>
<div class="paragraph">
<p>The enterprise bean class for this example is called <code>ConverterBean</code>.
This class implements two business methods: <code>dollarToYen</code> and <code>yenToEuro</code>.
Because the enterprise bean class doesn&#8217;t implement a business interface, the enterprise bean exposes a local, no-interface view.
The public methods in the enterprise bean class are available to clients that obtain a reference to <code>ConverterBean</code>.
The source code for the <code>ConverterBean</code> class is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">ee.jakarta.tutorial.converter.ejb</span>;

<span class="keyword">import</span> <span class="include">java.math.BigDecimal</span>;
<span class="keyword">import</span> <span class="include">jakarta.ejb</span>.*;

<span class="annotation">@Stateless</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">ConverterBean</span> {
    <span class="directive">private</span> <span class="predefined-type">BigDecimal</span> yenRate = <span class="keyword">new</span> <span class="predefined-type">BigDecimal</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">83.0602</span><span class="delimiter">&quot;</span></span>);
    <span class="directive">private</span> <span class="predefined-type">BigDecimal</span> euroRate = <span class="keyword">new</span> <span class="predefined-type">BigDecimal</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">0.0093016</span><span class="delimiter">&quot;</span></span>);

    <span class="directive">public</span> <span class="predefined-type">BigDecimal</span> dollarToYen(<span class="predefined-type">BigDecimal</span> dollars) {
        <span class="predefined-type">BigDecimal</span> result = dollars.multiply(yenRate);
        <span class="keyword">return</span> result.setScale(<span class="integer">2</span>, <span class="predefined-type">BigDecimal</span>.ROUND_UP);
    }

    <span class="directive">public</span> <span class="predefined-type">BigDecimal</span> yenToEuro(<span class="predefined-type">BigDecimal</span> yen) {
        <span class="predefined-type">BigDecimal</span> result = yen.multiply(euroRate);
        <span class="keyword">return</span> result.setScale(<span class="integer">2</span>, <span class="predefined-type">BigDecimal</span>.ROUND_UP);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note the <code>@Stateless</code> annotation decorating the enterprise bean class.
This annotation lets the container know that <code>ConverterBean</code> is a stateless session bean.</p>
</div>
</div>
<div class="sect3">
<h4 id="creating-the-converter-web-client"><a class="anchor" href="#creating-the-converter-web-client"></a>Creating the converter Web Client</h4>
<div class="paragraph">
<p>The web client is contained in the following servlet class under the <code><em>tut-install</em>/examples/ejb/converter/src/main/java/</code> directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>converter/web/ConverterServlet.java</pre>
</div>
</div>
<div class="paragraph">
<p>A Jakarta servlet is a web component that responds to HTTP requests.</p>
</div>
<div class="paragraph">
<p>The <code>ConverterServlet</code> class uses dependency injection to obtain a reference to <code>ConverterBean</code>.
The <code>jakarta.ejb.EJB</code> annotation is added to the declaration of the private member variable <code>converter</code>, which is of type <code>ConverterBean</code>.
<code>ConverterBean</code> exposes a local, no-interface view, so the enterprise bean implementation class is the variable type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@WebServlet</span>(urlPatterns=<span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">ConverterServlet</span> <span class="directive">extends</span> HttpServlet {
  <span class="annotation">@EJB</span>
  ConverterBean converter;
  ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When the user enters an amount to be converted to yen and euro, the amount is retrieved from the request parameters; then the <code>ConverterBean.dollarToYen</code> and the <code>ConverterBean.yenToEuro</code> methods are called:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">...
try {
  <span class="predefined-type">String</span> amount = request.getParameter(<span class="string"><span class="delimiter">&quot;</span><span class="content">amount</span><span class="delimiter">&quot;</span></span>);
  <span class="keyword">if</span> (amount != <span class="predefined-constant">null</span> &amp;&amp; amount.length() &gt; <span class="integer">0</span>) {
    <span class="comment">// convert the amount to a BigDecimal from the request parameter</span>
    <span class="predefined-type">BigDecimal</span> d = <span class="keyword">new</span> <span class="predefined-type">BigDecimal</span>(amount);
    <span class="comment">// call the ConverterBean.dollarToYen() method to get the amount</span>
    <span class="comment">// in Yen</span>
    <span class="predefined-type">BigDecimal</span> yenAmount = converter.dollarToYen(d);

    <span class="comment">// call the ConverterBean.yenToEuro() method to get the amount</span>
    <span class="comment">// in Euros</span>
    <span class="predefined-type">BigDecimal</span> euroAmount = converter.yenToEuro(yenAmount);
    ...
  }
  ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The results are displayed to the user.</p>
</div>
</div>
<div class="sect3">
<h4 id="running-the-converter-example"><a class="anchor" href="#running-the-converter-example"></a>Running the converter Example</h4>
<div class="paragraph">
<p>Now you are ready to compile the enterprise bean class (<code>ConverterBean.java</code>) and the servlet class (<code>ConverterServlet.java</code>) and to package the compiled classes into a WAR file.
You can use either NetBeans IDE or Maven to build, package, deploy, and run the <code>converter</code> example.</p>
</div>
<div class="sect4">
<h5 id="to-run-the-converter-example-using-netbeans-ide"><a class="anchor" href="#to-run-the-converter-example-using-netbeans-ide"></a>To Run the converter Example Using NetBeans IDE</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>From the <strong>File</strong> menu, choose <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the <strong>Open Project</strong> dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/ejb</pre>
</div>
</div>
</li>
<li>
<p>Select the <code>converter</code> folder.</p>
</li>
<li>
<p>Click <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the <strong>Projects</strong> tab, right-click the <code>converter</code> project and select <strong>Build</strong>.</p>
</li>
<li>
<p>Open a web browser to the following URL:</p>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080/converter</pre>
</div>
</div>
</li>
<li>
<p>On the Servlet ConverterServlet page, enter <code>100</code> in the field and click Submit.</p>
<div class="paragraph">
<p>A second page opens, showing the converted values.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-run-the-converter-example-using-maven"><a class="anchor" href="#to-run-the-converter-example-using-maven"></a>To Run the converter Example Using Maven</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>In a terminal window, go to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/ejb/converter/</pre>
</div>
</div>
</li>
<li>
<p>Enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">mvn install</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command compiles the source files for the enterprise bean and the servlet, packages the project into a WAR module (<code>converter.war</code>), and deploys the WAR to the server.
For more information about Maven, see <a href="#building-the-examples">Building the Examples</a>.</p>
</div>
</li>
<li>
<p>Open a web browser to the following URL:</p>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080/converter</pre>
</div>
</div>
</li>
<li>
<p>On the Servlet ConverterServlet page, enter <code>100</code> in the field and click Submit.</p>
<div class="paragraph">
<p>A second page opens, showing the converted values.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="modifying-the-jakarta-ee-application"><a class="anchor" href="#modifying-the-jakarta-ee-application"></a>Modifying the Jakarta EE Application</h3>
<div class="paragraph">
<p>GlassFish Server supports iterative development.
Whenever you make a change to a Jakarta EE application, you must redeploy the application.</p>
</div>
<div class="sect3">
<h4 id="to-modify-a-class-file"><a class="anchor" href="#to-modify-a-class-file"></a>To Modify a Class File</h4>
<div class="paragraph">
<p>To modify a class file in an enterprise bean, you change the source code, recompile it, and redeploy the application.
For example, to update the exchange rate in the <code>dollarToYen</code> business method of the <code>ConverterBean</code> class, you would follow these steps.</p>
</div>
<div class="paragraph">
<p>To modify <code>ConverterServlet</code>, the procedure is the same.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Edit <code>ConverterBean.java</code> and save the file.</p>
</li>
<li>
<p>Recompile the source file.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>To recompile <code>ConverterBean.java</code> in NetBeans IDE, right-click the <code>converter</code> project and select Run.</p>
<div class="paragraph">
<p>This recompiles the <code>ConverterBean.java</code> file, replaces the old class file in the build directory, and redeploys the application to GlassFish Server.</p>
</div>
</li>
<li>
<p>Recompile <code>ConverterBean.java</code> using Maven.</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>In a terminal window, go to the <code><em>tut-install</em>/examples/ejb/converter/</code> directory.</p>
</li>
<li>
<p>Enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">mvn install</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command repackages and deploys the application.</p>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="running-the-enterprise-bean-examples"><a class="anchor" href="#running-the-enterprise-bean-examples"></a>Chapter 37. Running the Enterprise Bean Examples</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter describes the Jakarta Enterprise Beans examples.
Session beans provide a simple but powerful way to encapsulate business logic within an application.
They can be accessed from remote Java clients, web service clients, and components running in the same server.</p>
</div>
<div class="sect2">
<h3 id="overview-of-the-jakarta-enterprise-beans-examples"><a class="anchor" href="#overview-of-the-jakarta-enterprise-beans-examples"></a>Overview of the Jakarta Enterprise Beans Examples</h3>
<div class="paragraph">
<p>In <a href="#getting-started-with-enterprise-beans">Chapter 36, <em>Getting Started with Enterprise Beans</em></a>, you built a stateless session bean named <code>ConverterBean</code>.
This chapter examines the source code of four more session beans:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>CartBean</code>: a stateful session bean that is accessed by a remote client</p>
</li>
<li>
<p><code>CounterBean</code>: a singleton session bean</p>
</li>
<li>
<p><code>HelloServiceBean</code>: a stateless session bean that implements a web service</p>
</li>
<li>
<p><code>TimerSessionBean</code>: a stateless session bean that sets a timer</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="the-cart-example"><a class="anchor" href="#the-cart-example"></a>The cart Example</h3>
<div class="paragraph">
<p>The <code>cart</code> example represents a shopping cart in an online bookstore and uses a stateful session bean to manage the operations of the shopping cart.
The bean&#8217;s client can add a book to the cart, remove a book, or retrieve the cart&#8217;s contents.
To assemble <code>cart</code>, you need the following code:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Session bean class (<code>CartBean</code>)</p>
</li>
<li>
<p>Remote business interface (<code>Cart</code>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All session beans require a session bean class.
All enterprise beans that permit remote access must have a remote business interface.
To meet the needs of a specific application, an enterprise bean may also need some helper classes.
The <code>CartBean</code> session bean uses two helper classes, <code>BookException</code> and <code>IdVerifier</code>, which are discussed in the section <a href="#helper-classes">Helper Classes</a>.</p>
</div>
<div class="paragraph">
<p>The source code for this example is in the <code><em>tut-install</em>/examples/ejb/cart/</code> directory.</p>
</div>
<div class="sect3">
<h4 id="the-business-interface"><a class="anchor" href="#the-business-interface"></a>The Business Interface</h4>
<div class="paragraph">
<p>The <code>Cart</code> business interface is a plain Java interface that defines all the business methods implemented in the bean class.
If the bean class implements a single interface, that interface is assumed to the business interface.
The business interface is a local interface unless it is annotated with the <code>jakarta.ejb.Remote</code> annotation; the <code>jakarta.ejb.Local</code> annotation is optional in this case.</p>
</div>
<div class="paragraph">
<p>The bean class may implement more than one interface.
In that case, the business interfaces must either be explicitly annotated <code>@Local</code> or <code>@Remote</code> or be specified by decorating the bean class with <code>@Local</code> or <code>@Remote</code>.
However, the following interfaces are excluded when determining whether the bean class implements more than one interface:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>java.io.Serializable</code></p>
</li>
<li>
<p><code>java.io.Externalizable</code></p>
</li>
<li>
<p>Any of the interfaces defined by the <code>jakarta.ejb</code> package</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The source code for the <code>Cart</code> business interface is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">ee.jakarta.tutorial.cart.ejb</span>;

<span class="keyword">import</span> <span class="include">cart.util.BookException</span>;
<span class="keyword">import</span> <span class="include">java.util.List</span>;
<span class="keyword">import</span> <span class="include">jakarta.ejb.Remote</span>;

<span class="annotation">@Remote</span>
<span class="directive">public</span> <span class="type">interface</span> <span class="class">Cart</span> {
    <span class="directive">public</span> <span class="type">void</span> initialize(<span class="predefined-type">String</span> person) <span class="directive">throws</span> BookException;
    <span class="directive">public</span> <span class="type">void</span> initialize(<span class="predefined-type">String</span> person, <span class="predefined-type">String</span> id) <span class="directive">throws</span> BookException;
    <span class="directive">public</span> <span class="type">void</span> addBook(<span class="predefined-type">String</span> title);
    <span class="directive">public</span> <span class="type">void</span> removeBook(<span class="predefined-type">String</span> title) <span class="directive">throws</span> BookException;
    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; getContents();
    <span class="directive">public</span> <span class="type">void</span> remove();
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="session-bean-class"><a class="anchor" href="#session-bean-class"></a>Session Bean Class</h4>
<div class="paragraph">
<p>The session bean class for this example is called <code>CartBean</code>.
Like any stateful session bean, the <code>CartBean</code> class must meet the following requirements.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The class is annotated <code>@Stateful</code>.</p>
</li>
<li>
<p>The class implements the business methods defined in the business interface.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Stateful session beans may also do the following.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Implement the business interface, a plain Java interface.
It is good practice to implement the bean&#8217;s business interface.</p>
</li>
<li>
<p>Implement any optional lifecycle callback methods, annotated <code>@PostConstruct</code>, <code>@PreDestroy</code>, <code>@PostActivate</code>, and <code>@PrePassivate</code>.</p>
</li>
<li>
<p>Implement any optional business methods annotated <code>@Remove</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The source code for the <code>CartBean</code> class is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">ee.jakarta.tutorial.cart.ejb</span>;

<span class="keyword">import</span> <span class="include">java.io.Serializable</span>;
<span class="keyword">import</span> <span class="include">java.util.ArrayList</span>;
<span class="keyword">import</span> <span class="include">java.util.List</span>;
<span class="keyword">import</span> <span class="include">ee.jakarta.tutorial.cart.util.BookException</span>;
<span class="keyword">import</span> <span class="include">ee.jakarta.tutorial.cart.util.IdVerifier</span>;
<span class="keyword">import</span> <span class="include">jakarta.ejb.Remove</span>;
<span class="keyword">import</span> <span class="include">jakarta.ejb.Stateful</span>;

<span class="annotation">@Stateful</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">CartBean</span> <span class="directive">implements</span> Cart {
    <span class="predefined-type">String</span> customerId;
    <span class="predefined-type">String</span> customerName;
    <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; contents;

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> initialize(<span class="predefined-type">String</span> person) <span class="directive">throws</span> BookException {
        <span class="keyword">if</span> (person == <span class="predefined-constant">null</span>) {
            <span class="keyword">throw</span> <span class="keyword">new</span> BookException(<span class="string"><span class="delimiter">&quot;</span><span class="content">Null person not allowed.</span><span class="delimiter">&quot;</span></span>);
        } <span class="keyword">else</span> {
            customerName = person;
        }
        customerId = <span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span>;
        contents = <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;&gt;();
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> initialize(<span class="predefined-type">String</span> person, <span class="predefined-type">String</span> id)
                 <span class="directive">throws</span> BookException {
        <span class="keyword">if</span> (person == <span class="predefined-constant">null</span>) {
            <span class="keyword">throw</span> <span class="keyword">new</span> BookException(<span class="string"><span class="delimiter">&quot;</span><span class="content">Null person not allowed.</span><span class="delimiter">&quot;</span></span>);
        } <span class="keyword">else</span> {
            customerName = person;
        }

        IdVerifier idChecker = <span class="keyword">new</span> IdVerifier();
        <span class="keyword">if</span> (idChecker.validate(id)) {
            customerId = id;
        } <span class="keyword">else</span> {
            <span class="keyword">throw</span> <span class="keyword">new</span> BookException(<span class="string"><span class="delimiter">&quot;</span><span class="content">Invalid id: </span><span class="delimiter">&quot;</span></span> + id);
        }

        contents = <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;&gt;();
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> addBook(<span class="predefined-type">String</span> title) {
        contents.add(title);
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> removeBook(<span class="predefined-type">String</span> title) <span class="directive">throws</span> BookException {
        <span class="type">boolean</span> result = contents.remove(title);
        <span class="keyword">if</span> (result == <span class="predefined-constant">false</span>) {
            <span class="keyword">throw</span> <span class="keyword">new</span> BookException(<span class="string"><span class="delimiter">&quot;</span><span class="char">\&quot;</span><span class="delimiter">&quot;</span></span> + title + <span class="string"><span class="delimiter">&quot;</span><span class="content"> not in cart.</span><span class="delimiter">&quot;</span></span>);
        }
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; getContents() {
        <span class="keyword">return</span> contents;
    }

    <span class="annotation">@Remove</span>
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> remove() {
        contents = <span class="predefined-constant">null</span>;
    }
}</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="lifecycle-callback-methods"><a class="anchor" href="#lifecycle-callback-methods"></a>Lifecycle Callback Methods</h5>
<div class="paragraph">
<p>A method in the bean class may be declared as a lifecycle callback method by annotating the method with the following annotations.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>jakarta.annotation.PostConstruct</code>: Methods annotated with <code>@PostConstruct</code> are invoked by the container on newly constructed bean instances after all dependency injection has completed and before the first business method is invoked on the enterprise bean.</p>
</li>
<li>
<p><code>jakarta.annotation.PreDestroy</code>: Methods annotated with <code>@PreDestroy</code> are invoked after any method annotated <code>@Remove</code> has completed and before the container removes the enterprise bean instance.</p>
</li>
<li>
<p><code>jakarta.ejb.PostActivate</code>: Methods annotated with <code>@PostActivate</code> are invoked by the container after the container moves the bean from secondary storage to active status.</p>
</li>
<li>
<p><code>jakarta.ejb.PrePassivate</code>: Methods annotated with <code>@PrePassivate</code> are invoked by the container before it passivates the enterprise bean, meaning that the container temporarily removes the bean from the environment and saves it to secondary storage.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Lifecycle callback methods must return <code>void</code> and have no parameters.</p>
</div>
</div>
<div class="sect4">
<h5 id="business-methods"><a class="anchor" href="#business-methods"></a>Business Methods</h5>
<div class="paragraph">
<p>The primary purpose of a session bean is to run business tasks for the client.
The client invokes business methods on the object reference it gets from dependency injection or JNDI lookup.
From the client&#8217;s perspective, the business methods appear to run locally, although they run remotely in the session bean.
The following code snippet shows how the <code>CartClient</code> program invokes the business methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">cart.initialize(<span class="string"><span class="delimiter">&quot;</span><span class="content">Duke DeEarl</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">123</span><span class="delimiter">&quot;</span></span>);
...
cart.addBook(<span class="string"><span class="delimiter">&quot;</span><span class="content">Bel Canto</span><span class="delimiter">&quot;</span></span>);
 ...
List&lt;<span class="predefined-type">String</span>&gt; bookList = cart.getContents();
...
cart.removeBook(<span class="string"><span class="delimiter">&quot;</span><span class="content">Gravity's Rainbow</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>CartBean</code> class implements the business methods in the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> addBook(<span class="predefined-type">String</span> title) {
   contents.add(title);
}

<span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> removeBook(<span class="predefined-type">String</span> title) <span class="directive">throws</span> BookException {
   <span class="type">boolean</span> result = contents.remove(title);
   <span class="keyword">if</span> (result == <span class="predefined-constant">false</span>) {
      <span class="keyword">throw</span> <span class="keyword">new</span> BookException(<span class="string"><span class="delimiter">&quot;</span><span class="char">\&quot;</span><span class="delimiter">&quot;</span></span> + title + <span class="string"><span class="delimiter">&quot;</span><span class="content">not in cart.</span><span class="delimiter">&quot;</span></span>);
   }
}

<span class="annotation">@Override</span>
<span class="directive">public</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; getContents() {
   <span class="keyword">return</span> contents;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The signature of a business method must conform to these rules.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The method name must not begin with <code>ejb</code>, to avoid conflicts with callback methods defined by the Jakarta Enterprise Beans architecture.
For example, you cannot call a business method <code>ejbCreate</code> or <code>ejbActivate</code>.</p>
</li>
<li>
<p>The access control modifier must be <code>public</code>.</p>
</li>
<li>
<p>If the bean allows remote access through a remote business interface, the arguments and return types must be legal types for the Java Remote Method Invocation (RMI) API.</p>
</li>
<li>
<p>If the bean is a Jakarta XML Web Services endpoint, the arguments and return types for the methods annotated <code>@WebMethod</code> must be legal types for Jakarta XML Web Services.</p>
</li>
<li>
<p>If the bean is a Jakarta RESTful Web Services resource, the arguments and return types for the resource methods must be legal types for Jakarta RESTful Web Services.</p>
</li>
<li>
<p>The modifier must not be <code>static</code> or <code>final</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>throws</code> clause can include exceptions that you define for your application.
The <code>removeBook</code> method, for example, throws a <code>BookException</code> if the book is not in the cart.</p>
</div>
<div class="paragraph">
<p>To indicate a system-level problem, such as the inability to connect to a database, a business method should throw a <code>jakarta.ejb.EJBException</code>.
The container will not wrap application exceptions, such as <code>BookException</code>.
Because <code>EJBException</code> is a subclass of <code>RuntimeException</code>, you do not need to include it in the <code>throws</code> clause of the business method.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="the-remove-method"><a class="anchor" href="#the-remove-method"></a>The @Remove Method</h4>
<div class="paragraph">
<p>Business methods annotated with <code>jakarta.ejb.Remove</code> in the stateful session bean class can be invoked by enterprise bean clients to remove the bean instance.
The container will remove the enterprise bean after a <code>@Remove</code> method completes, either normally or abnormally.</p>
</div>
<div class="paragraph">
<p>In <code>CartBean</code>, the <code>remove</code> method is a <code>@Remove</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Remove</span>
<span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> remove() {
    contents = <span class="predefined-constant">null</span>;
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="helper-classes"><a class="anchor" href="#helper-classes"></a>Helper Classes</h4>
<div class="paragraph">
<p>The <code>CartBean</code> session bean has two helper classes: <code>BookException</code> and <code>IdVerifier</code>.
The <code>BookException</code> is thrown by the <code>removeBook</code> method, and the <code>IdVerifier</code> validates the <code>customerId</code> in one of the <code>create</code> methods.
Helper classes may reside in an EJB JAR file that contains the enterprise bean class; a WAR file if the enterprise bean is packaged within a WAR; or an EAR file that contains an EJB JAR, a WAR file, or a separate library JAR file.
In <code>cart</code>, the helper classes are included in a library JAR used by the application client and the EJB JAR.</p>
</div>
</div>
<div class="sect3">
<h4 id="running-the-cart-example"><a class="anchor" href="#running-the-cart-example"></a>Running the cart Example</h4>
<div class="paragraph">
<p>Now you are ready to compile the remote interface (<code>Cart.java</code>), the enterprise bean class (<code>CartBean.java</code>), the client class (<code>CartClient.java</code>), and the helper classes (<code>BookException.java</code> and <code>IdVerifier.java</code>).</p>
</div>
<div class="paragraph">
<p>You can use either NetBeans IDE or Maven to build, package, deploy, and run the <code>cart</code> application.</p>
</div>
<div class="sect4">
<h5 id="to-run-the-cart-example-using-netbeans-ide"><a class="anchor" href="#to-run-the-cart-example-using-netbeans-ide"></a>To Run the cart Example Using NetBeans IDE</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>From the <strong>File</strong> menu, choose <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the <strong>Open Project</strong> dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/ejb</pre>
</div>
</div>
</li>
<li>
<p>Select the <code>cart</code> folder.</p>
</li>
<li>
<p>Select the <strong>Open Required Projects</strong> check box.</p>
</li>
<li>
<p>Click Open Project.</p>
</li>
<li>
<p>In the <strong>Projects</strong> tab, right-click the <code>cart</code> project and select <strong>Build</strong>.</p>
<div class="paragraph">
<p>This builds and packages the application into <code>cart.ear</code>, located in <code><em>tut-install</em>/examples/ejb/cart/cart-ear/target/</code>, and deploys this EAR file to your GlassFish Server instance.</p>
</div>
<div class="paragraph">
<p>You will see the output of the <code>cart-app-client</code> application client in the Output tab:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>...
Retrieving book title from cart: Infinite Jest
Retrieving book title from cart: Bel Canto
Retrieving book title from cart: Kafka on the Shore
Removing "Gravity's Rainbow" from cart.
Caught a BookException: "Gravity's Rainbow" not in cart.</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-run-the-cart-example-using-maven"><a class="anchor" href="#to-run-the-cart-example-using-maven"></a>To Run the cart Example Using Maven</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see
<a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>In a terminal window, go to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/ejb/cart/</pre>
</div>
</div>
</li>
<li>
<p>Enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">mvn install</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command compiles and packages the application into an EAR file, <code>cart.ear</code>, located in the <code>target</code> directory, and deploys the EAR to your GlassFish Server instance.</p>
</div>
<div class="paragraph">
<p>Then, the client stubs are retrieved and run.
This is equivalent to running the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">appclient -client cart-ear/target/cart-earClient.jar</code></pre>
</div>
</div>
<div class="paragraph">
<p>The client JAR, <code>cart-earClient.jar</code>, contains the application client class, the helper class <code>BookException</code>, and the <code>Cart</code> business interface.</p>
</div>
<div class="paragraph">
<p>When you run the client, the application client container injects any component references declared in the application client class, in this case the reference to the <code>Cart</code> enterprise bean.</p>
</div>
<div class="paragraph">
<p>You will see the output of the <code>cart-app-client</code> application client in the terminal window:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>...
Retrieving book title from cart: Infinite Jest
Retrieving book title from cart: Bel Canto
Retrieving book title from cart: Kafka on the Shore
Removing "Gravity's Rainbow" from cart.
Caught a BookException: "Gravity's Rainbow" not in cart.</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="a-singleton-session-bean-example-counter"><a class="anchor" href="#a-singleton-session-bean-example-counter"></a>A Singleton Session Bean Example: counter</h3>
<div class="paragraph">
<p>The <code>counter</code> example demonstrates how to create a singleton session bean.</p>
</div>
<div class="sect3">
<h4 id="creating-a-singleton-session-bean"><a class="anchor" href="#creating-a-singleton-session-bean"></a>Creating a Singleton Session Bean</h4>
<div class="paragraph">
<p>The <code>jakarta.ejb.Singleton</code> annotation is used to specify that the enterprise bean implementation class is a singleton session bean:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Singleton</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">SingletonBean</span> { ... }</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="initializing-singleton-session-beans"><a class="anchor" href="#initializing-singleton-session-beans"></a>Initializing Singleton Session Beans</h5>
<div class="paragraph">
<p>The Enterprise Bean container is responsible for determining when to initialize a singleton session bean instance unless the singleton session bean implementation class is annotated with the <code>jakarta.ejb.Startup</code> annotation.
In this case, sometimes called eager initialization, the Enterprise Bean container must initialize the singleton session bean upon application startup.
The singleton session bean is initialized before the Enterprise Bean container delivers client requests to any enterprise beans in the application.
This allows the singleton session bean to perform, for example, application startup tasks.</p>
</div>
<div class="paragraph">
<p>The following singleton session bean stores the status of an application and is eagerly initialized:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Startup</span>
<span class="annotation">@Singleton</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">StatusBean</span> {
  <span class="directive">private</span> <span class="predefined-type">String</span> status;

  <span class="annotation">@PostConstruct</span>
  <span class="type">void</span> init {
    status = <span class="string"><span class="delimiter">&quot;</span><span class="content">Ready</span><span class="delimiter">&quot;</span></span>;
  }
  ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Sometimes multiple singleton session beans are used to initialize data for an application and therefore must be initialized in a specific order.
In these cases, use the <code>jakarta.ejb.DependsOn</code> annotation to declare the startup dependencies of the singleton session bean.
The <code>@DependsOn</code> annotation&#8217;s <code>value</code> attribute is one or more strings that specify the name of the target singleton session bean.
If more than one dependent singleton bean is specified in <code>@DependsOn</code>, the order in which they are listed is not necessarily the order in which the Enterprise Bean container will initialize the target singleton session beans.</p>
</div>
<div class="paragraph">
<p>The following singleton session bean, <code>PrimaryBean</code>, should be started up first:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Singleton</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">PrimaryBean</span> { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>SecondaryBean</code> depends on <code>PrimaryBean</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Singleton</span>
<span class="annotation">@DependsOn</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">PrimaryBean</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">SecondaryBean</span> { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>This guarantees that the Enterprise Bean container will initialize <code>PrimaryBean</code> before <code>SecondaryBean</code>.</p>
</div>
<div class="paragraph">
<p>The following singleton session bean, <code>TertiaryBean</code>, depends on <code>PrimaryBean</code> and <code>SecondaryBean</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Singleton</span>
<span class="annotation">@DependsOn</span>({<span class="string"><span class="delimiter">&quot;</span><span class="content">PrimaryBean</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">SecondaryBean</span><span class="delimiter">&quot;</span></span>})
<span class="directive">public</span> <span class="type">class</span> <span class="class">TertiaryBean</span> { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>SecondaryBean</code> explicitly requires <code>PrimaryBean</code> to be initialized before it is initialized, through its own <code>@DependsOn</code> annotation.
In this case, the Enterprise Bean container will first initialize <code>PrimaryBean</code>, then <code>SecondaryBean</code>, and finally <code>TertiaryBean</code>.</p>
</div>
<div class="paragraph">
<p>If, however, <code>SecondaryBean</code> did not explicitly depend on <code>PrimaryBean</code>, the Enterprise Bean container may initialize either <code>PrimaryBean</code> or <code>SecondaryBean</code> first.
That is, the Enterprise Bean container could initialize the singletons in the following order: <code>SecondaryBean</code>, <code>PrimaryBean</code>, <code>TertiaryBean</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="managing-concurrent-access-in-a-singleton-session-bean"><a class="anchor" href="#managing-concurrent-access-in-a-singleton-session-bean"></a>Managing Concurrent Access in a Singleton Session Bean</h5>
<div class="paragraph">
<p>Singleton session beans are designed for concurrent access, situations in which many clients need to access a single instance of a session bean at the same time.
A singleton&#8217;s client needs only a reference to a singleton in order to invoke any business methods exposed by the singleton and doesn&#8217;t need to worry about any other clients that may be simultaneously invoking business methods on the same singleton.</p>
</div>
<div class="paragraph">
<p>When creating a singleton session bean, concurrent access to the singleton&#8217;s business methods can be controlled in two ways: container-managed concurrency and bean-managed concurrency.</p>
</div>
<div class="paragraph">
<p>The <code>jakarta.ejb.ConcurrencyManagement</code> annotation is used to specify container-managed or bean-managed concurrency for the singleton.
With <code>@ConcurrencyManagement</code>, a type attribute must be set to either <code>jakarta.ejb.ConcurrencyManagementType.CONTAINER</code> or <code>jakarta.ejb.ConcurrencyManagementType.BEAN</code>.
If no <code>@ConcurrencyManagement</code> annotation is present on the singleton implementation class, the Enterprise Bean container default of container-managed concurrency is used.</p>
</div>
<div class="sect5">
<h6 id="container-managed-concurrency"><a class="anchor" href="#container-managed-concurrency"></a>Container-Managed Concurrency</h6>
<div class="paragraph">
<p>If a singleton uses container-managed concurrency, the Enterprise Bean container controls client access to the business methods of the singleton.
The <code>jakarta.ejb.Lock</code> annotation and a <code>jakarta.ejb.LockType</code> type are used to specify the access level of the singleton&#8217;s business methods or <code>@Timeout</code> methods.
The <code>LockType</code> enumerated types are <code>READ</code> and <code>WRITE</code>.</p>
</div>
<div class="paragraph">
<p>Annotate a singleton&#8217;s business or timeout method with <code>@Lock(LockType.READ)</code> if the method can be concurrently accessed, or shared, with many clients.
Annotate the business or timeout method with <code>@Lock(LockType.WRITE)</code> if the singleton session bean should be locked to other clients while a client is calling that method.
Typically, the <code>@Lock(LockType.WRITE)</code> annotation is used when clients are modifying the state of the singleton.</p>
</div>
<div class="paragraph">
<p>Annotating a singleton class with <code>@Lock</code> specifies that all the business methods and any timeout methods of the singleton will use the specified lock type unless they explicitly set the lock type with a method-level <code>@Lock</code> annotation.
If no <code>@Lock</code> annotation is present on the singleton class, the default lock type, <code>@Lock(LockType.WRITE)</code>, is applied to all business and timeout methods.</p>
</div>
<div class="paragraph">
<p>The following example shows how to use the <code>@ConcurrencyManagement</code>, <code>@Lock(LockType.READ)</code>, and <code>@Lock(LockType.WRITE)</code> annotations for a singleton that uses container-managed concurrency.</p>
</div>
<div class="paragraph">
<p>Although by default singletons use container-managed concurrency, the <code>@ConcurrencyManagement(CONTAINER)</code> annotation may be added at the class level of the singleton to explicitly set the concurrency management type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ConcurrencyManagement</span>(ConcurrencyManagementType.CONTAINER)
<span class="annotation">@Singleton</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">ExampleSingletonBean</span> {
  <span class="directive">private</span> <span class="predefined-type">String</span> state;

  <span class="annotation">@Lock</span>(LockType.READ)
  <span class="directive">public</span> <span class="predefined-type">String</span> getState() {
    <span class="keyword">return</span> state;
  }

  <span class="annotation">@Lock</span>(LockType.WRITE)
  <span class="directive">public</span> <span class="type">void</span> setState(<span class="predefined-type">String</span> newState) {
    state = newState;
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>getState</code> method can be accessed by many clients at the same time because it is annotated with <code>@Lock(LockType.READ)</code>.
When the <code>setState</code> method is called, however, all the methods in <code>ExampleSingletonBean</code> will be locked to other clients because <code>setState</code> is annotated with <code>@Lock(LockType.WRITE)</code>.
This prevents two clients from attempting to simultaneously change the <code>state</code> variable of <code>ExampleSingletonBean</code>.</p>
</div>
<div class="paragraph">
<p>The <code>getData</code> and <code>getStatus</code> methods in the following singleton are of type <code>READ</code>, and the <code>setStatus</code> method is of type <code>WRITE</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Singleton</span>
<span class="annotation">@Lock</span>(LockType.READ)
<span class="directive">public</span> <span class="type">class</span> <span class="class">SharedSingletonBean</span> {
  <span class="directive">private</span> <span class="predefined-type">String</span> data;
  <span class="directive">private</span> <span class="predefined-type">String</span> status;

  <span class="directive">public</span> <span class="predefined-type">String</span> getData() {
    <span class="keyword">return</span> data;
  }

  <span class="directive">public</span> <span class="predefined-type">String</span> getStatus() {
    <span class="keyword">return</span> status;
  }

  <span class="annotation">@Lock</span>(LockType.WRITE)
  <span class="directive">public</span> <span class="type">void</span> setStatus(<span class="predefined-type">String</span> newStatus) {
    status = newStatus;
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If a method is of locking type <code>WRITE</code>, client access to all the singleton&#8217;s methods is blocked until the current client finishes its method call or an access timeout occurs.
When an access timeout occurs, the Enterprise Bean container throws a <code>jakarta.ejb.ConcurrentAccessTimeoutException</code>.
The <code>jakarta.ejb.AccessTimeout</code> annotation is used to specify the number of milliseconds before an access timeout occurs.
If added at the class level of a singleton, <code>@AccessTimeout</code> specifies the access timeout value for all methods in the singleton unless a method explicitly overrides the default with its own <code>@AccessTimeout</code> annotation.</p>
</div>
<div class="paragraph">
<p>The <code>@AccessTimeout</code> annotation can be applied to both <code>@Lock(LockType.READ)</code> and <code>@Lock(LockType.WRITE)</code> methods.
The <code>@AccessTimeout</code> annotation has one required element, <code>value</code>, and one optional element, <code>unit</code>.
By default, the <code>value</code> is specified in milliseconds.
To change the <code>value</code> unit, set <code>unit</code> to one of the <code>java.util.concurrent.TimeUnit</code> constants: <code>NANOSECONDS</code>, <code>MICROSECONDS</code>, <code>MILLISECONDS</code>, or <code>SECONDS</code>.</p>
</div>
<div class="paragraph">
<p>The following singleton has a default access timeout value of 120,000 milliseconds, or 2 minutes.
The <code>doTediousOperation</code> method overrides the default access timeout and sets the value to 360,000 milliseconds, or 6 minutes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Singleton</span>
<span class="annotation">@AccessTimeout</span>(value=<span class="integer">120000</span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">StatusSingletonBean</span> {
  <span class="directive">private</span> <span class="predefined-type">String</span> status;

  <span class="annotation">@Lock</span>(LockType.WRITE)
  <span class="directive">public</span> <span class="type">void</span> setStatus(<span class="predefined-type">String</span> <span class="keyword">new</span> Status) {
    status = newStatus;
  }

  <span class="annotation">@Lock</span>(LockType.WRITE)
  <span class="annotation">@AccessTimeout</span>(value=<span class="integer">360000</span>)
  <span class="directive">public</span> <span class="type">void</span> doTediousOperation {
    ...
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following singleton has a default access timeout value of 60 seconds, specified using the <code>TimeUnit.SECONDS</code> constant:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Singleton</span>
<span class="annotation">@AccessTimeout</span>(value=<span class="integer">60</span>, unit=<span class="predefined-type">TimeUnit</span>.SECONDS)
<span class="directive">public</span> <span class="type">class</span> <span class="class">StatusSingletonBean</span> { ... }</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="bean-managed-concurrency"><a class="anchor" href="#bean-managed-concurrency"></a>Bean-Managed Concurrency</h6>
<div class="paragraph">
<p>Singletons that use bean-managed concurrency allow full concurrent access to all the business and timeout methods in the singleton.
The developer of the singleton is responsible for ensuring that the state of the singleton is synchronized across all clients.
Developers who create singletons with bean-managed concurrency are allowed to use the Java programming language synchronization primitives, such as <code>synchronization</code> and <code>volatile</code>, to prevent errors during concurrent access.</p>
</div>
<div class="paragraph">
<p>Add a <code>@ConcurrencyManagement</code> annotation with the type set to <code>ConcurrencyManagementType.BEAN</code> at the class level of the singleton to specify bean-managed concurrency:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ConcurrencyManagement</span>(ConcurrencyManagementType.BEAN)
<span class="annotation">@Singleton</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">AnotherSingletonBean</span> { ... }</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="handling-errors-in-a-singleton-session-bean"><a class="anchor" href="#handling-errors-in-a-singleton-session-bean"></a>Handling Errors in a Singleton Session Bean</h5>
<div class="paragraph">
<p>If a singleton session bean encounters an error when initialized by the Enterprise Bean container, that singleton instance will be destroyed.</p>
</div>
<div class="paragraph">
<p>Unlike other enterprise beans, once a singleton session bean instance is initialized, it is not destroyed if the singleton&#8217;s business or lifecycle methods cause system exceptions.
This ensures that the same singleton instance is used throughout the application lifecycle.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="the-architecture-of-the-counter-example"><a class="anchor" href="#the-architecture-of-the-counter-example"></a>The Architecture of the counter Example</h4>
<div class="paragraph">
<p>The <code>counter</code> example consists of a singleton session bean, <code>CounterBean</code>, and a Jakarta Faces Facelets web front end.</p>
</div>
<div class="paragraph">
<p><code>CounterBean</code> is a simple singleton with one method, <code>getHits</code>, that returns an integer representing the number of times a web page has been accessed.
Here is the code of <code>CounterBean</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">ee.jakarta.tutorial.counter.ejb</span>;

<span class="keyword">import</span> <span class="include">jakarta.ejb.Singleton</span>;

<span class="comment">/**
 * CounterBean is a simple singleton session bean that records the number
 * of hits to a web page.
 */</span>
<span class="annotation">@Singleton</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">CounterBean</span> {
    <span class="directive">private</span> <span class="type">int</span> hits = <span class="integer">1</span>;

    <span class="comment">// Increment and return the number of hits</span>
    <span class="directive">public</span> <span class="type">int</span> getHits() {
        <span class="keyword">return</span> hits++;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>@Singleton</code> annotation marks <code>CounterBean</code> as a singleton session bean.
<code>CounterBean</code> uses a local, no-interface view.</p>
</div>
<div class="paragraph">
<p><code>CounterBean</code> uses the Enterprise Bean container&#8217;s default metadata values for singletons to simplify the coding of the singleton implementation class.
There is no <code>@ConcurrencyManagement</code> annotation on the class, so the default of container-managed concurrency access is applied.
There is no <code>@Lock</code> annotation on the class or business method, so the default of <code>@Lock(WRITE)</code> is applied to the only business method, <code>getHits</code>.</p>
</div>
<div class="paragraph">
<p>The following version of <code>CounterBean</code> is functionally equivalent to the preceding version:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">ee.jakarta.tutorial.counter.ejb</span>;

<span class="keyword">import</span> <span class="include">jakarta.ejb.Singleton</span>;
<span class="keyword">import</span> <span class="include">jakarta.ejb.ConcurrencyManagement</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">jakarta.ejb.ConcurrencyManagementType.CONTAINER</span>;
<span class="keyword">import</span> <span class="include">jakarta.ejb.Lock</span>;
<span class="keyword">import</span> <span class="include">jakarta.ejb.LockType.WRITE</span>;

<span class="comment">/**
 * CounterBean is a simple singleton session bean that records the number
 * of hits to a web page.
 */</span>
<span class="annotation">@Singleton</span>
<span class="annotation">@ConcurrencyManagement</span>(CONTAINER)
<span class="directive">public</span> <span class="type">class</span> <span class="class">CounterBean</span> {
    <span class="directive">private</span> <span class="type">int</span> hits = <span class="integer">1</span>;

    <span class="comment">// Increment and return the number of hits</span>
    <span class="annotation">@Lock</span>(WRITE)
    <span class="directive">public</span> <span class="type">int</span> getHits() {
        <span class="keyword">return</span> hits++;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The web front end of <code>counter</code> consists of a Jakarta Faces managed bean, <code>Count.java</code>, that is used by the Facelets XHTML files <code>template.xhtml</code> and <code>index.xhtml</code>.
The <code>Count</code> Jakarta Faces managed bean obtains a reference to <code>CounterBean</code> through dependency injection.
<code>Count</code> defines a <code>hitCount</code> JavaBeans property.
When the <code>getHitCount</code> getter method is called from the XHTML files, <code>CounterBean</code>'s <code>getHits</code> method is called to return the current number of page hits.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s the <code>Count</code> managed bean class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Named</span>
<span class="annotation">@ConversationScoped</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Count</span> <span class="directive">implements</span> <span class="predefined-type">Serializable</span> {
    <span class="annotation">@EJB</span>
    <span class="directive">private</span> CounterBean counterBean;

    <span class="directive">private</span> <span class="type">int</span> hitCount;

    <span class="directive">public</span> Count() {
        <span class="local-variable">this</span>.hitCount = <span class="integer">0</span>;
    }

    <span class="directive">public</span> <span class="type">int</span> getHitCount() {
        hitCount = counterBean.getHits();
        <span class="keyword">return</span> hitCount;
    }

    <span class="directive">public</span> <span class="type">void</span> setHitCount(<span class="type">int</span> newHits) {
        <span class="local-variable">this</span>.hitCount = newHits;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>template.xhtml</code> and <code>index.xhtml</code> files are used to render a Facelets view that displays the number of hits to that view.
The <code>index.xhtml</code> file uses an expression language statement, <code>#{count.hitCount}</code>, to access the <code>hitCount</code> property of the <code>Count</code> managed bean.
Here is the content of <code>index.xhtml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;html</span> <span class="attribute-name">lang</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/1999/xhtml</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xmlns:ui</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://xmlns.jcp.org/jsf/facelets</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xmlns:h</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://xmlns.jcp.org/jsf/html</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;ui:composition</span> <span class="attribute-name">template</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/template.xhtml</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;ui:define</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            This page has been accessed #{count.hitCount} time(s).
        <span class="tag">&lt;/ui:define&gt;</span>
        <span class="tag">&lt;ui:define</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">body</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            Hooray!
        <span class="tag">&lt;/ui:define&gt;</span>
    <span class="tag">&lt;/ui:composition&gt;</span>
<span class="tag">&lt;/html&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="running-the-counter-example"><a class="anchor" href="#running-the-counter-example"></a>Running the counter Example</h4>
<div class="paragraph">
<p>You can use either NetBeans IDE or Maven to build, package, deploy, and run the <code>counter</code> example.</p>
</div>
<div class="sect4">
<h5 id="to-run-the-counter-example-using-netbeans-ide"><a class="anchor" href="#to-run-the-counter-example-using-netbeans-ide"></a>To Run the counter Example Using NetBeans IDE</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>From the <strong>File</strong> menu, choose <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the <strong>Open Project</strong> dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/ejb</pre>
</div>
</div>
</li>
<li>
<p>Select the <code>counter</code> folder.</p>
</li>
<li>
<p>Click <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the <strong>Projects</strong> tab, right-click the <code>counter</code> project and select <strong>Run</strong>.</p>
<div class="paragraph">
<p>A web browser will open the URL <a href="http://localhost:8080/counter" class="bare" target="_blank" rel="noopener">http://localhost:8080/counter</a>, which displays the number of hits.</p>
</div>
</li>
<li>
<p>Reload the page to see the hit count increment.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-run-the-counter-example-using-maven"><a class="anchor" href="#to-run-the-counter-example-using-maven"></a>To Run the counter Example Using Maven</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>In a terminal window, go to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/ejb/counter/</pre>
</div>
</div>
</li>
<li>
<p>Enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">mvn install</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will build and deploy <code>counter</code> to your GlassFish Server instance.</p>
</div>
</li>
<li>
<p>In a web browser, enter the following URL:</p>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080/counter</pre>
</div>
</div>
</li>
<li>
<p>Reload the page to see the hit count increment.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="a-web-service-example-helloservice"><a class="anchor" href="#a-web-service-example-helloservice"></a>A Web Service Example: helloservice</h3>
<div class="paragraph">
<p>This example demonstrates a simple web service that generates a response based on information received from the client.
<code>HelloServiceBean</code> is a stateless session bean that implements a single method: <code>sayHello</code>.
This method matches the <code>sayHello</code> method invoked by the client described in <a href="#a-simple-xml-web-services-application-client">A Simple XML Web Services Application Client</a>.</p>
</div>
<div class="sect3">
<h4 id="the-web-service-endpoint-implementation-class"><a class="anchor" href="#the-web-service-endpoint-implementation-class"></a>The Web Service Endpoint Implementation Class</h4>
<div class="paragraph">
<p><code>HelloServiceBean</code> is the endpoint implementation class, typically the primary programming artifact for enterprise bean web service endpoints.
The web service endpoint implementation class has the following requirements.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The class must be annotated with either the <code>jakarta.jws.WebService</code> or the <code>jakarta.jws.WebServiceProvider</code> annotation.</p>
</li>
<li>
<p>The implementing class may explicitly reference an SEI through the <code>endpointInterface</code> element of the <code>@WebService</code> annotation but is not required to do so.
If no <code>endpointInterface</code> is specified in <code>@WebService</code>, an SEI is implicitly defined for the implementing class.</p>
</li>
<li>
<p>The business methods of the implementing class must be public and must not be declared <code>static</code> or <code>final</code>.</p>
</li>
<li>
<p>Business methods that are exposed to web service clients must be annotated with <code>jakarta.jws.WebMethod</code>.</p>
</li>
<li>
<p>Business methods that are exposed to web service clients must have Jakarta XML Binding-compatible parameters and return types.
See the list of Jakarta XML Binding default data type bindings at <a href="#types-supported-by-xml-web-services">Types Supported by XML Web Services</a>.</p>
</li>
<li>
<p>The implementing class must not be declared <code>final</code> and must not be <code>abstract</code>.</p>
</li>
<li>
<p>The implementing class must have a default public constructor.</p>
</li>
<li>
<p>The endpoint class must be annotated <code>@Stateless</code>.</p>
</li>
<li>
<p>The implementing class must not define the <code>finalize</code> method.</p>
</li>
<li>
<p>The implementing class may use the <code>jakarta.annotation.PostConstruct</code> or <code>jakarta.annotation.PreDestroy</code> annotations on its methods for lifecycle event callbacks.</p>
<div class="paragraph">
<p>The <code>@PostConstruct</code> method is called by the container before the implementing class begins responding to web service clients.</p>
</div>
<div class="paragraph">
<p>The <code>@PreDestroy</code> method is called by the container before the endpoint is removed from operation.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="stateless-session-bean-implementation-class"><a class="anchor" href="#stateless-session-bean-implementation-class"></a>Stateless Session Bean Implementation Class</h4>
<div class="paragraph">
<p>The <code>HelloServiceBean</code> class implements the <code>sayHello</code> method, which is annotated <code>@WebMethod</code>.
The source code for the <code>HelloServiceBean</code> class is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">ee.jakarta.tutorial.helloservice.ejb</span>;

<span class="keyword">import</span> <span class="include">jakarta.ejb.Stateless</span>;
<span class="keyword">import</span> <span class="include">jakarta.jws.WebMethod</span>;
<span class="keyword">import</span> <span class="include">jakarta.jws.WebService</span>;

<span class="annotation">@Stateless</span>
<span class="annotation">@WebService</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">HelloServiceBean</span> {
    <span class="directive">private</span> <span class="directive">final</span> <span class="predefined-type">String</span> message = <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello, </span><span class="delimiter">&quot;</span></span>;

    <span class="directive">public</span> <span class="type">void</span> HelloServiceBean() {}

    <span class="annotation">@WebMethod</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> sayHello(<span class="predefined-type">String</span> name) {
        <span class="keyword">return</span> message + name + <span class="string"><span class="delimiter">&quot;</span><span class="content">.</span><span class="delimiter">&quot;</span></span>;
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="running-the-helloservice-example"><a class="anchor" href="#running-the-helloservice-example"></a>Running the helloservice Example</h4>
<div class="paragraph">
<p>You can use either NetBeans IDE or Maven to build, package, and deploy the <code>helloservice</code> example.
You can then use the Administration Console to test the web service endpoint methods.</p>
</div>
<div class="sect4">
<h5 id="to-build-package-and-deploy-the-helloservice-example-using-netbeans-ide"><a class="anchor" href="#to-build-package-and-deploy-the-helloservice-example-using-netbeans-ide"></a>To Build, Package, and Deploy the helloservice Example Using NetBeans IDE</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>From the <strong>File</strong> menu, choose <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the <strong>Open Project</strong> dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/ejb</pre>
</div>
</div>
</li>
<li>
<p>Select the <code>helloservice</code> folder.</p>
</li>
<li>
<p>Click <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the <strong>Projects</strong> tab, right-click the <code>helloservice</code> project and select <strong>Build</strong>.</p>
<div class="paragraph">
<p>This builds and packages the application into <code>helloservice.ear</code>, located in <code><em>tut-install</em>/examples/ejb/helloservice/target/</code>, and deploys this EAR file to GlassFish Server.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-build-package-and-deploy-the-helloservice-example-using-maven"><a class="anchor" href="#to-build-package-and-deploy-the-helloservice-example-using-maven"></a>To Build, Package, and Deploy the helloservice Example Using Maven</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>In a terminal window, go to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/ejb/helloservice/</pre>
</div>
</div>
</li>
<li>
<p>Enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">mvn install</code></pre>
</div>
</div>
<div class="paragraph">
<p>This compiles the source files and packages the application into an enterprise bean JAR file located at <code><em>tut-install</em>/examples/ejb/helloservice/target/helloservice.jar</code>.
Then the enterprise bean JAR file is deployed to GlassFish Server.</p>
</div>
<div class="paragraph">
<p>Upon deployment, GlassFish Server generates additional artifacts required for web service invocation, including the WSDL file.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-test-the-service-without-a-client-2"><a class="anchor" href="#to-test-the-service-without-a-client-2"></a>To Test the Service without a Client</h5>
<div class="paragraph">
<p>The GlassFish Server Administration Console allows you to test the methods of a web service endpoint.
To test the <code>sayHello</code> method of <code>HelloServiceBean</code>, follow these steps.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open the <strong>Administration Console</strong> by opening the following URL in a
web browser:</p>
<div class="listingblock">
<div class="content">
<pre>http://localhost:4848/</pre>
</div>
</div>
</li>
<li>
<p>In the navigation tree, select the <strong>Applications</strong> node.</p>
</li>
<li>
<p>In the <strong>Applications</strong> table, click the <code>helloservice</code> link.</p>
</li>
<li>
<p>In the <strong>Modules and Components</strong> table, click the <strong>View Endpoint</strong> link.</p>
</li>
<li>
<p>On the <strong>Web Service Endpoint Information</strong> page, click the <strong>Tester</strong> link:</p>
<div class="listingblock">
<div class="content">
<pre>/HelloServiceBeanService/HelloServiceBean?Tester</pre>
</div>
</div>
</li>
<li>
<p>On the <strong>Web Service Test Links</strong> page, click the non-secure link (the one that specifies port 8080).</p>
</li>
<li>
<p>On the <strong>HelloServiceBeanService Web Service Tester</strong> page, under <strong>Methods</strong>, enter a name as the parameter to the <code>sayHello</code> method.</p>
</li>
<li>
<p>Click <strong>sayHello</strong>.</p>
<div class="paragraph">
<p>The sayHello Method invocation page opens.
Under Method returned, you&#8217;ll see the response from the endpoint.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-the-timer-service"><a class="anchor" href="#using-the-timer-service"></a>Using the Timer Service</h3>
<div class="paragraph">
<p>Applications that model business work flows often rely on timed notifications.
The timer service of the enterprise bean container enables you to schedule timed notifications for all types of enterprise beans except for stateful session beans.
You can schedule a timed notification to occur according to a calendar schedule, at a specific time, after a duration of time, or at timed intervals.
For example, you could set timers to go off at 10:30 a.m. on May 23, in 30 days, or every 12 hours.</p>
</div>
<div class="paragraph">
<p>Enterprise bean timers are either programmatic timers or automatic timers.
Programmatic timers are set by explicitly calling one of the timer creation methods of the <code>TimerService</code> interface.
Automatic timers are created upon the successful deployment of an enterprise bean that contains a method annotated with the <code>jakarta.ejb.Schedule</code> or <code>jakarta.ejb.Schedules</code> annotations.</p>
</div>
<div class="sect3">
<h4 id="creating-calendar-based-timer-expressions"><a class="anchor" href="#creating-calendar-based-timer-expressions"></a>Creating Calendar-Based Timer Expressions</h4>
<div class="paragraph">
<p>Timers can be set according to a calendar-based schedule, expressed using a syntax similar to the UNIX <code>cron</code> utility.
Both programmatic and automatic timers can use calendar-based timer expressions. <a href="#calendar-based-timer-attributes">Table 37-1</a> shows the calendar-based timer attributes.</p>
</div>
<table id="calendar-based-timer-attributes" class="tableblock frame-all grid-all" style="width: 99%;">
<caption class="title">Table 37-1 Calendar-Based Timer Attributes</caption>
<colgroup>
<col style="width: 15%;">
<col style="width: 35%;">
<col style="width: 15%;">
<col style="width: 35%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default Value</th>
<th class="tableblock halign-left valign-top">Allowable Values and Examples</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>second</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">One or more seconds within a minute</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code> to <code>59</code>.
For example: <code>second="30"</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>minute</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">One or more minutes within an hour</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code> to <code>59</code>.
For example: <code>minute="15"</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hour</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">One or more hours within a day</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code> to <code>23</code>.
For example: <code>hour="13"</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dayOfWeek</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">One or more days within a week</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>*</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>0</code> to <code>7</code> (both 0 and 7 refer to Sunday).
For example: <code>dayOfWeek="3"</code>.</p>
</div>
<div class="paragraph">
<p><code>Sun</code>, <code>Mon</code>, <code>Tue</code>, <code>Wed</code>, <code>Thu</code>, <code>Fri</code>, <code>Sat</code>.
For example: <code>dayOfWeek="Mon"</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dayOfMonth</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">One or more days within a month</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>*</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>1</code> to <code>31</code>.
For example: <code>dayOfMonth="15"</code>.</p>
</div>
<div class="paragraph">
<p><code>7</code> to <code>1</code> (a negative number means the nth day or days before the end of the month).
For example: <code>dayOfMonth="3"</code>.</p>
</div>
<div class="paragraph">
<p><code>Last</code>.
For example: <code>dayOfMonth="Last"</code>.</p>
</div>
<div class="paragraph">
<p>[<code>1st</code>, <code>2nd</code>, <code>3rd</code>, <code>4th</code>, <code>5th</code>, <code>Last</code>] [<code>Sun</code>, <code>Mon</code>, <code>Tue</code>, <code>Wed</code>, <code>Thu</code>, <code>Fri</code>, <code>Sat</code>].
For example: <code>dayOfMonth="2nd Fri"</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>month</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">One or more months within a year</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>*</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>1</code> to <code>12</code>.
For example: <code>month="7"</code>.</p>
</div>
<div class="paragraph">
<p><code>Jan</code>, <code>Feb</code>, <code>Mar</code>, <code>Apr</code>, <code>May</code>, <code>Jun</code>, <code>Jul</code>, <code>Aug</code>, <code>Sep</code>, <code>Oct</code>, <code>Nov</code>, <code>Dec</code>.
For example: <code>month="July"</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>year</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A particular calendar year</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>*</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A four-digit calendar year.
For example: <code>year="2011"</code>.</p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="specifying-multiple-values-in-calendar-expressions"><a class="anchor" href="#specifying-multiple-values-in-calendar-expressions"></a>Specifying Multiple Values in Calendar Expressions</h5>
<div class="paragraph">
<p>You can specify multiple values in calendar expressions, as described in the following sections.</p>
</div>
<div class="sect5">
<h6 id="using-wildcards-in-calendar-expressions"><a class="anchor" href="#using-wildcards-in-calendar-expressions"></a>Using Wildcards in Calendar Expressions</h6>
<div class="paragraph">
<p>Setting an attribute to an asterisk symbol (<code>*</code>) represents all allowable values for the attribute.</p>
</div>
<div class="paragraph">
<p>The following expression represents every minute:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">minute=<span class="string"><span class="delimiter">&quot;</span><span class="content">*</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following expression represents every day of the week:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">dayOfWeek=<span class="string"><span class="delimiter">&quot;</span><span class="content">*</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="specifying-a-list-of-values"><a class="anchor" href="#specifying-a-list-of-values"></a>Specifying a List of Values</h6>
<div class="paragraph">
<p>To specify two or more values for an attribute, use a comma (<code>,</code>) to separate the values.
A range of values is allowed as part of a list.
Wildcards and intervals, however, are not allowed.</p>
</div>
<div class="paragraph">
<p>Duplicates within a list are ignored.</p>
</div>
<div class="paragraph">
<p>The following expression sets the day of the week to Tuesday and Thursday:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">dayOfWeek=<span class="string"><span class="delimiter">&quot;</span><span class="content">Tue, Thu</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following expression represents 4:00 a.m., every hour from 9:00 a.m. to 5:00 p.m. using a range, and 10:00 p.m.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">hour=<span class="string"><span class="delimiter">&quot;</span><span class="content">4,9-17,22</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="specifying-a-range-of-values"><a class="anchor" href="#specifying-a-range-of-values"></a>Specifying a Range of Values</h6>
<div class="paragraph">
<p>Use a dash character (<code>-</code>) to specify an inclusive range of values for an attribute.
Members of a range cannot be wildcards, lists, or intervals.
A range of the form <code>x-x</code>, is equivalent to the single-valued expression <code>x</code>.
A range of the form <code>x-y</code> where <code>x</code> is greater than <code>y</code> is equivalent to the expression <code>x-<em>maximumvalue</em></code>,<code><em>minimumvalue</em>-y</code>.
That is, the expression begins at <code>x</code>, rolls over to the beginning of the allowable values, and continues up to <code>y</code>.</p>
</div>
<div class="paragraph">
<p>The following expression represents 9:00 a.m. to 5:00 p.m.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">hour=<span class="string"><span class="delimiter">&quot;</span><span class="content">9-17</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following expression represents Friday through Monday:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">dayOfWeek=<span class="string"><span class="delimiter">&quot;</span><span class="content">5-1</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following expression represents the twenty-fifth day of the month to the end of the month, and the beginning of the month to the fifth day of the month:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">dayOfMonth=<span class="string"><span class="delimiter">&quot;</span><span class="content">25-5</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>It is equivalent to the following expression:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">dayOfMonth=<span class="string"><span class="delimiter">&quot;</span><span class="content">25-Last,1-5</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="specifying-intervals"><a class="anchor" href="#specifying-intervals"></a>Specifying Intervals</h6>
<div class="paragraph">
<p>The forward slash (<code>/</code>) constrains an attribute to a starting point and an interval and is used to specify every <code>N</code> seconds, minutes, or hours within the minute, hour, or day.
For an expression of the form <code>x/y</code>, <code>x</code> represents the starting point and <code>y</code> represents the interval.
The wildcard character may be used in the <code>x</code> position of an interval and is equivalent to setting <code>x</code> to <code>0</code>.</p>
</div>
<div class="paragraph">
<p>Intervals may be set only for <code>second</code>, <code>minute</code>, and <code>hour</code> attributes.</p>
</div>
<div class="paragraph">
<p>The following expression represents every 10 minutes within the hour:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">minute=<span class="string"><span class="delimiter">&quot;</span><span class="content">*/10</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>It is equivalent to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">minute=<span class="string"><span class="delimiter">&quot;</span><span class="content">0,10,20,30,40,50</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following expression represents every 2 hours starting at noon:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">hour=<span class="string"><span class="delimiter">&quot;</span><span class="content">12/2</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="programmatic-timers"><a class="anchor" href="#programmatic-timers"></a>Programmatic Timers</h4>
<div class="paragraph">
<p>When a programmatic timer expires (goes off), the container calls the method annotated <code>@Timeout</code> in the bean&#8217;s implementation class.
The <code>@Timeout</code> method contains the business logic that handles the timed event.</p>
</div>
<div class="sect4">
<h5 id="the-timeout-method"><a class="anchor" href="#the-timeout-method"></a>The @Timeout Method</h5>
<div class="paragraph">
<p>Methods annotated <code>@Timeout</code> in the enterprise bean class must return <code>void</code> and optionally take a <code>jakarta.ejb.Timer</code> object as the only parameter.
They may not throw application exceptions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Timeout</span>
<span class="directive">public</span> <span class="type">void</span> timeout(<span class="predefined-type">Timer</span> timer) {
    <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">TimerBean: timeout occurred</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="creating-programmatic-timers"><a class="anchor" href="#creating-programmatic-timers"></a>Creating Programmatic Timers</h5>
<div class="paragraph">
<p>To create a timer, the bean invokes one of the <code>create</code> methods of the <code>TimerService</code> interface.
These methods allow single-action, interval, or calendar-based timers to be created.</p>
</div>
<div class="paragraph">
<p>For single-action or interval timers, the expiration of the timer can be expressed as either a duration or an absolute time.
The duration is expressed as a the number of milliseconds before a timeout event is triggered.
To specify an absolute time, create a <code>java.util.Date</code> object and pass it to the <code>TimerService.createSingleActionTimer</code> or the <code>TimerService.createTimer</code> method.</p>
</div>
<div class="paragraph">
<p>The following code sets a programmatic timer that will expire in 1 minute (60,000 milliseconds):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">long</span> duration = <span class="integer">60000</span>;
<span class="predefined-type">Timer</span> timer =
    timerService.createSingleActionTimer(duration, <span class="keyword">new</span> TimerConfig());</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following code sets a programmatic timer that will expire at 12:05 p.m. on May 1, 2015, specified as a <code>java.util.Date</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">SimpleDateFormatter formatter =
    <span class="keyword">new</span> SimpleDateFormatter(<span class="string"><span class="delimiter">&quot;</span><span class="content">MM/dd/yyyy 'at' HH:mm</span><span class="delimiter">&quot;</span></span>);
<span class="predefined-type">Date</span> date = formatter.parse(<span class="string"><span class="delimiter">&quot;</span><span class="content">05/01/2015 at 12:05</span><span class="delimiter">&quot;</span></span>);
<span class="predefined-type">Timer</span> timer = timerService.createSingleActionTimer(date, <span class="keyword">new</span> TimerConfig());</code></pre>
</div>
</div>
<div class="paragraph">
<p>For calendar-based timers, the expiration of the timer is expressed as a <code>jakarta.ejb.ScheduleExpression</code> object, passed as a parameter to the <code>TimerService.createCalendarTimer</code> method.
The <code>ScheduleExpression</code> class represents calendar-based timer expressions and has methods that correspond to the attributes described in <a href="#creating-calendar-based-timer-expressions">Creating Calendar-Based Timer Expressions</a>.</p>
</div>
<div class="paragraph">
<p>The following code creates a programmatic timer using the <code>ScheduleExpression</code> helper class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ScheduleExpression schedule = <span class="keyword">new</span> ScheduleExpression();
schedule.dayOfWeek(<span class="string"><span class="delimiter">&quot;</span><span class="content">Mon</span><span class="delimiter">&quot;</span></span>);
schedule.hour(<span class="string"><span class="delimiter">&quot;</span><span class="content">12-17, 23</span><span class="delimiter">&quot;</span></span>);
<span class="predefined-type">Timer</span> timer = timerService.createCalendarTimer(schedule);</code></pre>
</div>
</div>
<div class="paragraph">
<p>For details on the method signatures, see the <code>TimerService</code> API documentation at <a href="https://jakarta.ee/specifications/platform/9/apidocs/jakarta/ejb/TimerService.html" class="bare" target="_blank" rel="noopener">https://jakarta.ee/specifications/platform/9/apidocs/jakarta/ejb/TimerService.html</a>.</p>
</div>
<div class="paragraph">
<p>The bean described in <a href="#the-timersession-example">The timersession Example</a> creates a timer as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Timer</span> timer = timerService.createTimer(intervalDuration,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">Created new programmatic timer</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the <code>timersession</code> example, the method that calls <code>createTimer</code> is invoked in a business method, which is called by a client.</p>
</div>
<div class="paragraph">
<p>Timers are persistent by default.
If the server is shut down or crashes, persistent timers are saved and will become active again when the server is restarted.
If a persistent timer expires while the server is down, the container will call the <code>@Timeout</code> method when the server is restarted.</p>
</div>
<div class="paragraph">
<p>Nonpersistent programmatic timers are created by calling <code>TimerConfig.setPersistent(false)</code> and passing the <code>TimerConfig</code> object to one of the timer-creation methods.</p>
</div>
<div class="paragraph">
<p>The <code>Date</code> and <code>long</code> parameters of the <code>createTimer</code> methods represent time with the resolution of milliseconds.
However, because the timer service is not intended for real-time applications, a callback to the <code>@Timeout</code> method might not occur with millisecond precision.
The timer service is for business applications, which typically measure time in hours, days, or longer durations.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="automatic-timers"><a class="anchor" href="#automatic-timers"></a>Automatic Timers</h4>
<div class="paragraph">
<p>Automatic timers are created by the Enterprise Bean container when an enterprise bean that contains methods annotated with the <code>@Schedule</code> or <code>@Schedules</code> annotations is deployed.
An enterprise bean can have multiple automatic timeout methods, unlike a programmatic timer, which allows only one method annotated with the <code>@Timeout</code> annotation in the enterprise bean class.</p>
</div>
<div class="paragraph">
<p>Automatic timers can be configured through annotations or through the <code>ejb-jar.xml</code> deployment descriptor.</p>
</div>
<div class="paragraph">
<p>Adding a <code>@Schedule</code> annotation on an enterprise bean marks that method as a timeout method according to the calendar schedule specified in the attributes of <code>@Schedule</code>.</p>
</div>
<div class="paragraph">
<p>The <code>@Schedule</code> annotation has elements that correspond to the calendar expressions detailed in <a href="#creating-calendar-based-timer-expressions">Creating Calendar-Based Timer Expressions</a> and the <code>persistent</code>, <code>info</code>, and <code>timezone</code> elements.</p>
</div>
<div class="paragraph">
<p>The optional <code>persistent</code> element takes a Boolean value and is used to specify whether the automatic timer should survive a server restart or crash.
By default, all automatic timers are persistent.</p>
</div>
<div class="paragraph">
<p>The optional <code>timezone</code> element is used to specify that the automatic timer is associated with a particular time zone.
If set, this element will evaluate all timer expressions in relation to the specified time zone, regardless of the time zone in which the Enterprise Bean container is running.
By default, all automatic timers set are in relation to the default time zone of the server.</p>
</div>
<div class="paragraph">
<p>The optional <code>info</code> element is used to set an informational description of the timer.
A timer&#8217;s information can be retrieved later by using <code>Timer.getInfo</code>.</p>
</div>
<div class="paragraph">
<p>The following timeout method uses <code>@Schedule</code> to set a timer that will expire every Sunday at midnight:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Schedule</span>(dayOfWeek=<span class="string"><span class="delimiter">&quot;</span><span class="content">Sun</span><span class="delimiter">&quot;</span></span>, hour=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">void</span> cleanupWeekData() { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>@Schedules</code> annotation is used to specify multiple calendar-based timer expressions for a given timeout method.</p>
</div>
<div class="paragraph">
<p>The following timeout method uses the <code>@Schedules</code> annotation to set multiple calendar-based timer expressions.
The first expression sets a timer to expire on the last day of every month.
The second expression sets a timer to expire every Friday at 11:00 p.m.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Schedules</span> ({
    <span class="annotation">@Schedule</span>(dayOfMonth=<span class="string"><span class="delimiter">&quot;</span><span class="content">Last</span><span class="delimiter">&quot;</span></span>),
    <span class="annotation">@Schedule</span>(dayOfWeek=<span class="string"><span class="delimiter">&quot;</span><span class="content">Fri</span><span class="delimiter">&quot;</span></span>, hour=<span class="string"><span class="delimiter">&quot;</span><span class="content">23</span><span class="delimiter">&quot;</span></span>)
})
<span class="directive">public</span> <span class="type">void</span> doPeriodicCleanup() { ... }</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="canceling-and-saving-timers"><a class="anchor" href="#canceling-and-saving-timers"></a>Canceling and Saving Timers</h4>
<div class="paragraph">
<p>Timers can be cancelled by the following events.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When a single-event timer expires, the Enterprise Bean container calls the associated timeout method and then cancels the timer.</p>
</li>
<li>
<p>When the bean invokes the <code>cancel</code> method of the <code>Timer</code> interface, the container cancels the timer.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If a method is invoked on a cancelled timer, the container throws the <code>jakarta.ejb.NoSuchObjectLocalException</code>.</p>
</div>
<div class="paragraph">
<p>To save a <code>Timer</code> object for future reference, invoke its <code>getHandle</code> method and store the <code>TimerHandle</code> object in a database.
(A <code>TimerHandle</code> object is serializable.)
To reinstantiate the <code>Timer</code> object, retrieve the handle from the database and invoke <code>getTimer</code> on the handle.
A <code>TimerHandle</code> object cannot be passed as an argument of a method defined in a remote or web service interface.
In other words, remote clients and web service clients cannot access a bean&#8217;s <code>TimerHandle</code> object.
Local clients, however, do not have this restriction.</p>
</div>
</div>
<div class="sect3">
<h4 id="getting-timer-information"><a class="anchor" href="#getting-timer-information"></a>Getting Timer Information</h4>
<div class="paragraph">
<p>In addition to defining the <code>cancel</code> and <code>getHandle</code> methods, the <code>Timer</code> interface defines methods for obtaining information about timers:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">long</span> getTimeRemaining();
<span class="directive">public</span> java.util.Date getNextTimeout();
<span class="directive">public</span> java.io.Serializable getInfo();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>getInfo</code> method returns the object that was the last parameter of the <code>createTimer</code> invocation.
For example, in the <code>createTimer</code> code snippet of the preceding section, this information parameter is a <code>String</code> object with the value <code>created timer</code>.</p>
</div>
<div class="paragraph">
<p>To retrieve all of a bean&#8217;s active timers, call the <code>getTimers</code> method of the <code>TimerService</code> interface.
The <code>getTimers</code> method returns a collection of <code>Timer</code> objects.</p>
</div>
</div>
<div class="sect3">
<h4 id="transactions-and-timers"><a class="anchor" href="#transactions-and-timers"></a>Transactions and Timers</h4>
<div class="paragraph">
<p>An enterprise bean usually creates a timer within a transaction.
If this transaction is rolled back, the timer creation also is rolled back.
Similarly, if a bean cancels a timer within a transaction that gets rolled back, the timer cancellation is rolled back.
In this case, the timer&#8217;s duration is reset as if the cancellation had never occurred.</p>
</div>
<div class="paragraph">
<p>In beans that use container-managed transactions, the <code>@Timeout</code> method usually has the <code>Required</code> or <code>RequiresNew</code> transaction attribute to preserve transaction integrity.
With these attributes, the Enterprise Bean container begins the new transaction before calling the <code>@Timeout</code> method.
If the transaction is rolled back, the container will call the <code>@Timeout</code> method at least one more time.</p>
</div>
</div>
<div class="sect3">
<h4 id="the-timersession-example"><a class="anchor" href="#the-timersession-example"></a>The timersession Example</h4>
<div class="paragraph">
<p>The source code for this example is in the <code><em>tut-install</em>/examples/ejb/timersession/src/main/java/</code> directory.</p>
</div>
<div class="paragraph">
<p><code>TimerSessionBean</code> is a singleton session bean that shows how to set both an automatic timer and a programmatic timer.
In the source code listing of <code>TimerSessionBean</code> that follows, the <code>setTimer</code> and <code>@Timeout</code> methods are used to set a programmatic timer.
A <code>TimerService</code> instance is injected by the container when the bean is created.
Because it&#8217;s a business method, <code>setTimer</code> is exposed to the local, no-interface view of <code>TimerSessionBean</code> and can be invoked by the client.
In this example, the client invokes <code>setTimer</code> with an interval duration of 8,000 milliseconds, or 8 seconds.
The <code>setTimer</code> method creates a new timer by invoking the <code>createTimer</code> method of <code>TimerService</code>.
Now that the timer is set, the Enterprise Bean container will invoke the <code>programmaticTimeout</code> method of <code>TimerSessionBean</code> when the timer expires, in about 8 seconds:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">...
    public <span class="type">void</span> setTimer(<span class="type">long</span> intervalDuration) {
        logger.log(<span class="predefined-type">Level</span>.INFO,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">Setting a programmatic timeout for {0} milliseconds from now.</span><span class="delimiter">&quot;</span></span>,
                intervalDuration);
        <span class="predefined-type">Timer</span> timer = timerService.createTimer(intervalDuration,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">Created new programmatic timer</span><span class="delimiter">&quot;</span></span>);
    }

    <span class="annotation">@Timeout</span>
    <span class="directive">public</span> <span class="type">void</span> programmaticTimeout(<span class="predefined-type">Timer</span> timer) {
        <span class="local-variable">this</span>.setLastProgrammaticTimeout(<span class="keyword">new</span> <span class="predefined-type">Date</span>());
        logger.info(<span class="string"><span class="delimiter">&quot;</span><span class="content">Programmatic timeout occurred.</span><span class="delimiter">&quot;</span></span>);
    }
...</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>TimerSessionBean</code> also has an automatic timer and timeout method, <code>automaticTimeout</code>.
The automatic timer is set to expire every 1 minute and is set by using a calendar-based timer expression in the <code>@Schedule</code> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">...
    <span class="annotation">@Schedule</span>(minute = <span class="string"><span class="delimiter">&quot;</span><span class="content">*/1</span><span class="delimiter">&quot;</span></span>, hour = <span class="string"><span class="delimiter">&quot;</span><span class="content">*</span><span class="delimiter">&quot;</span></span>, persistent = <span class="predefined-constant">false</span>)
    <span class="directive">public</span> <span class="type">void</span> automaticTimeout() {
        <span class="local-variable">this</span>.setLastAutomaticTimeout(<span class="keyword">new</span> <span class="predefined-type">Date</span>());
        logger.info(<span class="string"><span class="delimiter">&quot;</span><span class="content">Automatic timeout occured</span><span class="delimiter">&quot;</span></span>);
    }
...</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>TimerSessionBean</code> also has two business methods: <code>getLastProgrammaticTimeout</code> and <code>getLastAutomaticTimeout</code>.
Clients call these methods to get the date and time of the last timeout for the programmatic timer and automatic timer, respectively.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s the source code for the <code>TimerSessionBean</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">ee.jakarta.tutorial.timersession.ejb</span>;

<span class="keyword">import</span> <span class="include">java.util.Date</span>;
<span class="keyword">import</span> <span class="include">java.util.logging.Level</span>;
<span class="keyword">import</span> <span class="include">java.util.logging.Logger</span>;
<span class="keyword">import</span> <span class="include">jakarta.annotation.Resource</span>;
<span class="keyword">import</span> <span class="include">jakarta.ejb.Schedule</span>;
<span class="keyword">import</span> <span class="include">jakarta.ejb.Singleton</span>;
<span class="keyword">import</span> <span class="include">jakarta.ejb.Startup</span>;
<span class="keyword">import</span> <span class="include">jakarta.ejb.Timeout</span>;
<span class="keyword">import</span> <span class="include">jakarta.ejb.Timer</span>;
<span class="keyword">import</span> <span class="include">jakarta.ejb.TimerService</span>;

<span class="annotation">@Singleton</span>
<span class="annotation">@Startup</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">TimerSessionBean</span> {
    <span class="annotation">@Resource</span>
    TimerService timerService;

    <span class="directive">private</span> <span class="predefined-type">Date</span> lastProgrammaticTimeout;
    <span class="directive">private</span> <span class="predefined-type">Date</span> lastAutomaticTimeout;

    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">Logger</span> logger =
            <span class="predefined-type">Logger</span>.getLogger(<span class="string"><span class="delimiter">&quot;</span><span class="content">timersession.ejb.TimerSessionBean</span><span class="delimiter">&quot;</span></span>);

    <span class="directive">public</span> <span class="type">void</span> setTimer(<span class="type">long</span> intervalDuration) {
        logger.log(<span class="predefined-type">Level</span>.INFO,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">Setting a programmatic timeout for {0} milliseconds from now.</span><span class="delimiter">&quot;</span></span>,
                intervalDuration);
        <span class="predefined-type">Timer</span> timer = timerService.createTimer(intervalDuration,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">Created new programmatic timer</span><span class="delimiter">&quot;</span></span>);
    }

    <span class="annotation">@Timeout</span>
    <span class="directive">public</span> <span class="type">void</span> programmaticTimeout(<span class="predefined-type">Timer</span> timer) {
        <span class="local-variable">this</span>.setLastProgrammaticTimeout(<span class="keyword">new</span> <span class="predefined-type">Date</span>());
        logger.info(<span class="string"><span class="delimiter">&quot;</span><span class="content">Programmatic timeout occurred.</span><span class="delimiter">&quot;</span></span>);
    }

    <span class="annotation">@Schedule</span>(minute = <span class="string"><span class="delimiter">&quot;</span><span class="content">*/1</span><span class="delimiter">&quot;</span></span>, hour = <span class="string"><span class="delimiter">&quot;</span><span class="content">*</span><span class="delimiter">&quot;</span></span>, persistent = <span class="predefined-constant">false</span>)
    <span class="directive">public</span> <span class="type">void</span> automaticTimeout() {
        <span class="local-variable">this</span>.setLastAutomaticTimeout(<span class="keyword">new</span> <span class="predefined-type">Date</span>());
        logger.info(<span class="string"><span class="delimiter">&quot;</span><span class="content">Automatic timeout occured</span><span class="delimiter">&quot;</span></span>);
    }

    <span class="directive">public</span> <span class="predefined-type">String</span> getLastProgrammaticTimeout() {
        <span class="keyword">if</span> (lastProgrammaticTimeout != <span class="predefined-constant">null</span>) {
            <span class="keyword">return</span> lastProgrammaticTimeout.toString();
        } <span class="keyword">else</span> {
            <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">never</span><span class="delimiter">&quot;</span></span>;
        }
    }

    <span class="directive">public</span> <span class="type">void</span> setLastProgrammaticTimeout(<span class="predefined-type">Date</span> lastTimeout) {
        <span class="local-variable">this</span>.lastProgrammaticTimeout = lastTimeout;
    }

    <span class="directive">public</span> <span class="predefined-type">String</span> getLastAutomaticTimeout() {
        <span class="keyword">if</span> (lastAutomaticTimeout != <span class="predefined-constant">null</span>) {
            <span class="keyword">return</span> lastAutomaticTimeout.toString();
        } <span class="keyword">else</span> {
            <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">never</span><span class="delimiter">&quot;</span></span>;
        }
    }

    <span class="directive">public</span> <span class="type">void</span> setLastAutomaticTimeout(<span class="predefined-type">Date</span> lastAutomaticTimeout) {
        <span class="local-variable">this</span>.lastAutomaticTimeout = lastAutomaticTimeout;
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>GlassFish Server has a default minimum timeout value of 1,000 milliseconds, or 1 second.
If you need to set the timeout value lower than 1,000 milliseconds, change the value of the Minimum Delivery Interval setting in the Administration Console.</p>
</div>
<div class="paragraph">
<p>To modify the minimum timeout value, in the Administration Console expand Configurations, then expand server-config, select EJB Container, and click the EJB Timer Service tab.
Enter a new timeout value under Minimum Delivery Interval and click Save.</p>
</div>
<div class="paragraph">
<p>The lowest practical value for <code>minimum-delivery-interval-in-millis</code> is around 10 milliseconds, owing to virtual machine constraints.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="running-the-timersession-example"><a class="anchor" href="#running-the-timersession-example"></a>Running the timersession Example</h4>
<div class="paragraph">
<p>You can use either NetBeans IDE or Maven to build, package, deploy, and run the <code>timersession</code> example.</p>
</div>
<div class="sect4">
<h5 id="to-run-the-timersession-example-using-netbeans-ide"><a class="anchor" href="#to-run-the-timersession-example-using-netbeans-ide"></a>To Run the timersession Example Using NetBeans IDE</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>From the <strong>File</strong> menu, choose <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the <strong>Open Project</strong> dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/ejb</pre>
</div>
</div>
</li>
<li>
<p>Select the <code>timersession</code> folder.</p>
</li>
<li>
<p>Click <strong>Open Project</strong>.</p>
</li>
<li>
<p>From the <strong>Run</strong> menu, choose <strong>Run Project</strong>.</p>
<div class="paragraph">
<p>This builds and packages the application into a WAR file located at <code><em>tut-install</em>/examples/ejb/timersession/target/timersession.war</code>, deploys this WAR file to your GlassFish Server instance, and then runs the web client.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-build-package-and-deploy-the-timersession-example-using-maven"><a class="anchor" href="#to-build-package-and-deploy-the-timersession-example-using-maven"></a>To Build, Package, and Deploy the timersession Example Using Maven</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>In a terminal window, go to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/ejb/timersession/</pre>
</div>
</div>
</li>
<li>
<p>Enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">mvn install</code></pre>
</div>
</div>
<div class="paragraph">
<p>This builds and packages the application into a WAR file located at <code><em>tut-install</em>/examples/ejb/timersession/target/timersession.war</code> and deploys this WAR file to your GlassFish Server instance.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-run-the-web-client"><a class="anchor" href="#to-run-the-web-client"></a>To Run the Web Client</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open a web browser to the following URL:</p>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080/timersession</pre>
</div>
</div>
</li>
<li>
<p>Click Set Timer to set a programmatic timer.</p>
</li>
<li>
<p>Wait for a while and click the browser&#8217;s Refresh button.</p>
<div class="paragraph">
<p>You will see the date and time of the last programmatic and automatic timeouts.</p>
</div>
<div class="paragraph">
<p>To see the messages that are logged when a timeout occurs, open the <code>server.log</code> file located in <code><em>domain-dir</em>/logs/</code>.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="handling-exceptions"><a class="anchor" href="#handling-exceptions"></a>Handling Exceptions</h3>
<div class="paragraph">
<p>The exceptions thrown by enterprise beans fall into two categories: system and application.</p>
</div>
<div class="paragraph">
<p>A system exception indicates a problem with the services that support an application.
For example, a connection to an external resource cannot be obtained, or an injected resource cannot be found.
If it encounters a system-level problem, your enterprise bean should throw a <code>jakarta.ejb.EJBException</code>.
Because the <code>EJBException</code> is a subclass of <code>RuntimeException</code>, you do not have to specify it in the <code>throws</code> clause of the method declaration.
If a system exception is thrown, the Jakarta Enterprise Beans container might destroy the bean instance.
Therefore, a system exception cannot be handled by the bean&#8217;s client program, but instead requires intervention by a system administrator.</p>
</div>
<div class="paragraph">
<p>An application exception signals an error in the business logic of an enterprise bean.
Application exceptions are typically exceptions that you&#8217;ve coded yourself, such as the <code>BookException</code> thrown by the business methods of the <code>CartBean</code> example.
When an enterprise bean throws an application exception, the container does not wrap it in another exception.
The client should be able to handle any application exception it receives.</p>
</div>
<div class="paragraph">
<p>If a system exception occurs within a transaction, the Enterprise Bean container rolls back the transaction.
However, if an application exception is thrown within a transaction, the container does not roll back the transaction.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using-the-embedded-enterprise-bean-container"><a class="anchor" href="#using-the-embedded-enterprise-bean-container"></a>Chapter 38. Using the Embedded Enterprise Bean Container</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter demonstrates how to use the embedded enterprise bean container to run enterprise bean applications in the Java SE environment, outside of a Jakarta EE server.</p>
</div>
<div class="sect2">
<h3 id="overview-of-the-embedded-enterprise-bean-container"><a class="anchor" href="#overview-of-the-embedded-enterprise-bean-container"></a>Overview of the Embedded Enterprise Bean Container</h3>
<div class="paragraph">
<p>The embedded enterprise bean container is used to access enterprise bean components from client code executed in a Java SE environment.
The container and the client code are executed within the same virtual machine.
The embedded enterprise bean container is typically used for testing enterprise beans without having to deploy them to a server.</p>
</div>
<div class="paragraph">
<p>Most of the services present in the enterprise bean container in a Jakarta EE server are available in the embedded enterprise bean container, including injection, container-managed transactions, and security.
Enterprise bean components execute similarly in both embedded and Jakakarta EE environments, and therefore the same enterprise bean can be easily reused in both standalone and networked applications.</p>
</div>
</div>
<div class="sect2">
<h3 id="developing-embeddable-enterprise-bean-applications"><a class="anchor" href="#developing-embeddable-enterprise-bean-applications"></a>Developing Embeddable Enterprise Bean Applications</h3>
<div class="paragraph">
<p>All embeddable enterprise bean containers support the features listed in <a href="#required-enterprise-bean-features-in-the-embeddable-container">Table 38-1</a>.</p>
</div>
<table id="required-enterprise-bean-features-in-the-embeddable-container" class="tableblock frame-all grid-all" style="width: 50%;">
<caption class="title">Table 38-1 Required Enterprise Bean Features in the Embeddable Container</caption>
<colgroup>
<col style="width: 37.5%;">
<col style="width: 62.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Enterprise Bean Feature</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Local session beans</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Local and no-interface view stateless, stateful, and singleton session beans.
All method access is synchronous.
Session beans must not be web service endpoints.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transactions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Container-managed and bean-managed transactions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Security</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Declarative and programmatic security.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interceptors</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Class-level and method-level interceptors for session beans.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Deployment descriptor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The optional <code>ejb-jar.xml</code> deployment descriptor, with the same overriding rules for the enterprise bean container in Jakarta EE servers.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Container providers are allowed to support the full set of features in enterprise beans, but applications that use the embedded container will not be portable if they use enterprise bean features not listed in <a href="#required-enterprise-bean-features-in-the-embeddable-container">Table 38-1</a>, such as the timer service, session beans as web service endpoints, or remote business interfaces.</p>
</div>
<div class="sect3">
<h4 id="running-embedded-applications"><a class="anchor" href="#running-embedded-applications"></a>Running Embedded Applications</h4>
<div class="paragraph">
<p>The embedded container, the enterprise bean components, and the client all are executed in the same virtual machine using the same classpath. As a result, developers can run an application that uses the embedded container just like a typical Java SE application, as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">java -classpath mySessionBean.jar:containerProviderRuntime.jar:myClient.jar \
com.example.ejb.client.Main</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example, <code>mySessionBean.jar</code> is an enterprise bean JAR containing a local stateless session bean, <code>containerProviderRuntime.jar</code> is a JAR file supplied by the enterprise bean provider that contains the needed runtime classes for the embedded container, and <code>myClient.jar</code> is a JAR file containing a Java SE application that calls the business methods in the session bean through the embedded container.</p>
</div>
<div class="paragraph">
<p>In GlassFish Server, the runtime JAR that includes the classes for the embedded container is <code>glassfish-embedded-all.jar</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="creating-the-enterprise-bean-container"><a class="anchor" href="#creating-the-enterprise-bean-container"></a>Creating the Enterprise Bean Container</h4>
<div class="paragraph">
<p>The <code>jakarta.ejb.embedded.EJBContainer</code> abstract class represents an instance of the enterprise bean container and includes factory methods for creating a container instance.
The <code>EJBContainer.createEJBContainer</code> method is used to create and initialize an embedded container instance.</p>
</div>
<div class="paragraph">
<p>The following code snippet shows how to create an embedded container that is initialized with the container provider&#8217;s default settings:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">EJBContainer ec = EJBContainer.createEJBContainer();</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, the embedded container will search the virtual machine classpath for enterprise bean modules: directories containing a <code>META-INF/ejb-jar.xml</code> deployment descriptor, directories containing a class file with one of the enterprise bean component annotations (such as <code>@Stateless</code>), or JAR files containing an <code>ejb-jar.xml</code> deployment descriptor or class file with an enterprise bean annotation.
Any matching entries are considered enterprise bean modules within the same application.
Once all the valid enterprise bean modules have been found in the classpath, the container will begin initializing the modules.
When the <code>createEJBContainer</code> method successfully returns, the client application can obtain references to the client view of any enterprise bean module found by the embedded container.</p>
</div>
<div class="paragraph">
<p>An alternate version of the <code>EJBContainer.createEJBContainer</code> method takes a <code>Map</code> of properties and settings for customizing the embeddable container instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Properties</span> props = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();
props.setProperty(...);
...
EJBContainer ec = EJBContainer.createEJBContainer(props);</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="explicitly-specifying-enterprise-bean-modules-to-be-initialized"><a class="anchor" href="#explicitly-specifying-enterprise-bean-modules-to-be-initialized"></a>Explicitly Specifying Enterprise Bean Modules to Be Initialized</h5>
<div class="paragraph">
<p>Developers can specify exactly which enterprise bean modules the embedded container will initialize.
To explicitly specify the enterprise bean modules initialized by the embedded container, set the <code>EJBContainer.MODULES</code> property.</p>
</div>
<div class="paragraph">
<p>The modules may be located either in the virtual machine classpath in which the embedded container and client code run, or alternately outside the virtual machine classpath.</p>
</div>
<div class="paragraph">
<p>To specify modules in the virtual machine classpath, set <code>EJBContainer.MODULES</code> to a <code>String</code> to specify a single module name, or a <code>String</code> array containing the module names.
The embedded container searches the virtual machine classpath for enterprise bean modules matching the specified names:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Properties</span> props = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();
props.setProperty(EJBContainer.MODULES, <span class="string"><span class="delimiter">&quot;</span><span class="content">mySessionBean</span><span class="delimiter">&quot;</span></span>);
EJBContainer ec = EJBContainer.createEJBContainer(props);</code></pre>
</div>
</div>
<div class="paragraph">
<p>To specify enterprise bean modules outside the virtual machine classpath, set <code>EJBContainer.MODULES</code> to a <code>java.io.File</code> object or an array of <code>File</code> objects.
Each <code>File</code> object refers to an enterprise bean JAR file, or a directory containing an expanded enterprise bean JAR file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Properties</span> props = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();
<span class="predefined-type">File</span> ejbJarFile = <span class="keyword">new</span> <span class="predefined-type">File</span>(...);
props.setProperty(EJBContainer.MODULES, ejbJarFile);
EJBContainer ec = EJBContainer.createEJBContainer(props);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="looking-up-session-bean-references"><a class="anchor" href="#looking-up-session-bean-references"></a>Looking Up Session Bean References</h4>
<div class="paragraph">
<p>To look up session bean references in an application using the embedded container:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Use an instance of <code>EJBContainer</code> to retrieve a <code>javax.naming.Context</code> object.</p>
<div class="paragraph">
<p>Call the <code>EJBContainer.getContext</code> method to retrieve the <code>Context</code> object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">EJBContainer ec = EJBContainer.createEJBContainer();
<span class="predefined-type">Context</span> ctx = ec.getContext();</code></pre>
</div>
</div>
<div class="paragraph">
<p>References to session beans can then be obtained using the portable JNDI syntax detailed in <a href="#portable-jndi-syntax">Portable JNDI Syntax</a>.
For example, to obtain a reference to <code>MySessionBean</code>, a local session bean with a no-interface view, use the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">MySessionBean msb = (MySessionBean)
            ctx.lookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">java:global/mySessionBean/MySessionBean</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="shutting-down-the-enterprise-bean-container"><a class="anchor" href="#shutting-down-the-enterprise-bean-container"></a>Shutting Down the Enterprise Bean Container</h4>
<div class="paragraph">
<p>To shut down the embedded container:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>From the client, call the <code>close</code> method of the instance of <code>EJBContainer</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">EJBContainer ec = EJBContainer.createEJBContainer();
...
ec.close();</code></pre>
</div>
</div>
<div class="paragraph">
<p>While clients are not required to shut down <code>EJBContainer</code> instances, doing so frees resources consumed by the embedded container.
This is particularly important when the virtual machine under which the client application is running has a longer lifetime than the client application.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="the-standalone-example-application"><a class="anchor" href="#the-standalone-example-application"></a>The standalone Example Application</h3>
<div class="paragraph">
<p>The <code>standalone</code> example application demonstrates how to create an instance of the embedded enterprise bean container in a JUnit test class and call a session bean business method.</p>
</div>
<div class="sect3">
<h4 id="overview-of-the-standalone-example-application"><a class="anchor" href="#overview-of-the-standalone-example-application"></a>Overview of the standalone Example Application</h4>
<div class="paragraph">
<p>Testing the business methods of an enterprise bean in a unit test allows developers to exercise the business logic of an application separately from the other application layers, such as the presentation layer, and without having to deploy the application to a Jakarta EE server.</p>
</div>
<div class="paragraph">
<p>The <code>standalone</code> example has two main components: <code>StandaloneBean</code>, a stateless session bean, and <code>StandaloneBeanTest</code>, a JUnit test class that acts as a client to <code>StandaloneBean</code> using the embedded container.</p>
</div>
<div class="paragraph">
<p><code>StandaloneBean</code> is a simple session bean exposing a local, no-interface view with a single business method, <code>returnMessage</code>, which returns "Greetings!" as a <code>String</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Stateless</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">StandaloneBean</span> {

    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> message = <span class="string"><span class="delimiter">&quot;</span><span class="content">Greetings!</span><span class="delimiter">&quot;</span></span>;

    <span class="directive">public</span> <span class="predefined-type">String</span> returnMessage() {
        <span class="keyword">return</span> message;
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>StandaloneBeanTest</code> calls <code>StandaloneBean.returnMessage</code> and tests that the returned message is correct.
First, an embedded container instance and initial context are created within the <code>setUp</code> method, which is annotated with <code>org.junit.Before</code> to indicate that the method should be executed before the test methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Before</span>
<span class="directive">public</span> <span class="type">void</span> setUp() {
    ec = EJBContainer.createEJBContainer();
    ctx = ec.getContext();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>testReturnMessage</code> method, annotated with <code>org.junit.Test</code> to indicate that the method includes a unit test, obtains a reference to <code>StandaloneBean</code> through the <code>Context</code> instance, and calls <code>StandaloneBean.returnMessage</code>.
The result is compared with the expected result using a JUnit assertion, <code>assertEquals</code>.
If the string returned from <code>StandaloneBean.returnMessage</code> is equal to "Greetings!" the test passes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Test</span>
<span class="directive">public</span> <span class="type">void</span> testReturnMessage() <span class="directive">throws</span> <span class="exception">Exception</span> {
    logger.info(<span class="string"><span class="delimiter">&quot;</span><span class="content">Testing standalone.ejb.StandaloneBean.returnMessage()</span><span class="delimiter">&quot;</span></span>);
    StandaloneBean instance = (StandaloneBean)
            ctx.lookup(<span class="string"><span class="delimiter">&quot;</span><span class="content">java:global/classes/StandaloneBean</span><span class="delimiter">&quot;</span></span>);
    <span class="predefined-type">String</span> expResult = <span class="string"><span class="delimiter">&quot;</span><span class="content">Greetings!</span><span class="delimiter">&quot;</span></span>;
    <span class="predefined-type">String</span> result = instance.returnMessage();
    assertEquals(expResult, result);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, the <code>tearDown</code> method, annotated with <code>org.junit.After</code> to indicate that the method should be executed after all the unit tests have run, closes the embedded container instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@After</span>
<span class="directive">public</span> <span class="type">void</span> tearDown() {
    <span class="keyword">if</span> (ec != <span class="predefined-constant">null</span>) {
        ec.close();
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="to-run-the-standalone-example-application-using-netbeans-ide"><a class="anchor" href="#to-run-the-standalone-example-application-using-netbeans-ide"></a>To Run the standalone Example Application Using NetBeans IDE</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>From the <strong>File</strong> menu, choose <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the <strong>Open Project</strong> dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/ejb</pre>
</div>
</div>
</li>
<li>
<p>Select the <code>standalone</code> folder and click <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the <strong>Projects</strong> tab, right-click <code>standalone</code> and select <strong>Test</strong>.</p>
<div class="paragraph">
<p>This will execute the JUnit test class <code>StandaloneBeanTest</code>.
The Output tab shows the progress of the test and the output log.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="to-run-the-standalone-example-application-using-maven"><a class="anchor" href="#to-run-the-standalone-example-application-using-maven"></a>To Run the standalone Example Application Using Maven</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In a terminal window, go to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/ejb/standalone/</pre>
</div>
</div>
</li>
<li>
<p>Enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">mvn install</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command compiles and packages the application into an JAR file, and executes the JUnit test class <code>StandaloneBeanTest</code>.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using-asynchronous-method-invocation-in-session-beans"><a class="anchor" href="#using-asynchronous-method-invocation-in-session-beans"></a>Chapter 39. Using Asynchronous Method Invocation in Session Beans</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter discusses how to implement asynchronous business methods in session beans and call them from enterprise bean clients.</p>
</div>
<div class="sect2">
<h3 id="asynchronous-method-invocation"><a class="anchor" href="#asynchronous-method-invocation"></a>Asynchronous Method Invocation</h3>
<div class="paragraph">
<p>Session beans can implement asynchronous methods, business methods where control is returned to the client by the enterprise bean container before the method is invoked on the session bean instance.
Clients may then use the Java SE concurrency API to retrieve the result, cancel the invocation, and check for exceptions.
Asynchronous methods are typically used for long-running operations, for processor-intensive tasks, for background tasks, to increase application throughput, or to improve application response time if the method invocation result isn&#8217;t required immediately.</p>
</div>
<div class="paragraph">
<p>When a session bean client invokes a typical non-asynchronous business method, control is not returned to the client until the method has completed.
Clients calling asynchronous methods, however, immediately have control returned to them by the enterprise bean container.
This allows the client to perform other tasks while the method invocation completes.
If the method returns a result, the result is an implementation of the <code>java.util.concurrent.Future&lt;V&gt;</code> interface, where "V" is the result value type.
The <code>Future&lt;V&gt;</code> interface defines methods the client may use to check whether the computation is completed, wait for the invocation to complete, retrieve the final result, and cancel the invocation.</p>
</div>
<div class="sect3">
<h4 id="creating-an-asynchronous-business-method"><a class="anchor" href="#creating-an-asynchronous-business-method"></a>Creating an Asynchronous Business Method</h4>
<div class="paragraph">
<p>Annotate a business method with <code>jakarta.ejb.Asynchronous</code> to mark that method as an asynchronous method, or apply <code>@Asynchronous</code> at the class level to mark all the business methods of the session bean as asynchronous methods.
Session bean methods that expose web services can&#8217;t be asynchronous.</p>
</div>
<div class="paragraph">
<p>Asynchronous methods must return either <code>void</code> or an implementation of the <code>Future&lt;V&gt;</code> interface.
Asynchronous methods that return <code>void</code> can&#8217;t declare application exceptions, but if they return <code>Future&lt;V&gt;</code>, they may declare application exceptions.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Asynchronous</span>
<span class="directive">public</span> <span class="predefined-type">Future</span>&lt;<span class="predefined-type">String</span>&gt; processPayment(Order order) <span class="directive">throws</span> PaymentException { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>This method will attempt to process the payment of an order, and return the status as a <code>String</code>.
Even if the payment processor takes a long time, the client can continue working, and display the result when the processing finally completes.</p>
</div>
<div class="paragraph">
<p>The <code>jakarta.ejb.AsyncResult&lt;V&gt;</code> class is a concrete implementation of the <code>Future&lt;V&gt;</code> interface provided as a helper class for returning asynchronous results.
<code>AsyncResult</code> has a constructor with the result as a parameter, making it easy to create <code>Future&lt;V&gt;</code> implementations.
For example, the <code>processPayment</code> method would use <code>AsyncResult</code> to return the status as a <code>String</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Asynchronous</span>
<span class="directive">public</span> <span class="predefined-type">Future</span>&lt;<span class="predefined-type">String</span>&gt; processPayment(Order order) <span class="directive">throws</span> PaymentException {
    ...
    String status = ...;
    <span class="keyword">return</span> <span class="keyword">new</span> AsyncResult&lt;<span class="predefined-type">String</span>&gt;(status);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The result is returned to the enterprise bean container, not directly to the client, and the enterprise bean container makes the result available to the client.
The session bean can check whether the client requested that the invocation be cancelled by calling the <code>jakarta.ejb.SessionContext.wasCancelled</code> method.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Asynchronous</span>
<span class="directive">public</span> <span class="predefined-type">Future</span>&lt;<span class="predefined-type">String</span>&gt; processPayment(Order order) <span class="directive">throws</span> PaymentException {
    ...
    if (SessionContext.wasCancelled()) {
        <span class="comment">// clean up</span>
    } <span class="keyword">else</span> {
        <span class="comment">// process the payment</span>
    }
    ...
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="calling-asynchronous-methods-from-enterprise-bean-clients"><a class="anchor" href="#calling-asynchronous-methods-from-enterprise-bean-clients"></a>Calling Asynchronous Methods from Enterprise Bean Clients</h4>
<div class="paragraph">
<p>Session bean clients call asynchronous methods just like non-asynchronous business methods.
If the asynchronous method returns a result, the client receives a <code>Future&lt;V&gt;</code> instance as soon as the method is invoked.
This instance can be used to retrieve the final result, cancel the invocation, check whether the invocation has completed, check whether any exceptions were thrown during processing, and check whether the invocation was cancelled.</p>
</div>
<div class="sect4">
<h5 id="retrieving-the-final-result-from-an-asynchronous-method-invocation"><a class="anchor" href="#retrieving-the-final-result-from-an-asynchronous-method-invocation"></a>Retrieving the Final Result from an Asynchronous Method Invocation</h5>
<div class="paragraph">
<p>The client may retrieve the result using one of the <code>Future&lt;V&gt;.get</code> methods.
If processing hasn&#8217;t been completed by the session bean handling the invocation, calling one of the <code>get</code> methods will result in the client halting execution until the invocation completes.
Use the <code>Future&lt;V&gt;.isDone</code> method to determine whether processing has completed before calling one of the <code>get</code> methods.</p>
</div>
<div class="paragraph">
<p>The <code>get()</code> method returns the result as the type specified in the type value of the <code>Future&lt;V&gt;</code> instance.
For example, calling <code>Future&lt;String&gt;.get()</code> will return a <code>String</code> object.
If the method invocation was cancelled, calls to <code>get()</code> result in a <code>java.util.concurrent.CancellationException</code> being thrown.
If the invocation resulted in an exception during processing by the session bean, calls to <code>get()</code> result in a <code>java.util.concurrent.ExecutionException</code> being thrown.
The cause of the <code>ExecutionException</code> may be retrieved by calling the <code>ExecutionException.getCause</code> method.</p>
</div>
<div class="paragraph">
<p>The <code>get(long timeout, java.util.concurrent.TimeUnit unit)</code> method is similar to the <code>get()</code> method, but allows the client to set a timeout value.
If the timeout value is exceeded, a <code>java.util.concurrent.TimeoutException</code> is thrown.
See the Javadoc for the <code>TimeUnit</code> class for the available units of time to specify the timeout value.</p>
</div>
</div>
<div class="sect4">
<h5 id="cancelling-an-asynchronous-method-invocation"><a class="anchor" href="#cancelling-an-asynchronous-method-invocation"></a>Cancelling an Asynchronous Method Invocation</h5>
<div class="paragraph">
<p>Call the <code>cancel(boolean mayInterruptIfRunning)</code> method on the <code>Future&lt;V&gt;</code> instance to attempt to cancel the method invocation.
The <code>cancel</code> method returns <code>true</code> if the cancellation was successful and <code>false</code> if the method invocation cannot be cancelled.</p>
</div>
<div class="paragraph">
<p>When the invocation cannot be cancelled, the <code>mayInterruptIfRunning</code> parameter is used to alert the session bean instance on which the method invocation is running that the client attempted to cancel the invocation.
If <code>mayInterruptIfRunning</code> is set to <code>true</code>, calls to <code>SessionContext.wasCancelled</code> by the session bean instance will return <code>true</code>.
If <code>mayInterruptIfRunning</code> is to set <code>false</code>, calls to <code>SessionContext.wasCancelled</code> by the session bean instance will return <code>false</code>.</p>
</div>
<div class="paragraph">
<p>The <code>Future&lt;V&gt;.isCancelled</code> method is used to check whether the method invocation was cancelled before the asynchronous method invocation completed by calling <code>Future&lt;V&gt;.cancel</code>.
The <code>isCancelled</code> method returns <code>true</code> if the invocation was cancelled.</p>
</div>
</div>
<div class="sect4">
<h5 id="checking-the-status-of-an-asynchronous-method-invocation"><a class="anchor" href="#checking-the-status-of-an-asynchronous-method-invocation"></a>Checking the Status of an Asynchronous Method Invocation</h5>
<div class="paragraph">
<p>The <code>Future&lt;V&gt;.isDone</code> method returns <code>true</code> if the session bean instance completed processing the method invocation.
The <code>isDone</code> method returns <code>true</code> if the asynchronous method invocation completed normally, was cancelled, or resulted in an exception.
That is, <code>isDone</code> indicates only whether the session bean has completed processing the invocation.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="the-async-example-application"><a class="anchor" href="#the-async-example-application"></a>The async Example Application</h3>
<div class="paragraph">
<p>The <code>async</code> example demonstrates how to define an asynchronous business method on a session bean and call it from a web client.
This example contains two modules.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A web application (<code>async-war</code>) that contains a stateless session bean and a Jakarta Faces interface.
The <code>MailerBean</code> stateless session bean defines an asynchronous method, <code>sendMessage</code>, which uses the Jakarta Mail API to send an email to an specified email address.</p>
</li>
<li>
<p>An auxiliary Java SE program (<code>async-smtpd</code>) that simulates an SMTP server.
This program listens on TCP port 3025 for SMTP requests and prints the email messages to the standard output (instead of delivering them).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following section describes the architecture of the <code>async-war</code> module.</p>
</div>
<div class="sect3">
<h4 id="architecture-of-the-async-war-module"><a class="anchor" href="#architecture-of-the-async-war-module"></a>Architecture of the async-war Module</h4>
<div class="paragraph">
<p>The <code>async-war</code> module consists of a single stateless session bean, <code>MailerBean</code>, and a Jakarta Faces web application front end that uses Facelets tags in XHTML files to display a form for users to enter the email address for the recipient of an email.
The status of the email is updated when the email is finally sent.</p>
</div>
<div class="paragraph">
<p>The <code>MailerBean</code> session bean injects a Jakarta Mail resource used to send an email message to an address specified by the user.
The message is created, modified, and sent using the Jakarta Mail API.
The session bean looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Named</span>
<span class="annotation">@Stateless</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">MailerBean</span> {
    <span class="annotation">@Resource</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">mail/myExampleSession</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">private</span> Session session;
    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">Logger</span> logger =
            <span class="predefined-type">Logger</span>.getLogger(MailerBean.class.getName());

    <span class="annotation">@Asynchronous</span>
    <span class="directive">public</span> <span class="predefined-type">Future</span>&lt;<span class="predefined-type">String</span>&gt; sendMessage(<span class="predefined-type">String</span> email) {
        <span class="predefined-type">String</span> status;
        <span class="keyword">try</span> {
            <span class="predefined-type">Properties</span> properties = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();
            properties.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">mail.smtp.port</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">3025</span><span class="delimiter">&quot;</span></span>);
            session = Session.getInstance(properties);
            Message message = <span class="keyword">new</span> MimeMessage(session);
            message.setFrom();
            message.setRecipients(Message.RecipientType.TO,
                    InternetAddress.parse(email, <span class="predefined-constant">false</span>));
            message.setSubject(<span class="string"><span class="delimiter">&quot;</span><span class="content">Test message from async example</span><span class="delimiter">&quot;</span></span>);
            message.setHeader(<span class="string"><span class="delimiter">&quot;</span><span class="content">X-Mailer</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Jakarta Mail</span><span class="delimiter">&quot;</span></span>);
            <span class="predefined-type">DateFormat</span> dateFormatter = <span class="predefined-type">DateFormat</span>
                    .getDateTimeInstance(<span class="predefined-type">DateFormat</span>.LONG, <span class="predefined-type">DateFormat</span>.SHORT);
            <span class="predefined-type">Date</span> timeStamp = <span class="keyword">new</span> <span class="predefined-type">Date</span>();
            <span class="predefined-type">String</span> messageBody = <span class="string"><span class="delimiter">&quot;</span><span class="content">This is a test message from the async </span><span class="delimiter">&quot;</span></span>
                    + <span class="string"><span class="delimiter">&quot;</span><span class="content">example of the Jakarta EE Tutorial. It was sent on </span><span class="delimiter">&quot;</span></span>
                    + dateFormatter.format(timeStamp)
                    + <span class="string"><span class="delimiter">&quot;</span><span class="content">.</span><span class="delimiter">&quot;</span></span>;
            message.setText(messageBody);
            message.setSentDate(timeStamp);
            Transport.send(message);
            status = <span class="string"><span class="delimiter">&quot;</span><span class="content">Sent</span><span class="delimiter">&quot;</span></span>;
            logger.log(<span class="predefined-type">Level</span>.INFO, <span class="string"><span class="delimiter">&quot;</span><span class="content">Mail sent to {0}</span><span class="delimiter">&quot;</span></span>, email);
        } <span class="keyword">catch</span> (MessagingException ex) {
            logger.severe(<span class="string"><span class="delimiter">&quot;</span><span class="content">Error in sending message.</span><span class="delimiter">&quot;</span></span>);
            status = <span class="string"><span class="delimiter">&quot;</span><span class="content">Encountered an error: </span><span class="delimiter">&quot;</span></span> + ex.getMessage();
            logger.severe(ex.getMessage());
        }
        <span class="keyword">return</span> <span class="keyword">new</span> AsyncResult&lt;&gt;(status);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The injected Jakarta Mail resource can be configured through the GlassFish Server Administration Console, through a GlassFish Server administrative command, or through a resource configuration file packaged with the application.
The resource configuration can be modified at runtime by the GlassFish Server administrator to use a different mail server or transport protocol.</p>
</div>
<div class="paragraph">
<p>The web client consists of a Facelets template, <code>template.xhtml</code>; two Facelets clients, <code>index.xhtml</code> and <code>response.xhtml</code>; and a Jakarta Faces managed bean, <code>MailerManagedBean</code>.
The <code>index.xhtml</code> file contains a form for the target email address.
When the user submits the form, the <code>MailerManagedBean.send</code> method is called.
This method uses an injected instance of the <code>MailerBean</code> session bean to call <code>MailerBean.sendMessage</code>.
The result is sent to the <code>response.xhtml</code> Facelets view.</p>
</div>
</div>
<div class="sect3">
<h4 id="running-the-async-example"><a class="anchor" href="#running-the-async-example"></a>Running the async Example</h4>
<div class="paragraph">
<p>You can use either NetBeans IDE or Maven to build, package, deploy, and run the <code>async</code> example.</p>
</div>
<div class="sect4">
<h5 id="to-run-the-async-example-application-using-netbeans-ide"><a class="anchor" href="#to-run-the-async-example-application-using-netbeans-ide"></a>To Run the async Example Application Using NetBeans IDE</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>From the <strong>File</strong> menu, choose <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the <strong>Open Project</strong> dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/ejb</pre>
</div>
</div>
</li>
<li>
<p>Select the <code>async</code> folder, select <strong>Open Required Projects</strong>, and click <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the <strong>Projects</strong> tab, right-click the <code>async-smtpd</code> project and select <strong>Run</strong>.</p>
<div class="paragraph">
<p>The SMTP server simulator starts accepting connections.
The async-smptd output tab shows the following message:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[Test SMTP server listening on port 3025]</pre>
</div>
</div>
</li>
<li>
<p>In the <strong>Projects</strong> tab, right-click the <code>async-war</code> project and select <strong>Build</strong>.</p>
<div class="paragraph">
<p>This command configures the Jakarta Mail resource using a GlassFish Server administrative command and builds, packages, and deploys the <code>async-war</code> module.</p>
</div>
</li>
<li>
<p>Open the following URL in a web browser window:</p>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080/async-war</pre>
</div>
</div>
</li>
<li>
<p>In the web browser window, enter an email address and click Send email.</p>
<div class="paragraph">
<p>The <code>MailerBean</code> stateless bean uses the Jakarta Mail API to deliver an email to the SMTP server simulator.
The async-smptd output window in NetBeans IDE shows the resulting email message, including its headers.</p>
</div>
</li>
<li>
<p>To stop the SMTP server simulator, click the X button on the right side of the status bar in NetBeans IDE.</p>
</li>
<li>
<p>Delete the Jakarta Mail session resource.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>In the Services tab, expand the Servers node, then expand the GlassFish Server server node.</p>
</li>
<li>
<p>Expand the Resources node, then expand the Jakarta Mail Sessions node.</p>
</li>
<li>
<p>Right-click mail/myExampleSession and select Unregister.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-run-the-async-example-application-using-maven"><a class="anchor" href="#to-run-the-async-example-application-using-maven"></a>To Run the async Example Application Using Maven</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>In a terminal window, go to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/ejb/async/async-smtpd/</pre>
</div>
</div>
</li>
<li>
<p>Enter the following command to build and package the SMTP server simulator:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">mvn install</code></pre>
</div>
</div>
</li>
<li>
<p>Enter the following command to start the STMP server simulator:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">mvn exec:java</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following message appears:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[Test SMTP server listening on port 3025]</pre>
</div>
</div>
<div class="paragraph">
<p>Keep this terminal window open.</p>
</div>
</li>
<li>
<p>In a new terminal window, go to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/ejb/async/async-war</pre>
</div>
</div>
</li>
<li>
<p>Enter the following command to configure the Jakarta Mail resource and to build, package, and deploy the <code>async-war</code> module:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">mvn install</code></pre>
</div>
</div>
</li>
<li>
<p>Open the following URL in a web browser window:</p>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080/async-war</pre>
</div>
</div>
</li>
<li>
<p>In the web browser window, enter an email address and click Send email.</p>
<div class="paragraph">
<p>The <code>MailerBean</code> stateless bean uses the Jakarta Mail API to deliver an email to the SMTP server simulator.
The resulting email message appears on the first terminal window, including its headers.</p>
</div>
</li>
<li>
<p>To stop the SMTP server simulator, close the terminal window in which you issued the command to start the STMP server simulator.</p>
</li>
<li>
<p>To delete the Jakarta Mail session resource, type the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">asadmin delete-mail-resource mail/myExampleSession</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
</div>
<h1 id="persistence" class="sect0"><a class="anchor" href="#persistence"></a>Part VIII: Persistence</h1>
<div class="openblock partintro">
<div class="content">
Part VIII explores Jakarta Persistence.
</div>
</div>
<div class="sect1">
<h2 id="introduction-to-jakarta-persistence"><a class="anchor" href="#introduction-to-jakarta-persistence"></a>Chapter 40. Introduction to Jakarta Persistence</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter provides a description of Jakarta Persistence.</p>
</div>
<div class="sect2">
<h3 id="overview-of-jakarta-persistence"><a class="anchor" href="#overview-of-jakarta-persistence"></a>Overview of Jakarta Persistence</h3>
<div class="paragraph">
<p>Jakarta Persistence provides Java developers with an object/relational mapping facility for managing relational data in Java applications.
Jakarta Persistence consists of four areas:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Jakarta Persistence</p>
</li>
<li>
<p>The query language</p>
</li>
<li>
<p>The Jakarta Persistence Criteria API</p>
</li>
<li>
<p>Object/relational mapping metadata</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="entities"><a class="anchor" href="#entities"></a>Entities</h3>
<div class="paragraph">
<p>An entity is a lightweight persistence domain object.
Typically, an entity represents a table in a relational database, and each entity instance corresponds to a row in that table.
The primary programming artifact of an entity is the entity class, although entities can use helper classes.</p>
</div>
<div class="paragraph">
<p>The persistent state of an entity is represented through either persistent fields or persistent properties.
These fields or properties use object/relational mapping annotations to map the entities and entity relationships to the relational data in the underlying data store.</p>
</div>
<div class="sect3">
<h4 id="requirements-for-entity-classes"><a class="anchor" href="#requirements-for-entity-classes"></a>Requirements for Entity Classes</h4>
<div class="paragraph">
<p>An entity class must follow these requirements.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The class must be annotated with the <code>jakarta.persistence.Entity</code> annotation.</p>
</li>
<li>
<p>The class must have a public or protected, no-argument constructor.
The class may have other constructors.</p>
</li>
<li>
<p>The class must not be declared <code>final</code>.
No methods or persistent instance variables must be declared <code>final</code>.</p>
</li>
<li>
<p>If an entity instance is passed by value as a detached object, such as through a session bean&#8217;s remote business interface, the class must implement the <code>Serializable</code> interface.</p>
</li>
<li>
<p>Entities may extend both entity and non-entity classes, and non-entity classes may extend entity classes.</p>
</li>
<li>
<p>Persistent instance variables must be declared private, protected, or package-private and can be accessed directly only by the entity class&#8217;s methods.
Clients must access the entity&#8217;s state through accessor or business methods.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="persistent-fields-and-properties-in-entity-classes"><a class="anchor" href="#persistent-fields-and-properties-in-entity-classes"></a>Persistent Fields and Properties in Entity Classes</h4>
<div class="paragraph">
<p>The persistent state of an entity can be accessed through either the entity&#8217;s instance variables or properties.
The fields or properties must be of the following Java language types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Java primitive types</p>
</li>
<li>
<p><code>java.lang.String</code></p>
</li>
<li>
<p>Other serializable types, including:</p>
<div class="ulist">
<ul>
<li>
<p>Wrappers of Java primitive types</p>
</li>
<li>
<p><code>java.math.BigInteger</code></p>
</li>
<li>
<p><code>java.math.BigDecimal</code></p>
</li>
<li>
<p><code>java.util.Date</code></p>
</li>
<li>
<p><code>java.util.Calendar</code></p>
</li>
<li>
<p><code>java.sql.Date</code></p>
</li>
<li>
<p><code>java.sql.Time</code></p>
</li>
<li>
<p><code>java.sql.TimeStamp</code></p>
</li>
<li>
<p>User-defined serializable types</p>
</li>
<li>
<p><code>byte[]</code></p>
</li>
<li>
<p><code>Byte[]</code></p>
</li>
<li>
<p><code>char[]</code></p>
</li>
<li>
<p><code>Character[]</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Enumerated types</p>
</li>
<li>
<p>Other entities and/or collections of entities</p>
</li>
<li>
<p>Embeddable classes</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Entities may use persistent fields, persistent properties, or a combination of both.
If the mapping annotations are applied to the entity&#8217;s instance variables, the entity uses persistent fields.
If the mapping annotations are applied to the entity&#8217;s getter methods for JavaBeans-style properties, the entity uses persistent properties.</p>
</div>
<div class="sect4">
<h5 id="persistent-fields"><a class="anchor" href="#persistent-fields"></a>Persistent Fields</h5>
<div class="paragraph">
<p>If the entity class uses persistent fields, the Persistence runtime accesses entity-class instance variables directly.
All fields not annotated <code>jakarta.persistence.Transient</code> or not marked as Java <code>transient</code> will be persisted to the data store.
The object/relational mapping annotations must be applied to the instance variables.</p>
</div>
</div>
<div class="sect4">
<h5 id="persistent-properties"><a class="anchor" href="#persistent-properties"></a>Persistent Properties</h5>
<div class="paragraph">
<p>If the entity uses persistent properties, the entity must follow the method conventions of JavaBeans components.
JavaBeans-style properties use getter and setter methods that are typically named after the entity class&#8217;s instance variable names.
For every persistent property <code><em>property</em></code> of type <code><em>Type</em></code> of the entity, there is a getter method <code>get<em>Property</em></code> and setter method <code>set<em>Property</em></code>.
If the property is a Boolean, you may use <code>is<em>Property</em></code> instead of <code>get<em>Property</em></code>.
For example, if a <code>Customer</code> entity uses persistent properties and has a private instance variable called <code>firstName</code>, the class defines a <code>getFirstName</code> and <code>setFirstName</code> method for retrieving and setting the state of the <code>firstName</code> instance variable.</p>
</div>
<div class="paragraph">
<p>The method signatures for single-valued persistent properties are as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Type</span> getProperty()
<span class="type">void</span> setProperty(<span class="predefined-type">Type</span> type)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The object/relational mapping annotations for persistent properties must be applied to the getter methods.
Mapping annotations cannot be applied to fields or properties annotated <code>@Transient</code> or marked <code>transient</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="using-collections-in-entity-fields-and-properties"><a class="anchor" href="#using-collections-in-entity-fields-and-properties"></a>Using Collections in Entity Fields and Properties</h5>
<div class="paragraph">
<p>Collection-valued persistent fields and properties must use the supported Java collection interfaces regardless of whether the entity uses persistent fields or properties.
The following collection interfaces may be used:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>java.util.Collection</code></p>
</li>
<li>
<p><code>java.util.Set</code></p>
</li>
<li>
<p><code>java.util.List</code></p>
</li>
<li>
<p><code>java.util.Map</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If the entity class uses persistent fields, the type in the preceding method signatures must be one of these collection types.
Generic variants of these collection types may also be used.
For example, if it has a persistent property that contains a set of phone numbers, the <code>Customer</code> entity would have the following methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Set</span>&lt;PhoneNumber&gt; getPhoneNumbers() { ... }
<span class="type">void</span> setPhoneNumbers(<span class="predefined-type">Set</span>&lt;PhoneNumber&gt;) { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>If a field or property of an entity consists of a collection of basic types or embeddable classes, use the <code>jakarta.persistence.ElementCollection</code> annotation on the field or property.</p>
</div>
<div class="paragraph">
<p>The two attributes of <code>@ElementCollection</code> are <code>targetClass</code> and <code>fetch</code>.
The <code>targetClass</code> attribute specifies the class name of the basic or embeddable class and is optional if the field or property is defined using Java programming language generics.
The optional <code>fetch</code> attribute is used to specify whether the collection should be retrieved lazily or eagerly, using the <code>jakarta.persistence.FetchType</code> constants of either <code>LAZY</code> or <code>EAGER</code>, respectively.
By default, the collection will be fetched lazily.</p>
</div>
<div class="paragraph">
<p>The following entity, <code>Person</code>, has a persistent field, <code>nicknames</code>, which is a collection of <code>String</code> classes that will be fetched eagerly.
The <code>targetClass</code> element is not required, because it uses generics to define the field:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Entity</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Person</span> {
    ...
    <span class="annotation">@ElementCollection</span>(fetch=EAGER)
    <span class="directive">protected</span> <span class="predefined-type">Set</span>&lt;<span class="predefined-type">String</span>&gt; nickname = <span class="keyword">new</span> <span class="predefined-type">HashSet</span>();
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Collections of entity elements and relationships may be represented by <code>java.util.Map</code> collections.
A <code>Map</code> consists of a key and a value.</p>
</div>
<div class="paragraph">
<p>When using <code>Map</code> elements or relationships, the following rules apply.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>Map</code> key or value may be a basic Java programming language type, an embeddable class, or an entity.</p>
</li>
<li>
<p>When the <code>Map</code> value is an embeddable class or basic type, use the <code>@ElementCollection</code> annotation.</p>
</li>
<li>
<p>When the <code>Map</code> value is an entity, use the <code>@OneToMany</code> or <code>@ManyToMany</code> annotation.</p>
</li>
<li>
<p>Use the <code>Map</code> type on only one side of a bidirectional relationship.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If the key type of a <code>Map</code> is a Java programming language basic type, use the annotation <code>jakarta.persistence.MapKeyColumn</code> to set the column mapping for the key.
By default, the <code>name</code> attribute of <code>@MapKeyColumn</code> is of the form <em>RELATIONSHIP-FIELD/PROPERTY-NAME</em><code>_KEY</code>.
For example, if the referencing relationship field name is <code>image</code>, the default <code>name</code> attribute is <code>IMAGE_KEY</code>.</p>
</div>
<div class="paragraph">
<p>If the key type of a <code>Map</code> is an entity, use the <code>jakarta.persistence.MapKeyJoinColumn</code> annotation.
If the multiple columns are needed to set the mapping, use the annotation <code>jakarta.persistence.MapKeyJoinColumns</code> to include multiple <code>@MapKeyJoinColumn</code> annotations.
If no <code>@MapKeyJoinColumn</code> is present, the mapping column name is by default set to <em>RELATIONSHIP-FIELD/PROPERTY-NAME</em><code>_KEY</code>.
For example, if the relationship field name is <code>employee</code>, the default <code>name</code> attribute is <code>EMPLOYEE_KEY</code>.</p>
</div>
<div class="paragraph">
<p>If Java programming language generic types are not used in the relationship field or property, the key class must be explicitly set using the <code>jakarta.persistence.MapKeyClass</code> annotation.</p>
</div>
<div class="paragraph">
<p>If the <code>Map</code> key is the primary key or a persistent field or property of the entity that is the <code>Map</code> value, use the <code>jakarta.persistence.MapKey</code> annotation.
The <code>@MapKeyClass</code> and <code>@MapKey</code> annotations cannot be used on the same field or property.</p>
</div>
<div class="paragraph">
<p>If the <code>Map</code> value is a Java programming language basic type or an embeddable class, it will be mapped as a collection table in the underlying database.
If generic types are not used, the <code>@ElementCollection</code> annotation&#8217;s <code>targetClass</code> attribute must be set to the type of the <code>Map</code> value.</p>
</div>
<div class="paragraph">
<p>If the <code>Map</code> value is an entity and part of a many-to-many or one-to-many unidirectional relationship, it will be mapped as a join table in the underlying database.
A unidirectional one-to-many relationship that uses a <code>Map</code> may also be mapped using the <code>@JoinColumn</code> annotation.</p>
</div>
<div class="paragraph">
<p>If the entity is part of a one-to-many/many-to-one bidirectional relationship, it will be mapped in the table of the entity that represents the value of the <code>Map</code>.
If generic types are not used, the <code>targetEntity</code> attribute of the <code>@OneToMany</code> and <code>@ManyToMany</code> annotations must be set to the type of the <code>Map</code> value.</p>
</div>
</div>
<div class="sect4">
<h5 id="validating-persistent-fields-and-properties"><a class="anchor" href="#validating-persistent-fields-and-properties"></a>Validating Persistent Fields and Properties</h5>
<div class="paragraph">
<p>Jakarta Bean Validation provides a mechanism for validating application data.
Bean Validation is integrated into the Jakarta EE containers, allowing the same validation logic to be used in any of the tiers of an enterprise application.</p>
</div>
<div class="paragraph">
<p>Bean Validation constraints may be applied to persistent entity classes, embeddable classes, and mapped superclasses.
By default, the Persistence provider will automatically perform validation on entities with persistent fields or properties annotated with Bean Validation constraints immediately after the <code>PrePersist</code>, <code>PreUpdate</code>, and <code>PreRemove</code> lifecycle events.</p>
</div>
<div class="paragraph">
<p>Bean Validation constraints are annotations applied to the fields or properties of Java programming language classes.
Bean Validation provides a set of constraints as well as an API for defining custom constraints.
Custom constraints can be specific combinations of the default constraints, or new constraints that don&#8217;t use the default constraints.
Each constraint is associated with at least one validator class that validates the value of the constrained field or property.
Custom constraint developers must also provide a validator class for the constraint.</p>
</div>
<div class="paragraph">
<p>Bean Validation constraints are applied to the persistent fields or properties of persistent classes.
When adding Bean Validation constraints, use the same access strategy as the persistent class.
That is, if the persistent class uses field access, apply the Bean Validation constraint annotations on the class&#8217;s fields.
If the class uses property access, apply the constraints on the getter methods.</p>
</div>
<div class="paragraph">
<p><a href="#built-in-jakarta-bean-validation-constraints">Table 23-1</a> lists Bean Validation&#8217;s built-in constraints, defined in the <code>jakarta.validation.constraints</code> package.</p>
</div>
<div class="paragraph">
<p>All the built-in constraints listed in <a href="#built-in-jakarta-bean-validation-constraints">Table 23-1</a> have a corresponding annotation, <code><em>ConstraintName</em>.List</code>, for grouping multiple constraints of the same type on the same field or property.
For example, the following persistent field has two <code>@Pattern</code> constraints:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Pattern</span>.List({
    <span class="annotation">@Pattern</span>(regexp=<span class="string"><span class="delimiter">&quot;</span><span class="content">...</span><span class="delimiter">&quot;</span></span>),
    <span class="annotation">@Pattern</span>(regexp=<span class="string"><span class="delimiter">&quot;</span><span class="content">...</span><span class="delimiter">&quot;</span></span>)
})</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following entity class, <code>Contact</code>, has Bean Validation constraints applied to its persistent fields:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Entity</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Contact</span> <span class="directive">implements</span> <span class="predefined-type">Serializable</span> {
    <span class="annotation">@Id</span>
    <span class="annotation">@GeneratedValue</span>(strategy = GenerationType.AUTO)
    <span class="directive">private</span> <span class="predefined-type">Long</span> id;
    <span class="annotation">@NotNull</span>
    <span class="directive">protected</span> <span class="predefined-type">String</span> firstName;
    <span class="annotation">@NotNull</span>
    <span class="directive">protected</span> <span class="predefined-type">String</span> lastName;
    <span class="annotation">@Pattern</span>(regexp = <span class="string"><span class="delimiter">&quot;</span><span class="content">[a-z0-9!#$%&amp;'*+/=?^_`{|}~-]+(?:</span><span class="char">\\</span><span class="content">.</span><span class="delimiter">&quot;</span></span>
            + <span class="string"><span class="delimiter">&quot;</span><span class="content">[a-z0-9!#$%&amp;'*+/=?^_`{|}~-]+)*@</span><span class="delimiter">&quot;</span></span>
            + <span class="string"><span class="delimiter">&quot;</span><span class="content">(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?</span><span class="char">\\</span><span class="content">.)+[a-z0-9]</span><span class="delimiter">&quot;</span></span>
            + <span class="string"><span class="delimiter">&quot;</span><span class="content">(?:[a-z0-9-]*[a-z0-9])?</span><span class="delimiter">&quot;</span></span>,
            message = <span class="string"><span class="delimiter">&quot;</span><span class="content">{invalid.email}</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">protected</span> <span class="predefined-type">String</span> email;
    <span class="annotation">@Pattern</span>(regexp = <span class="string"><span class="delimiter">&quot;</span><span class="content">^</span><span class="char">\\</span><span class="content">(?(</span><span class="char">\\</span><span class="content">d{3})</span><span class="char">\\</span><span class="content">)?[- ]?(</span><span class="char">\\</span><span class="content">d{3})[- ]?(</span><span class="char">\\</span><span class="content">d{4})$</span><span class="delimiter">&quot;</span></span>,
            message = <span class="string"><span class="delimiter">&quot;</span><span class="content">{invalid.phonenumber}</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">protected</span> <span class="predefined-type">String</span> mobilePhone;
    <span class="annotation">@Pattern</span>(regexp = <span class="string"><span class="delimiter">&quot;</span><span class="content">^</span><span class="char">\\</span><span class="content">(?(</span><span class="char">\\</span><span class="content">d{3})</span><span class="char">\\</span><span class="content">)?[- ]?(</span><span class="char">\\</span><span class="content">d{3})[- ]?(</span><span class="char">\\</span><span class="content">d{4})$</span><span class="delimiter">&quot;</span></span>,
            message = <span class="string"><span class="delimiter">&quot;</span><span class="content">{invalid.phonenumber}</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">protected</span> <span class="predefined-type">String</span> homePhone;
    <span class="annotation">@Temporal</span>(jakarta.persistence.TemporalType.DATE)
    <span class="annotation">@Past</span>
    <span class="directive">protected</span> <span class="predefined-type">Date</span> birthday;
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>@NotNull</code> annotation on the <code>firstName</code> and <code>lastName</code> fields specifies that those fields are now required.
If a new <code>Contact</code> instance is created where <code>firstName</code> or <code>lastName</code> have not been initialized, Bean Validation will throw a validation error.
Similarly, if a previously created instance of <code>Contact</code> has been modified so that <code>firstName</code> or <code>lastName</code> are null, a validation error will be thrown.</p>
</div>
<div class="paragraph">
<p>The <code>email</code> field has a <code>@Pattern</code> constraint applied to it, with a complicated regular expression that matches most valid email addresses.
If the value of <code>email</code> doesn&#8217;t match this regular expression, a validation error will be thrown.</p>
</div>
<div class="paragraph">
<p>The <code>homePhone</code> and <code>mobilePhone</code> fields have the same <code>@Pattern</code> constraints.
The regular expression matches 10 digit telephone numbers in the United States and Canada of the form <code>(</code>xxx<code>)</code> xxx<code>-</code>xxxx.</p>
</div>
<div class="paragraph">
<p>The <code>birthday</code> field is annotated with the <code>@Past</code> constraint, which ensures that the value of <code>birthday</code> must be in the past.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="primary-keys-in-entities"><a class="anchor" href="#primary-keys-in-entities"></a>Primary Keys in Entities</h4>
<div class="paragraph">
<p>Each entity has a unique object identifier.
A customer entity, for example, might be identified by a customer number.
The unique identifier, or primary key, enables clients to locate a particular entity instance.
Every entity must have a primary key.
An entity may have either a simple or a composite primary key.</p>
</div>
<div class="paragraph">
<p>Simple primary keys use the <code>jakarta.persistence.Id</code> annotation to denote the primary key property or field.</p>
</div>
<div class="paragraph">
<p>Composite primary keys are used when a primary key consists of more than one attribute, which corresponds to a set of single persistent properties or fields.
Composite primary keys must be defined in a primary key class.
Composite primary keys are denoted using the <code>jakarta.persistence.EmbeddedId</code> and <code>jakarta.persistence.IdClass</code> annotations.</p>
</div>
<div class="paragraph">
<p>The primary key, or the property or field of a composite primary key, must be one of the following Java language types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Java primitive types</p>
</li>
<li>
<p>Java primitive wrapper types</p>
</li>
<li>
<p><code>java.lang.String</code></p>
</li>
<li>
<p><code>java.util.Date</code> (the temporal type should be <code>DATE</code>)</p>
</li>
<li>
<p><code>java.sql.Date</code></p>
</li>
<li>
<p><code>java.math.BigDecimal</code></p>
</li>
<li>
<p><code>java.math.BigInteger</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Floating-point types should never be used in primary keys.
If you use a generated primary key, only integral types will be portable.</p>
</div>
<div class="paragraph">
<p>A primary key class must meet these requirements.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The access control modifier of the class must be <code>public</code>.</p>
</li>
<li>
<p>The properties of the primary key class must be <code>public</code> or <code>protected</code> if property-based access is used.</p>
</li>
<li>
<p>The class must have a public default constructor.</p>
</li>
<li>
<p>The class must implement the <code>hashCode()</code> and <code>equals(Object other)</code> methods.</p>
</li>
<li>
<p>The class must be serializable.</p>
</li>
<li>
<p>A composite primary key must be represented and mapped to multiple fields or properties of the entity class or must be represented and mapped as an embeddable class.</p>
</li>
<li>
<p>If the class is mapped to multiple fields or properties of the entity class, the names and types of the primary key fields or properties in the primary key class must match those of the entity class.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following primary key class is a composite key, and the <code>customerOrder</code> and <code>itemId</code> fields together uniquely identify an entity:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">final</span> <span class="type">class</span> <span class="class">LineItemKey</span> <span class="directive">implements</span> <span class="predefined-type">Serializable</span> {
    <span class="directive">private</span> <span class="predefined-type">Integer</span> customerOrder;
    <span class="directive">private</span> <span class="type">int</span> itemId;

    <span class="directive">public</span> LineItemKey() {}

    <span class="directive">public</span> LineItemKey(<span class="predefined-type">Integer</span> order, <span class="type">int</span> itemId) {
        <span class="local-variable">this</span>.setCustomerOrder(order);
        <span class="local-variable">this</span>.setItemId(itemId);
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">int</span> hashCode() {
        <span class="keyword">return</span> ((<span class="local-variable">this</span>.getCustomerOrder() == <span class="predefined-constant">null</span>
                ? <span class="integer">0</span> : <span class="local-variable">this</span>.getCustomerOrder().hashCode())
                ^ ((<span class="type">int</span>) <span class="local-variable">this</span>.getItemId()));
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">boolean</span> equals(<span class="predefined-type">Object</span> otherOb) {
        <span class="keyword">if</span> (<span class="local-variable">this</span> == otherOb) {
            <span class="keyword">return</span> <span class="predefined-constant">true</span>;
        }
        <span class="keyword">if</span> (!(otherOb <span class="keyword">instanceof</span> LineItemKey)) {
            <span class="keyword">return</span> <span class="predefined-constant">false</span>;
        }
        LineItemKey other = (LineItemKey) otherOb;
        <span class="keyword">return</span> ((<span class="local-variable">this</span>.getCustomerOrder() == <span class="predefined-constant">null</span>
                ? other.getCustomerOrder() == <span class="predefined-constant">null</span> : <span class="local-variable">this</span>.getCustomerOrder()
                .equals(other.getCustomerOrder()))
                &amp;&amp; (<span class="local-variable">this</span>.getItemId() == other.getItemId()));
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> toString() {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span> + getCustomerOrder() + <span class="string"><span class="delimiter">&quot;</span><span class="content">-</span><span class="delimiter">&quot;</span></span> + getItemId();
    }
    <span class="comment">/* Getters and setters */</span>
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="multiplicity-in-entity-relationships"><a class="anchor" href="#multiplicity-in-entity-relationships"></a>Multiplicity in Entity Relationships</h4>
<div class="paragraph">
<p>Multiplicities are of the following types.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>One-to-one: Each entity instance is related to a single instance of another entity.
For example, to model a physical warehouse in which each storage bin contains a single widget, <code>StorageBin</code> and <code>Widget</code> would have a one-to-one relationship.
One-to-one relationships use the <code>jakarta.persistence.OneToOne</code> annotation on the corresponding persistent property or field.</p>
</li>
<li>
<p>One-to-many: An entity instance can be related to multiple instances of the other entities.
A sales order, for example, can have multiple line items.
In the order application, <code>CustomerOrder</code> would have a one-to-many relationship with <code>LineItem</code>.
One-to-many relationships use the <code>jakarta.persistence.OneToMany</code> annotation on the corresponding persistent property or field.</p>
</li>
<li>
<p>Many-to-one: Multiple instances of an entity can be related to a single instance of the other entity.
This multiplicity is the opposite of a one-to-many relationship.
In the example just mentioned, the relationship to <code>CustomerOrder</code> from the perspective of <code>LineItem</code> is many-to-one.
Many-to-one relationships use the <code>jakarta.persistence.ManyToOne</code> annotation on the corresponding persistent property or field.</p>
</li>
<li>
<p>Many-to-many: The entity instances can be related to multiple instances of each other.
For example, each college course has many students, and every student may take several courses.
Therefore, in an enrollment application, <code>Course</code> and <code>Student</code> would have a many-to-many relationship.
Many-to-many relationships use the <code>jakarta.persistence.ManyToMany</code> annotation on the corresponding persistent property or field.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="direction-in-entity-relationships"><a class="anchor" href="#direction-in-entity-relationships"></a>Direction in Entity Relationships</h4>
<div class="paragraph">
<p>The direction of a relationship can be either bidirectional or unidirectional.
A bidirectional relationship has both an owning side and an inverse side.
A unidirectional relationship has only an owning side.
The owning side of a relationship determines how the Persistence runtime makes updates to the relationship in the database.</p>
</div>
<div class="sect4">
<h5 id="bidirectional-relationships"><a class="anchor" href="#bidirectional-relationships"></a>Bidirectional Relationships</h5>
<div class="paragraph">
<p>In a bidirectional relationship, each entity has a relationship field or property that refers to the other entity.
Through the relationship field or property, an entity class&#8217;s code can access its related object.
If an entity has a related field, the entity is said to "know" about its related object.
For example, if <code>CustomerOrder</code> knows what <code>LineItem</code> instances it has and if <code>LineItem</code> knows what <code>CustomerOrder</code> it belongs to, they have a bidirectional relationship.</p>
</div>
<div class="paragraph">
<p>Bidirectional relationships must follow these rules.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The inverse side of a bidirectional relationship must refer to its owning side by using the <code>mappedBy</code> element of the <code>@OneToOne</code>, <code>@OneToMany</code>, or <code>@ManyToMany</code> annotation.
The <code>mappedBy</code> element designates the property or field in the entity that is the owner of the relationship.</p>
</li>
<li>
<p>The many side of many-to-one bidirectional relationships must not define the <code>mappedBy</code> element.
The many side is always the owning side of the relationship.</p>
</li>
<li>
<p>For one-to-one bidirectional relationships, the owning side corresponds to the side that contains the corresponding foreign key.</p>
</li>
<li>
<p>For many-to-many bidirectional relationships, either side may be the owning side.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="unidirectional-relationships"><a class="anchor" href="#unidirectional-relationships"></a>Unidirectional Relationships</h5>
<div class="paragraph">
<p>In a unidirectional relationship, only one entity has a relationship field or property that refers to the other.
For example, <code>LineItem</code> would have a relationship field that identifies <code>Product</code>, but <code>Product</code> would not have a relationship field or property for <code>LineItem</code>.
In other words, <code>LineItem</code> knows about <code>Product</code>, but <code>Product</code> doesn&#8217;t know which <code>LineItem</code> instances refer to it.</p>
</div>
</div>
<div class="sect4">
<h5 id="queries-and-relationship-direction"><a class="anchor" href="#queries-and-relationship-direction"></a>Queries and Relationship Direction</h5>
<div class="paragraph">
<p>Jakarta Persistence query language and Criteria API queries often navigate across relationships.
The direction of a relationship determines whether a query can navigate from one entity to another.
For example, a query can navigate from <code>LineItem</code> to <code>Product</code> but cannot navigate in the opposite direction.
For <code>CustomerOrder</code> and <code>LineItem</code>, a query could navigate in both directions because these two entities have a bidirectional relationship.</p>
</div>
</div>
<div class="sect4">
<h5 id="cascade-operations-and-relationships"><a class="anchor" href="#cascade-operations-and-relationships"></a>Cascade Operations and Relationships</h5>
<div class="paragraph">
<p>Entities that use relationships often have dependencies on the existence of the other entity in the relationship.
For example, a line item is part of an order; if the order is deleted, the line item also should be deleted.
This is called a cascade delete relationship.</p>
</div>
<div class="paragraph">
<p>The <code>jakarta.persistence.CascadeType</code> enumerated type defines the cascade operations that are applied in the <code>cascade</code> element of the relationship annotations.
<a href="#cascade-operations-for-entities">Table 40-1</a> lists the cascade operations for entities.</p>
</div>
<table id="cascade-operations-for-entities" class="tableblock frame-all grid-all" style="width: 75%;">
<caption class="title">Table 40-1 Cascade Operations for Entities</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Cascade Operation</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ALL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All cascade operations will be applied to the parent entity&#8217;s related entity.
<code>All</code> is equivalent to specifying <code>cascade={DETACH, MERGE, PERSIST, REFRESH, REMOVE}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DETACH</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If the parent entity is detached from the persistence context, the related entity will also be detached.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MERGE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If the parent entity is merged into the persistence context, the related entity will also be merged.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PERSIST</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If the parent entity is persisted into the persistence context, the related entity will also be persisted.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>REFRESH</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If the parent entity is refreshed in the current persistence context, the related entity will also be refreshed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>REMOVE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If the parent entity is removed from the current persistence context, the related entity will also be removed.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Cascade delete relationships are specified using the <code>cascade=REMOVE</code> element specification for <code>@OneToOne</code> and <code>@OneToMany</code> relationships.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@OneToMany</span>(cascade=REMOVE, mappedBy=<span class="string"><span class="delimiter">&quot;</span><span class="content">customer</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="predefined-type">Set</span>&lt;CustomerOrder&gt; getOrders() { <span class="keyword">return</span> orders; }</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="orphan-removal-in-relationships"><a class="anchor" href="#orphan-removal-in-relationships"></a>Orphan Removal in Relationships</h5>
<div class="paragraph">
<p>When a target entity in a one-to-one or one-to-many relationship is removed from the relationship, it is often desirable to cascade the remove operation to the target entity.
Such target entities are considered "orphans," and the <code>orphanRemoval</code> attribute can be used to specify that orphaned entities should be removed.
For example, if an order has many line items and one of them is removed from the order, the removed line item is considered an orphan.
If <code>orphanRemoval</code> is set to <code>true</code>, the line item entity will be deleted when the line item is removed from the order.</p>
</div>
<div class="paragraph">
<p>The <code>orphanRemoval</code> attribute in <code>@OneToMany</code> and <code>@oneToOne</code> takes a Boolean value and is by default false.</p>
</div>
<div class="paragraph">
<p>The following example will cascade the remove operation to the orphaned <code>order</code> entity when the <code>customer</code> entity is deleted:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@OneToMany</span>(mappedBy=<span class="string"><span class="delimiter">&quot;</span><span class="content">customer</span><span class="delimiter">&quot;</span></span>, orphanRemoval=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="predefined-type">List</span>&lt;CustomerOrder&gt; getOrders() { ... }</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="embeddable-classes-in-entities"><a class="anchor" href="#embeddable-classes-in-entities"></a>Embeddable Classes in Entities</h4>
<div class="paragraph">
<p>Embeddable classes are used to represent the state of an entity but don&#8217;t have a persistent identity of their own, unlike entity classes.
Instances of an embeddable class share the identity of the entity that owns it.
Embeddable classes exist only as the state of another entity.
An entity may have single-valued or collection-valued embeddable class attributes.</p>
</div>
<div class="paragraph">
<p>Embeddable classes have the same rules as entity classes but are annotated with the <code>jakarta.persistence.Embeddable</code> annotation instead of <code>@Entity</code>.</p>
</div>
<div class="paragraph">
<p>The following embeddable class, <code>ZipCode</code>, has the fields <code>zip</code> and <code>plusFour</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Embeddable</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">ZipCode</span> {
    <span class="predefined-type">String</span> zip;
    <span class="predefined-type">String</span> plusFour;
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This embeddable class is used by the <code>Address</code> entity:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Entity</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Address</span> {
    <span class="annotation">@Id</span>
    <span class="directive">protected</span> <span class="type">long</span> id
    <span class="predefined-type">String</span> street1;
    <span class="predefined-type">String</span> street2;
    <span class="predefined-type">String</span> city;
    <span class="predefined-type">String</span> province;
    <span class="annotation">@Embedded</span>
    ZipCode zipCode;
    <span class="predefined-type">String</span> country;
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Entities that own embeddable classes as part of their persistent state may annotate the field or property with the <code>jakarta.persistence.Embedded</code> annotation but are not required to do so.</p>
</div>
<div class="paragraph">
<p>Embeddable classes may themselves use other embeddable classes to represent their state.
They may also contain collections of basic Java programming language types or other embeddable classes.
Embeddable classes may also contain relationships to other entities or collections of entities.
If the embeddable class has such a relationship, the relationship is from the target entity or collection of entities to the entity that owns the embeddable class.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="entity-inheritance"><a class="anchor" href="#entity-inheritance"></a>Entity Inheritance</h3>
<div class="paragraph">
<p>Entities support class inheritance, polymorphic associations, and polymorphic queries.
Entity classes can extend non-entity classes, and non-entity classes can extend entity classes.
Entity classes can be both abstract and concrete.</p>
</div>
<div class="paragraph">
<p>The <code>roster</code> example application demonstrates entity inheritance, as described in <a href="#entity-inheritance-in-the-roster-application">Entity Inheritance in the roster Application</a>.</p>
</div>
<div class="sect3">
<h4 id="abstract-entities"><a class="anchor" href="#abstract-entities"></a>Abstract Entities</h4>
<div class="paragraph">
<p>An abstract class may be declared an entity by decorating the class with <code>@Entity</code>.
Abstract entities are like concrete entities but cannot be instantiated.</p>
</div>
<div class="paragraph">
<p>Abstract entities can be queried just like concrete entities.
If an abstract entity is the target of a query, the query operates on all the concrete subclasses of the abstract entity:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Entity</span>
<span class="directive">public</span> <span class="directive">abstract</span> <span class="type">class</span> <span class="class">Employee</span> {
    <span class="annotation">@Id</span>
    <span class="directive">protected</span> <span class="predefined-type">Integer</span> employeeId;
    ...
}
<span class="annotation">@Entity</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">FullTimeEmployee</span> <span class="directive">extends</span> Employee {
    <span class="directive">protected</span> <span class="predefined-type">Integer</span> salary;
    ...
}
<span class="annotation">@Entity</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">PartTimeEmployee</span> <span class="directive">extends</span> Employee {
    <span class="directive">protected</span> <span class="predefined-type">Float</span> hourlyWage;
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="mapped-superclasses"><a class="anchor" href="#mapped-superclasses"></a>Mapped Superclasses</h4>
<div class="paragraph">
<p>Entities may inherit from superclasses that contain persistent state and mapping information but are not entities.
That is, the superclass is not decorated with the <code>@Entity</code> annotation and is not mapped as an entity by the Jakarta Persistence provider.
These superclasses are most often used when you have state and mapping information common to multiple entity classes.</p>
</div>
<div class="paragraph">
<p>Mapped superclasses are specified by decorating the class with the annotation <code>jakarta.persistence.MappedSuperclass</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@MappedSuperclass</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Employee</span> {
    <span class="annotation">@Id</span>
    <span class="directive">protected</span> <span class="predefined-type">Integer</span> employeeId;
    ...
}
<span class="annotation">@Entity</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">FullTimeEmployee</span> <span class="directive">extends</span> Employee {
    <span class="directive">protected</span> <span class="predefined-type">Integer</span> salary;
    ...
}
<span class="annotation">@Entity</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">PartTimeEmployee</span> <span class="directive">extends</span> Employee {
    <span class="directive">protected</span> <span class="predefined-type">Float</span> hourlyWage;
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Mapped superclasses cannot be queried and cannot be used in <code>EntityManager</code> or <code>Query</code> operations.
You must use entity subclasses of the mapped superclass in <code>EntityManager</code> or <code>Query</code> operations.
Mapped superclasses can&#8217;t be targets of entity relationships.
Mapped superclasses can be abstract or concrete.</p>
</div>
<div class="paragraph">
<p>Mapped superclasses do not have any corresponding tables in the underlying datastore.
Entities that inherit from the mapped superclass define the table mappings.
For instance, in the preceding code sample, the underlying tables would be <code>FULLTIMEEMPLOYEE</code> and <code>PARTTIMEEMPLOYEE</code>, but there is no <code>EMPLOYEE</code> table.</p>
</div>
</div>
<div class="sect3">
<h4 id="non-entity-superclasses"><a class="anchor" href="#non-entity-superclasses"></a>Non-Entity Superclasses</h4>
<div class="paragraph">
<p>Entities may have non-entity superclasses, and these superclasses can be either abstract or concrete.
The state of non-entity superclasses is nonpersistent, and any state inherited from the non-entity superclass by an entity class is nonpersistent.
Non-entity superclasses may not be used in <code>EntityManager</code> or <code>Query</code> operations.
Any mapping or relationship annotations in non-entity superclasses are ignored.</p>
</div>
</div>
<div class="sect3">
<h4 id="entity-inheritance-mapping-strategies"><a class="anchor" href="#entity-inheritance-mapping-strategies"></a>Entity Inheritance Mapping Strategies</h4>
<div class="paragraph">
<p>You can configure how the Jakarta Persistence provider maps inherited entities to the underlying datastore by decorating the root class of the hierarchy with the annotation <code>jakarta.persistence.Inheritance</code>.
The following mapping strategies are used to map the entity data to the underlying database:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A single table per class hierarchy</p>
</li>
<li>
<p>A table per concrete entity class</p>
</li>
<li>
<p>A "join" strategy, whereby fields or properties that are specific to a subclass are mapped to a different table than the fields or properties that are common to the parent class</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The strategy is configured by setting the <code>strategy</code> element of <code>@Inheritance</code> to one of the options defined in the <code>jakarta.persistence.InheritanceType</code> enumerated type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">enum</span> InheritanceType {
    SINGLE_TABLE,
    JOINED,
    TABLE_PER_CLASS
};</code></pre>
</div>
</div>
<div class="paragraph">
<p>The default strategy, <code>InheritanceType.SINGLE_TABLE</code>, is used if the <code>@Inheritance</code> annotation is not specified on the root class of the entity hierarchy.</p>
</div>
<div class="sect4">
<h5 id="the-single-table-per-class-hierarchy-strategy"><a class="anchor" href="#the-single-table-per-class-hierarchy-strategy"></a>The Single Table per Class Hierarchy Strategy</h5>
<div class="paragraph">
<p>With this strategy, which corresponds to the default <code>InheritanceType.SINGLE_TABLE</code>, all classes in the hierarchy are mapped to a single table in the database.
This table has a discriminator column containing a value that identifies the subclass to which the instance represented by the row belongs.</p>
</div>
<div class="paragraph">
<p>The discriminator column, whose elements are shown in <a href="#discriminator-column-elements">Table 40-2</a>, can be specified by using the <code>jakarta.persistence.DiscriminatorColumn</code> annotation on the root of the entity class hierarchy.</p>
</div>
<table id="discriminator-column-elements" class="tableblock frame-all grid-all" style="width: 99%;">
<caption class="title">Table 40-2 @DiscriminatorColumn Elements</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the column to be used as the discriminator column.
The default is <code>DTYPE</code>.
This element is optional.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DiscriminatorType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>discriminatorType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The type of the column to be used as a discriminator column.
The default is <code>DiscriminatorType.STRING</code>.
This element is optional.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>columnDefinition</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The SQL fragment to use when creating the discriminator column.
The default is generated by the Persistence provider and is implementation-specific.
This element is optional.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>length</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The column length for <code>String</code>-based discriminator types.
This element is ignored for non-<code>String</code> discriminator types.
The default is 31.
This element is optional.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <code>jakarta.persistence.DiscriminatorType</code> enumerated type is used to set the type of the discriminator column in the database by setting the <code>discriminatorType</code> element of <code>@DiscriminatorColumn</code> to one of the defined types.
<code>DiscriminatorType</code> is defined as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">enum</span> DiscriminatorType {
    STRING,
    CHAR,
    INTEGER
};</code></pre>
</div>
</div>
<div class="paragraph">
<p>If <code>@DiscriminatorColumn</code> is not specified on the root of the entity hierarchy and a discriminator column is required, the Persistence provider assumes a default column name of <code>DTYPE</code> and column type of <code>DiscriminatorType.STRING</code>.</p>
</div>
<div class="paragraph">
<p>The <code>jakarta.persistence.DiscriminatorValue</code> annotation may be used to set the value entered into the discriminator column for each entity in a class hierarchy.
You may decorate only concrete entity classes with <code>@DiscriminatorValue</code>.</p>
</div>
<div class="paragraph">
<p>If <code>@DiscriminatorValue</code> is not specified on an entity in a class hierarchy that uses a discriminator column, the Persistence provider will provide a default, implementation-specific value.
If the <code>discriminatorType</code> element of <code>@DiscriminatorColumn</code> is <code>DiscriminatorType.STRING</code>, the default value is the name of the entity.</p>
</div>
<div class="paragraph">
<p>This strategy provides good support for polymorphic relationships between entities and queries that cover the entire entity class hierarchy.
However, this strategy requires the columns that contain the state of subclasses to be nullable.</p>
</div>
</div>
<div class="sect4">
<h5 id="the-table-per-concrete-class-strategy"><a class="anchor" href="#the-table-per-concrete-class-strategy"></a>The Table per Concrete Class Strategy</h5>
<div class="paragraph">
<p>In this strategy, which corresponds to <code>InheritanceType.TABLE_PER_CLASS</code>, each concrete class is mapped to a separate table in the database.
All fields or properties in the class, including inherited fields or properties, are mapped to columns in the class&#8217;s table in the database.</p>
</div>
<div class="paragraph">
<p>This strategy provides poor support for polymorphic relationships and usually requires either SQL <code>UNION</code> queries or separate SQL queries for each subclass for queries that cover the entire entity class hierarchy.</p>
</div>
<div class="paragraph">
<p>Support for this strategy is optional and may not be supported by all Jakarta Persistence providers.
The default Jakarta Persistence provider in GlassFish Server does not support this strategy.</p>
</div>
</div>
<div class="sect4">
<h5 id="the-joined-subclass-strategy"><a class="anchor" href="#the-joined-subclass-strategy"></a>The Joined Subclass Strategy</h5>
<div class="paragraph">
<p>In this strategy, which corresponds to <code>InheritanceType.JOINED</code>, the root of the class hierarchy is represented by a single table, and each subclass has a separate table that contains only those fields specific to that subclass.
That is, the subclass table does not contain columns for inherited fields or properties.
The subclass table also has a column or columns that represent its primary key, which is a foreign key to the primary key of the superclass table.</p>
</div>
<div class="paragraph">
<p>This strategy provides good support for polymorphic relationships but requires one or more join operations to be performed when instantiating entity subclasses.
This may result in poor performance for extensive class hierarchies.
Similarly, queries that cover the entire class hierarchy require join operations between the subclass tables, resulting in decreased performance.</p>
</div>
<div class="paragraph">
<p>Some Jakarta Persistence providers, including the default provider in GlassFish Server, require a discriminator column that corresponds to the root entity when using the joined subclass strategy.
If you are not using automatic table creation in your application, make sure that the database table is set up correctly for the discriminator column defaults, or use the <code>@DiscriminatorColumn</code> annotation to match your database schema.
For information on discriminator columns, see <a href="#the-single-table-per-class-hierarchy-strategy">The Single Table per Class Hierarchy Strategy</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="managing-entities"><a class="anchor" href="#managing-entities"></a>Managing Entities</h3>
<div class="paragraph">
<p>Entities are managed by the entity manager, which is represented by <code>jakarta.persistence.EntityManager</code> instances.
Each <code>EntityManager</code> instance is associated with a persistence context: a set of managed entity instances that exist in a particular data store.
A persistence context defines the scope under which particular entity instances are created, persisted, and removed.
The <code>EntityManager</code> interface defines the methods that are used to interact with the persistence context.</p>
</div>
<div class="sect3">
<h4 id="the-entitymanager-interface"><a class="anchor" href="#the-entitymanager-interface"></a>The EntityManager Interface</h4>
<div class="paragraph">
<p>The <code>EntityManager</code> API creates and removes persistent entity instances, finds entities by the entity&#8217;s primary key, and allows queries to be run on entities.</p>
</div>
<div class="sect4">
<h5 id="container-managed-entity-managers"><a class="anchor" href="#container-managed-entity-managers"></a>Container-Managed Entity Managers</h5>
<div class="paragraph">
<p>With a container-managed entity manager, an <code>EntityManager</code> instance&#8217;s persistence context is automatically propagated by the container to all application components that use the <code>EntityManager</code> instance within a single Jakarta transaction.</p>
</div>
<div class="paragraph">
<p>Jakarta transactions usually involve calls across application components.
To complete a Jakarta transaction, these components usually need access to a single persistence context.
This occurs when an <code>EntityManager</code> is injected into the application components by means of the <code>jakarta.persistence.PersistenceContext</code> annotation.
The persistence context is automatically propagated with the current Jakarta transaction, and <code>EntityManager</code> references that are mapped to the same persistence unit provide access to the persistence context within that transaction.
By automatically propagating the persistence context, application components don&#8217;t need to pass references to <code>EntityManager</code> instances to each other in order to make changes within a single transaction.
The Jakarta EE container manages the lifecycle of container-managed entity managers.</p>
</div>
<div class="paragraph">
<p>To obtain an <code>EntityManager</code> instance, inject the entity manager into the application component:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@PersistenceContext</span>
EntityManager em;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="application-managed-entity-managers"><a class="anchor" href="#application-managed-entity-managers"></a>Application-Managed Entity Managers</h5>
<div class="paragraph">
<p>With an application-managed entity manager, on the other hand, the persistence context is not propagated to application components, and the lifecycle of <code>EntityManager</code> instances is managed by the application.</p>
</div>
<div class="paragraph">
<p>Application-managed entity managers are used when applications need to access a persistence context that is not propagated with the Jakarta transaction across <code>EntityManager</code> instances in a particular persistence unit.
In this case, each <code>EntityManager</code> creates a new, isolated persistence context.
The <code>EntityManager</code> and its associated persistence context are created and destroyed explicitly by the application.
They are also used when directly injecting <code>EntityManager</code> instances can&#8217;t be done because <code>EntityManager</code> instances are not thread-safe.
<code>EntityManagerFactory</code> instances are thread-safe.</p>
</div>
<div class="paragraph">
<p>Applications create <code>EntityManager</code> instances in this case by using the <code>createEntityManager</code> method of <code>jakarta.persistence.EntityManagerFactory</code>.</p>
</div>
<div class="paragraph">
<p>To obtain an <code>EntityManager</code> instance, you first must obtain an <code>EntityManagerFactory</code> instance by injecting it into the application component by means of the <code>jakarta.persistence.PersistenceUnit</code> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@PersistenceUnit</span>
EntityManagerFactory emf;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then obtain an <code>EntityManager</code> from the <code>EntityManagerFactory</code> instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">EntityManager em = emf.createEntityManager();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Application-managed entity managers don&#8217;t automatically propagate the Jakarta transaction context.
Such applications need to manually gain access to the Jakarta transaction manager and add transaction demarcation information when performing entity operations.
The <code>jakarta.transaction.UserTransaction</code> interface defines methods to begin, commit, and roll back transactions.
Inject an instance of <code>UserTransaction</code> by creating an instance variable annotated with <code>@Resource</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Resource</span>
UserTransaction utx;</code></pre>
</div>
</div>
<div class="paragraph">
<p>To begin a transaction, call the <code>UserTransaction.begin</code> method.
When all the entity operations are complete, call the <code>UserTransaction.commit</code> method to commit the transaction.
The <code>UserTransaction.rollback</code> method is used to roll back the current transaction.</p>
</div>
<div class="paragraph">
<p>The following example shows how to manage transactions in an application that uses an application-managed entity manager:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@PersistenceUnit</span>
EntityManagerFactory emf;
EntityManager em;
<span class="annotation">@Resource</span>
UserTransaction utx;
...
em = emf.createEntityManager();
<span class="keyword">try</span> {
    utx.begin();
    em.persist(SomeEntity);
    em.merge(AnotherEntity);
    em.remove(ThirdEntity);
    utx.commit();
} <span class="keyword">catch</span> (<span class="exception">Exception</span> e) {
    utx.rollback();
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="finding-entities-using-the-entitymanager"><a class="anchor" href="#finding-entities-using-the-entitymanager"></a>Finding Entities Using the EntityManager</h5>
<div class="paragraph">
<p>The <code>EntityManager.find</code> method is used to look up entities in the data store by the entity&#8217;s primary key:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@PersistenceContext</span>
EntityManager em;
<span class="directive">public</span> <span class="type">void</span> enterOrder(<span class="type">int</span> custID, CustomerOrder newOrder) {
    Customer cust = em.find(Customer.class, custID);
    cust.getOrders().add(newOrder);
    newOrder.setCustomer(cust);
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="managing-an-entity-instances-lifecycle"><a class="anchor" href="#managing-an-entity-instances-lifecycle"></a>Managing an Entity Instance&#8217;s Lifecycle</h5>
<div class="paragraph">
<p>You manage entity instances by invoking operations on the entity by means of an <code>EntityManager</code> instance.
Entity instances are in one of four states: new, managed, detached, or removed.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>New entity instances have no persistent identity and are not yet associated with a persistence context.</p>
</li>
<li>
<p>Managed entity instances have a persistent identity and are associated with a persistence context.</p>
</li>
<li>
<p>Detached entity instances have a persistent identity and are not currently associated with a persistence context.</p>
</li>
<li>
<p>Removed entity instances have a persistent identity, are associated with a persistent context, and are scheduled for removal from the data store.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="persisting-entity-instances"><a class="anchor" href="#persisting-entity-instances"></a>Persisting Entity Instances</h5>
<div class="paragraph">
<p>New entity instances become managed and persistent either by invoking the <code>persist</code> method or by a cascading <code>persist</code> operation invoked from related entities that have the <code>cascade=PERSIST</code> or <code>cascade=ALL</code> elements set in the relationship annotation.
This means that the entity&#8217;s data is stored to the database when the transaction associated with the <code>persist</code> operation is completed.
If the entity is already managed, the <code>persist</code> operation is ignored, although the <code>persist</code> operation will cascade to related entities that have the <code>cascade</code> element set to <code>PERSIST</code> or <code>ALL</code> in the relationship annotation.
If <code>persist</code> is called on a removed entity instance, the entity becomes managed.
If the entity is detached, either <code>persist</code> will throw an <code>IllegalArgumentException</code>, or the transaction commit will fail.
The following method performs a <code>persist</code> operation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@PersistenceContext</span>
EntityManager em;
...
public LineItem createLineItem(CustomerOrder order, Product product,
        <span class="type">int</span> quantity) {
    LineItem li = <span class="keyword">new</span> LineItem(order, product, quantity);
    order.getLineItems().add(li);
    em.persist(li);
    <span class="keyword">return</span> li;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>persist</code> operation is propagated to all entities related to the calling entity that have the <code>cascade</code> element set to <code>ALL</code> or <code>PERSIST</code> in the relationship annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@OneToMany</span>(cascade=ALL, mappedBy=<span class="string"><span class="delimiter">&quot;</span><span class="content">order</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="predefined-type">Collection</span>&lt;LineItem&gt; getLineItems() {
    <span class="keyword">return</span> lineItems;
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="removing-entity-instances"><a class="anchor" href="#removing-entity-instances"></a>Removing Entity Instances</h5>
<div class="paragraph">
<p>Managed entity instances are removed by invoking the <code>remove</code> method or by a cascading <code>remove</code> operation invoked from related entities that have the <code>cascade=REMOVE</code> or <code>cascade=ALL</code> elements set in the relationship annotation.
If the <code>remove</code> method is invoked on a new entity, the <code>remove</code> operation is ignored, although <code>remove</code> will cascade to related entities that have the <code>cascade</code> element set to <code>REMOVE</code> or <code>ALL</code> in the relationship annotation.
If <code>remove</code> is invoked on a detached entity, either <code>remove</code> will throw an <code>IllegalArgumentException</code>, or the transaction commit will fail.
If invoked on an already removed entity, <code>remove</code> will be ignored.
The entity&#8217;s data will be removed from the data store when the transaction is completed or as a result of the <code>flush</code> operation.</p>
</div>
<div class="paragraph">
<p>In the following example, all <code>LineItem</code> entities associated with the order are also removed, as <code>CustomerOrder.getLineItems</code> has <code>cascade=ALL</code> set in the relationship annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">void</span> removeOrder(<span class="predefined-type">Integer</span> orderId) {
    <span class="keyword">try</span> {
        CustomerOrder order = em.find(CustomerOrder.class, orderId);
        em.remove(order);
    }...
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="synchronizing-entity-data-to-the-database"><a class="anchor" href="#synchronizing-entity-data-to-the-database"></a>Synchronizing Entity Data to the Database</h5>
<div class="paragraph">
<p>The state of persistent entities is synchronized to the database when the transaction with which the entity is associated commits.
If a managed entity is in a bidirectional relationship with another managed entity, the data will be persisted, based on the owning side of the relationship.</p>
</div>
<div class="paragraph">
<p>To force synchronization of the managed entity to the data store, invoke the <code>flush</code> method of the <code>EntityManager</code> instance.
If the entity is related to another entity and the relationship annotation has the <code>cascade</code> element set to <code>PERSIST</code> or <code>ALL</code>, the related entity&#8217;s data will be synchronized with the data store when <code>flush</code> is called.</p>
</div>
<div class="paragraph">
<p>If the entity is removed, calling <code>flush</code> will remove the entity data from the data store.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="persistence-units"><a class="anchor" href="#persistence-units"></a>Persistence Units</h4>
<div class="paragraph">
<p>A persistence unit defines a set of all entity classes that are managed by <code>EntityManager</code> instances in an application.
This set of entity classes represents the data contained within a single data store.</p>
</div>
<div class="paragraph">
<p>Persistence units are defined by the <code>persistence.xml</code> configuration file.
The following is an example <code>persistence.xml</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;persistence&gt;</span>
    <span class="tag">&lt;persistence-unit</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">OrderManagement</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;description&gt;</span>This unit manages orders and customers.
            It does not rely on any vendor-specific features and can
            therefore be deployed to any persistence provider.
        <span class="tag">&lt;/description&gt;</span>
        <span class="tag">&lt;jta-data-source&gt;</span>jdbc/MyOrderDB<span class="tag">&lt;/jta-data-source&gt;</span>
        <span class="tag">&lt;jar-file&gt;</span>MyOrderApp.jar<span class="tag">&lt;/jar-file&gt;</span>
        <span class="tag">&lt;class&gt;</span>com.widgets.CustomerOrder<span class="tag">&lt;/class&gt;</span>
        <span class="tag">&lt;class&gt;</span>com.widgets.Customer<span class="tag">&lt;/class&gt;</span>
    <span class="tag">&lt;/persistence-unit&gt;</span>
<span class="tag">&lt;/persistence&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This file defines a persistence unit named <code>OrderManagement</code>, which uses a Jakarta Transactions aware data source, <code>jdbc/MyOrderDB</code>.
The <code>jar-file</code> and <code>class</code> elements specify managed persistence classes: entity classes, embeddable classes, and mapped superclasses.
The <code>jar-file</code> element specifies JAR files that are visible to the packaged persistence unit that contain managed persistence classes, whereas the <code>class</code> element explicitly names managed persistence classes.</p>
</div>
<div class="paragraph">
<p>The <code>jta-data-source</code> (for Jakarta Transactions aware data sources) and <code>non-jta-data-source</code> (for non Jakarta Transactions aware data sources) elements specify the global JNDI name of the data source to be used by the container.</p>
</div>
<div class="paragraph">
<p>The JAR file or directory whose <code>META-INF</code> directory contains <code>persistence.xml</code> is called the root of the persistence unit.
The scope of the persistence unit is determined by the persistence unit&#8217;s root.
Each persistence unit must be identified with a name that is unique to the persistence unit&#8217;s scope.</p>
</div>
<div class="paragraph">
<p>Persistent units can be packaged as part of a WAR or enterprise bean JAR file or can be packaged as a JAR file that can then be included in an WAR or EAR file.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If you package the persistent unit as a set of classes in an enterprise bean JAR file, <code>persistence.xml</code> should be put in the enterprise bean JAR&#8217;s <code>META-INF</code> directory.</p>
</li>
<li>
<p>If you package the persistence unit as a set of classes in a WAR file, <code>persistence.xml</code> should be located in the WAR file&#8217;s <code>WEB-INF/classes/META-INF</code> directory.</p>
</li>
<li>
<p>If you package the persistence unit in a JAR file that will be included in a WAR or EAR file, the JAR file should be located in either</p>
<div class="ulist">
<ul>
<li>
<p>The <code>WEB-INF/lib</code> directory of a WAR</p>
</li>
<li>
<p>Or the EAR file&#8217;s library directory</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In the Java Persistence API 1.0, JAR files could be located at the root of an EAR file as the root of the persistence unit.
This is no longer supported.
Portable applications should use the EAR file&#8217;s library directory as the root of the persistence unit.
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="querying-entities"><a class="anchor" href="#querying-entities"></a>Querying Entities</h3>
<div class="paragraph">
<p>Jakarta Persistence provides the following methods for querying entities.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The Jakarta Persistence query language (JPQL) is a simple, string-based language similar to SQL used to query entities and their relationships.
See <a href="#the-jakarta-persistence-query-language">Chapter 42, <em>The Jakarta Persistence Query Language</em></a> for more information.</p>
</li>
<li>
<p>The Criteria API is used to create typesafe queries using Java programming language APIs to query for entities and their relationships.
See <a href="#using-the-criteria-api-to-create-queries">Chapter 43, <em>Using the Criteria API to Create Queries</em></a> for more information.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Both JPQL and the Criteria API have advantages and disadvantages.</p>
</div>
<div class="paragraph">
<p>Just a few lines long, JPQL queries are typically more concise and more readable than Criteria queries.
Developers familiar with SQL will find it easy to learn the syntax of JPQL.
JPQL named queries can be defined in the entity class using a Java programming language annotation or in the application&#8217;s deployment descriptor.
JPQL queries are not typesafe, however, and require a cast when retrieving the query result from the entity manager.
This means that type-casting errors may not be caught at compile time.
JPQL queries don&#8217;t support open-ended parameters.</p>
</div>
<div class="paragraph">
<p>Criteria queries allow you to define the query in the business tier of the application.
Although this is also possible using JPQL dynamic queries, Criteria queries provide better performance because JPQL dynamic queries must be parsed each time they are called.
Criteria queries are typesafe and therefore don&#8217;t require casting, as JPQL queries do.
The Criteria API is just another Java programming language API and doesn&#8217;t require developers to learn the syntax of another query language.
Criteria queries are typically more verbose than JPQL queries and require the developer to create several objects and perform operations on those objects before submitting the query to the entity manager.</p>
</div>
</div>
<div class="sect2">
<h3 id="database-schema-creation"><a class="anchor" href="#database-schema-creation"></a>Database Schema Creation</h3>
<div class="paragraph">
<p>The persistence provider can be configured to automatically create the database tables, load data into the tables, and remove the tables during application deployment using standard properties in the application&#8217;s deployment descriptor.
These tasks are typically used during the development phase of a release, not against a production database.</p>
</div>
<div class="paragraph">
<p>The following is an example of a <code>persistence.xml</code> deployment descriptor that specifies that the provider should drop all database artifacts using a provided script, create the artifacts with a provided script, and load data from a provided script when the application is deployed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;persistence</span> <span class="attribute-name">version</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">3.0</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">https://jakarta.ee/xml/ns/persistence</span><span class="delimiter">&quot;</span></span>
 <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
 <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">https://jakarta.ee/xml/ns/persistence</span>
 <span class="content">https://jakarta.ee/xml/ns/persistence/persistence_3_0.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;persistence-unit</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">examplePU</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">transaction-type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">JTA</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;jta-data-source&gt;</span>java:global/ExampleDataSource<span class="tag">&lt;/jta-data-source&gt;</span>
    <span class="tag">&lt;properties&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakarta.persistence.schema-generation.database.action</span><span class="delimiter">&quot;</span></span>
                  <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">drop-and-create</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakarta.persistence.schema-generation.create-source</span><span class="delimiter">&quot;</span></span>
                  <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">script</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakarta.persistence.schema-generation.create-script-source</span><span class="delimiter">&quot;</span></span>
                  <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">META-INF/sql/create.sql</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakarta.persistence.sql-load-script-source</span><span class="delimiter">&quot;</span></span>
                  <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">META-INF/sql/data.sql</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakarta.persistence.schema-generation.drop-source</span><span class="delimiter">&quot;</span></span>
                  <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">script</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakarta.persistence.schema-generation.drop-script-source</span><span class="delimiter">&quot;</span></span>
                  <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">META-INF/sql/drop.sql</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;/properties&gt;</span>
  <span class="tag">&lt;/persistence-unit&gt;</span>
<span class="tag">&lt;/persistence&gt;</span></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="configuring-an-application-to-create-or-drop-database-tables"><a class="anchor" href="#configuring-an-application-to-create-or-drop-database-tables"></a>Configuring an Application to Create or Drop Database Tables</h4>
<div class="paragraph">
<p>The <code>jakarta.persistence.schema-generation.database.action</code> property is used to specify the action taken by the persistence provider when an application is deployed.
If the property is not set, the persistence provider will not create or drop any database artifacts.</p>
</div>
<table id="schema-creation-actions" class="tableblock frame-all grid-all" style="width: 75%;">
<caption class="title">Table 40-3 Schema Creation Actions</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Setting</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>none</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No schema creation or deletion will take place.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>create</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The provider will create the database artifacts on application deployment.
The artifacts will remain unchanged after application redeployment.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>drop-and-create</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any artifacts in the database will be deleted, and the provider will create the database artifacts on deployment.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>drop</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any artifacts in the database will be deleted on application deployment.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In this example, the persistence provider will delete any remaining database artifacts and then create the artifacts when the application is deployed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakarta.persistence.schema-generation.database.action</span><span class="delimiter">&quot;</span></span>
           <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">drop-and-create</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, the object/relational metadata in the persistence unit is used to create the database artifacts.
You may also supply scripts used by the provider to create and delete the database artifacts.
The <code>jakarta.persistence.schema-generation.create-source</code> and <code>jakarta.persistence.schema-generation.drop-source</code> properties control how the provider will create or delete the database artifacts.</p>
</div>
<table id="settings-for-create-and-delete-source-properties" class="tableblock frame-all grid-all" style="width: 75%;">
<caption class="title">Table 40-4 Settings for Create and Delete Source Properties</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Setting</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>metadata</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use the object/relational metadata in the application to create or delete the database artifacts.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>script</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use a provided script for creating or deleting the database artifacts.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>metadata-then-script</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use a combination of object/relational metadata, then a user-provided script to create or delete the database artifacts.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>script-then-metadata</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use a combination of a user-provided script, then the object/relational metadata to create and delete the database artifacts.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In this example, the persistence provider will use a script packaged within the application to create the database artifacts:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakarta.persistence.schema-generation.create-source</span><span class="delimiter">&quot;</span></span>
           <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">script</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you specify a script in <code>create-source</code> or <code>drop-source</code>, specify the location of the script using the <code>jakarta.persistence.schema-generation.create-script-source</code> or <code>jakarta.persistence.schema-generation.drop-script-source</code> property.
The location of the script is relative to the root of the persistence unit:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakarta.persistence.schema-generation.create-script-source</span><span class="delimiter">&quot;</span></span>
           <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">META-INF/sql/create.sql</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example, the <code>create-script-source</code> is set to a SQL file called <code>create.sql</code> in the <code>META-INF/sql</code> directory relative to root of the persistence unit.</p>
</div>
</div>
<div class="sect3">
<h4 id="loading-data-using-sql-scripts"><a class="anchor" href="#loading-data-using-sql-scripts"></a>Loading Data Using SQL Scripts</h4>
<div class="paragraph">
<p>If you want to populate the database tables with data before the application loads, specify the location of a load script in the <code>jakarta.persistence.sql-load-script-source property</code>.
The location specified in this property is relative to the root of the persistence unit.</p>
</div>
<div class="paragraph">
<p>In this example, the load script is a file called <code>data.sql</code> in the <code>META-INF/sql</code> directory relative to the root of the persistence unit:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakarta.persistence.sql-load-script-source</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">META-INF/sql/data.sql</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="further-information-about-persistence"><a class="anchor" href="#further-information-about-persistence"></a>Further Information about Persistence</h3>
<div class="paragraph">
<p>For more information about Jakarta Persistence, see</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Jakarta Persistence 3.0 API specification:<br>
<a href="https://jakarta.ee/specifications/persistence/3.0/" class="bare" target="_blank" rel="noopener">https://jakarta.ee/specifications/persistence/3.0/</a></p>
</li>
<li>
<p>EclipseLink, the Jakarta Persistence implementation in GlassFish Server:<br>
<a href="https://www.eclipse.org/eclipselink/" class="bare" target="_blank" rel="noopener">https://www.eclipse.org/eclipselink/</a></p>
</li>
<li>
<p>EclipseLink wiki documentation:<br>
<a href="https://wiki.eclipse.org/EclipseLink" class="bare" target="_blank" rel="noopener">https://wiki.eclipse.org/EclipseLink</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="running-the-persistence-examples"><a class="anchor" href="#running-the-persistence-examples"></a>Chapter 41. Running the Persistence Examples</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter explains how to use Jakarta Persistence.
The material here focuses on the source code and settings of three examples.</p>
</div>
<div class="sect2">
<h3 id="overview-of-the-persistence-examples"><a class="anchor" href="#overview-of-the-persistence-examples"></a>Overview of the Persistence Examples</h3>
<div class="paragraph">
<p>The first example, <code>order</code>, is an application that uses a stateful session bean to manage entities related to an ordering system.
The second example, <code>roster</code>, is an application that manages a community sports system.
The third example, <code>address-book</code>, is a web application that stores contact data.
This chapter assumes that you are familiar with the concepts detailed in <a href="#introduction-to-jakarta-persistence">Introduction to Jakarta Persistence</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="the-order-application"><a class="anchor" href="#the-order-application"></a>The order Application</h3>
<div class="paragraph">
<p>The <code>order</code> application is a simple inventory and ordering application for maintaining a catalog of parts and placing an itemized order of those parts.
The application has entities that represent parts, vendors, orders, and line items.
These entities are accessed using a stateful session bean that holds the business logic of the application.
A simple singleton session bean creates the initial entities on application deployment.
A Facelets web application manipulates the data and displays data from the catalog.</p>
</div>
<div class="paragraph">
<p>The information contained in an order can be divided into elements.
What is the order number? What parts are included in the order? What parts make up that part? Who makes the part? What are the specifications for the part? Are there any schematics for the part? The <code>order</code> application is a simplified version of an ordering system that has all these elements.</p>
</div>
<div class="paragraph">
<p>The <code>order</code> application consists of a single WAR module that includes the enterprise bean classes, the entities, the support classes, and the Facelets XHTML and class files.</p>
</div>
<div class="paragraph">
<p>The database schema in the Derby database for <code>order</code> is shown in <a href="#database-schema-for-the-order-application">Figure 41-1</a>.</p>
</div>
<div id="database-schema-for-the-order-application" class="imageblock">
<div class="content">
<img src="images/jakartaeett_dt_024.svg" alt="Diagram showing the database schema for the order application">
</div>
<div class="title">Figure 41-1 Database Schema for the order Application</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In this diagram, for simplicity, the <code>PERSISTENCE_ORDER_</code> prefix is omitted from the table names.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="entity-relationships-in-the-order-application"><a class="anchor" href="#entity-relationships-in-the-order-application"></a>Entity Relationships in the order Application</h4>
<div class="paragraph">
<p>The <code>order</code> application demonstrates several types of entity relationships: self-referential, one-to-one, one-to-many, many-to-one, and unidirectional relationships.</p>
</div>
<div class="sect4">
<h5 id="self-referential-relationships"><a class="anchor" href="#self-referential-relationships"></a>Self-Referential Relationships</h5>
<div class="paragraph">
<p>A self-referential relationship occurs between relationship fields in the same entity.
<code>Part</code> has a field, <code>bomPart</code>, which has a one-to-many relationship with the field <code>parts</code>, which is also in <code>Part</code>.
That is, a part can be made up of many parts, and each of those parts has exactly one bill-of-material part.</p>
</div>
<div class="paragraph">
<p>The primary key for <code>Part</code> is a compound primary key, a combination of the <code>partNumber</code> and <code>revision</code> fields.
This key is mapped to the <code>PARTNUMBER</code> and <code>REVISION</code> columns in the <code>PERSISTENCE_ORDER_PART</code> table:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">...
<span class="annotation">@ManyToOne</span>
<span class="annotation">@JoinColumns</span>({
    <span class="annotation">@JoinColumn</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">BOMPARTNUMBER</span><span class="delimiter">&quot;</span></span>, referencedColumnName=<span class="string"><span class="delimiter">&quot;</span><span class="content">PARTNUMBER</span><span class="delimiter">&quot;</span></span>),
    <span class="annotation">@JoinColumn</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">BOMREVISION</span><span class="delimiter">&quot;</span></span>, referencedColumnName=<span class="string"><span class="delimiter">&quot;</span><span class="content">REVISION</span><span class="delimiter">&quot;</span></span>)
})
<span class="directive">public</span> Part getBomPart() {
    <span class="keyword">return</span> bomPart;
}
...
<span class="annotation">@OneToMany</span>(mappedBy=<span class="string"><span class="delimiter">&quot;</span><span class="content">bomPart</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="predefined-type">Collection</span>&lt;Part&gt; getParts() {
    <span class="keyword">return</span> parts;
}
...</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="one-to-one-relationships"><a class="anchor" href="#one-to-one-relationships"></a>One-to-One Relationships</h5>
<div class="paragraph">
<p><code>Part</code> has a field, <code>vendorPart</code>, that has a one-to-one relationship with <code>VendorPart</code>'s <code>part</code> field.
That is, each part has exactly one vendor part, and vice versa.</p>
</div>
<div class="paragraph">
<p>Here is the relationship mapping in <code>Part</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@OneToOne</span>(mappedBy=<span class="string"><span class="delimiter">&quot;</span><span class="content">part</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> VendorPart getVendorPart() {
    <span class="keyword">return</span> vendorPart;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is the relationship mapping in <code>VendorPart</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@OneToOne</span>
<span class="annotation">@JoinColumns</span>({
    <span class="annotation">@JoinColumn</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">PARTNUMBER</span><span class="delimiter">&quot;</span></span>, referencedColumnName=<span class="string"><span class="delimiter">&quot;</span><span class="content">PARTNUMBER</span><span class="delimiter">&quot;</span></span>),
    <span class="annotation">@JoinColumn</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">PARTREVISION</span><span class="delimiter">&quot;</span></span>, referencedColumnName=<span class="string"><span class="delimiter">&quot;</span><span class="content">REVISION</span><span class="delimiter">&quot;</span></span>)
})
<span class="directive">public</span> Part getPart() {
    <span class="keyword">return</span> part;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that, because <code>Part</code> uses a compound primary key, the <code>@JoinColumns</code> annotation is used to map the columns in the <code>PERSISTENCE_ORDER_VENDOR_PART</code> table to the columns in <code>PERSISTENCE_ORDER_PART</code>.
The <code>PERSISTENCE_ORDER_VENDOR_PART</code> table&#8217;s <code>PARTREVISION</code> column refers to <code>PERSISTENCE_ORDER_PART</code>'s <code>REVISION</code> column.</p>
</div>
</div>
<div class="sect4">
<h5 id="one-to-many-relationship-mapped-to-overlapping-primary-and-foreign-keys"><a class="anchor" href="#one-to-many-relationship-mapped-to-overlapping-primary-and-foreign-keys"></a>One-to-Many Relationship Mapped to Overlapping Primary and Foreign Keys</h5>
<div class="paragraph">
<p><code>CustomerOrder</code> has a field, <code>lineItems</code>, that has a one-to-many relationship with <code>LineItem</code>'s field <code>customerOrder</code>.
That is, each order has one or more line item.</p>
</div>
<div class="paragraph">
<p><code>LineItem</code> uses a compound primary key that is made up of the <code>orderId</code> and <code>itemId</code> fields.
This compound primary key maps to the <code>ORDERID</code> and <code>ITEMID</code> columns in the <code>PERSISTENCE_ORDER_LINEITEM</code> table.
<code>ORDERID</code> is a foreign key to the <code>ORDERID</code> column in the <code>PERSISTENCE_ORDER_CUSTOMERORDER</code> table.
This means that the <code>ORDERID</code> column is mapped twice: once as a primary key field, <code>orderId</code>; and again as a relationship field, <code>order</code>.</p>
</div>
<div class="paragraph">
<p>Here is the relationship mapping in <code>CustomerOrder</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@OneToMany</span>(cascade=ALL, mappedBy=<span class="string"><span class="delimiter">&quot;</span><span class="content">customerOrder</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="predefined-type">Collection</span>&lt;LineItem&gt; getLineItems() {
    <span class="keyword">return</span> lineItems;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is the relationship mapping in <code>LineItem</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Id</span>
<span class="annotation">@ManyToOne</span>
<span class="annotation">@JoinColumn</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">ORDERID</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> CustomerOrder getCustomerOrder() {
    <span class="keyword">return</span> customerOrder;
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="unidirectional-relationships-2"><a class="anchor" href="#unidirectional-relationships-2"></a>Unidirectional Relationships</h5>
<div class="paragraph">
<p><code>LineItem</code> has a field, <code>vendorPart</code>, that has a unidirectional many-to-one relationship with <code>VendorPart</code>.
That is, there is no field in the target entity in this relationship:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@JoinColumn</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">VENDORPARTNUMBER</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@ManyToOne</span>
<span class="directive">public</span> VendorPart getVendorPart() {
    <span class="keyword">return</span> vendorPart;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="primary-keys-in-the-order-application"><a class="anchor" href="#primary-keys-in-the-order-application"></a>Primary Keys in the order Application</h4>
<div class="paragraph">
<p>The <code>order</code> application uses several types of primary keys: single-valued primary keys, generated primary keys, and compound primary keys.</p>
</div>
<div class="sect4">
<h5 id="generated-primary-keys"><a class="anchor" href="#generated-primary-keys"></a>Generated Primary Keys</h5>
<div class="paragraph">
<p><code>VendorPart</code> uses a generated primary key value.
That is, the application does not assign primary key values for the entities but instead relies on the persistence provider to generate the primary key values.
The <code>@GeneratedValue</code> annotation is used to specify that an entity will use a generated primary key.</p>
</div>
<div class="paragraph">
<p>In <code>VendorPart</code>, the following code specifies the settings for generating primary key values:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@TableGenerator</span>(
    name=<span class="string"><span class="delimiter">&quot;</span><span class="content">vendorPartGen</span><span class="delimiter">&quot;</span></span>,
    table=<span class="string"><span class="delimiter">&quot;</span><span class="content">PERSISTENCE_ORDER_SEQUENCE_GENERATOR</span><span class="delimiter">&quot;</span></span>,
    pkColumnName=<span class="string"><span class="delimiter">&quot;</span><span class="content">GEN_KEY</span><span class="delimiter">&quot;</span></span>,
    valueColumnName=<span class="string"><span class="delimiter">&quot;</span><span class="content">GEN_VALUE</span><span class="delimiter">&quot;</span></span>,
    pkColumnValue=<span class="string"><span class="delimiter">&quot;</span><span class="content">VENDOR_PART_ID</span><span class="delimiter">&quot;</span></span>,
    allocationSize=<span class="integer">10</span>)
<span class="annotation">@Id</span>
<span class="annotation">@GeneratedValue</span>(strategy=GenerationType.TABLE, generator=<span class="string"><span class="delimiter">&quot;</span><span class="content">vendorPartGen</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="predefined-type">Long</span> getVendorPartNumber() {
    <span class="keyword">return</span> vendorPartNumber;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>@TableGenerator</code> annotation is used in conjunction with <code>@GeneratedValue</code>'s <code>strategy=TABLE</code> element.
That is, the strategy used to generate the primary keys is to use a table in the database.
The <code>@TableGenerator</code> annotation is used to configure the settings for the generator table.
The name element sets the name of the generator, which is <code>vendorPartGen</code> in <code>VendorPart</code>.</p>
</div>
<div class="paragraph">
<p>The <code>PERSISTENCE_ORDER_SEQUENCE_GENERATOR</code> table, whose two columns are <code>GEN_KEY</code> and <code>GEN_VALUE</code>, will store the generated primary key values.
This table could be used to generate other entities' primary keys, so the <code>pkColumnValue</code> element is set to <code>VENDOR_PART_ID</code> to distinguish this entity&#8217;s generated primary keys from other entities' generated primary keys.
The <code>allocationSize</code> element specifies the amount to increment when allocating primary key values.
In this case, each <code>VendorPart</code>'s primary key will increment by 10.</p>
</div>
<div class="paragraph">
<p>The primary key field <code>vendorPartNumber</code> is of type <code>Long</code>, as the generated primary key&#8217;s field must be an integral type.</p>
</div>
</div>
<div class="sect4">
<h5 id="compound-primary-keys"><a class="anchor" href="#compound-primary-keys"></a>Compound Primary Keys</h5>
<div class="paragraph">
<p>A compound primary key is made up of multiple fields and follows the requirements described in <a href="#primary-keys-in-entities">Primary Keys in Entities</a>.
To use a compound primary key, you must create a wrapper class.</p>
</div>
<div class="paragraph">
<p>In <code>order</code>, two entities use compound primary keys: <code>Part</code> and <code>LineItem</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Part</code> uses the <code>PartKey</code> wrapper class.
<code>Part</code>'s primary key is a combination of the part number and the revision number.
<code>PartKey</code> encapsulates this primary key.</p>
</li>
<li>
<p><code>LineItem</code> uses the <code>LineItemKey</code> class.
<code>LineItem</code>'s primary key is a combination of the order number and the item number.
<code>LineItemKey</code> encapsulates this primary key.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This is the <code>LineItemKey</code> compound primary key wrapper class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">ee.jakarta.tutorial.order.entity</span>;

<span class="keyword">import</span> <span class="include">java.io.Serializable</span>;

<span class="directive">public</span> <span class="directive">final</span> <span class="type">class</span> <span class="class">LineItemKey</span> <span class="directive">implements</span> <span class="predefined-type">Serializable</span> {

    <span class="directive">private</span> <span class="predefined-type">Integer</span> customerOrder;
    <span class="directive">private</span> <span class="type">int</span> itemId;

    <span class="directive">public</span> LineItemKey() {}

    <span class="directive">public</span> LineItemKey(<span class="predefined-type">Integer</span> order, <span class="type">int</span> itemId) {
        <span class="local-variable">this</span>.setCustomerOrder(order);
        <span class="local-variable">this</span>.setItemId(itemId);
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">int</span> hashCode() {
        <span class="keyword">return</span> ((<span class="local-variable">this</span>.getCustomerOrder() == <span class="predefined-constant">null</span>
                ? <span class="integer">0</span> : <span class="local-variable">this</span>.getCustomerOrder().hashCode())
                ^ ((<span class="type">int</span>) <span class="local-variable">this</span>.getItemId()));
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">boolean</span> equals(<span class="predefined-type">Object</span> otherOb) {
        <span class="keyword">if</span> (<span class="local-variable">this</span> == otherOb) {
            <span class="keyword">return</span> <span class="predefined-constant">true</span>;
        }
        <span class="keyword">if</span> (!(otherOb <span class="keyword">instanceof</span> LineItemKey)) {
            <span class="keyword">return</span> <span class="predefined-constant">false</span>;
        }
        LineItemKey other = (LineItemKey) otherOb;
        <span class="keyword">return</span> ((<span class="local-variable">this</span>.getCustomerOrder() == <span class="predefined-constant">null</span>
                ? other.getCustomerOrder == <span class="predefined-constant">null</span> : <span class="local-variable">this</span>.getOrderId()
                .equals(other.getCustomerOrder()))
                &amp;&amp; (<span class="local-variable">this</span>.getItemId == oother.getItemId()));
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> toString() {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span> + getCustomerOrder() + <span class="string"><span class="delimiter">&quot;</span><span class="content">-</span><span class="delimiter">&quot;</span></span> + getItemId();
    }

    <span class="directive">public</span> <span class="predefined-type">Integer</span> getCustomerOrder() {
        <span class="keyword">return</span> customerOrder;
    }

    <span class="directive">public</span> <span class="type">void</span> setCustomerOrder(<span class="predefined-type">Integer</span> order) {
        <span class="local-variable">this</span>.customerOrder = order;
    }

    <span class="directive">public</span> <span class="type">int</span> getItemId() {
        <span class="keyword">return</span> itemId;
    }

    <span class="directive">public</span> <span class="type">void</span> setItemId(<span class="type">int</span> itemId) {
        <span class="local-variable">this</span>.itemId = itemId;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>@IdClass</code> annotation is used to specify the primary key class in the entity class.
In <code>LineItem</code>, <code>@IdClass</code> is used as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@IdClass</span>(LineItemKey.class)
<span class="annotation">@Entity</span>
...
public <span class="type">class</span> <span class="class">LineItem</span> <span class="directive">implements</span> <span class="predefined-type">Serializable</span> {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The two fields in <code>LineItem</code> are tagged with the <code>@Id</code> annotation to mark those fields as part of the compound primary key:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Id</span>
<span class="directive">public</span> <span class="type">int</span> getItemId() {
    <span class="keyword">return</span> itemId;
}
...
<span class="annotation">@Id</span>
<span class="annotation">@ManyToOne</span>
<span class="annotation">@JoinColumn</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">ORDERID</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> CustomerOrder getCustomerOrder() {
    <span class="keyword">return</span> customerOrder;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For <code>customerOrder</code>, you also use the <code>@JoinColumn</code> annotation to specify the column name in the table and that this column is an overlapping foreign key pointing at the <code>PERSISTENCE_ORDER_CUSTOMERORDER</code> table&#8217;s <code>ORDERID</code> column (see <a href="#one-to-many-relationship-mapped-to-overlapping-primary-and-foreign-keys">One-to-Many Relationship Mapped to Overlapping Primary and Foreign Keys</a>).
That is, <code>customerOrder</code> will be set by the <code>CustomerOrder</code> entity.</p>
</div>
<div class="paragraph">
<p>In <code>LineItem</code>'s constructor, the line item number (<code>LineItem.itemId</code>) is set using the <code>CustomerOrder.getNextId</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> LineItem(CustomerOrder order, <span class="type">int</span> quantity, VendorPart vendorPart) {
    <span class="local-variable">this</span>.customerOrder = order;
    <span class="local-variable">this</span>.itemId = order.getNextId();
    <span class="local-variable">this</span>.quantity = quantity;
    <span class="local-variable">this</span>.vendorPart = vendorPart;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>CustomerOrder.getNextId</code> counts the number of current line items, adds 1, and returns that number:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Transient</span>
<span class="directive">public</span> <span class="type">int</span> getNextId() {
    <span class="keyword">return</span> <span class="local-variable">this</span>.lineItems.size() + <span class="integer">1</span>;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>Part</code> requires the <code>@Column</code> annotation on the two fields that comprise <code>Part</code>'s compound primary key, because <code>Part</code>'s compound primary key is an overlapping primary key/foreign key:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@IdClass</span>(PartKey.class)
<span class="annotation">@Entity</span>
...
public <span class="type">class</span> <span class="class">Part</span> <span class="directive">implements</span> <span class="predefined-type">Serializable</span> {
    ...
    <span class="annotation">@Id</span>
    <span class="annotation">@Column</span>(nullable=<span class="predefined-constant">false</span>)
    <span class="directive">public</span> <span class="predefined-type">String</span> getPartNumber() {
        <span class="keyword">return</span> partNumber;
    }
    ...
    <span class="annotation">@Id</span>
    <span class="annotation">@Column</span>(nullable=<span class="predefined-constant">false</span>)
    <span class="directive">public</span> <span class="type">int</span> getRevision() {
        <span class="keyword">return</span> revision;
    }
    ...
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="entity-mapped-to-more-than-one-database-table"><a class="anchor" href="#entity-mapped-to-more-than-one-database-table"></a>Entity Mapped to More Than One Database Table</h4>
<div class="paragraph">
<p><code>Part</code>'s fields map to more than one database table: <code>PERSISTENCE_ORDER_PART</code> and <code>PERSISTENCE_ORDER_PART_DETAIL</code>.
The <code>PERSISTENCE_ORDER_PART_DETAIL</code> table holds the specification and schematics for the part.
The <code>@SecondaryTable</code> annotation is used to specify the secondary table:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">...
<span class="annotation">@Entity</span>
<span class="annotation">@Table</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">PERSISTENCE_ORDER_PART</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@SecondaryTable</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">PERSISTENCE_ORDER_PART_DETAIL</span><span class="delimiter">&quot;</span></span>, pkJoinColumns={
    <span class="annotation">@PrimaryKeyJoinColumn</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">PARTNUMBER</span><span class="delimiter">&quot;</span></span>,
        referencedColumnName=<span class="string"><span class="delimiter">&quot;</span><span class="content">PARTNUMBER</span><span class="delimiter">&quot;</span></span>),
    <span class="annotation">@PrimaryKeyJoinColumn</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">REVISION</span><span class="delimiter">&quot;</span></span>,
        referencedColumnName=<span class="string"><span class="delimiter">&quot;</span><span class="content">REVISION</span><span class="delimiter">&quot;</span></span>)
})
<span class="directive">public</span> <span class="type">class</span> <span class="class">Part</span> <span class="directive">implements</span> <span class="predefined-type">Serializable</span> {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>PERSISTENCE_ORDER_PART_DETAIL</code> and <code>PERSISTENCE_ORDER_PART</code> share the same primary key values.
The <code>pkJoinColumns</code> element of <code>@SecondaryTable</code> is used to specify that <code>PERSISTENCE_ORDER_PART_DETAIL</code>'s primary key columns are foreign keys to <code>PERSISTENCE_ORDER_PART</code>.
The <code>@PrimaryKeyJoinColumn</code> annotation sets the primary key column names and specifies which column in the primary table the column refers to.
In this case, the primary key column names for both <code>PERSISTENCE_ORDER_PART_DETAIL</code> and <code>PERSISTENCE_ORDER_PART</code> are the same: <code>PARTNUMBER</code> and <code>REVISION</code>, respectively.</p>
</div>
</div>
<div class="sect3">
<h4 id="cascade-operations-in-the-order-application"><a class="anchor" href="#cascade-operations-in-the-order-application"></a>Cascade Operations in the order Application</h4>
<div class="paragraph">
<p>Entities that have relationships to other entities often have dependencies on the existence of the other entity in the relationship.
For example, a line item is part of an order; if the order is deleted, then the line item also should be deleted.
This is called a cascade delete relationship.</p>
</div>
<div class="paragraph">
<p>In <code>order</code>, there are two cascade delete dependencies in the entity relationships.
If the <code>CustomerOrder</code> to which a <code>LineItem</code> is related is deleted, the <code>LineItem</code> also should be deleted.
If the <code>Vendor</code> to which a <code>VendorPart</code> is related is deleted, the <code>VendorPart</code> also should be deleted.</p>
</div>
<div class="paragraph">
<p>You specify the cascade operations for entity relationships by setting the <code>cascade</code> element in the inverse (nonowning) side of the relationship.
The cascade element is set to <code>ALL</code> in the case of <code>CustomerOrder.lineItems</code>.
This means that all persistence operations (deletes, updates, and so on) are cascaded from orders to line items.</p>
</div>
<div class="paragraph">
<p>Here is the relationship mapping in <code>CustomerOrder</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@OneToMany</span>(cascade=ALL, mappedBy=<span class="string"><span class="delimiter">&quot;</span><span class="content">customerOrder</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="predefined-type">Collection</span>&lt;LineItem&gt; getLineItems() {
    <span class="keyword">return</span> lineItems;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is the relationship mapping in <code>LineItem</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Id</span>
<span class="annotation">@ManyToOne</span>
<span class="annotation">@JoinColumn</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">ORDERID</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> CustomerOrder getCustomerOrder() {
    <span class="keyword">return</span> customerOrder;
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="blob-and-clob-database-types-in-the-order-application"><a class="anchor" href="#blob-and-clob-database-types-in-the-order-application"></a>BLOB and CLOB Database Types in the order Application</h4>
<div class="paragraph">
<p>The <code>PARTDETAIL</code> table in the database has a column, <code>DRAWING</code>, of type <code>BLOB</code>.
<code>BLOB</code> stands for binary large objects, which are used for storing binary data, such as an image.
The <code>DRAWING</code> column is mapped to the field <code>Part.drawing</code> of type <code>java.io.Serializable</code>.
The <code>@Lob</code> annotation is used to denote that the field is a large object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Column</span>(table=<span class="string"><span class="delimiter">&quot;</span><span class="content">PERSISTENCE_ORDER_PART_DETAIL</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@Lob</span>
<span class="directive">public</span> <span class="predefined-type">Serializable</span> getDrawing() {
    <span class="keyword">return</span> drawing;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>PERSISTENCE_ORDER_PART_DETAIL</code> also has a column, <code>SPECIFICATION</code>, of type <code>CLOB</code>.
<code>CLOB</code> stands for character large objects, which are used to store string data too large to be stored in a <code>VARCHAR</code> column.
<code>SPECIFICATION</code> is mapped to the field <code>Part.specification</code> of type <code>java.lang.String</code>.
The <code>@Lob</code> annotation is also used here to denote that the field is a large object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Column</span>(table=<span class="string"><span class="delimiter">&quot;</span><span class="content">PERSISTENCE_ORDER_PART_DETAIL</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@Lob</span>
<span class="directive">public</span> <span class="predefined-type">String</span> getSpecification() {
    <span class="keyword">return</span> specification;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Both of these fields use the <code>@Column</code> annotation and set the <code>table</code> element to the secondary table.</p>
</div>
</div>
<div class="sect3">
<h4 id="temporal-types-in-the-order-application"><a class="anchor" href="#temporal-types-in-the-order-application"></a>Temporal Types in the order Application</h4>
<div class="paragraph">
<p>The <code>CustomerOrder.lastUpdate</code> persistent property, which is of type <code>java.util.Date</code>, is mapped to the <code>PERSISTENCE_ORDER_CUSTOMERORDER.LASTUPDATE</code> database field, which is of the SQL type <code>TIMESTAMP</code>.
To ensure the proper mapping between these types, you must use the <code>@Temporal</code> annotation with the proper temporal type specified in <code>@Temporal</code>'s element.
<code>@Temporal</code>'s elements are of type <code>jakarta.persistence.TemporalType</code>.
The possible values are</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>DATE</code>, which maps to <code>java.sql.Date</code></p>
</li>
<li>
<p><code>TIME</code>, which maps to <code>java.sql.Time</code></p>
</li>
<li>
<p><code>TIMESTAMP</code>, which maps to <code>java.sql.Timestamp</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Here is the relevant section of <code>CustomerOrder</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Temporal</span>(TIMESTAMP)
<span class="directive">public</span> <span class="predefined-type">Date</span> getLastUpdate() {
    <span class="keyword">return</span> lastUpdate;
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="managing-the-order-applications-entities"><a class="anchor" href="#managing-the-order-applications-entities"></a>Managing the order Application&#8217;s Entities</h4>
<div class="paragraph">
<p>The <code>RequestBean</code> stateful session bean contains the business logic and manages the entities of <code>order</code>.
<code>RequestBean</code> uses the <code>@PersistenceContext</code> annotation to retrieve an entity manager instance, which is used to manage <code>order</code>'s entities in <code>RequestBean</code>'s business methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@PersistenceContext</span>
<span class="directive">private</span> EntityManager em;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This <code>EntityManager</code> instance is a container-managed entity manager, so the container takes care of all the transactions involved in managing <code>order</code>'s entities.</p>
</div>
<div class="sect4">
<h5 id="creating-entities"><a class="anchor" href="#creating-entities"></a>Creating Entities</h5>
<div class="paragraph">
<p>The <code>RequestBean.createPart</code> business method creates a new <code>Part</code> entity.
The <code>EntityManager.persist</code> method is used to persist the newly created entity to the database:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Part part = <span class="keyword">new</span> Part(partNumber,
        revision,
        description,
        revisionDate,
        specification,
        drawing);
em.persist(part);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>ConfigBean</code> singleton session bean is used to initialize the data in <code>order</code>.
<code>ConfigBean</code> is annotated with <code>@Startup</code>, which indicates that the enterprise bean container should create <code>ConfigBean</code> when <code>order</code> is deployed.
The <code>createData</code> method is annotated with <code>@PostConstruct</code> and creates the initial entities used by <code>order</code> by calling <code>RequestBean</code>'s business methods.</p>
</div>
</div>
<div class="sect4">
<h5 id="finding-entities"><a class="anchor" href="#finding-entities"></a>Finding Entities</h5>
<div class="paragraph">
<p>The <code>RequestBean.getOrderPrice</code> business method returns the price of a given order based on the <code>orderId</code>.
The <code>EntityManager.find</code> method is used to retrieve the entity from the database:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">CustomerOrder order = em.find(CustomerOrder.class, orderId);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first argument of <code>EntityManager.find</code> is the entity class, and the second is the primary key.</p>
</div>
</div>
<div class="sect4">
<h5 id="setting-entity-relationships"><a class="anchor" href="#setting-entity-relationships"></a>Setting Entity Relationships</h5>
<div class="paragraph">
<p>The <code>RequestBean.createVendorPart</code> business method creates a <code>VendorPart</code> associated with a particular <code>Vendor</code>.
The <code>EntityManager.persist</code> method is used to persist the newly created <code>VendorPart</code> entity to the database, and the <code>VendorPart.setVendor</code> and <code>Vendor.setVendorPart</code> methods are used to associate the <code>VendorPart</code> with the <code>Vendor</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">PartKey pkey = <span class="keyword">new</span> PartKey();
pkey.setPartNumber(partNumber);
pkey.setRevision(revision);

Part part = em.find(Part.class, pkey);

VendorPart vendorPart = <span class="keyword">new</span> VendorPart(description, price, part);
em.persist(vendorPart);

Vendor vendor = em.find(Vendor.class, vendorId);
vendor.addVendorPart(vendorPart);
vendorPart.setVendor(vendor);</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="using-queries"><a class="anchor" href="#using-queries"></a>Using Queries</h5>
<div class="paragraph">
<p>The <code>RequestBean.adjustOrderDiscount</code> business method updates the discount applied to all orders.
This method uses the <code>findAllOrders</code> named query, defined in <code>CustomerOrder</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@NamedQuery</span>(
    name=<span class="string"><span class="delimiter">&quot;</span><span class="content">findAllOrders</span><span class="delimiter">&quot;</span></span>,
    query=<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT co FROM CustomerOrder co </span><span class="delimiter">&quot;</span></span> +
          <span class="string"><span class="delimiter">&quot;</span><span class="content">ORDER BY co.orderId</span><span class="delimiter">&quot;</span></span>
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>EntityManager.createNamedQuery</code> method is used to run the query.
Because the query returns a <code>List</code> of all the orders, the <code>Query.getResultList</code> method is used:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">List</span> orders = em.createNamedQuery(
        <span class="string"><span class="delimiter">&quot;</span><span class="content">findAllOrders</span><span class="delimiter">&quot;</span></span>)
        .getResultList();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>RequestBean.getTotalPricePerVendor</code> business method returns the total price of all the parts for a particular vendor.
This method uses a named parameter, <code>id</code>, defined in the named query <code>findTotalVendorPartPricePerVendor</code> defined in <code>VendorPart</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@NamedQuery</span>(
    name=<span class="string"><span class="delimiter">&quot;</span><span class="content">findTotalVendorPartPricePerVendor</span><span class="delimiter">&quot;</span></span>,
    query=<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT SUM(vp.price) </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">FROM VendorPart vp </span><span class="delimiter">&quot;</span></span> +
    <span class="string"><span class="delimiter">&quot;</span><span class="content">WHERE vp.vendor.vendorId = :id</span><span class="delimiter">&quot;</span></span>
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>When running the query, the <code>Query.setParameter</code> method is used to set the named parameter <code>id</code> to the value of <code>vendorId</code>, the parameter to <code>RequestBean.getTotalPricePerVendor</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">return</span> (<span class="predefined-type">Double</span>) em.createNamedQuery(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">findTotalVendorPartPricePerVendor</span><span class="delimiter">&quot;</span></span>)
    .setParameter(<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>, vendorId)
    .getSingleResult();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Query.getSingleResult</code> method is used for this query because the query returns a single value.</p>
</div>
</div>
<div class="sect4">
<h5 id="removing-entities"><a class="anchor" href="#removing-entities"></a>Removing Entities</h5>
<div class="paragraph">
<p>The <code>RequestBean.removeOrder</code> business method deletes a given order from the database.
This method uses the <code>EntityManager.remove</code> method to delete the entity from the database:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">CustomerOrder order = em.find(CustomerOrder.class, orderId);
em.remove(order);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="running-the-order-example"><a class="anchor" href="#running-the-order-example"></a>Running the order Example</h4>
<div class="paragraph">
<p>You can use either NetBeans IDE or Maven to build, package, deploy, and run the <code>order</code> application.
First, you will create the database tables in Apache Derby.</p>
</div>
<div class="sect4">
<h5 id="to-run-the-order-example-using-netbeans-ide"><a class="anchor" href="#to-run-the-order-example-using-netbeans-ide"></a>To Run the order Example Using NetBeans IDE</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>If the database server is not already running, start it by following the instructions in <a href="#starting-and-stopping-apache-derby">Starting and Stopping Apache Derby</a>.</p>
</li>
<li>
<p>From the <strong>File</strong> menu, choose <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the <strong>Open Project</strong> dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/persistence</pre>
</div>
</div>
</li>
<li>
<p>Select the <code>order</code> folder.</p>
</li>
<li>
<p>Click <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the <strong>Projects</strong> tab, right-click the <code>order</code> project and select <strong>Run</strong>.</p>
<div class="paragraph">
<p>NetBeans IDE opens a web browser to the following URL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080/order/</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-run-the-order-example-using-maven"><a class="anchor" href="#to-run-the-order-example-using-maven"></a>To Run the order Example Using Maven</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>If the database server is not already running, start it by following the instructions in <a href="#starting-and-stopping-apache-derby">Starting and Stopping Apache Derby</a>.</p>
</li>
<li>
<p>In a terminal window, go to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/persistence/order/</pre>
</div>
</div>
</li>
<li>
<p>Enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">mvn install</code></pre>
</div>
</div>
<div class="paragraph">
<p>This compiles the source files and packages the application into a WAR file located at <code><em>tut-install</em>/examples/persistence/order/target/order.war</code>.
Then the WAR file is deployed to your GlassFish Server instance.</p>
</div>
</li>
<li>
<p>To create and update the order data, open a web browser to the following URL:</p>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080/order/</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="the-roster-application"><a class="anchor" href="#the-roster-application"></a>The roster Application</h3>
<div class="paragraph">
<p>The <code>roster</code> application maintains the team rosters for players in recreational sports leagues.
The application has four components: Jakarta Persistence entities (<code>Player</code>, <code>Team</code>, and <code>League</code>), a stateful session bean (<code>RequestBean</code>), an application client (<code>RosterClient</code>), and three helper classes (<code>PlayerDetails</code>, <code>TeamDetails</code>, and <code>LeagueDetails</code>).</p>
</div>
<div class="paragraph">
<p>Functionally, <code>roster</code> is similar to the <code>order</code> application, with three new features that <code>order</code> does not have: many-to-many relationships, entity inheritance, and automatic table creation at deployment time.</p>
</div>
<div class="paragraph">
<p>The database schema in Apache Derby for the <code>roster</code> application is shown in <a href="#database-schema-for-the-roster-application">Figure 41-2</a>.</p>
</div>
<div id="database-schema-for-the-roster-application" class="imageblock">
<div class="content">
<img src="images/jakartaeett_dt_025.svg" alt="Diagram showing the database schema for the roster application">
</div>
<div class="title">Figure 41-2 Database Schema for the roster Application</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In this diagram, for simplicity, the <code>PERSISTENCE_ROSTER_</code> prefix is omitted from the table names.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="relationships-in-the-roster-application"><a class="anchor" href="#relationships-in-the-roster-application"></a>Relationships in the roster Application</h4>
<div class="paragraph">
<p>A recreational sports system has the following relationships.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A player can be on many teams.</p>
</li>
<li>
<p>A team can have many players.</p>
</li>
<li>
<p>A team is in exactly one league.</p>
</li>
<li>
<p>A league has many teams.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In <code>roster</code> this system is reflected by the following relationships between the <code>Player</code>, <code>Team</code>, and <code>League</code> entities.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>There is a many-to-many relationship between <code>Player</code> and <code>Team</code>.</p>
</li>
<li>
<p>There is a many-to-one relationship between <code>Team</code> and <code>League</code>.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="the-many-to-many-relationship-in-roster"><a class="anchor" href="#the-many-to-many-relationship-in-roster"></a>The Many-To-Many Relationship in roster</h5>
<div class="paragraph">
<p>The many-to-many relationship between <code>Player</code> and <code>Team</code> is specified by using the <code>@ManyToMany</code> annotation.
In <code>Team.java</code>, the <code>@ManyToMany</code> annotation decorates the <code>getPlayers</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ManyToMany</span>
<span class="annotation">@JoinTable</span>(
    name=<span class="string"><span class="delimiter">&quot;</span><span class="content">PERSISTENCE_ROSTER_TEAM_PLAYER</span><span class="delimiter">&quot;</span></span>,
    joinColumns=
        <span class="annotation">@JoinColumn</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">TEAM_ID</span><span class="delimiter">&quot;</span></span>, referencedColumnName=<span class="string"><span class="delimiter">&quot;</span><span class="content">ID</span><span class="delimiter">&quot;</span></span>),
    inverseJoinColumns=
        <span class="annotation">@JoinColumn</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">PLAYER_ID</span><span class="delimiter">&quot;</span></span>, referencedColumnName=<span class="string"><span class="delimiter">&quot;</span><span class="content">ID</span><span class="delimiter">&quot;</span></span>)
)
<span class="directive">public</span> <span class="predefined-type">Collection</span>&lt;Player&gt; getPlayers() {
    <span class="keyword">return</span> players;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>@JoinTable</code> annotation is used to specify a database table that will associate player IDs with team IDs.
The entity that specifies the <code>@JoinTable</code> is the owner of the relationship, so the <code>Team</code> entity is the owner of the relationship with the <code>Player</code> entity.
Because <code>roster</code> uses automatic table creation at deployment time, the container will create a join table named <code>PERSISTENCE_ROSTER_TEAM_PLAYER</code>.</p>
</div>
<div class="paragraph">
<p><code>Player</code> is the inverse, or nonowning, side of the relationship with <code>Team</code>.
As one-to-one and many-to-one relationships, the nonowning side is marked by the <code>mappedBy</code> element in the relationship annotation.
Because the relationship between <code>Player</code> and <code>Team</code> is bidirectional, the choice of which entity is the owner of the relationship is arbitrary.</p>
</div>
<div class="paragraph">
<p>In <code>Player.java</code>, the <code>@ManyToMany</code> annotation decorates the <code>getTeams</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ManyToMany</span>(mappedBy=<span class="string"><span class="delimiter">&quot;</span><span class="content">players</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="predefined-type">Collection</span>&lt;Team&gt; getTeams() {
    <span class="keyword">return</span> teams;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="entity-inheritance-in-the-roster-application"><a class="anchor" href="#entity-inheritance-in-the-roster-application"></a>Entity Inheritance in the roster Application</h4>
<div class="paragraph">
<p>The <code>roster</code> application shows how to use entity inheritance, as described in <a href="#entity-inheritance">Entity Inheritance</a>.</p>
</div>
<div class="paragraph">
<p>The <code>League</code> entity in <code>roster</code> is an abstract entity with two concrete subclasses: <code>SummerLeague</code> and <code>WinterLeague</code>.
Because <code>League</code> is an abstract class, it cannot be instantiated:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Entity</span>
<span class="annotation">@Table</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">PERSISTENCE_ROSTER_LEAGUE</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="directive">abstract</span> <span class="type">class</span> <span class="class">League</span> <span class="directive">implements</span> <span class="predefined-type">Serializable</span> { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Instead, when creating a league, clients use <code>SummerLeague</code> or <code>WinterLeague</code>.
<code>SummerLeague</code> and <code>WinterLeague</code> inherit the persistent properties defined in <code>League</code> and add only a constructor that verifies that the sport parameter matches the type of sport allowed in that seasonal league.
For example, here is the <code>SummerLeague</code> entity:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">...
<span class="annotation">@Entity</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">SummerLeague</span> <span class="directive">extends</span> League <span class="directive">implements</span> <span class="predefined-type">Serializable</span> {

    <span class="comment">/** Creates a new instance of SummerLeague */</span>
    <span class="directive">public</span> SummerLeague() {
    }

    <span class="directive">public</span> SummerLeague(<span class="predefined-type">String</span> id, <span class="predefined-type">String</span> name, <span class="predefined-type">String</span> sport)
            <span class="directive">throws</span> IncorrectSportException {
        <span class="local-variable">this</span>.id = id;
        <span class="local-variable">this</span>.name = name;
        <span class="keyword">if</span> (sport.equalsIgnoreCase(<span class="string"><span class="delimiter">&quot;</span><span class="content">swimming</span><span class="delimiter">&quot;</span></span>) ||
                sport.equalsIgnoreCase(<span class="string"><span class="delimiter">&quot;</span><span class="content">soccer</span><span class="delimiter">&quot;</span></span>) ||
                sport.equalsIgnoreCase(<span class="string"><span class="delimiter">&quot;</span><span class="content">basketball</span><span class="delimiter">&quot;</span></span>) ||
                sport.equalsIgnoreCase(<span class="string"><span class="delimiter">&quot;</span><span class="content">baseball</span><span class="delimiter">&quot;</span></span>)) {
            <span class="local-variable">this</span>.sport = sport;
        } <span class="keyword">else</span> {
            <span class="keyword">throw</span> <span class="keyword">new</span> IncorrectSportException(<span class="string"><span class="delimiter">&quot;</span><span class="content">Sport is not a summer sport.</span><span class="delimiter">&quot;</span></span>);
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>roster</code> application uses the default mapping strategy of <code>InheritanceType.SINGLE_TABLE</code>, so the <code>@Inheritance</code> annotation is not required.
If you want to use a different mapping strategy, decorate <code>League</code> with <code>@Inheritance</code> and specify the mapping strategy in the <code>strategy</code> element:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Entity</span>
<span class="annotation">@Inheritance</span>(strategy=JOINED)
<span class="annotation">@Table</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">PERSISTENCE_ROSTER_LEAGUE</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="directive">abstract</span> <span class="type">class</span> <span class="class">League</span> <span class="directive">implements</span> <span class="predefined-type">Serializable</span> { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>roster</code> application uses the default discriminator column name, so the <code>@DiscriminatorColumn</code> annotation is not required.
Because you are using automatic table generation in <code>roster</code>, the Persistence provider will create a discriminator column called <code>DTYPE</code> in the <code>PERSISTENCE_ROSTER_LEAGUE</code> table, which will store the name of the inherited entity used to create the league.
If you want to use a different name for the discriminator column, decorate <code>League</code> with <code>@DiscriminatorColumn</code> and set the <code>name</code> element:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Entity</span>
<span class="annotation">@DiscriminatorColumn</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">DISCRIMINATOR</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@Table</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">PERSISTENCE_ROSTER_LEAGUE</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="directive">abstract</span> <span class="type">class</span> <span class="class">League</span> <span class="directive">implements</span> <span class="predefined-type">Serializable</span> { ... }</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="criteria-queries-in-the-roster-application"><a class="anchor" href="#criteria-queries-in-the-roster-application"></a>Criteria Queries in the roster Application</h4>
<div class="paragraph">
<p>The <code>roster</code> application uses Criteria API queries, as opposed to the JPQL queries used in <code>order</code>.
Criteria queries are Java programming language, typesafe queries defined in the business tier of <code>roster</code>, in the <code>RequestBean</code> stateful session bean.</p>
</div>
<div class="sect4">
<h5 id="metamodel-classes-in-the-roster-application"><a class="anchor" href="#metamodel-classes-in-the-roster-application"></a>Metamodel Classes in the roster Application</h5>
<div class="paragraph">
<p>Metamodel classes model an entity&#8217;s attributes and are used by Criteria queries to navigate to an entity&#8217;s attributes.
Each entity class in <code>roster</code> has a corresponding metamodel class, generated at compile time, with the same package name as the entity and appended with an underscore character (<code>_</code>).
For example, the <code>roster.entity.Player</code> entity has a corresponding metamodel class, <code>roster.entity.Player_</code>.</p>
</div>
<div class="paragraph">
<p>Each persistent field or property in the entity class has a corresponding attribute in the entity&#8217;s metamodel class.
For the <code>Player</code> entity, the corresponding metamodel class is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@StaticMetamodel</span>(Player.class)
<span class="directive">public</span> <span class="type">class</span> <span class="class">Player_</span> {
    <span class="directive">public</span> <span class="directive">static</span> <span class="directive">volatile</span> SingularAttribute&lt;Player, <span class="predefined-type">String</span>&gt; id;
    <span class="directive">public</span> <span class="directive">static</span> <span class="directive">volatile</span> SingularAttribute&lt;Player, <span class="predefined-type">String</span>&gt; name;
    <span class="directive">public</span> <span class="directive">static</span> <span class="directive">volatile</span> SingularAttribute&lt;Player, <span class="predefined-type">String</span>&gt; position;
    <span class="directive">public</span> <span class="directive">static</span> <span class="directive">volatile</span> SingularAttribute&lt;Player, <span class="predefined-type">Double</span>&gt; salary;
    <span class="directive">public</span> <span class="directive">static</span> <span class="directive">volatile</span> CollectionAttribute&lt;Player, Team&gt; teams;
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="obtaining-a-criteriabuilder-instance-in-requestbean"><a class="anchor" href="#obtaining-a-criteriabuilder-instance-in-requestbean"></a>Obtaining a CriteriaBuilder Instance in RequestBean</h5>
<div class="paragraph">
<p>The <code>CriteriaBuilder</code> interface defines methods to create criteria query objects and create expressions for modifying those query objects.
<code>RequestBean</code> creates an instance of <code>CriteriaBuilder</code> by using a <code>@PostConstruct</code> method, <code>init</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@PersistenceContext</span>
<span class="directive">private</span> EntityManager em;
<span class="directive">private</span> CriteriaBuilder cb;

<span class="annotation">@PostConstruct</span>
<span class="directive">private</span> <span class="type">void</span> init() {
    cb = em.getCriteriaBuilder();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>EntityManager</code> instance is injected at runtime, and then that <code>EntityManager</code> object is used to create the <code>CriteriaBuilder</code> instance by calling <code>getCriteriaBuilder</code>.
The <code>CriteriaBuilder</code> instance is created in a <code>@PostConstruct</code> method to ensure that the <code>EntityManager</code> instance has been injected by the enterprise bean container.</p>
</div>
</div>
<div class="sect4">
<h5 id="creating-criteria-queries-in-requestbeans-business-methods"><a class="anchor" href="#creating-criteria-queries-in-requestbeans-business-methods"></a>Creating Criteria Queries in RequestBean&#8217;s Business Methods</h5>
<div class="paragraph">
<p>Many of the business methods in <code>RequestBean</code> define Criteria queries.
One business method, <code>getPlayersByPosition</code>, returns a list of players who play a particular position on a team:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="predefined-type">List</span>&lt;PlayerDetails&gt; getPlayersByPosition(<span class="predefined-type">String</span> position) {
    logger.info(<span class="string"><span class="delimiter">&quot;</span><span class="content">getPlayersByPosition</span><span class="delimiter">&quot;</span></span>);
    <span class="predefined-type">List</span>&lt;Player&gt; players = <span class="predefined-constant">null</span>;

    <span class="keyword">try</span> {
        CriteriaQuery&lt;Player&gt; cq = cb.createQuery(Player.class);
        <span class="keyword">if</span> (cq != <span class="predefined-constant">null</span>) {
            Root&lt;Player&gt; player = cq.from(Player.class);

            <span class="comment">// set the where clause</span>
            cq.where(cb.equal(player.get(Player_.position), position));
            cq.select(player);
            TypedQuery&lt;Player&gt; q = em.createQuery(cq);
            players = q.getResultList();
        }
        <span class="keyword">return</span> copyPlayersToDetails(players);
    } <span class="keyword">catch</span> (<span class="exception">Exception</span> ex) {
        <span class="keyword">throw</span> <span class="keyword">new</span> EJBException(ex);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A query object is created by calling the <code>CriteriaBuilder</code> object&#8217;s <code>createQuery</code> method, with the type set to <code>Player</code> because the query will return a list of players.</p>
</div>
<div class="paragraph">
<p>The query root, the base entity from which the query will navigate to find the entity&#8217;s attributes and related entities, is created by calling the <code>from</code> method of the query object.
This sets the <code>FROM</code> clause of the query.</p>
</div>
<div class="paragraph">
<p>The <code>WHERE</code> clause, set by calling the <code>where</code> method on the query object, restricts the results of the query according to the conditions of an expression.
The <code>CriteriaBuilder.equal</code> method compares the two expressions.
In <code>getPlayersByPosition</code>, the <code>position</code> attribute of the <code>Player_</code> metamodel class, accessed by calling the <code>get</code> method of the query root, is compared to the <code>position</code> parameter passed to <code>getPlayersByPosition</code>.</p>
</div>
<div class="paragraph">
<p>The <code>SELECT</code> clause of the query is set by calling the <code>select</code> method of the query object.
The query will return <code>Player</code> entities, so the query root object is passed as a parameter to <code>select</code>.</p>
</div>
<div class="paragraph">
<p>The query object is prepared for execution by calling <code>EntityManager.createQuery</code>, which returns a <code>TypedQuery&lt;T&gt;</code> object with the type of the query, in this case <code>Player</code>.
This typed query object is used to execute the query, which occurs when the <code>getResultList</code> method is called, and a <code>List&lt;Player&gt;</code> collection is returned.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="automatic-table-generation-in-the-roster-application"><a class="anchor" href="#automatic-table-generation-in-the-roster-application"></a>Automatic Table Generation in the roster Application</h4>
<div class="paragraph">
<p>At deployment time, GlassFish Server will automatically drop and create the database tables used by <code>roster</code>.
This is done by setting the <code>jakarta.persistence.schema-generation.database.action</code> property to <code>drop-and-create</code> in <code>persistence.xml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;persistence</span> <span class="attribute-name">version</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">3.0</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">https://jakarta.ee/xml/ns/persistence</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">https://jakarta.ee/xml/ns/persistence</span>
        <span class="content">https://jakarta.ee/xml/ns/persistence/persistence_3_0.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;persistence-unit</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">em</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">transaction-type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">JTA</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;jta-data-source&gt;</span>java:comp/DefaultDataSource<span class="tag">&lt;/jta-data-source&gt;</span>
    <span class="tag">&lt;properties&gt;</span>
      <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jakarta.persistence.schema-generation.database.action</span><span class="delimiter">&quot;</span></span>
                <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">drop-and-create</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/properties&gt;</span>
  <span class="tag">&lt;/persistence-unit&gt;</span>
<span class="tag">&lt;/persistence&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="running-the-roster-example"><a class="anchor" href="#running-the-roster-example"></a>Running the roster Example</h4>
<div class="paragraph">
<p>You can use either NetBeans IDE or Maven to build, package, deploy, and run the <code>roster</code> application.</p>
</div>
<div class="sect4">
<h5 id="to-run-the-roster-example-using-netbeans-ide"><a class="anchor" href="#to-run-the-roster-example-using-netbeans-ide"></a>To Run the roster Example Using NetBeans IDE</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>If the database server is not already running, start it by following the instructions in <a href="#starting-and-stopping-apache-derby">Starting and Stopping Apache Derby</a>.</p>
</li>
<li>
<p>From the <strong>File</strong> menu, choose <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the <strong>Open Project</strong> dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/persistence</pre>
</div>
</div>
</li>
<li>
<p>Select the <code>roster</code> folder.</p>
</li>
<li>
<p>Select the <strong>Open Required Projects</strong> check box.</p>
</li>
<li>
<p>Click <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the <strong>Projects</strong> tab, right-click the <code>roster</code> project and select <strong>Build</strong>.</p>
<div class="paragraph">
<p>This will compile, package, and deploy the EAR to GlassFish Server.</p>
</div>
<div class="paragraph">
<p>You will see the following partial output from the application client in the Output tab:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>List all players in team T2:
P6 Ian Carlyle goalkeeper 555.0
P7 Rebecca Struthers midfielder 777.0
P8 Anne Anderson forward 65.0
P9 Jan Wesley defender 100.0
P10 Terry Smithson midfielder 100.0

List all teams in league L1:
T1 Honey Bees Visalia
T2 Gophers Manteca
T5 Crows Orland

List all defenders:
P2 Alice Smith defender 505.0
P5 Barney Bold defender 100.0
P9 Jan Wesley defender 100.0
P22 Janice Walker defender 857.0
P25 Frank Fletcher defender 399.0</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-run-the-roster-example-using-maven"><a class="anchor" href="#to-run-the-roster-example-using-maven"></a>To Run the roster Example Using Maven</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>If the database server is not already running, start it by following the instructions in <a href="#starting-and-stopping-apache-derby">Starting and Stopping Apache Derby</a>.</p>
</li>
<li>
<p>In a terminal window, go to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/persistence/roster/roster-ear/</pre>
</div>
</div>
</li>
<li>
<p>Enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">mvn install</code></pre>
</div>
</div>
<div class="paragraph">
<p>This compiles the source files and packages the application into an EAR file located at <code><em>tut-install</em>/examples/persistence/roster/target/roster.ear</code>.
The EAR file is then deployed to GlassFish Server.
GlassFish Server will then drop and create the database tables during deployment, as specified in <code>persistence.xml</code>.</p>
</div>
<div class="paragraph">
<p>After successfully deploying the EAR, the client stubs are retrieved and the application client is run using the appclient application included with GlassFish Server.</p>
</div>
<div class="paragraph">
<p>You will see the output, which begins as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[echo] running application client container.
[exec] List all players in team T2:
[exec] P6 Ian Carlyle goalkeeper 555.0
[exec] P7 Rebecca Struthers midfielder 777.0
[exec] P8 Anne Anderson forward 65.0
[exec] P9 Jan Wesley defender 100.0
[exec] P10 Terry Smithson midfielder 100.0

[exec] List all teams in league L1:
[exec] T1 Honey Bees Visalia
[exec] T2 Gophers Manteca
[exec] T5 Crows Orland

[exec] List all defenders:
[exec] P2 Alice Smith defender 505.0
[exec] P5 Barney Bold defender 100.0
[exec] P9 Jan Wesley defender 100.0
[exec] P22 Janice Walker defender 857.0
[exec] P25 Frank Fletcher defender 399.0</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="the-address-book-application"><a class="anchor" href="#the-address-book-application"></a>The address-book Application</h3>
<div class="paragraph">
<p>The <code>address-book</code> example application is a simple web application that stores contact data.
It uses a single entity class, <code>Contact</code>, that uses Jakarta Bean Validation to validate the data stored in the persistent attributes of the entity, as described in <a href="#validating-persistent-fields-and-properties">Validating Persistent Fields and Properties</a>.</p>
</div>
<div class="sect3">
<h4 id="bean-validation-constraints-in-address-book"><a class="anchor" href="#bean-validation-constraints-in-address-book"></a>Bean Validation Constraints in address-book</h4>
<div class="paragraph">
<p>The <code>Contact</code> entity uses the <code>@NotNull</code>, <code>@Pattern</code>, and <code>@Past</code> constraints on the persistent attributes.</p>
</div>
<div class="paragraph">
<p>The <code>@NotNull</code> constraint marks the attribute as a required field.
The attribute must be set to a non-null value before the entity can be persisted or modified.
Bean Validation will throw a validation error if the attribute is null when the entity is persisted or modified.</p>
</div>
<div class="paragraph">
<p>The <code>@Pattern</code> constraint defines a regular expression that the value of the attribute must match before the entity can be persisted or modified.
This constraint has two different uses in <code>address-book</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The regular expression declared in the <code>@Pattern</code> annotation on the <code>email</code> field matches email addresses of the form name<code>@</code>domain name<code>.</code>top level domain, allowing only valid characters for email addresses.
For example, <code>username@example.com</code> will pass validation, as will <code>firstname.lastname@mail.example.com</code>.
However, <code>firstname,lastname@example.com</code>, which contains an illegal comma character in the local name, will fail validation.</p>
</li>
<li>
<p>The <code>mobilePhone</code> and <code>homePhone</code> fields are annotated with a <code>@Pattern</code> constraint that defines a regular expression to match phone numbers of the form <code>(</code>xxx<code>)</code> xxx<code>-</code>xxxx.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>@Past</code> constraint is applied to the birthday field, which must be a <code>java.util.Date</code> in the past.</p>
</div>
<div class="paragraph">
<p>Here are the relevant parts of the <code>Contact</code> entity class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Entity</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Contact</span> <span class="directive">implements</span> <span class="predefined-type">Serializable</span> {
    <span class="annotation">@Id</span>
    <span class="annotation">@GeneratedValue</span>(strategy = GenerationType.AUTO)
    <span class="directive">private</span> <span class="predefined-type">Long</span> id;
    <span class="annotation">@NotNull</span>
    <span class="directive">protected</span> <span class="predefined-type">String</span> firstName;
    <span class="annotation">@NotNull</span>
    <span class="directive">protected</span> <span class="predefined-type">String</span> lastName;
    <span class="annotation">@Pattern</span>(regexp = <span class="string"><span class="delimiter">&quot;</span><span class="content">[a-z0-9!#$%&amp;'*+/=?^_`{|}~-]+(?:</span><span class="char">\\</span><span class="content">.</span><span class="delimiter">&quot;</span></span>
            + <span class="string"><span class="delimiter">&quot;</span><span class="content">[a-z0-9!#$%&amp;'*+/=?^_`{|}~-]+)*@</span><span class="delimiter">&quot;</span></span>
            + <span class="string"><span class="delimiter">&quot;</span><span class="content">(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?</span><span class="char">\\</span><span class="content">.)+[a-z0-9]</span><span class="delimiter">&quot;</span></span>
            + <span class="string"><span class="delimiter">&quot;</span><span class="content">(?:[a-z0-9-]*[a-z0-9])?</span><span class="delimiter">&quot;</span></span>,
            message = <span class="string"><span class="delimiter">&quot;</span><span class="content">{invalid.email}</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">protected</span> <span class="predefined-type">String</span> email;
    <span class="annotation">@Pattern</span>(regexp = <span class="string"><span class="delimiter">&quot;</span><span class="content">^</span><span class="char">\\</span><span class="content">(?(</span><span class="char">\\</span><span class="content">d{3})</span><span class="char">\\</span><span class="content">)?[- ]?(</span><span class="char">\\</span><span class="content">d{3})[- ]?(</span><span class="char">\\</span><span class="content">d{4})$</span><span class="delimiter">&quot;</span></span>,
            message = <span class="string"><span class="delimiter">&quot;</span><span class="content">{invalid.phonenumber}</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">protected</span> <span class="predefined-type">String</span> mobilePhone;
    <span class="annotation">@Pattern</span>(regexp = <span class="string"><span class="delimiter">&quot;</span><span class="content">^</span><span class="char">\\</span><span class="content">(?(</span><span class="char">\\</span><span class="content">d{3})</span><span class="char">\\</span><span class="content">)?[- ]?(</span><span class="char">\\</span><span class="content">d{3})[- ]?(</span><span class="char">\\</span><span class="content">d{4})$</span><span class="delimiter">&quot;</span></span>,
            message = <span class="string"><span class="delimiter">&quot;</span><span class="content">{invalid.phonenumber}</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">protected</span> <span class="predefined-type">String</span> homePhone;
    <span class="annotation">@Temporal</span>(jakarta.persistence.TemporalType.DATE)
    <span class="annotation">@Past</span>
    <span class="directive">protected</span> <span class="predefined-type">Date</span> birthday;
    ...
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="specifying-error-messages-for-constraints-in-address-book"><a class="anchor" href="#specifying-error-messages-for-constraints-in-address-book"></a>Specifying Error Messages for Constraints in address-book</h4>
<div class="paragraph">
<p>Some of the constraints in the <code>Contact</code> entity specify an optional message:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Pattern</span>(regexp = <span class="string"><span class="delimiter">&quot;</span><span class="content">^</span><span class="char">\\</span><span class="content">(?(</span><span class="char">\\</span><span class="content">d{3})</span><span class="char">\\</span><span class="content">)?[- ]?(</span><span class="char">\\</span><span class="content">d{3})[- ]?(</span><span class="char">\\</span><span class="content">d{4})$</span><span class="delimiter">&quot;</span></span>,
        message = <span class="string"><span class="delimiter">&quot;</span><span class="content">{invalid.phonenumber}</span><span class="delimiter">&quot;</span></span>)
<span class="directive">protected</span> <span class="predefined-type">String</span> homePhone;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The optional message element in the <code>@Pattern</code> constraint overrides the default validation message.
The message can be specified directly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Pattern</span>(regexp = <span class="string"><span class="delimiter">&quot;</span><span class="content">^</span><span class="char">\\</span><span class="content">(?(</span><span class="char">\\</span><span class="content">d{3})</span><span class="char">\\</span><span class="content">)?[- ]?(</span><span class="char">\\</span><span class="content">d{3})[- ]?(</span><span class="char">\\</span><span class="content">d{4})$</span><span class="delimiter">&quot;</span></span>,
        message = <span class="string"><span class="delimiter">&quot;</span><span class="content">Invalid phone number!</span><span class="delimiter">&quot;</span></span>)
<span class="directive">protected</span> <span class="predefined-type">String</span> homePhone;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The constraints in <code>Contact</code>, however, are strings in the resource bundle <code>ValidationMessages.properties</code>, under <code><em>tut-install</em>/examples/persistence/address-book/src/java/</code>.
This allows the validation messages to be located in one single properties file and the messages to be easily localized.
Overridden Bean Validation messages must be placed in a resource bundle properties file named <code>ValidationMessages.properties</code> in the default package, with localized resource bundles taking the form <code>ValidationMessages<em>_locale-prefix</em>.properties</code>.
For example, <code>ValidationMessages_es.properties</code> is the resource bundle used in Spanish-speaking locales.</p>
</div>
</div>
<div class="sect3">
<h4 id="validating-contact-input-from-a-jakarta-faces-application"><a class="anchor" href="#validating-contact-input-from-a-jakarta-faces-application"></a>Validating Contact Input from a Jakarta Faces Application</h4>
<div class="paragraph">
<p>The <code>address-book</code> application uses a Jakarta Faces web front end to allow users to enter contacts.
While Jakarta Faces has a form input validation mechanism using tags in Facelets XHTML files, <code>address-book</code> doesn&#8217;t use these validation tags.
Bean Validation constraints in Jakarta Faces managed beans, in this case in the <code>Contact</code> entity, automatically trigger validation when the forms are submitted.</p>
</div>
<div class="paragraph">
<p>The following code snippet from the <code>Create.xhtml</code> Facelets file shows some of the input form for creating new <code>Contact</code> instances:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:form&gt;</span>
    <span class="tag">&lt;table</span> <span class="attribute-name">columns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">3</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">role</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">presentation</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;tr&gt;</span>
            <span class="tag">&lt;td&gt;</span><span class="tag">&lt;h:outputLabel</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{bundle.CreateContactLabel_firstName}</span><span class="delimiter">&quot;</span></span>
                               <span class="attribute-name">for</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">firstName</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span><span class="tag">&lt;/td&gt;</span>
            <span class="tag">&lt;td&gt;</span><span class="tag">&lt;h:inputText</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">firstName</span><span class="delimiter">&quot;</span></span>
                             <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{contactController.selected.firstName}</span><span class="delimiter">&quot;</span></span>
                             <span class="attribute-name">title</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{bundle.CreateContactTitle_firstName}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/td&gt;</span>
            <span class="tag">&lt;td&gt;</span><span class="tag">&lt;h:message</span> <span class="attribute-name">for</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">firstName</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span><span class="tag">&lt;/td&gt;</span>
        <span class="tag">&lt;/tr&gt;</span>
        <span class="tag">&lt;tr&gt;</span>
            <span class="tag">&lt;td&gt;</span><span class="tag">&lt;h:outputLabel</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{bundle.CreateContactLabel_lastName}</span><span class="delimiter">&quot;</span></span>
                               <span class="attribute-name">for</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">lastName</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span><span class="tag">&lt;/td&gt;</span>
            <span class="tag">&lt;td&gt;</span><span class="tag">&lt;h:inputText</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">lastName</span><span class="delimiter">&quot;</span></span>
                             <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{contactController.selected.lastName}</span><span class="delimiter">&quot;</span></span>
                             <span class="attribute-name">title</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{bundle.CreateContactTitle_lastName}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
            <span class="tag">&lt;/td&gt;</span>
            <span class="tag">&lt;td&gt;</span><span class="tag">&lt;h:message</span> <span class="attribute-name">for</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">lastName</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span><span class="tag">&lt;/td&gt;</span>
        <span class="tag">&lt;/tr&gt;</span>
        ...
    <span class="tag">&lt;/table&gt;</span>
<span class="tag">&lt;/h:form&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>&lt;h:inputText&gt;</code> tags <code>firstName</code> and <code>lastName</code> are bound to the attributes in the <code>Contact</code> entity instance <code>selected</code> in the <code>ContactController</code> stateless session bean.
Each <code>&lt;h:inputText&gt;</code> tag has an associated <code>&lt;h:message&gt;</code> tag that will display validation error messages.
The form doesn&#8217;t require any Jakarta Faces validation tags, however.</p>
</div>
</div>
<div class="sect3">
<h4 id="running-the-address-book-example"><a class="anchor" href="#running-the-address-book-example"></a>Running the address-book Example</h4>
<div class="paragraph">
<p>You can use either NetBeans IDE or Maven to build, package, deploy, and run the <code>address-book</code> application.</p>
</div>
<div class="sect4">
<h5 id="to-run-the-address-book-example-using-netbeans-ide"><a class="anchor" href="#to-run-the-address-book-example-using-netbeans-ide"></a>To Run the address-book Example Using NetBeans IDE</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>If the database server is not already running, start it by following the instructions in <a href="#starting-and-stopping-apache-derby">Starting and Stopping Apache Derby</a>.</p>
</li>
<li>
<p>From the <strong>File</strong> menu, choose <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the <strong>Open Project</strong> dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/persistence</pre>
</div>
</div>
</li>
<li>
<p>Select the <code>address-book</code> folder.</p>
</li>
<li>
<p>Click <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the <strong>Projects</strong> tab, right-click the <code>address-book</code> project and select <strong>Run</strong>.</p>
<div class="paragraph">
<p>After the application has been deployed, a web browser window appears at the following URL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080/address-book/</pre>
</div>
</div>
</li>
<li>
<p>Click Show All Contact Items, then Create New Contact.
Enter values in the fields; then click Save.</p>
<div class="paragraph">
<p>If any of the values entered violate the constraints in <code>Contact</code>, an error message will appear in red beside the field with the incorrect values.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-run-the-address-book-example-using-maven"><a class="anchor" href="#to-run-the-address-book-example-using-maven"></a>To Run the address-book Example Using Maven</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>If the database server is not already running, start it by following the instructions in <a href="#starting-and-stopping-apache-derby">Starting and Stopping Apache Derby</a>.</p>
</li>
<li>
<p>In a terminal window, go to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/persistence/address-book/</pre>
</div>
</div>
</li>
<li>
<p>Enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">mvn install</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will compile and assemble the <code>address-book</code> application into a WAR.
The WAR file is then deployed to GlassFish Server.</p>
</div>
</li>
<li>
<p>Open a web browser window and enter the following URL:</p>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080/address-book/</pre>
</div>
</div>
</li>
<li>
<p>Click Show All Contact Items, then Create New Contact.
Enter values in the fields; then click Save.</p>
<div class="paragraph">
<p>If any of the values entered violate the constraints in <code>Contact</code>, an error message will appear in red beside the field with the incorrect values.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="the-jakarta-persistence-query-language"><a class="anchor" href="#the-jakarta-persistence-query-language"></a>Chapter 42. The Jakarta Persistence Query Language</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter describes the Jakarta Persistence query language that defines queries for entities and their persistent state.
The query language allows you to write portable queries that work regardless of the underlying data store.</p>
</div>
<div class="sect2">
<h3 id="overview-of-the-jakarta-persistence-query-language"><a class="anchor" href="#overview-of-the-jakarta-persistence-query-language"></a>Overview of the Jakarta Persistence Query Language</h3>
<div class="paragraph">
<p>The query language uses the abstract persistence schemas of entities, including their relationships, for its data model and defines operators and expressions based on this data model.
The scope of a query spans the abstract schemas of related entities that are packaged in the same persistence unit.
The query language uses an SQL-like syntax to select objects or values based on entity abstract schema types and relationships among them.</p>
</div>
<div class="paragraph">
<p>This chapter relies on the material presented in earlier chapters.
For conceptual information, see <a href="#introduction-to-jakarta-persistence">Chapter 40, <em>Introduction to Jakarta Persistence</em></a>.
For code examples, see <a href="#running-the-persistence-examples">Chapter 41, <em>Running the Persistence Examples</em></a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="query-language-terminology"><a class="anchor" href="#query-language-terminology"></a>Query Language Terminology</h3>
<div class="paragraph">
<p>The following list defines some of the terms referred to in this chapter.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Abstract schema: The persistent schema abstraction (persistent entities, their state, and their relationships) over which queries operate.
The query language translates queries over this persistent schema abstraction into queries that are executed over the database schema to which entities are mapped.</p>
</li>
<li>
<p>Abstract schema type: The type to which the persistent property of an entity evaluates in the abstract schema.
That is, each persistent field or property in an entity has a corresponding state field of the same type in the abstract schema.
The abstract schema type of an entity is derived from the entity class and the metadata information provided by Java language annotations.</p>
</li>
<li>
<p>Backus-Naur Form (BNF): A notation that describes the syntax of high-level languages.
The syntax diagrams in this chapter are in BNF notation.</p>
</li>
<li>
<p>Navigation: The traversal of relationships in a query language expression.
The navigation operator is a period.</p>
</li>
<li>
<p>Path expression: An expression that navigates to an entity&#8217;s state or relationship field.</p>
</li>
<li>
<p>State field: A persistent field of an entity.</p>
</li>
<li>
<p>Relationship field: A persistent field of an entity whose type is the abstract schema type of the related entity.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="creating-queries-using-the-jakarta-persistence-query-language"><a class="anchor" href="#creating-queries-using-the-jakarta-persistence-query-language"></a>Creating Queries Using the Jakarta Persistence Query Language</h3>
<div class="paragraph">
<p>The <code>EntityManager.createQuery</code> and <code>EntityManager.createNamedQuery</code> methods are used to query the datastore by using Jakarta Persistence query language queries.</p>
</div>
<div class="paragraph">
<p>The <code>createQuery</code> method is used to create dynamic queries, which are queries defined directly within an application&#8217;s business logic:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="predefined-type">List</span> findWithName(<span class="predefined-type">String</span> name) {
<span class="keyword">return</span> em.createQuery(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT c FROM Customer c WHERE c.name LIKE :custName</span><span class="delimiter">&quot;</span></span>)
    .setParameter(<span class="string"><span class="delimiter">&quot;</span><span class="content">custName</span><span class="delimiter">&quot;</span></span>, name)
    .setMaxResults(<span class="integer">10</span>)
    .getResultList();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>createNamedQuery</code> method is used to create static queries, or queries that are defined in metadata by using the <code>jakarta.persistence.NamedQuery</code> annotation.
The <code>name</code> element of <code>@NamedQuery</code> specifies the name of the query that will be used with the <code>createNamedQuery</code> method.
The <code>query</code> element of <code>@NamedQuery</code> is the query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@NamedQuery</span>(
    name=<span class="string"><span class="delimiter">&quot;</span><span class="content">findAllCustomersWithName</span><span class="delimiter">&quot;</span></span>,
    query=<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT c FROM Customer c WHERE c.name LIKE :custName</span><span class="delimiter">&quot;</span></span>
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here&#8217;s an example of <code>createNamedQuery</code>, which uses the <code>@NamedQuery</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@PersistenceContext</span>
<span class="directive">public</span> EntityManager em;
...
customers = em.createNamedQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">findAllCustomersWithName</span><span class="delimiter">&quot;</span></span>)
    .setParameter(<span class="string"><span class="delimiter">&quot;</span><span class="content">custName</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Smith</span><span class="delimiter">&quot;</span></span>)
    .getResultList();</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="named-parameters-in-queries"><a class="anchor" href="#named-parameters-in-queries"></a>Named Parameters in Queries</h4>
<div class="paragraph">
<p>Named parameters are query parameters that are prefixed with a colon (<code>:</code>).
Named parameters in a query are bound to an argument by the following method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">jakarta.persistence.Query.setParameter(<span class="predefined-type">String</span> name, <span class="predefined-type">Object</span> value)</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the following example, the <code>name</code> argument to the <code>findWithName</code> business method is bound to the <code>:custName</code> named parameter in the query by calling <code>Query.setParameter</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="predefined-type">List</span> findWithName(<span class="predefined-type">String</span> name) {
    <span class="keyword">return</span> em.createQuery(
        <span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT c FROM Customer c WHERE c.name LIKE :custName</span><span class="delimiter">&quot;</span></span>)
        .setParameter(<span class="string"><span class="delimiter">&quot;</span><span class="content">custName</span><span class="delimiter">&quot;</span></span>, name)
        .getResultList();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Named parameters are case-sensitive and may be used by both dynamic and static queries.</p>
</div>
</div>
<div class="sect3">
<h4 id="positional-parameters-in-queries"><a class="anchor" href="#positional-parameters-in-queries"></a>Positional Parameters in Queries</h4>
<div class="paragraph">
<p>You may use positional parameters instead of named parameters in queries.
Positional parameters are prefixed with a question mark (<code>?</code>) followed by the numeric position of the parameter in the query.
The method <code>Query.setParameter(integer position, Object value)</code> is used to set the parameter values.</p>
</div>
<div class="paragraph">
<p>In the following example, the <code>findWithName</code> business method is rewritten to use input parameters:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="predefined-type">List</span> findWithName(<span class="predefined-type">String</span> name) {
    <span class="keyword">return</span> em.createQuery(
        <span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT c FROM Customer c WHERE c.name LIKE ?1</span><span class="delimiter">&quot;</span></span>)
        .setParameter(<span class="integer">1</span>, name)
        .getResultList();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Input parameters are numbered starting from 1.
Input parameters are case-sensitive, and may be used by both dynamic and static queries.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="simplified-query-language-syntax"><a class="anchor" href="#simplified-query-language-syntax"></a>Simplified Query Language Syntax</h3>
<div class="paragraph">
<p>This section briefly describes the syntax of the query language so that you can quickly move on to <a href="#example-queries">Example Queries</a>.
When you are ready to learn about the syntax in more detail, see <a href="#full-query-language-syntax">Full Query Language Syntax</a>.</p>
</div>
<div class="sect3">
<h4 id="select-statements"><a class="anchor" href="#select-statements"></a>Select Statements</h4>
<div class="paragraph">
<p>A select query has six clauses: <code>SELECT</code>, <code>FROM</code>, <code>WHERE</code>, <code>GROUP BY</code>, <code>HAVING</code>, and <code>ORDER BY</code>.
The <code>SELECT</code> and <code>FROM</code> clauses are required, but the <code>WHERE</code>, <code>GROUP BY</code>, <code>HAVING</code>, and <code>ORDER BY</code> clauses are optional.
Here is the high-level BNF syntax of a query language select query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">QL_statement ::= select_clause from_clause
  [where_clause][groupby_clause][having_clause][orderby_clause]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The BNF syntax defines the following clauses.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>SELECT</code> clause defines the types of the objects or values returned by the query.</p>
</li>
<li>
<p>The <code>FROM</code> clause defines the scope of the query by declaring one or more identification variables, which can be referenced in the <code>SELECT</code> and <code>WHERE</code> clauses.
An identification variable represents one of the following elements:</p>
<div class="ulist">
<ul>
<li>
<p>The abstract schema name of an entity</p>
</li>
<li>
<p>An element of a collection relationship</p>
</li>
<li>
<p>An element of a single-valued relationship</p>
</li>
<li>
<p>A member of a collection that is the multiple side of a one-to-many relationship</p>
</li>
</ul>
</div>
</li>
<li>
<p>The <code>WHERE</code> clause is a conditional expression that restricts the objects or values retrieved by the query.
Although the clause is optional, most queries have a <code>WHERE</code> clause.</p>
</li>
<li>
<p>The <code>GROUP BY</code> clause groups query results according to a set of properties.</p>
</li>
<li>
<p>The <code>HAVING</code> clause is used with the <code>GROUP BY</code> clause to further restrict the query results according to a conditional expression.</p>
</li>
<li>
<p>The <code>ORDER BY</code> clause sorts the objects or values returned by the query into a specified order.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="update-and-delete-statements"><a class="anchor" href="#update-and-delete-statements"></a>Update and Delete Statements</h4>
<div class="paragraph">
<p>Update and delete statements provide bulk operations over sets of entities.
These statements have the following syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">update_statement :: = update_clause [where_clause]
delete_statement :: = delete_clause [where_clause]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The update and delete clauses determine the type of the entities to be updated or deleted.
The <code>WHERE</code> clause may be used to restrict the scope of the update or delete operation.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="example-queries"><a class="anchor" href="#example-queries"></a>Example Queries</h3>
<div class="paragraph">
<p>The following queries are from the <code>Player</code> entity of the <code>roster</code> application, which is documented in <a href="#the-roster-application">The roster Application</a>.</p>
</div>
<div class="sect3">
<h4 id="simple-queries"><a class="anchor" href="#simple-queries"></a>Simple Queries</h4>
<div class="paragraph">
<p>If you are unfamiliar with the query language, these simple queries are a good place to start.</p>
</div>
<div class="sect4">
<h5 id="a-basic-select-query"><a class="anchor" href="#a-basic-select-query"></a>A Basic Select Query</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">SELECT</span> p
<span class="keyword">FROM</span> Player p</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Data retrieved: All players.</p>
</li>
<li>
<p>Description: The <code>FROM</code> clause declares an identification variable named <code>p</code>, omitting the optional keyword <code>AS</code>.
If the <code>AS</code> keyword were included, the clause would be written as follows:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="keyword">FROM</span> Player <span class="keyword">AS</span> p</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Player</code> element is the abstract schema name of the <code>Player</code> entity.</p>
</div>
</li>
<li>
<p>See also: <a href="#identification-variables">Identification Variables</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="eliminating-duplicate-values"><a class="anchor" href="#eliminating-duplicate-values"></a>Eliminating Duplicate Values</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">SELECT</span> <span class="keyword">DISTINCT</span> p
<span class="keyword">FROM</span> Player p
<span class="keyword">WHERE</span> p.position = <span class="error">?</span><span class="integer">1</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Data retrieved: The players with the position specified by the query&#8217;s parameter.</p>
</li>
<li>
<p>Description: The <code>DISTINCT</code> keyword eliminates duplicate values.</p>
<div class="paragraph">
<p>The <code>WHERE</code> clause restricts the players retrieved by checking their <code>position</code>, a persistent field of the <code>Player</code> entity.
The <code>?1</code> element denotes the input parameter of the query.</p>
</div>
</li>
<li>
<p>See also: <a href="#input-parameters">Input Parameters</a> and <a href="#the-distinct-keyword">The DISTINCT Keyword</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="using-named-parameters"><a class="anchor" href="#using-named-parameters"></a>Using Named Parameters</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">SELECT</span> <span class="keyword">DISTINCT</span> p
<span class="keyword">FROM</span> Player p
<span class="keyword">WHERE</span> p.position = :position <span class="keyword">AND</span> p.name = :name</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Data retrieved: The players having the specified positions and names.</p>
</li>
<li>
<p>Description: The <code>position</code> and <code>name</code> elements are persistent fields of the <code>Player</code> entity.
The <code>WHERE</code> clause compares the values of these fields with the named parameters of the query, set using the <code>Query.setNamedParameter</code> method.
The query language denotes a named input parameter using a colon (<code>:</code>) followed by an identifier.
The first input parameter is <code>:position</code>, the second is <code>:name</code>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="queries-that-navigate-to-related-entities"><a class="anchor" href="#queries-that-navigate-to-related-entities"></a>Queries That Navigate to Related Entities</h4>
<div class="paragraph">
<p>In the query language, an expression can traverse, or navigate, to related entities.
These expressions are the primary difference between the Jakarta Persistence query language and SQL.
Queries navigates to related entities, whereas SQL joins tables.</p>
</div>
<div class="sect4">
<h5 id="a-simple-query-with-relationships"><a class="anchor" href="#a-simple-query-with-relationships"></a>A Simple Query with Relationships</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">SELECT</span> <span class="keyword">DISTINCT</span> p
<span class="keyword">FROM</span> Player p, <span class="keyword">IN</span> (p.teams) t</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Data retrieved: All players who belong to a team.</p>
</li>
<li>
<p>Description: The <code>FROM</code> clause declares two identification variables: <code>p</code> and <code>t</code>.
The <code>p</code> variable represents the <code>Player</code> entity, and the <code>t</code> variable represents the related <code>Team</code> entity.
The declaration for <code>t</code> references the previously declared <code>p</code> variable.
The <code>IN</code> keyword signifies that <code>teams</code> is a collection of related entities.
The <code>p.teams</code> expression navigates from a <code>Player</code> to its related <code>Team</code>.
The period in the <code>p.teams</code> expression is the navigation operator.</p>
<div class="paragraph">
<p>You may also use the <code>JOIN</code> statement to write the same query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">SELECT</span> <span class="keyword">DISTINCT</span> p
<span class="keyword">FROM</span> Player p <span class="keyword">JOIN</span> p.teams t</code></pre>
</div>
</div>
<div class="paragraph">
<p>This query could also be rewritten as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">SELECT</span> <span class="keyword">DISTINCT</span> p
<span class="keyword">FROM</span> Player p
<span class="keyword">WHERE</span> p.team <span class="keyword">IS</span> <span class="keyword">NOT</span> EMPTY</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="navigating-to-single-valued-relationship-fields"><a class="anchor" href="#navigating-to-single-valued-relationship-fields"></a>Navigating to Single-Valued Relationship Fields</h5>
<div class="paragraph">
<p>Use the <code>JOIN</code> clause statement to navigate to a single-valued relationship field:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">SELECT</span> t
<span class="keyword">FROM</span> Team t <span class="keyword">JOIN</span> t.league l
<span class="keyword">WHERE</span> l.sport = <span class="string"><span class="delimiter">'</span><span class="content">soccer</span><span class="delimiter">'</span></span> <span class="keyword">OR</span> l.sport =<span class="string"><span class="delimiter">'</span><span class="content">football</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the query will return all teams that are in either soccer or football leagues.</p>
</div>
</div>
<div class="sect4">
<h5 id="traversing-relationships-with-an-input-parameter"><a class="anchor" href="#traversing-relationships-with-an-input-parameter"></a>Traversing Relationships with an Input Parameter</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">SELECT</span> <span class="keyword">DISTINCT</span> p
<span class="keyword">FROM</span> Player p, <span class="keyword">IN</span> (p.teams) <span class="keyword">AS</span> t
<span class="keyword">WHERE</span> t.city = :city</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Data retrieved: The players whose teams belong to the specified city.</p>
</li>
<li>
<p>Description: This query is similar to the previous example but adds an input parameter.
The <code>AS</code> keyword in the <code>FROM</code> clause is optional.
In the <code>WHERE</code> clause, the period preceding the persistent variable <code>city</code> is a delimiter, not a navigation operator.
Strictly speaking, expressions can navigate to relationship fields (related entities) but not to persistent fields.
To access a persistent field, an expression uses the period as a delimiter.</p>
<div class="paragraph">
<p>Expressions cannot navigate beyond (or further qualify) relationship fields that are collections.
In the syntax of an expression, a collection-valued field is a terminal symbol.
Because the <code>teams</code> field is a collection, the <code>WHERE</code> clause cannot specify <code>p.teams.city</code> (an illegal expression).</p>
</div>
</li>
<li>
<p>See also: <a href="#path-expressions">Path Expressions</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="traversing-multiple-relationships"><a class="anchor" href="#traversing-multiple-relationships"></a>Traversing Multiple Relationships</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">SELECT</span> <span class="keyword">DISTINCT</span> p
<span class="keyword">FROM</span> Player p, <span class="keyword">IN</span> (p.teams) t
<span class="keyword">WHERE</span> t.league = :league</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Data retrieved: The players who belong to the specified league.</p>
</li>
<li>
<p>Description: The expressions in this query navigate over two relationships.
The <code>p.teams</code> expression navigates the <code>Player</code>-<code>Team</code> relationship, and the <code>t.league</code> expression navigates the <code>Team</code>-<code>League</code> relationship.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the other examples, the input parameters are <code>String</code> objects; in this example, the parameter is an object whose type is a <code>League</code>.
This type matches the <code>league</code> relationship field in the comparison expression of the <code>WHERE</code> clause.</p>
</div>
</div>
<div class="sect4">
<h5 id="navigating-according-to-related-fields"><a class="anchor" href="#navigating-according-to-related-fields"></a>Navigating According to Related Fields</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">SELECT</span> <span class="keyword">DISTINCT</span> p
<span class="keyword">FROM</span> Player p, <span class="keyword">IN</span> (p.teams) t
<span class="keyword">WHERE</span> t.league.sport = :sport</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Data retrieved: The players who participate in the specified sport.</p>
</li>
<li>
<p>Description: The <code>sport</code> persistent field belongs to the <code>League</code> entity.
To reach the <code>sport</code> field, the query must first navigate from the <code>Player</code> entity to <code>Team</code> (<code>p.teams</code>) and then from <code>Team</code> to the <code>League</code> entity (<code>t.league</code>).
Because it is not a collection, the <code>league</code> relationship field can be followed by the <code>sport</code> persistent field.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="queries-with-other-conditional-expressions"><a class="anchor" href="#queries-with-other-conditional-expressions"></a>Queries with Other Conditional Expressions</h4>
<div class="paragraph">
<p>Every <code>WHERE</code> clause must specify a conditional expression, of which there are several kinds.
In the previous examples, the conditional expressions are comparison expressions that test for equality.
The following examples demonstrate some of the other kinds of conditional expressions.
For descriptions of all conditional expressions, see <a href="#where-clause">WHERE Clause</a>.</p>
</div>
<div class="sect4">
<h5 id="the-like-expression"><a class="anchor" href="#the-like-expression"></a>The LIKE Expression</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">SELECT</span> p
<span class="keyword">FROM</span> Player p
<span class="keyword">WHERE</span> p.name <span class="keyword">LIKE</span> <span class="string"><span class="delimiter">'</span><span class="content">Mich%</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Data retrieved: All players whose names begin with "Mich."</p>
</li>
<li>
<p>Description: The <code>LIKE</code> expression uses wildcard characters to search for strings that match the wildcard pattern.
In this case, the query uses the <code>LIKE</code> expression and the <code>%</code> wildcard to find all players whose names begin with the string "Mich." For example, "Michael" and "Michelle" both match the wildcard pattern.</p>
</li>
<li>
<p>See also: <a href="#like-expressions">LIKE Expressions</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="the-is-null-expression"><a class="anchor" href="#the-is-null-expression"></a>The IS NULL Expression</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">SELECT</span> t
<span class="keyword">FROM</span> Team t
<span class="keyword">WHERE</span> t.league <span class="keyword">IS</span> <span class="predefined-constant">NULL</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Data retrieved: All teams not associated with a league.</p>
</li>
<li>
<p>Description: The <code>IS NULL</code> expression can be used to check whether a relationship has been set between two entities.
In this case, the query checks whether the teams are associated with any leagues and returns the teams that do not have a league.</p>
</li>
<li>
<p>See also: <a href="#null-comparison-expressions">NULL Comparison Expressions</a> and <a href="#null-values">NULL Values</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="the-is-empty-expression"><a class="anchor" href="#the-is-empty-expression"></a>The IS EMPTY Expression</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">SELECT</span> p
<span class="keyword">FROM</span> Player p
<span class="keyword">WHERE</span> p.teams <span class="keyword">IS</span> EMPTY</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Data retrieved: All players who do not belong to a team.</p>
</li>
<li>
<p>Description: The <code>teams</code> relationship field of the <code>Player</code> entity is a collection.
If a player does not belong to a team, the <code>teams</code> collection is empty, and the conditional expression is <code>TRUE</code>.</p>
</li>
<li>
<p>See also: <a href="#empty-collection-comparison-expressions">Empty Collection Comparison Expressions</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="the-between-expression"><a class="anchor" href="#the-between-expression"></a>The BETWEEN Expression</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">SELECT</span> <span class="keyword">DISTINCT</span> p
<span class="keyword">FROM</span> Player p
<span class="keyword">WHERE</span> p.salary <span class="keyword">BETWEEN</span> :lowerSalary <span class="keyword">AND</span> :higherSalary</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Data retrieved: The players whose salaries fall within the range of the specified salaries.</p>
</li>
<li>
<p>Description: This <code>BETWEEN</code> expression has three arithmetic expressions: a persistent field (<code>p.salary</code>) and the two input parameters (<code>:lowerSalary</code> and <code>:higherSalary</code>).
The following expression is equivalent to the <code>BETWEEN</code> expression:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql">p.salary &gt;= :lowerSalary <span class="keyword">AND</span> p.salary &lt;= :higherSalary</code></pre>
</div>
</div>
</li>
<li>
<p>See also: <a href="#between-expressions">BETWEEN Expressions</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="comparison-operators"><a class="anchor" href="#comparison-operators"></a>Comparison Operators</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">SELECT</span> <span class="keyword">DISTINCT</span> p1
<span class="keyword">FROM</span> Player p1, Player p2
<span class="keyword">WHERE</span> p1.salary &gt; p2.salary <span class="keyword">AND</span> p2.name = :name</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Data retrieved: All players whose salaries are higher than the salary of the player with the specified name.</p>
</li>
<li>
<p>Description: The <code>FROM</code> clause declares two identification variables (<code>p1</code> and <code>p2</code>) of the same type (<code>Player</code>).
Two identification variables are needed because the <code>WHERE</code> clause compares the salary of one player (<code>p2</code>) with that of the other players (<code>p1</code>).</p>
</li>
<li>
<p>See also: <a href="#identification-variables">Identification Variables</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="bulk-updates-and-deletes"><a class="anchor" href="#bulk-updates-and-deletes"></a>Bulk Updates and Deletes</h4>
<div class="paragraph">
<p>The following examples show how to use the <code>UPDATE</code> and <code>DELETE</code> expressions in queries.
<code>UPDATE</code> and <code>DELETE</code> operate on multiple entities according to the condition or conditions set in the <code>WHERE</code> clause.
The <code>WHERE</code> clause in <code>UPDATE</code> and <code>DELETE</code> queries follows the same rules as <code>SELECT</code> queries.</p>
</div>
<div class="sect4">
<h5 id="update-queries"><a class="anchor" href="#update-queries"></a>Update Queries</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">UPDATE</span> Player p
<span class="class">SET</span> p.status = <span class="string"><span class="delimiter">'</span><span class="content">inactive</span><span class="delimiter">'</span></span>
<span class="keyword">WHERE</span> p.lastPlayed &lt; :inactiveThresholdDate</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Description: This query sets the status of a set of players to <code>inactive</code> if the player&#8217;s last game was longer ago than the date specified in <code>inactiveThresholdDate</code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="delete-queries"><a class="anchor" href="#delete-queries"></a>Delete Queries</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">DELETE</span>
<span class="keyword">FROM</span> Player p
<span class="keyword">WHERE</span> p.status = <span class="string"><span class="delimiter">'</span><span class="content">inactive</span><span class="delimiter">'</span></span>
<span class="keyword">AND</span> p.teams <span class="keyword">IS</span> EMPTY</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Description: This query deletes all inactive players who are not on a team.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="full-query-language-syntax"><a class="anchor" href="#full-query-language-syntax"></a>Full Query Language Syntax</h3>
<div class="paragraph">
<p>This section discusses the query language syntax, as defined in the Jakarta Persistence 3.0 specification available at <a href="https://jakarta.ee/specifications/persistence/3.0/" class="bare" target="_blank" rel="noopener">https://jakarta.ee/specifications/persistence/3.0/</a>.
Much of the following material paraphrases or directly quotes the specification.</p>
</div>
<div class="sect3">
<h4 id="bnf-symbols"><a class="anchor" href="#bnf-symbols"></a>BNF Symbols</h4>
<div class="paragraph">
<p><a href="#bnf-symbol-summary">Table 42-1</a> describes the BNF symbols used in this chapter.</p>
</div>
<table id="bnf-symbol-summary" class="tableblock frame-all grid-all" style="width: 75%;">
<caption class="title">Table 42-1 BNF Symbol Summary</caption>
<colgroup>
<col style="width: 35.7142%;">
<col style="width: 64.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Symbol</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>::=</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The element to the left of the symbol is defined by the constructs on the right.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>*</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The preceding construct may occur zero or more times.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{&#8230;&#8203;}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The constructs within the braces are grouped together.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[&#8230;&#8203;]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The constructs within the brackets are optional.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>|</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An exclusive <code>OR</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BOLDFACE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A keyword; although capitalized in the BNF diagram, keywords are not case-sensitive.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">White space</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A whitespace character can be a space, a horizontal tab, or a line feed.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="bnf-grammar-of-the-jakarta-persistence-query-language"><a class="anchor" href="#bnf-grammar-of-the-jakarta-persistence-query-language"></a>BNF Grammar of the Jakarta Persistence Query Language</h4>
<div class="paragraph">
<p>Here is the entire BNF diagram for the query language:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql">QL_statement ::= select_statement | update_statement | delete_statement
select_statement ::= select_clause from_clause [where_clause] [groupby_clause]
    [having_clause] [orderby_clause]
update_statement ::= update_clause [where_clause]
delete_statement ::= delete_clause [where_clause]
from_clause ::=
    <span class="keyword">FROM</span> identification_variable_declaration
        {, {identification_variable_declaration |
            collection_member_declaration}}*
identification_variable_declaration ::=
        range_variable_declaration { <span class="keyword">join</span> | fetch_join }*
range_variable_declaration ::= abstract_schema_name [<span class="keyword">AS</span>]
        identification_variable
<span class="keyword">join</span> ::= join_spec join_association_path_expression [<span class="keyword">AS</span>]
        identification_variable
fetch_join ::= join_specFETCH join_association_path_expression
association_path_expression ::=
        collection_valued_path_expression |
        single_valued_association_path_expression
join_spec::= [<span class="keyword">LEFT</span> [<span class="keyword">OUTER</span>] |<span class="keyword">INNER</span>] <span class="keyword">JOIN</span>
join_association_path_expression ::=
        join_collection_valued_path_expression |
        join_single_valued_association_path_expression
join_collection_valued_path_expression::=
    identification_variable.collection_valued_association_field
join_single_valued_association_path_expression::=
        identification_variable.single_valued_association_field
collection_member_declaration ::=
        <span class="keyword">IN</span> (collection_valued_path_expression) [<span class="keyword">AS</span>]
        identification_variable
single_valued_path_expression ::=
        state_field_path_expression |
        single_valued_association_path_expression
state_field_path_expression ::=
    {identification_variable |
    single_valued_association_path_expression}.state_field
single_valued_association_path_expression ::=
    identification_variable.{single_valued_association_field.}*
    single_valued_association_field
collection_valued_path_expression ::=
    identification_variable.{single_valued_association_field.}*
    collection_valued_association_field
state_field ::=
    {embedded_class_state_field.}*simple_state_field
update_clause ::=<span class="class">UPDATE</span> abstract_schema_name [[<span class="keyword">AS</span>]
    identification_variable] <span class="class">SET</span> update_item {, update_item}*
update_item ::= [identification_variable.]{state_field |
    single_valued_association_field} = new_value
new_value ::=
     simple_arithmetic_expression |
    string_primary |
    datetime_primary |
    boolean_primary |
    enum_primary simple_entity_expression |
    <span class="predefined-constant">NULL</span>
delete_clause ::= <span class="class">DELETE</span> <span class="keyword">FROM</span> abstract_schema_name [[<span class="keyword">AS</span>]
    identification_variable]
select_clause ::= <span class="class">SELECT</span> [<span class="keyword">DISTINCT</span>] select_expression {,
    select_expression}*
select_expression ::=
    single_valued_path_expression |
    aggregate_expression |
    identification_variable |
    OBJECT(identification_variable) |
    constructor_expression
constructor_expression ::=
    NEW constructor_name(constructor_item {,
    constructor_item}*)
constructor_item ::= single_valued_path_expression |
    aggregate_expression
aggregate_expression ::=
    {<span class="predefined">AVG</span> |<span class="predefined">MAX</span> |<span class="predefined">MIN</span> |<span class="predefined">SUM</span>} ([<span class="keyword">DISTINCT</span>]
        state_field_path_expression) |
    <span class="predefined">COUNT</span> ([<span class="keyword">DISTINCT</span>] identification_variable |
        state_field_path_expression |
        single_valued_association_path_expression)
where_clause ::= <span class="keyword">WHERE</span> conditional_expression
groupby_clause ::= <span class="keyword">GROUP</span> <span class="keyword">BY</span> groupby_item {, groupby_item}*
groupby_item ::= single_valued_path_expression
having_clause ::= <span class="keyword">HAVING</span> conditional_expression
orderby_clause ::= <span class="keyword">ORDER</span> <span class="keyword">BY</span> orderby_item {, orderby_item}*
orderby_item ::= state_field_path_expression [<span class="directive">ASC</span> |<span class="directive">DESC</span>]
subquery ::= simple_select_clause subquery_from_clause
    [where_clause] [groupby_clause] [having_clause]
subquery_from_clause ::=
    <span class="keyword">FROM</span> subselect_identification_variable_declaration
        {, subselect_identification_variable_declaration}*
subselect_identification_variable_declaration ::=
    identification_variable_declaration |
    association_path_expression [<span class="keyword">AS</span>] identification_variable |
    collection_member_declaration
simple_select_clause ::= <span class="class">SELECT</span> [<span class="keyword">DISTINCT</span>]
    simple_select_expression
simple_select_expression::=
    single_valued_path_expression |
    aggregate_expression |
    identification_variable
conditional_expression ::= conditional_term |
    conditional_expression <span class="keyword">OR</span> conditional_term
conditional_term ::= conditional_factor | conditional_term <span class="keyword">AND</span>
    conditional_factor
conditional_factor ::= [<span class="keyword">NOT</span>] conditional_primary
conditional_primary ::= simple_cond_expression |(
    conditional_expression)
simple_cond_expression ::=
    comparison_expression |
    between_expression |
    like_expression |
    in_expression |
    null_comparison_expression |
    empty_collection_comparison_expression |
    collection_member_expression |
    exists_expression
between_expression ::=
    arithmetic_expression [<span class="keyword">NOT</span>] <span class="keyword">BETWEEN</span>
        arithmetic_expressionAND arithmetic_expression |
    string_expression [<span class="keyword">NOT</span>] <span class="keyword">BETWEEN</span> string_expression <span class="keyword">AND</span>
        string_expression |
    datetime_expression [<span class="keyword">NOT</span>] <span class="keyword">BETWEEN</span>
        datetime_expression <span class="keyword">AND</span> datetime_expression
in_expression ::=
    state_field_path_expression [<span class="keyword">NOT</span>] <span class="keyword">IN</span> (in_item {, in_item}*
    | subquery)
in_item ::= literal | input_parameter
like_expression ::=
    string_expression [<span class="keyword">NOT</span>] <span class="keyword">LIKE</span> pattern_value [ESCAPE
        escape_character]
null_comparison_expression ::=
    {single_valued_path_expression | input_parameter} <span class="keyword">IS</span> [<span class="keyword">NOT</span>]
        <span class="predefined-constant">NULL</span>
empty_collection_comparison_expression ::=
    collection_valued_path_expression <span class="keyword">IS</span> [<span class="keyword">NOT</span>] EMPTY
collection_member_expression ::= entity_expression
    [<span class="keyword">NOT</span>] MEMBER [<span class="keyword">OF</span>] collection_valued_path_expression
exists_expression::= [<span class="keyword">NOT</span>] <span class="keyword">EXISTS</span> (subquery)
all_or_any_expression ::= {<span class="keyword">ALL</span> |<span class="keyword">ANY</span> |SOME} (subquery)
comparison_expression ::=
    string_expression comparison_operator {string_expression |
    all_or_any_expression} |
    boolean_expression {= |&lt;&gt; } {boolean_expression |
    all_or_any_expression} |
    enum_expression {= |&lt;&gt; } {enum_expression |
    all_or_any_expression} |
    datetime_expression comparison_operator
        {datetime_expression | all_or_any_expression} |
    entity_expression {= |&lt;&gt; } {entity_expression |
    all_or_any_expression} |
    arithmetic_expression comparison_operator
        {arithmetic_expression | all_or_any_expression}
comparison_operator ::= = |&gt; |&gt;= |&lt; |&lt;= |&lt;&gt;
arithmetic_expression ::= simple_arithmetic_expression |
    (subquery)
simple_arithmetic_expression ::=
    arithmetic_term | simple_arithmetic_expression {+ |- }
        arithmetic_term
arithmetic_term ::= arithmetic_factor | arithmetic_term {* |/ }
    arithmetic_factor
arithmetic_factor ::= [{+ |- }] arithmetic_primary
arithmetic_primary ::=
    state_field_path_expression |
    numeric_literal |
    (simple_arithmetic_expression) |
    input_parameter |
    functions_returning_numerics |
    aggregate_expression
string_expression ::= string_primary | (subquery)
string_primary ::=
    state_field_path_expression |
    string_literal |
    input_parameter |
    functions_returning_strings |
    aggregate_expression
datetime_expression ::= datetime_primary | (subquery)
datetime_primary ::=
    state_field_path_expression |
    input_parameter |
    functions_returning_datetime |
    aggregate_expression
boolean_expression ::= boolean_primary | (subquery)
boolean_primary ::=
    state_field_path_expression |
    boolean_literal |
    input_parameter
 enum_expression ::= enum_primary | (subquery)
enum_primary ::=
    state_field_path_expression |
    enum_literal |
    input_parameter
entity_expression ::=
    single_valued_association_path_expression |
        simple_entity_expression
simple_entity_expression ::=
    identification_variable |
    input_parameter
functions_returning_numerics::=
    LENGTH(string_primary) |
    LOCATE(string_primary, string_primary[,
        simple_arithmetic_expression]) |
    <span class="predefined">ABS</span>(simple_arithmetic_expression) |
    SQRT(simple_arithmetic_expression) |
    MOD(simple_arithmetic_expression,
        simple_arithmetic_expression) |
    SIZE(collection_valued_path_expression)
functions_returning_datetime ::=
    CURRENT_DATE |
    CURRENT_TIME |
    CURRENT_TIMESTAMP
functions_returning_strings ::=
    CONCAT(string_primary, string_primary) |
    <span class="predefined">SUBSTRING</span>(string_primary,
        simple_arithmetic_expression,
        simple_arithmetic_expression)|
    TRIM([[trim_specification] [trim_character] <span class="keyword">FROM</span>]
        string_primary) |
    LOWER(string_primary) |
    UPPER(string_primary)
trim_specification ::= LEADING | TRAILING | BOTH</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="from-clause"><a class="anchor" href="#from-clause"></a>FROM Clause</h4>
<div class="paragraph">
<p>The <code>FROM</code> clause defines the domain of the query by declaring identification variables.</p>
</div>
<div class="sect4">
<h5 id="identifiers"><a class="anchor" href="#identifiers"></a>Identifiers</h5>
<div class="paragraph">
<p>An identifier is a sequence of one or more characters.
The first character must be a valid first character (letter, <code>$</code>, <code>_</code>) in an identifier of the Java programming language, hereafter in this chapter called simply &#8220;Java&#8221;.
Each subsequent character in the sequence must be a valid nonfirst character (letter, digit, <code>$</code>, <code>_</code>) in a Java identifier.
(For details, see the Java SE API documentation of the <code>isJavaIdentifierStart</code> and <code>isJavaIdentifierPart</code> methods of the <code>Character</code> class.)
The question mark (<code>?</code>) is a reserved character in the query language and cannot be used in an identifier.</p>
</div>
<div class="paragraph">
<p>A query language identifier is case-sensitive, with two exceptions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Keywords</p>
</li>
<li>
<p>Identification variables</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An identifier cannot be the same as a query language keyword.
Here is a list of query language keywords:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 75%;">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ABS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ALL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AND</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ANY</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ASC</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AVG</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BETWEEN</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BIT_LENGTH</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BOTH</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BY</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CASE</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CHAR_LENGTH</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CHARACTER_LENGTH</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CLASS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>COALESCE</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CONCAT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>COUNT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CURRENT_DATE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CURRENT_TIMESTAMP</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DELETE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DESC</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DISTINCT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ELSE</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>EMPTY</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>END</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ENTRY</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ESCAPE</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>EXISTS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FALSE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FETCH</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FROM</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GROUP</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>HAVING</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>INDEX</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>INNER</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JOIN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>KEY</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LEADING</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LEFT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LENGTH</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LIKE</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LOCATE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LOWER</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MAX</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MEMBER</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MIN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MOD</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEW</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NOT</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NULL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NULLIF</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OBJECT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OF</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OR</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ORDER</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OUTER</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>POSITION</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SELECT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SET</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SIZE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SOME</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SQRT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SUBSTRING</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SUM</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>THEN</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRAILING</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRIM</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRUE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TYPE</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>UNKNOWN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>UPDATE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>UPPER</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VALUE</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>WHEN</code></p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>WHERE</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>It is not recommended that you use an SQL keyword as an identifier, because the list of keywords may expand to include other reserved SQL words in the future.</p>
</div>
</div>
<div class="sect4">
<h5 id="identification-variables"><a class="anchor" href="#identification-variables"></a>Identification Variables</h5>
<div class="paragraph">
<p>An identification variable is an identifier declared in the <code>FROM</code> clause.
Although they can reference identification variables, the <code>SELECT</code> and <code>WHERE</code> clauses cannot declare them.
All identification variables must be declared in the <code>FROM</code> clause.</p>
</div>
<div class="paragraph">
<p>Because it is an identifier, an identification variable has the same naming conventions and restrictions as an identifier, with the exception that an identification variable is case-insensitive.
For example, an identification variable cannot be the same as a query language keyword.
(See <a href="#identifiers">Identifiers</a> for more naming rules.)
Also, within a given persistence unit, an identification variable name must not match the name of any entity or abstract schema.</p>
</div>
<div class="paragraph">
<p>The <code>FROM</code> clause can contain multiple declarations, separated by commas.
A declaration can reference another identification variable that has been previously declared (to the left).
In the following <code>FROM</code> clause, the variable <code>t</code> references the previously declared variable <code>p</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="keyword">FROM</span> Player p, <span class="keyword">IN</span> (p.teams) <span class="keyword">AS</span> t</code></pre>
</div>
</div>
<div class="paragraph">
<p>Even if it is not used in the <code>WHERE</code> clause, an identification variable&#8217;s declaration can affect the results of the query.
For example, compare the next two queries.
The following query returns all players, whether or not they belong to a team:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">SELECT</span> p
<span class="keyword">FROM</span> Player p</code></pre>
</div>
</div>
<div class="paragraph">
<p>In contrast, because it declares the <code>t</code> identification variable, the next query fetches all players who belong to a team:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">SELECT</span> p
<span class="keyword">FROM</span> Player p, <span class="keyword">IN</span> (p.teams) <span class="keyword">AS</span> t</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following query returns the same results as the preceding query, but the <code>WHERE</code> clause makes it easier to read:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">SELECT</span> p
<span class="keyword">FROM</span> Player p
<span class="keyword">WHERE</span> p.teams <span class="keyword">IS</span> <span class="keyword">NOT</span> EMPTY</code></pre>
</div>
</div>
<div class="paragraph">
<p>An identification variable always designates a reference to a single value whose type is that of the expression used in the declaration.
There are two kinds of declarations: range variable and collection member.</p>
</div>
</div>
<div class="sect4">
<h5 id="range-variable-declarations"><a class="anchor" href="#range-variable-declarations"></a>Range Variable Declarations</h5>
<div class="paragraph">
<p>To declare an identification variable as an abstract schema type, you specify a range variable declaration.
In other words, an identification variable can range over the abstract schema type of an entity.
In the following example, an identification variable named <code>p</code> represents the abstract schema named <code>Player</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="keyword">FROM</span> Player p</code></pre>
</div>
</div>
<div class="paragraph">
<p>A range variable declaration can include the optional <code>AS</code> operator:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="keyword">FROM</span> Player <span class="keyword">AS</span> p</code></pre>
</div>
</div>
<div class="paragraph">
<p>To obtain objects, a query usually uses path expressions to navigate through the relationships.
But for those objects that cannot be obtained by navigation, you can use a range variable declaration to designate a starting point, or query root.</p>
</div>
<div class="paragraph">
<p>If the query compares multiple values of the same abstract schema type, the <code>FROM</code> clause must declare multiple identification variables for the abstract schema:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="keyword">FROM</span> Player p1, Player p2</code></pre>
</div>
</div>
<div class="paragraph">
<p>For an example of such a query, see <a href="#comparison-operators">Comparison Operators</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="collection-member-declarations"><a class="anchor" href="#collection-member-declarations"></a>Collection Member Declarations</h5>
<div class="paragraph">
<p>In a one-to-many relationship, the multiple side consists of a collection of entities.
An identification variable can represent a member of this collection.
To access a collection member, the path expression in the variable&#8217;s declaration navigates through the relationships in the abstract schema.
(For more information on path expressions, see <a href="#path-expressions">Path Expressions</a>.) Because a path expression can be based on another path expression, the navigation can traverse several relationships.
See <a href="#traversing-multiple-relationships">Traversing Multiple Relationships</a>.</p>
</div>
<div class="paragraph">
<p>A collection member declaration must include the <code>IN</code> operator but can omit the optional <code>AS</code> operator.</p>
</div>
<div class="paragraph">
<p>In the following example, the entity represented by the abstract schema named <code>Player</code> has a relationship field called <code>teams</code>.
The identification variable called <code>t</code> represents a single member of the <code>teams</code> collection:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="keyword">FROM</span> Player p, <span class="keyword">IN</span> (p.teams) t</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="joins"><a class="anchor" href="#joins"></a>Joins</h5>
<div class="paragraph">
<p>The <code>JOIN</code> operator is used to traverse over relationships between entities and is functionally similar to the <code>IN</code> operator.</p>
</div>
<div class="paragraph">
<p>In the following example, the query joins over the relationship between customers and orders:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">SELECT</span> c
<span class="keyword">FROM</span> Customer c <span class="keyword">JOIN</span> c.orders o
<span class="keyword">WHERE</span> c.status = <span class="integer">1</span> <span class="keyword">AND</span> o.totalPrice &gt; <span class="integer">10000</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>INNER</code> keyword is optional:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">SELECT</span> c
<span class="keyword">FROM</span> Customer c <span class="keyword">INNER</span> <span class="keyword">JOIN</span> c.orders o
<span class="keyword">WHERE</span> c.status = <span class="integer">1</span> <span class="keyword">AND</span> o.totalPrice &gt; <span class="integer">10000</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>These examples are equivalent to the following query, which uses the <code>IN</code> operator:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">SELECT</span> c
<span class="keyword">FROM</span> Customer c, <span class="keyword">IN</span> (c.orders) o
<span class="keyword">WHERE</span> c.status = <span class="integer">1</span> <span class="keyword">AND</span> o.totalPrice &gt; <span class="integer">10000</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also join a single-valued relationship:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">SELECT</span> t
<span class="keyword">FROM</span> Team t <span class="keyword">JOIN</span> t.league l
<span class="keyword">WHERE</span> l.sport = :sport</code></pre>
</div>
</div>
<div class="paragraph">
<p>A <code>LEFT JOIN</code> or <code>LEFT OUTER JOIN</code> retrieves a set of entities where matching values in the join condition may be absent.
The <code>OUTER</code> keyword is optional:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">SELECT</span> c.name, o.totalPrice
<span class="keyword">FROM</span> CustomerOrder o <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> o.customer c</code></pre>
</div>
</div>
<div class="paragraph">
<p>A <code>FETCH JOIN</code> is a join operation that returns associated entities as a side effect of running the query.
In the following example, the query returns a set of departments and, as a side effect, the associated employees of the departments, even though the employees were not explicitly retrieved by the <code>SELECT</code> clause:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">SELECT</span> d
<span class="keyword">FROM</span> Department d <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> FETCH d.employees
<span class="keyword">WHERE</span> d.deptno = <span class="integer">1</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="path-expressions"><a class="anchor" href="#path-expressions"></a>Path Expressions</h4>
<div class="paragraph">
<p>Path expressions are important constructs in the syntax of the query language for several reasons.
First, path expressions define navigation paths through the relationships in the abstract schema.
These path definitions affect both the scope and the results of a query.
Second, path expressions can appear in any of the main clauses of a query (<code>SELECT</code>, <code>DELETE</code>, <code>HAVING</code>, <code>UPDATE</code>, <code>WHERE</code>, <code>FROM</code>, <code>GROUP BY</code>, <code>ORDER BY</code>).
Finally, although much of the query language is a subset of SQL, path expressions are extensions not found in SQL.</p>
</div>
<div class="sect4">
<h5 id="examples-of-path-expressions"><a class="anchor" href="#examples-of-path-expressions"></a>Examples of Path Expressions</h5>
<div class="paragraph">
<p>Here, the <code>WHERE</code> clause contains a <code>single_valued_path_expression</code>; the <code>p</code> is an identification variable, and <code>salary</code> is a persistent field of <code>Player</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">SELECT</span> <span class="keyword">DISTINCT</span> p
<span class="keyword">FROM</span> Player p
<span class="keyword">WHERE</span> p.salary <span class="keyword">BETWEEN</span> :lowerSalary <span class="keyword">AND</span> :higherSalary</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, the <code>WHERE</code> clause also contains a <code>single_valued_path_expression</code>; <code>t</code> is an identification variable, <code>league</code> is a single-valued relationship field, and <code>sport</code> is a persistent field of <code>league</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">SELECT</span> <span class="keyword">DISTINCT</span> p
<span class="keyword">FROM</span> Player p, <span class="keyword">IN</span> (p.teams) t
<span class="keyword">WHERE</span> t.league.sport = :sport</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, the <code>WHERE</code> clause contains a <code>collection_valued_path_expression</code>; <code>p</code> is an identification variable, and <code>teams</code> designates a collection-valued relationship field:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">SELECT</span> <span class="keyword">DISTINCT</span> p
<span class="keyword">FROM</span> Player p
<span class="keyword">WHERE</span> p.teams <span class="keyword">IS</span> EMPTY</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="expression-types"><a class="anchor" href="#expression-types"></a>Expression Types</h5>
<div class="paragraph">
<p>The type of a path expression is the type of the object represented by the ending element, which can be one of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Persistent field</p>
</li>
<li>
<p>Single-valued relationship field</p>
</li>
<li>
<p>Collection-valued relationship field</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, the type of the expression <code>p.salary</code> is <code>double</code> because the terminating persistent field (<code>salary</code>) is a <code>double</code>.</p>
</div>
<div class="paragraph">
<p>In the expression <code>p.teams</code>, the terminating element is a collection-valued relationship field (<code>teams</code>).
This expression&#8217;s type is a collection of the abstract schema type named <code>Team</code>.
Because <code>Team</code> is the abstract schema name for the <code>Team</code> entity, this type maps to the entity.
For more information on the type mapping of abstract schemas, see <a href="#return-types">Return Types</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="navigation"><a class="anchor" href="#navigation"></a>Navigation</h5>
<div class="paragraph">
<p>A path expression enables the query to navigate to related entities.
The terminating elements of an expression determine whether navigation is allowed.
If an expression contains a single-valued relationship field, the navigation can continue to an object that is related to the field.
However, an expression cannot navigate beyond a persistent field or a collection-valued relationship field.
For example, the expression <code>p.teams.league.sport</code> is illegal because <code>teams</code> is a collection-valued relationship field.
To reach the <code>sport</code> field, the <code>FROM</code> clause could define an identification variable named <code>t</code> for the <code>teams</code> field:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="keyword">FROM</span> Player <span class="keyword">AS</span> p, <span class="keyword">IN</span> (p.teams) t
<span class="keyword">WHERE</span> t.league.sport = <span class="string"><span class="delimiter">'</span><span class="content">soccer</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="where-clause"><a class="anchor" href="#where-clause"></a>WHERE Clause</h4>
<div class="paragraph">
<p>The <code>WHERE</code> clause specifies a conditional expression that limits the values returned by the query.
The query returns all corresponding values in the data store for which the conditional expression is <code>TRUE</code>.
Although usually specified, the <code>WHERE</code> clause is optional.
If the <code>WHERE</code> clause is omitted, the query returns all values.
The high-level syntax for the <code>WHERE</code> clause is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql">where_clause ::= <span class="keyword">WHERE</span> conditional_expression</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="literals"><a class="anchor" href="#literals"></a>Literals</h5>
<div class="paragraph">
<p>There are four kinds of literals: string, numeric, Boolean, and enum.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>String literals: A string literal is enclosed in single quotes:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="string"><span class="delimiter">'</span><span class="content">Duke</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If a string literal contains a single quote, you indicate the quote by using two single quotes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="string"><span class="delimiter">'</span><span class="content">Duke</span><span class="delimiter">'</span></span><span class="string"><span class="delimiter">'</span><span class="content">s</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Like a Java <code>String</code>, a string literal in the query language uses the Unicode character encoding.</p>
</div>
</li>
<li>
<p>Numeric literals: There are two types of numeric literals: exact and approximate.</p>
<div class="ulist">
<ul>
<li>
<p>An exact numeric literal is a numeric value without a decimal point, such as 65, 233, and +12.
Using the Java integer syntax, exact numeric literals support numbers in the range of a Java <code>long</code>.</p>
</li>
<li>
<p>An approximate numeric literal is a numeric value in scientific notation, such as 57., 85.7, and +2.1.
Using the syntax of the Java floating-point literal, approximate numeric literals support numbers in the range of a Java <code>double</code>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Boolean literals: A Boolean literal is either <code>TRUE</code> or <code>FALSE</code>.
These keywords are not case-sensitive.</p>
</li>
<li>
<p>Enum literals: The Jakarta Persistence query language supports the use of enum literals using the Java enum literal syntax.
The enum class name must be specified as a fully qualified class name:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">SELECT</span> e
<span class="keyword">FROM</span> Employee e
<span class="keyword">WHERE</span> e.status = com.example.EmployeeStatus.FULL_TIME</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="input-parameters"><a class="anchor" href="#input-parameters"></a>Input Parameters</h5>
<div class="paragraph">
<p>An input parameter can be either a named parameter or a positional parameter.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A named input parameter is designated by a colon (<code>:</code>) followed by a string; for example, <code>:name</code>.</p>
</li>
<li>
<p>A positional input parameter is designated by a question mark (<code>?</code>) followed by an integer.
For example, the first input parameter is <code>?1</code>, the second is <code>?2</code>, and so forth.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following rules apply to input parameters.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>They can be used only in a <code>WHERE</code> or <code>HAVING</code> clause.</p>
</li>
<li>
<p>Positional parameters must be numbered, starting with the integer 1.</p>
</li>
<li>
<p>Named parameters and positional parameters may not be mixed in a single query.</p>
</li>
<li>
<p>Named parameters are case-sensitive.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="conditional-expressions"><a class="anchor" href="#conditional-expressions"></a>Conditional Expressions</h5>
<div class="paragraph">
<p>A <code>WHERE</code> clause consists of a conditional expression, which is evaluated from left to right within a precedence level.
You can change the order of evaluation by using parentheses.</p>
</div>
</div>
<div class="sect4">
<h5 id="operators-and-their-precedence"><a class="anchor" href="#operators-and-their-precedence"></a>Operators and Their Precedence</h5>
<div class="paragraph">
<p><a href="#query-language-order-precedence">Table 42-2</a> lists the query language operators in order of decreasing precedence.</p>
</div>
<table id="query-language-order-precedence" class="tableblock frame-all grid-all" style="width: 75%;">
<caption class="title">Table 42-2 Query Language Order Precedence</caption>
<colgroup>
<col style="width: 35.7142%;">
<col style="width: 64.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Precedence Order</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Navigation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.</code> (a period)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Arithmetic</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>+ </code> (unary)</p>
</div>
<div class="paragraph">
<p><code>* /</code> (multiplication and division)</p>
</div>
<div class="paragraph">
<p><code>+ </code> (addition and subtraction)</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comparison</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>=</code></p>
</div>
<div class="paragraph">
<p><code>&gt;</code></p>
</div>
<div class="paragraph">
<p><code>&gt;=</code></p>
</div>
<div class="paragraph">
<p><code>&lt;</code></p>
</div>
<div class="paragraph">
<p><code>&#8656;</code></p>
</div>
<div class="paragraph">
<p><code>&lt;&gt;</code> (not equal)</p>
</div>
<div class="paragraph">
<p><code>[NOT] BETWEEN</code></p>
</div>
<div class="paragraph">
<p><code>[NOT] LIKE</code></p>
</div>
<div class="paragraph">
<p><code>[NOT] IN</code></p>
</div>
<div class="paragraph">
<p><code>IS [NOT] NULL</code></p>
</div>
<div class="paragraph">
<p><code>IS [NOT] EMPTY</code></p>
</div>
<div class="paragraph">
<p><code>[NOT] MEMBER OF</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Logical</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>NOT</code></p>
</div>
<div class="paragraph">
<p><code>AND</code></p>
</div>
<div class="paragraph">
<p><code>OR</code></p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="between-expressions"><a class="anchor" href="#between-expressions"></a>BETWEEN Expressions</h5>
<div class="paragraph">
<p>A <code>BETWEEN</code> expression determines whether an arithmetic expression falls within a range of values.</p>
</div>
<div class="paragraph">
<p>These two expressions are equivalent:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql">p.age <span class="keyword">BETWEEN</span> <span class="integer">15</span> <span class="keyword">AND</span> <span class="integer">19</span>
p.age &gt;= <span class="integer">15</span> <span class="keyword">AND</span> p.age &lt;= <span class="integer">19</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following two expressions also are equivalent:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql">p.age <span class="keyword">NOT</span> <span class="keyword">BETWEEN</span> <span class="integer">15</span> <span class="keyword">AND</span> <span class="integer">19</span>
p.age &lt; <span class="integer">15</span> <span class="keyword">OR</span> p.age &gt; <span class="integer">19</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If an arithmetic expression has a <code>NULL</code> value, the value of the <code>BETWEEN</code> expression is unknown.</p>
</div>
</div>
<div class="sect4">
<h5 id="in-expressions"><a class="anchor" href="#in-expressions"></a>IN Expressions</h5>
<div class="paragraph">
<p>An <code>IN</code> expression determines whether a string belongs to a set of string literals or whether a number belongs to a set of number values.</p>
</div>
<div class="paragraph">
<p>The path expression must have a string or numeric value.
If the path expression has a <code>NULL</code> value, the value of the <code>IN</code> expression is unknown.</p>
</div>
<div class="paragraph">
<p>In the following example, the expression is <code>TRUE</code> if the country is <code>UK</code> , but <code>FALSE</code> if the country is <code>Peru</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql">o.country <span class="keyword">IN</span> (<span class="string"><span class="delimiter">'</span><span class="content">UK</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">US</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">France</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>You may also use input parameters:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql">o.country <span class="keyword">IN</span> (<span class="string"><span class="delimiter">'</span><span class="content">UK</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">US</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">France</span><span class="delimiter">'</span></span>, :country)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="like-expressions"><a class="anchor" href="#like-expressions"></a>LIKE Expressions</h5>
<div class="paragraph">
<p>A <code>LIKE</code> expression determines whether a wildcard pattern matches a string.</p>
</div>
<div class="paragraph">
<p>The path expression must have a string or numeric value.
If this value is <code>NULL</code>, the value of the <code>LIKE</code> expression is unknown.
The pattern value is a string literal that can contain wildcard characters.
The underscore (<code>_</code>) wildcard character represents any single character.
The percent (<code>%</code>) wildcard character represents zero or more characters.
The <code>ESCAPE</code> clause specifies an escape character for the wildcard characters in the pattern value.
<a href="#like-expression-examples">Table 42-3</a> shows some sample <code>LIKE</code> expressions.</p>
</div>
<table id="like-expression-examples" class="tableblock frame-all grid-all" style="width: 75%;">
<caption class="title">Table 42-3 LIKE Expression Examples</caption>
<colgroup>
<col style="width: 46.6666%;">
<col style="width: 26.6666%;">
<col style="width: 26.6668%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Expression</th>
<th class="tableblock halign-left valign-top">TRUE</th>
<th class="tableblock halign-left valign-top">FALSE</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>address.phone LIKE '12%3'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>'123'</code><br>
<code>'12993'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>'1234'</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>asentence.word LIKE 'l_se'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>'lose'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>'loose'</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>aword.underscored LIKE '\_%' ESCAPE '\'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>'_foo'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>'bar'</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>address.phone NOT LIKE '12%3'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>'1234'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>'123'</code><br>
<code>'12993'</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="null-comparison-expressions"><a class="anchor" href="#null-comparison-expressions"></a>NULL Comparison Expressions</h5>
<div class="paragraph">
<p>A <code>NULL</code> comparison expression tests whether a single-valued path expression or an input parameter has a <code>NULL</code> value.
Usually, the <code>NULL</code> comparison expression is used to test whether a single-valued relationship has been set:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">SELECT</span> t
<span class="keyword">FROM</span> Team t
<span class="keyword">WHERE</span> t.league <span class="keyword">IS</span> <span class="predefined-constant">NULL</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This query selects all teams where the league relationship is not set.
Note that the following query is not equivalent:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">SELECT</span> t
<span class="keyword">FROM</span> Team t
<span class="keyword">WHERE</span> t.league = <span class="predefined-constant">NULL</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The comparison with <code>NULL</code> using the equals operator (<code>=</code>) always returns an unknown value, even if the relationship is not set.
The second query will always return an empty result.</p>
</div>
</div>
<div class="sect4">
<h5 id="empty-collection-comparison-expressions"><a class="anchor" href="#empty-collection-comparison-expressions"></a>Empty Collection Comparison Expressions</h5>
<div class="paragraph">
<p>The <code>IS [NOT] EMPTY</code> comparison expression tests whether a collection-valued path expression has no elements.
In other words, it tests whether a collection-valued relationship has been set.</p>
</div>
<div class="paragraph">
<p>If the collection-valued path expression is <code>NULL</code>, the empty collection comparison expression has a <code>NULL</code> value.</p>
</div>
<div class="paragraph">
<p>Here is an example that finds all orders that do not have any line items:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">SELECT</span> o
<span class="keyword">FROM</span> CustomerOrder o
<span class="keyword">WHERE</span> o.lineItems <span class="keyword">IS</span> EMPTY</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="collection-member-expressions"><a class="anchor" href="#collection-member-expressions"></a>Collection Member Expressions</h5>
<div class="paragraph">
<p>The <code>[NOT]</code> <code>MEMBER [OF]</code> collection member expression determines whether a value is a member of a collection.
The value and the collection members must have the same type.</p>
</div>
<div class="paragraph">
<p>If either the collection-valued or single-valued path expression is unknown, the collection member expression is unknown.
If the collection-valued path expression designates an empty collection, the collection member expression is <code>FALSE</code>.</p>
</div>
<div class="paragraph">
<p>The <code>OF</code> keyword is optional.</p>
</div>
<div class="paragraph">
<p>The following example tests whether a line item is part of an order:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">SELECT</span> o
<span class="keyword">FROM</span> CustomerOrder o
<span class="keyword">WHERE</span> :lineItem MEMBER <span class="keyword">OF</span> o.lineItems</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="subqueries"><a class="anchor" href="#subqueries"></a>Subqueries</h5>
<div class="paragraph">
<p>Subqueries may be used in the <code>WHERE</code> or <code>HAVING</code> clause of a query.
Subqueries must be surrounded by parentheses.</p>
</div>
<div class="paragraph">
<p>The following example finds all customers who have placed more than ten orders:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">SELECT</span> c
<span class="keyword">FROM</span> Customer c
<span class="keyword">WHERE</span> (<span class="class">SELECT</span> <span class="predefined">COUNT</span>(o) <span class="keyword">FROM</span> c.orders o) &gt; <span class="integer">10</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Subqueries may contain <code>EXISTS</code>, <code>ALL</code>, and <code>ANY</code> expressions.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>EXISTS expressions: The <code>[NOT] EXISTS</code> expression is used with a subquery and is true only if the result of the subquery consists of one or more values; otherwise, it is false.</p>
<div class="paragraph">
<p>The following example finds all employees whose spouses are also employees:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">SELECT</span> <span class="keyword">DISTINCT</span> emp
<span class="keyword">FROM</span> Employee emp
<span class="keyword">WHERE</span> <span class="keyword">EXISTS</span> (
    <span class="class">SELECT</span> spouseEmp
    <span class="keyword">FROM</span> Employee spouseEmp
    <span class="keyword">WHERE</span> spouseEmp = emp.spouse)</code></pre>
</div>
</div>
</li>
<li>
<p>ALL and ANY expressions: The <code>ALL</code> expression is used with a subquery and is true if all the values returned by the subquery are true or if the subquery is empty.</p>
<div class="paragraph">
<p>The <code>ANY</code> expression is used with a subquery and is true if some of the values returned by the subquery are true.
An <code>ANY</code> expression is false if the subquery result is empty or if all the values returned are false.
The <code>SOME</code> keyword is synonymous with <code>ANY</code>.</p>
</div>
<div class="paragraph">
<p>The <code>ALL</code> and <code>ANY</code> expressions are used with the <code>=</code>, <code>&lt;</code>, <code>&#8656;</code>, <code>&gt;</code>, <code>&gt;=</code>, and <code>&lt;&gt;</code> comparison operators.</p>
</div>
<div class="paragraph">
<p>The following example finds all employees whose salaries are higher than the salaries of the managers in the employee&#8217;s department:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">SELECT</span> emp
<span class="keyword">FROM</span> Employee emp
<span class="keyword">WHERE</span> emp.salary &gt; <span class="keyword">ALL</span> (
    <span class="class">SELECT</span> m.salary
    <span class="keyword">FROM</span> Manager m
    <span class="keyword">WHERE</span> m.department = emp.department)</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="functional-expressions"><a class="anchor" href="#functional-expressions"></a>Functional Expressions</h5>
<div class="paragraph">
<p>The query language includes several string, arithmetic, and date/time functions that may be used in the <code>SELECT</code>, <code>WHERE</code>, or <code>HAVING</code> clause of a query.
The functions are listed in <a href="#string-expressions">Table 42-4</a>, <a href="#arithmetic-expressions">Table 42-5</a> and <a href="#date-time-expressions">Table 42-6</a>.</p>
</div>
<div class="paragraph">
<p>In <a href="#string-expressions">Table 42-4</a>, the <code>start</code> and <code>length</code> arguments are of type <code>int</code> and designate positions in the <code>String</code> argument.
The first position in a string is designated by 1.</p>
</div>
<table id="string-expressions" class="tableblock frame-all grid-all" style="width: 75%;">
<caption class="title">Table 42-4 String Expressions</caption>
<colgroup>
<col style="width: 64.2857%;">
<col style="width: 35.7143%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Function Syntax</th>
<th class="tableblock halign-left valign-top">Return Type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CONCAT(String, String)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LENGTH(String)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>int</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LOCATE(String, String [, start])</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>int</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SUBSTRING(String, start, length)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRIM([[LEADING|TRAILING|BOTH] char FROM] String)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LOWER(String)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>UPPER(String)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <code>CONCAT</code> function concatenates two strings into one string.</p>
</div>
<div class="paragraph">
<p>The <code>LENGTH</code> function returns the length of a string in characters as an integer.</p>
</div>
<div class="paragraph">
<p>The <code>LOCATE</code> function returns the position of a given string within a string.
This function returns the first position at which the string was found as an integer.
The first argument is the string to be located.
The second argument is the string to be searched.
The optional third argument is an integer that represents the starting string position.
By default, <code>LOCATE</code> starts at the beginning of the string.
The starting position of a string is <code>1</code>.
If the string cannot be located, <code>LOCATE</code> returns <code>0</code>.</p>
</div>
<div class="paragraph">
<p>The <code>SUBSTRING</code> function returns a string that is a substring of the first argument based on the starting position and length.</p>
</div>
<div class="paragraph">
<p>The <code>TRIM</code> function trims the specified character from the beginning and/or end of a string.
If no character is specified, <code>TRIM</code> removes spaces or blanks from the string.
If the optional <code>LEADING</code> specification is used, <code>TRIM</code> removes only the leading characters from the string.
If the optional <code>TRAILING</code> specification is used, <code>TRIM</code> removes only the trailing characters from the string.
The default is <code>BOTH</code>, which removes the leading and trailing characters from the string.</p>
</div>
<div class="paragraph">
<p>The <code>LOWER</code> and <code>UPPER</code> functions convert a string to lowercase or uppercase, respectively.</p>
</div>
<div class="paragraph">
<p>In <a href="#arithmetic-expressions">Table 42-5</a>, the <code>number</code> argument can be an <code>int</code>, a <code>float</code>, or a <code>double</code>.</p>
</div>
<table id="arithmetic-expressions" class="tableblock frame-all grid-all" style="width: 60%;">
<caption class="title">Table 42-5 Arithmetic Expressions</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Function Syntax</th>
<th class="tableblock halign-left valign-top">Return Type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ABS(number)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>int</code>, <code>float</code>, or <code>double</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MOD(int, int)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>int</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SQRT(double)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>double</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SIZE(Collection)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>int</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <code>ABS</code> function takes a numeric expression and returns a number of the same type as the argument.</p>
</div>
<div class="paragraph">
<p>The <code>MOD</code> function returns the remainder of the first argument divided by the second.</p>
</div>
<div class="paragraph">
<p>The <code>SQRT</code> function returns the square root of a number.</p>
</div>
<div class="paragraph">
<p>The <code>SIZE</code> function returns an integer of the number of elements in the given collection.</p>
</div>
<div class="paragraph">
<p>In <a href="#date-time-expressions">Table 42-6</a>, the date/time functions return the date, time, or timestamp on the database server.</p>
</div>
<table id="date-time-expressions" class="tableblock frame-all grid-all" style="width: 60%;">
<caption class="title">Table 42-6 Date/Time Expressions</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Function Syntax</th>
<th class="tableblock halign-left valign-top">Return Type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CURRENT_DATE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.sql.Date</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CURRENT_TIME</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.sql.Time</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CURRENT_TIMESTAMP</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.sql.Timestamp</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="case-expressions"><a class="anchor" href="#case-expressions"></a>Case Expressions</h5>
<div class="paragraph">
<p>Case expressions change based on a condition, similar to the <code>case</code> keyword of the Java programming language.
The <code>CASE</code> keyword indicates the start of a case expression, and the expression is terminated by the <code>END</code> keyword.
The <code>WHEN</code> and <code>THEN</code> keywords define individual conditions, and the <code>ELSE</code> keyword defines the default condition should none of the other conditions be satisfied.</p>
</div>
<div class="paragraph">
<p>The following query selects the name of a person and a conditional string, depending on the subtype of the <code>Person</code> entity.
If the subtype is <code>Student</code>, the string <code>kid</code> is returned.
If the subtype is <code>Guardian</code> or <code>Staff</code>, the string <code>adult</code> is returned.
If the entity is some other subtype of <code>Person</code>, the string <code>unknown</code> is returned:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">SELECT</span> p.name
<span class="keyword">CASE</span> TYPE(p)
    <span class="keyword">WHEN</span> Student <span class="keyword">THEN</span> <span class="string"><span class="delimiter">'</span><span class="content">kid</span><span class="delimiter">'</span></span>
    <span class="keyword">WHEN</span> Guardian <span class="keyword">THEN</span> <span class="string"><span class="delimiter">'</span><span class="content">adult</span><span class="delimiter">'</span></span>
    <span class="keyword">WHEN</span> Staff <span class="keyword">THEN</span> <span class="string"><span class="delimiter">'</span><span class="content">adult</span><span class="delimiter">'</span></span>
    <span class="keyword">ELSE</span> <span class="string"><span class="delimiter">'</span><span class="content">unknown</span><span class="delimiter">'</span></span>
<span class="keyword">END</span>
<span class="keyword">FROM</span> Person p</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following query sets a discount for various types of customers.
Gold-level customers get a 20% discount, silver-level customers get a 15% discount, bronze-level customers get a 10% discount, and everyone else gets a 5% discount:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">UPDATE</span> Customer c
<span class="class">SET</span> c.discount =
    <span class="keyword">CASE</span> c.level
        <span class="keyword">WHEN</span> <span class="string"><span class="delimiter">'</span><span class="content">Gold</span><span class="delimiter">'</span></span> <span class="keyword">THEN</span> <span class="integer">20</span>
        <span class="keyword">WHEN</span> <span class="string"><span class="delimiter">'</span><span class="content">SILVER</span><span class="delimiter">'</span></span> <span class="keyword">THEN</span> <span class="integer">15</span>
        <span class="keyword">WHEN</span> <span class="string"><span class="delimiter">'</span><span class="content">Bronze</span><span class="delimiter">'</span></span> <span class="keyword">THEN</span> <span class="integer">10</span>
        <span class="keyword">ELSE</span> <span class="integer">5</span>
    <span class="keyword">END</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="null-values"><a class="anchor" href="#null-values"></a>NULL Values</h5>
<div class="paragraph">
<p>If the target of a reference is not in the persistent store, the target is <code>NULL</code>.
For conditional expressions containing <code>NULL</code>, the query language uses the semantics defined by SQL92.
Briefly, these semantics are as follows.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If a comparison or arithmetic operation has an unknown value, it yields a <code>NULL</code> value.</p>
</li>
<li>
<p>Two <code>NULL</code> values are not equal.
Comparing two <code>NULL</code> values yields an unknown value.</p>
</li>
<li>
<p>The <code>IS NULL</code> test converts a <code>NULL</code> persistent field or a single-valued relationship field to <code>TRUE</code>.
The <code>IS NOT NULL</code> test converts them to <code>FALSE</code>.</p>
</li>
<li>
<p>Boolean operators and conditional tests use the three-valued logic defined by <a href="#and-operator-logic">Table 42-7</a> and <a href="#or-operator-logic">Table 42-8</a>.
(In these tables, T stands for <code>TRUE</code>, F for <code>FALSE</code>, and U for unknown.)</p>
</li>
</ul>
</div>
<table id="and-operator-logic" class="tableblock frame-all grid-all" style="width: 40%;">
<caption class="title">Table 42-7 AND Operator Logic</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">AND</th>
<th class="tableblock halign-left valign-top">T</th>
<th class="tableblock halign-left valign-top">F</th>
<th class="tableblock halign-left valign-top">U</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">T</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">F</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">U</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">F</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">F</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">F</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">F</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">F</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">U</p></td>
</tr>
</tbody>
</table>
<table id="or-operator-logic" class="tableblock frame-all grid-all" style="width: 40%;">
<caption class="title">Table 42-8 OR Operator Logic</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">OR</th>
<th class="tableblock halign-left valign-top">T</th>
<th class="tableblock halign-left valign-top">F</th>
<th class="tableblock halign-left valign-top">U</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">T</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">F</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">F</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">U</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">U</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="equality-semantics"><a class="anchor" href="#equality-semantics"></a>Equality Semantics</h5>
<div class="paragraph">
<p>In the query language, only values of the same type can be compared.
However, this rule has one exception: Exact and approximate numeric values can be compared.
In such a comparison, the required type conversion adheres to the rules of Java numeric promotion.</p>
</div>
<div class="paragraph">
<p>The query language treats compared values as if they were Java types and not as if they represented types in the underlying data store.
For example, a persistent field that could be either an integer or a <code>NULL</code> must be designated as an <code>Integer</code> object and not as an <code>int</code> primitive.
This designation is required because a Java object can be <code>NULL</code>, but a primitive cannot.</p>
</div>
<div class="paragraph">
<p>Two strings are equal only if they contain the same sequence of characters.
Trailing blanks are significant; for example, the strings <code>'abc'</code> and <code>'abc '</code> are not equal.</p>
</div>
<div class="paragraph">
<p>Two entities of the same abstract schema type are equal only if their primary keys have the same value.
<a href="#not-operator-logic">Table 42-9</a> shows the operator logic of a negation, and <a href="#conditional-test">Table 42-10</a> shows the truth values of conditional tests.</p>
</div>
<table id="not-operator-logic" class="tableblock frame-all grid-all" style="width: 30%;">
<caption class="title">Table 42-9 NOT Operator Logic</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">NOT Value</th>
<th class="tableblock halign-left valign-top">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">T</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">F</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">F</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">U</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">U</p></td>
</tr>
</tbody>
</table>
<table id="conditional-test" class="tableblock frame-all grid-all" style="width: 60%;">
<caption class="title">Table 42-10 Conditional Test</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6668%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Conditional Test</th>
<th class="tableblock halign-left valign-top">T</th>
<th class="tableblock halign-left valign-top">F</th>
<th class="tableblock halign-left valign-top">U</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Expression <code>IS TRUE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">F</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">F</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Expression <code>IS FALSE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">F</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">F</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Expression is unknown</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">F</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">F</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="select-clause"><a class="anchor" href="#select-clause"></a>SELECT Clause</h4>
<div class="paragraph">
<p>The <code>SELECT</code> clause defines the types of the objects or values returned by the query.</p>
</div>
<div class="sect4">
<h5 id="return-types"><a class="anchor" href="#return-types"></a>Return Types</h5>
<div class="paragraph">
<p>The return type of the <code>SELECT</code> clause is defined by the result types of the select expressions contained within it.
If multiple expressions are used, the result of the query is an <code>Object[]</code>, and the elements in the array correspond to the order of the expressions in the <code>SELECT</code> clause and in type to the result types of each expression.</p>
</div>
<div class="paragraph">
<p>A <code>SELECT</code> clause cannot specify a collection-valued expression.
For example, the <code>SELECT</code> clause <code>p.teams</code> is invalid because <code>teams</code> is a collection.
However, the clause in the following query is valid because <code>t</code> is a single element of the <code>teams</code> collection:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">SELECT</span> t
<span class="keyword">FROM</span> Player p, <span class="keyword">IN</span> (p.teams) t</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following query is an example of a query with multiple expressions in the <code>SELECT</code> clause:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">SELECT</span> c.name, c.country.name
<span class="keyword">FROM</span> customer c
<span class="keyword">WHERE</span> c.lastname = <span class="string"><span class="delimiter">'</span><span class="content">Coss</span><span class="delimiter">'</span></span> <span class="keyword">AND</span> c.firstname = <span class="string"><span class="delimiter">'</span><span class="content">Roxane</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This query returns a list of <code>Object[]</code> elements; the first array element is a string denoting the customer name, and the second array element is a string denoting the name of the customer&#8217;s country.</p>
</div>
<div class="paragraph">
<p>The result of a query may be the result of an aggregate function, listed in <a href="#aggregate-functions-in-select-statements">Table 42-11</a>.</p>
</div>
<table id="aggregate-functions-in-select-statements" class="tableblock frame-all grid-all" style="width: 80%;">
<caption class="title">Table 42-11 Aggregate Functions in Select Statements</caption>
<colgroup>
<col style="width: 11.6279%;">
<col style="width: 38.7596%;">
<col style="width: 49.6125%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Return Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AVG</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Double</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns the mean average of the fields</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>COUNT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Long</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns the total number of results</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MAX</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The type of the field</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns the highest value in the result set</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MIN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The type of the field</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns the lowest value in the result set</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SUM</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>Long</code> (for integral fields)<br>
<code>Double</code> (for floating-point fields)<br>
<code>BigInteger</code> (for <code>BigInteger</code> fields)<br>
<code>BigDecimal</code> (for <code>BigDecimal</code> fields)</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns the sum of all the values in the result set</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For select method queries with an aggregate function (<code>AVG</code>, <code>COUNT</code>, <code>MAX</code>, <code>MIN</code>, or <code>SUM</code>) in the <code>SELECT</code> clause, the following rules apply.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>AVG</code>, <code>MAX</code>, <code>MIN</code>, and <code>SUM</code> functions return <code>null</code> if there are no values to which the function can be applied.</p>
</li>
<li>
<p>The <code>COUNT</code> function returns 0 if there are no values to which the function can be applied.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following example returns the average order quantity:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">SELECT</span> <span class="predefined">AVG</span>(o.quantity)
<span class="keyword">FROM</span> CustomerOrder o</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example returns the total cost of the items ordered by Roxane Coss:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">SELECT</span> <span class="predefined">SUM</span>(l.price)
<span class="keyword">FROM</span> CustomerOrder o <span class="keyword">JOIN</span> o.lineItems l <span class="keyword">JOIN</span> o.customer c
<span class="keyword">WHERE</span> c.lastname = <span class="string"><span class="delimiter">'</span><span class="content">Coss</span><span class="delimiter">'</span></span> <span class="keyword">AND</span> c.firstname = <span class="string"><span class="delimiter">'</span><span class="content">Roxane</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example returns the total number of orders:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">SELECT</span> <span class="predefined">COUNT</span>(o)
<span class="keyword">FROM</span> CustomerOrder o</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example returns the total number of items that have prices in Hal Incandenza&#8217;s order:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">SELECT</span> <span class="predefined">COUNT</span>(l.price)
<span class="keyword">FROM</span> CustomerOrder o <span class="keyword">JOIN</span> o.lineItems l <span class="keyword">JOIN</span> o.customer c
<span class="keyword">WHERE</span> c.lastname = <span class="string"><span class="delimiter">'</span><span class="content">Incandenza</span><span class="delimiter">'</span></span> <span class="keyword">AND</span> c.firstname = <span class="string"><span class="delimiter">'</span><span class="content">Hal</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="the-distinct-keyword"><a class="anchor" href="#the-distinct-keyword"></a>The DISTINCT Keyword</h5>
<div class="paragraph">
<p>The <code>DISTINCT</code> keyword eliminates duplicate return values.
If a query returns a <code>java.util.Collection</code>, which allows duplicates, you must specify the <code>DISTINCT</code> keyword to eliminate duplicates.</p>
</div>
</div>
<div class="sect4">
<h5 id="constructor-expressions"><a class="anchor" href="#constructor-expressions"></a>Constructor Expressions</h5>
<div class="paragraph">
<p>Constructor expressions allow you to return Java instances that store a query result element instead of an <code>Object[]</code>.</p>
</div>
<div class="paragraph">
<p>The following query creates a <code>CustomerDetail</code> instance per <code>Customer</code> matching the <code>WHERE</code> clause.
A <code>CustomerDetail</code> stores the customer name and customer&#8217;s country name. So the query returns a <code>List</code> of <code>CustomerDetail</code> instances:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">SELECT</span> NEW com.example.CustomerDetail(c.name, c.country.name)
<span class="keyword">FROM</span> customer c
<span class="keyword">WHERE</span> c.lastname = <span class="string"><span class="delimiter">'</span><span class="content">Coss</span><span class="delimiter">'</span></span> <span class="keyword">AND</span> c.firstname = <span class="string"><span class="delimiter">'</span><span class="content">Roxane</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="order-by-clause"><a class="anchor" href="#order-by-clause"></a>ORDER BY Clause</h4>
<div class="paragraph">
<p>As its name suggests, the <code>ORDER BY</code> clause orders the values or objects returned by the query.</p>
</div>
<div class="paragraph">
<p>If the <code>ORDER BY</code> clause contains multiple elements, the left-to-right sequence of the elements determines the high-to-low precedence.</p>
</div>
<div class="paragraph">
<p>The <code>ASC</code> keyword specifies ascending order, the default, and the <code>DESC</code> keyword indicates descending order.</p>
</div>
<div class="paragraph">
<p>When using the <code>ORDER BY</code> clause, the <code>SELECT</code> clause must return an orderable set of objects or values.
You cannot order the values or objects for values or objects not returned by the <code>SELECT</code> clause.
For example, the following query is valid because the <code>ORDER BY</code> clause uses the objects returned by the <code>SELECT</code> clause:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">SELECT</span> o
<span class="keyword">FROM</span> Customer c <span class="keyword">JOIN</span> c.orders o <span class="keyword">JOIN</span> c.address a
<span class="keyword">WHERE</span> a.state = <span class="string"><span class="delimiter">'</span><span class="content">CA</span><span class="delimiter">'</span></span>
<span class="keyword">ORDER</span> <span class="keyword">BY</span> o.quantity, o.totalcost</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example is not valid, because the <code>ORDER BY</code> clause uses a value not returned by the <code>SELECT</code> clause:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">SELECT</span> p.product_name
<span class="keyword">FROM</span> CustomerOrder o, <span class="keyword">IN</span>(o.lineItems) l <span class="keyword">JOIN</span> o.customer c
<span class="keyword">WHERE</span> c.lastname = <span class="string"><span class="delimiter">'</span><span class="content">Faehmel</span><span class="delimiter">'</span></span> <span class="keyword">AND</span> c.firstname = <span class="string"><span class="delimiter">'</span><span class="content">Robert</span><span class="delimiter">'</span></span>
<span class="keyword">ORDER</span> <span class="keyword">BY</span> o.quantity</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="group-by-and-having-clauses"><a class="anchor" href="#group-by-and-having-clauses"></a>GROUP BY and HAVING Clauses</h4>
<div class="paragraph">
<p>The <code>GROUP BY</code> clause allows you to group values according to a set of properties.</p>
</div>
<div class="paragraph">
<p>The following query groups the customers by their country and returns the number of customers per country:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">SELECT</span> c.country, <span class="predefined">COUNT</span>(c)
<span class="keyword">FROM</span> Customer c <span class="keyword">GROUP</span> <span class="keyword">BY</span> c.country</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>HAVING</code> clause is used with the <code>GROUP BY</code> clause to further restrict the returned result of a query.</p>
</div>
<div class="paragraph">
<p>The following query groups orders by the status of their customer and returns the customer status plus the average <code>totalPrice</code> for all orders where the corresponding customers have the same status.
In addition, it considers only customers with status <code>1</code>, <code>2</code>, or <code>3</code>, so orders of other customers are not taken into account:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">SELECT</span> c.status, <span class="predefined">AVG</span>(o.totalPrice)
<span class="keyword">FROM</span> CustomerOrder o <span class="keyword">JOIN</span> o.customer c
<span class="keyword">GROUP</span> <span class="keyword">BY</span> c.status <span class="keyword">HAVING</span> c.status <span class="keyword">IN</span> (<span class="integer">1</span>, <span class="integer">2</span>, <span class="integer">3</span>)</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using-the-criteria-api-to-create-queries"><a class="anchor" href="#using-the-criteria-api-to-create-queries"></a>Chapter 43. Using the Criteria API to Create Queries</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Criteria API is used to define queries for entities and their persistent state by creating query-defining objects.
Criteria queries are written using Java programming language APIs, are typesafe, and are portable.
Such queries work regardless of the underlying data store.</p>
</div>
<div class="sect2">
<h3 id="overview-of-the-criteria-and-metamodel-apis"><a class="anchor" href="#overview-of-the-criteria-and-metamodel-apis"></a>Overview of the Criteria and Metamodel APIs</h3>
<div class="paragraph">
<p>Similar to JPQL, the Criteria API is based on the abstract schema of persistent entities, their relationships, and embedded objects.
The Criteria API operates on this abstract schema to allow developers to find, modify, and delete persistent entities by invoking Jakarta Persistence entity operations.
The Metamodel API works in concert with the Criteria API to model persistent entity classes for Criteria queries.</p>
</div>
<div class="paragraph">
<p>The Criteria API and JPQL are closely related and are designed to allow similar operations in their queries.
Developers familiar with JPQL syntax will find equivalent object-level operations in the Criteria API.</p>
</div>
<div class="paragraph">
<p>The following simple Criteria query returns all instances of the <code>Pet</code> entity in the data source:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">EntityManager em = ...;
CriteriaBuilder cb = em.getCriteriaBuilder();
CriteriaQuery&lt;Pet&gt; cq = cb.createQuery(Pet.class);
Root&lt;Pet&gt; pet = cq.from(Pet.class);
cq.select(pet);
TypedQuery&lt;Pet&gt; q = em.createQuery(cq);
<span class="predefined-type">List</span>&lt;Pet&gt; allPets = q.getResultList();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The equivalent JPQL query is</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">SELECT</span> p
<span class="keyword">FROM</span> Pet p</code></pre>
</div>
</div>
<div class="paragraph">
<p>This query demonstrates the basic steps to create a Criteria query.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Use an <code>EntityManager</code> instance to create a <code>CriteriaBuilder</code> object.</p>
</li>
<li>
<p>Create a query object by creating an instance of the <code>CriteriaQuery</code> interface.
This query object&#8217;s attributes will be modified with the details of the query.</p>
</li>
<li>
<p>Set the query root by calling the <code>from</code> method on the <code>CriteriaQuery</code> object.</p>
</li>
<li>
<p>Specify what the type of the query result will be by calling the <code>select</code> method of the <code>CriteriaQuery</code> object.</p>
</li>
<li>
<p>Prepare the query for execution by creating a <code>TypedQuery&lt;T&gt;</code> instance, specifying the type of the query result.</p>
</li>
<li>
<p>Execute the query by calling the <code>getResultList</code> method on the <code>TypedQuery&lt;T&gt;</code> object.
Because this query returns a collection of entities, the result is stored in a <code>List</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The tasks associated with each step are discussed in detail in this chapter.</p>
</div>
<div class="paragraph">
<p>To create a <code>CriteriaBuilder</code> instance, call the <code>getCriteriaBuilder</code> method on the <code>EntityManager</code> instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">CriteriaBuilder cb = em.getCriteriaBuilder();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Use the <code>CriteriaBuilder</code> instance to create a query object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">CriteriaQuery&lt;Pet&gt; cq = cb.createQuery(Pet.class);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The query will return instances of the <code>Pet</code> entity.
To create a typesafe query, specify the type of the query when you create the <code>CriteriaQuery</code> object.</p>
</div>
<div class="paragraph">
<p>Call the <code>from</code> method of the query object to set the <code>FROM</code> clause of the query and to specify the root of the query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Root&lt;Pet&gt; pet = cq.from(Pet.class);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Call the <code>select</code> method of the query object, passing in the query root, to set the <code>SELECT</code> clause of the query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">cq.select(pet);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, use the query object to create a <code>TypedQuery&lt;T&gt;</code> object that can be executed against the data source.
The modifications to the query object are captured to create a ready-to-execute query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">TypedQuery&lt;Pet&gt; q = em.createQuery(cq);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Execute this typed query object by calling its <code>getResultList</code> method, because this query will return multiple entity instances.
The following statement stores the results in a <code>List&lt;Pet&gt;</code> collection-valued object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">List</span>&lt;Pet&gt; allPets = q.getResultList();</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-the-metamodel-api-to-model-entity-classes"><a class="anchor" href="#using-the-metamodel-api-to-model-entity-classes"></a>Using the Metamodel API to Model Entity Classes</h3>
<div class="paragraph">
<p>Use the Metamodel API to create a metamodel of the managed entities in a particular persistence unit.
For each entity class in a particular package, a metamodel class is created with a trailing underscore and with attributes that correspond to the persistent fields or properties of the entity class.</p>
</div>
<div class="paragraph">
<p>The following entity class, <code>com.example.Pet</code>, has four persistent fields: <code>id</code>, <code>name</code>, <code>color</code>, and <code>owners</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.example</span>;
...
<span class="annotation">@Entity</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Pet</span> {
    <span class="annotation">@Id</span>
    <span class="directive">protected</span> <span class="predefined-type">Long</span> id;
    <span class="directive">protected</span> <span class="predefined-type">String</span> name;
    <span class="directive">protected</span> <span class="predefined-type">String</span> color;
    <span class="annotation">@ManyToOne</span>
    <span class="directive">protected</span> <span class="predefined-type">Set</span>&lt;Person&gt; owners;
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The corresponding Metamodel class is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.example</span>;
...
<span class="annotation">@Static</span> Metamodel(Pet.class)
<span class="directive">public</span> <span class="type">class</span> <span class="class">Pet_</span> {

    <span class="directive">public</span> <span class="directive">static</span> <span class="directive">volatile</span> SingularAttribute&lt;Pet, <span class="predefined-type">Long</span>&gt; id;
    <span class="directive">public</span> <span class="directive">static</span> <span class="directive">volatile</span> SingularAttribute&lt;Pet, <span class="predefined-type">String</span>&gt; name;
    <span class="directive">public</span> <span class="directive">static</span> <span class="directive">volatile</span> SingularAttribute&lt;Pet, <span class="predefined-type">String</span>&gt; color;
    <span class="directive">public</span> <span class="directive">static</span> <span class="directive">volatile</span> SetAttribute&lt;Pet, Person&gt; owners;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Criteria queries use the metamodel class and its attributes to refer to the managed entity classes and their persistent state and relationships.</p>
</div>
<div class="sect3">
<h4 id="using-metamodel-classes"><a class="anchor" href="#using-metamodel-classes"></a>Using Metamodel Classes</h4>
<div class="paragraph">
<p>Metamodel classes that correspond to entity classes are of the following type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">jakarta.persistence.metamodel.EntityType&lt;T&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Annotation processors typically generate metamodel classes either at development time or at runtime.
Developers of applications that use Criteria queries may do either of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Generate static metamodel classes by using the persistence provider&#8217;s annotation processor</p>
</li>
<li>
<p>Obtain the metamodel class by doing one of the following:</p>
<div class="ulist">
<ul>
<li>
<p>Call the <code>getModel</code> method on the query root object</p>
</li>
<li>
<p>Obtain an instance of the <code>Metamodel</code> interface and then pass the entity type to the instance&#8217;s <code>entity</code> method</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following code snippet shows how to obtain the <code>Pet</code> entity&#8217;s metamodel class by calling <code>Root&lt;T&gt;.getModel</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">EntityManager em = ...;
CriteriaBuilder cb = em.getCriteriaBuilder();
CriteriaQuery cq = cb.createQuery(Pet.class);
Root&lt;Pet&gt; pet = cq.from(Pet.class);
EntityType&lt;Pet&gt; Pet_ = pet.getModel();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following code snippet shows how to obtain the <code>Pet</code> entity&#8217;s metamodel class by first obtaining a metamodel instance by using <code>EntityManager.getMetamodel</code> and then calling <code>entity</code> on the metamodel instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">EntityManager em = ...;
Metamodel m = em.getMetamodel();
EntityType&lt;Pet&gt; Pet_ = m.entity(Pet.class);</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The most common use case is to generate typesafe static metamodel classes at development time.
Obtaining the metamodel classes dynamically, by calling <code>Root&lt;T&gt;.getModel</code> or <code>EntityManager.getMetamodel</code> and then the <code>entity</code> method, doesn&#8217;t allow for type safety and doesn&#8217;t allow the application to call persistent field or property names on the metamodel class.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-the-criteria-api-and-metamodel-api-to-create-basic-typesafe-queries"><a class="anchor" href="#using-the-criteria-api-and-metamodel-api-to-create-basic-typesafe-queries"></a>Using the Criteria API and Metamodel API to Create Basic Typesafe Queries</h3>
<div class="paragraph">
<p>The basic semantics of a Criteria query consists of a <code>SELECT</code> clause, a <code>FROM</code> clause, and an optional <code>WHERE</code> clause, similar to a JPQL query.
Criteria queries set these clauses by using Java programming language objects, so the query can be created in a typesafe manner.</p>
</div>
<div class="sect3">
<h4 id="creating-a-criteria-query"><a class="anchor" href="#creating-a-criteria-query"></a>Creating a Criteria Query</h4>
<div class="paragraph">
<p>The <code>jakarta.persistence.criteria.CriteriaBuilder</code> interface is used to construct</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Criteria queries</p>
</li>
<li>
<p>Selections</p>
</li>
<li>
<p>Expressions</p>
</li>
<li>
<p>Predicates</p>
</li>
<li>
<p>Ordering</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To obtain an instance of the <code>CriteriaBuilder</code> interface, call the <code>getCriteriaBuilder</code> method on either an <code>EntityManager</code> or an <code>EntityManagerFactory</code> instance.</p>
</div>
<div class="paragraph">
<p>The following code shows how to obtain a <code>CriteriaBuilder</code> instance by using the <code>EntityManager.getCriteriaBuilder</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">EntityManager em = ...;
CriteriaBuilder cb = em.getCriteriaBuilder();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Criteria queries are constructed by obtaining an instance of the following interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">jakarta.persistence.criteria.CriteriaQuery</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>CriteriaQuery</code> objects define a particular query that will navigate over one or more entities.
Obtain <code>CriteriaQuery</code> instances by calling one of the <code>CriteriaBuilder.createQuery</code> methods.
To create typesafe queries, call the <code>CriteriaBuilder.createQuery</code> method as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">CriteriaQuery&lt;Pet&gt; cq = cb.createQuery(Pet.class);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>CriteriaQuery</code> object&#8217;s type should be set to the expected result type of the query.
In the preceding code, the object&#8217;s type is set to <code>CriteriaQuery&lt;Pet&gt;</code> for a query that will find instances of the <code>Pet</code> entity.</p>
</div>
<div class="paragraph">
<p>The following code snippet creates a <code>CriteriaQuery</code> object for a query that returns a <code>String</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">CriteriaQuery&lt;<span class="predefined-type">String</span>&gt; cq = cb.createQuery(<span class="predefined-type">String</span>.class);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="query-roots"><a class="anchor" href="#query-roots"></a>Query Roots</h4>
<div class="paragraph">
<p>For a particular <code>CriteriaQuery</code> object, the root entity of the query, from which all navigation originates, is called the query root.
It is similar to the <code>FROM</code> clause in a JPQL query.</p>
</div>
<div class="paragraph">
<p>Create the query root by calling the <code>from</code> method on the <code>CriteriaQuery</code> instance.
The argument to the <code>from</code> method is either the entity class or an <code>EntityType&lt;T&gt;</code> instance for the entity.</p>
</div>
<div class="paragraph">
<p>The following code sets the query root to the <code>Pet</code> entity:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">CriteriaQuery&lt;Pet&gt; cq = cb.createQuery(Pet.class);
Root&lt;Pet&gt; pet = cq.from(Pet.class);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following code sets the query root to the <code>Pet</code> class by using an <code>EntityType&lt;T&gt;</code> instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">EntityManager em = ...;
Metamodel m = em.getMetamodel();
EntityType&lt;Pet&gt; Pet_ = m.entity(Pet.class);
Root&lt;Pet&gt; pet = cq.from(Pet_);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Criteria queries may have more than one query root.
This usually occurs when the query navigates from several entities.</p>
</div>
<div class="paragraph">
<p>The following code has two <code>Root</code> instances:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">CriteriaQuery&lt;Pet&gt; cq = cb.createQuery(Pet.class);
Root&lt;Pet&gt; pet1 = cq.from(Pet.class);
Root&lt;Pet&gt; pet2 = cq.from(Pet.class);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="querying-relationships-using-joins"><a class="anchor" href="#querying-relationships-using-joins"></a>Querying Relationships Using Joins</h4>
<div class="paragraph">
<p>For queries that navigate to related entity classes, the query must define a join to the related entity by calling one of the <code>From.join</code> methods on the query root object or another join object.
The <code>join</code> methods are similar to the <code>JOIN</code> keyword in JPQL.</p>
</div>
<div class="paragraph">
<p>The target of the join uses the Metamodel class of type <code>EntityType&lt;T&gt;</code> to specify the persistent field or property of the joined entity.</p>
</div>
<div class="paragraph">
<p>The <code>join</code> methods return an object of type <code>Join&lt;X, Y&gt;</code>, where <code>X</code> is the source entity and <code>Y</code> is the target of the join.
In the following code snippet, <code>Pet</code> is the source entity, <code>Owner</code> is the target, and <code>Pet_</code> is a statically generated metamodel class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">CriteriaQuery&lt;Pet&gt; cq = cb.createQuery(Pet.class);

Root&lt;Pet&gt; pet = cq.from(Pet.class);
Join&lt;Pet, <span class="predefined-type">Owner</span>&gt; owner = pet.join(Pet_.owners);</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can chain joins together to navigate to related entities of the target entity without having to create a <code>Join&lt;X, Y&gt;</code> instance for each join:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">CriteriaQuery&lt;Pet&gt; cq = cb.createQuery(Pet.class);

Root&lt;Pet&gt; pet = cq.from(Pet.class);
Join&lt;<span class="predefined-type">Owner</span>, Address&gt; address = pet.join(Pet_.owners).join(Owner_.addresses);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="path-navigation-in-criteria-queries"><a class="anchor" href="#path-navigation-in-criteria-queries"></a>Path Navigation in Criteria Queries</h4>
<div class="paragraph">
<p><code>Path</code> objects, which are used in the <code>SELECT</code> and <code>WHERE</code> clauses of a Criteria query, can be query root entities, join entities, or other <code>Path</code> objects.
Use the <code>Path.get</code> method to navigate to attributes of the entities of a query.</p>
</div>
<div class="paragraph">
<p>The argument to the <code>get</code> method is the corresponding attribute of the entity&#8217;s Metamodel class.
The attribute can be either a single-valued attribute, specified by <code>@SingularAttribute</code> in the Metamodel class, or a collection-valued attribute, specified by one of <code>@CollectionAttribute</code>, <code>@SetAttribute</code>, <code>@ListAttribute</code>, or <code>@MapAttribute</code>.</p>
</div>
<div class="paragraph">
<p>The following query returns the names of all the pets in the data store.
The <code>get</code> method is called on the query root, <code>pet</code>, with the <code>name</code> attribute of the <code>Pet</code> entity&#8217;s Metamodel class, <code>Pet_</code>, as the argument:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">CriteriaQuery&lt;<span class="predefined-type">String</span>&gt; cq = cb.createQuery(<span class="predefined-type">String</span>.class);

Root&lt;Pet&gt; pet = cq.from(Pet.class);
cq.select(pet.get(Pet_.name));</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="restricting-criteria-query-results"><a class="anchor" href="#restricting-criteria-query-results"></a>Restricting Criteria Query Results</h4>
<div class="paragraph">
<p>Conditions that are set by calling the <code>CriteriaQuery.where</code> method can restrict the results of a query on the <code>CriteriaQuery</code> object.
Calling the <code>where</code> method is analogous to setting the <code>WHERE</code> clause in a JPQL query.</p>
</div>
<div class="paragraph">
<p>The <code>where</code> method evaluates instances of the <code>Expression</code> interface to restrict the results according to the conditions of the expressions.
To create <code>Expression</code> instances, use methods defined in the <code>Expression</code> and <code>CriteriaBuilder</code> interfaces.</p>
</div>
<div class="sect4">
<h5 id="the-expression-interface-methods"><a class="anchor" href="#the-expression-interface-methods"></a>The Expression Interface Methods</h5>
<div class="paragraph">
<p>An <code>Expression</code> object is used in a query&#8217;s <code>SELECT</code>, <code>WHERE</code>, or <code>HAVING</code> clause.
<a href="#conditional-methods-in-the-expression-interface">Table 43-1</a> shows conditional methods you can use with <code>Expression</code> objects.</p>
</div>
<table id="conditional-methods-in-the-expression-interface" class="tableblock frame-all grid-all" style="width: 50%;">
<caption class="title">Table 43-1 Conditional Methods in the Expression Interface</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Method</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>isNull</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tests whether an expression is null</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>isNotNull</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tests whether an expression is not null</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>in</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tests whether an expression is within a list of values</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The following query uses the <code>Expression.isNull</code> method to find all pets where the <code>color</code> attribute is null:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">CriteriaQuery&lt;Pet&gt; cq = cb.createQuery(Pet.class);
Root&lt;Pet&gt; pet = cq.from(Pet.class);
cq.where(pet.get(Pet_.color).isNull());</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following query uses the <code>Expression.in</code> method to find all brown and black pets:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">CriteriaQuery&lt;Pet&gt; cq = cb.createQuery(Pet.class);
Root&lt;Pet&gt; pet = cq.from(Pet.class);
cq.where(pet.get(Pet_.color).in(<span class="string"><span class="delimiter">&quot;</span><span class="content">brown</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">black</span><span class="delimiter">&quot;</span></span>));</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>in</code> method can also check whether an attribute is a member of a collection.</p>
</div>
</div>
<div class="sect4">
<h5 id="expression-methods-in-the-criteriabuilder-interface"><a class="anchor" href="#expression-methods-in-the-criteriabuilder-interface"></a>Expression Methods in the CriteriaBuilder Interface</h5>
<div class="paragraph">
<p>The <code>CriteriaBuilder</code> interface defines additional methods for creating expressions.
These methods correspond to the arithmetic, string, date, time, and case operators and functions of JPQL.
<a href="#conditional-methods-in-the-criteriabuilder-interface">Table 43-2</a> shows conditional methods you can use with <code>CriteriaBuilder</code> objects.</p>
</div>
<table id="conditional-methods-in-the-criteriabuilder-interface" class="tableblock frame-all grid-all" style="width: 60%;">
<caption class="title">Table 43-2 Conditional Methods in the CriteriaBuilder Interface</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Conditional Method</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>equal</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tests whether two expressions are equal</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>notEqual</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tests whether two expressions are not equal</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>gt</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tests whether the first numeric expression is greater than the second numeric expression</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ge</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tests whether the first numeric expression is greater than or equal to the second numeric expression</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>lt</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tests whether the first numeric expression is less than the second numeric expression</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>le</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tests whether the first numeric expression is less than or equal to the second numeric expression</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>between</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tests whether the first expression is between the second and third expression in value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>like</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tests whether the expression matches a given pattern</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The following code uses the <code>CriteriaBuilder.equal</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">CriteriaQuery&lt;Pet&gt; cq = cb.createQuery(Pet.class);
Root&lt;Pet&gt; pet = cq.from(Pet.class);
cq.where(cb.equal(pet.get(Pet_.name), <span class="string"><span class="delimiter">&quot;</span><span class="content">Fido</span><span class="delimiter">&quot;</span></span>));</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following code uses the <code>CriteriaBuilder.gt</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">CriteriaQuery&lt;Pet&gt; cq = cb.createQuery(Pet.class);
Root&lt;Pet&gt; pet = cq.from(Pet.class);
<span class="predefined-type">Date</span> someDate = <span class="keyword">new</span> <span class="predefined-type">Date</span>(...);
cq.where(cb.gt(pet.get(Pet_.birthday), date));</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following code uses the <code>CriteriaBuilder.between</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">CriteriaQuery&lt;Pet&gt; cq = cb.createQuery(Pet.class);
Root&lt;Pet&gt; pet = cq.from(Pet.class);
<span class="predefined-type">Date</span> firstDate = <span class="keyword">new</span> <span class="predefined-type">Date</span>(...);
<span class="predefined-type">Date</span> secondDate = <span class="keyword">new</span> <span class="predefined-type">Date</span>(...);
cq.where(cb.between(pet.get(Pet_.birthday), firstDate, secondDate));</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following code uses the <code>CriteriaBuilder.like</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">CriteriaQuery&lt;Pet&gt; cq = cb.createQuery(Pet.class);
Root&lt;Pet&gt; pet = cq.from(Pet.class);
cq.where(cb.like(pet.get(Pet_.name), <span class="string"><span class="delimiter">&quot;</span><span class="content">*do</span><span class="delimiter">&quot;</span></span>));</code></pre>
</div>
</div>
<div class="paragraph">
<p>To specify multiple conditional predicates, use the compound predicate methods of the <code>CriteriaBuilder</code> interface, as shown in <a href="#compound-predicate-methods-in-the-criteriabuildder-interface">Table 43-3</a>.</p>
</div>
<table id="compound-predicate-methods-in-the-criteriabuildder-interface" class="tableblock frame-all grid-all" style="width: 50%;">
<caption class="title">Table 43-3 Compound Predicate Methods in the CriteriaBuilder Interface</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Method</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>and</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A logical conjunction of two Boolean expressions</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>or</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A logical disjunction of two Boolean expressions</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>not</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A logical negation of the given Boolean expression</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The following code shows the use of compound predicates in queries:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">CriteriaQuery&lt;Pet&gt; cq = cb.createQuery(Pet.class);
Root&lt;Pet&gt; pet = cq.from(Pet.class);
cq.where(cb.equal(pet.get(Pet_.name), <span class="string"><span class="delimiter">&quot;</span><span class="content">Fido</span><span class="delimiter">&quot;</span></span>)
        .and(cb.equal(pet.get(Pet_.color), <span class="string"><span class="delimiter">&quot;</span><span class="content">brown</span><span class="delimiter">&quot;</span></span>)));</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="managing-criteria-query-results"><a class="anchor" href="#managing-criteria-query-results"></a>Managing Criteria Query Results</h4>
<div class="paragraph">
<p>For queries that return more than one result, it is often helpful to organize those results.
The <code>CriteriaQuery</code> interface defines the following ordering and grouping methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>orderBy</code> method orders query results according to attributes of an entity</p>
</li>
<li>
<p>The <code>groupBy</code> method groups the results of a query together according to attributes of an entity, and the <code>having</code> method restricts those groups according to a condition</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="ordering-results"><a class="anchor" href="#ordering-results"></a>Ordering Results</h5>
<div class="paragraph">
<p>To order the results of a query, call the <code>CriteriaQuery.orderBy</code> method, passing in an <code>Order</code> object.
To create an <code>Order</code> object, call either the <code>CriteriaBuilder.asc</code> or the <code>CriteriaBuilder.desc</code> method.
The <code>asc</code> method is used to order the results by ascending value of the passed expression parameter.
The <code>desc</code> method is used to order the results by descending value of the passed expression parameter.
The following query shows the use of the <code>desc</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">CriteriaQuery&lt;Pet&gt; cq = cb.createQuery(Pet.class);
Root&lt;Pet&gt; pet = cq.from(Pet.class);
cq.select(pet);
cq.orderBy(cb.desc(pet.get(Pet_.birthday)));</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this query, the results will be ordered by the pet&#8217;s birthday from highest to lowest.
That is, pets born in December will appear before pets born in May.</p>
</div>
<div class="paragraph">
<p>The following query shows the use of the <code>asc</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">CriteriaQuery&lt;Pet&gt; cq = cb.createQuery(Pet.class);
Root&lt;Pet&gt; pet = cq.from(Pet.class);
Join&lt;<span class="predefined-type">Owner</span>, Address&gt; address = pet.join(Pet_.owners).join(Owner_.address);
cq.select(pet);
cq.orderBy(cb.asc(address.get(Address_.postalCode)));</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this query, the results will be ordered by the pet owner&#8217;s postal code from lowest to highest.
That is, pets whose owner lives in the 10001 zip code will appear before pets whose owner lives in the 91000 zip code.</p>
</div>
<div class="paragraph">
<p>If more than one <code>Order</code> object is passed to <code>orderBy</code>, the precedence is determined by the order in which they appear in the argument list of <code>orderBy</code>.
The first <code>Order</code> object has precedence.</p>
</div>
<div class="paragraph">
<p>The following code orders results by multiple criteria:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">CriteriaQuery&lt;Pet&gt; cq = cb.createQuery(Pet.class);
Root&lt;Pet&gt; pet = cq.from(Pet.class);
Join&lt;Pet, <span class="predefined-type">Owner</span>&gt; owner = pet.join(Pet_.owners);
cq.select(pet);
cq.orderBy(cb.asc(owner.get(Owner_.lastName)), owner.get(Owner_.firstName)));</code></pre>
</div>
</div>
<div class="paragraph">
<p>The results of this query will be ordered alphabetically by the pet owner&#8217;s last name, then first name.</p>
</div>
</div>
<div class="sect4">
<h5 id="grouping-results"><a class="anchor" href="#grouping-results"></a>Grouping Results</h5>
<div class="paragraph">
<p>The <code>CriteriaQuery.groupBy</code> method partitions the query results into groups.
To set these groups, pass an expression to <code>groupBy</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">CriteriaQuery&lt;Pet&gt; cq = cb.createQuery(Pet.class);
Root&lt;Pet&gt; pet = cq.from(Pet.class);
cq.groupBy(pet.get(Pet_.color));</code></pre>
</div>
</div>
<div class="paragraph">
<p>This query returns all <code>Pet</code> entities and groups the results by the pet&#8217;s color.</p>
</div>
<div class="paragraph">
<p>Use the <code>CriteriaQuery.having</code> method in conjunction with <code>groupBy</code> to filter over the groups.
The <code>having</code> method, which takes a conditional expression as a parameter, restricts the query result according to the conditional expression:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">CriteriaQuery&lt;Pet&gt; cq = cb.createQuery(Pet.class);
Root&lt;Pet&gt; pet = cq.from(Pet.class);
cq.groupBy(pet.get(Pet_.color));
cq.having(cb.in(pet.get(Pet_.color)).value(<span class="string"><span class="delimiter">&quot;</span><span class="content">brown</span><span class="delimiter">&quot;</span></span>).value(<span class="string"><span class="delimiter">&quot;</span><span class="content">blonde</span><span class="delimiter">&quot;</span></span>));</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the query groups the returned <code>Pet</code> entities by color, as in the preceding example.
However, the only returned groups will be <code>Pet</code> entities where the <code>color</code> attribute is set to <code>brown</code> or <code>blonde</code>.
That is, no gray-colored pets will be returned in this query.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="executing-queries"><a class="anchor" href="#executing-queries"></a>Executing Queries</h4>
<div class="paragraph">
<p>To prepare a query for execution, create a <code>TypedQuery&lt;T&gt;</code> object with the type of the query result, passing the <code>CriteriaQuery</code> object to <code>EntityManager.createQuery</code>.</p>
</div>
<div class="paragraph">
<p>To execute a query, call either <code>getSingleResult</code> or <code>getResultList</code> on the <code>TypedQuery&lt;T&gt;</code> object.</p>
</div>
<div class="sect4">
<h5 id="single-valued-query-results"><a class="anchor" href="#single-valued-query-results"></a>Single-Valued Query Results</h5>
<div class="paragraph">
<p>Use the <code>TypedQuery&lt;T&gt;.getSingleResult</code> method to execute queries that return a single result:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">CriteriaQuery&lt;Pet&gt; cq = cb.createQuery(Pet.class);
...
TypedQuery&lt;Pet&gt; q = em.createQuery(cq);
Pet result = q.getSingleResult();</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="collection-valued-query-results"><a class="anchor" href="#collection-valued-query-results"></a>Collection-Valued Query Results</h5>
<div class="paragraph">
<p>Use the <code>TypedQuery&lt;T&gt;.getResultList</code> method to execute queries that return a collection of objects:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">CriteriaQuery&lt;Pet&gt; cq = cb.createQuery(Pet.class);
...
TypedQuery&lt;Pet&gt; q = em.createQuery(cq);
<span class="predefined-type">List</span>&lt;Pet&gt; results = q.getResultList();</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="creating-and-using-string-based-criteria-queries"><a class="anchor" href="#creating-and-using-string-based-criteria-queries"></a>Chapter 44. Creating and Using String-Based Criteria Queries</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter describes how to create weakly typed string-based Criteria API queries.</p>
</div>
<div class="sect2">
<h3 id="overview-of-string-based-criteria-api-queries"><a class="anchor" href="#overview-of-string-based-criteria-api-queries"></a>Overview of String-Based Criteria API Queries</h3>
<div class="paragraph">
<p>String-based Criteria API queries ("string-based queries") are Java programming language queries that use strings rather than strongly typed metamodel objects to specify entity attributes when traversing a data hierarchy.
String-based queries are constructed similarly to metamodel queries, can be static or dynamic, and can express the same kind of queries and operations as strongly typed metamodel queries.</p>
</div>
<div class="paragraph">
<p>Strongly typed metamodel queries are the preferred method of constructing Criteria API queries.</p>
</div>
<div class="paragraph">
<p>The main advantage of string-based queries over metamodel queries is the ability to construct Criteria queries at development time without the need to generate static metamodel classes or otherwise access dynamically generated metamodel classes.</p>
</div>
<div class="paragraph">
<p>The main disadvantage to string-based queries is their lack of type safety; this problem may lead to runtime errors due to type mismatches that would be caught at development time if you used strongly typed metamodel queries.</p>
</div>
<div class="paragraph">
<p>For information on constructing criteria queries, see <a href="#using-the-criteria-api-to-create-queries">Chapter 43, <em>Using the Criteria API to Create Queries</em></a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="creating-string-based-queries"><a class="anchor" href="#creating-string-based-queries"></a>Creating String-Based Queries</h3>
<div class="paragraph">
<p>To create a string-based query, specify the attribute names of entity classes directly as strings, instead of specifying the attributes of the metamodel class.
For example, this query finds all <code>Pet</code> entities where the value of the <code>name</code> attribute is <code>Fido</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">CriteriaQuery&lt;Pet&gt; cq = cb.createQuery(Pet.class);
Root&lt;Pet&gt; pet = cq.from(Pet.class);
cq.where(cb.equal(pet.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>), <span class="string"><span class="delimiter">&quot;</span><span class="content">Fido</span><span class="delimiter">&quot;</span></span>));</code></pre>
</div>
</div>
<div class="paragraph">
<p>The name of the attribute is specified as a string.
This query is the equivalent of the following metamodel query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">CriteriaQuery&lt;Pet&gt; cq = cb.createQuery(Pet.class);
Metamodel m = em.getMetamodel();
EntityType&lt;Pet&gt; Pet_ = m.entity(Pet.class);
Root&lt;Pet&gt; pet = cq.from(Pet.class);
cq.where(cb.equal(pet.get(Pet_.name), <span class="string"><span class="delimiter">&quot;</span><span class="content">Fido</span><span class="delimiter">&quot;</span></span>));</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Type mismatch errors in string-based queries will not appear until the code is executed at runtime, unlike in the above metamodel query, where type mismatches will be caught at compile time.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Joins are specified in the same way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">CriteriaQuery&lt;Pet&gt; cq = cb.createQuery(Pet.class);
Root&lt;Pet&gt; pet = cq.from(Pet.class);
Join&lt;<span class="predefined-type">Owner</span>, Address&gt; address = pet.join(<span class="string"><span class="delimiter">&quot;</span><span class="content">owners</span><span class="delimiter">&quot;</span></span>).join(<span class="string"><span class="delimiter">&quot;</span><span class="content">addresses</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>All the conditional expressions, method expressions, path navigation methods, and result restriction methods used in metamodel queries can also be used in string-based queries.
In each case, the attributes are specified using strings.
For example, here is a string-based query that uses the <code>in</code> expression:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">CriteriaQuery&lt;Pet&gt; cq = cb.createQuery(Pet.class);
Root&lt;Pet&gt; pet = cq.from(Pet.class);
cq.where(pet.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">color</span><span class="delimiter">&quot;</span></span>).in(<span class="string"><span class="delimiter">&quot;</span><span class="content">brown</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">black</span><span class="delimiter">&quot;</span></span>));</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is a string-based query that orders the results in descending order by date:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">CriteriaQuery&lt;Pet&gt; cq = cb.createQuery(Pet.class);
Root&lt;Pet&gt; pet = cq.from(Pet.class);
cq.select(pet);
cq.orderBy(cb.desc(pet.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">birthday</span><span class="delimiter">&quot;</span></span>)));</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="executing-string-based-queries"><a class="anchor" href="#executing-string-based-queries"></a>Executing String-Based Queries</h3>
<div class="paragraph">
<p>String-based queries are executed similarly to strongly typed Criteria queries.
First create a <code>jakarta.persistence.TypedQuery</code> object by passing the criteria query object to the <code>EntityManager.createQuery</code> method, then call either <code>getSingleResult</code> or <code>getResultList</code> on the query object to execute the query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">CriteriaQuery&lt;Pet&gt; cq = cb.createQuery(Pet.class);
Root&lt;Pet&gt; pet = cq.from(Pet.class);
cq.where(cb.equal(pet.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>), <span class="string"><span class="delimiter">&quot;</span><span class="content">Fido</span><span class="delimiter">&quot;</span></span>));
TypedQuery&lt;Pet&gt; q = em.createQuery(cq);
<span class="predefined-type">List</span>&lt;Pet&gt; results = q.getResultList();</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="controlling-concurrent-access-to-entity-data-with-locking"><a class="anchor" href="#controlling-concurrent-access-to-entity-data-with-locking"></a>Chapter 45. Controlling Concurrent Access to Entity Data with Locking</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter details how to handle concurrent access to entity data, and the locking strategies available to Jakarta Persistence application developers.</p>
</div>
<div class="sect2">
<h3 id="overview-of-entity-locking-and-concurrency"><a class="anchor" href="#overview-of-entity-locking-and-concurrency"></a>Overview of Entity Locking and Concurrency</h3>
<div class="paragraph">
<p>Entity data is concurrently accessed if the data in a data source is accessed at the same time by multiple applications.
Ensure that the underlying data&#8217;s integrity is preserved when it is accessed concurrently.</p>
</div>
<div class="paragraph">
<p>When data is updated in the database tables in a transaction, the persistence provider assumes the database management system will hold short-term read locks and long-term write locks to maintain data integrity.
Most persistence providers will delay database writes until the end of the transaction, except when the application explicitly calls for a flush (that is, the application calls the <code>EntityManager.flush</code> method or executes queries with the flush mode set to <code>AUTO</code>).</p>
</div>
<div class="paragraph">
<p>By default, persistence providers use optimistic locking, where, before committing changes to the data, the persistence provider checks that no other transaction has modified or deleted the data since the data was read.
This is accomplished by a version column in the database table, with a corresponding version attribute in the entity class.
When a row is modified, the version value is incremented.
The original transaction checks the version attribute, and if the data has been modified by another transaction, a <code>jakarta.persistence.OptimisticLockException</code> will be thrown, and the original transaction will be rolled back.
When the application specifies optimistic lock modes, the persistence provider verifies that a particular entity has not changed since it was read from the database even if the entity data was not modified.</p>
</div>
<div class="paragraph">
<p>Pessimistic locking goes further than optimistic locking.
With pessimistic locking, the persistence provider creates a transaction that obtains a long-term lock on the data until the transaction is completed, which prevents other transactions from modifying or deleting the data until the lock has ended.
Pessimistic locking is a better strategy than optimistic locking when the underlying data is frequently accessed and modified by many transactions.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Using pessimistic locks on entities that are not subject to frequent modification may result in decreased application performance.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="using-optimistic-locking"><a class="anchor" href="#using-optimistic-locking"></a>Using Optimistic Locking</h4>
<div class="paragraph">
<p>Use the <code>jakarta.persistence.Version</code> annotation to mark a persistent field or property as a version attribute of an entity.
The version attribute enables the entity for optimistic concurrency control.
The persistence provider reads and updates the version attribute when an entity instance is modified during a transaction.
The application may read the version attribute, but must not modify the value.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Although some persistence providers may support optimistic locking for entities that do not have version attributes, portable applications should always use entities with version attributes when using optimistic locking.
If the application attempts to lock an entity that does not have a version attribute, and the persistence provider does not support optimistic locking for non-versioned entities, a <code>PersistenceException</code> will be thrown.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>@Version</code> annotation has the following requirements.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Only a single <code>@Version</code> attribute may be defined per entity.</p>
</li>
<li>
<p>The <code>@Version</code> attribute must be in the primary table for an entity mapped to multiple tables.</p>
</li>
<li>
<p>The type of the <code>@Version</code> attribute must be one of the following: <code>int</code>, <code>Integer</code>, <code>long</code>, <code>Long</code>, <code>short</code>, <code>Short</code>, or <code>java.sql.Timestamp</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following code snippet shows how to define a version attribute in an entity with persistent fields:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Version</span>
<span class="directive">protected</span> <span class="type">int</span> version;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following code snippet shows how to define a version attribute in an entity with persistent properties:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Version</span>
<span class="directive">protected</span> <span class="predefined-type">Short</span> getVersion() { ... }</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="lock-modes"><a class="anchor" href="#lock-modes"></a>Lock Modes</h3>
<div class="paragraph">
<p>The application may increase the level of locking for an entity by specifying the use of lock modes.
Lock modes may be specified to increase the level of optimistic locking or to request the use of pessimistic locks.</p>
</div>
<div class="paragraph">
<p>The use of optimistic lock modes causes the persistence provider to check the version attributes for entities that were read (but not modified) during a transaction as well as for entities that were updated.</p>
</div>
<div class="paragraph">
<p>The use of pessimistic lock modes specifies that the persistence provider is to immediately acquire long-term read or write locks for the database data corresponding to entity state.</p>
</div>
<div class="paragraph">
<p>You can set the lock mode for an entity operation by specifying one of the lock modes defined in the <code>jakarta.persistence.LockModeType</code> enumerated type, listed in <a href="#lock-modes-for-concurrent-entity-access">Table 45-1</a>.</p>
</div>
<table id="lock-modes-for-concurrent-entity-access" class="tableblock frame-all grid-all" style="width: 75%;">
<caption class="title">Table 45-1 Lock Modes for Concurrent Entity Access</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Lock Mode</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OPTIMISTIC</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Obtain an optimistic read lock for all entities with version attributes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OPTIMISTIC_FORCE_INCREMENT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Obtain an optimistic read lock for all entities with version attributes, and increment the version attribute value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PESSIMISTIC_READ</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Immediately obtain a long-term read lock on the data to prevent the data from being modified or deleted.
Other transactions may read the data while the lock is maintained, but may not modify or delete the data.</p>
<p class="tableblock">The persistence provider is permitted to obtain a database write lock when a read lock was requested, but not vice versa.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PESSIMISTIC_WRITE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Immediately obtain a long-term write lock on the data to prevent the data from being read, modified, or deleted.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PESSIMISTIC_FORCE_INCREMENT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Immediately obtain a long-term lock on the data to prevent the data from being modified or deleted, and increment the version attribute of versioned entities.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>READ</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A synonym for <code>OPTIMISTIC</code>.
Use of <code>LockModeType.OPTIMISTIC</code> is to be preferred for new applications.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>WRITE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A synonym for <code>OPTIMISTIC_FORCE_INCREMENT</code>.
Use of <code>LockModeType.OPTIMISTIC_FORCE_INCREMENT</code> is to be preferred for new applications.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NONE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No additional locking will occur on the data in the database.</p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="setting-the-lock-mode"><a class="anchor" href="#setting-the-lock-mode"></a>Setting the Lock Mode</h4>
<div class="paragraph">
<p>To specify the lock mode, use one of the following techniques:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Call the <code>EntityManager.lock</code> method, passing in one of the lock modes:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">EntityManager em = ...;
Person person = ...;
em.lock(person, LockModeType.OPTIMISTIC);</code></pre>
</div>
</div>
</li>
<li>
<p>Call one of the <code>EntityManager.find</code> methods that take the lock mode as a parameter:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">EntityManager em = ...;
<span class="predefined-type">String</span> personPK = ...;
Person person = em.find(Person.class, personPK,
    LockModeType.PESSIMISTIC_WRITE);</code></pre>
</div>
</div>
</li>
<li>
<p>Call one of the <code>EntityManager.refresh</code> methods that take the lock mode as a parameter:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">EntityManager em = ...;
<span class="predefined-type">String</span> personPK = ...;
Person person = em.find(Person.class, personPK);
...
em.refresh(person, LockModeType.OPTIMISTIC_FORCE_INCREMENT);</code></pre>
</div>
</div>
</li>
<li>
<p>Call the <code>Query.setLockMode</code> or <code>TypedQuery.setLockMode</code> method, passing the lock mode as the parameter:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Query</span> q = em.createQuery(...);
q.setLockMode(LockModeType.PESSIMISTIC_FORCE_INCREMENT);</code></pre>
</div>
</div>
</li>
<li>
<p>Add a <code>lockMode</code> element to the <code>@NamedQuery</code> annotation:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@NamedQuery</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">lockPersonQuery</span><span class="delimiter">&quot;</span></span>,
  query=<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT p FROM Person p WHERE p.name LIKE :name</span><span class="delimiter">&quot;</span></span>,
  lockMode=PESSIMISTIC_READ)</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="using-pessimistic-locking"><a class="anchor" href="#using-pessimistic-locking"></a>Using Pessimistic Locking</h4>
<div class="paragraph">
<p>Versioned entities, as well as entities that do not have version attributes, can be locked pessimistically.</p>
</div>
<div class="paragraph">
<p>To lock entities pessimistically, set the lock mode to <code>PESSIMISTIC_READ</code>, <code>PESSIMISTIC_WRITE</code>, or <code>PESSIMISTIC_FORCE_INCREMENT</code>.</p>
</div>
<div class="paragraph">
<p>If a pessimistic lock cannot be obtained on the database rows, and the failure to lock the data results in a transaction rollback, a <code>PessimisticLockException</code> is thrown.
If a pessimistic lock cannot be obtained, but the locking failure doesn&#8217;t result in a transaction rollback, a <code>LockTimeoutException</code> is thrown.</p>
</div>
<div class="paragraph">
<p>Pessimistically locking a versioned entity with <code>PESSIMISTIC_FORCE_INCREMENT</code> results in the version attribute being incremented even if the entity data is unmodified.
When pessimistically locking a versioned entity, the persistence provider will perform the version checks that occur during optimistic locking, and if the version check fails, an <code>OptimisticLockException</code> will be thrown.
An attempt to lock a non-versioned entity with <code>PESSIMISTIC_FORCE_INCREMENT</code> is not portable and may result in a <code>PersistenceException</code> if the persistence provider does not support optimistic locks for non-versioned entities.
Locking a versioned entity with <code>PESSIMISTIC_WRITE</code> results in the version attribute being incremented if the transaction was successfully committed.</p>
</div>
<div class="sect4">
<h5 id="pessimistic-locking-timeouts"><a class="anchor" href="#pessimistic-locking-timeouts"></a>Pessimistic Locking Timeouts</h5>
<div class="paragraph">
<p>Use the <code>jakarta.persistence.lock.timeout</code> property to specify the length of time in milliseconds the persistence provider should wait to obtain a lock on the database tables.
If the time it takes to obtain a lock exceeds the value of this property, a <code>LockTimeoutException</code> will be thrown, but the current transaction will not be marked for rollback.
If you set this property to <code>0</code>, the persistence provider should throw a <code>LockTimeoutException</code> if it cannot immediately obtain a lock.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Portable applications should not rely on the setting of <code>jakarta.persistence.lock.timeout</code>, because the locking strategy and underlying database may mean that the timeout value cannot be used.
The value of <code>jakarta.persistence.lock.timeout</code> is a hint, not a contract.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This property may be set programmatically by passing it to the <code>EntityManager</code> methods that allow lock modes to be specified, the <code>Query.setLockMode</code> and <code>TypedQuery.setLockMode</code> methods, the <code>@NamedQuery</code> annotation, and the <code>Persistence.createEntityManagerFactory</code> method.
It may also be set as a property in the <code>persistence.xml</code> deployment descriptor.</p>
</div>
<div class="paragraph">
<p>If <code>jakarta.persistence.lock.timeout</code> is set in multiple places, the value will be determined in the following order:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The argument to one of the <code>EntityManager</code> or <code>Query</code> methods</p>
</li>
<li>
<p>The setting in the <code>@NamedQuery</code> annotation</p>
</li>
<li>
<p>The argument to the <code>Persistence.createEntityManagerFactory</code> method</p>
</li>
<li>
<p>The value in the <code>persistence.xml</code> deployment descriptor</p>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="creating-fetch-plans-with-entity-graphs"><a class="anchor" href="#creating-fetch-plans-with-entity-graphs"></a>Chapter 46. Creating Fetch Plans with Entity Graphs</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter explains how to use entity graphs to create fetch plans for Jakarta Persistence operations and queries.</p>
</div>
<div class="sect2">
<h3 id="overview-of-using-fetch-plans-and-entity-graphs"><a class="anchor" href="#overview-of-using-fetch-plans-and-entity-graphs"></a>Overview of Using Fetch Plans and Entity Graphs</h3>
<div class="paragraph">
<p>Entity graphs are templates for a particular Persistence query or operation.
They are used when creating fetch plans, or groups of persistent fields that are retrieved at the same time.
Application developers use fetch plans to group together related persistent fields to improve runtime performance.</p>
</div>
<div class="paragraph">
<p>By default, entity fields or properties are fetched lazily.
Developers specify fields or properties as part of a fetch plan, and the persistence provider will fetch them eagerly.</p>
</div>
<div class="paragraph">
<p>For example, an email application that stores messages as <code>EmailMessage</code> entities prioritizes fetching some fields over others.
The sender, subject, and date will be viewed the most often, in mailbox views and when the message is displayed.
The <code>EmailMessage</code> entity has a collection of related <code>EmailAttachment</code> entities.
For performance reasons the attachments should not be fetched until they are needed, but the file names of the attachment are important.
A developer working on this application might make a fetch plan that eagerly fetches the important fields from <code>EmailMessage</code> and <code>EmailAttachment</code> while fetching the lower priority data lazily.</p>
</div>
</div>
<div class="sect2">
<h3 id="entity-graph-basics"><a class="anchor" href="#entity-graph-basics"></a>Entity Graph Basics</h3>
<div class="paragraph">
<p>You can create entity graphs statically by using annotations or a deployment descriptor, or dynamically by using standard interfaces.</p>
</div>
<div class="paragraph">
<p>You can use an entity graph with the <code>EntityManager.find</code> method or as part of a JPQL or Criteria API query by specifying the entity graph as a hint to the operation or query.</p>
</div>
<div class="paragraph">
<p>Entity graphs have attributes that correspond to the fields that will be eagerly fetched during a <code>find</code> or query operation.
The primary key and version fields of the entity class are always fetched and do not need to be explicitly added to an entity graph.</p>
</div>
<div class="sect3">
<h4 id="the-default-entity-graph"><a class="anchor" href="#the-default-entity-graph"></a>The Default Entity Graph</h4>
<div class="paragraph">
<p>By default, all fields in an entity are fetched lazily unless the <code>fetch</code> attribute of the entity metadata is set to <code>jakarta.persistence.FetchType.EAGER</code>.
The default entity graph consists of all the fields of an entity whose fields are set to be eagerly fetched.</p>
</div>
<div class="paragraph">
<p>For example, the following <code>EmailMessage</code> entity specifies that some fields will be fetched eagerly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Entity</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">EmailMessage</span> <span class="directive">implements</span> <span class="predefined-type">Serializable</span> {
    <span class="annotation">@Id</span>
    <span class="predefined-type">String</span> messageId;
    <span class="annotation">@Basic</span>(fetch=EAGER)
    <span class="predefined-type">String</span> subject;
    <span class="predefined-type">String</span> body;
    <span class="annotation">@Basic</span>(fetch=EAGER)
    <span class="predefined-type">String</span> sender;
    <span class="annotation">@OneToMany</span>(mappedBy=<span class="string"><span class="delimiter">&quot;</span><span class="content">message</span><span class="delimiter">&quot;</span></span>, fetch=LAZY)
    <span class="predefined-type">Set</span>&lt;EmailAttachment&gt; attachments;
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The default entity graph for this entity would contain the <code>messageId</code>, <code>subject</code>, and <code>sender</code> fields, but not the <code>body</code> or <code>attachments</code> fields.</p>
</div>
</div>
<div class="sect3">
<h4 id="using-entity-graphs-in-persistence-operations"><a class="anchor" href="#using-entity-graphs-in-persistence-operations"></a>Using Entity Graphs in Persistence Operations</h4>
<div class="paragraph">
<p>Entity graphs are used by creating an instance of the <code>jakarta.persistence.EntityGraph</code> interface by calling either <code>EntityManager.getEntityGraph</code> for named entity graphs or <code>EntityManager.createEntityGraph</code> for creating dynamic entity graphs.</p>
</div>
<div class="paragraph">
<p>A named entity graph is an entity graph specified by the <code>@NamedEntityGraph</code> annotation applied to entity classes, or the <code>named-entity-graph</code> element in the application&#8217;s deployment descriptors.
Named entity graphs defined within the deployment descriptor override any annotation-based entity graphs with the same name.</p>
</div>
<div class="paragraph">
<p>The created entity graph can be either a fetch graph or a load graph.</p>
</div>
<div class="sect4">
<h5 id="fetch-graphs"><a class="anchor" href="#fetch-graphs"></a>Fetch Graphs</h5>
<div class="paragraph">
<p>To specify a fetch graph, set the <code>jakarta.persistence.fetchgraph</code> property when you execute an <code>EntityManager.find</code> or query operation.
A fetch graph consists of only the fields explicitly specified in the <code>EntityGraph</code> instance, and ignores the default entity graph settings.</p>
</div>
<div class="paragraph">
<p>In the following example, the default entity graph is ignored, and only the <code>body</code> field is included in the dynamically created fetch graph:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">EntityGraph&lt;EmailMessage&gt; eg = em.createEntityGraph(EmailMessage.class);
eg.addAttributeNodes(<span class="string"><span class="delimiter">&quot;</span><span class="content">body</span><span class="delimiter">&quot;</span></span>);
...
Properties props = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();
props.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">jakarta.persistence.fetchgraph</span><span class="delimiter">&quot;</span></span>, eg);
EmailMessage message = em.find(EmailMessage.class, id, props);</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="load-graphs"><a class="anchor" href="#load-graphs"></a>Load Graphs</h5>
<div class="paragraph">
<p>To specify a load graph, set the <code>jakarta.persistence.loadgraph</code> property when you execute an <code>EntityManager.find</code> or query operation.
A load graph consists of the fields explicitly specified in the <code>EntityGraph</code> instance plus any fields in the default entity graph.</p>
</div>
<div class="paragraph">
<p>In the following example, the dynamically created load graph contains all the fields in the default entity graph plus the <code>body</code> field:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">EntityGraph&lt;EmailMessage&gt; eg = em.createEntityGraph(EmailMessage.class);
eg.addAttributeNodes(<span class="string"><span class="delimiter">&quot;</span><span class="content">body</span><span class="delimiter">&quot;</span></span>);
...
Properties props = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();
props.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">jakarta.persistence.loadgraph</span><span class="delimiter">&quot;</span></span>, eg);
EmailMessage message = em.find(EmailMessage.class, id, props);</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-named-entity-graphs"><a class="anchor" href="#using-named-entity-graphs"></a>Using Named Entity Graphs</h3>
<div class="paragraph">
<p>Named entity graphs are created using annotations applied to entity classes or the <code>named-entity-graph</code> element and its sub-elements in the application&#8217;s deployment descriptor.
The persistence provider will scan for all named entity graphs, defined in both annotations and in XML, within an application.
A named entity graph set using an annotation may be overridden using <code>named-entity-graph</code>.</p>
</div>
<div class="sect3">
<h4 id="applying-named-entity-graph-annotations-to-entity-classes"><a class="anchor" href="#applying-named-entity-graph-annotations-to-entity-classes"></a>Applying Named Entity Graph Annotations to Entity Classes</h4>
<div class="paragraph">
<p>The <code>jakarta.persistence.NamedEntityGraph</code> annotation defines a single named entity graph and is applied at the class level.
Multiple <code>@NamedEntityGraph</code> annotations may be defined for a class by adding them within a <code>jakarta.persistence.NamedEntityGraphs</code> class-level annotation.</p>
</div>
<div class="paragraph">
<p>The <code>@NamedEntityGraph</code> annotation must be applied on the root of the graph of entities.
That is, if the <code>EntityManager.find</code> or query operation has as its root entity the <code>EmailMessage</code> class, the named entity graph used in the operation must be defined in the <code>EmailMessage</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@NamedEntityGraph</span>
<span class="annotation">@Entity</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">EmailMessage</span> {
    <span class="annotation">@Id</span>
    <span class="predefined-type">String</span> messageId;
    <span class="predefined-type">String</span> subject;
    <span class="predefined-type">String</span> body;
    <span class="predefined-type">String</span> sender;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the <code>EmailMessage</code> class has a <code>@NamedEntityGraph</code> annotation to define a named entity graph that defaults to the name of the class, <code>EmailMessage</code>.
No fields are included in the <code>@NamedEntityGraph</code> annotation as attribute nodes, and the fields are not annotated with metadata to set the fetch type, so the only field that will be eagerly fetched in either a load graph or fetch graph is <code>messageId</code>.</p>
</div>
<div class="paragraph">
<p>The attributes of a named entity graph are the fields of the entity that should be included in the entity graph.
Add the fields to the entity graph by specifying them in the <code>attributeNodes</code> element of <code>@NamedEntityGraph</code> with a <code>jakarta.persistence.NamedAttributeNode</code> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@NamedEntityGraph</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">emailEntityGraph</span><span class="delimiter">&quot;</span></span>, attributeNodes={
    <span class="annotation">@NamedAttributeNode</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">subject</span><span class="delimiter">&quot;</span></span>),
    <span class="annotation">@NamedAttributeNode</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">sender</span><span class="delimiter">&quot;</span></span>)
})
<span class="annotation">@Entity</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">EmailMessage</span> { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the name of the named entity graph is <code>emailEntityGraph</code> and includes the <code>subject</code> and <code>sender</code> fields.</p>
</div>
<div class="paragraph">
<p>Multiple <code>@NamedEntityGraph</code> definitions may be applied to a class by grouping them within a <code>@NamedEntityGraphs</code> annotation.</p>
</div>
<div class="paragraph">
<p>In the following example, two entity graphs are defined on the <code>EmailMessage</code> class.
One is for a preview pane, which fetches only the sender, subject, and body of the message.
The other is for a full view of the message, including any message attachments:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@NamedEntityGraphs</span>({
    <span class="annotation">@NamedEntityGraph</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">previewEmailEntityGraph</span><span class="delimiter">&quot;</span></span>, attributeNodes={
        <span class="annotation">@NamedAttributeNode</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">subject</span><span class="delimiter">&quot;</span></span>),
        <span class="annotation">@NamedAttributeNode</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">sender</span><span class="delimiter">&quot;</span></span>),
        <span class="annotation">@NamedAttributeNode</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">body</span><span class="delimiter">&quot;</span></span>)
    }),
    <span class="annotation">@NamedEntityGraph</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">fullEmailEntityGraph</span><span class="delimiter">&quot;</span></span>, attributeNodes={
        <span class="annotation">@NamedAttributeNode</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">sender</span><span class="delimiter">&quot;</span></span>),
        <span class="annotation">@NamedAttributeNode</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">subject</span><span class="delimiter">&quot;</span></span>),
        <span class="annotation">@NamedAttributeNode</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">body</span><span class="delimiter">&quot;</span></span>),
        <span class="annotation">@NamedAttributeNode</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">attachments</span><span class="delimiter">&quot;</span></span>)
    })
})
<span class="annotation">@Entity</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">EmailMessage</span> { ... }</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="obtaining-entitygraph-instances-from-named-entity-graphs"><a class="anchor" href="#obtaining-entitygraph-instances-from-named-entity-graphs"></a>Obtaining EntityGraph Instances from Named Entity Graphs</h4>
<div class="paragraph">
<p>Use the <code>EntityManager.getEntityGraph</code> method, passing in the named entity graph name, to obtain <code>EntityGraph</code> instances for a named entity graph:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">EntityGraph&lt;EmailMessage&gt; eg = em.getEntityGraph(<span class="string"><span class="delimiter">&quot;</span><span class="content">emailEntityGraph</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-entity-graphs-in-query-operations"><a class="anchor" href="#using-entity-graphs-in-query-operations"></a>Using Entity Graphs in Query Operations</h3>
<div class="paragraph">
<p>To specify entity graphs for both typed and untyped queries, call the <code>setHint</code> method on the query object and specify either <code>jakarta.persistence.loadgraph</code> or <code>jakarta.persistence.fetchgraph</code> as the property name and an <code>EntityGraph</code> instance as the value:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">EntityGraph&lt;EmailMessage&gt; eg = em.getEntityGraph(<span class="string"><span class="delimiter">&quot;</span><span class="content">previewEmailEntityGraph</span><span class="delimiter">&quot;</span></span>);
<span class="predefined-type">List</span>&lt;EmailMessage&gt; messages = em.createNamedQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">findAllEmailMessages</span><span class="delimiter">&quot;</span></span>)
        .setParameter(<span class="string"><span class="delimiter">&quot;</span><span class="content">mailbox</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">inbox</span><span class="delimiter">&quot;</span></span>)
        .setHint(<span class="string"><span class="delimiter">&quot;</span><span class="content">jakarta.persistence.loadgraph</span><span class="delimiter">&quot;</span></span>, eg)
        .getResultList();</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the <code>previewEmailEntityGraph</code> is used for the <code>findAllEmailMessages</code> named query.</p>
</div>
<div class="paragraph">
<p>Typed queries use the same technique:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">EntityGraph&lt;EmailMessage&gt; eg = em.getEntityGraph(<span class="string"><span class="delimiter">&quot;</span><span class="content">previewEmailEntityGraph</span><span class="delimiter">&quot;</span></span>);

CriteriaQuery&lt;EmailMessage&gt; cq = cb.createQuery(EmailMessage.class);
Root&lt;EmailMessage&gt; message = cq.from(EmailMessage.class);
TypedQuery&lt;EmailMessage&gt; q = em.createQuery(cq);
q.setHint(<span class="string"><span class="delimiter">&quot;</span><span class="content">jakarta.persistence.loadgraph</span><span class="delimiter">&quot;</span></span>, eg);
<span class="predefined-type">List</span>&lt;EmailMessage&gt; messages = q.getResultList();</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using-a-second-level-cache-with-jakarta-persistence-applications"><a class="anchor" href="#using-a-second-level-cache-with-jakarta-persistence-applications"></a>Chapter 47. Using a Second-Level Cache with Jakarta Persistence Applications</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter explains how to modify the second-level cache mode settings to improve the performance of applications that use the Jakarta Persistence.</p>
</div>
<div class="sect2">
<h3 id="overview-of-the-second-level-cache"><a class="anchor" href="#overview-of-the-second-level-cache"></a>Overview of the Second-Level Cache</h3>
<div class="paragraph">
<p>A second-level cache is a local store of entity data managed by the persistence provider to improve application performance.
A second-level cache helps improve performance by avoiding expensive database calls, keeping the entity data local to the application.
A second-level cache is typically transparent to the application, as it is managed by the persistence provider and underlies the persistence context of an application.
That is, the application reads and commits data through the normal entity manager operations without knowing about the cache.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Persistence providers are not required to support a second-level cache.
Portable applications should not rely on support by persistence providers for a second-level cache.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The second-level cache for a persistence unit may be configured to one of several second-level cache modes.
The following cache mode settings are defined by Jakarta Persistence.</p>
</div>
<table id="cache-mode-settings-for-the-second-level-cache" class="tableblock frame-all grid-all" style="width: 80%;">
<caption class="title">Table 47-1 Cache Mode Settings for the Second-Level Cache</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Cache Mode Setting</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ALL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All entity data is stored in the second-level cache for this persistence unit.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NONE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No data is cached in the persistence unit.
The persistence provider must not cache any data.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ENABLE_SELECTIVE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable caching for entities that have been explicitly set with the <code>@Cacheable</code> annotation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DISABLE_SELECTIVE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable caching for all entities except those that have been explicitly set with the <code>@Cacheable(false)</code> annotation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>UNSPECIFIED</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The caching behavior for the persistence unit is undefined.
The persistence provider&#8217;s default caching behavior will be used.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>One consequence of using a second-level cache in an application is that the underlying data may have changed in the database tables, while the value in the cache has not, a circumstance called a stale read.
To avoid stale reads, use any of these strategies:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Change the second-level cache to one of the cache mode settings</p>
</li>
<li>
<p>Control which entities may be cached (see <a href="#controlling-whether-entities-may-be-cached">Controlling whether Entities May Be Cached</a>)</p>
</li>
<li>
<p>Change the cache&#8217;s retrieval or store modes (see <a href="#setting-the-cache-retrieval-and-store-modes">Setting the Cache Retrieval and Store Modes</a>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Which of these strategies works best to avoid stale reads depends upon the application.</p>
</div>
<div class="sect3">
<h4 id="controlling-whether-entities-may-be-cached"><a class="anchor" href="#controlling-whether-entities-may-be-cached"></a>Controlling whether Entities May Be Cached</h4>
<div class="paragraph">
<p>The <code>jakarta.persistence.Cacheable</code> annotation is used to specify that an entity class, and any subclasses, may be cached when using the <code>ENABLE_SELECTIVE</code> or <code>DISABLE_SELECTIVE</code> cache modes.
Subclasses may override the <code>@Cacheable</code> setting by adding a <code>@Cacheable</code> annotation and changing the value.</p>
</div>
<div class="paragraph">
<p>To specify that an entity may be cached, add a <code>@Cacheable</code> annotation at the class level:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Cacheable</span>
<span class="annotation">@Entity</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Person</span> { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, the <code>@Cacheable</code> annotation is <code>true</code>.
The following example is equivalent:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Cacheable</span>(<span class="predefined-constant">true</span>)
<span class="annotation">@Entity</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Person</span>{ ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>To specify that an entity must not be cached, add a <code>@Cacheable</code> annotation and set it to <code>false</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Cacheable</span>(<span class="predefined-constant">false</span>)
<span class="annotation">@Entity</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">OrderStatus</span> { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>When the <code>ENABLE_SELECTIVE</code> cache mode is set, the persistence provider will cache any entities that have the <code>@Cacheable(true)</code> annotation and any subclasses of that entity that have not been overridden.
The persistence provider will not cache entities that have <code>@Cacheable(false)</code> or have no <code>@Cacheable</code> annotation.
That is, the <code>ENABLE_SELECTIVE</code> mode will cache only entities that have been explicitly marked for the cache using the <code>@Cacheable</code> annotation.</p>
</div>
<div class="paragraph">
<p>When the <code>DISABLE_SELECTIVE</code> cache mode is set, the persistence provider will cache any entities that do not have the <code>@Cacheable(false)</code> annotation.
Entities that do not have <code>@Cacheable</code> annotations, and entities with the <code>@Cacheable(true)</code> annotation, will be cached.
That is, the <code>DISABLE_SELECTIVE</code> mode will cache all entities that have not been explicitly prevented from being cached.</p>
</div>
<div class="paragraph">
<p>If the cache mode is set to <code>UNDEFINED</code>, or is left unset, the behavior of entities annotated with <code>@Cacheable</code> is undefined.
If the cache mode is set to <code>ALL</code> or <code>NONE</code>, the value of the <code>@Cacheable</code> annotation is ignored by the persistence provider.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="specifying-the-cache-mode-settings-to-improve-performance"><a class="anchor" href="#specifying-the-cache-mode-settings-to-improve-performance"></a>Specifying the Cache Mode Settings to Improve Performance</h3>
<div class="paragraph">
<p>To adjust the cache mode settings for a persistence unit, specify one of the cache modes as the value of the <code>shared-cache-mode</code> element in the <code>persistence.xml</code> deployment descriptor (shown in bold):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;persistence-unit</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">examplePU</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">transaction-type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">JTA</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;provider&gt;</span>org.eclipse.persistence.jpa.PersistenceProvider<span class="tag">&lt;/provider&gt;</span>
    <span class="tag">&lt;jta-data-source&gt;</span>java:comp/DefaultDataSource<span class="tag">&lt;/jta-data-source&gt;</span>
    <span class="tag">&lt;shared-cache-mode&gt;</span>DISABLE_SELECTIVE<span class="tag">&lt;/shared-cache-mode&gt;</span>
<span class="tag">&lt;/persistence-unit&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Because support for a second-level cache is not required by the Jakarta Persistence specification, setting the second-level cache mode in <code>persistence.xml</code> will have no effect when you use a persistence provider that does not implement a second-level cache.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Alternatively, you can specify the shared cache mode by setting the <code>jakarta.persistence.sharedCache.mode</code> property to one of the shared cache mode settings:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">EntityManagerFactory emf =
    Persistence.createEntityManagerFactory(
        <span class="string"><span class="delimiter">&quot;</span><span class="content">myExamplePU</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> <span class="predefined-type">Properties</span>().add(
            <span class="string"><span class="delimiter">&quot;</span><span class="content">jakarta.persistence.sharedCache.mode</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">ENABLE_SELECTIVE</span><span class="delimiter">&quot;</span></span>));</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="setting-the-cache-retrieval-and-store-modes"><a class="anchor" href="#setting-the-cache-retrieval-and-store-modes"></a>Setting the Cache Retrieval and Store Modes</h4>
<div class="paragraph">
<p>If you have enabled the second-level cache for a persistence unit by setting the shared cache mode, you can further modify the behavior of the second-level cache by setting the <code>jakarta.persistence.cache.retrieveMode</code> and <code>jakarta.persistence.cache.storeMode</code> properties.
You can set these properties at the persistence context level by passing the property name and value to the <code>EntityManager.setProperty</code> method, or you can set them on a per-<code>EntityManager</code> operation (<code>EntityManager.find</code> or <code>EntityManager.refresh</code>) or on a per-query level.</p>
</div>
<div class="sect4">
<h5 id="cache-retrieval-mode"><a class="anchor" href="#cache-retrieval-mode"></a>Cache Retrieval Mode</h5>
<div class="paragraph">
<p>The cache retrieval mode, set by the <code>jakarta.persistence.retrieveMode</code> property, controls how data is read from the cache for calls to the <code>EntityManager.find</code> method and from queries.</p>
</div>
<div class="paragraph">
<p>You can set the <code>retrieveMode</code> property to one of the constants defined by the <code>jakarta.persistence.CacheRetrieveMode</code> enumerated type, either <code>USE</code> (the default) or <code>BYPASS</code>.</p>
</div>
<div class="paragraph">
<p>When the property is set to <code>USE</code>, data is retrieved from the second-level cache, if available.
If the data is not in the cache, the persistence provider will read it from the database.</p>
</div>
<div class="paragraph">
<p>When the property is set to <code>BYPASS</code>, the second-level cache is bypassed and a call to the database is made to retrieve the data.</p>
</div>
</div>
<div class="sect4">
<h5 id="cache-store-mode"><a class="anchor" href="#cache-store-mode"></a>Cache Store Mode</h5>
<div class="paragraph">
<p>The cache store mode, set by the <code>jakarta.persistence.storeMode</code> property, controls how data is stored in the cache.</p>
</div>
<div class="paragraph">
<p>The <code>storeMode</code> property can be set to one of the constants defined by the <code>jakarta.persistence.CacheStoreMode</code> enumerated type: either <code>USE</code> (the default), <code>BYPASS</code>, or <code>REFRESH</code>.</p>
</div>
<div class="paragraph">
<p>When the property is set to <code>USE</code>, the cache data is created or updated when data is read from or committed to the database.
If data is already in the cache, setting the store mode to <code>USE</code> will not force a refresh when data is read from the database.</p>
</div>
<div class="paragraph">
<p>When the property is set to <code>BYPASS</code>, data read from or committed to the database is not inserted or updated in the cache.
That is, the cache is unchanged.</p>
</div>
<div class="paragraph">
<p>When the property is set to <code>REFRESH</code>, the cache data is created or updated when data is read from or committed to the database, and a refresh is forced on data in the cache upon database reads.</p>
</div>
</div>
<div class="sect4">
<h5 id="setting-the-cache-retrieval-or-store-mode"><a class="anchor" href="#setting-the-cache-retrieval-or-store-mode"></a>Setting the Cache Retrieval or Store Mode</h5>
<div class="paragraph">
<p>To set the cache retrieval or store mode for the persistence context, call the <code>EntityManager.setProperty</code> method with the property name and value pair:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">EntityManager em = ...;
em.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">jakarta.persistence.cache.storeMode</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">BYPASS</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>To set the cache retrieval or store mode when calling the <code>EntityManager.find</code> or <code>EntityManager.refresh</code> methods, first create a <code>Map&lt;String, Object&gt;</code> instance and add a name/value pair as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">EntityManager em = ...;
<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; props = <span class="keyword">new</span> <span class="predefined-type">HashMap</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt;();
props.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">jakarta.persistence.cache.retrieveMode</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">BYPASS</span><span class="delimiter">&quot;</span></span>);
<span class="predefined-type">String</span> personPK = ...;
Person person = em.find(Person.class, personPK, props);</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The cache retrieval mode is ignored when calling the <code>EntityManager.refresh</code> method, as calls to <code>refresh</code> always result in data being read from the database, not the cache.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To set the retrieval or store mode when using queries, call the <code>Query.setHint</code> or <code>TypedQuery.setHint</code> methods, depending on the type of query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">EntityManager em = ...;
CriteriaQuery&lt;Person&gt; cq = ...;
TypedQuery&lt;Person&gt; q = em.createQuery(cq);
q.setHint(<span class="string"><span class="delimiter">&quot;</span><span class="content">jakarta.persistence.cache.storeMode</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">REFRESH</span><span class="delimiter">&quot;</span></span>);
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Setting the store or retrieve mode in a query or when calling the <code>EntityManager.find</code> or <code>EntityManager.refresh</code> method overrides the setting of the entity manager.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="controlling-the-second-level-cache-programmatically"><a class="anchor" href="#controlling-the-second-level-cache-programmatically"></a>Controlling the Second-Level Cache Programmatically</h4>
<div class="paragraph">
<p>The <code>jakarta.persistence.Cache</code> interface defines methods for interacting with the second-level cache programmatically.</p>
</div>
<div class="sect4">
<h5 id="overview-of-the-jakarta-persistence-cache-interface"><a class="anchor" href="#overview-of-the-jakarta-persistence-cache-interface"></a>Overview of the jakarta.persistence.Cache Interface</h5>
<div class="paragraph">
<p>The <code>Cache</code> interface defines methods to do the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Check whether a particular entity has cached data</p>
</li>
<li>
<p>Remove a particular entity from the cache</p>
</li>
<li>
<p>Remove all instances (and instances of subclasses) of an entity class from the cache</p>
</li>
<li>
<p>Clear the cache of all entity data</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If the second-level cache has been disabled, calls to the <code>Cache</code> interface&#8217;s methods have no effect, except for <code>contains</code>, which will always return <code>false</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="checking-whether-an-entitys-data-is-cached"><a class="anchor" href="#checking-whether-an-entitys-data-is-cached"></a>Checking whether an Entity&#8217;s Data Is Cached</h5>
<div class="paragraph">
<p>To find out whether a given entity is currently in the second-level cache:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Call the <code>Cache.contains</code> method .
The <code>contains</code> method returns <code>true</code> if the entity&#8217;s data is cached, and <code>false</code> if the data is not in the cache:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">EntityManager em = ...;
Cache cache = em.getEntityManagerFactory().getCache();
<span class="predefined-type">String</span> personPK = ...;
<span class="keyword">if</span> (cache.contains(Person.class, personPK)) {
  <span class="comment">// the data is cached</span>
} <span class="keyword">else</span> {
  <span class="comment">// the data is NOT cached</span>
}</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="removing-an-entity-from-the-cache"><a class="anchor" href="#removing-an-entity-from-the-cache"></a>Removing an Entity from the Cache</h5>
<div class="paragraph">
<p>To remove a particular entity or all entities of a given type from the second-level cache:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Call one of the <code>Cache.evict</code> methods.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>To remove a particular entity from the cache, call the <code>evict</code> method and pass in the entity class and the primary key of the entity:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">EntityManager em = ...;
Cache cache = em.getEntityManagerFactory().getCache();
<span class="predefined-type">String</span> personPK = ...;
cache.evict(Person.class, personPK);</code></pre>
</div>
</div>
</li>
<li>
<p>To remove all instances of a particular entity class, including subclasses, call the <code>evict</code> method and specify the entity class:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">EntityManager em = ...;
Cache cache = em.getEntityManagerFactory().getCache();
cache.evict(Person.class);</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>All instances of the <code>Person</code> entity class will be removed from the cache.
If the <code>Person</code> entity has a subclass, <code>Student</code>, calls to the above method will remove all instances of <code>Student</code> from the cache as well.</p>
</div>
</div>
<div class="sect4">
<h5 id="removing-all-data-from-the-cache"><a class="anchor" href="#removing-all-data-from-the-cache"></a>Removing All Data from the Cache</h5>
<div class="paragraph">
<p>To completely clear the second-level cache, call the <code>Cache.evictAll</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">EntityManager em = ...;
Cache cache = em.getEntityManagerFactory().getCache();
cache.evictAll();</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<h1 id="messaging" class="sect0"><a class="anchor" href="#messaging"></a>Part IX: Messaging</h1>
<div class="openblock partintro">
<div class="content">
Part IX introduces messaging.
</div>
</div>
<div class="sect1">
<h2 id="jakarta-messaging-concepts"><a class="anchor" href="#jakarta-messaging-concepts"></a>Chapter 48. Jakarta Messaging Concepts</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter provides an introduction to Jakarta Messaging, a Java API that allows applications to create, send, receive, and read messages using reliable, asynchronous, loosely coupled communication.</p>
</div>
<div class="sect2">
<h3 id="jakarta-messaging-overview"><a class="anchor" href="#jakarta-messaging-overview"></a>Jakarta Messaging Overview</h3>
<div class="paragraph">
<p>This overview defines the concept of messaging, describes Jakarta Messaging and where it can be used, and explains how Jakarta Messaging works within the Jakarta EE platform.</p>
</div>
<div class="sect3">
<h4 id="what-is-messaging"><a class="anchor" href="#what-is-messaging"></a>What Is Messaging?</h4>
<div class="paragraph">
<p>Messaging is a method of communication between software components or applications.
A messaging system is a peer-to-peer facility: A messaging client can send messages to, and receive messages from, any other client.
Each client connects to a messaging agent that provides facilities for creating, sending, receiving, and reading messages.</p>
</div>
<div class="paragraph">
<p>Messaging enables distributed communication that is loosely coupled.
A component sends a message to a destination, and the recipient can retrieve the message from the destination.
What makes the communication loosely coupled is that the destination is all that the sender and receiver have in common.
The sender and the receiver do not have to be available at the same time in order to communicate.
In fact, the sender does not need to know anything about the receiver; nor does the receiver need to know anything about the sender.
The sender and the receiver need to know only which message format and which destination to use.
In this respect, messaging differs from tightly coupled technologies, such as Remote Method Invocation (RMI), which require an application to know a remote application&#8217;s methods.</p>
</div>
<div class="paragraph">
<p>Messaging also differs from electronic mail (email), which is a method of communication between people or between software applications and people.
Messaging is used for communication between software applications or software components.</p>
</div>
</div>
<div class="sect3">
<h4 id="what-is-jakarta-messaging"><a class="anchor" href="#what-is-jakarta-messaging"></a>What Is Jakarta Messaging?</h4>
<div class="paragraph">
<p>Jakarta Messaging is a Java API that allows applications to create, send, receive, and read messages.
Jakarta Messaging defines a common set of interfaces and associated semantics that allow programs written in the Java programming language to communicate with other messaging implementations.</p>
</div>
<div class="paragraph">
<p>Jakarta Messaging minimizes the set of concepts a programmer must learn in order to use messaging products but provides enough features to support sophisticated messaging applications.
It also strives to maximize the portability of Messaging applications across providers.</p>
</div>
<div class="paragraph">
<p>Jakarta Messaging enables communication that is not only loosely coupled but also</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Asynchronous: A receiving client does not have to receive messages at the same time the sending client sends them.
The sending client can send them and go on to other tasks; the receiving client can receive them much later.</p>
</li>
<li>
<p>Reliable: A messaging provider that implements Jakarta Messaging can ensure that a message is delivered once and only once.
Lower levels of reliability are available for applications that can afford to miss messages or to receive duplicate messages.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The current version of the Jakarta Messaging specification is Version 3.0.</p>
</div>
</div>
<div class="sect3">
<h4 id="when-can-you-use-jakarta-messaging"><a class="anchor" href="#when-can-you-use-jakarta-messaging"></a>When Can You Use Jakarta Messaging?</h4>
<div class="paragraph">
<p>An enterprise application provider is likely to choose a messaging API over a tightly coupled API, such as a remote procedure call (RPC), under the following circumstances.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The provider wants the components not to depend on information about other components' interfaces, so components can be easily replaced.</p>
</li>
<li>
<p>The provider wants the application to run whether or not all components are up and running simultaneously.</p>
</li>
<li>
<p>The application business model allows a component to send information to another and to continue to operate without receiving an immediate response.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, components of an enterprise application for an automobile manufacturer can use Jakarta Messaging in situations like the following.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The inventory component can send a message to the factory component when the inventory level for a product goes below a certain level so the factory can make more cars.</p>
</li>
<li>
<p>The factory component can send a message to the parts components so the factory can assemble the parts it needs.</p>
</li>
<li>
<p>The parts components in turn can send messages to their own inventory and order components to update their inventories and to order new parts from suppliers.</p>
</li>
<li>
<p>Both the factory and the parts components can send messages to the accounting component to update budget numbers.</p>
</li>
<li>
<p>The business can publish updated catalog items to its sales force.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Using messaging for these tasks allows the various components to interact with one another efficiently, without tying up network or other resources.
<a href="#messaging-in-an-enterpise-application">Figure 48-1</a> illustrates how this simple example might work.</p>
</div>
<div id="messaging-in-an-enterpise-application" class="imageblock">
<div class="content">
<img src="images/jakartaeett_dt_026.svg" alt="Diagram showing messaging between various departments in an enterprise">
</div>
<div class="title">Figure 48-1 Messaging in an Enterprise Application</div>
</div>
<div class="paragraph">
<p>Manufacturing is only one example of how an enterprise can use the Jakarta Messaging API.
Retail applications, financial services applications, health services applications, and many others can make use of messaging.</p>
</div>
</div>
<div class="sect3">
<h4 id="how-does-jakarta-messaging-work-with-the-jakarta-ee-platform"><a class="anchor" href="#how-does-jakarta-messaging-work-with-the-jakarta-ee-platform"></a>How Does Jakarta Messaging Work with the Jakarta EE Platform?</h4>
<div class="paragraph">
<p>When JMS was first introduced, its most important purpose was to allow Java applications to access existing messaging-oriented middleware (MOM) systems.
Since that time, many vendors have adopted and implemented JMS, so a Jakarta Messaging product can now provide a complete messaging capability for an enterprise.</p>
</div>
<div class="paragraph">
<p>Jakarta Messaging is an integral part of the Jakarta EE platform, and application developers can use messaging with Jakarta EE components. Jakarta Messaging 2.0 is part of the Jakarta EE 8 release.</p>
</div>
<div class="paragraph">
<p>Jakarta Messaging in the Jakarta EE platform has the following features.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Application clients, Jakarta Enterprise Beans components, and web components can send or synchronously receive a Jakarta Messaging message.
Application clients can in addition set a message listener that allows Jakarta Messaging messages to be delivered to it asynchronously by being notified when a message is available.</p>
</li>
<li>
<p>Message-driven beans, which are a kind of enterprise bean, enable the asynchronous consumption of messages in the enterprise bean container.
An application server typically pools message-driven beans to implement concurrent processing of messages.</p>
</li>
<li>
<p>Message send and receive operations can participate in Jakarta transactions, which allow Jakarta Messaging operations and database accesses to take place within a single transaction.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Jakarta Messaging enhances the other parts of the Jakarta EE platform by simplifying enterprise development, allowing loosely coupled, reliable, asynchronous interactions among Jakarta EE components and legacy systems capable of messaging.
A developer can easily add new behavior to a Jakarta EE application that has existing business events by adding a new message-driven bean to operate on specific business events.
The Jakarta EE platform, moreover, enhances Jakarta Messaging by providing support for Jakarta Transactions and allowing for the concurrent consumption of messages.
For more information, see the Jakarta Enterprise Beans specification, v4.0.</p>
</div>
<div class="paragraph">
<p>The Jakarta Messaging provider can be integrated with the application server using the Jakarta Connectors.
You access the Messaging provider through a resource adapter.
This capability allows vendors to create Messaging providers that can be plugged in to multiple application servers, and it allows application servers to support multiple Messaging providers.
For more information, see the Jakarta Connectors specification, v2.0.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="basic-jakarta-messaging-concepts"><a class="anchor" href="#basic-jakarta-messaging-concepts"></a>Basic Jakarta Messaging Concepts</h3>
<div class="paragraph">
<p>This section introduces the most basic Jakarta Messaging concepts, the ones you must know to get started writing simple application clients that use the Jakarta Messaging.</p>
</div>
<div class="paragraph">
<p>The next section introduces the Jakarta Messaging programming model.
Later sections cover more advanced concepts, including the ones you need in order to write applications that use message-driven beans.</p>
</div>
<div class="sect3">
<h4 id="jakarta-messaging-architecture"><a class="anchor" href="#jakarta-messaging-architecture"></a>Jakarta Messaging Architecture</h4>
<div class="paragraph">
<p>A Jakarta Messaging application is composed of the following parts.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A Jakarta Messaging provider is a messaging system that implements the Messaging interfaces and provides administrative and control features.
An implementation of the Jakarta EE platform that supports the full profile includes a Messaging provider.</p>
</li>
<li>
<p>Jakarta Messaging clients are the programs or components, written in the Java programming language, that produce and consume messages.
Any Jakarta EE application component can act as a Messaging client.</p>
<div class="paragraph">
<p>Java SE applications can also act as Jakarta Messaging clients; the Message Queue Developer&#8217;s Guide for Java Clients in the GlassFish Server documentation (<a href="https://glassfish.org/documentation" class="bare" target="_blank" rel="noopener">https://glassfish.org/documentation</a>) explains how to make this work.</p>
</div>
</li>
<li>
<p>Messages are the objects that communicate information between Jakarta Messaging clients.</p>
</li>
<li>
<p>Administered objects are Jakarta Messaging objects configured for the use of clients.
The two kinds of Jakarta Messaging administered objects are destinations and connection factories, described in <a href="#jakarta-messaging-administered-objects">Jakarta Messaging Administered Objects</a>.
An administrator can create objects that are available to all applications that use a particular installation of GlassFish Server; alternatively, a developer can use annotations to create objects that are specific to a particular application.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a href="#jakarta-messaging-architecture-2">Figure 48-2</a> illustrates the way these parts interact.
Administrative tools or annotations allow you to bind destinations and connection factories into a JNDI namespace.
A Messaging client can then use resource injection to access the administered objects in the namespace and then establish a logical connection to the same objects through the Jakarta Messaging provider.</p>
</div>
<div id="jakarta-messaging-architecture-2" class="imageblock">
<div class="content">
<img src="images/jakartaeett_dt_027.svg" alt="Diagram of Jakarta Messaging architecture, showing administrative tool, Jakarta Messaging client, JNDI namespace, and JMS provider">
</div>
<div class="title">Figure 48-2 Jakarta Messaging Architecture</div>
</div>
</div>
<div class="sect3">
<h4 id="messaging-styles"><a class="anchor" href="#messaging-styles"></a>Messaging Styles</h4>
<div class="paragraph">
<p>Before the Jakarta Messaging existed, most messaging products supported either the point-to-point or the publish/subscribe style of messaging.
The Jakarta Messaging specification defines compliance for each style.
A Messaging provider must implement both styles, and the Jakarta Messaging provides interfaces that are specific to each.
The following subsections describe these messaging styles.</p>
</div>
<div class="paragraph">
<p>Jakarta Messaging, however, makes it unnecessary to use only one of the two styles.
It allows you to use the same code to send and receive messages using either the PTP or the pub/sub style.
The destinations you use remain specific to one style, and the behavior of the application will depend in part on whether you are using a queue or a topic.
However, the code itself can be common to both styles, making your applications flexible and reusable.
This tutorial describes and illustrates this coding approach, using the greatly simplified API provided by Jakarta Messaging 2.0.</p>
</div>
<div class="sect4">
<h5 id="point-to-point-messaging-style"><a class="anchor" href="#point-to-point-messaging-style"></a>Point-to-Point Messaging Style</h5>
<div class="paragraph">
<p>A point-to-point (PTP) product or application is built on the concept of message queues, senders, and receivers.
Each message is addressed to a specific queue, and receiving clients extract messages from the queues established to hold their messages.
Queues retain all messages sent to them until the messages are consumed or expire.</p>
</div>
<div class="paragraph">
<p>PTP messaging, illustrated in <a href="#point-to-point-messaging">Figure 48-3</a>, has the following characteristics.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Each message has only one consumer.</p>
</li>
<li>
<p>The receiver can fetch the message whether or not it was running when the client sent the message.</p>
</li>
</ul>
</div>
<div id="point-to-point-messaging" class="imageblock">
<div class="content">
<img src="images/jakartaeett_dt_028.svg" alt="Diagram of point-to-point messaging, showing Client 1 sending a message to a queue, and Client 2 consuming and acknowledging the message">
</div>
<div class="title">Figure 48-3 Point-to-Point Messaging</div>
</div>
<div class="paragraph">
<p>Use PTP messaging when every message you send must be processed successfully by one consumer.</p>
</div>
</div>
<div class="sect4">
<h5 id="publishsubscribe-messaging-style"><a class="anchor" href="#publishsubscribe-messaging-style"></a>Publish/Subscribe Messaging Style</h5>
<div class="paragraph">
<p>In a publish/subscribe (pub/sub) product or application, clients address messages to a topic, which functions somewhat like a bulletin board.
Publishers and subscribers can dynamically publish or subscribe to the topic.
The system takes care of distributing the messages arriving from a topic&#8217;s multiple publishers to its multiple subscribers.
Topics retain messages only as long as it takes to distribute them to subscribers.</p>
</div>
<div class="paragraph">
<p>With pub/sub messaging, it is important to distinguish between the consumer that subscribes to a topic (the subscriber) and the subscription that is created.
The consumer is a Jakarta Messaging object within an application, while the subscription is an entity within the Jakarta Messaging provider.
Normally, a topic can have many consumers, but a subscription has only one subscriber.
It is possible, however, to create shared subscriptions; see <a href="#creating-shared-subscriptions">Creating Shared Subscriptions</a> for details.
See <a href="#consuming-messages-from-topics">Consuming Messages from Topics</a> for details on the semantics of pub/sub messaging.</p>
</div>
<div class="paragraph">
<p>Pub/sub messaging has the following characteristics.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Each message can have multiple consumers.</p>
</li>
<li>
<p>A client that subscribes to a topic can consume only messages sent after the client has created a subscription, and the consumer must continue to be active in order for it to consume messages.</p>
<div class="paragraph">
<p>The Jakarta Messaging relaxes this requirement to some extent by allowing applications to create durable subscriptions, which receive messages sent while the consumers are not active.
Durable subscriptions provide the flexibility and reliability of queues but still allow clients to send messages to many recipients.
For more information about durable subscriptions, see <a href="#creating-durable-subscriptions">Creating Durable Subscriptions</a>.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Use pub/sub messaging when each message can be processed by any number of consumers (or none). <a href="#publish-subscribe-messaging">Figure 48-4</a> illustrates pub/sub messaging.</p>
</div>
<div id="publish-subscribe-messaging" class="imageblock">
<div class="content">
<img src="images/jakartaeett_dt_029.svg" alt="Diagram of pub/sub messaging, showing Client 1 sending a message to a topic, and the message being delivered to two consumers to the topic">
</div>
<div class="title">Figure 48-4 Publish/Subscribe Messaging</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="message-consumption"><a class="anchor" href="#message-consumption"></a>Message Consumption</h4>
<div class="paragraph">
<p>Messaging products are inherently asynchronous: There is no fundamental timing dependency between the production and the consumption of a message.
However, the Jakarta Messaging specification uses this term in a more precise sense.
Messages can be consumed in either of two ways.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Synchronously: A consumer explicitly fetches the message from the destination by calling the <code>receive</code> method.
The <code>receive</code> method can block until a message arrives or can time out if a message does not arrive within a specified time limit.</p>
</li>
<li>
<p>Asynchronously: An application client or a Java SE client can register a message listener with a consumer.
A message listener is similar to an event listener.
Whenever a message arrives at the destination, the JMS provider delivers the message by calling the listener&#8217;s <code>onMessage</code> method, which acts on the contents of the message.
In a Jakarta EE application, a message-driven bean serves as a message listener (it too has an <code>onMessage</code> method), but a client does not need to register it with a consumer.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="jakarta-messaging-programming-model"><a class="anchor" href="#jakarta-messaging-programming-model"></a>Jakarta Messaging Programming Model</h3>
<div class="paragraph">
<p>The basic building blocks of a Jakarta Messaging application are</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Administered objects: connection factories and destinations</p>
</li>
<li>
<p>Connections</p>
</li>
<li>
<p>Sessions</p>
</li>
<li>
<p><code>JMSContext</code> objects, which combine a connection and a session in one object</p>
</li>
<li>
<p>Message producers</p>
</li>
<li>
<p>Message consumers</p>
</li>
<li>
<p>Messages</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a href="#jakarta-messaging-programming-model-2">Figure 48-5</a> shows how all these objects fit together in a Messaging client application.</p>
</div>
<div id="jakarta-messaging-programming-model-2" class="imageblock">
<div class="content">
<img src="images/jakartaeett_dt_030.svg" alt="Diagram of Jakarta Messaging programming model: connection factory, JMSContext, connection, session, message producer, message consumer, messages, and destinations">
</div>
<div class="title">Figure 48-5 Jakarta Messaging Programming Model</div>
</div>
<div class="paragraph">
<p>Jakarta Messaging also provides queue browsers, objects that allow an application to browse messages on a queue.</p>
</div>
<div class="paragraph">
<p>This section describes all these objects briefly and provides sample commands and code snippets that show how to create and use the objects.
The last subsection briefly describes Jakarta Messaging API exception handling.</p>
</div>
<div class="paragraph">
<p>Examples that show how to combine all these objects in applications appear in <a href="#jakarta-messaging-examples">Chapter 49, <em>Jakarta Messaging Examples</em></a> beginning with <a href="#writing-simple-jakarta-messaging-applications">Writing Simple Jakarta Messaging Applications</a>.
For more detail, see Jakarta Messaging documentation, part of the Jakarta EE API documentation.</p>
</div>
<div class="sect3">
<h4 id="jakarta-messaging-administered-objects"><a class="anchor" href="#jakarta-messaging-administered-objects"></a>Jakarta Messaging Administered Objects</h4>
<div class="paragraph">
<p>Two parts of a Jakarta Messaging application, destinations and connection factories, are commonly maintained administratively rather than programmatically.
The technology underlying these objects is likely to be very different from one implementation of Jakarta Messaging to another.
Therefore, the management of these objects belongs with other administrative tasks that vary from provider to provider.</p>
</div>
<div class="paragraph">
<p>Messaging clients access administered objects through interfaces that are portable, so a client application can run with little or no change on more than one implementation of Jakarta Messaging.
Ordinarily, an administrator configures administered objects in a JNDI namespace, and Messaging clients then access them by using resource injection.</p>
</div>
<div class="paragraph">
<p>With GlassFish Server, you can use the <code>asadmin create-jms-resource</code> command or the Administration Console to create Jakarta Messaging administered objects in the form of connector resources.
You can also specify the resources in a file named <code>glassfish-resources.xml</code> that you can bundle with an application.</p>
</div>
<div class="paragraph">
<p>NetBeans IDE provides a wizard that allows you to create Jakarta Messaging resources for GlassFish Server.
See <a href="#creating-jakarta-messaging-administered-objects">Creating Jakarta Messaging Administered Objects</a> for details.</p>
</div>
<div class="paragraph">
<p>The Jakarta EE platform specification allows a developer to create administered objects using annotations or deployment descriptor elements.
Objects created in this way are specific to the application for which they are created.
See <a href="#creating-resources-for-jakarta-ee-applications">Creating Resources for Jakarta EE Applications</a> for details.
Definitions in a deployment descriptor override those specified by annotations.</p>
</div>
<div class="sect4">
<h5 id="jakarta-messaging-connection-factories"><a class="anchor" href="#jakarta-messaging-connection-factories"></a>Jakarta Messaging Connection Factories</h5>
<div class="paragraph">
<p>A connection factory is the object a client uses to create a connection to a provider.
A connection factory encapsulates a set of connection configuration parameters that has been defined by an administrator.
Each connection factory is an instance of the <code>ConnectionFactory</code>, <code>QueueConnectionFactory</code>, or <code>TopicConnectionFactory</code> interface.
To learn how to create connection factories, see <a href="#creating-jakarta-messaging-administered-objects">Creating Jakarta Messaging Administered Objects</a>.</p>
</div>
<div class="paragraph">
<p>At the beginning of a Messaging client program, you usually inject a connection factory resource into a <code>ConnectionFactory</code> object.
A Jakarta EE server must provide a Jakarta Messaging connection factory with the logical JNDI name <code>java:comp/DefaultJMSConnectionFactory</code>.
The actual JNDI name will be implementation-specific.</p>
</div>
<div class="paragraph">
<p>For example, the following code fragment looks up the default Jakarta Messaging connection factory and assigns it to a <code>ConnectionFactory</code> object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Resource</span>(lookup = <span class="string"><span class="delimiter">&quot;</span><span class="content">java:comp/DefaultJMSConnectionFactory</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> <span class="directive">static</span> ConnectionFactory connectionFactory;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="jakarta-messaging-destinations"><a class="anchor" href="#jakarta-messaging-destinations"></a>Jakarta Messaging Destinations</h5>
<div class="paragraph">
<p>A destination is the object a client uses to specify the target of messages it produces and the source of messages it consumes.
In the PTP messaging style, destinations are called queues.
In the pub/sub messaging style, destinations are called topics.
A Jakarta Messaging application can use multiple queues or topics (or both).
To learn how to create destination resources, see <a href="#creating-jakarta-messaging-administered-objects">Creating Jakarta Messaging Administered Objects</a>.</p>
</div>
<div class="paragraph">
<p>To create a destination using GlassFish Server, you create a Jakarta Messaging destination resource that specifies a JNDI name for the destination.</p>
</div>
<div class="paragraph">
<p>In the GlassFish Server implementation of Jakarta Messaging, each destination resource refers to a physical destination.
You can create a physical destination explicitly, but if you do not, the Application Server creates it when it is needed and deletes it when you delete the destination resource.</p>
</div>
<div class="paragraph">
<p>In addition to injecting a connection factory resource into a client program, you usually inject a destination resource.
Unlike connection factories, destinations are specific to either the PTP or pub/sub messaging style.
To create an application that allows you to use the same code for both topics and queues, you assign the destination to a <code>Destination</code> object.</p>
</div>
<div class="paragraph">
<p>The following code specifies two resources, a queue and a topic.
The resource names are mapped to destination resources created in the JNDI namespace:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Resource</span>(lookup = <span class="string"><span class="delimiter">&quot;</span><span class="content">jms/MyQueue</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> <span class="directive">static</span> <span class="predefined-type">Queue</span> queue;

<span class="annotation">@Resource</span>(lookup = <span class="string"><span class="delimiter">&quot;</span><span class="content">jms/MyTopic</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> <span class="directive">static</span> Topic topic;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In a Jakarta EE application, Jakarta Messaging administered objects are normally placed in the <code>jms</code> naming subcontext.</p>
</div>
<div class="paragraph">
<p>With the common interfaces, you can mix or match connection factories and destinations.
That is, in addition to using the <code>ConnectionFactory</code> interface, you can inject a <code>QueueConnectionFactory</code> resource and use it with a <code>Topic</code>, and you can inject a <code>TopicConnectionFactory</code> resource and use it with a <code>Queue</code>.
The behavior of the application will depend on the kind of destination you use and not on the kind of connection factory you use.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="connections"><a class="anchor" href="#connections"></a>Connections</h4>
<div class="paragraph">
<p>A connection encapsulates a virtual connection with a Messaging provider.
For example, a connection could represent an open TCP/IP socket between a client and a provider service daemon.
You use a connection to create one or more sessions.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In the Jakarta EE platform, the ability to create multiple sessions from a single connection is limited to application clients.
In web and enterprise bean components, a connection can create no more than one session.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You normally create a connection by creating a <code>JMSContext</code> object.
See <a href="#jmscontext-objects">JMSContext Objects</a> for details.</p>
</div>
</div>
<div class="sect3">
<h4 id="sessions"><a class="anchor" href="#sessions"></a>Sessions</h4>
<div class="paragraph">
<p>A session is a single-threaded context for producing and consuming messages.</p>
</div>
<div class="paragraph">
<p>You normally create a session (as well as a connection) by creating a <code>JMSContext</code> object.
See <a href="#jmscontext-objects">JMSContext Objects</a> for details.
You use sessions to create message producers, message consumers, messages, queue browsers, and temporary destinations.</p>
</div>
<div class="paragraph">
<p>Sessions serialize the execution of message listeners; for details, see <a href="#jakarta-messaging-message-listeners">Jakarta Messaging Message Listeners</a>.</p>
</div>
<div class="paragraph">
<p>A session provides a transactional context with which to group a set of sends and receives into an atomic unit of work.
For details, see <a href="#using-jakarta-messaging-local-transactions">Using Jakarta Messaging Local Transactions</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="jmscontext-objects"><a class="anchor" href="#jmscontext-objects"></a>JMSContext Objects</h4>
<div class="paragraph">
<p>A <code>JMSContext</code> object combines a connection and a session in a single object.
That is, it provides both an active connection to a Messaging provider and a single-threaded context for sending and receiving messages.</p>
</div>
<div class="paragraph">
<p>You use the <code>JMSContext</code> to create the following objects:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Message producers</p>
</li>
<li>
<p>Message consumers</p>
</li>
<li>
<p>Messages</p>
</li>
<li>
<p>Queue browsers</p>
</li>
<li>
<p>Temporary queues and topics (see <a href="#creating-temporary-destinations">Creating Temporary Destinations</a>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can create a <code>JMSContext</code> in a <code>try</code>-with-resources block.</p>
</div>
<div class="paragraph">
<p>To create a <code>JMSContext</code>, call the <code>createContext</code> method on the connection factory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">JMSContext context = connectionFactory.createContext();</code></pre>
</div>
</div>
<div class="paragraph">
<p>When called with no arguments from an application client or a Java SE client, or from the Jakarta EE web or Enterprise Beans container when there is no active Jakarta Transactions transaction in progress, the <code>createContext</code> method creates a non-transacted session with an acknowledgment mode of <code>JMSContext.AUTO_ACKNOWLEDGE</code>.
When called with no arguments from the web or Enterprise Beans container when there is an active JTA transaction in progress, the <code>createContext</code> method creates a transacted session.
For information about the way Jakarta Messaging transactions work in Jakarta EE applications, see <a href="#using-jakarta-messaging-in-jakarta-ee-applications">Using Jakarta Messaging in Jakarta EE Applications</a>.</p>
</div>
<div class="paragraph">
<p>From an application client or a Java SE client, you can also call the <code>createContext</code> method with the argument <code>JMSContext.SESSION_TRANSACTED</code> to create a transacted session:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">JMSContext context =
        connectionFactory.createContext(JMSContext.SESSION_TRANSACTED);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The session uses local transactions; see <a href="#using-jakarta-messaging-local-transactions">Using Jakarta Messaging Local Transactions</a> for details.</p>
</div>
<div class="paragraph">
<p>Alternatively, you can specify a non-default acknowledgment mode; see <a href="#controlling-message-acknowledgment">Controlling Message Acknowledgment</a> for more information.</p>
</div>
<div class="paragraph">
<p>When you use a <code>JMSContext</code>, message delivery normally begins as soon as you create a consumer.
See <a href="#jakarta-messaging-message-consumers">Jakarta Messaging Message Consumers</a> for more information.</p>
</div>
<div class="paragraph">
<p>If you create a <code>JMSContext</code> in a <code>try</code>-with-resources block, you do not need to close it explicitly.
It will be closed when the <code>try</code> block comes to an end.
Make sure that your application completes all its Jakarta Messaging activity within the <code>try</code>-with-resources block.
If you do not use a <code>try</code>-with-resources block, you must call the <code>close</code> method on the <code>JMSContext</code> to close the connection when the application has finished its work.</p>
</div>
</div>
<div class="sect3">
<h4 id="jakarta-messaging-message-producers"><a class="anchor" href="#jakarta-messaging-message-producers"></a>Jakarta Messaging Message Producers</h4>
<div class="paragraph">
<p>A message producer is an object that is created by a <code>JMSContext</code> or a session and used for sending messages to a destination.
A message producer created by a <code>JMSContext</code> implements the <code>JMSProducer</code> interface.
You could create it this way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">try</span> (JMSContext context = connectionFactory.createContext();) {
    JMSProducer producer = context.createProducer();
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>However, a <code>JMSProducer</code> is a lightweight object that does not consume significant resources.
For this reason, you do not need to save the <code>JMSProducer</code> in a variable; you can create a new one each time you send a message.
You send messages to a specific destination by using the <code>send</code> method.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">context.createProducer().send(dest, message);</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can create the message in a variable before sending it, as shown here, or you can create it within the <code>send</code> call.
See <a href="#jakarta-messaging-messages">Jakarta Messaging Messages</a> for more information.</p>
</div>
</div>
<div class="sect3">
<h4 id="jakarta-messaging-message-consumers"><a class="anchor" href="#jakarta-messaging-message-consumers"></a>Jakarta Messaging Message Consumers</h4>
<div class="paragraph">
<p>A message consumer is an object that is created by a <code>JMSContext</code> or a session and used for receiving messages sent to a destination.
A message producer created by a <code>JMSContext</code> implements the <code>JMSConsumer</code> interface.
The simplest way to create a message consumer is to use the <code>JMSContext.createConsumer</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">try</span> (JMSContext context = connectionFactory.createContext();) {
    JMSConsumer consumer = context.createConsumer(dest);
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A message consumer allows a Messaging client to register interest in a destination with a Messaging provider.
The Jakarta Messaging provider manages the delivery of messages from a destination to the registered consumers of the destination.</p>
</div>
<div class="paragraph">
<p>When you use a <code>JMSContext</code> to create a message consumer, message delivery begins as soon as you have created the consumer.
You can disable this behavior by calling <code>setAutoStart(false)</code> when you create the <code>JMSContext</code> and then calling the <code>start</code> method explicitly to start message delivery.
If you want to stop message delivery temporarily without closing the connection, you can call the <code>stop</code> method; to restart message delivery, call <code>start</code>.</p>
</div>
<div class="paragraph">
<p>You use the <code>receive</code> method to consume a message synchronously.
You can use this method at any time after you create the consumer.</p>
</div>
<div class="paragraph">
<p>If you specify no arguments or an argument of <code>0</code>, the method blocks indefinitely until a message arrives:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Message m = consumer.receive();
Message m = consumer.receive(<span class="integer">0</span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>For a simple client, this may not matter.
But if it is possible that a message might not be available, use a synchronous receive with a timeout: Call the <code>receive</code> method with a timeout argument greater than <code>0</code>.
One second is a recommended timeout value:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Message m = consumer.receive(<span class="integer">1000</span>); <span class="comment">// time out after a second</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To enable asynchronous message delivery from an application client or a Java SE client, you use a message listener, as described in the next section.</p>
</div>
<div class="paragraph">
<p>You can use the <code>JMSContext.createDurableConsumer</code> method to create a durable topic subscription.
This method is valid only if you are using a topic.
For details, see <a href="#creating-durable-subscriptions">Creating Durable Subscriptions</a>.
For topics, you can also create shared consumers; see <a href="#creating-shared-subscriptions">Creating Shared Subscriptions</a>.</p>
</div>
<div class="sect4">
<h5 id="jakarta-messaging-message-listeners"><a class="anchor" href="#jakarta-messaging-message-listeners"></a>Jakarta Messaging Message Listeners</h5>
<div class="paragraph">
<p>A message listener is an object that acts as an asynchronous event handler for messages.
This object implements the <code>MessageListener</code> interface, which contains one method, <code>onMessage</code>.
In the <code>onMessage</code> method, you define the actions to be taken when a message arrives.</p>
</div>
<div class="paragraph">
<p>From an application client or a Java SE client, you register the message listener with a specific message consumer by using the <code>setMessageListener</code> method.
For example, if you define a class named <code>Listener</code> that implements the <code>MessageListener</code> interface, you can register the message listener as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Listener myListener = <span class="keyword">new</span> Listener();
consumer.setMessageListener(myListener);</code></pre>
</div>
</div>
<div class="paragraph">
<p>When message delivery begins, the Messaging provider automatically calls the message listener&#8217;s <code>onMessage</code> method whenever a message is delivered.
The <code>onMessage</code> method takes one argument of type <code>Message</code>, which your implementation of the method can cast to another message subtype as needed (see <a href="#message-bodies">Message Bodies</a>).</p>
</div>
<div class="paragraph">
<p>In the Jakarta EE web or Enterprise Beans container, you use message-driven beans for asynchronous message delivery.
A message-driven bean also implements the <code>MessageListener</code> interface and contains an <code>onMessage</code> method.
For details, see <a href="#using-message-driven-beans-to-receive-messages-asynchronously">Using Message-Driven Beans to Receive Messages Asynchronously</a>.</p>
</div>
<div class="paragraph">
<p>Your <code>onMessage</code> method should handle all exceptions.
Throwing a <code>RuntimeException</code> is considered a programming error.</p>
</div>
<div class="paragraph">
<p>For a simple example of the use of a message listener, see <a href="#using-a-message-listener-for-asynchronous-message-delivery">Using a Message Listener for Asynchronous Message Delivery</a>.
<a href="#jakarta-messaging-examples">Chapter 49, <em>Jakarta Messaging Examples</em></a> contains several more examples of message listeners and message-driven beans.</p>
</div>
</div>
<div class="sect4">
<h5 id="jakarta-messaging-message-selectors"><a class="anchor" href="#jakarta-messaging-message-selectors"></a>Jakarta Messaging Message Selectors</h5>
<div class="paragraph">
<p>If your messaging application needs to filter the messages it receives, you can use a Jakarta Messaging message selector, which allows a message consumer for a destination to specify the messages that interest it.
Message selectors assign the work of filtering messages to the Messaging provider rather than to the application.
For an example of an application that uses a message selector, see <a href="#sending-messages-from-a-session-bean-to-an-mdb">Sending Messages from a Session Bean to an MDB</a>.</p>
</div>
<div class="paragraph">
<p>A message selector is a <code>String</code> that contains an expression.
The syntax of the expression is based on a subset of the SQL92 conditional expression syntax.
The message selector in the example selects any message that has a <code>NewsType</code> property that is set to the value <code>'Sports'</code> or <code>'Opinion'</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">NewsType = <span class="string"><span class="delimiter">'</span><span class="content">Sports</span><span class="delimiter">'</span></span> OR NewsType = <span class="string"><span class="delimiter">'</span><span class="content">Opinion</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>createConsumer</code> and <code>createDurableConsumer</code> methods, as well as the methods for creating shared consumers, allow you to specify a message selector as an argument when you create a message consumer.</p>
</div>
<div class="paragraph">
<p>The message consumer then receives only messages whose headers and properties match the selector.
(See <a href="#message-headers">Message Headers</a> and <a href="#message-properties">Message Properties</a>.)
A message selector cannot select messages on the basis of the content of the message body.</p>
</div>
</div>
<div class="sect4">
<h5 id="consuming-messages-from-topics"><a class="anchor" href="#consuming-messages-from-topics"></a>Consuming Messages from Topics</h5>
<div class="paragraph">
<p>The semantics of consuming messages from topics are more complex than the semantics of consuming messages from queues.</p>
</div>
<div class="paragraph">
<p>An application consumes messages from a topic by creating a subscription on that topic and creating a consumer on that subscription.
Subscriptions may be durable or nondurable, and they may be shared or unshared.</p>
</div>
<div class="paragraph">
<p>A subscription may be thought of as an entity within the Messaging provider itself, whereas a consumer is a Jakarta Messaging object within the application.</p>
</div>
<div class="paragraph">
<p>A subscription will receive a copy of every message that is sent to the topic after the subscription is created, unless a message selector is specified.
If a message selector is specified, only those messages whose properties match the message selector will be added to the subscription.</p>
</div>
<div class="paragraph">
<p>Unshared subscriptions are restricted to a single consumer.
In this case, all the messages in the subscription are delivered to that consumer.
Shared subscriptions allow multiple consumers.
In this case, each message in the subscription is delivered to only one consumer.
Jakarta Messaging does not define how messages are distributed between multiple consumers on the same subscription.</p>
</div>
<div class="paragraph">
<p>Subscriptions may be durable or nondurable.</p>
</div>
<div class="paragraph">
<p>A nondurable subscription exists only as long as there is an active consumer on the subscription.
This means that any messages sent to the topic will be added to the subscription only while a consumer exists and is not closed.</p>
</div>
<div class="paragraph">
<p>A nondurable subscription may be either unshared or shared.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An unshared nondurable subscription does not have a name and may have only a single consumer object associated with it.
It is created automatically when the consumer object is created.
It is not persisted and is deleted automatically when the consumer object is closed.</p>
<div class="paragraph">
<p>The <code>JMSContext.createConsumer</code> method creates a consumer on an unshared nondurable subscription if a topic is specified as the destination.</p>
</div>
</li>
<li>
<p>A shared nondurable subscription is identified by name and an optional client identifier, and may have several consumer objects consuming messages from it.
It is created automatically when the first consumer object is created.
It is not persisted and is deleted automatically when the last consumer object is closed.
See <a href="#creating-shared-subscriptions">Creating Shared Subscriptions</a> for more information.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>At the cost of higher overhead, a subscription may be durable.
A durable subscription is persisted and continues to accumulate messages until explicitly deleted, even if there are no consumer objects consuming messages from it.
See <a href="#creating-durable-subscriptions">Creating Durable Subscriptions</a> for details.</p>
</div>
</div>
<div class="sect4">
<h5 id="creating-durable-subscriptions"><a class="anchor" href="#creating-durable-subscriptions"></a>Creating Durable Subscriptions</h5>
<div class="paragraph">
<p>To ensure that a pub/sub application receives all sent messages, use durable subscriptions for the consumers on the topic.</p>
</div>
<div class="paragraph">
<p>Like a nondurable subscription, a durable subscription may be either unshared or shared.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An unshared durable subscription is identified by name and client identifier (which must be set) and may have only a single consumer object associated with it.</p>
</li>
<li>
<p>A shared durable subscription is identified by name and an optional client identifier, and may have several consumer objects consuming messages from it.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A durable subscription that exists but that does not currently have a non-closed consumer object associated with it is described as being inactive.</p>
</div>
<div class="paragraph">
<p>You can use the <code>JMSContext.createDurableConsumer</code> method to create a consumer on an unshared durable subscription.
An unshared durable subscription can have only one active consumer at a time.</p>
</div>
<div class="paragraph">
<p>A consumer identifies the durable subscription from which it consumes messages by specifying a unique identity that is retained by the Messaging provider.
Subsequent consumer objects that have the same identity resume the subscription in the state in which it was left by the preceding consumer.
If a durable subscription has no active consumer, the Messaging provider retains the subscription&#8217;s messages until they are received by the subscription or until they expire.</p>
</div>
<div class="paragraph">
<p>You establish the unique identity of an unshared durable subscription by setting the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A client ID for the connection</p>
</li>
<li>
<p>A topic and a subscription name for the subscription</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can set the client ID administratively for a client-specific connection factory using either the command line or the Administration Console.
(In an application client or a Java SE client, you can instead call <code>JMSContext.setClientID</code>.)</p>
</div>
<div class="paragraph">
<p>After using this connection factory to create the <code>JMSContext</code>, you call the <code>createDurableConsumer</code> method with two arguments: the topic and a string that specifies the name of the subscription:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">String</span> subName = <span class="string"><span class="delimiter">&quot;</span><span class="content">MySub</span><span class="delimiter">&quot;</span></span>;
JMSConsumer consumer = context.createDurableConsumer(myTopic, subName);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The subscription becomes active after you create the consumer.
Later, you might close the consumer:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">consumer.close();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Messaging provider stores the messages sent to the topic, as it would store messages sent to a queue.
If the program or another application calls <code>createDurableConsumer</code> using the same connection factory and its client ID, the same topic, and the same subscription name, then the subscription is reactivated and the Messaging provider delivers the messages that were sent while the subscription was inactive.</p>
</div>
<div class="paragraph">
<p>To delete a durable subscription, first close the consumer, then call the <code>unsubscribe</code> method with the subscription name as the argument:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">consumer.close();
context.unsubscribe(subName);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>unsubscribe</code> method deletes the state the provider maintains for the subscription.</p>
</div>
<div class="paragraph">
<p><a href="#consumers-on-a-durable-subscription">Figure 48-7</a> show the difference between a nondurable and a durable subscription.
With an ordinary, nondurable subscription, the consumer and the subscription begin and end at the same point and are, in effect, identical.
When the consumer is closed, the subscription also ends.
Here, <code>create</code> stands for a call to <code>JMSContext.createConsumer</code> with a <code>Topic</code> argument, and <code>close</code> stands for a call to <code>JMSConsumer.close</code>.
Any messages sent to the topic between the time of the first <code>close</code> and the time of the second <code>create</code> are not added to either subscription.
In <a href="#nondurable-subscriptions-and-consumers">Figure 48-6</a>, the consumers receive messages M1, M2, M5, and M6, but they do not receive messages M3 and M4.</p>
</div>
<div id="nondurable-subscriptions-and-consumers" class="imageblock">
<div class="content">
<img src="images/jakartaeett_dt_031.svg" alt="Diagram showing messages being lost when nondurable subscriptions are used">
</div>
<div class="title">Figure 48-6 Nondurable Subscriptions and Consumers</div>
</div>
<div class="paragraph">
<p>With a durable subscription, the consumer can be closed and re-created, but the subscription continues to exist and to hold messages until the application calls the <code>unsubscribe</code> method.
In <a href="#consumers-on-a-durable-subscription">Figure 48-7</a>, <code>create</code> stands for a call to <code>JMSContext.createDurableConsumer</code>, <code>close</code> stands for a call to <code>JMSConsumer.close</code>, and <code>unsubscribe</code> stands for a call to <code>JMSContext.unsubscribe</code>.
Messages sent after the first consumer is closed are received when the second consumer is created (on the same durable subscription), so even though messages M2, M4, and M5 arrive while there is no consumer, they are not lost.</p>
</div>
<div id="consumers-on-a-durable-subscription" class="imageblock">
<div class="content">
<img src="images/jakartaeett_dt_032.svg" alt="Diagram showing messages being preserved when durable subscriptions are used">
</div>
<div class="title">Figure 48-7 Consumers on a Durable Subscription</div>
</div>
<div class="paragraph">
<p>A shared durable subscription allows you to use multiple consumers to receive messages from a durable subscription.
If you use a shared durable subscription, the connection factory you use does not need to have a client identifier.
To create a shared durable subscription, call the <code>JMSContext.createSharedDurableConsumer</code> method, specifying the topic and subscription name:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">JMSConsumer consumer =
        context.createSharedDurableConsumer(topic, <span class="string"><span class="delimiter">&quot;</span><span class="content">MakeItLast</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>See <a href="#acknowledging-messages">Acknowledging Messages</a>, <a href="#using-durable-subscriptions">Using Durable Subscriptions</a>, <a href="#using-shared-durable-subscriptions">Using Shared Durable Subscriptions</a>, and <a href="#sending-messages-from-a-session-bean-to-an-mdb">Sending Messages from a Session Bean to an MDB</a> for examples of Jakarta EE applications that use durable subscriptions.</p>
</div>
</div>
<div class="sect4">
<h5 id="creating-shared-subscriptions"><a class="anchor" href="#creating-shared-subscriptions"></a>Creating Shared Subscriptions</h5>
<div class="paragraph">
<p>A topic subscription created by the <code>createConsumer</code> or <code>createDurableConsumer</code> method can have only one consumer (although a topic can have many).
Multiple clients consuming from the same topic have, by definition, multiple subscriptions to the topic, and all the clients receive all the messages sent to the topic (unless they filter them with message selectors).</p>
</div>
<div class="paragraph">
<p>It is, however, possible to create a nondurable shared subscription to a topic by using the <code>createSharedConsumer</code> method and specifying not only a destination but a subscription name:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">consumer = context.createSharedConsumer(topicName, <span class="string"><span class="delimiter">&quot;</span><span class="content">SubName</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>With a shared subscription, messages will be distributed among multiple clients that use the same topic and subscription name.
Each message sent to the topic will be added to every subscription (subject to any message selectors), but each message added to a subscription will be delivered to only one of the consumers on that subscription, so it will be received by only one of the clients.
A shared subscription can be useful if you want to share the message load among several consumers on the subscription rather than having just one consumer on the subscription receive each message.
This feature can improve the scalability of Jakarta EE application client applications and Java SE applications.
(Message-driven beans share the work of processing messages from a topic among multiple threads.)</p>
</div>
<div class="paragraph">
<p>See <a href="#using-shared-nondurable-subscriptions">Using Shared Nondurable Subscriptions</a> for a simple example of using shared nondurable consumers.</p>
</div>
<div class="paragraph">
<p>You can also create shared durable subscriptions by using the <code>JMSContext.createSharedDurableConsumer</code> method.
For details, see <a href="#creating-durable-subscriptions">Creating Durable Subscriptions</a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="jakarta-messaging-messages"><a class="anchor" href="#jakarta-messaging-messages"></a>Jakarta Messaging Messages</h4>
<div class="paragraph">
<p>The ultimate purpose of a Jakarta Messaging application is to produce and consume messages that can then be used by other software applications.
Jakarta Messaging messages have a basic format that is simple but highly flexible, allowing you to create messages that match formats used by non-Jakarta Messaging applications on heterogeneous platforms.</p>
</div>
<div class="paragraph">
<p>A Jakarta Messaging message can have three parts: a header, properties, and a body.
Only the header is required.
The following sections describe these parts.</p>
</div>
<div class="paragraph">
<p>For complete documentation of message headers, properties, and bodies, see the documentation of the <code>Message</code> interface in the API documentation.
For a list of possible message types, see <a href="#message-bodies">Message Bodies</a>.</p>
</div>
<div class="sect4">
<h5 id="message-headers"><a class="anchor" href="#message-headers"></a>Message Headers</h5>
<div class="paragraph">
<p>A Jakarta Messaging message header contains a number of predefined fields that contain values used by both clients and providers to identify and route messages.
<a href="#how-jakarta-messaging-message-header-field-values-are-set">Table 48-1</a> lists and describes the Jakarta Messaging message header fields and indicates how their values are set.
For example, every message has a unique identifier, which is represented in the header field <code>JMSMessageID</code>.
The value of another header field, <code>JMSDestination</code>, represents the queue or the topic to which the message is sent.
Other fields include a timestamp and a priority level.</p>
</div>
<div class="paragraph">
<p>Each header field has associated setter and getter methods, which are documented in the description of the <code>Message</code> interface.
Some header fields are intended to be set by a client, but many are set automatically by the <code>send</code> method, which overrides any client-set values.</p>
</div>
<table id="how-jakarta-messaging-message-header-field-values-are-set" class="tableblock frame-all grid-all" style="width: 99%;">
<caption class="title">Table 48-1 How Jakarta Messaging Message Header Field Values Are Set</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 60%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Header Field</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Set By</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JMSDestination</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Destination to which the message is being sent</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JMS provider <code>send</code> method</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JMSDeliveryMode</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Delivery mode specified when the message was sent (see <a href="#specifying-message-persistence">Specifying Message Persistence</a>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Messaging provider <code>send</code> method</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JMSDeliveryTime</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The time the message was sent plus the delivery delay specified when the message was sent (see <a href="#specifying-a-delivery-delay">Specifying a Delivery Delay</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JMS provider <code>send</code> method</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JMSExpiration</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Expiration time of the message (see <a href="#allowing-messages-to-expire">Allowing Messages to Expire</a>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JMS provider <code>send</code> method</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JMSPriority</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The priority of the message (see <a href="#setting-message-priority-levels">Setting Message Priority Levels</a>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jakarta Messaging provider <code>send</code> method</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JMSMessageID</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Value that uniquely identifies each message sent by a provider</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Messaging provider <code>send</code> method</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JMSTimestamp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The time the message was handed off to a provider to be sent</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Messaging provider <code>send</code> method</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JMSCorrelationID</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Value that links one message to another; commonly the <code>JMSMessageID</code> value is used</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client application</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JMSReplyTo</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Destination where replies to the message should be sent</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client application</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JMSType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type identifier supplied by client application</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client application</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JMSRedelivered</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether the message is being redelivered</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jakarta Messaging provider prior to delivery</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="message-properties"><a class="anchor" href="#message-properties"></a>Message Properties</h5>
<div class="paragraph">
<p>You can create and set properties for messages if you need values in addition to those provided by the header fields.
You can use properties to provide compatibility with other messaging systems, or you can use them to create message selectors (see <a href="#jakarta-messaging-message-selectors">Jakarta Messaging Message Selectors</a>).
For an example of setting a property to be used as a message selector, see <a href="#sending-messages-from-a-session-bean-to-an-mdb">Sending Messages from a Session Bean to an MDB</a>.</p>
</div>
<div class="paragraph">
<p>Jakarta Messaging provides some predefined property names that begin with <code>JMSX</code>.
A Messaging provider is required to implement only one of these, <code>JMSXDeliveryCount</code> (which specifies the number of times a message has been delivered); the rest are optional.
The use of these predefined properties or of user-defined properties in applications is optional.</p>
</div>
</div>
<div class="sect4">
<h5 id="message-bodies"><a class="anchor" href="#message-bodies"></a>Message Bodies</h5>
<div class="paragraph">
<p>Jakarta Messaging defines six different types of messages.
Each message type corresponds to a different message body.
These message types allow you to send and receive data in many different forms.
<a href="#jakarta-messaging-message-types">Table 48-2</a> describes these message types.</p>
</div>
<table id="jakarta-messaging-message-types" class="tableblock frame-all grid-all" style="width: 75%;">
<caption class="title">Table 48-2 Jakarta Messaging Message Types</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Message Type</th>
<th class="tableblock halign-left valign-top">Body Contains</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TextMessage</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <code>java.lang.String</code> object (for example, the contents of an XML file).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MapMessage</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A set of name-value pairs, with names as <code>String</code> objects and values as primitive types in the Java programming language.
The entries can be accessed sequentially by enumerator or randomly by name.
The order of the entries is undefined.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BytesMessage</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A stream of uninterpreted bytes.
This message type is for literally encoding a body to match an existing message format.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>StreamMessage</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A stream of primitive values in the Java programming language, filled and read sequentially.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ObjectMessage</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <code>Serializable</code> object in the Java programming language.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Message</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nothing.
Composed of header fields and properties only.
This message type is useful when a message body is not required.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Jakarta Messaging provides methods for creating messages of each type and for filling in their contents.
For example, to create and send a <code>TextMessage</code>, you might use the following statements:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">TextMessage message = context.createTextMessage();
message.setText(msg_text);     <span class="comment">// msg_text is a String</span>
context.createProducer().send(message);</code></pre>
</div>
</div>
<div class="paragraph">
<p>At the consuming end, a message arrives as a generic <code>Message</code> object.
You can then cast the object to the appropriate message type and use more specific methods to access the body and extract the message contents (and its headers and properties if needed).
For example, you might use the stream-oriented read methods of <code>BytesMessage</code>.
You must always cast to the appropriate message type to retrieve the body of a <code>StreamMessage</code>.</p>
</div>
<div class="paragraph">
<p>Instead of casting the message to a message type, you can call the <code>getBody</code> method on the <code>Message</code>, specifying the type of the message as an argument.
For example, you can retrieve a <code>TextMessage</code> as a <code>String</code>.
The following code fragment uses the <code>getBody</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Message m = consumer.receive();
<span class="keyword">if</span> (m <span class="keyword">instanceof</span> TextMessage) {
    <span class="predefined-type">String</span> message = m.getBody(<span class="predefined-type">String</span>.class);
    <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Reading message: </span><span class="delimiter">&quot;</span></span> + message);
} <span class="keyword">else</span> {
    <span class="comment">// Handle error or process another message type</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Jakarta Messaging provides shortcuts for creating and receiving a <code>TextMessage</code>, <code>BytesMessage</code>, <code>MapMessage</code>, or <code>ObjectMessage</code>.
For example, you do not have to wrap a string in a <code>TextMessage</code>; instead, you can send and receive the string directly.
For example, you can send a string as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">String</span> message = <span class="string"><span class="delimiter">&quot;</span><span class="content">This is a message</span><span class="delimiter">&quot;</span></span>;
context.createProducer().send(dest, message);</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can receive the message by using the <code>receiveBody</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">String</span> message = receiver.receiveBody(<span class="predefined-type">String</span>.class);</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use the <code>receiveBody</code> method to receive any type of message except <code>StreamMessage</code> and <code>Message</code>, as long as the body of the message can be assigned to a particular type.</p>
</div>
<div class="paragraph">
<p>An empty <code>Message</code> can be useful if you want to send a message that is simply a signal to the application.
Some of the examples in <a href="#jakarta-messaging-examples">Chapter 49, <em>Jakarta Messaging Examples</em></a>, send an empty message after sending a series of text messages.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">context.createProducer().send(dest, context.createMessage());</code></pre>
</div>
</div>
<div class="paragraph">
<p>The consumer code can then interpret a non-text message as a signal that all the messages sent have now been received.</p>
</div>
<div class="paragraph">
<p>The examples in <a href="#jakarta-messaging-examples">Chapter 49, <em>Jakarta Messaging Examples</em></a>, use messages of type <code>TextMessage</code>, <code>MapMessage</code>, and <code>Message</code>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="jakarta-messaging-queue-browsers"><a class="anchor" href="#jakarta-messaging-queue-browsers"></a>Jakarta Messaging Queue Browsers</h4>
<div class="paragraph">
<p>Messages sent to a queue remain in the queue until the message consumer for that queue consumes them.
Jakarta Messaging provides a <code>QueueBrowser</code> object that allows you to browse the messages in the queue and display the header values for each message.
To create a <code>QueueBrowser</code> object, use the <code>JMSContext.createBrowser</code> method.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">QueueBrowser browser = context.createBrowser(queue);</code></pre>
</div>
</div>
<div class="paragraph">
<p>See <a href="#browsing-messages-on-a-queue">Browsing Messages on a Queue</a> for an example of using a <code>QueueBrowser</code> object.</p>
</div>
<div class="paragraph">
<p>The <code>createBrowser</code> method allows you to specify a message selector as a second argument when you create a <code>QueueBrowser</code>.
For information on message selectors, see <a href="#jakarta-messaging-message-selectors">Jakarta Messaging Message Selectors</a>.</p>
</div>
<div class="paragraph">
<p>Jakarta Messaging provides no mechanism for browsing a topic.
Messages usually disappear from a topic as soon as they appear: If there are no message consumers to consume them, the Messaging provider removes them.
Although durable subscriptions allow messages to remain on a topic while the message consumer is not active, Jakarta Messaging does not define any facility for examining them.</p>
</div>
</div>
<div class="sect3">
<h4 id="jakarta-messaging-exception-handling"><a class="anchor" href="#jakarta-messaging-exception-handling"></a>Jakarta Messaging Exception Handling</h4>
<div class="paragraph">
<p>The root class for all checked exceptions in Jakarta Messaging is <code>JMSException</code>.
The root cause for all unchecked exceptions in the Jakarta Messaging API is <code>JMSRuntimeException</code>.</p>
</div>
<div class="paragraph">
<p>Catching <code>JMSException</code> and <code>JMSRuntimeException</code> provides a generic way of handling all exceptions related to Jakarta Messaging.</p>
</div>
<div class="paragraph">
<p>The <code>JMSException</code> and <code>JMSRuntimeException</code> classes include the following subclasses, described in the API documentation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>IllegalStateException</code>, <code>IllegalStateRuntimeException</code></p>
</li>
<li>
<p><code>InvalidClientIDException</code>, <code>InvalidClientIDRuntimeException</code></p>
</li>
<li>
<p><code>InvalidDestinationException</code>, <code>InvalidDestinationRuntimeException</code></p>
</li>
<li>
<p><code>InvalidSelectorException</code>, <code>InvalidSelectorRuntimeException</code></p>
</li>
<li>
<p><code>JMSSecurityException</code>, <code>JMSSecurityRuntimeException</code></p>
</li>
<li>
<p><code>MessageEOFException</code></p>
</li>
<li>
<p><code>MessageFormatException</code>, <code>MessageFormatRuntimeException</code></p>
</li>
<li>
<p><code>MessageNotReadableException</code></p>
</li>
<li>
<p><code>MessageNotWriteableException</code>, <code>MessageNotWriteableRuntimeException</code></p>
</li>
<li>
<p><code>ResourceAllocationException</code>, <code>ResourceAllocationRuntimeException</code></p>
</li>
<li>
<p><code>TransactionInProgressException</code>, <code>TransactionInProgressRuntimeException</code></p>
</li>
<li>
<p><code>TransactionRolledBackException</code>, <code>TransactionRolledBackRuntimeException</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All the examples in the tutorial catch and handle <code>JMSException</code> or <code>JMSRuntimeException</code> when it is appropriate to do so.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-advanced-jakarta-messaging-features"><a class="anchor" href="#using-advanced-jakarta-messaging-features"></a>Using Advanced Jakarta Messaging Features</h3>
<div class="paragraph">
<p>This section explains how to use features of Jakarta Messaging to achieve the level of reliability and performance your application requires.
Many people use Jakarta Messaging in their applications because they cannot tolerate dropped or duplicate messages and because they require that every message be received once and only once.
Jakarta Messaging provides this functionality.</p>
</div>
<div class="paragraph">
<p>The most reliable way to produce a message is to send a <code>PERSISTENT</code> message, and to do so within a transaction.</p>
</div>
<div class="paragraph">
<p>Jakarta Messaging messages are <code>PERSISTENT</code> by default; <code>PERSISTENT</code> messages will not be lost in the event of Messaging provider failure.
For details, see <a href="#specifying-message-persistence">Specifying Message Persistence</a>.</p>
</div>
<div class="paragraph">
<p>Transactions allow multiple messages to be sent or received in an atomic operation. In the Jakarta EE platform they also allow message sends and receives to be combined with database reads and writes in an atomic transaction.
A transaction is a unit of work into which you can group a series of operations, such as message sends and receives, so that the operations either all succeed or all fail.
For details, see <a href="#using-jakarta-messaging-local-transactions">Using Jakarta Messaging Local Transactions</a>.</p>
</div>
<div class="paragraph">
<p>The most reliable way to consume a message is to do so within a transaction, either from a queue or from a durable subscription to a topic.
For details, see <a href="#creating-durable-subscriptions">Creating Durable Subscriptions</a>, <a href="#creating-temporary-destinations">Creating Temporary Destinations</a>, and <a href="#using-jakarta-messaging-local-transactions">Using Jakarta Messaging Local Transactions</a>.</p>
</div>
<div class="paragraph">
<p>Some features primarily allow an application to improve performance.
For example, you can set messages to expire after a certain length of time (see <a href="#allowing-messages-to-expire">Allowing Messages to Expire</a>), so that consumers do not receive unnecessary outdated information.
You can send messages asynchronously; see <a href="#sending-messages-asynchronously">Sending Messages Asynchronously</a>.</p>
</div>
<div class="paragraph">
<p>You can also specify various levels of control over message acknowledgment; see <a href="#controlling-message-acknowledgment">Controlling Message Acknowledgment</a>.</p>
</div>
<div class="paragraph">
<p>Other features can provide useful capabilities unrelated to reliability.
For example, you can create temporary destinations that last only for the duration of the connection in which they are created.
See <a href="#creating-temporary-destinations">Creating Temporary Destinations</a> for details.</p>
</div>
<div class="paragraph">
<p>The following sections describe these features as they apply to application clients or Java SE clients.
Some of the features work differently in the Jakarta EE web or enterprise bean container; in these cases, the differences are noted here and are explained in detail in <a href="#using-jakarta-messaging-in-jakarta-ee-applications">Using Jakarta Messaging in Jakarta EE Applications</a>.</p>
</div>
<div class="sect3">
<h4 id="controlling-message-acknowledgment"><a class="anchor" href="#controlling-message-acknowledgment"></a>Controlling Message Acknowledgment</h4>
<div class="paragraph">
<p>Until a Jakarta Messaging message has been acknowledged, it is not considered to be successfully consumed.
The successful consumption of a message ordinarily takes place in three stages.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The client receives the message.</p>
</li>
<li>
<p>The client processes the message.</p>
</li>
<li>
<p>The message is acknowledged.<br>
Acknowledgment is initiated either by the Messaging provider or by the client, depending on the session acknowledgment mode.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In locally transacted sessions (see <a href="#using-jakarta-messaging-local-transactions">Using Jakarta Messaging Local Transactions</a>), a message is acknowledged when the session is committed.
If a transaction is rolled back, all consumed messages are redelivered.</p>
</div>
<div class="paragraph">
<p>In a Jakarta transaction (in the Jakarta EE web or enterprise bean container) a message is acknowledged when the transaction is committed.</p>
</div>
<div class="paragraph">
<p>In nontransacted sessions, when and how a message is acknowledged depend on a value that may be specified as an argument of the <code>createContext</code> method.
The possible argument values are as follows.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>JMSContext.AUTO_ACKNOWLEDGE</code>: This setting is the default for application clients and Java SE clients.
The <code>JMSContext</code> automatically acknowledges a client&#8217;s receipt of a message either when the client has successfully returned from a call to <code>receive</code> or when the <code>MessageListener</code> it has called to process the message returns successfully.</p>
<div class="paragraph">
<p>A synchronous receive in a <code>JMSContext</code> that is configured to use auto-acknowledgment is the one exception to the rule that message consumption is a three-stage process as described earlier.
In this case, the receipt and acknowledgment take place in one step, followed by the processing of the message.</p>
</div>
</li>
<li>
<p><code>JMSContext.CLIENT_ACKNOWLEDGE</code>: A client acknowledges a message by calling the message&#8217;s <code>acknowledge</code> method.
In this mode, acknowledgment takes place on the session level: Acknowledging a consumed message automatically acknowledges the receipt of all messages that have been consumed by its session.
For example, if a message consumer consumes ten messages and then acknowledges the fifth message delivered, all ten messages are acknowledged.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In the Jakarta EE platform, the <code>JMSContext.CLIENT_ACKNOWLEDGE</code> setting can be used only in an application client, not in a web component or enterprise bean.
</td>
</tr>
</table>
</div>
</li>
<li>
<p><code>JMSContext.DUPS_OK_ACKNOWLEDGE</code>: This option instructs the <code>JMSContext</code> to lazily acknowledge the delivery of messages.
This is likely to result in the delivery of some duplicate messages if the Messaging provider fails, so it should be used only by consumers that can tolerate duplicate messages.
(If the Messaging provider redelivers a message, it must set the value of the <code>JMSRedelivered</code> message header to <code>true</code>.)
This option can reduce session overhead by minimizing the work the session does to prevent duplicates.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If messages have been received from a queue but not acknowledged when a <code>JMSContext</code> is closed, the Messaging provider retains them and redelivers them when a consumer next accesses the queue.
The provider also retains unacknowledged messages if an application closes a <code>JMSContext</code> that has been consuming messages from a durable subscription.
(See <a href="#creating-durable-subscriptions">Creating Durable Subscriptions</a>.)
Unacknowledged messages that have been received from a nondurable subscription will be dropped when the <code>JMSContext</code> is closed.</p>
</div>
<div class="paragraph">
<p>If you use a queue or a durable subscription, you can use the <code>JMSContext.recover</code> method to stop a nontransacted <code>JMSContext</code> and restart it with its first unacknowledged message.
In effect, the <code>JMSContext</code>'s series of delivered messages is reset to the point after its last acknowledged message.
The messages it now delivers may be different from those that were originally delivered, if messages have expired or if higher-priority messages have arrived.
For a consumer on a nondurable subscription, the provider may drop unacknowledged messages when the <code>JMSContext.recover</code> method is called.</p>
</div>
<div class="paragraph">
<p>The sample program in <a href="#acknowledging-messages">Acknowledging Messages</a> demonstrates two ways to ensure that a message will not be acknowledged until processing of the message is complete.</p>
</div>
</div>
<div class="sect3">
<h4 id="specifying-options-for-sending-messages"><a class="anchor" href="#specifying-options-for-sending-messages"></a>Specifying Options for Sending Messages</h4>
<div class="paragraph">
<p>You can set a number of options when you send a message.
These options enable you to perform the tasks described in the following topics:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#specifying-message-persistence">Specifying Message Persistence</a> - Specify that messages are persistent, meaning they must not be lost in the event of a provider failure.</p>
</li>
<li>
<p><a href="#setting-message-priority-levels">Setting Message Priority Levels</a> - Set priority levels for messages, which can affect the order in which the messages are delivered.</p>
</li>
<li>
<p><a href="#allowing-messages-to-expire">Allowing Messages to Expire</a> - Specify an expiration time for messages so they will not be delivered if they are obsolete.</p>
</li>
<li>
<p><a href="#specifying-a-delivery-delay">Specifying a Delivery Delay</a> - Specify a delivery delay for messages so that they will not be delivered until a specified amount of time has expired.</p>
</li>
<li>
<p><a href="#using-jmsproducer-method-chaining">Using JMSProducer Method Chaining</a> - Method chaining allows you to specify more than one of these options when you create a producer and call the <code>send</code> method.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="specifying-message-persistence"><a class="anchor" href="#specifying-message-persistence"></a>Specifying Message Persistence</h5>
<div class="paragraph">
<p>Jakarta Messaging supports two delivery modes specifying whether messages are lost if the Messaging provider fails.
These delivery modes are fields of the <code>DeliveryMode</code> interface.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The default delivery mode, <code>PERSISTENT</code>, instructs the Messaging provider to take extra care to ensure that a message is not lost in transit in case of a Messaging provider failure.
A message sent with this delivery mode is logged to stable storage when it is sent.</p>
</li>
<li>
<p>The <code>NON_PERSISTENT</code> delivery mode does not require the Messaging provider to store the message or otherwise guarantee that it is not lost if the provider fails.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To specify the delivery mode, use the <code>setDeliveryMode</code> method of the <code>JMSProducer</code> interface to set the delivery mode for all messages sent by that producer.</p>
</div>
<div class="paragraph">
<p>You can use method chaining to set the delivery mode when you create a producer and send a message.
The following call creates a producer with a <code>NON_PERSISTENT</code> delivery mode and uses it to send a message:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">context.createProducer()
       .setDeliveryMode(DeliveryMode.NON_PERSISTENT).send(dest, msg);</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you do not specify a delivery mode, the default is <code>PERSISTENT</code>.
Using the <code>NON_PERSISTENT</code> delivery mode may improve performance and reduce storage overhead, but you should use it only if your application can afford to miss messages.</p>
</div>
</div>
<div class="sect4">
<h5 id="setting-message-priority-levels"><a class="anchor" href="#setting-message-priority-levels"></a>Setting Message Priority Levels</h5>
<div class="paragraph">
<p>You can use message priority levels to instruct the Messaging provider to deliver urgent messages first.
Use the <code>setPriority</code> method of the <code>JMSProducer</code> interface to set the priority level for all messages sent by that producer.</p>
</div>
<div class="paragraph">
<p>You can use method chaining to set the priority level when you create a producer and send a message.
For example, the following call sets a priority level of 7 for a producer and then sends a message:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">context.createProducer().setPriority(<span class="integer">7</span>).send(dest, msg);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The ten levels of priority range from 0 (lowest) to 9 (highest).
If you do not specify a priority level, the default level is 4.
A Messaging provider tries to deliver higher-priority messages before lower-priority ones, but does not have to deliver messages in exact order of priority.</p>
</div>
</div>
<div class="sect4">
<h5 id="allowing-messages-to-expire"><a class="anchor" href="#allowing-messages-to-expire"></a>Allowing Messages to Expire</h5>
<div class="paragraph">
<p>By default, a message never expires.
If a message will become obsolete after a certain period, however, you may want to set an expiration time.
Use the <code>setTimeToLive</code> method of the <code>JMSProducer</code> interface to set a default expiration time for all messages sent by that producer.</p>
</div>
<div class="paragraph">
<p>For example, a message that contains rapidly changing data such as a stock price will become obsolete after a few minutes, so you might configure messages to expire after that time.</p>
</div>
<div class="paragraph">
<p>You can use method chaining to set the time to live when you create a producer and send a message.
For example, the following call sets a time to live of five minutes for a producer and then sends a message:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">context.createProducer().setTimeToLive(<span class="integer">300000</span>).send(dest, msg);</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the specified <code>timeToLive</code> value is <code>0</code>, the message never expires.</p>
</div>
<div class="paragraph">
<p>When the message is sent, the specified <code>timeToLive</code> is added to the current time to give the expiration time.
Any message not delivered before the specified expiration time is destroyed.
The destruction of obsolete messages conserves storage and computing resources.</p>
</div>
</div>
<div class="sect4">
<h5 id="specifying-a-delivery-delay"><a class="anchor" href="#specifying-a-delivery-delay"></a>Specifying a Delivery Delay</h5>
<div class="paragraph">
<p>You can specify a length of time that must elapse after a message is sent before the Messaging provider delivers the message.
Use the <code>setDeliveryDelay</code> method of the <code>JMSProducer</code> interface to set a delivery delay for all messages sent by that producer.</p>
</div>
<div class="paragraph">
<p>You can use method chaining to set the delivery delay when you create a producer and send a message.
For example, the following call sets a delivery delay of 3 seconds for a producer and then sends a message:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">context.createProducer().setDeliveryDelay(<span class="integer">3000</span>).send(dest, msg);</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="using-jmsproducer-method-chaining"><a class="anchor" href="#using-jmsproducer-method-chaining"></a>Using JMSProducer Method Chaining</h5>
<div class="paragraph">
<p>The setter methods on the <code>JMSProducer</code> interface return <code>JMSProducer</code> objects, so you can use method chaining to create a producer, set multiple properties, and send a message.
For example, the following chained method calls create a producer, set a user-defined property, set the expiration, delivery mode, and priority for the message, and then send a message to a queue:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">context.createProducer()
        .setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">MyProperty</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">MyValue</span><span class="delimiter">&quot;</span></span>)
        .setTimeToLive(<span class="integer">10000</span>)
        .setDeliveryMode(NON_PERSISTENT)
        .setPriority(<span class="integer">2</span>)
        .send(queue, body);</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also call the <code>JMSProducer</code> methods to set properties on a message and then send the message in a separate <code>send</code> method call.
You can also set message properties directly on a message.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="creating-temporary-destinations"><a class="anchor" href="#creating-temporary-destinations"></a>Creating Temporary Destinations</h4>
<div class="paragraph">
<p>Normally, you create JMS destinations (queues and topics) administratively rather than programmatically.
Your Messaging provider includes a tool to create and remove destinations, and it is common for destinations to be long-lasting.</p>
</div>
<div class="paragraph">
<p>Jakarta Messaging also enables you to create destinations (<code>TemporaryQueue</code> and <code>TemporaryTopic</code> objects) that last only for the duration of the connection in which they are created.
You create these destinations dynamically using the <code>JMSContext.createTemporaryQueue</code> and the <code>JMSContext.createTemporaryTopic</code> methods, as in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">TemporaryTopic replyTopic = context.createTemporaryTopic();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The only message consumers that can consume from a temporary destination are those created by the same connection that created the destination.
Any message producer can send to the temporary destination.
If you close the connection to which a temporary destination belongs, the destination is closed and its contents are lost.</p>
</div>
<div class="paragraph">
<p>You can use temporary destinations to implement a simple request/reply mechanism.
If you create a temporary destination and specify it as the value of the <code>JMSReplyTo</code> message header field when you send a message, then the consumer of the message can use the value of the <code>JMSReplyTo</code> field as the destination to which it sends a reply.
The consumer can also reference the original request by setting the <code>JMSCorrelationID</code> header field of the reply message to the value of the <code>JMSMessageID</code> header field of the request.
For example, an <code>onMessage</code> method can create a <code>JMSContext</code> so that it can send a reply to the message it receives.
It can use code such as the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">replyMsg = context.createTextMessage(<span class="string"><span class="delimiter">&quot;</span><span class="content">Consumer processed message: </span><span class="delimiter">&quot;</span></span>
        + msg.getText());
replyMsg.setJMSCorrelationID(msg.getJMSMessageID());
context.createProducer().send((Topic) msg.getJMSReplyTo(), replyMsg);</code></pre>
</div>
</div>
<div class="paragraph">
<p>For an example, see <a href="#using-an-entity-to-join-messages-from-two-mdbs">Using an Entity to Join Messages from Two MDBs</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="using-jakarta-messaging-local-transactions"><a class="anchor" href="#using-jakarta-messaging-local-transactions"></a>Using Jakarta Messaging Local Transactions</h4>
<div class="paragraph">
<p>A transaction groups a series of operations into an atomic unit of work.
If any one of the operations fails, the transaction can be rolled back, and the operations can be attempted again from the beginning.
If all the operations succeed, the transaction can be committed.</p>
</div>
<div class="paragraph">
<p>In an application client or a Java SE client, you can use local transactions to group message sends and receives.
You use the <code>JMSContext.commit</code> method to commit a transaction.
You can send multiple messages in a transaction, and the messages will not be added to the queue or topic until the transaction is committed.
If you receive multiple messages in a transaction, they will not be acknowledged until the transaction is committed.</p>
</div>
<div class="paragraph">
<p>You can use the <code>JMSContext.rollback</code> method to roll back a transaction.
A transaction rollback means that all produced messages are destroyed and all consumed messages are recovered and redelivered unless they have expired (see <a href="#allowing-messages-to-expire">Allowing Messages to Expire</a>).</p>
</div>
<div class="paragraph">
<p>A transacted session is always involved in a transaction.
To create a transacted session, call the <code>createContext</code> method as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">JMSContext context =
        connectionFactory.createContext(JMSContext.SESSION_TRANSACTED);</code></pre>
</div>
</div>
<div class="paragraph">
<p>As soon as the <code>commit</code> or the <code>rollback</code> method is called, one transaction ends and another transaction begins.
Closing a transacted session rolls back its transaction in progress, including any pending sends and receives.</p>
</div>
<div class="paragraph">
<p>In an application running in the Jakarta EE web or enterprise bean container, you cannot use local transactions.
Instead, you use Jakarta Transactions, described in <a href="#using-jakarta-messaging-in-jakarta-ee-applications">Using Jakarta Messaging in Jakarta EE Applications</a>.</p>
</div>
<div class="paragraph">
<p>You can combine several sends and receives in a single Jakarta Messaging local transaction, so long as they are all performed using the same <code>JMSContext</code>.</p>
</div>
<div class="paragraph">
<p>Do not use a single transaction if you use a request/reply mechanism, in which you send a message and then receive a reply to that message.
If you try to use a single transaction, the program will hang, because the send cannot take place until the transaction is committed.
The following code fragment illustrates the problem:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// Don't do this!</span>
outMsg.setJMSReplyTo(replyQueue);
context.createProducer().send(outQueue, outMsg);
consumer = context.createConsumer(replyQueue);
inMsg = consumer.receive();
context.commit();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Because a message sent during a transaction is not actually sent until the transaction is committed, the transaction cannot contain any receives that depend on that message&#8217;s having been sent.</p>
</div>
<div class="paragraph">
<p>The production and the consumption of a message cannot both be part of the same transaction.
The reason is that the transactions take place between the clients and the Messaging provider, which intervenes between the production and the consumption of the message.
<a href="#using-jakarta-messaging-local-transactions-2">Figure 48-8</a> illustrates this interaction.</p>
</div>
<div id="using-jakarta-messaging-local-transactions-2" class="imageblock">
<div class="content">
<img src="images/jakartaeett_dt_033.svg" alt="Diagram of local transactions, showing separate transactions for sending and consuming a message">
</div>
<div class="title">Figure 48-8 Using Jakarta Messaging Local Transactions</div>
</div>
<div class="paragraph">
<p>The sending of one or more messages to one or more destinations by Client 1 can form a single transaction, because it forms a single set of interactions with the Messaging provider using a single <code>JMSContext</code>.
Similarly, the receiving of one or more messages from one or more destinations by Client 2 also forms a single transaction using a single <code>JMSContext</code>.
But because the two clients have no direct interaction and are using two different <code>JMSContext</code> objects, no transactions can take place between them.</p>
</div>
<div class="paragraph">
<p>Another way of putting this is that a transaction is a contract between a client and a Messaging provider that defines whether a message is sent to a destination or whether a message is received from the destination.
It is not a contract between the sending client and the receiving client.</p>
</div>
<div class="paragraph">
<p>This is the fundamental difference between messaging and synchronized processing.
Instead of tightly coupling the sender and the receiver of a message, JMS couples the sender of a message with the destination, and it separately couples the destination with the receiver of the message.
Therefore, while the sends and receives each have a tight coupling with the Messaging provider, they do not have any coupling with each other.</p>
</div>
<div class="paragraph">
<p>When you create a <code>JMSContext</code>, you can specify whether it is transacted by using the <code>JMSContext.SESSION_TRANSACTED</code> argument to the <code>createContext</code> method.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">try</span> (JMSContext context = connectionFactory.createContext(
        JMSContext.SESSION_TRANSACTED);) {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>commit</code> and the <code>rollback</code> methods for local transactions are associated with the session that underlies the <code>JMSContext</code>.
You can combine operations on more than one queue or topic, or on a combination of queues and topics, in a single transaction if you use the same session to perform the operations.
For example, you can use the same <code>JMSContext</code> to receive a message from a queue and send a message to a topic in the same transaction.</p>
</div>
<div class="paragraph">
<p>The example in <a href="#using-local-transactions">Using Local Transactions</a> shows how to use Jakarta Messaging local transactions.</p>
</div>
</div>
<div class="sect3">
<h4 id="sending-messages-asynchronously"><a class="anchor" href="#sending-messages-asynchronously"></a>Sending Messages Asynchronously</h4>
<div class="paragraph">
<p>Normally, when you send a persistent message, the <code>send</code> method blocks until the Messaging provider confirms that the message was sent successfully.
The asynchronous send mechanism allows your application to send a message and continue work while waiting to learn whether the send completed.</p>
</div>
<div class="paragraph">
<p>This feature is currently available only in application clients and Java SE clients.</p>
</div>
<div class="paragraph">
<p>Sending a message asynchronously involves supplying a callback object.
You specify a <code>CompletionListener</code> with an <code>onCompletion</code> method.
For example, the following code instantiates a <code>CompletionListener</code> named <code>SendListener</code>.
It then calls the <code>setAsync</code> method to specify that sends from this producer should be asynchronous and should use the specified listener:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">CompletionListener listener = <span class="keyword">new</span> SendListener();
context.createProducer().setAsync(listener).send(dest, message);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>CompletionListener</code> class must implement two methods, <code>onCompletion</code> and <code>onException</code>.
The <code>onCompletion</code> method is called if the send succeeds, and the <code>onException</code> method is called if it fails.
A simple implementation of these methods might look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> onCompletion(Message message) {
    <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">onCompletion method: Send has completed.</span><span class="delimiter">&quot;</span></span>);
}

<span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> onException(Message message, <span class="exception">Exception</span> e) {
    <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">onException method: send failed: </span><span class="delimiter">&quot;</span></span> + e.toString());
    <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Unsent message is: </span><span class="char">\n</span><span class="delimiter">&quot;</span></span> + message);
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-jakarta-messaging-in-jakarta-ee-applications"><a class="anchor" href="#using-jakarta-messaging-in-jakarta-ee-applications"></a>Using Jakarta Messaging in Jakarta EE Applications</h3>
<div class="paragraph">
<p>This section describes how using Jakarta Messaging in enterprise bean applications or web applications differs from using it in application clients.</p>
</div>
<div class="sect3">
<h4 id="overview-of-using-jakarta-messaging"><a class="anchor" href="#overview-of-using-jakarta-messaging"></a>Overview of Using Jakarta Messaging</h4>
<div class="paragraph">
<p>A general rule in the Jakarta EE platform specification applies to all Jakarta EE components that use Jakarta Messaging within enterprise bean or web containers: Application components in the web and enterprise bean containers must not attempt to create more than one active (not closed) <code>Session</code> object per connection.
Multiple <code>JMSContext</code> objects are permitted, however, since they combine a single connection and a single session.</p>
</div>
<div class="paragraph">
<p>This rule does not apply to application clients.
The application client container supports the creation of multiple sessions for each connection.</p>
</div>
</div>
<div class="sect3">
<h4 id="creating-resources-for-jakarta-ee-applications"><a class="anchor" href="#creating-resources-for-jakarta-ee-applications"></a>Creating Resources for Jakarta EE Applications</h4>
<div class="paragraph">
<p>You can use annotations to create application-specific connection factories and destinations for Jakarta EE enterprise bean or web components.
The resources you create in this way are visible only to the application for which you create them.</p>
</div>
<div class="paragraph">
<p>You can also use deployment descriptor elements to create these resources.
Elements specified in the deployment descriptor override elements specified in annotations.
See <a href="#packaging-applications">Packaging Applications</a> for basic information about deployment descriptors.
You must use a deployment descriptor to create application-specific resources for application clients.</p>
</div>
<div class="paragraph">
<p>To create a destination, use a <code>@JMSDestinationDefinition</code> annotation like the following on a class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@JMSDestinationDefinition</span>(
    name = <span class="string"><span class="delimiter">&quot;</span><span class="content">java:app/jms/myappTopic</span><span class="delimiter">&quot;</span></span>,
    interfaceName = <span class="string"><span class="delimiter">&quot;</span><span class="content">jakarta.jms.Topic</span><span class="delimiter">&quot;</span></span>,
    destinationName = <span class="string"><span class="delimiter">&quot;</span><span class="content">MyPhysicalAppTopic</span><span class="delimiter">&quot;</span></span>
  )</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>name</code>, <code>interfaceName</code>, and <code>destinationName</code> elements are required.
You can optionally specify a <code>description</code> element.
To create multiple destinations, enclose them in a <code>@JMSDestinationDefinitions</code> annotation, separated by commas.</p>
</div>
<div class="paragraph">
<p>To create a connection factory, use a <code>@JMSConnectionFactoryDefinition</code> annotation like the following on a class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@JMSConnectionFactoryDefinition</span>(
    name=<span class="string"><span class="delimiter">&quot;</span><span class="content">java:app/jms/MyConnectionFactory</span><span class="delimiter">&quot;</span></span>
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>name</code> element is required.
You can optionally specify a number of other elements, such as <code>clientId</code> if you want to use the connection factory for durable subscriptions, or <code>description</code>.
If you do not specify the <code>interfaceName</code> element, the default interface is <code>jakarta.jms.ConnectionFactory</code>.
To create multiple connection factories, enclose them in a <code>@JMSConnectionFactoryDefinitions</code> annotation, separated by commas.</p>
</div>
<div class="paragraph">
<p>You need to specify the annotation only once for a given application, in any of the components.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If your application contains one or more message-driven beans, you may want to place the annotation on one of the message-driven beans.
If you place the annotation on a sending component such as an application client, you need to specify the <code>mappedName</code> element to look up the topic, instead of using the <code>destinationLookup</code> property of the activation configuration specification.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When you inject the resource into a component, use the value of the <code>name</code> element in the definition annotation as the value of the <code>lookup</code> element in the <code>@Resource</code> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Resource</span>(lookup = <span class="string"><span class="delimiter">&quot;</span><span class="content">java:app/jms/myappTopic</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> Topic topic;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following portable JNDI namespaces are available.
Which ones you can use depends on how your application is packaged.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>java:global</code>: Makes the resource available to all deployed applications</p>
</li>
<li>
<p><code>java:app</code>: Makes the resource available to all components in all modules in a single application</p>
</li>
<li>
<p><code>java:module</code>: Makes the resource available to all components within a given module (for example, all enterprise beans within a Jakarta Enterprise Beans module)</p>
</li>
<li>
<p><code>java:comp</code>: Makes the resource available to a single component only (except in a web application, where it is equivalent to <code>java:module</code>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See the API documentation for details on these annotations.
The examples in <a href="#sending-and-receiving-messages-using-a-simple-web-application">Sending and Receiving Messages Using a Simple Web Application</a>, <a href="#sending-messages-from-a-session-bean-to-an-mdb">Sending Messages from a Session Bean to an MDB</a>, and <a href="#using-an-entity-to-join-messages-from-two-mdbs">Using an Entity to Join Messages from Two MDBs</a> all use the <code>@JMSDestinationDefinition</code> annotation.
The other JMS examples do not use these annotations.
The examples that consist only of application clients are not deployed in the application server and must therefore communicate with each other using administratively created resources that exist outside of individual applications.</p>
</div>
</div>
<div class="sect3">
<h4 id="using-resource-injection-in-enterprise-bean-or-web-components"><a class="anchor" href="#using-resource-injection-in-enterprise-bean-or-web-components"></a>Using Resource Injection in Enterprise Bean or Web Components</h4>
<div class="paragraph">
<p>You may use resource injection to inject both administered objects and <code>JMSContext</code> objects in Jakarta EE applications.</p>
</div>
<div class="sect4">
<h5 id="injecting-a-connectionfactory-queue-or-topic"><a class="anchor" href="#injecting-a-connectionfactory-queue-or-topic"></a>Injecting a ConnectionFactory, Queue, or Topic</h5>
<div class="paragraph">
<p>Normally, you use the <code>@Resource</code> annotation to inject a <code>ConnectionFactory</code>, <code>Queue</code>, or <code>Topic</code> into your Jakarta EE application.
These objects must be created administratively before you deploy your application.
You may want to use the default connection factory, whose JNDI name is <code>java:comp/DefaultJMSConnectionFactory</code>.</p>
</div>
<div class="paragraph">
<p>When you use resource injection in an application client component, you normally declare the Messaging resource static:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Resource</span>(lookup = <span class="string"><span class="delimiter">&quot;</span><span class="content">java:comp/DefaultJMSConnectionFactory</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> <span class="directive">static</span> ConnectionFactory connectionFactory;

<span class="annotation">@Resource</span>(lookup = <span class="string"><span class="delimiter">&quot;</span><span class="content">jms/MyQueue</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> <span class="directive">static</span> <span class="predefined-type">Queue</span> queue;</code></pre>
</div>
</div>
<div class="paragraph">
<p>However, when you use this annotation in a session bean, a message-driven bean, or a web component, do not declare the resource static:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Resource</span>(lookup = <span class="string"><span class="delimiter">&quot;</span><span class="content">java:comp/DefaultJMSConnectionFactory</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> ConnectionFactory connectionFactory;

<span class="annotation">@Resource</span>(lookup = <span class="string"><span class="delimiter">&quot;</span><span class="content">jms/MyTopic</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> Topic topic;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you declare the resource static in these components, runtime errors will result.</p>
</div>
</div>
<div class="sect4">
<h5 id="injecting-a-jmscontext-object"><a class="anchor" href="#injecting-a-jmscontext-object"></a>Injecting a JMSContext Object</h5>
<div class="paragraph">
<p>To access a <code>JMSContext</code> object in an enterprise bean or web component, instead of injecting the <code>ConnectionFactory</code> resource and then creating a <code>JMSContext</code>, you can use the <code>@Inject</code> and <code>@JMSConnectionFactory</code> annotations to inject a <code>JMSContext</code>.
To use the default connection factory, use code like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
<span class="directive">private</span> JMSContext context1;</code></pre>
</div>
</div>
<div class="paragraph">
<p>To use your own connection factory, use code like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
<span class="annotation">@JMSConnectionFactory</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">jms/MyConnectionFactory</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> JMSContext context2;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="using-jakarta-ee-components-to-produce-and-to-synchronously-receive-messages"><a class="anchor" href="#using-jakarta-ee-components-to-produce-and-to-synchronously-receive-messages"></a>Using Jakarta EE Components to Produce and to Synchronously Receive Messages</h4>
<div class="paragraph">
<p>An application that produces messages or synchronously receives them can use a Jakarta EE web or Jakarta Enterprise Beans component, such as a managed bean, a servlet, or a session bean, to perform these operations.
The example in <a href="#sending-messages-from-a-session-bean-to-an-mdb">Sending Messages from a Session Bean to an MDB</a> uses a stateless session bean to send messages to a topic.
The example in <a href="#sending-and-receiving-messages-using-a-simple-web-application">Sending and Receiving Messages Using a Simple Web Application</a> uses managed beans to produce and to consume messages.</p>
</div>
<div class="paragraph">
<p>Because a synchronous receive with no specified timeout ties up server resources, this mechanism usually is not the best application design for a web or Jakarta Enterprise Beans component.
Instead, use a synchronous receive that specifies a timeout value, or use a message-driven bean to receive messages asynchronously.
For details about synchronous receives, see <a href="#jakarta-messaging-message-consumers">Jakarta Messaging Message Consumers</a>.</p>
</div>
<div class="paragraph">
<p>Using Jakarta Messaging in a Jakarta EE component is in many ways similar to using it in an application client.
The main differences are the areas of resource management and transactions.</p>
</div>
<div class="sect4">
<h5 id="managing-jakarta-messaging-resources-in-web-and-jakarta-enterprise-beans-components"><a class="anchor" href="#managing-jakarta-messaging-resources-in-web-and-jakarta-enterprise-beans-components"></a>Managing Jakarta Messaging Resources in Web and Jakarta Enterprise Beans Components</h5>
<div class="paragraph">
<p>The Jakarta Messaging resources are a connection and a session, usually combined in a <code>JMSContext</code> object.
In general, it is important to release Messaging resources when they are no longer being used.
Here are some useful practices to follow.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If you wish to maintain a Messaging resource only for the life span of a business method, use a <code>try</code>-with-resources statement to create the <code>JMSContext</code> so that it will be closed automatically at the end of the <code>try</code> block.</p>
</li>
<li>
<p>To maintain a Messaging resource for the duration of a transaction or request, inject the <code>JMSContext</code> as described in <a href="#injecting-a-jmscontext-object">Injecting a JMSContext Object</a>.
This will also cause the resource to be released when it is no longer needed.</p>
</li>
<li>
<p>If you would like to maintain a Messaging resource for the life span of an enterprise bean instance, you can use a <code>@PostConstruct</code> callback method to create the resource and a <code>@PreDestroy</code> callback method to close the resource.
However, there is normally no need to do this, since application servers usually maintain a pool of connections.
If you use a stateful session bean and you wish to maintain the Messaging resource in a cached state, you must close the resource in a <code>@PrePassivate</code> callback method and set its value to <code>null</code>, and you must create it again in a <code>@PostActivate</code> callback method.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="managing-transactions-in-session-beans"><a class="anchor" href="#managing-transactions-in-session-beans"></a>Managing Transactions in Session Beans</h5>
<div class="paragraph">
<p>Instead of using local transactions, you use Jakarta transactions.
You can use either container-managed transactions or bean-managed transactions.
Normally, you use container-managed transactions for bean methods that perform sends or receives, allowing the enterprise bean container to handle transaction demarcation.
Because container-managed transactions are the default, you do not have to specify them.</p>
</div>
<div class="paragraph">
<p>You can use bean-managed transactions and the <code>jakarta.transaction.UserTransaction</code> interface&#8217;s transaction demarcation methods, but you should do so only if your application has special requirements and you are an expert in using transactions.
Usually, container-managed transactions produce the most efficient and correct behavior.
This tutorial does not provide any examples of bean-managed transactions.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="using-message-driven-beans-to-receive-messages-asynchronously"><a class="anchor" href="#using-message-driven-beans-to-receive-messages-asynchronously"></a>Using Message-Driven Beans to Receive Messages Asynchronously</h4>
<div class="paragraph">
<p>The sections <a href="#what-is-a-message-driven-bean">What Is a Message-Driven Bean?</a> and <a href="#how-does-jakarta-messaging-work-with-the-jakarta-ee-platform">How Does Jakarta Messaging Work with the Jakarta EE Platform?</a> describe how the Jakarta EE platform supports a special kind of enterprise bean, the message-driven bean, which allows Jakarta EE applications to process Jakarta Messaging messages asynchronously.
Other Jakarta EE web and Jakarta Enterprise Beans components allow you to send messages and to receive them synchronously but not asynchronously.</p>
</div>
<div class="paragraph">
<p>A message-driven bean is a message listener to which messages can be delivered from either a queue or a topic.
The messages can be sent by any Jakarta EE component (from an application client, another enterprise bean, or a web component) or from an application or a system that does not use Jakarta EE technology.</p>
</div>
<div class="paragraph">
<p>A message-driven bean class has the following requirements.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It must be annotated with the <code>@MessageDriven</code> annotation if it does not use a deployment descriptor.</p>
</li>
<li>
<p>The class must be defined as <code>public</code>, but not as <code>abstract</code> or <code>final</code>.</p>
</li>
<li>
<p>It must contain a public constructor with no arguments.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It is recommended, but not required, that a message-driven bean class implement the message listener interface for the message type it supports.
A bean that supports Jakarta Messaging implements the <code>jakarta.jms.MessageListener</code> interface, which means that it must provide an <code>onMessage</code> method with the following signature:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">void</span> onMessage(Message inMessage)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>onMessage</code> method is called by the bean&#8217;s container when a message has arrived for the bean to service.
This method contains the business logic that handles the processing of the message.
It is the message-driven bean&#8217;s responsibility to parse the message and perform the necessary business logic.</p>
</div>
<div class="paragraph">
<p>A message-driven bean differs from an application client&#8217;s message listener in the following ways.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In an application client, you must create a <code>JMSContext</code>, then create a <code>JMSConsumer</code>, then call <code>setMessageListener</code> to activate the listener.
For a message-driven bean, you need only define the class and annotate it, and the enterprise bean container creates it for you.</p>
</li>
<li>
<p>The bean class uses the <code>@MessageDriven</code> annotation, which typically contains an <code>activationConfig</code> element containing <code>@ActivationConfigProperty</code> annotations that specify properties used by the bean or the connection factory.
These properties can include the connection factory, a destination type, a durable subscription, a message selector, or an acknowledgment mode.
Some of the examples in <a href="#jakarta-messaging-examples">Chapter 49, <em>Jakarta Messaging Examples</em></a> set these properties.
You can also set the properties in the deployment descriptor.</p>
</li>
<li>
<p>The application client container has only one instance of a <code>MessageListener</code>, which is called on a single thread at a time.
A message-driven bean, however, may have multiple instances, configured by the container, which may be called concurrently by multiple threads (although each instance is called by only one thread at a time).
Message-driven beans may therefore allow much faster processing of messages than message listeners.</p>
</li>
<li>
<p>You do not need to specify a message acknowledgment mode unless you use bean-managed transactions.
The message is consumed in the transaction in which the <code>onMessage</code> method is invoked.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a href="#activationconfigproperty-settings-for-message-driven-beans">Table 48-3</a> lists the activation configuration properties defined by the Jakarta Messaging specification.</p>
</div>
<table id="activationconfigproperty-settings-for-message-driven-beans" class="tableblock frame-all grid-all" style="width: 80%;">
<caption class="title">Table 48-3 @ActivationConfigProperty Settings for Message-Driven Beans</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>acknowledgeMode</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Acknowledgment mode, used only for bean-managed transactions; the default is <code>Auto-acknowledge</code> (<code>Dups-ok-acknowledge</code> is also permitted)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>destinationLookup</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The lookup name of the queue or topic from which the bean will receive messages</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>destinationType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Either <code>jakarta.jms.Queue</code> or <code>jakarta.jms.Topic</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>subscriptionDurability</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For durable subscriptions, set the value to <code>Durable</code>; see <a href="#creating-durable-subscriptions">Creating Durable Subscriptions</a> for more information</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>clientId</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For durable subscriptions, the client ID for the connection (optional)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>subscriptionName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For durable subscriptions, the name of the subscription</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>messageSelector</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A string that filters messages; see <a href="#jakarta-messaging-message-selectors">Jakarta Messaging Message Selectors</a> for information</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>connectionFactoryLookup</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The lookup name of the connection factory to be used to connect to the Messaging provider from which the bean will receive messages</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For example, here is the message-driven bean used in <a href="#receiving-messages-asynchronously-using-a-message-driven-bean">Receiving Messages Asynchronously Using a Message-Driven Bean</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@MessageDriven</span>(activationConfig = {
    <span class="annotation">@ActivationConfigProperty</span>(propertyName = <span class="string"><span class="delimiter">&quot;</span><span class="content">destinationLookup</span><span class="delimiter">&quot;</span></span>,
            propertyValue = <span class="string"><span class="delimiter">&quot;</span><span class="content">jms/MyQueue</span><span class="delimiter">&quot;</span></span>),
    <span class="annotation">@ActivationConfigProperty</span>(propertyName = <span class="string"><span class="delimiter">&quot;</span><span class="content">destinationType</span><span class="delimiter">&quot;</span></span>,
            propertyValue = <span class="string"><span class="delimiter">&quot;</span><span class="content">jakarta.jms.Queue</span><span class="delimiter">&quot;</span></span>)
})
<span class="directive">public</span> <span class="type">class</span> <span class="class">SimpleMessageBean</span> <span class="directive">implements</span> MessageListener {

    <span class="annotation">@Resource</span>
    <span class="directive">private</span> MessageDrivenContext mdc;
    <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">Logger</span> logger = <span class="predefined-type">Logger</span>.getLogger(<span class="string"><span class="delimiter">&quot;</span><span class="content">SimpleMessageBean</span><span class="delimiter">&quot;</span></span>);

    <span class="directive">public</span> SimpleMessageBean() {
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> onMessage(Message inMessage) {

        <span class="keyword">try</span> {
            <span class="keyword">if</span> (inMessage <span class="keyword">instanceof</span> TextMessage) {
                logger.log(<span class="predefined-type">Level</span>.INFO,
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">MESSAGE BEAN: Message received: {0}</span><span class="delimiter">&quot;</span></span>,
                        inMessage.getBody(<span class="predefined-type">String</span>.class));
            } <span class="keyword">else</span> {
                logger.log(<span class="predefined-type">Level</span>.WARNING,
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">Message of wrong type: {0}</span><span class="delimiter">&quot;</span></span>,
                        inMessage.getClass().getName());
            }
        } <span class="keyword">catch</span> (JMSException e) {
            logger.log(<span class="predefined-type">Level</span>.SEVERE,
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">SimpleMessageBean.onMessage: JMSException: {0}</span><span class="delimiter">&quot;</span></span>,
                    e.toString());
            mdc.setRollbackOnly();
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If Jakarta Messaging is integrated with the application server using a resource adapter, the Messaging resource adapter handles these tasks for the enterprise bean container.</p>
</div>
<div class="paragraph">
<p>The bean class commonly injects a <code>MessageDrivenContext</code> resource, which provides some additional methods you can use for transaction management (<code>setRollbackOnly</code>, for example):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    <span class="annotation">@Resource</span>
    <span class="directive">private</span> MessageDrivenContext mdc;</code></pre>
</div>
</div>
<div class="paragraph">
<p>A message-driven bean never has a local or remote interface.
Instead, it has only a bean class.</p>
</div>
<div class="paragraph">
<p>A message-driven bean is similar in some ways to a stateless session bean: Its instances are relatively short-lived and retain no state for a specific client.
The instance variables of the message-driven bean instance can contain some state across the handling of client messages: for example, an open database connection, or an object reference to an enterprise bean object.</p>
</div>
<div class="paragraph">
<p>Like a stateless session bean, a message-driven bean can have many interchangeable instances running at the same time.
The container can pool these instances to allow streams of messages to be processed concurrently.
The container attempts to deliver messages in chronological order when that would not impair the concurrency of message processing, but no guarantees are made as to the exact order in which messages are delivered to the instances of the message-driven bean class.
If message order is essential to your application, you may want to configure your application server to use just one instance of the message-driven bean.</p>
</div>
<div class="paragraph">
<p>For details on the lifecycle of a message-driven bean, see <a href="#the-lifecycle-of-a-message-driven-bean">The Lifecycle of a Message-Driven Bean</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="managing-jakarta-transactions"><a class="anchor" href="#managing-jakarta-transactions"></a>Managing Jakarta Transactions</h4>
<div class="paragraph">
<p>Jakarta EE application clients and Java SE clients use JMS local transactions (described in <a href="#using-jakarta-messaging-local-transactions">Using Jakarta Messaging Local Transactions</a>), which allow the grouping of sends and receives within a specific Messaging session.
Jakarta EE applications that run in the web or enterprise bean container commonly use Jakarta Transactions to ensure the integrity of accesses to external resources.
The key difference between a Jakarta transaction and a Jakarta Messaging local transaction is that a Jakarta transaction is controlled by the application server&#8217;s transaction managers.
Jakarta transactions may be distributed, which means that they can encompass multiple resources in the same transaction, such as a Messaging provider and a database.</p>
</div>
<div class="paragraph">
<p>For example, distributed transactions allow multiple applications to perform atomic updates on the same database, and they allow a single application to perform atomic updates on multiple databases.</p>
</div>
<div class="paragraph">
<p>In a Jakarta EE application that uses Jakarta Messaging, you can use transactions to combine message sends or receives with database updates and other resource manager operations.
You can access resources from multiple application components within a single transaction.
For example, a servlet can start a transaction, access multiple databases, invoke an enterprise bean that sends a Jakarta Messaging message, invoke another enterprise bean that modifies an EIS system using the Connectors, and finally commit the transaction.
Your application cannot, however, both send a Jakarta Messaging message and receive a reply to it within the same transaction.</p>
</div>
<div class="paragraph">
<p>Jakarta Transactions within the enterprise bean and web containers can be either of two kinds.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Container-managed transactions: The container controls the integrity of your transactions without your having to call <code>commit</code> or <code>rollback</code>.
Container-managed transactions are easier to use than bean-managed transactions.
You can specify appropriate transaction attributes for your enterprise bean methods.</p>
<div class="paragraph">
<p>Use the <code>Required</code> transaction attribute (the default) to ensure that a method is always part of a transaction.
If a transaction is in progress when the method is called, the method will be part of that transaction; if not, a new transaction will be started before the method is called and will be committed when the method returns.
See <a href="#transaction-attributes">Transaction Attributes</a> for more information.</p>
</div>
</li>
<li>
<p>Bean-managed transactions: You can use these in conjunction with the <code>jakarta.transaction.UserTransaction</code> interface, which provides its own <code>commit</code> and <code>rollback</code> methods you can use to delimit transaction boundaries.
Bean-managed transactions are recommended only for those who are experienced in programming transactions.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can use either container-managed transactions or bean-managed transactions with message-driven beans.
To ensure that all messages are received and handled within the context of a transaction, use container-managed transactions and use the <code>Required</code> transaction attribute (the default) for the <code>onMessage</code> method.</p>
</div>
<div class="paragraph">
<p>When you use container-managed transactions, you can call the following <code>MessageDrivenContext</code> methods.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>setRollbackOnly</code>: Use this method for error handling.
If an exception occurs, <code>setRollbackOnly</code> marks the current transaction so that the only possible outcome of the transaction is a rollback.</p>
</li>
<li>
<p><code>getRollbackOnly</code>: Use this method to test whether the current transaction has been marked for rollback.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you use bean-managed transactions, the delivery of a message to the <code>onMessage</code> method takes place outside the Jakarta transaction context.
The transaction begins when you call the <code>UserTransaction.begin</code> method within the <code>onMessage</code> method, and it ends when you call <code>UserTransaction.commit</code> or <code>UserTransaction.rollback</code>.
Any call to the <code>Connection.createSession</code> method must take place within the transaction.</p>
</div>
<div class="paragraph">
<p>Using bean-managed transactions allows you to process the message by using more than one transaction or to have some parts of the message processing take place outside a transaction context.
However, if you use container-managed transactions, the message is received by the MDB and processed by the <code>onMessage</code> method within the same transaction.
It is not possible to achieve this behavior with bean-managed transactions.</p>
</div>
<div class="paragraph">
<p>When you create a <code>JMSContext</code> in a Jakarta transaction (in the web or enterprise bean container), the container ignores any arguments you specify, because it manages all transactional properties.
When you create a <code>JMSContext</code> in the web or enterprise bean container and there is no Jakarta transaction, the value (if any) passed to the <code>createContext</code> method should be <code>JMSContext.AUTO_ACKNOWLEDGE</code> or <code>JMSContext.DUPS_OK_ACKNOWLEDGE</code>.</p>
</div>
<div class="paragraph">
<p>When you use container-managed transactions, you normally use the <code>Required</code> transaction attribute (the default) for your enterprise bean&#8217;s business methods.</p>
</div>
<div class="paragraph">
<p>You do not specify the activation configuration property <code>acknowledgeMode</code> when you create a message-driven bean that uses container-managed transactions.
The container acknowledges the message automatically when it commits the transaction.</p>
</div>
<div class="paragraph">
<p>If a message-driven bean uses bean-managed transactions, the message receipt cannot be part of the bean-managed transaction.
You can set the activation configuration property <code>acknowledgeMode</code> to <code>Auto-acknowledge</code> or <code>Dups-ok-acknowledge</code> to specify how you want the message received by the message-driven bean to be acknowledged.</p>
</div>
<div class="paragraph">
<p>If the <code>onMessage</code> method throws a <code>RuntimeException</code>, the container does not acknowledge processing the message.
In that case, the Messaging provider will redeliver the unacknowledged message in the future.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="further-information-about-jakarta-messaging"><a class="anchor" href="#further-information-about-jakarta-messaging"></a>Further Information about Jakarta Messaging</h3>
<div class="paragraph">
<p>For more information about Jakarta Messaging, see</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Jakarta Messaging website:<br>
<a href="https://projects.eclipse.org/projects/ee4j.jms" class="bare" target="_blank" rel="noopener">https://projects.eclipse.org/projects/ee4j.jms</a></p>
</li>
<li>
<p>Jakarta Messaging specification, version 3.0, available from:<br>
<a href="https://jakarta.ee/specifications/messaging/3.0/" class="bare" target="_blank" rel="noopener">https://jakarta.ee/specifications/messaging/3.0/</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="jakarta-messaging-examples"><a class="anchor" href="#jakarta-messaging-examples"></a>Chapter 49. Jakarta Messaging Examples</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter provides examples that show how to use Jakarta Messaging in various kinds of Jakarta EE applications.</p>
</div>
<div class="sect2">
<h3 id="building-and-running-jakarta-messaging-examples"><a class="anchor" href="#building-and-running-jakarta-messaging-examples"></a>Building and Running Jakarta Messaging Examples</h3>
<div class="paragraph">
<p>The examples are in the <code><em>tut-install</em>/examples/jms/</code> directory.</p>
</div>
<div class="paragraph">
<p>To build and run each example:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Use NetBeans IDE or Maven to compile, package, and in some cases deploy the example.</p>
</li>
<li>
<p>Use NetBeans IDE, Maven, or the <code>appclient</code> command to run the application client, or use the browser to run the web application examples.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Before you deploy or run the examples, you need to create resources for them.
Some examples have a <code>glassfish-resources.xml</code> file that is used to create resources for that example and others.
You can use the <code>asadmin</code> command to create the resources.</p>
</div>
<div class="paragraph">
<p>To use the <code>asadmin</code> and <code>appclient</code> commands, you need to put the GlassFish Server <code>bin</code> directories in your command path, as described in <a href="#glassfish-server-installation-tips">GlassFish Server Installation Tips</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="overview-of-the-jakarta-messaging-examples"><a class="anchor" href="#overview-of-the-jakarta-messaging-examples"></a>Overview of the Jakarta Messaging Examples</h3>
<div class="paragraph">
<p>The following tables list the examples used in this chapter, describe what they do, and link to the section that describes them fully.
The example directory for each example is relative to the <code><em>tut-install</em>/examples/jms/</code> directory.</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 80%;">
<caption class="title">Table 49-1 Jakarta Messaging Examples That Show the Use of Jakarta EE Application Clients</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Example Directory</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>simple/producer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Using an application client to send messages; see <a href="#sending-messages">Sending Messages</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>simple/synchconsumer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Using an application client to receive messages synchronously; see <a href="#receiving-messages-synchronously">Receiving Messages Synchronously</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>simple/asynchconsumer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Using an application client to receive messages asynchronously; see <a href="#using-a-message-listener-for-asynchronous-message-delivery">Using a Message Listener for Asynchronous Message Delivery</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>simple/messagebrowser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Using an application client to use a <code>QueueBrowser</code> to browse a queue; see <a href="#browsing-messages-on-a-queue">Browsing Messages on a Queue</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>simple/clientackconsumer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Using an application client to acknowledge messages received synchronously; see <a href="#acknowledging-messages">Acknowledging Messages</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>durablesubscriptionexample</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Using an application client to create a durable subscription on a topic; see <a href="#using-durable-subscriptions">Using Durable Subscriptions</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>transactedexample</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Using an application client to send and receive messages in local transactions (also uses request-reply messaging); see <a href="#using-local-transactions">Using Local Transactions</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>shared/sharedconsumer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Using an application client to create shared nondurable topic subscriptions; see <a href="#using-shared-nondurable-subscriptions">Using Shared Nondurable Subscriptions</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>shared/shareddurableconsumer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Using an application client to create shared durable topic subscriptions; see <a href="#using-shared-durable-subscriptions">Using Shared Durable Subscriptions</a></p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all" style="width: 80%;">
<caption class="title">Table 49-2 Jakarta Messaging Examples That Show the Use of Jakarta EE Web and Enterprise Bean Components</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Example Directory</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>websimplemessage</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Using managed beans to send messages and to receive messages synchronously; see <a href="#sending-and-receiving-messages-using-a-simple-web-application">Sending and Receiving Messages Using a Simple Web Application</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>simplemessage</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Using an application client to send messages, and using a message-driven bean to receive messages asynchronously; see <a href="#receiving-messages-asynchronously-using-a-message-driven-bean">Receiving Messages Asynchronously Using a Message-Driven Bean</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>clientsessionmdb</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Using a session bean to send messages, and using a message-driven bean to receive messages; see <a href="#sending-messages-from-a-session-bean-to-an-mdb">Sending Messages from a Session Bean to an MDB</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>clientmdbentity</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Using an application client, two message-driven beans, and JPA persistence to create a simple HR application; see <a href="#using-an-entity-to-join-messages-from-two-mdbs">Using an Entity to Join Messages from Two MDBs</a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="writing-simple-jakarta-messaging-applications"><a class="anchor" href="#writing-simple-jakarta-messaging-applications"></a>Writing Simple Jakarta Messaging Applications</h3>
<div class="paragraph">
<p>This section shows how to create, package, and run simple Messaging clients that are packaged as application clients.</p>
</div>
<div class="sect3">
<h4 id="overview-of-writing-simple-jakarta-messaging-application"><a class="anchor" href="#overview-of-writing-simple-jakarta-messaging-application"></a>Overview of Writing Simple Jakarta Messaging Application</h4>
<div class="paragraph">
<p>The clients demonstrate the basic tasks a Jakarta Messaging application must perform:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Creating a <code>JMSContext</code></p>
</li>
<li>
<p>Creating message producers and consumers</p>
</li>
<li>
<p>Sending and receiving messages</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each example uses two clients: one that sends messages and one that receives them.
You can run the clients in two terminal windows.</p>
</div>
<div class="paragraph">
<p>When you write a Messaging client to run in an enterprise bean application, you use many of the same methods in much the same sequence as for an application client.
However, there are some significant differences.
<a href="#using-jakarta-messaging-in-jakarta-ee-applications">Using Jakarta Messaging in Jakarta EE Applications</a> describes these differences, and this chapter provides examples that illustrate them.</p>
</div>
<div class="paragraph">
<p>The examples for this section are in the <code><em>tut-install</em>/examples/jms/simple/</code> directory, under the following subdirectories:</p>
</div>
<div class="paragraph">
<p><code>producer/</code><br>
<code>synchconsumer/</code><br>
<code>asynchconsumer/</code><br>
<code>messagebrowser/</code><br>
<code>clientackconsumer/</code><br></p>
</div>
<div class="paragraph">
<p>Before running the examples, you need to start GlassFish Server and create administered objects.</p>
</div>
</div>
<div class="sect3">
<h4 id="starting-the-jakarta-messaging-provider"><a class="anchor" href="#starting-the-jakarta-messaging-provider"></a>Starting the Jakarta Messaging Provider</h4>
<div class="paragraph">
<p>When you use GlassFish Server, your Messaging provider is GlassFish Server.
Start the server as described in <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="creating-jakarta-messaging-administered-objects"><a class="anchor" href="#creating-jakarta-messaging-administered-objects"></a>Creating Jakarta Messaging Administered Objects</h4>
<div class="paragraph">
<p>This example uses the following Jakarta Messaging administered objects:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A connection factory</p>
</li>
<li>
<p>Two destination resources: a topic and a queue</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Before you run the applications, you can use the <code>asadmin add-resources</code> command to create needed Messaging resources, specifying as the argument a file named <code>glassfish-resources.xml</code>.
This file can be created in any project using NetBeans IDE, although you can also create it by hand.
A file for the needed resources is present in the <code>jms/simple/producer/src/main/setup/</code> directory.</p>
</div>
<div class="paragraph">
<p>The Jakarta Messaging examples use a connection factory with the logical JNDI lookup name <code>java:comp/DefaultJMSConnectionFactory</code>, which is preconfigured in GlassFish Server.</p>
</div>
<div class="paragraph">
<p>You can also use the <code>asadmin create-jms-resource</code> command to create resources, the <code>asadmin list-jms-resources</code> command to display their names, and the <code>asadmin delete-jms-resource</code> command to remove them.</p>
</div>
<div class="sect4">
<h5 id="to-create-resources-for-the-simple-examples"><a class="anchor" href="#to-create-resources-for-the-simple-examples"></a>To Create Resources for the Simple Examples</h5>
<div class="paragraph">
<p>A <code>glassfish-resources.xml</code> file in one of the Maven projects can create all the resources needed for the simple examples.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>In a command window, go to the <code>Producer</code> example.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">cd tut-install/jms/simple/producer</code></pre>
</div>
</div>
</li>
<li>
<p>Create the resources using the <code>asadmin add-resources</code> command:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">asadmin add-resources src/main/setup/glassfish-resources.xml</code></pre>
</div>
</div>
</li>
<li>
<p>Verify the creation of the resources:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">asadmin list-jms-resources</code></pre>
</div>
</div>
<div class="paragraph">
<p>The command lists the two destinations and connection factory specified in the <code>glassfish-resources.xml</code> file in addition to the platform default connection factory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">jms/MyQueue
jms/MyTopic
jms/__defaultConnectionFactory
Command list-jms-resources executed successfully.</code></pre>
</div>
</div>
<div class="paragraph">
<p>In GlassFish Server, the Jakarta EE <code>java:comp/DefaultJMSConnectionFactory</code> resource is mapped to a connection factory named <code>jms/__defaultConnectionFactory</code>.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="building-all-the-simple-examples"><a class="anchor" href="#building-all-the-simple-examples"></a>Building All the Simple Examples</h4>
<div class="paragraph">
<p>To run the simple examples using GlassFish Server, package each example in an application client JAR file.
The application client JAR file requires a manifest file, located in the <code>src/main/java/META-INF/</code> directory for each example, along with the <code>.class</code> file.</p>
</div>
<div class="paragraph">
<p>The <code>pom.xml</code> file for each example specifies a plugin that creates an application client JAR file.
You can build the examples using either NetBeans IDE or Maven.</p>
</div>
<div class="sect4">
<h5 id="to-build-all-the-simple-examples-using-netbeans-ide"><a class="anchor" href="#to-build-all-the-simple-examples-using-netbeans-ide"></a>To Build All the Simple Examples Using NetBeans IDE</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>From the <strong>File</strong> menu, choose <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the <strong>Open Project</strong> dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/jms</pre>
</div>
</div>
</li>
<li>
<p>Expand the <code>jms</code> node and select the <code>simple</code> folder.</p>
</li>
<li>
<p>Click <strong>Open Project</strong> to open all the simple examples.</p>
</li>
<li>
<p>In the <strong>Projects</strong> tab, right-click the <code>simple</code> project and select <strong>Build</strong> to build all the examples.</p>
<div class="paragraph">
<p>This command places the application client JAR files in the <code>target</code> directories for the examples.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-build-all-the-simple-examples-using-maven"><a class="anchor" href="#to-build-all-the-simple-examples-using-maven"></a>To Build All the Simple Examples Using Maven</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In a terminal window, go to the <code>simple</code> directory:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">cd tut-install/jms/simple/</code></pre>
</div>
</div>
</li>
<li>
<p>Enter the following command to build all the projects:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">mvn install</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command places the application client JAR files in the <code>target</code> directories for the examples.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sending-messages-2"><a class="anchor" href="#sending-messages-2"></a>Sending Messages</h4>
<div class="paragraph">
<p>This section describes how to use a client to send messages.
The <code>Producer.java</code> client will send messages in all of these examples.</p>
</div>
<div class="sect4">
<h5 id="general-steps-performed-in-the-example"><a class="anchor" href="#general-steps-performed-in-the-example"></a>General Steps Performed in the Example</h5>
<div class="paragraph">
<p>General steps this example performs are as follows.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Inject resources for the administered objects used by the example.</p>
</li>
<li>
<p>Accept and verify command-line arguments.
You can use this example to send any number of messages to either a queue or a topic, so you specify the destination type and the number of messages on the command line when you run the program.</p>
</li>
<li>
<p>Create a <code>JMSContext</code>, then send the specified number of text messages in the form of strings, as described in <a href="#message-bodies">Message Bodies</a>.</p>
</li>
<li>
<p>Send a final message of type <code>Message</code> to indicate that the consumer should expect no more messages.</p>
</li>
<li>
<p>Catch any exceptions.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="the-producer-java-client"><a class="anchor" href="#the-producer-java-client"></a>The Producer.java Client</h5>
<div class="paragraph">
<p>The sending client, <code>Producer.java</code>, performs the following steps.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Injects resources for a connection factory, queue, and topic:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Resource</span>(lookup = <span class="string"><span class="delimiter">&quot;</span><span class="content">java:comp/DefaultJMSConnectionFactory</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> <span class="directive">static</span> ConnectionFactory connectionFactory;
<span class="annotation">@Resource</span>(lookup = <span class="string"><span class="delimiter">&quot;</span><span class="content">jms/MyQueue</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> <span class="directive">static</span> <span class="predefined-type">Queue</span> queue;
<span class="annotation">@Resource</span>(lookup = <span class="string"><span class="delimiter">&quot;</span><span class="content">jms/MyTopic</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> <span class="directive">static</span> Topic topic;</code></pre>
</div>
</div>
</li>
<li>
<p>Retrieves and verifies command-line arguments that specify the destination type and the number of arguments:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">final</span> <span class="type">int</span> NUM_MSGS;
<span class="predefined-type">String</span> destType = args[<span class="integer">0</span>];
<span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Destination type is </span><span class="delimiter">&quot;</span></span> + destType);
<span class="keyword">if</span> ( ! ( destType.equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">queue</span><span class="delimiter">&quot;</span></span>) || destType.equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">topic</span><span class="delimiter">&quot;</span></span>) ) ) {
    <span class="predefined-type">System</span>.err.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Argument must be </span><span class="char">\&quot;</span><span class="content">queue</span><span class="char">\&quot;</span><span class="content"> or </span><span class="delimiter">&quot;</span></span> + <span class="string"><span class="delimiter">&quot;</span><span class="char">\&quot;</span><span class="content">topic</span><span class="char">\&quot;</span><span class="delimiter">&quot;</span></span>);
    <span class="predefined-type">System</span>.exit(<span class="integer">1</span>);
}
<span class="keyword">if</span> (args.length == <span class="integer">2</span>){
    NUM_MSGS = (<span class="keyword">new</span> <span class="predefined-type">Integer</span>(args[<span class="integer">1</span>])).intValue();
} <span class="keyword">else</span> {
    NUM_MSGS = <span class="integer">1</span>;
}</code></pre>
</div>
</div>
</li>
<li>
<p>Assigns either the queue or the topic to a destination object, based on the specified destination type:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Destination</span> dest = <span class="predefined-constant">null</span>;
<span class="keyword">try</span> {
    <span class="keyword">if</span> (destType.equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">queue</span><span class="delimiter">&quot;</span></span>)) {
        dest = (<span class="predefined-type">Destination</span>) queue;
    } <span class="keyword">else</span> {
        dest = (<span class="predefined-type">Destination</span>) topic;
    }
} <span class="keyword">catch</span> (<span class="exception">Exception</span> e) {
    <span class="predefined-type">System</span>.err.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Error setting destination: </span><span class="delimiter">&quot;</span></span> + e.toString());
    <span class="predefined-type">System</span>.exit(<span class="integer">1</span>);
}</code></pre>
</div>
</div>
</li>
<li>
<p>Within a <code>try-with-resources</code> block, creates a <code>JMSContext</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">try</span> (JMSContext context = connectionFactory.createContext();) { ... }</code></pre>
</div>
</div>
</li>
<li>
<p>Sets the message count to zero, then creates a <code>JMSProducer</code> and sends one or more messages to the destination and increments the count.
Messages in the form of strings are of the <code>TextMessage</code> message type:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    <span class="type">int</span> count = <span class="integer">0</span>;
    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="integer">0</span>; i &lt; NUM_MSGS; i++) {
        <span class="predefined-type">String</span> message = <span class="string"><span class="delimiter">&quot;</span><span class="content">This is message </span><span class="delimiter">&quot;</span></span> + (i + <span class="integer">1</span>)
                + <span class="string"><span class="delimiter">&quot;</span><span class="content"> from producer</span><span class="delimiter">&quot;</span></span>;
        <span class="comment">// Comment out the following line to send many messages</span>
        <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Sending message: </span><span class="delimiter">&quot;</span></span> + message);
        context.createProducer().send(dest, message);
        count += <span class="integer">1</span>;
    }
    <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Text messages sent: </span><span class="delimiter">&quot;</span></span> + count);</code></pre>
</div>
</div>
</li>
<li>
<p>Sends an empty control message to indicate the end of the message stream:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    context.createProducer().send(dest, context.createMessage());</code></pre>
</div>
</div>
<div class="paragraph">
<p>Sending an empty message of no specified type is a convenient way for an application to indicate to the consumer that the final message has arrived.</p>
</div>
</li>
<li>
<p>Catches and handles any exceptions.
The end of the <code>try-with-resources</code> block automatically causes the <code>JMSContext</code> to be closed:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">} <span class="keyword">catch</span> (<span class="exception">Exception</span> e) {
    <span class="predefined-type">System</span>.err.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Exception occurred: </span><span class="delimiter">&quot;</span></span> + e.toString());
    <span class="predefined-type">System</span>.exit(<span class="integer">1</span>);
}
<span class="predefined-type">System</span>.exit(<span class="integer">0</span>);</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-run-the-producer-client"><a class="anchor" href="#to-run-the-producer-client"></a>To Run the Producer Client</h5>
<div class="paragraph">
<p>You can run the client using the <code>appclient</code> command.
The <code>Producer</code> client takes one or two command-line arguments: a destination type and, optionally, a number of messages.
If you do not specify a number of messages, the client sends one message.</p>
</div>
<div class="paragraph">
<p>You will use the client to send three messages to a queue.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>) and that you have created resources and built the simple Jakarta Messaging examples (see <a href="#creating-jakarta-messaging-administered-objects">Creating Jakarta Messaging Administered Objects</a> and <a href="#building-all-the-simple-examples">Building All the Simple Examples</a>).</p>
</li>
<li>
<p>In a terminal window, go to the <code>producer</code> directory:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">cd producer</code></pre>
</div>
</div>
</li>
<li>
<p>Run the <code>Producer</code> program, sending three messages to the queue:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">appclient -client target/producer.jar queue 3</code></pre>
</div>
</div>
<div class="paragraph">
<p>The output of the program looks like this (along with some additional output):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">Destination type is queue
Sending message: This is message 1 from producer
Sending message: This is message 2 from producer
Sending message: This is message 3 from producer
Text messages sent: 3</code></pre>
</div>
</div>
<div class="paragraph">
<p>The messages are now in the queue, waiting to be received.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When you run an application client, the command may take a long time to complete.
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="receiving-messages-synchronously"><a class="anchor" href="#receiving-messages-synchronously"></a>Receiving Messages Synchronously</h4>
<div class="paragraph">
<p>This section describes the receiving client, which uses the <code>receive</code> method to consume messages synchronously.
This section then explains how to run the clients using GlassFish Server.</p>
</div>
<div class="sect4">
<h5 id="the-synchconsumer-java-client"><a class="anchor" href="#the-synchconsumer-java-client"></a>The SynchConsumer.java Client</h5>
<div class="paragraph">
<p>The receiving client, <code>SynchConsumer.java</code>, performs the following steps.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Injects resources for a connection factory, queue, and topic.</p>
</li>
<li>
<p>Assigns either the queue or the topic to a destination object, based on the specified destination type.</p>
</li>
<li>
<p>Within a <code>try-with-resources</code> block, creates a <code>JMSContext</code>.</p>
</li>
<li>
<p>Creates a <code>JMSConsumer</code>, starting message delivery:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">consumer = context.createConsumer(dest);</code></pre>
</div>
</div>
</li>
<li>
<p>Receives the messages sent to the destination until the end-of-message-stream control message is received:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">int</span> count = <span class="integer">0</span>;
<span class="keyword">while</span> (<span class="predefined-constant">true</span>) {
    Message m = consumer.receive(<span class="integer">1000</span>);
    <span class="keyword">if</span> (m != <span class="predefined-constant">null</span>) {
        <span class="keyword">if</span> (m <span class="keyword">instanceof</span> TextMessage) {
            <span class="predefined-type">System</span>.out.println(
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">Reading message: </span><span class="delimiter">&quot;</span></span> + m.getBody(<span class="predefined-type">String</span>.class));
            count += <span class="integer">1</span>;
        } <span class="keyword">else</span> {
            <span class="keyword">break</span>;
        }
    }
}
<span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Messages received: </span><span class="delimiter">&quot;</span></span> + count);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Because the control message is not a <code>TextMessage</code>, the receiving client terminates the <code>while</code> loop and stops receiving messages after the control message arrives.</p>
</div>
</li>
<li>
<p>Catches and handles any exceptions.
The end of the <code>try-with-resources</code> block automatically causes the <code>JMSContext</code> to be closed.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The <code>SynchConsumer</code> client uses an indefinite <code>while</code> loop to receive messages, calling <code>receive</code> with a timeout argument.</p>
</div>
</div>
<div class="sect4">
<h5 id="to-run-the-synchconsumer-and-producer-clients"><a class="anchor" href="#to-run-the-synchconsumer-and-producer-clients"></a>To Run the SynchConsumer and Producer Clients</h5>
<div class="paragraph">
<p>You can run the client using the <code>appclient</code> command.
The <code>SynchConsumer</code> client takes one command-line argument, the destination type.</p>
</div>
<div class="paragraph">
<p>These steps show how to receive and send messages synchronously using both a queue and a topic.
The steps assume you already ran the <code>Producer</code> client and have three messages waiting in the queue.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the same terminal window where you ran <code>Producer</code>, go to the <code>synchconsumer</code> directory:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">cd ../synchconsumer</code></pre>
</div>
</div>
</li>
<li>
<p>Run the <code>SynchConsumer</code> client, specifying the queue:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">appclient -client target/synchconsumer.jar queue</code></pre>
</div>
</div>
<div class="paragraph">
<p>The output of the client looks like this (along with some additional output):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">Destination type is queue
Reading message: This is message 1 from producer
Reading message: This is message 2 from producer
Reading message: This is message 3 from producer
Messages received: 3</code></pre>
</div>
</div>
</li>
<li>
<p>Now try running the clients in the opposite order.
Run the <code>SynchConsumer</code> client:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">appclient -client target/synchconsumer.jar queue</code></pre>
</div>
</div>
<div class="paragraph">
<p>The client displays the destination type and then waits for messages.</p>
</div>
</li>
<li>
<p>Open a new terminal window and run the <code>Producer</code> client:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">cd tut-install/jms/simple/producer
appclient -client target/producer.jar queue 3</code></pre>
</div>
</div>
<div class="paragraph">
<p>When the messages have been sent, the <code>SynchConsumer</code> client receives them and exits.</p>
</div>
</li>
<li>
<p>Now run the <code>Producer</code> client using a topic instead of a queue:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">appclient -client target/producer.jar topic 3</code></pre>
</div>
</div>
<div class="paragraph">
<p>The output of the client looks like this (along with some additional output):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">Destination type is topic
Sending message: This is message 1 from producer
Sending message: This is message 2 from producer
Sending message: This is message 3 from producer
Text messages sent: 3</code></pre>
</div>
</div>
</li>
<li>
<p>Now, in the other terminal window, run the <code>SynchConsumer</code> client using the topic:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">appclient -client target/synchconsumer.jar topic</code></pre>
</div>
</div>
<div class="paragraph">
<p>The result, however, is different.
Because you are using a subscription on a topic, messages that were sent before you created the subscription on the topic will not be added to the subscription and delivered to the consumer.
(See <a href="#publishsubscribe-messaging-style">Publish/Subscribe Messaging Style</a> and <a href="#consuming-messages-from-topics">Consuming Messages from Topics</a> for details.)
Instead of receiving the messages, the client waits for messages to arrive.</p>
</div>
</li>
<li>
<p>Leave the <code>SynchConsumer</code> client running and run the <code>Producer</code> client again:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">appclient -client target/producer.jar topic 3</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now the <code>SynchConsumer</code> client receives the messages:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">Destination type is topic
Reading message: This is message 1 from producer
Reading message: This is message 2 from producer
Reading message: This is message 3 from producer
Messages received: 3</code></pre>
</div>
</div>
<div class="paragraph">
<p>Because these messages were sent after the consumer was started, the client receives them.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="using-a-message-listener-for-asynchronous-message-delivery"><a class="anchor" href="#using-a-message-listener-for-asynchronous-message-delivery"></a>Using a Message Listener for Asynchronous Message Delivery</h4>
<div class="paragraph">
<p>This section describes the receiving clients in an example that uses a message listener for asynchronous message delivery.
This section then explains how to compile and run the clients using GlassFish Server.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In the Jakarta EE platform, message listeners can be used only in application clients, as in this example.
To allow asynchronous message delivery in a web or enterprise bean application, you use a message-driven bean, shown in later examples in this chapter.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="writing-the-asynchconsumer-java-and-textlistener-java-clients"><a class="anchor" href="#writing-the-asynchconsumer-java-and-textlistener-java-clients"></a>Writing the AsynchConsumer.java and TextListener.java Clients</h5>
<div class="paragraph">
<p>The sending client is <code>Producer.java</code>, the same client used in <a href="#receiving-messages-synchronously">Receiving Messages Synchronously</a>.</p>
</div>
<div class="paragraph">
<p>An asynchronous consumer normally runs indefinitely.
This one runs until the user types the character <code>q</code> or <code>Q</code> to stop the client.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The client, <code>AsynchConsumer.java</code>, performs the following steps.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Injects resources for a connection factory, queue, and topic.</p>
</li>
<li>
<p>Assigns either the queue or the topic to a destination object, based on the specified destination type.</p>
</li>
<li>
<p>In a <code>try-with-resources</code> block, creates a <code>JMSContext</code>.</p>
</li>
<li>
<p>Creates a <code>JMSConsumer</code>.</p>
</li>
<li>
<p>Creates an instance of the <code>TextListener</code> class and registers it as the message listener for the <code>JMSConsumer</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">listener = <span class="keyword">new</span> <span class="predefined-type">TextListener</span>();
consumer.setMessageListener(listener);</code></pre>
</div>
</div>
</li>
<li>
<p>Listens for the messages sent to the destination, stopping when the user types the character <code>q</code> or <code>Q</code> (it uses a <code>java.io.InputStreamReader</code> to do this).</p>
</li>
<li>
<p>Catches and handles any exceptions.
The end of the <code>try-with-resources</code> block automatically causes the <code>JMSContext</code> to be closed, thus stopping delivery of messages to the message listener.</p>
</li>
</ol>
</div>
</li>
<li>
<p>The message listener, <code>TextListener.java</code>, follows these steps:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>When a message arrives, the <code>onMessage</code> method is called automatically.</p>
</li>
<li>
<p>If the message is a <code>TextMessage</code>, the <code>onMessage</code> method displays its content as a string value.
If the message is not a text message, it reports this fact:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">void</span> onMessage(Message m) {
    <span class="keyword">try</span> {
        <span class="keyword">if</span> (m <span class="keyword">instanceof</span> TextMessage) {
            <span class="predefined-type">System</span>.out.println(
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">Reading message: </span><span class="delimiter">&quot;</span></span> + m.getBody(<span class="predefined-type">String</span>.class));
        } <span class="keyword">else</span> {
             <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Message is not a TextMessage</span><span class="delimiter">&quot;</span></span>);
        }
    } <span class="keyword">catch</span> (JMSException | JMSRuntimeException e) {
        <span class="predefined-type">System</span>.err.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">JMSException in onMessage(): </span><span class="delimiter">&quot;</span></span> + e.toString());
    }
}</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>For this example, you will use the same connection factory and destinations you created in <a href="#to-create-resources-for-the-simple-examples">To Create Resources for the Simple Examples</a>.</p>
</div>
<div class="paragraph">
<p>The steps assume that you have already built and packaged all the examples using NetBeans IDE or Maven.</p>
</div>
</div>
<div class="sect4">
<h5 id="to-run-the-asynchconsumer-and-producer-clients"><a class="anchor" href="#to-run-the-asynchconsumer-and-producer-clients"></a>To Run the AsynchConsumer and Producer Clients</h5>
<div class="paragraph">
<p>You will need two terminal windows, as you did in <a href="#receiving-messages-synchronously">Receiving Messages Synchronously</a>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the terminal window where you ran the <code>SynchConsumer</code> client, go to the <code>asynchconsumer</code> example directory:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">cd tut-install/jms/simple/asynchconsumer</code></pre>
</div>
</div>
</li>
<li>
<p>Run the <code>AsynchConsumer</code> client, specifying the <code>topic</code> destination type:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">appclient -client target/asynchconsumer.jar topic</code></pre>
</div>
</div>
<div class="paragraph">
<p>The client displays the following lines (along with some additional output) and then waits for messages:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">Destination type is topic
To end program, enter Q or q, then &lt;return&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>In the terminal window where you ran the <code>Producer</code> client previously, run the client again, sending three messages:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">appclient -client target/producer.jar topic 3</code></pre>
</div>
</div>
<div class="paragraph">
<p>The output of the client looks like this (along with some additional output):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">Destination type is topic
Sending message: This is message 1 from producer
Sending message: This is message 2 from producer
Sending message: This is message 3 from producer
Text messages sent: 3</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the other window, the <code>AsynchConsumer</code> client displays the following (along with some additional output):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">Destination type is topic
To end program, enter Q or q, then &lt;return&gt;
Reading message: This is message 1 from producer
Reading message: This is message 2 from producer
Reading message: This is message 3 from producer
Message is not a TextMessage</code></pre>
</div>
</div>
<div class="paragraph">
<p>The last line appears because the client has received the non-text control message sent by the <code>Producer</code> client.</p>
</div>
</li>
<li>
<p>Enter <code>Q</code> or <code>q</code> and press Return to stop the <code>AsynchConsumer</code> client.</p>
</li>
<li>
<p>Now run the clients using a queue.</p>
<div class="paragraph">
<p>In this case, as with the synchronous example, you can run the <code>Producer</code> client first, because there is no timing dependency between the sender and receiver:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">appclient -client target/producer.jar queue 3</code></pre>
</div>
</div>
<div class="paragraph">
<p>The output of the client looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">Destination type is queue
Sending message: This is message 1 from producer
Sending message: This is message 2 from producer
Sending message: This is message 3 from producer
Text messages sent: 3</code></pre>
</div>
</div>
</li>
<li>
<p>In the other window, run the <code>AsynchConsumer</code> client:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">appclient -client target/asynchconsumer.jar queue</code></pre>
</div>
</div>
<div class="paragraph">
<p>The output of the client looks like this (along with some additional output):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">Destination type is queue
To end program, enter Q or q, then &lt;return&gt;
Reading message: This is message 1 from producer
Reading message: This is message 2 from producer
Reading message: This is message 3 from producer
Message is not a TextMessage</code></pre>
</div>
</div>
</li>
<li>
<p>Enter <code>Q</code> or <code>q</code> and press Return to stop the client.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="browsing-messages-on-a-queue"><a class="anchor" href="#browsing-messages-on-a-queue"></a>Browsing Messages on a Queue</h4>
<div class="paragraph">
<p>This section describes an example that creates a <code>QueueBrowser</code> object to examine messages on a queue, as described in <a href="#jakarta-messaging-queue-browsers">Jakarta Messaging Queue Browsers</a>.
This section then explains how to compile, package, and run the example using GlassFish Server.</p>
</div>
<div class="sect4">
<h5 id="the-messagebrowser-java-client"><a class="anchor" href="#the-messagebrowser-java-client"></a>The MessageBrowser.java Client</h5>
<div class="paragraph">
<p>To create a <code>QueueBrowser</code> for a queue, you call the <code>JMSContext.createBrowser</code> method with the queue as the argument.
You obtain the messages in the queue as an <code>Enumeration</code> object.
You can then iterate through the <code>Enumeration</code> object and display the contents of each message.</p>
</div>
<div class="paragraph">
<p>The <code>MessageBrowser.java</code> client performs the following steps.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Injects resources for a connection factory and a queue.</p>
</li>
<li>
<p>In a <code>try-with-resources</code> block, creates a <code>JMSContext</code>.</p>
</li>
<li>
<p>Creates a <code>QueueBrowser</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">QueueBrowser browser = context.createBrowser(queue);</code></pre>
</div>
</div>
</li>
<li>
<p>Retrieves the <code>Enumeration</code> that contains the messages:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Enumeration</span> msgs = browser.getEnumeration();</code></pre>
</div>
</div>
</li>
<li>
<p>Verifies that the <code>Enumeration</code> contains messages, then displays the contents of the messages:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">if</span> ( !msgs.hasMoreElements() ) {
    <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">No messages in queue</span><span class="delimiter">&quot;</span></span>);
} <span class="keyword">else</span> {
    <span class="keyword">while</span> (msgs.hasMoreElements()) {
        Message tempMsg = (Message)msgs.nextElement();
        <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Message: </span><span class="delimiter">&quot;</span></span> + tempMsg);
    }
}</code></pre>
</div>
</div>
</li>
<li>
<p>Catches and handles any exceptions.
The end of the <code>try-with-resources</code> block automatically causes the <code>JMSContext</code> to be closed.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Dumping the message contents to standard output retrieves the message body and properties in a format that depends on the implementation of the <code>toString</code> method.
In GlassFish Server, the message format looks something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">Text:   This is message 3 from producer
Class:                  com.sun.messaging.jmq.jmsclient.TextMessageImpl
getJMSMessageID():      ID:8-10.152.23.26(bf:27:4:e:e7:ec)-55645-1363100335526
getJMSTimestamp():      1129061034355
getJMSCorrelationID():  null
JMSReplyTo:             null
JMSDestination:         PhysicalQueue
getJMSDeliveryMode():   PERSISTENT
getJMSRedelivered():    false
getJMSType():           null
getJMSExpiration():     0
getJMSPriority():       4
Properties:             {JMSXDeliveryCount=0}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Instead of displaying the message contents this way, you can call some of the <code>Message</code> interface&#8217;s getter methods to retrieve the parts of the message you want to see.</p>
</div>
<div class="paragraph">
<p>For this example, you will use the connection factory and queue you created for <a href="#receiving-messages-synchronously">Receiving Messages Synchronously</a>.
It is assumed that you have already built and packaged all the examples.</p>
</div>
</div>
<div class="sect4">
<h5 id="to-run-the-queuebrowser-client"><a class="anchor" href="#to-run-the-queuebrowser-client"></a>To Run the QueueBrowser Client</h5>
<div class="paragraph">
<p>To run the <code>MessageBrowser</code> example using the <code>appclient</code> command, follow these steps.</p>
</div>
<div class="paragraph">
<p>You also need the <code>Producer</code> example to send the message to the queue, and one of the consumer clients to consume the messages after you inspect them.</p>
</div>
<div class="paragraph">
<p>To run the clients, you need two terminal windows.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In a terminal window, go to the <code>producer</code> directory:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">cd tut-install/examples/jms/simple/producer/</code></pre>
</div>
</div>
</li>
<li>
<p>Run the <code>Producer</code> client, sending one message to the queue, along with the non-text control message:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">appclient -client target/producer.jar queue</code></pre>
</div>
</div>
<div class="paragraph">
<p>The output of the client looks like this (along with some additional output):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">Destination type is queue
Sending message: This is message 1 from producer
Text messages sent: 1</code></pre>
</div>
</div>
</li>
<li>
<p>In another terminal window, go to the <code>messagebrowser</code> directory:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">cd tut-install/jms/simple/messagebrowser</code></pre>
</div>
</div>
</li>
<li>
<p>Run the <code>MessageBrowser</code> client using the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">appclient -client target/messagebrowser.jar</code></pre>
</div>
</div>
<div class="paragraph">
<p>The output of the client looks something like this (along with some additional output):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">Message:
Text:   This is message 1 from producer
Class:                  com.sun.messaging.jmq.jmsclient.TextMessageImpl
getJMSMessageID():      ID:9-10.152.23.26(bf:27:4:e:e7:ec)-55645-1363100335526
getJMSTimestamp():      1363100335526
getJMSCorrelationID():  null
JMSReplyTo:             null
JMSDestination:         PhysicalQueue
getJMSDeliveryMode():   PERSISTENT
getJMSRedelivered():    false
getJMSType():           null
getJMSExpiration():     0
getJMSPriority():       4
Properties:             {JMSXDeliveryCount=0}

Message:
Class:                  com.sun.messaging.jmq.jmsclient.MessageImpl
getJMSMessageID():      ID:10-10.152.23.26(bf:27:4:e:e7:ec)-55645-1363100335526
getJMSTimestamp():      1363100335526
getJMSCorrelationID():  null
JMSReplyTo:             null
JMSDestination:         PhysicalQueue
getJMSDeliveryMode():   PERSISTENT
getJMSRedelivered():    false
getJMSType():           null
getJMSExpiration():     0
getJMSPriority():       4
Properties:             {JMSXDeliveryCount=0}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first message is the <code>TextMessage</code>, and the second is the non-text control message.</p>
</div>
</li>
<li>
<p>Go to the <code>synchconsumer</code> directory.</p>
</li>
<li>
<p>Run the <code>SynchConsumer</code> client to consume the messages:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">appclient -client target/synchconsumer.jar queue</code></pre>
</div>
</div>
<div class="paragraph">
<p>The output of the client looks like this (along with some additional output):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">Destination type is queue
Reading message: This is message 1 from producer
Messages received: 1</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="running-multiple-consumers-on-the-same-destination"><a class="anchor" href="#running-multiple-consumers-on-the-same-destination"></a>Running Multiple Consumers on the Same Destination</h4>
<div class="paragraph">
<p>To illustrate further the way point-to-point and publish/subscribe messaging works, you can use the <code>Producer</code> and <code>SynchConsumer</code> examples to send messages that are then consumed by two clients running simultaneously.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open three command windows.
In one, go to the <code>producer</code> directory.
In the other two, go to the <code>synchconsumer</code> directory.</p>
</li>
<li>
<p>In each of the <code>synchconsumer</code> windows, start running the client, receiving messages from a queue:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">appclient -client target/synchconsumer.jar queue</code></pre>
</div>
</div>
<div class="paragraph">
<p>Wait until you see the "Destination type is queue" message in both windows.</p>
</div>
</li>
<li>
<p>In the <code>producer</code> window, run the client, sending 20 or so messages to the queue:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">appclient -client target/producer.jar queue 20</code></pre>
</div>
</div>
</li>
<li>
<p>Look at the output in the <code>synchconsumer</code> windows.
In point-to-point messaging, each message can have only one consumer.
Therefore, each of the clients receives some of the messages.
One of the clients receives the non-text control message, reports the number of messages received, and exits.</p>
</li>
<li>
<p>In the window of the client that did not receive the non-text control message, enter Control-C to exit the program.</p>
</li>
<li>
<p>Next, run the <code>synchconsumer</code> clients using a topic.
In each window, run the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">appclient -client target/synchconsumer.jar topic</code></pre>
</div>
</div>
<div class="paragraph">
<p>Wait until you see the "Destination type is topic" message in both windows.</p>
</div>
</li>
<li>
<p>In the <code>producer</code> window, run the client, sending 20 or so messages to the topic:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">appclient -client target/producer.jar topic 20</code></pre>
</div>
</div>
</li>
<li>
<p>Again, look at the output in the <code>synchconsumer</code> windows.
In publish/subscribe messaging, a copy of every message is sent to each subscription on the topic.
Therefore, each of the clients receives all 20 text messages as well as the non-text control message.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="acknowledging-messages"><a class="anchor" href="#acknowledging-messages"></a>Acknowledging Messages</h4>
<div class="paragraph">
<p>Jakarta Messaging provides two alternative ways for a consuming client to ensure that a message is not acknowledged until the application has finished processing the message:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Using a synchronous consumer in a <code>JMSContext</code> that has been configured to use the <code>CLIENT_ACKNOWLEDGE</code> setting</p>
</li>
<li>
<p>Using a message listener for asynchronous message delivery in a <code>JMSContext</code> that has been configured to use the default <code>AUTO_ACKNOWLEDGE</code> setting</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In the Jakarta EE platform, <code>CLIENT_ACKNOWLEDGE</code> sessions can be used only in application clients, as in this example.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>clientackconsumer</code> example demonstrates the first alternative, in which a synchronous consumer uses client acknowledgment.
The <code>asynchconsumer</code> example described in <a href="#using-a-message-listener-for-asynchronous-message-delivery">Using a Message Listener for Asynchronous Message Delivery</a> demonstrates the second alternative.</p>
</div>
<div class="paragraph">
<p>For information about message acknowledgment, see <a href="#controlling-message-acknowledgment">Controlling Message Acknowledgment</a>.</p>
</div>
<div class="paragraph">
<p>The following table describes four possible interactions between types of consumers and types of acknowledgment.</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 99%;">
<caption class="title">Table 49-3 Message Acknowledgment with Synchronous and Asynchronous Consumers</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Consumer Type</th>
<th class="tableblock halign-left valign-top">Acknowledgment Type</th>
<th class="tableblock halign-left valign-top">Behavior</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Synchronous</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client acknowledges message after processing is complete</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Asynchronous</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client acknowledges message after processing is complete</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Synchronous</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Auto</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Acknowledgment happens immediately after <code>receive</code> call; message cannot be redelivered if any subsequent processing steps fail</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Asynchronous</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Auto</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Message is automatically acknowledged when <code>onMessage</code> method returns</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The example is under the <code><em>tut-install</em>/examples/jms/simple/clientackconsumer/</code> directory.</p>
</div>
<div class="paragraph">
<p>The example client, <code>ClientAckConsumer.java</code>, creates a <code>JMSContext</code> that specifies client acknowledgment:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">try</span> (JMSContext context =
      connectionFactory.createContext(JMSContext.CLIENT_ACKNOWLEDGE);) {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The client uses a <code>while</code> loop almost identical to that used by <code>SynchConsumer.java</code>, with the exception that after processing each message, it calls the <code>acknowledge</code> method on the <code>JMSContext</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">context.acknowledge();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The example uses the following objects:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>jms/MyQueue</code> resource that you created for <a href="#receiving-messages-synchronously">Receiving Messages Synchronously</a>.</p>
</li>
<li>
<p><code>java:comp/DefaultJMSConnectionFactory</code>, the platform default connection factory preconfigured with GlassFish Server</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="to-run-the-clientackconsumer-client"><a class="anchor" href="#to-run-the-clientackconsumer-client"></a>To Run the ClientAckConsumer Client</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In a terminal window, go to the following directory:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/jms/simple/producer/</pre>
</div>
</div>
</li>
<li>
<p>Run the <code>Producer</code> client, sending some messages to the queue:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">appclient -client target/producer.jar queue 3</code></pre>
</div>
</div>
</li>
<li>
<p>In another terminal window, go to the following directory:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/jms/simple/clientackconsumer/</pre>
</div>
</div>
</li>
<li>
<p>To run the client, use the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">appclient -client target/clientackconsumer.jar</code></pre>
</div>
</div>
<div class="paragraph">
<p>The client output looks like this (along with some additional output):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">Created client-acknowledge JMSContext
Reading message: This is message 1 from producer
Acknowledging TextMessage
Reading message: This is message 2 from producer
Acknowledging TextMessage
Reading message: This is message 3 from producer
Acknowledging TextMessage
Acknowledging non-text control message</code></pre>
</div>
</div>
<div class="paragraph">
<p>The client acknowledges each message explicitly after processing it, just as a <code>JMSContext</code> configured to use <code>AUTO_ACKNOWLEDGE</code> does automatically after a <code>MessageListener</code> returns successfully from processing a message received asynchronously.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="writing-more-advanced-jakarta-messaging-applications"><a class="anchor" href="#writing-more-advanced-jakarta-messaging-applications"></a>Writing More Advanced Jakarta Messaging Applications</h3>
<div class="paragraph">
<p>The following examples show how to use some of the more advanced Jakarta Messaging features: durable subscriptions and transactions.</p>
</div>
<div class="sect3">
<h4 id="using-durable-subscriptions"><a class="anchor" href="#using-durable-subscriptions"></a>Using Durable Subscriptions</h4>
<div class="paragraph">
<p>The <code>durablesubscriptionexample</code> example shows how unshared durable subscriptions work.
It demonstrates that a durable subscription continues to exist and accumulate messages even when there is no active consumer on it.</p>
</div>
<div class="paragraph">
<p>The example consists of two modules, a <code>durableconsumer</code> application that creates a durable subscription and consumes messages, and an <code>unsubscriber</code> application that enables you to unsubscribe from the durable subscription after you have finished running the <code>durableconsumer</code> application.</p>
</div>
<div class="paragraph">
<p>For information on durable subscriptions, see <a href="#creating-durable-subscriptions">Creating Durable Subscriptions</a>.</p>
</div>
<div class="paragraph">
<p>The main client, <code>DurableConsumer.java</code>, is under the <code><em>tut-install</em>/examples/jms/durablesubscriptionexample/durableconsumer</code> directory.</p>
</div>
<div class="paragraph">
<p>The example uses a connection factory, <code>jms/DurableConnectionFactory</code>, that has a client ID.</p>
</div>
<div class="paragraph">
<p>The <code>DurableConsumer</code> client creates a <code>JMSContext</code> using the connection factory.
It then stops the <code>JMSContext</code>, calls <code>createDurableConsumer</code> to create a durable subscription and a consumer on the topic by specifying a subscription name, registers a message listener, and starts the <code>JMSContext</code> again.
The subscription is created only if it does not already exist, so the example can be run repeatedly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">try</span> (JMSContext context = durableConnectionFactory.createContext();) {
    context.stop();
    consumer = context.createDurableConsumer(topic, <span class="string"><span class="delimiter">&quot;</span><span class="content">MakeItLast</span><span class="delimiter">&quot;</span></span>);
    listener = <span class="keyword">new</span> <span class="predefined-type">TextListener</span>();
    consumer.setMessageListener(listener);
    context.start();
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To send messages to the topic, you run the <code>producer</code> client.</p>
</div>
<div class="paragraph">
<p>The <code>unsubscriber</code> example contains a very simple <code>Unsubscriber</code> client, which creates a <code>JMSContext</code> on the same connection factory and then calls the <code>unsubscribe</code> method, specifying the subscription name:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">try</span> (JMSContext context = durableConnectionFactory.createContext();) {
    <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Unsubscribing from durable subscription</span><span class="delimiter">&quot;</span></span>);
    context.unsubscribe(<span class="string"><span class="delimiter">&quot;</span><span class="content">MakeItLast</span><span class="delimiter">&quot;</span></span>);
    ...
}</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="to-create-resources-for-the-durable-subscription-example"><a class="anchor" href="#to-create-resources-for-the-durable-subscription-example"></a>To Create Resources for the Durable Subscription Example</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>In a command window, go to the <code>durableconsumer</code> example.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">cd tut-install/jms/durablesubscriptionexample/durableconsumer</code></pre>
</div>
</div>
</li>
<li>
<p>Create the resources using the <code>asadmin add-resources</code> command:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">asadmin add-resources src/main/setup/glassfish-resources.xml</code></pre>
</div>
</div>
<div class="paragraph">
<p>The command output reports the creation of a connector connection pool and a connector resource.</p>
</div>
</li>
<li>
<p>Verify the creation of the resources:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">asadmin list-jms-resources</code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition to the resources you created for the simple examples, the command lists the new connection factory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">jms/MyQueue
jms/MyTopic
jms/__defaultConnectionFactory
jms/DurableConnectionFactory
Command list-jms-resources executed successfully.</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-run-the-durable-subscription-example"><a class="anchor" href="#to-run-the-durable-subscription-example"></a>To Run the Durable Subscription Example</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In a terminal window, go to the following directory:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/jms/durablesubscriptionexample/</pre>
</div>
</div>
</li>
<li>
<p>Build the <code>durableconsumer</code> and <code>unsubscriber</code> examples:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">mvn install</code></pre>
</div>
</div>
</li>
<li>
<p>Go to the <code>durableconsumer</code> directory:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">cd durableconsumer</code></pre>
</div>
</div>
</li>
<li>
<p>To run the client, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">appclient -client target/durableconsumer.jar</code></pre>
</div>
</div>
<div class="paragraph">
<p>The client creates the durable consumer and then waits for messages:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">Creating consumer for topic
Starting consumer
To end program, enter Q or q, then &lt;return&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>In another terminal window, run the <code>Producer</code> client, sending some messages to the topic:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">cd tut-install/examples/jms/simple/producer
appclient -client target/producer.jar topic 3</code></pre>
</div>
</div>
</li>
<li>
<p>After the <code>DurableConsumer</code> client receives the messages, enter <code>q</code> or <code>Q</code> to exit the program.
At this point, the client has behaved like any other asynchronous consumer.</p>
</li>
<li>
<p>Now, while the <code>DurableConsumer</code> client is not running, use the <code>Producer</code> client to send more messages:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">appclient -client target/producer.jar topic 2</code></pre>
</div>
</div>
<div class="paragraph">
<p>If a durable subscription did not exist, these messages would be lost, because no consumer on the topic is currently running.
However, the durable subscription is still active, and it retains the messages.</p>
</div>
</li>
<li>
<p>Run the <code>DurableConsumer</code> client again.
It immediately receives the messages that were sent while it was inactive:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">Creating consumer for topic
Starting consumer
To end program, enter Q or q, then &lt;return&gt;
Reading message: This is message 1 from producer
Reading message: This is message 2 from producer
Message is not a TextMessage</code></pre>
</div>
</div>
</li>
<li>
<p>Enter <code>q</code> or <code>Q</code> to exit the program.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-run-the-unsubscriber-example"><a class="anchor" href="#to-run-the-unsubscriber-example"></a>To Run the unsubscriber Example</h5>
<div class="paragraph">
<p>After you have finished running the <code>DurableConsumer</code> client, run the <code>unsubscriber</code> example to unsubscribe from the durable subscription.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In a terminal window, go to the following directory:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/jms/durablesubscriptionexample/unsubscriber</pre>
</div>
</div>
</li>
<li>
<p>To run the <code>Unsubscriber</code> client, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">appclient -client target/unsubscriber.jar</code></pre>
</div>
</div>
<div class="paragraph">
<p>The client reports that it is unsubscribing from the durable subscription.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="using-local-transactions"><a class="anchor" href="#using-local-transactions"></a>Using Local Transactions</h4>
<div class="paragraph">
<p>The <code>transactedexample</code> example demonstrates the use of local transactions in a Messaging client application.
It also demonstrates the use of the request/reply messaging pattern described in <a href="#creating-temporary-destinations">Creating Temporary Destinations</a>, although it uses permanent rather than temporary destinations.
The example consists of three modules, <code>genericsupplier</code>, <code>retailer</code>, and <code>vendor</code>, which can be found under the <code><em>tut-install</em>/examples/jms/transactedexample/</code> directory.
The source code can be found in the <code>src/main/java/ee.jakarta.tutorial</code> trees for each module.
The <code>genericsupplier</code> and <code>retailer</code> modules each contain a single class, <code>genericsupplier/GenericSupplier.java</code> and <code>retailer/Retailer.java</code>, respectively.
The <code>vendor</code> module is more complex, containing four classes: <code>vendor/Vendor.java</code>, <code>vendor/VendorMessageListener.java</code>, <code>vendor/Order.java</code>, and <code>vendor/SampleUtilities.java</code>.</p>
</div>
<div class="paragraph">
<p>The example shows how to use a queue and a topic in a single transaction as well as how to pass a <code>JMSContext</code> to a message listener&#8217;s constructor function.
The example represents a highly simplified e-commerce application in which the following actions occur.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A retailer (<code>retailer/src/main/java/ee/jakarta/tutorial/retailer/Retailer.java</code>) sends a <code>MapMessage</code> to a vendor order queue, ordering a quantity of computers, and waits for the vendor&#8217;s reply:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">outMessage = context.createMapMessage();
outMessage.setString(<span class="string"><span class="delimiter">&quot;</span><span class="content">Item</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Computer(s)</span><span class="delimiter">&quot;</span></span>);
outMessage.setInt(<span class="string"><span class="delimiter">&quot;</span><span class="content">Quantity</span><span class="delimiter">&quot;</span></span>, quantity);
outMessage.setJMSReplyTo(retailerConfirmQueue);
context.createProducer().send(vendorOrderQueue, outMessage);
<span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Retailer: ordered </span><span class="delimiter">&quot;</span></span> + quantity + <span class="string"><span class="delimiter">&quot;</span><span class="content"> computer(s)</span><span class="delimiter">&quot;</span></span>);
orderConfirmReceiver = context.createConsumer(retailerConfirmQueue);</code></pre>
</div>
</div>
</li>
<li>
<p>The vendor (<code>vendor/src/main/java/ee/jakarta/tutorial/retailer/Vendor.java</code>) receives the retailer&#8217;s order message and sends an order message to the supplier order topic in one transaction.
This Jakarta Messaging transaction uses a single session, so you can combine a receive from a queue with a send to a topic.
Here is the code that uses the same session to create a consumer for a queue:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">vendorOrderReceiver = session.createConsumer(vendorOrderQueue);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following code receives the incoming message, sends an outgoing message, and commits the <code>JMSContext</code>.
The message processing has been removed to keep the sequence simple:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">inMessage = vendorOrderReceiver.receive();
<span class="comment">// Process the incoming message and format the outgoing</span>
<span class="comment">// message</span>
...
context.createProducer().send(supplierOrderTopic, orderMessage);
...
context.commit();</code></pre>
</div>
</div>
<div class="paragraph">
<p>For simplicity, there are only two suppliers, one for CPUs and one for hard drives.</p>
</div>
</li>
<li>
<p>Each supplier (<code>genericsupplier/src/main/java/ee/jakarta/tutorial/retailer/GenericSupplier.java</code>) receives the order from the order topic, checks its inventory, and then sends the items ordered to the queue named in the order message&#8217;s <code>JMSReplyTo</code> field.
If it does not have enough of the item in stock, the supplier sends what it has.
The synchronous receive from the topic and the send to the queue take place in one Jakarta Messaging transaction:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">receiver = context.createConsumer(SupplierOrderTopic);
...
inMessage = receiver.receive();
<span class="keyword">if</span> (inMessage <span class="keyword">instanceof</span> MapMessage) {
    orderMessage = (MapMessage) inMessage;
} ...
<span class="comment">// Process message</span>
outMessage = context.createMapMessage();
<span class="comment">// Add content to message</span>
context.createProducer().send(
         (<span class="predefined-type">Queue</span>) orderMessage.getJMSReplyTo(),
         outMessage);
<span class="comment">// Display message contents</span>
context.commit();</code></pre>
</div>
</div>
</li>
<li>
<p>The vendor receives the suppliers' replies from its confirmation queue and updates the state of the order.
Messages are processed by an asynchronous message listener, <code>VendorMessageListener</code>; this step shows the use of Jakarta Messaging transactions with a message listener:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">MapMessage component = (MapMessage) message;
...
int orderNumber = component.getInt(<span class="string"><span class="delimiter">&quot;</span><span class="content">VendorOrderNumber</span><span class="delimiter">&quot;</span></span>);
Order order = Order.getOrder(orderNumber).processSubOrder(component);
context.commit();</code></pre>
</div>
</div>
</li>
<li>
<p>When all outstanding replies are processed for a given order, the vendor message listener sends a message notifying the retailer whether it can fulfill the order:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Queue</span> replyQueue = (<span class="predefined-type">Queue</span>) order.order.getJMSReplyTo();
MapMessage retailerConfirmMessage = context.createMapMessage();
<span class="comment">// Format the message</span>
context.createProducer().send(replyQueue, retailerConfirmMessage);
context.commit();</code></pre>
</div>
</div>
</li>
<li>
<p>The retailer receives the message from the vendor:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">inMessage = (MapMessage) orderConfirmReceiver.receive();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The retailer then places a second order for twice as many computers as in the first order, so these steps are executed twice.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><a href="#transactions-messaging-client-example">Figure 49-1</a> illustrates these steps.</p>
</div>
<div id="transactions-messaging-client-example" class="imageblock">
<div class="content">
<img src="images/jakartaeett_dt_034.svg" alt="Diagram of steps in transaction example">
</div>
<div class="title">Figure 49-1 Transactions: Messaging Client Example</div>
</div>
<div class="paragraph">
<p>All the messages use the <code>MapMessage</code> message type.
Synchronous receives are used for all message reception except when the vendor processes the replies of the suppliers.
These replies are processed asynchronously and demonstrate how to use transactions within a message listener.</p>
</div>
<div class="paragraph">
<p>At random intervals, the <code>Vendor</code> client throws an exception to simulate a database problem and cause a rollback.</p>
</div>
<div class="paragraph">
<p>All clients except <code>Retailer</code> use transacted contexts.</p>
</div>
<div class="paragraph">
<p>The example uses three queues named <code>jms/AQueue</code>, <code>jms/BQueue</code>, and <code>jms/CQueue</code>, and one topic named <code>jms/OTopic</code>.</p>
</div>
<div class="sect4">
<h5 id="to-create-resources-for-the-transactedexample-example"><a class="anchor" href="#to-create-resources-for-the-transactedexample-example"></a>To Create Resources for the transactedexample Example</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>In a command window, go to the <code>genericsupplier</code> example:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">cd tut-install/jms/transactedexample/genericsupplier</code></pre>
</div>
</div>
</li>
<li>
<p>Create the resources using the <code>asadmin add-resources</code> command:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">asadmin add-resources src/main/setup/glassfish-resources.xml</code></pre>
</div>
</div>
</li>
<li>
<p>Verify the creation of the resources:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">asadmin list-jms-resources</code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition to the resources you created for the simple examples and the durable subscription example, the command lists the four new destinations:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">jms/MyQueue
jms/MyTopic
jms/AQueue
jms/BQueue
jms/CQueue
jms/OTopic
jms/__defaultConnectionFactory
jms/DurableConnectionFactory
Command list-jms-resources executed successfully.</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-run-the-transactedexample-clients"><a class="anchor" href="#to-run-the-transactedexample-clients"></a>To Run the transactedexample Clients</h5>
<div class="paragraph">
<p>You will need four terminal windows to run the clients.
Make sure that you start the clients in the correct order.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In a terminal window, go to the following directory:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/jms/transactedexample/</pre>
</div>
</div>
</li>
<li>
<p>To build and package all the modules, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">mvn install</code></pre>
</div>
</div>
</li>
<li>
<p>Go to the <code>genericsupplier</code> directory:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">cd genericsupplier</code></pre>
</div>
</div>
</li>
<li>
<p>Use the following command to start the CPU supplier client:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">appclient -client target/genericsupplier.jar CPU</code></pre>
</div>
</div>
<div class="paragraph">
<p>After some initial output, the client reports the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">Starting CPU supplier</code></pre>
</div>
</div>
</li>
<li>
<p>In a second terminal window, go to the <code>genericsupplier</code> directory:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">cd tut-install/examples/jms/transactedexample/genericsupplier</code></pre>
</div>
</div>
</li>
<li>
<p>Use the following command to start the hard drive supplier client:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">appclient -client target/genericsupplier.jar HD</code></pre>
</div>
</div>
<div class="paragraph">
<p>After some initial output, the client reports the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">Starting Hard Drive supplier</code></pre>
</div>
</div>
</li>
<li>
<p>In a third terminal window, go to the <code>vendor</code> directory:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">cd tut-install/examples/jms/transactedexample/vendor</code></pre>
</div>
</div>
</li>
<li>
<p>Use the following command to start the <code>Vendor</code> client:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">appclient -client target/vendor.jar</code></pre>
</div>
</div>
<div class="paragraph">
<p>After some initial output, the client reports the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">Starting vendor</code></pre>
</div>
</div>
</li>
<li>
<p>In another terminal window, go to the <code>retailer</code> directory:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">cd tut-install/examples/jms/transactedexample/retailer</code></pre>
</div>
</div>
</li>
<li>
<p><a id="transactedexample-step-10"></a> Use a command like the following to run the <code>Retailer</code> client.
The argument specifies the number of computers to order:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">appclient -client target/retailer.jar 4</code></pre>
</div>
</div>
<div class="paragraph">
<p>After some initial output, the <code>Retailer</code> client reports something like the following.
In this case, the first order is filled, but the second is not:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">Retailer: Quantity to be ordered is 4
Retailer: Ordered 4 computer(s)
Retailer: Order filled
Retailer: Placing another order
Retailer: Ordered 8 computer(s)
Retailer: Order not filled</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Vendor</code> client reports something like the following, stating in this case that it is able to send all the computers in the first order, but not in the second:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">Vendor: Retailer ordered 4 Computer(s)
Vendor: Ordered 4 CPU(s) and hard drive(s)
  Vendor: Committed transaction 1
Vendor: Completed processing for order 1
Vendor: Sent 4 computer(s)
  Vendor: committed transaction 2
Vendor: Retailer ordered 8 Computer(s)
Vendor: Ordered 8 CPU(s) and hard drive(s)
  Vendor: Committed transaction 1
Vendor: Completed processing for order 2
Vendor: Unable to send 8 computer(s)
  Vendor: Committed transaction 2</code></pre>
</div>
</div>
<div class="paragraph">
<p>The CPU supplier reports something like the following.
In this case, it is able to send all the CPUs for both orders:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">CPU Supplier: Vendor ordered 4 CPU(s)
CPU Supplier: Sent 4 CPU(s)
  CPU Supplier: Committed transaction
CPU Supplier: Vendor ordered 8 CPU(s)
CPU Supplier: Sent 8 CPU(s)
  CPU Supplier: Committed transaction</code></pre>
</div>
</div>
<div class="paragraph">
<p>The hard drive supplier reports something like the following.
In this case, it has a shortage of hard drives for the second order:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">Hard Drive Supplier: Vendor ordered 4 Hard Drive(s)
Hard Drive Supplier: Sent 4 Hard Drive(s)
  Hard Drive Supplier: Committed transaction
Hard Drive Supplier: Vendor ordered 8 Hard Drive(s)
Hard Drive Supplier: Sent 1 Hard Drive(s)
  Hard Drive Supplier: Committed transaction</code></pre>
</div>
</div>
</li>
<li>
<p>Repeat <a href="#transactedexample-step-10">Step 10</a> as many times as you wish.
Occasionally, the vendor will report an exception that causes a rollback:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">Vendor: JMSException occurred: jakarta.jms.JMSException: Simulated
database concurrent access exception
  Vendor: Rolled back transaction 1</code></pre>
</div>
</div>
</li>
<li>
<p>After you finish running the clients, you can delete the destination resources by using the following commands:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">asadmin delete-jms-resource jms/AQueue
asadmin delete-jms-resource jms/BQueue
asadmin delete-jms-resource jms/CQueue
asadmin delete-jms-resource jms/OTopic</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="writing-high-performance-and-scalable-jakarta-messaging-applications"><a class="anchor" href="#writing-high-performance-and-scalable-jakarta-messaging-applications"></a>Writing High Performance and Scalable Jakarta Messaging Applications</h3>
<div class="paragraph">
<p>This section describes how to use Jakarta Messaging to write applications that can handle high volumes of messages robustly.
These examples use both nondurable and durable shared consumers.</p>
</div>
<div class="sect3">
<h4 id="using-shared-nondurable-subscriptions"><a class="anchor" href="#using-shared-nondurable-subscriptions"></a>Using Shared Nondurable Subscriptions</h4>
<div class="paragraph">
<p>This section describes the receiving clients in an example that shows how to use a shared consumer to distribute messages sent to a topic among different consumers.
This section then explains how to compile and run the clients using GlassFish Server.</p>
</div>
<div class="paragraph">
<p>You may wish to compare this example to the results of <a href="#running-multiple-consumers-on-the-same-destination">Running Multiple Consumers on the Same Destination</a> using an unshared consumer.
In that example, messages are distributed among the consumers on a queue, but each consumer on the topic receives all the messages because each consumer on the topic is using a separate topic subscription.</p>
</div>
<div class="paragraph">
<p>In this example, however, messages are distributed among multiple consumers on a topic, because all the consumers are sharing the same subscription.
Each message added to the topic subscription is received by only one consumer, similarly to the way in which each message added to a queue is received by only one consumer.</p>
</div>
<div class="paragraph">
<p>A topic may have multiple subscriptions.
Each message sent to the topic will be added to each topic subscription.
However, if there are multiple consumers on a particular subscription, each message added to that subscription will be delivered to only one of those consumers.</p>
</div>
<div class="sect4">
<h5 id="writing-the-clients-for-the-shared-consumer-example"><a class="anchor" href="#writing-the-clients-for-the-shared-consumer-example"></a>Writing the Clients for the Shared Consumer Example</h5>
<div class="paragraph">
<p>The sending client is <code>Producer.java</code>, the same client used in previous examples.</p>
</div>
<div class="paragraph">
<p>The receiving client is <code>SharedConsumer.java</code>.
It is very similar to <code>AsynchConsumer.java</code>, except that it always uses a topic.
It performs the following steps.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Injects resources for a connection factory and topic.</p>
</li>
<li>
<p>In a <code>try-with-resources</code> block, creates a <code>JMSContext</code>.</p>
</li>
<li>
<p>Creates a consumer on a shared nondurable subscription, specifying a subscription name:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">consumer = context.createSharedConsumer(topic, <span class="string"><span class="delimiter">&quot;</span><span class="content">SubName</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
</li>
<li>
<p>Creates an instance of the <code>TextListener</code> class and registers it as the message listener for the shared consumer.</p>
</li>
<li>
<p>Listens for the messages published to the destination, stopping when the user types the character <code>q</code> or <code>Q</code>.</p>
</li>
<li>
<p>Catches and handles any exceptions.
The end of the <code>try-with-resources</code> block automatically causes the <code>JMSContext</code> to be closed.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The <code>TextListener.java</code> class is identical to the one for the <code>asynchconsumer</code> example.</p>
</div>
<div class="paragraph">
<p>For this example, you will use the default connection factory and the topic you created in <a href="#to-create-resources-for-the-simple-examples">To Create Resources for the Simple Examples</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="to-run-the-sharedconsumer-and-producer-clients"><a class="anchor" href="#to-run-the-sharedconsumer-and-producer-clients"></a>To Run the SharedConsumer and Producer Clients</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>Open three command windows.
In the first, go to the <code>simple/producer/</code> directory:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">cd tut-install/examples/jms/simple/producer/</code></pre>
</div>
</div>
</li>
<li>
<p>In the second and third command windows, go to the <code>shared/sharedconsumer/</code> directory:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">cd tut-install/examples/jms/shared/sharedconsumer/</code></pre>
</div>
</div>
</li>
<li>
<p>In one of the <code>sharedconsumer</code> windows, build the example:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">mvn install</code></pre>
</div>
</div>
</li>
<li>
<p>In each of the two <code>sharedconsumer</code> windows, start running the client.
You do not need to specify a <code>topic</code> argument:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">appclient -client target/sharedconsumer.jar</code></pre>
</div>
</div>
<div class="paragraph">
<p>Wait until you see the following output in both windows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">Waiting for messages on topic
To end program, enter Q or q, then &lt;return&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>In the <code>producer</code> window, run the client, specifying the topic and a number of messages:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">appclient -client target/producer.jar topic 20</code></pre>
</div>
</div>
<div class="paragraph">
<p>Each consumer client receives some of the messages.
Only one of the clients receives the non-text message that signals the end of the message stream.</p>
</div>
</li>
<li>
<p>Enter <code>Q</code> or <code>q</code> and press Return to stop each client and see a report of the number of text messages received.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="using-shared-durable-subscriptions"><a class="anchor" href="#using-shared-durable-subscriptions"></a>Using Shared Durable Subscriptions</h4>
<div class="paragraph">
<p>The <code>shareddurableconsumer</code> client shows how to use shared durable subscriptions.
It shows how shared durable subscriptions combine the advantages of durable subscriptions (the subscription remains active when the client is not) with those of shared consumers (the message load can be divided among multiple clients).</p>
</div>
<div class="paragraph">
<p>The example is much more similar to the <code>sharedconsumer</code> example than to the <code>DurableConsumer.java</code> client.
It uses two classes, <code>SharedDurableConsumer.java</code> and <code>TextListener.java</code>, which can be found under the <code><em>tut-install</em>/examples/jms/shared/shareddurableconsumer/</code> directory.</p>
</div>
<div class="paragraph">
<p>The client uses <code>java:comp/DefaultJMSConnectionFactory</code>, the connection factory that does not have a client identifier, as is recommended for shared durable subscriptions.
It uses the <code>createSharedDurableConsumer</code> method with a subscription name to establish the subscription:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">consumer = context.createSharedDurableConsumer(topic, <span class="string"><span class="delimiter">&quot;</span><span class="content">MakeItLast</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>You run the example in combination with the <code>Producer.java</code> client.</p>
</div>
<div class="sect4">
<h5 id="to-run-the-shareddurableconsumer-and-producer-clients"><a class="anchor" href="#to-run-the-shareddurableconsumer-and-producer-clients"></a>To Run the SharedDurableConsumer and Producer Clients</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In a terminal window, go to the following directory:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/jms/shared/shareddurableconsumer</pre>
</div>
</div>
</li>
<li>
<p>To compile and package the client, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">mvn install</code></pre>
</div>
</div>
</li>
<li>
<p>Run the client first to establish the durable subscription:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">appclient -client target/shareddurableconsumer.jar</code></pre>
</div>
</div>
</li>
<li>
<p>The client displays the following and pauses:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">Waiting for messages on topic
To end program, enter Q or q, then &lt;return&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>In the <code>shareddurableconsumer</code> window, enter <code>q</code> or <code>Q</code> to exit the program.
The subscription remains active, although the client is not running.</p>
</li>
<li>
<p>Open another terminal window and go to the <code>producer</code> example directory:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">cd tut-install/examples/jms/simple/producer</code></pre>
</div>
</div>
</li>
<li>
<p>Run the <code>producer</code> example, sending a number of messages to the topic:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">appclient -client target/producer.jar topic 6</code></pre>
</div>
</div>
</li>
<li>
<p>After the producer has sent the messages, open a third terminal window and go to the <code>shareddurableconsumer</code> directory.</p>
</li>
<li>
<p>Run the client in both the first and third terminal windows.
Whichever client starts first will receive all the messages that were sent when there was no active subscriber:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">appclient -client target/shareddurableconsumer.jar</code></pre>
</div>
</div>
</li>
<li>
<p>With both <code>shareddurableconsumer</code> clients still running, go to the <code>producer</code> window and send a larger number of messages to the topic:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">appclient -client target/producer.jar topic 25</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now the messages will be shared by the two consumer clients.
If you continue sending groups of messages to the topic, each client receives some of the messages.
If you exit one of the clients and send more messages, the other client will receive all the messages.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sending-and-receiving-messages-using-a-simple-web-application"><a class="anchor" href="#sending-and-receiving-messages-using-a-simple-web-application"></a>Sending and Receiving Messages Using a Simple Web Application</h3>
<div class="paragraph">
<p>Web applications can use Jakarta Messaging to send and receive messages, as noted in <a href="#using-jakarta-ee-components-to-produce-and-to-synchronously-receive-messages">Using Jakarta EE Components to Produce and to Synchronously Receive Messages</a>. This section describes the components of a very simple web application that uses Jakarta Messaging.</p>
</div>
<div class="paragraph">
<p>This section assumes that you are familiar with the basics of Jakarta Faces technology, described in <a href="#the-web-tier">Part III, &#8220;The Web Tier&#8221;</a>.</p>
</div>
<div class="paragraph">
<p>The example, <code>websimplemessage</code>, is under the <code><em>tut-install</em>/jms/examples/</code> directory.
It uses sending and receiving Facelets pages as well as corresponding backing beans.
When a user enters a message in the text field of the sending page and clicks a button, the backing bean for the page sends the message to a queue and displays it on the page.
When the user goes to the receiving page and clicks another button, the backing bean for that page receives the message synchronously and displays it.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/jakartaeett_dt_035.svg" alt="Diagram showing a web application in which a managed bean sends a message to a queue, and another managed bean receives the message from the queue.">
</div>
<div class="title">Figure 49-2 The websimplemessage Application</div>
</div>
<div class="sect3">
<h4 id="the-websimplemessage-facelets-pages"><a class="anchor" href="#the-websimplemessage-facelets-pages"></a>The websimplemessage Facelets Pages</h4>
<div class="paragraph">
<p>The Facelets pages for the example are as follows.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sender.xhtml</code>, which provides a labeled <code>h:InputText</code> tag where the user enters the message, along with two command buttons.
When the user clicks the Send Message button, the <code>senderBean.sendMessage</code> method is called to send the message to the queue and display its contents.
When the user clicks the Go to Receive Page button, the <code>receiver.xhtml</code> page appears.</p>
</li>
<li>
<p><code>receiver.xhtml</code>, which also provides two command buttons.
When the user clicks the Receive Message button, the <code>receiverBean.getMessage</code> method is called to fetch the message from the queue and display its contents.
When the user clicks the Send Another Message button, the sender.xhtml page appears again.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="the-websimplemessage-managed-beans"><a class="anchor" href="#the-websimplemessage-managed-beans"></a>The websimplemessage Managed Beans</h4>
<div class="paragraph">
<p>The two managed beans for the example are as follows.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>SenderBean.java</code>, a CDI managed bean with one property, <code>messageText</code>, and one business method, <code>sendMessage</code>.
The class is annotated with <code>@JMSDestinationDefinition</code> to create a component-private queue:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@JMSDestinationDefinition</span>(
        name = <span class="string"><span class="delimiter">&quot;</span><span class="content">java:comp/jms/webappQueue</span><span class="delimiter">&quot;</span></span>,
        interfaceName = <span class="string"><span class="delimiter">&quot;</span><span class="content">jakarta.jms.Queue</span><span class="delimiter">&quot;</span></span>,
        destinationName = <span class="string"><span class="delimiter">&quot;</span><span class="content">PhysicalWebappQueue</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@Named</span>
<span class="annotation">@RequestScoped</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">SenderBean</span> { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>sendMessage</code> method injects a <code>JMSContext</code> (using the default connection factory) and the queue, creates a producer, sends the message the user typed on the Facelets page, and creates a <code>FacesMessage</code> to display on the Facelets page:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
<span class="directive">private</span> JMSContext context;
<span class="annotation">@Resource</span>(lookup = <span class="string"><span class="delimiter">&quot;</span><span class="content">java:comp/jms/webappQueue</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> <span class="predefined-type">Queue</span> queue;
<span class="directive">private</span> <span class="predefined-type">String</span> messageText;
...
public <span class="type">void</span> sendMessage() {
    <span class="keyword">try</span> {
        <span class="predefined-type">String</span> text = <span class="string"><span class="delimiter">&quot;</span><span class="content">Message from producer: </span><span class="delimiter">&quot;</span></span> + messageText;
        context.createProducer().send(queue, text);

        FacesMessage facesMessage =
                <span class="keyword">new</span> FacesMessage(<span class="string"><span class="delimiter">&quot;</span><span class="content">Sent message: </span><span class="delimiter">&quot;</span></span> + text);
        FacesContext.getCurrentInstance().addMessage(<span class="predefined-constant">null</span>, facesMessage);
    } <span class="keyword">catch</span> (<span class="predefined-type">Throwable</span> t) {
        logger.log(<span class="predefined-type">Level</span>.SEVERE,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">SenderBean.sendMessage: Exception: {0}</span><span class="delimiter">&quot;</span></span>,
                t.toString());
    }
}</code></pre>
</div>
</div>
</li>
<li>
<p><code>ReceiverBean.java</code>, a CDI managed bean with one business method, <code>getMessage</code>.
The method injects a <code>JMSContext</code> (using the default connection factory) and the queue that was defined in <code>SenderBean</code>, creates a consumer, receives the message, and creates a <code>FacesMessage</code> to display on the Facelets page:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
<span class="directive">private</span> JMSContext context;
<span class="annotation">@Resource</span>(lookup = <span class="string"><span class="delimiter">&quot;</span><span class="content">java:comp/jms/webappQueue</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> <span class="predefined-type">Queue</span> queue;
...
public <span class="type">void</span> getMessage() {
    <span class="keyword">try</span> {
        JMSConsumer receiver = context.createConsumer(queue);
        <span class="predefined-type">String</span> text = receiver.receiveBody(<span class="predefined-type">String</span>.class);

        <span class="keyword">if</span> (text != <span class="predefined-constant">null</span>) {
            FacesMessage facesMessage =
                    <span class="keyword">new</span> FacesMessage(<span class="string"><span class="delimiter">&quot;</span><span class="content">Reading message: </span><span class="delimiter">&quot;</span></span> + text);
            FacesContext.getCurrentInstance().addMessage(<span class="predefined-constant">null</span>, facesMessage);
        } <span class="keyword">else</span> {
            FacesMessage facesMessage =
                    <span class="keyword">new</span> FacesMessage(<span class="string"><span class="delimiter">&quot;</span><span class="content">No message received after 1 second</span><span class="delimiter">&quot;</span></span>);
            FacesContext.getCurrentInstance().addMessage(<span class="predefined-constant">null</span>, facesMessage);
        }
    } <span class="keyword">catch</span> (<span class="predefined-type">Throwable</span> t) {
        logger.log(<span class="predefined-type">Level</span>.SEVERE,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">ReceiverBean.getMessage: Exception: {0}</span><span class="delimiter">&quot;</span></span>,
                t.toString());
    }
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="running-the-websimplemessage-example"><a class="anchor" href="#running-the-websimplemessage-example"></a>Running the websimplemessage Example</h4>
<div class="paragraph">
<p>You can use either NetBeans IDE or Maven to build, package, deploy, and run the <code>websimplemessage</code> application.</p>
</div>
<div class="sect4">
<h5 id="creating-resources-for-the-websimplemessage-example"><a class="anchor" href="#creating-resources-for-the-websimplemessage-example"></a>Creating Resources for the websimplemessage Example</h5>
<div class="paragraph">
<p>This example uses an annotation-defined queue and the preconfigured default connection factory <code>java:comp/DefaultJMSConnectionFactory</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="to-package-and-deploy-websimplemessage-using-netbeans-ide"><a class="anchor" href="#to-package-and-deploy-websimplemessage-using-netbeans-ide"></a>To Package and Deploy websimplemessage Using NetBeans IDE</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>From the <strong>File</strong> menu, choose <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the <strong>Open Project</strong> dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/jms</pre>
</div>
</div>
</li>
<li>
<p>Select the <code>websimplemessage</code> folder.</p>
</li>
<li>
<p>Click <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the <strong>Projects</strong> tab, right-click the <code>websimplemessage</code> project and select <strong>Build</strong>.</p>
<div class="paragraph">
<p>This command builds and deploys the project.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-package-and-deploy-websimplemessage-using-maven"><a class="anchor" href="#to-package-and-deploy-websimplemessage-using-maven"></a>To Package and Deploy websimplemessage Using Maven</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>In a terminal window, go to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/jms/websimplemessage/</pre>
</div>
</div>
</li>
<li>
<p>To compile the source files and package and deploy the application, use the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">mvn install</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-run-the-websimplemessage-example"><a class="anchor" href="#to-run-the-websimplemessage-example"></a>To Run the websimplemessage Example</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In a web browser, enter the following URL:</p>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080/websimplemessage</pre>
</div>
</div>
</li>
<li>
<p>Enter a message in the text field and click Send Message.</p>
<div class="paragraph">
<p>If, for example, you enter "Hello, Duke", the following appears below the buttons:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Sent message: Message from producer: Hello, Duke</pre>
</div>
</div>
</li>
<li>
<p>Click Go to Receive Page.</p>
</li>
<li>
<p>Click Receive Message.</p>
<div class="paragraph">
<p>The following appears below the buttons:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Reading message: Message from producer: Hello, Duke</pre>
</div>
</div>
</li>
<li>
<p>Click Send Another Message to return to the sending page.</p>
</li>
<li>
<p>After you have finished running the application, undeploy it using either the Services tab of NetBeans IDE or the <code>mvn cargo:undeploy</code> command.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="receiving-messages-asynchronously-using-a-message-driven-bean"><a class="anchor" href="#receiving-messages-asynchronously-using-a-message-driven-bean"></a>Receiving Messages Asynchronously Using a Message-Driven Bean</h3>
<div class="paragraph">
<p>If you are writing an application to run in the Jakarta EE application client container or on the Java SE platform, and you want to receive messages asynchronously, you need to define a class that implements the <code>MessageListener</code> interface, create a <code>JMSConsumer</code>, and call the method <code>setMessageListener</code>.</p>
</div>
<div class="paragraph">
<p>If you&#8217;re writing an application to run in the Jakarta EE web or enterprise bean container and want it to receive messages asynchronously, you also need to need to define a class that implements the <code>MessageListener</code> interface.
However, instead of creating a <code>JMSConsumer</code> and calling the method <code>setMessageListener</code>, you must configure your message listener class to be a message-driven bean.
The application server will then take care of the rest.</p>
</div>
<div class="paragraph">
<p>Message-driven beans can implement any messaging type.
Most commonly, however, they implement the Jakarta Messaging technology.</p>
</div>
<div class="paragraph">
<p>This section describes a simple message-driven bean example.
Before proceeding, you should read the basic conceptual information in the section <a href="#what-is-a-message-driven-bean">What Is a Message-Driven Bean?</a> as well as <a href="#using-message-driven-beans-to-receive-messages-asynchronously">Using Message-Driven Beans to Receive Messages Asynchronously</a>.</p>
</div>
<div class="sect3">
<h4 id="overview-of-the-simplemessage-example"><a class="anchor" href="#overview-of-the-simplemessage-example"></a>Overview of the simplemessage Example</h4>
<div class="paragraph">
<p>The <code>simplemessage</code> application has the following components:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>SimpleMessageClient</code>: An application client that sends several messages to a queue</p>
</li>
<li>
<p><code>SimpleMessageBean</code>: A message-driven bean that asynchronously processes the messages that are sent to the queue</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a href="#the-simplemessage-application">Figure 49-3</a> illustrates the structure of this application.
The application client sends messages to the queue, which was created administratively using the Administration Console.
The Messaging provider (in this case, GlassFish Server) delivers the messages to the instances of the message-driven bean, which then processes the messages.</p>
</div>
<div id="the-simplemessage-application" class="imageblock">
<div class="content">
<img src="images/jakartaeett_dt_036.svg" alt="Diagram of application showing an application client sending a message to a queue, and the message being delivered to a message-driven bean">
</div>
<div class="title">Figure 49-3 The simplemessage Application</div>
</div>
<div class="paragraph">
<p>The source code for this application is in the <code><em>tut-install</em>/examples/jms/simplemessage/</code> directory.</p>
</div>
</div>
<div class="sect3">
<h4 id="the-simplemessage-application-client"><a class="anchor" href="#the-simplemessage-application-client"></a>The simplemessage Application Client</h4>
<div class="paragraph">
<p>The <code>SimpleMessageClient</code> sends messages to the queue that the <code>SimpleMessageBean</code> listens to.
The client starts by injecting the connection factory and queue resources:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Resource</span>(lookup = <span class="string"><span class="delimiter">&quot;</span><span class="content">java:comp/DefaultJMSConnectionFactory</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> <span class="directive">static</span> ConnectionFactory connectionFactory;

<span class="annotation">@Resource</span>(lookup = <span class="string"><span class="delimiter">&quot;</span><span class="content">jms/MyQueue</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> <span class="directive">static</span> <span class="predefined-type">Queue</span> queue;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next, the client creates the <code>JMSContext</code> in a <code>try-with-resources</code> block:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">String</span> text;
<span class="directive">final</span> <span class="type">int</span> NUM_MSGS = <span class="integer">3</span>;

<span class="keyword">try</span> (JMSContext context = connectionFactory.createContext();) { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, the client sends several text messages to the queue:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="integer">0</span>; i &lt; NUM_MSGS; i++) {
    text = <span class="string"><span class="delimiter">&quot;</span><span class="content">This is message </span><span class="delimiter">&quot;</span></span> + (i + <span class="integer">1</span>);
    <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Sending message: </span><span class="delimiter">&quot;</span></span> + text);
    context.createProducer().send(queue, text);
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="the-simplemessage-message-driven-bean-class"><a class="anchor" href="#the-simplemessage-message-driven-bean-class"></a>The simplemessage Message-Driven Bean Class</h4>
<div class="paragraph">
<p>The code for the <code>SimpleMessageBean</code> class illustrates the requirements of a message-driven bean class described in <a href="#using-message-driven-beans-to-receive-messages-asynchronously">Using Message-Driven Beans to Receive Messages Asynchronously</a>.</p>
</div>
<div class="paragraph">
<p>The first few lines of the <code>SimpleMessageBean</code> class use the <code>@MessageDriven</code> annotation&#8217;s <code>activationConfig</code> attribute to specify configuration properties:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@MessageDriven</span>(activationConfig = {
    <span class="annotation">@ActivationConfigProperty</span>(propertyName = <span class="string"><span class="delimiter">&quot;</span><span class="content">destinationLookup</span><span class="delimiter">&quot;</span></span>,
            propertyValue = <span class="string"><span class="delimiter">&quot;</span><span class="content">jms/MyQueue</span><span class="delimiter">&quot;</span></span>),
    <span class="annotation">@ActivationConfigProperty</span>(propertyName = <span class="string"><span class="delimiter">&quot;</span><span class="content">destinationType</span><span class="delimiter">&quot;</span></span>,
            propertyValue = <span class="string"><span class="delimiter">&quot;</span><span class="content">jakarta.jms.Queue</span><span class="delimiter">&quot;</span></span>)
})</code></pre>
</div>
</div>
<div class="paragraph">
<p>See <a href="#activationconfigproperty-settings-for-message-driven-beans">Table 48-3</a> for a list of the available properties.</p>
</div>
<div class="paragraph">
<p>See <a href="#sending-messages-from-a-session-bean-to-an-mdb">Sending Messages from a Session Bean to an MDB</a> for examples of the <code>subscriptionDurability</code>, <code>clientId</code>, <code>subscriptionName</code>, and <code>messageSelector</code> properties.</p>
</div>
<div class="sect4">
<h5 id="the-onmessage-method"><a class="anchor" href="#the-onmessage-method"></a>The onMessage Method</h5>
<div class="paragraph">
<p>When the queue receives a message, the enterprise bean container invokes the message listener method or methods.
For a bean that uses Jakarta Messaging, this is the <code>onMessage</code> method of the <code>MessageListener</code> interface.</p>
</div>
<div class="paragraph">
<p>In the <code>SimpleMessageBean</code> class, the <code>onMessage</code> method casts the incoming message to a <code>TextMessage</code> and displays the text:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">void</span> onMessage(Message inMessage) {

    <span class="keyword">try</span> {
        <span class="keyword">if</span> (inMessage <span class="keyword">instanceof</span> TextMessage) {
            logger.log(<span class="predefined-type">Level</span>.INFO,
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">MESSAGE BEAN: Message received: {0}</span><span class="delimiter">&quot;</span></span>,
                    inMessage.getBody(<span class="predefined-type">String</span>.class));
        } <span class="keyword">else</span> {
            logger.log(<span class="predefined-type">Level</span>.WARNING,
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">Message of wrong type: {0}</span><span class="delimiter">&quot;</span></span>,
                    inMessage.getClass().getName());
        }
    } <span class="keyword">catch</span> (JMSException e) {
        logger.log(<span class="predefined-type">Level</span>.SEVERE,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">SimpleMessageBean.onMessage: JMSException: {0}</span><span class="delimiter">&quot;</span></span>,
                e.toString());
        mdc.setRollbackOnly();
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="running-the-simplemessage-example"><a class="anchor" href="#running-the-simplemessage-example"></a>Running the simplemessage Example</h4>
<div class="paragraph">
<p>You can use either NetBeans IDE or Maven to build, deploy, and run the <code>simplemessage</code> example.</p>
</div>
<div class="sect4">
<h5 id="creating-resources-for-the-simplemessage-example"><a class="anchor" href="#creating-resources-for-the-simplemessage-example"></a>Creating Resources for the simplemessage Example</h5>
<div class="paragraph">
<p>This example uses the queue named <code>jms/MyQueue</code> and the preconfigured default connection factory <code>java:comp/DefaultJMSConnectionFactory</code>.</p>
</div>
<div class="paragraph">
<p>If you have run the simple Jakarta Messaging examples in <a href="#writing-simple-jakarta-messaging-applications">Writing Simple Jakarta Messaging Applications</a> and have not deleted the resources, you already have the queue.
Otherwise, follow the instructions in <a href="#to-create-resources-for-the-simple-examples">To Create Resources for the Simple Examples</a> to create it.</p>
</div>
<div class="paragraph">
<p>For more information on creating Messaging resources, see <a href="#creating-jakarta-messaging-administered-objects">Creating Jakarta Messaging Administered Objects</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="to-run-the-simplemessage-example-using-netbeans-ide"><a class="anchor" href="#to-run-the-simplemessage-example-using-netbeans-ide"></a>To Run the simplemessage Example Using NetBeans IDE</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>From the <strong>File</strong> menu, choose <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the <strong>Open Project</strong> dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/jms/simplemessage</pre>
</div>
</div>
</li>
<li>
<p>Select the <code>simplemessage</code> folder.</p>
</li>
<li>
<p>Make sure that the <strong>Open Required Projects</strong> check box is selected, then click <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the <strong>Projects</strong> tab, right-click the <code>simplemessage</code> project and select <strong>Build</strong>.
(If NetBeans IDE suggests that you run a priming build, click the box to do so.)</p>
<div class="paragraph">
<p>This command packages the application client and the message-driven bean, then creates a file named <code>simplemessage.ear</code> in the <code>simplemessage-ear/target/</code> directory.
It then deploys the <code>simplemessage-ear</code> module, retrieves the client stubs, and runs the application client.</p>
</div>
<div class="paragraph">
<p>The output in the output window looks like this (preceded by application client container output):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Sending message: This is message 1
Sending message: This is message 2
Sending message: This is message 3
To see if the bean received the messages,
 check &lt;install_dir&gt;/domains/domain1/logs/server.log.</pre>
</div>
</div>
<div class="paragraph">
<p>In the server log file, lines similar to the following appear:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>MESSAGE BEAN: Message received: This is message 1
MESSAGE BEAN: Message received: This is message 2
MESSAGE BEAN: Message received: This is message 3</pre>
</div>
</div>
<div class="paragraph">
<p>The received messages may appear in a different order from the order in which they were sent.</p>
</div>
</li>
<li>
<p>After you have finished running the application, undeploy it using the <strong>Services</strong> tab.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-run-the-simplemessage-example-using-maven"><a class="anchor" href="#to-run-the-simplemessage-example-using-maven"></a>To Run the simplemessage Example Using Maven</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>In a terminal window, go to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/jms/simplemessage/</pre>
</div>
</div>
</li>
<li>
<p>To compile the source files and package the application, use the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">mvn install</code></pre>
</div>
</div>
<div class="paragraph">
<p>This target packages the application client and the message-driven bean, then creates a file named <code>simplemessage.ear</code> in the <code>simplemessage-ear/target/</code> directory.
It then deploys the <code>simplemessage-ear</code> module, retrieves the client stubs, and runs the application client.</p>
</div>
<div class="paragraph">
<p>The output in the terminal window looks like this (preceded by application client container output):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Sending message: This is message 1
Sending message: This is message 2
Sending message: This is message 3
To see if the bean received the messages,
 check &lt;install_dir&gt;/domains/domain1/logs/server.log.</pre>
</div>
</div>
<div class="paragraph">
<p>In the server log file, lines similar to the following appear:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>MESSAGE BEAN: Message received: This is message 1
MESSAGE BEAN: Message received: This is message 2
MESSAGE BEAN: Message received: This is message 3</pre>
</div>
</div>
<div class="paragraph">
<p>The received messages may appear in a different order from the order in which they were sent.</p>
</div>
</li>
<li>
<p>After you have finished running the application, undeploy it using the <code>mvn cargo:undeploy</code> command.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sending-messages-from-a-session-bean-to-an-mdb"><a class="anchor" href="#sending-messages-from-a-session-bean-to-an-mdb"></a>Sending Messages from a Session Bean to an MDB</h3>
<div class="paragraph">
<p>This section explains how to write, compile, package, deploy, and run an application that uses Jakarta Messaging in conjunction with a session bean.
The application contains the following components:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An application client that invokes a session bean</p>
</li>
<li>
<p>A session bean that publishes several messages to a topic</p>
</li>
<li>
<p>A message-driven bean that receives and processes the messages using a durable topic subscription and a message selector</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You will find the source files for this section in the <code><em>tut-install</em>/examples/jms/clientsessionmdb/</code> directory.
Path names in this section are relative to this directory.</p>
</div>
<div class="sect3">
<h4 id="writing-the-application-components-for-the-clientsessionmdb-example"><a class="anchor" href="#writing-the-application-components-for-the-clientsessionmdb-example"></a>Writing the Application Components for the clientsessionmdb Example</h4>
<div class="paragraph">
<p>This application demonstrates how to send messages from an enterprise bean (in this case, a session bean) rather than from an application client, as in the example in <a href="#receiving-messages-asynchronously-using-a-message-driven-bean">Receiving Messages Asynchronously Using a Message-Driven Bean</a>.
<a href="#an-enterprise-bean-application-client-to-session-bean-to-message-driven-bean">Figure 49-4</a> illustrates the structure of this application.
Sending messages from an enterprise bean is very similar to sending messages from a managed bean, which was shown in <a href="#sending-and-receiving-messages-using-a-simple-web-application">Sending and Receiving Messages Using a Simple Web Application</a>.</p>
</div>
<div id="an-enterprise-bean-application-client-to-session-bean-to-message-driven-bean" class="imageblock">
<div class="content">
<img src="images/jakartaeett_dt_037.svg" alt="Diagram of application showing an application client calling a session bean, which sends messages that are processed by a message-driven bean">
</div>
<div class="title">Figure 49-4 An Enterprise Bean Application: Client to Session Bean to Message-Driven Bean</div>
</div>
<div class="paragraph">
<p>The Publisher enterprise bean in this example is the enterprise-application equivalent of a wire-service news feed that categorizes news events into six news categories.
The message-driven bean could represent a newsroom, where the sports desk, for example, would set up a subscription for all news events pertaining to sports.</p>
</div>
<div class="paragraph">
<p>The application client in the example injects the Publisher enterprise bean&#8217;s remote home interface and then calls the bean&#8217;s business method.
The enterprise bean creates 18 text messages.
For each message, it sets a <code>String</code> property randomly to one of six values representing the news categories and then publishes the message to a topic.
The message-driven bean uses a message selector for the property to limit which of the published messages will be delivered to it.</p>
</div>
<div class="sect4">
<h5 id="coding-the-application-client-myappclient-java"><a class="anchor" href="#coding-the-application-client-myappclient-java"></a>Coding the Application Client: MyAppClient.java</h5>
<div class="paragraph">
<p>The application client, <code>MyAppClient.java</code>, found under <code>clientsessionmdb-app-client</code>, performs no Messaging operations and so is simpler than the client in <a href="#receiving-messages-asynchronously-using-a-message-driven-bean">Receiving Messages Asynchronously Using a Message-Driven Bean</a>.
The client uses dependency injection to obtain the Publisher enterprise bean&#8217;s business interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@EJB</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">PublisherRemote</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> <span class="directive">static</span> PublisherRemote publisher;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The client then calls the bean&#8217;s business method twice.</p>
</div>
</div>
<div class="sect4">
<h5 id="coding-the-publisher-session-bean"><a class="anchor" href="#coding-the-publisher-session-bean"></a>Coding the Publisher Session Bean</h5>
<div class="paragraph">
<p>The Publisher bean is a stateless session bean that has one business method.
The Publisher bean uses a remote interface rather than a local interface because it is accessed from the application client.</p>
</div>
<div class="paragraph">
<p>The remote interface, <code>PublisherRemote.java</code>, found under <code>clientsessionmdb-ejb</code>, declares a single business method, <code>publishNews</code>.</p>
</div>
<div class="paragraph">
<p>The bean class, <code>PublisherBean.java</code>, also found under <code>clientsessionmdb-ejb</code>, implements the <code>publishNews</code> method and its helper method <code>chooseType</code>.
The bean class injects <code>SessionContext</code> and <code>Topic</code> resources (the topic is defined in the message-driven bean).
It then injects a <code>JMSContext</code>, which uses the preconfigured default connection factory unless you specify otherwise.
The bean class begins as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Stateless</span>
<span class="annotation">@Remote</span>({
    PublisherRemote.class
})
<span class="directive">public</span> <span class="type">class</span> <span class="class">PublisherBean</span> <span class="directive">implements</span> PublisherRemote {

    <span class="annotation">@Resource</span>
    <span class="directive">private</span> SessionContext sc;
    <span class="annotation">@Resource</span>(lookup = <span class="string"><span class="delimiter">&quot;</span><span class="content">java:module/jms/newsTopic</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">private</span> Topic topic;
    <span class="annotation">@Inject</span>
    <span class="directive">private</span> JMSContext context;
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The business method <code>publishNews</code> creates a <code>JMSProducer</code> and publishes the messages.</p>
</div>
</div>
<div class="sect4">
<h5 id="coding-the-message-driven-bean-messagebean-java"><a class="anchor" href="#coding-the-message-driven-bean-messagebean-java"></a>Coding the Message-Driven Bean: MessageBean.java</h5>
<div class="paragraph">
<p>The message-driven bean class, <code>MessageBean.java</code>, found under <code>clientsessionmdb-ejb</code>, is almost identical to the one in <a href="#receiving-messages-asynchronously-using-a-message-driven-bean">Receiving Messages Asynchronously Using a Message-Driven Bean</a>.
However, the <code>@MessageDriven</code> annotation is different, because instead of a queue, the bean is using a topic, a durable subscription, and a message selector.
The bean defines a topic for the use of the application; the definition uses the <code>java:module</code> scope because both the session bean and the message-driven bean are in the same module.
Because the destination is defined in the message-driven bean, the <code>@MessageDriven</code> annotation uses the <code>destinationLookup</code> activation config property.
(See <a href="#creating-resources-for-jakarta-ee-applications">Creating Resources for Jakarta EE Applications</a> for more information.)
The annotation also sets the activation config properties <code>messageSelector</code>, <code>subscriptionDurability</code>, <code>clientId</code>, and <code>subscriptionName</code>, as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@JMSDestinationDefinition</span>(
        name = <span class="string"><span class="delimiter">&quot;</span><span class="content">java:module/jms/newsTopic</span><span class="delimiter">&quot;</span></span>,
        interfaceName = <span class="string"><span class="delimiter">&quot;</span><span class="content">jakarta.jms.Topic</span><span class="delimiter">&quot;</span></span>,
        destinationName = <span class="string"><span class="delimiter">&quot;</span><span class="content">PhysicalNewsTopic</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@MessageDriven</span>(activationConfig = {
    <span class="annotation">@ActivationConfigProperty</span>(propertyName = <span class="string"><span class="delimiter">&quot;</span><span class="content">destinationLookup</span><span class="delimiter">&quot;</span></span>,
            propertyValue = <span class="string"><span class="delimiter">&quot;</span><span class="content">java:module/jms/newsTopic</span><span class="delimiter">&quot;</span></span>),
    <span class="annotation">@ActivationConfigProperty</span>(propertyName = <span class="string"><span class="delimiter">&quot;</span><span class="content">destinationType</span><span class="delimiter">&quot;</span></span>,
            propertyValue = <span class="string"><span class="delimiter">&quot;</span><span class="content">jakarta.jms.Topic</span><span class="delimiter">&quot;</span></span>),
    <span class="annotation">@ActivationConfigProperty</span>(propertyName = <span class="string"><span class="delimiter">&quot;</span><span class="content">messageSelector</span><span class="delimiter">&quot;</span></span>,
            propertyValue = <span class="string"><span class="delimiter">&quot;</span><span class="content">NewsType = 'Sports' OR NewsType = 'Opinion'</span><span class="delimiter">&quot;</span></span>),
    <span class="annotation">@ActivationConfigProperty</span>(propertyName = <span class="string"><span class="delimiter">&quot;</span><span class="content">subscriptionDurability</span><span class="delimiter">&quot;</span></span>,
            propertyValue = <span class="string"><span class="delimiter">&quot;</span><span class="content">Durable</span><span class="delimiter">&quot;</span></span>),
    <span class="annotation">@ActivationConfigProperty</span>(propertyName = <span class="string"><span class="delimiter">&quot;</span><span class="content">clientId</span><span class="delimiter">&quot;</span></span>,
            propertyValue = <span class="string"><span class="delimiter">&quot;</span><span class="content">MyID</span><span class="delimiter">&quot;</span></span>),
    <span class="annotation">@ActivationConfigProperty</span>(propertyName = <span class="string"><span class="delimiter">&quot;</span><span class="content">subscriptionName</span><span class="delimiter">&quot;</span></span>,
            propertyValue = <span class="string"><span class="delimiter">&quot;</span><span class="content">MySub</span><span class="delimiter">&quot;</span></span>)
})</code></pre>
</div>
</div>
<div class="paragraph">
<p>The topic is the one defined in the <code>PublisherBean</code>.
The message selector in this case represents both the sports and opinion desks, just to demonstrate the syntax of message selectors.</p>
</div>
<div class="paragraph">
<p>The Jakarta Messaging resource adapter uses these properties to create a connection factory for the message-driven bean that allows the bean to use a durable subscription.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="running-the-clientsessionmdb-example"><a class="anchor" href="#running-the-clientsessionmdb-example"></a>Running the clientsessionmdb Example</h4>
<div class="paragraph">
<p>You can use either NetBeans IDE or Maven to build, deploy, and run the <code>simplemessage</code> example.</p>
</div>
<div class="paragraph">
<p>This example uses an annotation-defined topic and the preconfigured default connection factory <code>java:comp/DefaultJMSConnectionFactory</code>, so you do not have to create resources for it.</p>
</div>
<div class="sect4">
<h5 id="to-run-clientsessionmdb-using-netbeans-ide"><a class="anchor" href="#to-run-clientsessionmdb-using-netbeans-ide"></a>To Run clientsessionmdb Using NetBeans IDE</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>From the <strong>File</strong> menu, choose <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the <strong>Open Project</strong> dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/jms/clientsessionmdb</pre>
</div>
</div>
</li>
<li>
<p>Select the <code>clientsessionmdb</code> folder.</p>
</li>
<li>
<p>Make sure that the <strong>Open Required Projects</strong> check box is selected, then click <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the <strong>Projects</strong> tab, right-click the <code>clientsessionmdb</code> project and select <strong>Build</strong>.
(If NetBeans IDE suggests that you run a priming build, click the box to do so.)</p>
<div class="paragraph">
<p>This command creates the following:</p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>An application client JAR file that contains the client class file and the session bean&#8217;s remote interface, along with a manifest file that specifies the main class and places the Jakarta Enterprise Beans JAR file in its classpath</p>
</li>
<li>
<p>An enterprise bean JAR file that contains both the session bean and the message-driven bean</p>
</li>
<li>
<p>An application EAR file that contains the two JAR files</p>
<div class="paragraph">
<p>The <code>clientsessionmdb.ear</code> file is created in the <code>clientsessionmdb-ear/target/</code> directory.</p>
</div>
<div class="paragraph">
<p>The command then deploys the EAR file, retrieves the client stubs, and runs the client.</p>
</div>
<div class="paragraph">
<p>The client displays these lines:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>To view the bean output,
 check &lt;install_dir&gt;/domains/domain1/logs/server.log.</pre>
</div>
</div>
<div class="paragraph">
<p>The output from the enterprise beans appears in the server log file.
The Publisher session bean sends two sets of 18 messages numbered 0 through 17.
Because of the message selector, the message-driven bean receives only the messages whose <code>NewsType</code> property is <code>Sports</code> or <code>Opinion</code>.</p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Use the <strong>Services</strong> tab to undeploy the application after you have finished running it.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-run-clientsessionmdb-using-maven"><a class="anchor" href="#to-run-clientsessionmdb-using-maven"></a>To Run clientsessionmdb Using Maven</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>Go to the following directory:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/jms/clientsessionmdb/</pre>
</div>
</div>
</li>
<li>
<p>To compile the source files and package, deploy, and run the application, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">mvn install</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command creates the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An application client JAR file that contains the client class file and the session bean&#8217;s remote interface, along with a manifest file that specifies the main class and places the enterprise bean JAR file in its classpath</p>
</li>
<li>
<p>An enterprise bean JAR file that contains both the session bean and the message-driven bean</p>
</li>
<li>
<p>An application EAR file that contains the two JAR files</p>
<div class="paragraph">
<p>The <code>clientsessionmdb.ear</code> file is created in the <code>clientsessionmdb-ear/target/</code> directory.</p>
</div>
<div class="paragraph">
<p>The command then deploys the EAR file, retrieves the client stubs, and runs the client.</p>
</div>
<div class="paragraph">
<p>The client displays these lines:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>To view the bean output,
 check &lt;install_dir&gt;/domains/domain1/logs/server.log.</pre>
</div>
</div>
<div class="paragraph">
<p>The output from the enterprise beans appears in the server log file.
The Publisher session bean sends two sets of 18 messages numbered 0 through 17.
Because of the message selector, the message-driven bean receives only the messages whose <code>NewsType</code> property is <code>Sports</code> or <code>Opinion</code>.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Undeploy the application after you have finished running it:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">mvn cargo:undeploy</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-an-entity-to-join-messages-from-two-mdbs"><a class="anchor" href="#using-an-entity-to-join-messages-from-two-mdbs"></a>Using an Entity to Join Messages from Two MDBs</h3>
<div class="paragraph">
<p>This section explains how to write, compile, package, deploy, and run an application that uses the Jakarta Messaging with an entity.
The application uses the following components:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An application client that both sends and receives messages</p>
</li>
<li>
<p>Two message-driven beans</p>
</li>
<li>
<p>An entity class</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You will find the source files for this section in the <code><em>tut-install</em>/examples/jms/clientmdbentity/</code> directory.
Path names in this section are relative to this directory.</p>
</div>
<div class="sect3">
<h4 id="overview-of-the-clientmdbentity-example-application"><a class="anchor" href="#overview-of-the-clientmdbentity-example-application"></a>Overview of the clientmdbentity Example Application</h4>
<div class="paragraph">
<p>This application simulates, in a simplified way, the work flow of a company&#8217;s human resources (HR) department when it processes a new hire.
This application also demonstrates how to use the Jakarta EE platform to accomplish a task that many Messaging applications need to perform.</p>
</div>
<div class="paragraph">
<p>A messaging client must often wait for several messages from various sources.
It then uses the information in all these messages to assemble a message that it then sends to another destination.
The common term for this design pattern (which is not specific to Jakarta Messaging) is joining messages.
Such a task must be transactional, with all the receives and the send as a single transaction.
If not all the messages are received successfully, the transaction can be rolled back.
For an application client example that illustrates this task, see <a href="#using-local-transactions">Using Local Transactions</a>.</p>
</div>
<div class="paragraph">
<p>A message-driven bean can process only one message at a time in a transaction.
To provide the ability to join messages, an application can have the message-driven bean store the interim information in a Jakarta Persistence entity.
The entity can then determine whether all the information has been received; when it has, the entity can report this back to one of the message-driven beans, which then creates and sends the message to the other destination.
After it has completed its task, the entity can be removed.</p>
</div>
<div class="paragraph">
<p>The basic steps of the application are as follows.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The HR department&#8217;s application client generates an employee ID for each new hire and then publishes a message (M1) containing the new hire&#8217;s name, employee ID, and position.
It publishes the message to a topic because the message needs to be consumed by two message-driven beans.
The client then creates a temporary queue, <code>ReplyQueue</code>, with a message listener that waits for a reply to the message.
(See <a href="#creating-temporary-destinations">Creating Temporary Destinations</a> for more information.)</p>
</li>
<li>
<p>Two message-driven beans process each message: One bean, <code>OfficeMDB</code>, assigns the new hire&#8217;s office number, and the other bean, <code>EquipmentMDB</code>, assigns the new hire&#8217;s equipment.
The first bean to process the message creates and persists an entity named <code>SetupOffice</code>, then calls a business method of the entity to store the information it has generated.
The second bean locates the existing entity and calls another business method to add its information.</p>
</li>
<li>
<p>When both the office and the equipment have been assigned, the entity business method returns a value of <code>true</code> to the message-driven bean that called the method.
The message-driven bean then sends to the reply queue a message (M2) describing the assignments.
Then it removes the entity.
The application client&#8217;s message listener retrieves the information.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><a href="#an-enterprise-bean-application-client-to-message-driven-beans-to-entity">Figure 49-5</a> illustrates the structure of this application.
Of course, an actual HR application would have more components; other beans could set up payroll and benefits records, schedule orientation, and so on.</p>
</div>
<div class="paragraph">
<p><a href="#an-enterprise-bean-application-client-to-message-driven-beans-to-entity">Figure 49-5</a> assumes that <code>OfficeMDB</code> is the first message-driven bean to consume the message from the client.
<code>OfficeMDB</code> then creates and persists the <code>SetupOffice</code> entity and stores the office information.
<code>EquipmentMDB</code> then finds the entity, stores the equipment information, and learns that the entity has completed its work.
<code>EquipmentMDB</code> then sends the message to the reply queue and removes the entity.</p>
</div>
<div id="an-enterprise-bean-application-client-to-message-driven-beans-to-entity" class="imageblock">
<div class="content">
<img src="images/jakartaeett_dt_038.svg" alt="Diagram of application showing an application client, two message-driven beans, and an entity, as well as the associated topic and queue">
</div>
<div class="title">Figure 49-5 An Enterprise Bean Application: Client to Message-Driven Beans to Entity</div>
</div>
</div>
<div class="sect3">
<h4 id="writing-the-application-components-for-the-clientmdbentity-example"><a class="anchor" href="#writing-the-application-components-for-the-clientmdbentity-example"></a>Writing the Application Components for the clientmdbentity Example</h4>
<div class="paragraph">
<p>Writing the components of the application involves coding the application client, the message-driven beans, and the entity class.</p>
</div>
<div class="sect4">
<h5 id="coding-the-application-client-humanresourceclient-java"><a class="anchor" href="#coding-the-application-client-humanresourceclient-java"></a>Coding the Application Client: HumanResourceClient.java</h5>
<div class="paragraph">
<p>The application client, <code>HumanResourceClient.java</code>, found under <code>clientmdbentity-app-client</code>, performs the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Defines a topic for the application, using the <code>java:app</code> namespace because the topic is used in both the application client and the Jakarta Enterprise Beans module</p>
</li>
<li>
<p>Injects <code>ConnectionFactory</code> and <code>Topic</code> resources</p>
</li>
<li>
<p>Creates a <code>TemporaryQueue</code> to receive notification of processing that occurs, based on new-hire events it has published</p>
</li>
<li>
<p>Creates a <code>JMSConsumer</code> for the <code>TemporaryQueue</code>, sets the <code>JMSConsumer</code>'s message listener, and starts the connection</p>
</li>
<li>
<p>Creates a <code>MapMessage</code></p>
</li>
<li>
<p>Creates five new employees with randomly generated names, positions, and ID numbers (in sequence) and publishes five messages containing this information</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The message listener, <code>HRListener</code>, waits for messages that contain the assigned office and equipment for each employee.
When a message arrives, the message listener displays the information received and determines whether all five messages have arrived.
When they have, the message listener notifies the <code>main</code> method, which then exits.</p>
</div>
</div>
<div class="sect4">
<h5 id="coding-the-message-driven-beans-for-the-clientmdbentity-example"><a class="anchor" href="#coding-the-message-driven-beans-for-the-clientmdbentity-example"></a>Coding the Message-Driven Beans for the clientmdbentity Example</h5>
<div class="paragraph">
<p>This example uses two message-driven beans, both under <code>clientmdbentity-ejb</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>EquipmentMDB.java</code></p>
</li>
<li>
<p><code>OfficeMDB.java</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The beans take the following steps.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>They inject a <code>MessageDrivenContext</code> resource, an <code>EntityManager</code>, and a <code>JMSContext</code>.</p>
</li>
<li>
<p>The <code>onMessage</code> method retrieves the information in the message.
The <code>EquipmentMDB</code>'s <code>onMessage</code> method chooses equipment, based on the new hire&#8217;s position; the <code>OfficeMDB</code>'s <code>onMessage</code> method randomly generates an office number.</p>
</li>
<li>
<p>After a slight delay to simulate real world processing hitches, the <code>onMessage</code> method calls a helper method, <code>compose</code>.</p>
</li>
<li>
<p>The <code>compose</code> method takes the following steps.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>It either creates and persists the <code>SetupOffice</code> entity or finds it by primary key.</p>
</li>
<li>
<p>It uses the entity to store the equipment or the office information in the database, calling either the <code>doEquipmentList</code> or the <code>doOfficeNumber</code> business method.</p>
</li>
<li>
<p>If the business method returns <code>true</code>, meaning that all of the information has been stored, it retrieves the reply destination information from the message, creates a <code>JMSProducer</code>, and sends a reply message that contains the information stored in the entity.</p>
</li>
<li>
<p>It removes the entity.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="coding-the-entity-class-for-the-clientmdbentity-example"><a class="anchor" href="#coding-the-entity-class-for-the-clientmdbentity-example"></a>Coding the Entity Class for the clientmdbentity Example</h5>
<div class="paragraph">
<p>The <code>SetupOffice.java</code> class, also under <code>clientmdbentity-ejb</code>, is an entity class.
The entity and the message-driven beans are packaged together in an enterprise bean JAR file.
The entity class is declared as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Entity</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">SetupOffice</span> <span class="directive">implements</span> <span class="predefined-type">Serializable</span> { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The class contains a no-argument constructor and a constructor that takes two arguments, the employee ID and name.
It also contains getter and setter methods for the employee ID, name, office number, and equipment list.
The getter method for the employee ID has the <code>@Id</code> annotation to indicate that this field is the primary key:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Id</span>
<span class="directive">public</span> <span class="predefined-type">String</span> getEmployeeId() {
    <span class="keyword">return</span> id;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The class also implements the two business methods, <code>doEquipmentList</code> and <code>doOfficeNumber</code>, and their helper method, <code>checkIfSetupComplete</code>.</p>
</div>
<div class="paragraph">
<p>The message-driven beans call the business methods and the getter methods.</p>
</div>
<div class="paragraph">
<p>The <code>persistence.xml</code> file for the entity specifies the most basic settings:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;persistence</span> <span class="attribute-name">version</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">3.0</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">https://jakarta.ee/xml/ns/persistence</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">https://jakarta.ee/xml/ns/persistence</span>
               <span class="content">https://jakarta.ee/xml/ns/persistence/persistence_3_0.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;persistence-unit</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">clientmdbentity-ejbPU</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">transaction-type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">JTA</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;provider&gt;</span>org.eclipse.persistence.jpa.PersistenceProvider<span class="tag">&lt;/provider&gt;</span>
    <span class="tag">&lt;jta-data-source&gt;</span>java:comp/DefaultDataSource<span class="tag">&lt;/jta-data-source&gt;</span>
    <span class="tag">&lt;properties&gt;</span>
      <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">eclipselink.ddl-generation</span><span class="delimiter">&quot;</span></span>
                <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">drop-and-create-tables</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/properties&gt;</span>
  <span class="tag">&lt;/persistence-unit&gt;</span>
<span class="tag">&lt;/persistence&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="running-the-clientmdbentity-example"><a class="anchor" href="#running-the-clientmdbentity-example"></a>Running the clientmdbentity Example</h4>
<div class="paragraph">
<p>You can use either NetBeans IDE or Maven to build, deploy, and run the <code>clientmdbentity</code> example.</p>
</div>
<div class="paragraph">
<p>Because the example defines its own application-private topic and uses the preconfigured default connection factory <code>java:comp/DefaultJMSConnectionFactory</code> and the preconfigured default JDBC resource <code>java:comp/DefaultDataSource</code>, you do not need to create resources for it.</p>
</div>
<div class="sect4">
<h5 id="to-run-clientmdbentity-using-netbeans-ide"><a class="anchor" href="#to-run-clientmdbentity-using-netbeans-ide"></a>To Run clientmdbentity Using NetBeans IDE</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>), as well as the database server (see <a href="#starting-and-stopping-apache-derby">Starting and Stopping Apache Derby</a>).</p>
</li>
<li>
<p>From the <strong>File</strong> menu, choose <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the <strong>Open Project</strong> dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/jms/clientmdbentity</pre>
</div>
</div>
</li>
<li>
<p>Select the <code>clientmdbentity</code> folder.</p>
</li>
<li>
<p>Click <strong>Open Project</strong>.</p>
</li>
<li>
<p>In the <strong>Projects</strong> tab, right-click the <code>clientmdbentity</code> project and select <strong>Build</strong>.</p>
<div class="paragraph">
<p>This command creates the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An application client JAR file that contains the client class and listener class files, along with a manifest file that specifies the main class</p>
</li>
<li>
<p>An enterprise bean JAR file that contains the message-driven beans and the entity class, along with the <code>persistence.xml</code> file</p>
</li>
<li>
<p>An application EAR file that contains the two JAR files along with an <code>application.xml</code> file</p>
<div class="paragraph">
<p>The <code>clientmdbentity.ear</code> file is created in the <code>clientmdbentity-ear/target/</code> directory.</p>
</div>
<div class="paragraph">
<p>The command then deploys the EAR file, retrieves the client stubs, and runs the application client.</p>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-run-clientmdbentity-using-maven"><a class="anchor" href="#to-run-clientmdbentity-using-maven"></a>To Run clientmdbentity Using Maven</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>), as well as the database server (see <a href="#starting-and-stopping-apache-derby">Starting and Stopping Apache Derby</a>).</p>
</li>
<li>
<p>Go to the following directory:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/jms/clientmdbentity/</pre>
</div>
</div>
</li>
<li>
<p>To compile the source files and package, deploy, and run the application, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">mvn install</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command creates the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An application client JAR file that contains the client class and listener class files, along with a manifest file that specifies the main class</p>
</li>
<li>
<p>An enterprise bean JAR file that contains the message-driven beans and the entity class, along with the <code>persistence.xml</code> file</p>
</li>
<li>
<p>An application EAR file that contains the two JAR files along with an <code>application.xml</code> file</p>
<div class="paragraph">
<p>The command then deploys the application, retrieves the client stubs, and runs the application client.</p>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="viewing-the-application-output"><a class="anchor" href="#viewing-the-application-output"></a>Viewing the Application Output</h5>
<div class="paragraph">
<p>The output in the NetBeans IDE output window or in the terminal window looks something like this (preceded by application client container output and Maven output):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>SENDER: Setting hire ID to 50, name Bill Tudor, position Programmer
SENDER: Setting hire ID to 51, name Carol Jones, position Senior Programmer
SENDER: Setting hire ID to 52, name Mark Wilson, position Manager
SENDER: Setting hire ID to 53, name Polly Wren, position Senior Programmer
SENDER: Setting hire ID to 54, name Joe Lawrence, position Director
Waiting for 5 message(s)
New hire event processed:
  Employee ID: 52
  Name: Mark Wilson
  Equipment: Tablet
  Office number: 294
Waiting for 4 message(s)
New hire event processed:
  Employee ID: 53
  Name: Polly Wren
  Equipment: Laptop
  Office number: 186
Waiting for 3 message(s)
New hire event processed:
  Employee ID: 54
  Name: Joe Lawrence
  Equipment: Mobile Phone
  Office number: 135
Waiting for 2 message(s)
New hire event processed:
  Employee ID: 50
  Name: Bill Tudor
  Equipment: Desktop System
  Office number: 200
Waiting for 1 message(s)
New hire event processed:
  Employee ID: 51
  Name: Carol Jones
  Equipment: Laptop
  Office number: 262</pre>
</div>
</div>
<div class="paragraph">
<p>The output from the message-driven beans and the entity class appears in the server log.</p>
</div>
<div class="paragraph">
<p>For each employee, the application first creates the entity and then finds it.
You may see runtime errors in the server log, and transaction rollbacks may occur.
The errors occur if both of the message-driven beans discover at the same time that the entity does not yet exist, so they both try to create it.
The first attempt succeeds, but the second fails because the bean already exists.
After the rollback, the second message-driven bean tries again and succeeds in finding the entity.
Container-managed transactions allow the application to run correctly, in spite of these errors, with no special programming.</p>
</div>
<div class="paragraph">
<p>To undeploy the application after you have finished running it, use the Services tab or issue the <code>mvn cargo:undeploy</code> command.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-netbeans-ide-to-create-jakarta-messaging-resources"><a class="anchor" href="#using-netbeans-ide-to-create-jakarta-messaging-resources"></a>Using NetBeans IDE to Create Jakarta Messaging Resources</h3>
<div class="paragraph">
<p>When you write your own Messaging applications, you will need to create resources for them.
This section explains how to use NetBeans IDE to create <code>src/main/setup/glassfish-resources.xml</code> files similar to those used in the examples in this chapter.
It also explains how to use NetBeans IDE to delete the resources.</p>
</div>
<div class="paragraph">
<p>You can also create, list, and delete Jakarta Messaging resources using the Administration Console or the <code>asadmin create-jms-resource</code>, <code>asadmin list-jms-resources</code>, and <code>asadmin delete-jms-resources</code> commands.
For information, consult the GlassFish Server documentation or enter <code>asadmin help</code> command-name.</p>
</div>
<div class="sect3">
<h4 id="to-create-jakarta-messaging-resources-using-netbeans-ide"><a class="anchor" href="#to-create-jakarta-messaging-resources-using-netbeans-ide"></a>To Create Jakarta Messaging Resources Using NetBeans IDE</h4>
<div class="paragraph">
<p>Follow these steps to create a Jakarta Messaging resource in GlassFish Server using NetBeans IDE.
Repeat these steps for each resource you need.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Right-click the project for which you want to create resources and select <strong>New</strong>, then select <strong>Other</strong>.</p>
</li>
<li>
<p>In the <strong>New File</strong> wizard, under <strong>Categories</strong>, select <strong>GlassFish</strong>.</p>
</li>
<li>
<p>Under <strong>File Types</strong>, select <strong>JMS Resource</strong>.</p>
</li>
<li>
<p>On the General Attributes - JMS Resource page, in the JNDI Name field, enter the name of the resource.</p>
<div class="paragraph">
<p>By convention, Messaging resource names begin with <code>jms/</code>.</p>
</div>
</li>
<li>
<p>Select the option for the resource type.</p>
<div class="paragraph">
<p>Normally, this is either <code>jakarta.jms.Queue</code>, <code>jakarta.jms.Topic</code>, or <code>jakarta.jms.ConnectionFactory</code>.</p>
</div>
</li>
<li>
<p>Click <strong>Next</strong>.</p>
</li>
<li>
<p>On the JMS Properties page, for a queue or topic, enter a name for a physical queue in the Value field for the Name property.</p>
<div class="paragraph">
<p>You can enter any value for this required field.</p>
</div>
<div class="paragraph">
<p>Connection factories have no required properties.
In a few situations, you may need to specify a property.</p>
</div>
</li>
<li>
<p>Click <strong>Finish</strong>.</p>
<div class="paragraph">
<p>A file named <code>glassfish-resources.xml</code> is created in your Maven project, in a directory named <code>src/main/setup/</code>.
In the Projects tab, you can find it under the Other Sources node.
You will need to run the <code>asadmin add-resources</code> command to create the resources in GlassFish Server.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="to-delete-jakarta-messaging-resources-using-netbeans-ide"><a class="anchor" href="#to-delete-jakarta-messaging-resources-using-netbeans-ide"></a>To Delete Jakarta Messaging Resources Using NetBeans IDE</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the <strong>Services</strong> tab, expand the <strong>Servers</strong> node, then expand the <strong>GlassFish Server</strong> node.</p>
</li>
<li>
<p>Expand the <strong>Resources</strong> node, then expand the <strong>Connector Resources</strong> node.</p>
</li>
<li>
<p>Expand the <strong>Admin Object Resources</strong> node.</p>
</li>
<li>
<p>Right-click any destination you want to remove and select <strong>Unregister</strong>.</p>
</li>
<li>
<p>Expand the <strong>Connector Connection Pools</strong> node.</p>
</li>
<li>
<p>Right-click the connection pool that corresponds to the connection factory you removed and select <strong>Unregister</strong>.</p>
<div class="paragraph">
<p>When you remove a connector connection pool, the associated connector resource is also deleted.
This action removes the connection factory.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<h1 id="security-2" class="sect0"><a class="anchor" href="#security-2"></a>Part X: Security</h1>
<div class="openblock partintro">
<div class="content">
Part X explores security concepts and examples.
</div>
</div>
<div class="sect1">
<h2 id="introduction-to-security-in-the-jakarta-ee-platform"><a class="anchor" href="#introduction-to-security-in-the-jakarta-ee-platform"></a>Chapter 50. Introduction to Security in the Jakarta EE Platform</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter introduces basic security concepts and security mechanisms.
More information on these concepts and mechanisms can be found in the chapter on security in the Jakarta EE 9 specification.</p>
</div>
<div class="sect2">
<h3 id="overview-of-jakarta-security"><a class="anchor" href="#overview-of-jakarta-security"></a>Overview of Jakarta Security</h3>
<div class="paragraph">
<p>Every enterprise that has either sensitive resources that can be accessed by many users or resources that traverse unprotected, open networks, such as the Internet, needs to be protected.</p>
</div>
<div class="paragraph">
<p>Enterprise tier and web tier applications are made up of components that are deployed into various containers.
These components are combined to build a multitier enterprise application.
Security for components is provided by their containers.
A container provides two kinds of security: declarative and programmatic.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Declarative security expresses an application component&#8217;s security requirements by using either deployment descriptors or annotations.</p>
<div class="paragraph">
<p>A deployment descriptor is an XML file that is external to the application and that expresses an application&#8217;s security structure, including security roles, access control, and authentication requirements.
For more information about deployment descriptors, read <a href="#using-deployment-descriptors-for-declarative-security">Using Deployment Descriptors for Declarative Security</a>.</p>
</div>
<div class="paragraph">
<p>Annotations, also called metadata, are used to specify information about security within a class file.
When the application is deployed, this information can be either used by or overridden by the application deployment descriptor.
Annotations save you from having to write declarative information inside XML descriptors.
Instead, you simply put annotations on the code, and the required information gets generated.
For this tutorial, annotations are used for securing applications wherever possible.
For more information about annotations, see
<a href="#using-annotations-to-specify-security-information">Using Annotations to Specify Security Information</a>.</p>
</div>
</li>
<li>
<p>Programmatic security is embedded in an application and is used to make security decisions.
Programmatic security is useful when declarative security alone is not sufficient to express the security model of an application.
For more information about programmatic security, read <a href="#using-programmatic-security">Using Programmatic Security</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Jakarta EE 9 includes a Security API specification that defines portable, plug-in interfaces for authentication and identity stores, and a new injectable-type <code>SecurityContext</code> interface that provides an access point for programmatic security.
You can use the built-in implementations of these APIs, or define custom implementations.</p>
</div>
<div class="paragraph">
<p>More information on these concepts and mechanisms can be found in the chapter on security in the Jakarta EE 9 specification.</p>
</div>
<div class="paragraph">
<p>Other chapters in this Part discuss security requirements in web tier and enterprise tier applications, and the Jakarta Security.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#getting-started-securing-web-applications">Chapter 51, <em>Getting Started Securing Web Applications</em></a> explains how to add security to web components, such as servlets.</p>
</li>
<li>
<p><a href="#getting-started-securing-enterprise-applications">Chapter 52, <em>Getting Started Securing Enterprise Applications</em></a> explains how to add security to Jakarta EE components, such as enterprise beans and application clients.</p>
</li>
<li>
<p><a href="#using-jakarta-security">Chapter 53, <em>Using Jakarta Security</em></a> describes the authentication and credential validation funtionality provided by Jakarta Security, and provides examples.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="a-simple-application-security-walkthrough"><a class="anchor" href="#a-simple-application-security-walkthrough"></a>A Simple Application Security Walkthrough</h4>
<div class="paragraph">
<p>The security behavior of a Jakarta EE environment may be better understood by examining what happens in a simple application with a web client, a user interface, and enterprise bean business logic.</p>
</div>
<div class="paragraph">
<p>In the following example, which is taken from the Jakarta EE Specification, the web client relies on the web server to act as its authentication proxy by collecting user authentication data from the client and using it to establish an authenticated session.</p>
</div>
<div class="sect4">
<h5 id="step-1-initial-request"><a class="anchor" href="#step-1-initial-request"></a>Step 1: Initial Request</h5>
<div class="paragraph">
<p>In the first step of this example, the web client requests the main application URL.
This action is shown in <a href="#initial-request">Figure 50-1</a>.</p>
</div>
<div id="initial-request" class="imageblock">
<div class="content">
<img src="images/jakartaeett_dt_039.svg" alt="Diagram of initial request from web client to web server for access to a protected resource">
</div>
<div class="title">Figure 50-1 Initial Request</div>
</div>
<div class="paragraph">
<p>Since the client has not yet authenticated itself to the application environment, the server responsible for delivering the web portion of the application, hereafter referred to as the web server, detects this and invokes the appropriate authentication mechanism for this resource.
For more information on these mechanisms, see <a href="#security-mechanisms">Security Mechanisms</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="step-2-initial-authentication"><a class="anchor" href="#step-2-initial-authentication"></a>Step 2: Initial Authentication</h5>
<div class="paragraph">
<p>The web server returns a form that the web client uses to collect authentication data, such as user name and password, from the user.
The web client forwards the authentication data to the web server, where it is validated by the web server, as shown in <a href="#initial-authentication">Figure 50-2</a>.
The validation mechanism may be local to a server or may leverage the underlying security services.
On the basis of the validation, the web server sets a credential for the user.</p>
</div>
<div id="initial-authentication" class="imageblock">
<div class="content">
<img src="images/jakartaeett_dt_040.svg" alt="Diagram of initial authentication: server sends form to client, which sends authentication data to server for validation">
</div>
<div class="title">Figure 50-2 Initial Authentication</div>
</div>
</div>
<div class="sect4">
<h5 id="step-3-url-authorization"><a class="anchor" href="#step-3-url-authorization"></a>Step 3: URL Authorization</h5>
<div class="paragraph">
<p>The credential is used for future determinations of whether the user is authorized to access restricted resources it may request.
The web server consults the security policy associated with the web resource to determine the security roles that are permitted access to the resource.
The security policy is derived from annotations or from the deployment descriptor.
The web container then tests the user&#8217;s credential against each role to determine whether it can map the user to the role.
<a href="#url-authorization">Figure 50-3</a> shows this process.</p>
</div>
<div id="url-authorization" class="imageblock">
<div class="content">
<img src="images/jakartaeett_dt_041.svg" alt="Diagram of URL authorization">
</div>
<div class="title">Figure 50-3 URL Authorization</div>
</div>
<div class="paragraph">
<p>The web server&#8217;s evaluation stops with an "is authorized" outcome when the web server is able to map the user to a role.
A "not authorized" outcome is reached if the web server is unable to map the user to any of the permitted roles.</p>
</div>
</div>
<div class="sect4">
<h5 id="step-4-fulfilling-the-original-request"><a class="anchor" href="#step-4-fulfilling-the-original-request"></a>Step 4: Fulfilling the Original Request</h5>
<div class="paragraph">
<p>If the user is authorized, the web server returns the result of the original URL request, as shown in <a href="#fulfilling-the-original-request">Figure 50-4</a>.</p>
</div>
<div id="fulfilling-the-original-request" class="imageblock">
<div class="content">
<img src="images/jakartaeett_dt_042.svg" alt="Diagram of request fulfillment, showing server returning result to client">
</div>
<div class="title">Figure 50-4 Fulfilling the Original Request</div>
</div>
<div class="paragraph">
<p>In our example, the response URL of a web page is returned, enabling the user to post form data that needs to be handled by the business-logic component of the application.
See <a href="#getting-started-securing-web-applications">Chapter 51, <em>Getting Started Securing Web Applications</em></a> for more information on protecting web applications.</p>
</div>
</div>
<div class="sect4">
<h5 id="step-5-invoking-enterprise-bean-business-methods"><a class="anchor" href="#step-5-invoking-enterprise-bean-business-methods"></a>Step 5: Invoking Enterprise Bean Business Methods</h5>
<div class="paragraph">
<p>The web page performs the remote method call to the enterprise bean, using the user&#8217;s credential to establish a secure association between the web page and the enterprise bean, as shown in <a href="#invoking-an-enterprise-bean-business-method">Figure 50-5</a>.
The association is implemented as two related security contexts: one in the web server and one in the enterprise bean container.</p>
</div>
<div id="invoking-an-enterprise-bean-business-method" class="imageblock">
<div class="content">
<img src="images/jakartaeett_dt_043.svg" alt="Diagram of authorization process between web component and enterprise bean">
</div>
<div class="title">Figure 50-5 Invoking an Enterprise Bean Business Method</div>
</div>
<div class="paragraph">
<p>The enterprise container is responsible for enforcing access control on the enterprise bean method.
The container consults the security policy associated with the enterprise bean to determine the security roles that are permitted access to the method.
The security policy is derived from annotations or from the deployment descriptor.
For each role, the enterprise bean container determines whether it can map the caller to the role by using the security context associated with the call.</p>
</div>
<div class="paragraph">
<p>The container&#8217;s evaluation stops with an "is authorized" outcome when the container is able to map the caller&#8217;s credential to a role.
A "not authorized" outcome is reached if the container is unable to map the caller to any of the permitted roles.
A "not authorized" result causes an exception to be thrown by the container and propagated back to the calling web page.</p>
</div>
<div class="paragraph">
<p>If the call is authorized, the container dispatches control to the enterprise bean method.
The result of the bean&#8217;s execution of the call is returned to the web page and ultimately to the user by the web server and the web client.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="features-of-a-security-mechanism"><a class="anchor" href="#features-of-a-security-mechanism"></a>Features of a Security Mechanism</h4>
<div class="paragraph">
<p>A properly implemented security mechanism will provide the following functionality:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Prevent unauthorized access to application functions and business or personal data (authentication)</p>
</li>
<li>
<p>Hold system users accountable for operations they perform (non-repudiation)</p>
</li>
<li>
<p>Protect a system from service interruptions and other breaches that affect quality of service</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Ideally, properly implemented security mechanisms will also be</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Easy to administer</p>
</li>
<li>
<p>Transparent to system users</p>
</li>
<li>
<p>Interoperable across application and enterprise boundaries</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="characteristics-of-application-security"><a class="anchor" href="#characteristics-of-application-security"></a>Characteristics of Application Security</h4>
<div class="paragraph">
<p>Jakarta EE applications consist of components that can contain both protected and unprotected resources.
Often, you need to protect resources to ensure that only authorized users have access.
Authorization provides controlled access to protected resources.
Authorization is based on identification and authentication.
Identification is a process that enables recognition of an entity by a system, and authentication is a process that verifies the identity of a user, device, or other entity in a computer system, usually as a prerequisite to allowing access to resources in a system.</p>
</div>
<div class="paragraph">
<p>Authorization and authentication are not required for an entity to access unprotected resources.
Accessing a resource without authentication is referred to as unauthenticated, or anonymous, access.</p>
</div>
<div class="paragraph">
<p>The characteristics of application security that, when properly addressed, help to minimize the security threats faced by an enterprise include the following.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Authentication: The means by which communicating entities, such as client and server, prove to each other that they are acting on behalf of specific identities that are authorized for access.
This ensures that users are who they say they are.</p>
</li>
<li>
<p>Authorization, or access control: The means by which interactions with resources are limited to collections of users or programs for the purpose of enforcing integrity, confidentiality, or availability constraints.
This ensures that users have permission to perform operations or access data.</p>
</li>
<li>
<p>Data integrity: The means used to prove that information has not been modified by a third party, an entity other than the source of the information.
For example, a recipient of data sent over an open network must be able to detect and discard messages that were modified after they were sent.
This ensures that only authorized users can modify data.</p>
</li>
<li>
<p>Confidentiality, or data privacy: The means used to ensure that information is made available only to users who are authorized to access it.
This ensures that only authorized users can view sensitive data.</p>
</li>
<li>
<p>Non-repudiation: The means used to prove that a user who performed some action cannot reasonably deny having done so.
This ensures that transactions can be proved to have happened.</p>
</li>
<li>
<p>Quality of Service: The means used to provide better service to selected network traffic over various technologies.</p>
</li>
<li>
<p>Auditing: The means used to capture a tamper-resistant record of security-related events for the purpose of being able to evaluate the effectiveness of security policies and mechanisms.
To enable this, the system maintains a record of transactions and security information.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="security-mechanisms"><a class="anchor" href="#security-mechanisms"></a>Security Mechanisms</h3>
<div class="paragraph">
<p>The characteristics of an application should be considered when deciding the layer and type of security to be provided for applications.
The following sections discuss the characteristics of the common mechanisms that can be used to secure Jakarta EE applications.
Each of these mechanisms can be used individually or with others to provide protection layers based on the specific needs of your implementation.</p>
</div>
<div class="sect3">
<h4 id="java-se-security-mechanisms"><a class="anchor" href="#java-se-security-mechanisms"></a>Java SE Security Mechanisms</h4>
<div class="paragraph">
<p>Java SE provides support for a variety of security features and mechanisms.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Java Authentication and Authorization Service (JAAS) is a set of APIs that enable services to authenticate and enforce access controls upon users.
JAAS provides a pluggable and extensible framework for programmatic user authentication and authorization.
JAAS is a core Java SE API and is an underlying technology for Jakarta EE security mechanisms.</p>
</li>
<li>
<p>Java Generic Security Services (Java GSS-API) is a token-based API used to securely exchange messages between communicating applications.
The GSS-API offers application programmers uniform access to security services atop a variety of underlying security mechanisms, including Kerberos.</p>
</li>
<li>
<p>Java Cryptography Extension (JCE) provides a framework and implementations for encryption, key generation and key agreement, and Message Authentication Code (MAC) algorithms.
Support for encryption includes symmetric, asymmetric, block, and stream ciphers.
Block ciphers operate on groups of bytes; stream ciphers operate on one byte at a time.
The software also supports secure streams and sealed objects.</p>
</li>
<li>
<p>Java Secure Sockets Extension (JSSE) provides a framework and an implementation for a Java version of the Secure Sockets Layer (SSL) and Transport Layer Security (TLS) protocols and includes functionality for data encryption, server authentication, message integrity, and optional client authentication to enable secure Internet communications.</p>
</li>
<li>
<p>Simple Authentication and Security Layer (SASL) is an Internet standard (RFC 2222) that specifies a protocol for authentication and optional establishment of a security layer between client and server applications.
SASL defines how authentication data is to be exchanged but does not itself specify the contents of that data.
SASL is a framework into which specific authentication mechanisms that specify the contents and semantics of the authentication data can fit.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Java SE also provides a set of tools for managing keystores, certificates, and policy files; generating and verifying JAR signatures; and obtaining, listing, and managing Kerberos tickets.</p>
</div>
<div class="paragraph">
<p>For more information on Java SE security, visit <a href="https://docs.oracle.com/javase/8/docs/technotes/guides/security/" class="bare" target="_blank" rel="noopener">https://docs.oracle.com/javase/8/docs/technotes/guides/security/</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="jakarta-ee-security-mechanisms"><a class="anchor" href="#jakarta-ee-security-mechanisms"></a>Jakarta EE Security Mechanisms</h4>
<div class="paragraph">
<p>Jakarta EE security services are provided by the component container and can be implemented by using declarative or programmatic techniques (see <a href="#securing-containers">Securing Containers</a>).
Jakarta EE security services provide a robust and easily configured security mechanism for authenticating users and authorizing access to application functions and associated data at many different layers.
Jakarta EE security services are separate from the security mechanisms of the operating system.</p>
</div>
<div class="sect4">
<h5 id="application-layer-security"><a class="anchor" href="#application-layer-security"></a>Application-Layer Security</h5>
<div class="paragraph">
<p>In Jakarta EE, component containers are responsible for providing application-layer security, security services for a specific application type tailored to the needs of the application.
At the application layer, application firewalls can be used to enhance application protection by protecting the communication stream and all associated application resources from attacks.</p>
</div>
<div class="paragraph">
<p>Jakarta Security is easy to implement and configure and can offer fine-grained access control to application functions and data.
However, as is inherent to security applied at the application layer, security properties are not transferable to applications running in other environments and protect data only while it is residing in the application environment.
In the context of a traditional enterprise application, this is not necessarily a problem, but when applied to a web services application, in which data often travels across several intermediaries, you would need to use the Jakarta EE security mechanisms along with transport-layer security and message-layer security for a complete security solution.</p>
</div>
<div class="paragraph">
<p>The advantages of using application-layer security include the following.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Security is uniquely suited to the needs of the application.</p>
</li>
<li>
<p>Security is fine grained, with application-specific settings.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The disadvantages of using application-layer security include the following.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The application is dependent on security attributes that are not transferable between application types.</p>
</li>
<li>
<p>Support for multiple protocols makes this type of security vulnerable.</p>
</li>
<li>
<p>Data is close to or contained within the point of vulnerability.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information on providing security at the application layer, see <a href="#securing-containers">Securing Containers</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="transport-layer-security"><a class="anchor" href="#transport-layer-security"></a>Transport-Layer Security</h5>
<div class="paragraph">
<p>Transport-layer security is provided by the transport mechanisms used to transmit information over the wire between clients and providers; thus, transport-layer security relies on secure HTTP transport (HTTPS) using Secure Sockets Layer (SSL).
Transport security is a point-to-point security mechanism that can be used for authentication, message integrity, and confidentiality.
When running over an SSL-protected session, the server and client can authenticate each other and negotiate an encryption algorithm and cryptographic keys before the application protocol transmits or receives its first byte of data.
Security is active from the time the data leaves the client until it arrives at its destination, or vice versa, even across intermediaries.
The problem is that the data is not protected once it gets to the destination.
One solution is to encrypt the message before sending.</p>
</div>
<div class="paragraph">
<p>Transport-layer security is performed in a series of phases, as follows.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The client and server agree on an appropriate algorithm.</p>
</li>
<li>
<p>A key is exchanged using public-key encryption and certificate-based authentication.</p>
</li>
<li>
<p>A symmetric cipher is used during the information exchange.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Digital certificates are necessary when running HTTPS using SSL.
The HTTPS service of most web servers will not run unless a digital certificate has been installed.
Digital certificates have already been created for GlassFish Server.</p>
</div>
<div class="paragraph">
<p>The advantages of using transport-layer security include the following.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It is relatively simple, well-understood, standard technology.</p>
</li>
<li>
<p>It applies to both a message body and its attachments.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The disadvantages of using transport-layer security include the following.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It is tightly coupled with the transport-layer protocol.</p>
</li>
<li>
<p>It represents an all-or-nothing approach to security.
This implies that the security mechanism is unaware of message contents, so that you cannot selectively apply security to portions of the message as you can with message-layer security.</p>
</li>
<li>
<p>Protection is transient.
The message is protected only while in transit.
Protection is removed automatically by the endpoint when it receives the message.</p>
</li>
<li>
<p>It is not an end-to-end solution, simply point-to-point.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information on transport-layer security, see <a href="#establishing-a-secure-connection-using-ssl">Establishing a Secure Connection Using SSL</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="message-layer-security"><a class="anchor" href="#message-layer-security"></a>Message-Layer Security</h5>
<div class="paragraph">
<p>In message-layer security, security information is contained within the SOAP message and/or SOAP message attachment, which allows security information to travel along with the message or attachment.
For example, a portion of the message may be signed by a sender and encrypted for a particular receiver.
When sent from the initial sender, the message may pass through intermediate nodes before reaching its intended receiver.
In this scenario, the encrypted portions continue to be opaque to any intermediate nodes and can be decrypted only by the intended receiver.
For this reason, message-layer security is also sometimes referred to as end-to-end security.</p>
</div>
<div class="paragraph">
<p>The advantages of message-layer security include the following.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Security stays with the message over all hops and after the message arrives at its destination.</p>
</li>
<li>
<p>Security can be selectively applied to different portions of a message and, if using XML Web Services Security, to attachments.</p>
</li>
<li>
<p>Message security can be used with intermediaries over multiple hops.</p>
</li>
<li>
<p>Message security is independent of the application environment or transport protocol.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The disadvantage of using message-layer security is that it is relatively complex and adds some overhead to processing.</p>
</div>
<div class="paragraph">
<p>GlassFish Server supports message security using Metro, a web services stack that uses Web Services Security (WSS) to secure messages.
Because this message security is specific to Metro and is not a part of the Jakarta EE platform, this tutorial does not discuss using WSS to secure messages.
See the Metro User&#8217;s Guide at <a href="https://eclipse-ee4j.github.io/metro-jax-ws/" class="bare" target="_blank" rel="noopener">https://eclipse-ee4j.github.io/metro-jax-ws/</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-pluggable-providers"><a class="anchor" href="#using-pluggable-providers"></a>Using Pluggable Providers</h3>
<div class="paragraph">
<p>Jakarta EE includes two specifications that define SPI interfaces for pluggable security providers, Jakarta Authentication and Jakarta Security.
These specifications are described in more detail in the following sections:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#jakarta-authentication">Jakarta Authentication</a></p>
</li>
<li>
<p><a href="#jakarta-security-2">Jakarta Security</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="jakarta-authentication-2"><a class="anchor" href="#jakarta-authentication-2"></a>Jakarta Authentication</h4>
<div class="paragraph">
<p>Jakarta Authentication defines a model for securing messages sent between a client and server in which the sender of a message "secures" it, and the receiver "validates" it.
The details of how messages are secured and validated are undefined by the model; support for securing and validating particular types of messages is provided by "auth modules"&#8201;&#8212;&#8201;implementations of the Authentication <code>ClientAuthModule</code> and <code>ServerAuthModule</code> interfaces&#8201;&#8212;&#8201;that support particular protocols or message types, and that plug in to the Authentication framework.
(Note that it is not necessary for a client and server to both use Authentication, as long as both sides process messages correctly for a given protocol.)</p>
</div>
<div class="paragraph">
<p>Authentication defines two "profiles" for integrating Authentication auth modules into Jakarta EE containers: the Servlet Container Profile, and the SOAP Profile.
Each specifies how Authentication message processing must be integrated into the request processing flow of the container in question to validate incoming requests and secure outgoing responses.</p>
</div>
<div class="paragraph">
<p>In the case of the Servlet Container Profile, if a <code>ServerAuthModule</code> is configured/available for a given application context, then the modules&#8217;s <code>validateRequest()</code> method must be invoked (and succeed) before authorizing access and calling the target servlet, and the module&#8217;s <code>secureResponse()</code> method must be called before returning a response.
Typically, a <code>ServerAuthModule</code> written for the Servlet Container Profile looks for user credentials or tokens in an incoming request, and then uses them to authenticate the caller and establish the caller&#8217;s identity.
A <code>ServerAuthModule</code> may also engage in a challenge/response protocol with the client, or negotiate with a third party to establish/verify the client&#8217;s identity.</p>
</div>
<div class="paragraph">
<p>As with the Servlet Container Profile, the SOAP Profile requires that <code>validateRequest()</code> be called and succeed before proceeding to authorize access and perform any further processing of an incoming message, and that <code>secureResponse()</code> is called for the response before it is sent.
In contrast to the Servlet Container Profile, <code>validateRequest()</code> processing for SOAP messages typically involves verifying signatures on signed elements, decrypting encrypted elements, and/or establishing the identity of a SOAP actor based on a token included in the message, while <code>secureResponse()</code> typically involves signing and/or encrypting elements of the outbound message.</p>
</div>
<div class="paragraph">
<p>Authentication does not define any standard or built-in ServerAuthModules; they must be provided either by the application using the module, or as a non-standard extension of a particular vendor&#8217;s Jakarta EE product.
ServerAuthModules can sometimes be directly configured for an application in a vendor-specific way, but the standard mechanism for making a <code>ServerAuthModule</code> available to an application is to register a corresponding <code>AuthConfigProvider</code> with the global <code>AuthConfigFactory</code>.
An <code>AuthConfigProvider</code> makes a <code>ServerAuthModule</code> available to the container, via a series of intermediary objects, for runtime message processing.</p>
</div>
</div>
<div class="sect3">
<h4 id="jakarta-security-2"><a class="anchor" href="#jakarta-security-2"></a>Jakarta Security</h4>
<div class="paragraph">
<p>Jakarta Security defines the following authentication-related plugin SPIs:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>HttpAuthenticationMechanism</code> - An interface for modules that authenticate callers to a web application.
It defines three methods that correspond to the methods of a Authentication <code>ServerAuthModule</code>, albeit with slightly different signatures.
An <code>HttpAuthenticationMechanism</code> provides similar functionality to a <code>ServerAuthModule</code>, and the Servlet Container uses a special <code>ServerAuthModule</code> to invoke the HttpAuthenticationMechanism&#8217;s methods, but HttpAuthenticationMechanisms are simpler to write, and to deploy, than are ServerAuthModules.</p>
</li>
<li>
<p><code>IdentityStore</code> - This interface defines methods for validating a caller&#8217;s credentials (such as username and password) and returning group membership information.
IdentityStores are invoked under the control of an <code>IdentityStoreHandler</code>, which, if multiple IdentityStores are present, calls the available IdentityStores in a specific order and aggregates the results.</p>
</li>
<li>
<p><code>RememberMeIdentityStore</code> - This interface is a variation on the <code>IdentityStore</code> interface, intended specifically to address cases where an authenticated user&#8217;s identity should be remembered for an extended period of time, so that the caller can return to the application periodically without needing to present primary authentication credentials each time.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Implementations of these SPI interfaces are CDI beans, and, as such, applications can provide implementations that support application-specific authentication mechanisms, or validate user credentials against application-specific identity stores, simply by including them in a bean archive that is part of the deployed application.
There are also several standard, built-in implementations of <code>HttpAuthenticationMechanism</code> and <code>IdentityStore</code> that provide configurable support for common authentication and credential validation use cases, without the need to write custom implementations.</p>
</div>
<div class="paragraph">
<p>Because these SPIs, related annotations, and the CDI deployment mechanism are all part of standard Jakarta EE, implementations are completely portable (to the extent they do not rely internally on platform-specific APIs or libraries) and can be portably deployed to any Jakarta EE server.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="securing-containers"><a class="anchor" href="#securing-containers"></a>Securing Containers</h3>
<div class="paragraph">
<p>In Jakarta EE, the component containers are responsible for providing application security.
A container provides two types of security: declarative and programmatic.</p>
</div>
<div class="sect3">
<h4 id="using-annotations-to-specify-security-information"><a class="anchor" href="#using-annotations-to-specify-security-information"></a>Using Annotations to Specify Security Information</h4>
<div class="paragraph">
<p>Annotations enable a declarative style of programming and so encompass both the declarative and programmatic security concepts.
Users can specify information about security within a class file by using annotations.
GlassFish Server uses this information when the application is deployed.
Not all security information can be specified by using annotations, however.
Some information must be specified in the application deployment descriptors.</p>
</div>
<div class="paragraph">
<p>Specific annotations that can be used to specify security information within an enterprise bean class file are described in <a href="#securing-an-enterprise-bean-using-declarative-security">Securing an Enterprise Bean Using Declarative Security</a>.
<a href="#getting-started-securing-web-applications">Chapter 51, <em>Getting Started Securing Web Applications</em></a>, describes how to use annotations to secure web applications where possible.
Deployment descriptors are described only where necessary.</p>
</div>
<div class="paragraph">
<p>For more information on annotations, see <a href="#further-information-about-security">Further Information about Security</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="using-deployment-descriptors-for-declarative-security"><a class="anchor" href="#using-deployment-descriptors-for-declarative-security"></a>Using Deployment Descriptors for Declarative Security</h4>
<div class="paragraph">
<p>Declarative security can express an application component&#8217;s security requirements by using deployment descriptors.
Because deployment descriptor information is declarative, it can be changed without the need to modify the source code.
At runtime, the Jakarta EE server reads the deployment descriptor and acts upon the corresponding application, module, or component accordingly.
Deployment descriptors must provide certain structural information for each component if this information has not been provided in annotations or is not to be defaulted.</p>
</div>
<div class="paragraph">
<p>This part of the tutorial does not document how to create deployment descriptors; it describes only the elements of the deployment descriptor relevant to security.
NetBeans IDE provides tools for creating and modifying deployment descriptors.</p>
</div>
<div class="paragraph">
<p>Different types of components use different formats, or schemas, for their deployment descriptors.
The security elements of deployment descriptors discussed in this tutorial include the following.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Web components may use a web application deployment descriptor named <code>web.xml</code>.</p>
<div class="paragraph">
<p>The schema for web component deployment descriptors is provided in Chapter 14 of the Jakarta Servlet 5.0 specification, which can be downloaded from <a href="https://jakarta.ee/specifications/servlet/5.0/" class="bare" target="_blank" rel="noopener">https://jakarta.ee/specifications/servlet/5.0/</a>.</p>
</div>
</li>
<li>
<p>Jakarta Enterprise Beans components may use an enterprise bean deployment descriptor named <code>META-INF/ejb-jar.xml</code>, contained in the enterprise bean JAR file.</p>
<div class="paragraph">
<p>The schema for enterprise bean deployment descriptors is provided in Chapter 13 of the Jakarta Enterprise Beans 4.0 Core Contracts and Requirements Specification, which can be downloaded from <a href="https://jakarta.ee/specifications/enterprise-beans/4.0/" class="bare" target="_blank" rel="noopener">https://jakarta.ee/specifications/enterprise-beans/4.0/</a>.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="using-programmatic-security"><a class="anchor" href="#using-programmatic-security"></a>Using Programmatic Security</h4>
<div class="paragraph">
<p>Programmatic security is embedded in an application and is used to make security decisions.
Programmatic security is useful when declarative security alone is not sufficient to express the security model of an application.
The API for programmatic security consists of methods of the Jakarta Security <code>SecurityContext</code> interface, and methods of the enterprise bean <code>EJBContext</code> interface and the servlet <code>HttpServletRequest</code> interface.
These methods allow components to make business-logic decisions based on the security role of the caller or remote user.</p>
</div>
<div class="paragraph">
<p>Programmatic security is discussed in more detail in the following sections:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#using-programmatic-security-with-web-applications">Using Programmatic Security with Web Applications</a></p>
</li>
<li>
<p><a href="#securing-an-enterprise-bean-programmatically">Securing an Enterprise Bean Programmatically</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="securing-glassfish-server"><a class="anchor" href="#securing-glassfish-server"></a>Securing GlassFish Server</h3>
<div class="paragraph">
<p>This tutorial describes deployment to GlassFish Server, which provides highly secure, interoperable, and distributed component computing based on the Jakarta EE security model.
GlassFish Server supports the Jakarta EE 9 security model.
You can configure GlassFish Server for the following purposes.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Adding, deleting, or modifying authorized users.
For more information on this topic, see <a href="#working-with-realms-users-groups-and-roles">Working with Realms, Users, Groups, and Roles</a>.</p>
</li>
<li>
<p>Configuring secure HTTP and Internet Inter-Orb Protocol (IIOP) listeners.</p>
</li>
<li>
<p>Configuring secure Java Management Extensions (JMX) connectors.</p>
</li>
<li>
<p>Adding, deleting, or modifying existing or custom realms.</p>
</li>
<li>
<p>Defining an interface for pluggable authorization providers using Jakarta Authorization.
Jakarta Authorization defines security contracts between GlassFish Server and authorization policy modules.
These contracts specify how the authorization providers are installed, configured, and used in access decisions.</p>
</li>
<li>
<p>Using pluggable audit modules.</p>
</li>
<li>
<p>Customizing authentication mechanisms.
All implementations of Jakarta EE 9 compatible web containers are required to support the Servlet Profile of Jakarta Authentication, which offers an avenue for customizing the authentication mechanism applied by the web container on behalf of one or more applications.</p>
</li>
<li>
<p>Setting and changing policy permissions for an application.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="working-with-identity-stores"><a class="anchor" href="#working-with-identity-stores"></a>Working with Identity Stores</h3>
<div class="paragraph">
<p>An identity store is a database or directory (store) that contains identity information about a collection of users that includes an application&#8217;s callers.
An identity store holds callers names, group membership information, and information sufficient to allow it to validate a caller&#8217;s credentials.
An identity store may also contain other information, such as globally unique caller identifiers or other caller attributes.</p>
</div>
<div class="paragraph">
<p>As specified in the Jakarta EE Security API, the <code>IdentityStore</code> interface provides an abstraction of an identity store.
Implementations of the <code>IdentityStore</code> interface interact with identity stores to authenticate users and to retrieve caller group information.
Most often, an implementation of the <code>IdentityStore</code> interface interacts with an external identity store, such as an LDAP server, but it can also manage user account data itself.</p>
</div>
<div class="paragraph">
<p>The <code>IdentityStore</code> interface is intended primarily for use by the <code>HttpAuthenticationMechanism</code> (also specified in the Jakarta Security), but can be used by other implementations such as a JASPIC <code>ServerAuthModule</code> or a container&#8217;s built-in authentication mechanisms.
Using the <code>HttpAuthenticationMechanism</code> and <code>IdentityStore</code> implementations, both built-in and custom, provides a significant advantage over the BASIC and FORM mechanisms defined by Servlet 5.0 (and previous versions) and configured declaratively using <code>&lt;login-config&gt;</code> in <code>web.xml</code>, because it allows an application to control the identity stores it will authenticate against in a standard, portable way.</p>
</div>
<div class="paragraph">
<p>An application can provide its own <code>IdentityStore</code>, or use the built in LDAP or Database identity store implementations of the interface.
For details about the <code>IdentityStore</code> interfaces and examples of their usage, see <a href="#overview-of-the-identity-store-interfaces">Overview of the Identity Store Interfaces</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="working-with-realms-users-groups-and-roles"><a class="anchor" href="#working-with-realms-users-groups-and-roles"></a>Working with Realms, Users, Groups, and Roles</h3>
<div class="paragraph">
<p>You often need to protect resources to ensure that only authorized users have access.
See <a href="#characteristics-of-application-security">Characteristics of Application Security</a> for an introduction to the concepts of authentication, identification, and authorization.</p>
</div>
<div class="paragraph">
<p>This section discusses setting up users so that they can be correctly identified and either given access to protected resources or denied access if they are not authorized to access the protected resources.
To authenticate a user, you need to follow these basic steps.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The application developer writes code to prompt for a user name and password.
The various methods of authentication are discussed in <a href="#specifying-authentication-mechanisms">Specifying Authentication Mechanisms</a>.</p>
</li>
<li>
<p>The application developer communicates how to set up security for the deployed application by use of a metadata annotation or deployment descriptor.
This step is discussed in <a href="#setting-up-security-roles">Setting Up Security Roles</a>.</p>
</li>
<li>
<p>The server administrator sets up authorized users and groups in GlassFish Server.
This is discussed in <a href="#managing-users-and-groups-in-glassfish-server">Managing Users and Groups in GlassFish Server</a>.</p>
</li>
<li>
<p>The application deployer maps the application&#8217;s security roles to users, groups, and principals defined in GlassFish Server.
This topic is discussed in <a href="#mapping-roles-to-users-and-groups-2">Mapping Roles to Users and Groups</a>.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
By default, group principal names are mapped to roles of the same name.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="what-are-realms-users-groups-and-roles"><a class="anchor" href="#what-are-realms-users-groups-and-roles"></a>What Are Realms, Users, Groups, and Roles?</h4>
<div class="paragraph">
<p>A realm is a security policy domain defined for a web or application server.
A realm contains a collection of users, who may or may not be assigned to a group.
Managing users in GlassFish Server is discussed in <a href="#managing-users-and-groups-in-glassfish-server">Managing Users and Groups in GlassFish Server</a>.</p>
</div>
<div class="paragraph">
<p>An application will often prompt for a user name and password before allowing access to a protected resource.
After the user name and password have been entered, that information is passed to the server, which either authenticates the user and sends the protected resource or does not authenticate the user, in which case access to the protected resource is denied.
This type of user authentication is discussed in <a href="#specifying-an-authentication-mechanism-in-the-deployment-descriptor">Specifying an Authentication Mechanism in the Deployment Descriptor</a>.</p>
</div>
<div class="paragraph">
<p>In some applications, authorized users are assigned to roles.
In this situation, the role assigned to the user in the application must be mapped to a principal or group defined on the application server.
<a href="#mapping-roles-to-users-and-groups">Figure 50-6</a> shows this.
More information on mapping roles to users and groups can be found in <a href="#setting-up-security-roles">Setting Up Security Roles</a>.</p>
</div>
<div id="mapping-roles-to-users-and-groups" class="imageblock">
<div class="content">
<img src="images/jakartaeett_dt_044.svg" alt="Diagram of role mapping, showing creation of users and groups, definition of roles, and mapping of roles to users and groups">
</div>
<div class="title">Figure 50-6 Mapping Roles to Users and Groups</div>
</div>
<div class="paragraph">
<p>The following sections provide more information on realms, users, groups, and roles.</p>
</div>
<div class="sect4">
<h5 id="what-is-a-realm"><a class="anchor" href="#what-is-a-realm"></a>What Is a Realm?</h5>
<div class="paragraph">
<p>The protected resources on a server can be partitioned into a set of protection spaces, each with its own authentication scheme and/or authorization database containing a collection of users and groups.
A realm is a complete database of users and groups identified as valid users of one or more applications and controlled by the same authentication policy.</p>
</div>
<div class="paragraph">
<p>The Jakarta EE server authentication service can govern users in multiple realms.
The <code>file</code>, <code>admin-realm</code>, and <code>certificate</code> realms come preconfigured for GlassFish Server.</p>
</div>
<div class="paragraph">
<p>In the <code>file</code> realm, the server stores user credentials locally in a file named <code>keyfile</code>.
You can use the Administration Console to manage users in the <code>file</code> realm.
When using the <code>file</code> realm, the server authentication service verifies user identity by checking the <code>file</code> realm.
This realm is used for the authentication of all clients except for web browser clients that use HTTPS and certificates.</p>
</div>
<div class="paragraph">
<p>In the <code>certificate</code> realm, the server stores user credentials in a certificate database.
When using the <code>certificate</code> realm, the server uses certificates with HTTPS to authenticate web clients.
To verify the identity of a user in the <code>certificate</code> realm, the authentication service verifies an X.509 certificate.
For step-by-step instructions for creating this type of certificate, see <a href="#working-with-digital-certificates">Working with Digital Certificates</a>.
The common name field of the X.509 certificate is used as the principal name.</p>
</div>
<div class="paragraph">
<p>The <code>admin-realm</code> is also a <code>file</code> realm and stores administrator user credentials locally in a file named <code>admin-keyfile</code>.
You can use the Administration Console to manage users in this realm in the same way you manage users in the <code>file</code> realm.
For more information, see <a href="#managing-users-and-groups-in-glassfish-server">Managing Users and Groups in GlassFish Server</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="what-is-a-user"><a class="anchor" href="#what-is-a-user"></a>What Is a User?</h5>
<div class="paragraph">
<p>A user is an individual or application program identity that has been defined in GlassFish Server.
In a web application, a user can have associated with that identity a set of roles that entitle the user to access all resources protected by those roles.
Users can be associated with a group.</p>
</div>
<div class="paragraph">
<p>A Jakarta EE user is similar to an operating system user.
Typically, both types of users represent people.
However, these two types of users are not the same.
The Jakarta EE server authentication service has no knowledge of the user name and password you provide when you log in to the operating system.
The Jakarta EE server authentication service is not connected to the security mechanism of the operating system.
The two security services manage users that belong to different realms.</p>
</div>
</div>
<div class="sect4">
<h5 id="what-is-a-group"><a class="anchor" href="#what-is-a-group"></a>What Is a Group?</h5>
<div class="paragraph">
<p>A group is a set of authenticated users, classified by common traits, defined in GlassFish Server.
A Jakarta EE user of the <code>file</code> realm can belong to a group in GlassFish Server.
(A user in the <code>certificate</code> realm cannot.)
A group in GlassFish Server is a category of users classified by common traits, such as job title or customer profile.
For example, most customers of an e-commerce application might belong to the <code>CUSTOMER</code> group, but the big spenders would belong to the <code>PREFERRED</code> group.
Categorizing users into groups makes it easier to control the access of large numbers of users.</p>
</div>
<div class="paragraph">
<p>A group in GlassFish Server has a different scope from a role.
A group is designated for the entire GlassFish Server, whereas a role is associated only with a specific application in GlassFish Server.</p>
</div>
</div>
<div class="sect4">
<h5 id="what-is-a-role"><a class="anchor" href="#what-is-a-role"></a>What Is a Role?</h5>
<div class="paragraph">
<p>A role is an abstract name for the permission to access a particular set of resources in an application.
A role can be compared to a key that can open a lock.
Many people might have a copy of the key.
The lock doesn&#8217;t care who you are, only that you have the right key.</p>
</div>
</div>
<div class="sect4">
<h5 id="some-other-terminology"><a class="anchor" href="#some-other-terminology"></a>Some Other Terminology</h5>
<div class="paragraph">
<p>The following terminology is also used to describe the security requirements of the Jakarta EE platform.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A principal is an entity that can be authenticated by an authentication protocol in a security service that is deployed in an enterprise.
A principal is identified by using a principal name and authenticated by using authentication data.</p>
</li>
<li>
<p>A security policy domain, also known as a security domain or realm, is a scope over which a common security policy is defined and enforced by the security administrator of the security service.</p>
</li>
<li>
<p>Security attributes are a set of attributes associated with every principal.
The security attributes have many uses: for example, access to protected resources and auditing of users.
Security attributes can be associated with a principal by an authentication protocol.</p>
</li>
<li>
<p>A credential is an object that contains or references security attributes used to authenticate a principal for Jakarta EE services.
A principal acquires a credential upon authentication or from another principal that allows its credential to be used.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="managing-users-and-groups-in-glassfish-server"><a class="anchor" href="#managing-users-and-groups-in-glassfish-server"></a>Managing Users and Groups in GlassFish Server</h4>
<div class="paragraph">
<p>Follow these steps for managing users before you run the tutorial examples.</p>
</div>
<div class="sect4">
<h5 id="to-add-users-to-glassfish-server"><a class="anchor" href="#to-add-users-to-glassfish-server"></a>To Add Users to GlassFish Server</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Start GlassFish Server, if you haven&#8217;t already done so.</p>
<div class="paragraph">
<p>Information on starting GlassFish Server is available in <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>.</p>
</div>
</li>
<li>
<p>Start the Administration Console, if you haven&#8217;t already done so.</p>
<div class="paragraph">
<p>To start the Administration Console, open a web browser and specify the URL <a href="http://localhost:4848/" class="bare" target="_blank" rel="noopener">http://localhost:4848/</a>.
If you changed the default Admin port during installation, enter the correct port number in place of <code>4848</code>.</p>
</div>
</li>
<li>
<p>In the navigation tree, expand the Configurations node, then expand the server-config node.</p>
</li>
<li>
<p>Expand the Security node.</p>
</li>
<li>
<p>Expand the Realms node.</p>
</li>
<li>
<p>Select the realm to which you are adding users.</p>
<div class="ulist">
<ul>
<li>
<p>Select the <code>file</code> realm to add users you want to access applications running in this realm.</p>
<div class="paragraph">
<p>For the example security applications, select the <code>file</code> realm.</p>
</div>
</li>
<li>
<p>Select the <code>admin-realm</code> to add users you want to enable as system administrators of GlassFish Server.</p>
<div class="paragraph">
<p>You cannot add users to the <code>certificate</code> realm by using the Administration Console.
In the <code>certificate</code> realm, you can add only certificates.
For information on adding (importing) certificates to the <code>certificate</code> realm, see <a href="#adding-users-to-the-certificate-realm">Adding Users to the Certificate Realm</a>.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>On the Edit Realm page, click Manage Users.</p>
</li>
<li>
<p>On the File Users or Admin Users page, click New to add a new user to the realm.</p>
</li>
<li>
<p>On the New File Realm User page, enter values in the User ID, Group List, New Password, and Confirm New Password fields.</p>
<div class="paragraph">
<p>For the Admin Realm, the Group List field is read-only, and the group name is <code>asadmin</code>.
Restart GlassFish Server and the Administration Console after you add a user to the Admin Realm.</p>
</div>
<div class="paragraph">
<p>For more information on these properties, see <a href="#working-with-realms-users-groups-and-roles">Working with Realms, Users, Groups, and Roles</a>.</p>
</div>
<div class="paragraph">
<p>For the example security applications, specify a user with any name and password you like, but make sure that the user is assigned to the group <code>TutorialUser</code>.
The user name and password are case-sensitive.
Keep a record of the user name and password for working with the examples later in this tutorial.</p>
</div>
</li>
<li>
<p>Click OK to add this user to the realm, or click Cancel to quit without saving.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="setting-up-security-roles"><a class="anchor" href="#setting-up-security-roles"></a>Setting Up Security Roles</h4>
<div class="paragraph">
<p>When you design an enterprise bean or web component, you should always think about the kinds of users who will access the component.
For example, a web application for a human resources department might have a different request URL for someone who has been assigned the role of <code>DEPT_ADMIN</code> than for someone who has been assigned the role of <code>DIRECTOR</code>.
The <code>DEPT_ADMIN</code> role may let you view employee data, but the <code>DIRECTOR</code> role enables you to modify employee data, including salary data.
Each of these security roles is an abstract logical grouping of users that is defined by the person who assembles the application.
When an application is deployed, the deployer will map the roles to security identities in the operational environment, as shown in <a href="#mapping-roles-to-users-and-groups">Figure 50-6</a>.</p>
</div>
<div class="paragraph">
<p>For Jakarta EE components, you define security roles using the <code>@DeclareRoles</code> and <code>@RolesAllowed</code> metadata annotations.</p>
</div>
<div class="paragraph">
<p>The following is an example of an application in which the role of <code>DEPT-ADMIN</code> is authorized for methods that review employee payroll data, and the role of <code>DIRECTOR</code> is authorized for methods that change employee payroll data.</p>
</div>
<div class="paragraph">
<p>The enterprise bean would be annotated as shown in the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">jakarta.annotation.security.DeclareRoles</span>;
<span class="keyword">import</span> <span class="include">jakarta.annotation.security.RolesAllowed</span>;
...
<span class="annotation">@DeclareRoles</span>({<span class="string"><span class="delimiter">&quot;</span><span class="content">DEPT-ADMIN</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">DIRECTOR</span><span class="delimiter">&quot;</span></span>})
<span class="annotation">@Stateless</span> <span class="directive">public</span> <span class="type">class</span> <span class="class">PayrollBean</span> <span class="directive">implements</span> Payroll {
    <span class="annotation">@Resource</span> SessionContext ctx;


    <span class="annotation">@RolesAllowed</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">DEPT-ADMIN</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> reviewEmployeeInfo(EmplInfo info) {

        oldInfo = ... read from database;

        <span class="comment">// ...</span>
    }

    <span class="annotation">@RolesAllowed</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">DIRECTOR</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> updateEmployeeInfo(EmplInfo info) {

        newInfo = ... update database;

        <span class="comment">// ...</span>
    }
    ...
 }</code></pre>
</div>
</div>
<div class="paragraph">
<p>For a servlet, you can use the <code>@HttpConstraint</code> annotation within the <code>@ServletSecurity</code> annotation to specify the roles that are allowed to access the servlet.
For example, a servlet might be annotated as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@WebServlet</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">PayrollServlet</span><span class="delimiter">&quot;</span></span>, urlPatterns = {<span class="string"><span class="delimiter">&quot;</span><span class="content">/payroll</span><span class="delimiter">&quot;</span></span>})
<span class="annotation">@ServletSecurity</span>(
<span class="annotation">@HttpConstraint</span>(transportGuarantee = TransportGuarantee.CONFIDENTIAL,
    rolesAllowed = {<span class="string"><span class="delimiter">&quot;</span><span class="content">DEPT-ADMIN</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">DIRECTOR</span><span class="delimiter">&quot;</span></span>}))
<span class="directive">public</span> <span class="type">class</span> <span class="class">GreetingServlet</span> <span class="directive">extends</span> HttpServlet { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>These annotations are discussed in more detail in <a href="#specifying-security-for-basic-authentication-using-annotations">Specifying Security for Basic Authentication Using Annotations</a> and <a href="#securing-an-enterprise-bean-using-declarative-security">Securing an Enterprise Bean Using Declarative Security</a>.</p>
</div>
<div class="paragraph">
<p>After users have provided their login information and the application has declared what roles are authorized to access protected parts of an application, the next step is to map the security role to the name of a user, or principal.</p>
</div>
</div>
<div class="sect3">
<h4 id="mapping-roles-to-users-and-groups-2"><a class="anchor" href="#mapping-roles-to-users-and-groups-2"></a>Mapping Roles to Users and Groups</h4>
<div class="paragraph">
<p>When you are developing a Jakarta EE application, you don&#8217;t need to know what categories of users have been defined for the realm in which the application will be run.
In the Jakarta EE platform, the security architecture provides a mechanism for mapping the roles defined in the application to the users or groups defined in the runtime realm.</p>
</div>
<div class="paragraph">
<p>The role names used in the application are often the same as the group names defined in GlassFish Server.
Jakarta Security requires that group principal names are mapped to roles of the same name by default.
Accordingly, the <strong>Default Principal To Role Mapping</strong> setting is enabled by default on the Security page of the GlassFish Server Administration Console.
All the tutorial security examples use default principal-to-role mapping.
With that setting enabled, if the group name defined on GlassFish Server matches the role name defined in the application, there is no need to use the runtime deployment descriptor to provide a mapping.
The application server will implicitly make this mapping, as long as the names of the groups and roles match.</p>
</div>
<div class="paragraph">
<p>If the role names used in an application are not the same as the group names defined on the server, use the runtime deployment descriptor to specify the mapping.
The following example demonstrates how to do this mapping in the <code>glassfish-web.xml</code> file, which is the file used for web applications:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;glassfish-web-app&gt;</span>
    ...
    <span class="tag">&lt;security-role-mapping&gt;</span>
        <span class="tag">&lt;role-name&gt;</span>Mascot<span class="tag">&lt;/role-name&gt;</span>
        <span class="tag">&lt;principal-name&gt;</span>Duke<span class="tag">&lt;/principal-name&gt;</span>
    <span class="tag">&lt;/security-role-mapping&gt;</span>

    <span class="tag">&lt;security-role-mapping&gt;</span>
        <span class="tag">&lt;role-name&gt;</span>Admin<span class="tag">&lt;/role-name&gt;</span>
        <span class="tag">&lt;group-name&gt;</span>Director<span class="tag">&lt;/group-name&gt;</span>
    <span class="tag">&lt;/security-role-mapping&gt;</span>
    ...
<span class="tag">&lt;/glassfish-web-app&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A role can be mapped to specific principals, specific groups, or both.
The principal or group names must be valid principals or groups in the current default realm or in the realm specified in the <code>login-config</code> element.
In this example, the role of <code>Mascot</code> used in the application is mapped to a principal, named <code>Duke</code>, that exists on the application server.
Mapping a role to a specific principal is useful when the person occupying that role may change.
For this application, you would need to modify only the runtime deployment descriptor rather than search and replace throughout the application for references to this principal.</p>
</div>
<div class="paragraph">
<p>Also in this example, the role of <code>Admin</code> is mapped to a group of users assigned the group name of <code>Director</code>.
This is useful because the group of people authorized to access director-level administrative data has to be maintained only in GlassFish Server.
The application developer does not need to know who these people are, but only needs to define the group of people who will be given access to the information.</p>
</div>
<div class="paragraph">
<p>The <code>role-name</code> must match the <code>role-name</code> in the <code>security-role</code> element of the corresponding deployment descriptor or the role name defined in a <code>@DeclareRoles</code> annotation.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="establishing-a-secure-connection-using-ssl"><a class="anchor" href="#establishing-a-secure-connection-using-ssl"></a>Establishing a Secure Connection Using SSL</h3>
<div class="paragraph">
<p>Secure Sockets Layer (SSL) technology is security that is implemented at the transport layer (see <a href="#transport-layer-security">Transport-Layer Security</a> for more information about transport-layer security).
SSL allows web browsers and web servers to communicate over a secure connection.
In this secure connection, the data is encrypted before being sent and then is decrypted upon receipt and before processing.
Both the browser and the server encrypt all traffic before sending any data.</p>
</div>
<div class="paragraph">
<p>SSL addresses the following important security considerations.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Authentication: During your initial attempt to communicate with a web server over a secure connection, that server will present your web browser with a set of credentials in the form of a server certificate (also called a public key certificate).
The purpose of the certificate is to verify that the site is who and what it claims to be.
In some cases, the server may request a certificate proving that the client is who and what it claims to be; this mechanism is known as client authentication.</p>
</li>
<li>
<p>Confidentiality: When data is being passed between the client and the server on a network, third parties can view and intercept this data.
SSL responses are encrypted so that the data cannot be deciphered by the third party and the data remains confidential.</p>
</li>
<li>
<p>Integrity: When data is being passed between the client and the server on a network, third parties can view and intercept this data.
SSL helps guarantee that the data will not be modified in transit by that third party.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The SSL protocol is designed to be as efficient as securely possible.
However, encryption and decryption are computationally expensive processes from a performance standpoint.
It is not strictly necessary to run an entire web application over SSL, and it is customary for a developer to decide which pages require a secure connection and which do not.
Pages that might require a secure connection include those for login, personal information, shopping cart checkouts, or credit card information transmittal.
Any page within an application can be requested over a secure socket by simply prefixing the address with <code>https:</code> instead of <code>http:</code>.
Any pages that absolutely require a secure connection should check the protocol type associated with the page request and take the appropriate action if <code>https:</code> is not specified.</p>
</div>
<div class="paragraph">
<p>Using name-based virtual hosts on a secured connection can be problematic.
This is a design limitation of the SSL protocol itself.
The SSL handshake, whereby the client browser accepts the server certificate, must occur before the HTTP request is accessed.
As a result, the request information containing the virtual host name cannot be determined before authentication, and it is therefore not possible to assign multiple certificates to a single IP address.
If all virtual hosts on a single IP address need to authenticate against the same certificate, the addition of multiple virtual hosts should not interfere with normal SSL operations on the server.
Be aware, however, that most client browsers will compare the server&#8217;s domain name against the domain name listed in the certificate, if any; this is applicable primarily to official certificates signed by a certificate authority (CA).
If the domain names do not match, these browsers will display a warning to the client.
In general, only address-based virtual
hosts are commonly used with SSL in a production environment.</p>
</div>
<div class="sect3">
<h4 id="verifying-and-configuring-ssl-support"><a class="anchor" href="#verifying-and-configuring-ssl-support"></a>Verifying and Configuring SSL Support</h4>
<div class="paragraph">
<p>As a general rule, you must address the following issues to enable SSL for a server.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>There must be a <code>Connector</code> element for an SSL connector in the server deployment descriptor.</p>
</li>
<li>
<p>There must be valid keystore and certificate files.</p>
</li>
<li>
<p>The location of the keystore file and its password must be specified in the server deployment descriptor.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An SSL HTTPS connector is already enabled in GlassFish Server.</p>
</div>
<div class="paragraph">
<p>For testing purposes and to verify that SSL support has been correctly installed, load the default introduction page with a URL that connects to the port defined in the server deployment descriptor:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>https://localhost:8181/</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>https</code> in this URL indicates that the browser should be using the SSL protocol.
The <code>localhost</code> in this example assumes that you are running the example on your local machine as part of the development process.
The <code>8181</code> in this example is the secure port that was specified where the SSL connector was created.
If you are using a different server or port, modify this value accordingly.</p>
</div>
<div class="paragraph">
<p>The first time that you load this application, the New Site Certificate or Security Alert dialog box appears.
Click Next to move through the series of dialog boxes, and click Finish when you reach the last dialog box.
The certificates will appear only the first time.
When you accept the certificates, subsequent hits to this site assume that you still trust the content.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="further-information-about-security"><a class="anchor" href="#further-information-about-security"></a>Further Information about Security</h3>
<div class="paragraph">
<p>For more information about security in Jakarta EE applications, see</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Jakarta EE 9 specification:<br>
<a href="https://jakarta.ee/specifications/platform/9/" class="bare" target="_blank" rel="noopener">https://jakarta.ee/specifications/platform/9/</a></p>
</li>
<li>
<p>Jakarta Security 2.0:<br>
<a href="https://jakarta.ee/specifications/security/2.0/" class="bare" target="_blank" rel="noopener">https://jakarta.ee/specifications/security/2.0/</a></p>
</li>
<li>
<p>Jakarta Authentication 2.0:<br>
<a href="https://jakarta.ee/specifications/authentication/2.0/" class="bare" target="_blank" rel="noopener">https://jakarta.ee/specifications/authentication/2.0/</a></p>
</li>
<li>
<p>Jakarta Enterprise Beans 4.0 specification:<br>
<a href="https://jakarta.ee/specifications/enterprise-beans/4.0/" class="bare" target="_blank" rel="noopener">https://jakarta.ee/specifications/enterprise-beans/4.0/</a></p>
</li>
<li>
<p>Jakarta Enterprise Web Services 2.0 specification:<br>
<a href="https://jakarta.ee/specifications/enterprise-ws/2.0/" class="bare" target="_blank" rel="noopener">https://jakarta.ee/specifications/enterprise-ws/2.0/</a></p>
</li>
<li>
<p>Java SE security information:<br>
<a href="https://docs.oracle.com/javase/8/docs/technotes/guides/security/" class="bare" target="_blank" rel="noopener">https://docs.oracle.com/javase/8/docs/technotes/guides/security/</a></p>
</li>
<li>
<p>Jakarta Servlet 5.0 specification:<br>
<a href="https://jakarta.ee/specifications/servlet/5.0/" class="bare" target="_blank" rel="noopener">https://jakarta.ee/specifications/servlet/5.0/</a></p>
</li>
<li>
<p>Jakarta Authorization 2.0 specification:<br>
<a href="https://jakarta.ee/specifications/authorization/2.0/" class="bare" target="_blank" rel="noopener">https://jakarta.ee/specifications/authorization/2.0/</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="getting-started-securing-web-applications"><a class="anchor" href="#getting-started-securing-web-applications"></a>Chapter 51. Getting Started Securing Web Applications</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter describes in greater detail the ways to implement security for Jakarta EE web applications discussed in a general way in <a href="#securing-containers">Securing Containers</a>. The detail and examples in this chapter explore these security services as they relate to web components.</p>
</div>
<div class="sect2">
<h3 id="overview-of-web-application-security"><a class="anchor" href="#overview-of-web-application-security"></a>Overview of Web Application Security</h3>
<div class="paragraph">
<p>A web application is accessed using a web browser over a network, such as the Internet or a company&#8217;s intranet.
As discussed in <a href="#distributed-multitiered-applications">Distributed Multitiered Applications</a>, the Jakarta EE platform uses a distributed multitiered application model, and web applications run in the web tier.</p>
</div>
<div class="paragraph">
<p>Web applications contain resources that can be accessed by many users.
These resources often traverse unprotected, open networks, such as the Internet.
In such an environment, a substantial number of web applications will require some type of security.</p>
</div>
<div class="paragraph">
<p>Securing applications and their clients in the business tier and the EIS tier is discussed in <a href="#getting-started-securing-enterprise-applications">Chapter 52, <em>Getting Started Securing Enterprise Applications</em></a>.</p>
</div>
<div class="paragraph">
<p>In the Jakarta EE platform, web components provide the dynamic extension capabilities for a web server.
Web components can be Jakarta servlets or Jakarta Faces pages.</p>
</div>
<div class="paragraph">
<p>Certain aspects of web application security can be configured when the application is installed, or deployed, to the web container.
Annotations and/or deployment descriptors are used to relay information to the deployer about security and other aspects of the application.
Specifying this information in annotations or in the deployment descriptor helps the deployer set up the appropriate security policy for the web application.
Any values explicitly specified in the deployment descriptor override any values specified in annotations.</p>
</div>
<div class="paragraph">
<p>Security for Jakarta EE web applications can be implemented in the following ways.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Declarative security can be implemented using either metadata annotations or an application&#8217;s deployment descriptor.
See <a href="#overview-of-jakarta-security">Overview of Jakarta Security</a> for more information.</p>
<div class="paragraph">
<p>Declarative security for web applications is described in <a href="#securing-web-applications">Securing Web Applications</a>.</p>
</div>
</li>
<li>
<p>Programmatic security is embedded in an application and can be used to make security decisions when declarative security alone is not sufficient to express the security model of an application.
Declarative security alone may not be sufficient when conditional login in a particular work flow, instead of for all cases, is required in the middle of an application.
See <a href="#overview-of-jakarta-security">Overview of Jakarta Security</a> for more information.</p>
<div class="paragraph">
<p>Servlet 5.0 provides the <code>authenticate</code>, <code>login</code>, and <code>logout</code> methods of the <code>HttpServletRequest</code> interface.
With the addition of the <code>authenticate</code>, <code>login</code>, and <code>logout</code> methods to the Servlet specification, an application deployment descriptor is no longer required for web applications but may still be used to further specify security requirements beyond the basic default values.</p>
</div>
<div class="paragraph">
<p>Programmatic security is discussed in <a href="#using-programmatic-security-with-web-applications">Using Programmatic Security with Web Applications</a>.</p>
</div>
</li>
<li>
<p>Message security works with web services and incorporates security features, such as digital signatures and encryption, into the header of a SOAP message, working in the application layer, ensuring end-to-end security.
Message security is not a component of Jakarta EE and is mentioned here for informational purposes only.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Some of the material in this chapter builds on material presented earlier in this tutorial.
In particular, this chapter assumes that you are familiar with the information in the following chapters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#getting-started-with-web-applications">Chapter 6, <em>Getting Started with Web Applications</em></a></p>
</li>
<li>
<p><a href="#jakarta-faces-technology">Chapter 7, <em>Jakarta Faces Technology</em></a></p>
</li>
<li>
<p><a href="#jakarta-servlet-technology-2">Chapter 18, <em>Jakarta Servlet Technology</em></a></p>
</li>
<li>
<p><a href="#introduction-to-security-in-the-jakarta-ee-platform">Chapter 50, <em>Introduction to Security in the Jakarta EE Platform</em></a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="securing-web-applications"><a class="anchor" href="#securing-web-applications"></a>Securing Web Applications</h3>
<div class="paragraph">
<p>Web applications are created by application developers who give, sell, or otherwise transfer the application to an application deployer for installation into a runtime environment.</p>
</div>
<div class="sect3">
<h4 id="overview-of-securing-web-applications"><a class="anchor" href="#overview-of-securing-web-applications"></a>Overview of Securing Web Applications</h4>
<div class="paragraph">
<p>Application developers communicate how to set up security for the deployed application by using annotations or deployment descriptors.
This information is passed on to the deployer, who uses it to define method permissions for security roles, set up user authentication, and set up the appropriate transport mechanism.
If the application developer doesn&#8217;t define security requirements, the deployer will have to determine the security requirements independently.</p>
</div>
<div class="paragraph">
<p>Some elements necessary for security in a web application cannot be specified as annotations for all types of web applications.
This chapter explains how to secure web applications using annotations wherever possible.
It explains how to use deployment descriptors where annotations cannot be used.</p>
</div>
</div>
<div class="sect3">
<h4 id="specifying-security-constraints"><a class="anchor" href="#specifying-security-constraints"></a>Specifying Security Constraints</h4>
<div class="paragraph">
<p>A security constraint is used to define the access privileges to a collection of resources using their URL mapping.</p>
</div>
<div class="paragraph">
<p>If your web application uses a servlet, you can express the security constraint information by using annotations.
Specifically, you use the <code>@HttpConstraint</code> and, optionally, the <code>@HttpMethodConstraint</code> annotations within the <code>@ServletSecurity</code> annotation to specify a security constraint.</p>
</div>
<div class="paragraph">
<p>If your web application does not use a servlet, however, you must specify a <code>security-constraint</code> element in the deployment descriptor file.
The authentication mechanism cannot be expressed using annotations, so if you use any authentication method other than <code>BASIC</code> (the default), a deployment descriptor is required.</p>
</div>
<div class="paragraph">
<p>The following subelements can be part of a <code>security-constraint</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Web resource collection (<code>web-resource-collection</code>): A list of URL patterns (the part of a URL after the host name and port you want to constrain) and HTTP operations (the methods within the files that match the URL pattern you want to constrain) that describe a set of resources to be protected.
Web resource collections are discussed in <a href="#specifying-a-web-resource-collection">Specifying a Web Resource Collection</a>.</p>
</li>
<li>
<p>Authorization constraint (<code>auth-constraint</code>): Specifies whether authentication is to be used and names the roles authorized to perform the constrained requests.
For more information about authorization constraints, see <a href="#specifying-an-authorization-constraint">Specifying an Authorization Constraint</a>.</p>
</li>
<li>
<p>User data constraint (<code>user-data-constraint</code>): Specifies how data is protected when transported between a client and a server.
User data constraints are discussed in <a href="#specifying-a-secure-connection">Specifying a Secure Connection</a>.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="specifying-a-web-resource-collection"><a class="anchor" href="#specifying-a-web-resource-collection"></a>Specifying a Web Resource Collection</h5>
<div class="paragraph">
<p>A web resource collection consists of the following subelements.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>web-resource-name</code> is the name you use for this resource. Its use is optional.</p>
</li>
<li>
<p><code>url-pattern</code> is used to list the request URI to be protected.
Many applications have both unprotected and protected resources.
To provide unrestricted access to a resource, do not configure a security constraint for that particular request URI.</p>
<div class="paragraph">
<p>The request URI is the part of a URL after the host name and port.
For example, let&#8217;s say that you have an e-commerce site with a catalog that you would want anyone to be able to access and browse, and a shopping cart area for customers only.
You could set up the paths for your web application so that the pattern <code>/cart/*</code> is protected but nothing else is protected.
Assuming that the application is installed at context path <code>/myapp</code>, the following are true.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>http://localhost:8080/myapp/index.xhtml</code> is not protected.</p>
</li>
<li>
<p><code>http://localhost:8080/myapp/cart/index.xhtml</code> is protected.</p>
<div class="paragraph">
<p>A user will be prompted to log in the first time he or she accesses a resource in the <code>cart/</code> subdirectory.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p><code>http-method</code> or <code>http-method-omission</code> is used to specify which methods should be protected or which methods should be omitted from protection.
An HTTP method is protected by a <code>web-resource-collection</code> under any of the following circumstances:</p>
<div class="ulist">
<ul>
<li>
<p>If no HTTP methods are named in the collection (which means that all are protected)</p>
</li>
<li>
<p>If the collection specifically names the HTTP method in an <code>http-method</code> subelement</p>
</li>
<li>
<p>If the collection contains one or more <code>http-method-omission</code> elements, none of which names the HTTP method</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="specifying-an-authorization-constraint"><a class="anchor" href="#specifying-an-authorization-constraint"></a>Specifying an Authorization Constraint</h5>
<div class="paragraph">
<p>An authorization constraint (<code>auth-constraint</code>) contains the <code>role-name</code> element.
You can use as many <code>role-name</code> elements as needed here.</p>
</div>
<div class="paragraph">
<p>An authorization constraint establishes a requirement for authentication and names the roles authorized to access the URL patterns and HTTP methods declared by this security constraint.
If there is no authorization constraint, the container must accept the request without requiring user authentication.
If there is an authorization constraint but no roles are specified within it, the container will not allow access to constrained requests under any circumstances.
Each role name specified here must either correspond to the role name of one of the <code>security-role</code> elements defined for this web application or be the specially reserved role name <code>*</code>, which indicates all roles in the web application.
Role names are case sensitive.
The roles defined for the application must be mapped to users and groups defined on the server, except when default principal-to-role mapping is used.</p>
</div>
<div class="paragraph">
<p>For more information about security roles, see <a href="#declaring-security-roles">Declaring Security Roles</a>.
For information on mapping security roles, see <a href="#mapping-roles-to-users-and-groups-2">Mapping Roles to Users and Groups</a>.</p>
</div>
<div class="paragraph">
<p>For a servlet, the <code>@HttpConstraint</code> and <code>@HttpMethodConstraint</code> annotations accept a <code>rolesAllowed</code> element that specifies the authorized roles.</p>
</div>
</div>
<div class="sect4">
<h5 id="specifying-a-secure-connection"><a class="anchor" href="#specifying-a-secure-connection"></a>Specifying a Secure Connection</h5>
<div class="paragraph">
<p>A user data constraint (<code>user-data-constraint</code> in the deployment descriptor) contains the <code>transport-guarantee</code> subelement.
A user data constraint can be used to require that a protected transport-layer connection, such as HTTPS, be used for all constrained URL patterns and HTTP methods specified in the security constraint.
The choices for transport guarantee are <code>CONFIDENTIAL</code>, <code>INTEGRAL</code>, or <code>NONE</code>.
If you specify <code>CONFIDENTIAL</code> or <code>INTEGRAL</code> as a security constraint, it generally means that the use of SSL is required and applies to all requests that match the URL patterns in the web resource collection, not just to the login dialog box.</p>
</div>
<div class="paragraph">
<p>The strength of the required protection is defined by the value of the transport guarantee, as follows.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Specify <code>CONFIDENTIAL</code> when the application requires that data be transmitted so as to prevent other entities from observing the contents of the transmission.</p>
</li>
<li>
<p>Specify <code>INTEGRAL</code> when the application requires that the data be sent between client and server in such a way that it cannot be changed in transit.</p>
</li>
<li>
<p>Specify <code>NONE</code> to indicate that the container must accept the constrained requests on any connection, including an unprotected one.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In practice, Jakarta EE servers treat the <code>CONFIDENTIAL</code> and <code>INTEGRAL</code> transport guarantee values identically.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The user data constraint is handy to use in conjunction with basic and form-based user authentication.
When the login authentication method is set to <code>BASIC</code> or <code>FORM</code>, passwords are not protected, meaning that passwords sent between a client and a server on an unprotected session can be viewed and intercepted by third parties.
Using a user data constraint with the user authentication mechanism can alleviate this concern.
Configuring a user authentication mechanism is described in <a href="#specifying-an-authentication-mechanism-in-the-deployment-descriptor">Specifying an Authentication Mechanism in the Deployment Descriptor</a>.</p>
</div>
<div class="paragraph">
<p>To guarantee that data is transported over a secure connection, ensure that SSL support is configured for your server.
SSL support is already configured for GlassFish Server.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
After you switch to SSL for a session, you should never accept any non-SSL requests for the rest of that session.
For example, a shopping site might not use SSL until the checkout page, and then it might switch to using SSL to accept your card number.
After switching to SSL, you should stop listening to non-SSL requests for this session.
The reason for this practice is that the session ID itself was not encrypted on the earlier communications.
This is not so bad when you&#8217;re only doing your shopping, but after the credit card information is stored in the session, you don&#8217;t want anyone to use that information to fake the purchase transaction against your credit card.
This practice could be easily implemented by using a filter.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="specifying-security-constraints-for-resources"><a class="anchor" href="#specifying-security-constraints-for-resources"></a>Specifying Security Constraints for Resources</h5>
<div class="paragraph">
<p>You can create security constraints for resources within your application.
For example, you could allow users with the role of <code>PARTNER</code> full access to all resources at the URL pattern <code>/acme/wholesale/*</code> and allow users with the role of <code>CLIENT</code> full access to all resources at the URL pattern <code>/acme/retail/*</code>.
This is the recommended way to protect resources if you do not want to protect some HTTP methods while leaving other HTTP methods unprotected.
An example of a deployment descriptor that would demonstrate this functionality is the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="comment">&lt;!-- SECURITY CONSTRAINT #1 --&gt;</span>
<span class="tag">&lt;security-constraint&gt;</span>
    <span class="tag">&lt;web-resource-collection&gt;</span>
        <span class="tag">&lt;web-resource-name&gt;</span>wholesale<span class="tag">&lt;/web-resource-name&gt;</span>
        <span class="tag">&lt;url-pattern&gt;</span>/acme/wholesale/*<span class="tag">&lt;/url-pattern&gt;</span>
    <span class="tag">&lt;/web-resource-collection&gt;</span>
    <span class="tag">&lt;auth-constraint&gt;</span>
        <span class="tag">&lt;role-name&gt;</span>PARTNER<span class="tag">&lt;/role-name&gt;</span>
    <span class="tag">&lt;/auth-constraint&gt;</span>
    <span class="tag">&lt;user-data-constraint&gt;</span>
        <span class="tag">&lt;transport-guarantee&gt;</span>CONFIDENTIAL<span class="tag">&lt;/transport-guarantee&gt;</span>
    <span class="tag">&lt;/user-data-constraint&gt;</span>
<span class="tag">&lt;/security-constraint&gt;</span>

<span class="comment">&lt;!-- SECURITY CONSTRAINT #2 --&gt;</span>
<span class="tag">&lt;security-constraint&gt;</span>
    <span class="tag">&lt;web-resource-collection&gt;</span>
        <span class="tag">&lt;web-resource-name&gt;</span>retail<span class="tag">&lt;/web-resource-name&gt;</span>
        <span class="tag">&lt;url-pattern&gt;</span>/acme/retail/*<span class="tag">&lt;/url-pattern&gt;</span>
    <span class="tag">&lt;/web-resource-collection&gt;</span>
    <span class="tag">&lt;auth-constraint&gt;</span>
        <span class="tag">&lt;role-name&gt;</span>CLIENT<span class="tag">&lt;/role-name&gt;</span>
    <span class="tag">&lt;/auth-constraint&gt;</span>
    <span class="tag">&lt;user-data-constraint&gt;</span>
        <span class="tag">&lt;transport-guarantee&gt;</span>CONFIDENTIAL<span class="tag">&lt;/transport-guarantee&gt;</span>
    <span class="tag">&lt;/user-data-constraint&gt;</span>
<span class="tag">&lt;/security-constraint&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="specifying-authentication-mechanisms"><a class="anchor" href="#specifying-authentication-mechanisms"></a>Specifying Authentication Mechanisms</h4>
<div class="paragraph">
<p>This section describes built-in authentication mechanisms defined by the Servlet specification.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
An alternative way to perform user authentication, including BASIC and FORM authentication, is to use the <code>HttpAuthenticationMechanism</code>, specified by Jakarta Security, and documented in <a href="#using-jakarta-security">Using Jakarta Security</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A user authentication mechanism specifies:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The way a user gains access to web content</p>
</li>
<li>
<p>With basic authentication, the realm in which the user will be authenticated</p>
</li>
<li>
<p>With form-based authentication, additional attributes</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When an authentication mechanism is specified, the user must be authenticated before access is granted to any resource that is constrained by a security constraint.
There can be multiple security constraints applying to multiple resources, but the same authentication method will apply to all constrained resources in an application.</p>
</div>
<div class="paragraph">
<p>Before you can authenticate a user, you must have a database of user names, passwords, and roles configured on your web or application server.
For information on setting up the user database, see <a href="#managing-users-and-groups-in-glassfish-server">Managing Users and Groups in GlassFish Server</a>.</p>
</div>
<div class="paragraph">
<p>The Jakarta EE platform supports the following authentication mechanisms:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Basic authentication</p>
</li>
<li>
<p>Form-based authentication</p>
</li>
<li>
<p>Digest authentication</p>
</li>
<li>
<p>Client authentication</p>
</li>
<li>
<p>Mutual authentication</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Basic, form-based, and digest authentication are discussed in this section.
Client and mutual authentication are discussed in <a href="#jakarta-ee-security-advanced-topics">Chapter 54, <em>Jakarta EE Security: Advanced Topics</em></a>.</p>
</div>
<div class="paragraph">
<p>HTTP basic authentication and form-based authentication are not very secure authentication mechanisms.
Basic authentication sends user names and passwords over the Internet as Base64-encoded text.
Form-based authentication sends this data as plain text.
In both cases, the target server is not authenticated.
Therefore, these forms of authentication leave user data exposed and vulnerable.
If someone can intercept the transmission, the user name and password information can easily be decoded.</p>
</div>
<div class="paragraph">
<p>However, when a secure transport mechanism, such as SSL, or security at the network level, such as the Internet Protocol Security (IPsec) protocol or virtual private network (VPN) strategies, is used in conjunction with basic or form-based authentication, some of these concerns can be alleviated.
To specify a secure transport mechanism, use the elements described in <a href="#specifying-a-secure-connection">Specifying a Secure Connection</a>.</p>
</div>
<div class="sect4">
<h5 id="http-basic-authentication"><a class="anchor" href="#http-basic-authentication"></a>HTTP Basic Authentication</h5>
<div class="paragraph">
<p>Specifying HTTP basic authentication requires that the server requests a user name and a password from the web client and verifies that the user name and password are valid by comparing them against a database of authorized users in the specified or default realm.</p>
</div>
<div class="paragraph">
<p>Basic authentication is the default when you do not specify an authentication mechanism.</p>
</div>
<div class="paragraph">
<p>When basic authentication is used, the following actions occur.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A client requests access to a protected resource.</p>
</li>
<li>
<p>The web server returns a dialog box that requests the user name and password.</p>
</li>
<li>
<p>The client submits the user name and password to the server.</p>
</li>
<li>
<p>The server authenticates the user in the specified realm and, if successful, returns the requested resource.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><a href="#http-basic-authentication-2">Figure 51-1</a> shows what happens when you specify HTTP basic authentication.</p>
</div>
<div id="http-basic-authentication-2" class="imageblock">
<div class="content">
<img src="images/jakartaeett_dt_045.svg" alt="Diagram of four steps in HTTP basic authentication between client and server">
</div>
<div class="title">Figure 51-1 HTTP Basic Authentication</div>
</div>
</div>
<div class="sect4">
<h5 id="form-based-authentication"><a class="anchor" href="#form-based-authentication"></a>Form-Based Authentication</h5>
<div class="paragraph">
<p>Form-based authentication allows the developer to control the look and feel of the login authentication screens by customizing the login screen and error pages that an HTTP browser presents to the end user.
When form-based authentication is declared, the following actions occur.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A client requests access to a protected resource.</p>
</li>
<li>
<p>If the client is unauthenticated, the server redirects the client to a login page.</p>
</li>
<li>
<p>The client submits the login form to the server.</p>
</li>
<li>
<p>The server attempts to authenticate the user.</p>
<div class="ulist">
<ul>
<li>
<p>If authentication succeeds, the authenticated user&#8217;s principal is checked to ensure that it is in a role that is authorized to access the resource.
If the user is authorized, the server redirects the client to the resource by using the stored URL path.</p>
</li>
<li>
<p>If authentication fails, the client is forwarded or redirected to an error page.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><a href="#form-based-authentication-2">Figure 51-2</a> shows what happens when you specify form-based authentication.</p>
</div>
<div id="form-based-authentication-2" class="imageblock">
<div class="content">
<img src="images/jakartaeett_dt_046.svg" alt="Diagram of four steps in form-based authentication between client and server">
</div>
<div class="title">Figure 51-2 Form-Based Authentication</div>
</div>
<div class="paragraph">
<p>The section <a href="#the-hello1-formauth-example-form-based-authentication-with-a-jakarta-faces-application">The hello1-formauth Example: Form-Based Authentication with a Jakarta Faces Application</a> is an example application that uses form-based authentication.</p>
</div>
<div class="paragraph">
<p>When you create a form-based login, be sure to maintain sessions using cookies or SSL session information.</p>
</div>
<div class="paragraph">
<p>For authentication to proceed appropriately, the action of the login form must always be <code>j_security_check</code>.
This restriction is made so that the login form will work no matter which resource it is for and to avoid requiring the server to specify the action field of the outbound form.
The following code snippet shows how the form should be coded into the HTML page:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;form</span> <span class="attribute-name">method</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">POST</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">j_security_check</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">j_username</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">j_password</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="tag">&lt;/form&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="digest-authentication"><a class="anchor" href="#digest-authentication"></a>Digest Authentication</h5>
<div class="paragraph">
<p>Like basic authentication, digest authentication authenticates a user based on a user name and a password.
However, unlike basic authentication, digest authentication does not send user passwords over the network.
Instead, the client sends a one-way cryptographic hash of the password and additional data.
Although passwords are not sent on the wire, digest authentication requires that clear-text password equivalents be available to the authenticating container so that it can validate received authenticators by calculating the expected digest.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="specifying-an-authentication-mechanism-in-the-deployment-descriptor"><a class="anchor" href="#specifying-an-authentication-mechanism-in-the-deployment-descriptor"></a>Specifying an Authentication Mechanism in the Deployment Descriptor</h4>
<div class="paragraph">
<p>To specify an authentication mechanism, use the <code>login-config</code> element. It can contain the following subelements.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>auth-method</code> subelement configures the authentication mechanism for the web application.
The element content must be either <code>NONE</code>, <code>BASIC</code>, <code>DIGEST</code>, <code>FORM</code>, or <code>CLIENT-CERT</code>.</p>
</li>
<li>
<p>The <code>realm-name</code> subelement indicates the realm name to use when the basic authentication scheme is chosen for the web application.</p>
</li>
<li>
<p>The <code>form-login-config</code> subelement specifies the login and error pages that should be used when form-based login is specified.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Another way to specify form-based authentication is to use the <code>authenticate</code>, <code>login</code>, and <code>logout</code> methods of <code>HttpServletRequest</code>, as discussed in <a href="#authenticating-users-programmatically">Authenticating Users Programmatically</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When you try to access a web resource that is constrained by a <code>security-constraint</code> element, the web container activates the authentication mechanism that has been configured for that resource.
The authentication mechanism specifies how the user will be prompted to log in.
If the <code>login-config</code> element is present and the <code>auth-method</code> element contains a value other than <code>NONE</code>, the user must be authenticated to access the resource.
If you do not specify an authentication mechanism, authentication of the user is not required.</p>
</div>
<div class="paragraph">
<p>The following example shows how to declare form-based authentication in your deployment descriptor:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;login-config&gt;</span>
    <span class="tag">&lt;auth-method&gt;</span>FORM<span class="tag">&lt;/auth-method&gt;</span>
    <span class="tag">&lt;realm-name&gt;</span>file<span class="tag">&lt;/realm-name&gt;</span>
    <span class="tag">&lt;form-login-config&gt;</span>
        <span class="tag">&lt;form-login-page&gt;</span>/login.xhtml<span class="tag">&lt;/form-login-page&gt;</span>
        <span class="tag">&lt;form-error-page&gt;</span>/error.xhtml<span class="tag">&lt;/form-error-page&gt;</span>
    <span class="tag">&lt;/form-login-config&gt;</span>
<span class="tag">&lt;/login-config&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The login and error page locations are specified relative to the location of the deployment descriptor.
Examples of login and error pages are shown in <a href="#creating-the-login-form-and-the-error-page">Creating the Login Form and the Error Page</a>.</p>
</div>
<div class="paragraph">
<p>The following example shows how to declare digest authentication in your deployment descriptor:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;login-config&gt;</span>
    <span class="tag">&lt;auth-method&gt;</span>DIGEST<span class="tag">&lt;/auth-method&gt;</span>
<span class="tag">&lt;/login-config&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="declaring-security-roles"><a class="anchor" href="#declaring-security-roles"></a>Declaring Security Roles</h4>
<div class="paragraph">
<p>You can declare security role names used in web applications by using the <code>security-role</code> element of the deployment descriptor.
Use this element to list all the security roles that you have referenced in your application.</p>
</div>
<div class="paragraph">
<p>The following snippet of a deployment descriptor declares the roles that will be used in an application using the <code>security-role</code> element and specifies which of these roles is authorized to access protected resources using the <code>auth-constraint</code> element:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;security-constraint&gt;</span>
    <span class="tag">&lt;web-resource-collection&gt;</span>
        <span class="tag">&lt;web-resource-name&gt;</span>Protected Area<span class="tag">&lt;/web-resource-name&gt;</span>
        <span class="tag">&lt;url-pattern&gt;</span>/security/protected/*<span class="tag">&lt;/url-pattern&gt;</span>
        <span class="tag">&lt;http-method&gt;</span>PUT<span class="tag">&lt;/http-method&gt;</span>
        <span class="tag">&lt;http-method&gt;</span>DELETE<span class="tag">&lt;/http-method&gt;</span>
        <span class="tag">&lt;http-method&gt;</span>GET<span class="tag">&lt;/http-method&gt;</span>
        <span class="tag">&lt;http-method&gt;</span>POST<span class="tag">&lt;/http-method&gt;</span>
    <span class="tag">&lt;/web-resource-collection&gt;</span>
    <span class="tag">&lt;auth-constraint&gt;</span>
        <span class="tag">&lt;role-name&gt;</span>manager<span class="tag">&lt;/role-name&gt;</span>
    <span class="tag">&lt;/auth-constraint&gt;</span>
<span class="tag">&lt;/security-constraint&gt;</span>

 <span class="comment">&lt;!-- Security roles used by this web application --&gt;</span>
<span class="tag">&lt;security-role&gt;</span>
    <span class="tag">&lt;role-name&gt;</span>manager<span class="tag">&lt;/role-name&gt;</span>
<span class="tag">&lt;/security-role&gt;</span>
<span class="tag">&lt;security-role&gt;</span>
    <span class="tag">&lt;role-name&gt;</span>employee<span class="tag">&lt;/role-name&gt;</span>
<span class="tag">&lt;/security-role&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the <code>security-role</code> element lists all the security roles used in the application: <code>manager</code> and <code>employee</code>.
This enables the deployer to map all the roles defined in the application to users and groups defined in GlassFish Server.</p>
</div>
<div class="paragraph">
<p>The <code>auth-constraint</code> element specifies the role, <code>manager</code>, that can access the HTTP methods PUT, DELETE, GET, and POST located in the directory specified by the <code>url-pattern</code> element (<code>/security/protected/*</code>).</p>
</div>
<div class="paragraph">
<p>The <code>@ServletSecurity</code> annotation cannot be used in this situation because its constraints apply to all URL patterns specified by the <code>@WebServlet</code> annotation.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-programmatic-security-with-web-applications"><a class="anchor" href="#using-programmatic-security-with-web-applications"></a>Using Programmatic Security with Web Applications</h3>
<div class="paragraph">
<p>Programmatic security is used by security-aware applications when declarative security alone is not sufficient to express the security model of the application.</p>
</div>
<div class="sect3">
<h4 id="authenticating-users-programmatically"><a class="anchor" href="#authenticating-users-programmatically"></a>Authenticating Users Programmatically</h4>
<div class="paragraph">
<p>You can use the <code>SecurityContext</code> and <code>HttpServletRequest</code> interfaces to authenticate users for a web application programmatically.</p>
</div>
<div class="sect4">
<h5 id="securitycontext"><a class="anchor" href="#securitycontext"></a>SecurityContext</h5>
<div class="paragraph">
<p>The <code>SecurityContext</code> interface, as specified in the Jakarta Security specification, defines the following method to programmatically trigger the authentication process:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>authenticate()</code> allows an application to signal to the container that it should start the authentication process with the caller.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Programmatically triggering means that the container responds as if the caller had attempted to access a constrained resource.
It causes the container to invoke the authentication mechanism configured for the application.
If the configured authentication mechanism is an <code>HttpAuthenticationMechanism</code>, then the <code>AuthenticationParameters</code> argument is meaningful and extended capabilities of <code>HttpAuthenticationMechanism</code> are available.
If not, the behavior and result is as if <code>HttpServletRequest.authenticate()</code> were called.</p>
</div>
</div>
<div class="sect4">
<h5 id="httpservletrequest"><a class="anchor" href="#httpservletrequest"></a>HttpServletRequest</h5>
<div class="paragraph">
<p>The <code>HttpServletRequest</code> interface defines the following methods that enable you to authenticate users for a web application programmatically.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>authenticate</code> allows an application to instigate authentication of the request caller by the container from within an unconstrained request context.
A login dialog box displays and collects the user name and password for authentication purposes.</p>
</li>
<li>
<p><code>login</code> allows an application to collect user name and password information as an alternative to specifying form-based authentication in an application deployment descriptor.</p>
</li>
<li>
<p><code>logout</code> allows an application to reset the caller identity of a request.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following example code shows how to use the <code>login</code> and <code>logout</code> methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">test</span>;

<span class="keyword">import</span> <span class="include">java.io.IOException</span>;
<span class="keyword">import</span> <span class="include">java.io.PrintWriter</span>;
<span class="keyword">import</span> <span class="include">java.math.BigDecimal</span>;
<span class="keyword">import</span> <span class="include">jakarta.ejb.EJB</span>;
<span class="keyword">import</span> <span class="include">jakarta.servlet.ServletException</span>;
<span class="keyword">import</span> <span class="include">jakarta.servlet.annotation.WebServlet</span>;
<span class="keyword">import</span> <span class="include">jakarta.servlet.http.HttpServlet</span>;
<span class="keyword">import</span> <span class="include">jakarta.servlet.http.HttpServletRequest</span>;
<span class="keyword">import</span> <span class="include">jakarta.servlet.http.HttpServletResponse</span>;

<span class="annotation">@WebServlet</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">TutorialServlet</span><span class="delimiter">&quot;</span></span>, urlPatterns={<span class="string"><span class="delimiter">&quot;</span><span class="content">/TutorialServlet</span><span class="delimiter">&quot;</span></span>})
<span class="directive">public</span> <span class="type">class</span> <span class="class">TutorialServlet</span> <span class="directive">extends</span> HttpServlet {
    <span class="annotation">@EJB</span>
    <span class="directive">private</span> ConverterBean converterBean;

    <span class="comment">/**
     * Processes requests for both HTTP &lt;code&gt;GET&lt;/code&gt;
     *    and &lt;code&gt;POST&lt;/code&gt; methods.
     * @param request servlet request
     * @param response servlet response
     * @throws ServletException if a servlet-specific error occurs
     * @throws IOException if an I/O error occurs
     */</span>
    <span class="directive">protected</span> <span class="type">void</span> processRequest(HttpServletRequest request,
            HttpServletResponse response)
    <span class="directive">throws</span> ServletException, <span class="exception">IOException</span> {
        response.setContentType(<span class="string"><span class="delimiter">&quot;</span><span class="content">text/html;charset=UTF-8</span><span class="delimiter">&quot;</span></span>);
        <span class="predefined-type">PrintWriter</span> out = response.getWriter();
        <span class="keyword">try</span> {

            out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;html&gt;</span><span class="delimiter">&quot;</span></span>);
            out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;head&gt;</span><span class="delimiter">&quot;</span></span>);
            out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;title&gt;Servlet TutorialServlet&lt;/title&gt;</span><span class="delimiter">&quot;</span></span>);
            out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/head&gt;</span><span class="delimiter">&quot;</span></span>);
            out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;body&gt;</span><span class="delimiter">&quot;</span></span>);
            request.login(<span class="string"><span class="delimiter">&quot;</span><span class="content">TutorialUser</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">TutorialUser</span><span class="delimiter">&quot;</span></span>);
            <span class="predefined-type">BigDecimal</span> result =
                converterBean.dollarToYen(<span class="keyword">new</span> <span class="predefined-type">BigDecimal</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">1.0</span><span class="delimiter">&quot;</span></span>));
            out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;h1&gt;Servlet TutorialServlet result of dollarToYen= </span><span class="delimiter">&quot;</span></span>
                + result + <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/h1&gt;</span><span class="delimiter">&quot;</span></span>);
            out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/body&gt;</span><span class="delimiter">&quot;</span></span>);
            out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/html&gt;</span><span class="delimiter">&quot;</span></span>);
        } <span class="keyword">catch</span> (<span class="exception">Exception</span> e) {
            <span class="keyword">throw</span> <span class="keyword">new</span> ServletException(e);
        } <span class="keyword">finally</span> {
            request.logout();
            out.close();
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example code shows how to use the <code>authenticate</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.example.test</span>;

<span class="keyword">import</span> <span class="include">java.io</span>.*;
<span class="keyword">import</span> <span class="include">jakarta.servlet</span>.*;
<span class="keyword">import</span> <span class="include">jakarta.servlet.http</span>.*;

<span class="directive">public</span> <span class="type">class</span> <span class="class">TestServlet</span> <span class="directive">extends</span> HttpServlet {

    <span class="directive">protected</span> <span class="type">void</span> processRequest(HttpServletRequest request,
            HttpServletResponse response)
            <span class="directive">throws</span> ServletException, <span class="exception">IOException</span> {
        response.setContentType(<span class="string"><span class="delimiter">&quot;</span><span class="content">text/html;charset=UTF-8</span><span class="delimiter">&quot;</span></span>);
        <span class="predefined-type">PrintWriter</span> out = response.getWriter();
        <span class="keyword">try</span> {
            request.authenticate(response);
            out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Authenticate Successful</span><span class="delimiter">&quot;</span></span>);
        } <span class="keyword">finally</span> {
            out.close();
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="checking-caller-identity-programmatically"><a class="anchor" href="#checking-caller-identity-programmatically"></a>Checking Caller Identity Programmatically</h4>
<div class="paragraph">
<p>In general, the container enforces security management in a manner that is transparent to the web component.
Use the security APIs described in this section only in the less frequent situations in which the web component methods need to access the security context information.</p>
</div>
<div class="paragraph">
<p>The Jakarta Security specification defines the following methods of the <code>SecurityContext</code> interface that allow the application to test aspects of the caller data:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>getCallerPrincipal()</code> retrieves the <code>Principal</code> representing the caller.
This is the container-specific representation of the caller principal, and the type may differ from the type of the caller principal originally established by an <code>HttpAuthenticationMechanism</code>.
This method returns null for an unauthenticated caller.</p>
</li>
<li>
<p><code>getPrincipalsByType()</code> retrieves all principals of the given type.
This method can be used to retrieve an application-specific caller principal established during authentication.
This method is primarily useful in the case that the containers caller principal is a different type than the application caller principal, and the application needs specific information behavior available only from the application principal.
This method returns an empty <code>Set</code> if the caller is unauthenticated, or if the requested type is not found.</p>
<div class="paragraph">
<p>Where both a container caller principal and an application caller principal are present, the value returned by <code>getName()</code> is the same for both principals.</p>
</div>
</li>
<li>
<p><code>isCallerInRole()</code> takes a String argument that represents the role to be tested.
The specification does not define how the role determination is made, but the result must be the same as if the corresponding container-specific call had been made (for example <code>HttpServletRequest.isUserInRole()</code>, <code>EJBContext.isCallerInRole()</code>), and must be consistent with the result implied by specifications that prescribe role-mapping behavior.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Servlet 5.0 specifies the following methods that enable you to access security information about the component&#8217;s caller.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>getRemoteUser</code> determines the user name with which the client authenticated.
The <code>getRemoteUser</code> method returns the name of the remote user (the caller) associated by the container with the request.
If no user has been authenticated, this method returns <code>null</code>.</p>
</li>
<li>
<p><code>isUserInRole</code> determines whether a remote user is in a specific security role.
If no user has been authenticated, this method returns <code>false</code>.
This method expects a <code>String</code> user <code>role-name</code> parameter.</p>
<div class="paragraph">
<p>The <code>security-role-ref</code> element should be declared in the deployment descriptor with a <code>role-name</code> subelement containing the role name to be passed to the method.
Using security role references is discussed in <a href="#declaring-and-linking-role-references">Declaring and Linking Role References</a>.</p>
</div>
</li>
<li>
<p><code>getUserPrincipal</code> determines the principal name of the current user and returns a <code>java.security.Principal</code> object.
If no user has been authenticated, this method returns <code>null</code>.
Calling the <code>getName</code> method on the <code>Principal</code> returned by <code>getUserPrincipal</code> returns the name of the remote user.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Your application can make business-logic decisions based on the information obtained using these APIs.</p>
</div>
</div>
<div class="sect3">
<h4 id="testing-access-to-a-resource-programmatically"><a class="anchor" href="#testing-access-to-a-resource-programmatically"></a>Testing Access to a Resource Programmatically</h4>
<div class="paragraph">
<p>The <code>SecurityContext</code> interface, as specified in the Jakarta Security API specification, defines the following method for programmatically testing access to a resource:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>hasAccessToWebResource()</code> method determines if the caller has access to the specified web resource for the specified HTTP methods, as determined by the security constraints configured for the application.</p>
<div class="paragraph">
<p>The resource parameter is an <code>URLPatternSpec</code>, as defined by Jakarta Authorization (<a href="https://jakarta.ee/specifications/authorization/2.0/" class="bare" target="_blank" rel="noopener">https://jakarta.ee/specifications/authorization/2.0/</a>), that identifies an application-specific web resource.</p>
</div>
<div class="paragraph">
<p>This method can be used to check access to resources in the current application only  it cannot be called cross-application, or cross-container, to check access to resources in a different application.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, consider the following Servlet definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@WebServlet</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/protectedServlet</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@ServletSecurity</span>(<span class="annotation">@HttpConstraint</span>(rolesAllowed = <span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>))
<span class="directive">public</span> <span class="type">class</span> <span class="class">ProtectedServlet</span> <span class="directive">extends</span> HttpServlet { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>And the following call to <code>hasAccessToWebResource()</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">securityContext.hasAccessToWebResource(<span class="string"><span class="delimiter">&quot;</span><span class="content">/protectedServlet</span><span class="delimiter">&quot;</span></span>, GET)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above <code>hasAccessToWebResource()</code> call returns true if, and only if, the caller is in role "foo".</p>
</div>
</div>
<div class="sect3">
<h4 id="example-code-for-programmatic-security"><a class="anchor" href="#example-code-for-programmatic-security"></a>Example Code for Programmatic Security</h4>
<div class="paragraph">
<p>The following code demonstrates the use of programmatic security for the purposes of programmatic login.
This servlet does the following.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>It displays information about the current user.</p>
</li>
<li>
<p>It prompts the user to log in.</p>
</li>
<li>
<p>It prints out the information again to demonstrate the effect of the <code>login</code> method.</p>
</li>
<li>
<p>It logs the user out.</p>
</li>
<li>
<p>It prints out the information again to demonstrate the effect of the <code>logout</code> method.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">enterprise.programmatic_login</span>;

<span class="keyword">import</span> <span class="include">java.io</span>.*;
<span class="keyword">import</span> <span class="include">java.net</span>.*;
<span class="keyword">import</span> <span class="include">jakarta.annotation.security.DeclareRoles</span>;
<span class="keyword">import</span> <span class="include">jakarta.servlet</span>.*;
<span class="keyword">import</span> <span class="include">jakarta.servlet.http</span>.*;

<span class="annotation">@DeclareRoles</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaeeuser</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">LoginServlet</span> <span class="directive">extends</span> HttpServlet {

    <span class="comment">/**
     * Processes requests for both HTTP GET and POST methods.
     * @param request servlet request
     * @param response servlet response
     */</span>
    <span class="directive">protected</span> <span class="type">void</span> processRequest(HttpServletRequest request,
                 HttpServletResponse response)
            <span class="directive">throws</span> ServletException, <span class="exception">IOException</span> {
        response.setContentType(<span class="string"><span class="delimiter">&quot;</span><span class="content">text/html;charset=UTF-8</span><span class="delimiter">&quot;</span></span>);
        <span class="predefined-type">PrintWriter</span> out = response.getWriter();
        <span class="keyword">try</span> {
            <span class="predefined-type">String</span> userName = request.getParameter(<span class="string"><span class="delimiter">&quot;</span><span class="content">txtUserName</span><span class="delimiter">&quot;</span></span>);
            <span class="predefined-type">String</span> password = request.getParameter(<span class="string"><span class="delimiter">&quot;</span><span class="content">txtPassword</span><span class="delimiter">&quot;</span></span>);

            out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Before Login</span><span class="delimiter">&quot;</span></span> + <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;br&gt;&lt;br&gt;</span><span class="delimiter">&quot;</span></span>);
            out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">IsUserInRole?..</span><span class="delimiter">&quot;</span></span>
                        + request.isUserInRole(<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaeeuser</span><span class="delimiter">&quot;</span></span>)+<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;br&gt;</span><span class="delimiter">&quot;</span></span>);
            out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">getRemoteUser?..</span><span class="delimiter">&quot;</span></span> + request.getRemoteUser()+<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;br&gt;</span><span class="delimiter">&quot;</span></span>);
            out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">getUserPrincipal?..</span><span class="delimiter">&quot;</span></span>
                        + request.getUserPrincipal()+<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;br&gt;</span><span class="delimiter">&quot;</span></span>);
            out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">getAuthType?..</span><span class="delimiter">&quot;</span></span> + request.getAuthType()+<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;br&gt;&lt;br&gt;</span><span class="delimiter">&quot;</span></span>);

            <span class="keyword">try</span> {
                request.login(userName, password);
            } <span class="keyword">catch</span>(ServletException ex) {
                out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Login Failed with a ServletException..</span><span class="delimiter">&quot;</span></span>
                    + ex.getMessage());
                <span class="keyword">return</span>;
            }
            out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">After Login...</span><span class="delimiter">&quot;</span></span>+<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;br&gt;&lt;br&gt;</span><span class="delimiter">&quot;</span></span>);
            out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">IsUserInRole?..</span><span class="delimiter">&quot;</span></span>
                        + request.isUserInRole(<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaeeuser</span><span class="delimiter">&quot;</span></span>)+<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;br&gt;</span><span class="delimiter">&quot;</span></span>);
            out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">getRemoteUser?..</span><span class="delimiter">&quot;</span></span> + request.getRemoteUser()+<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;br&gt;</span><span class="delimiter">&quot;</span></span>);
            out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">getUserPrincipal?..</span><span class="delimiter">&quot;</span></span>
                        + request.getUserPrincipal()+<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;br&gt;</span><span class="delimiter">&quot;</span></span>);
            out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">getAuthType?..</span><span class="delimiter">&quot;</span></span> + request.getAuthType()+<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;br&gt;&lt;br&gt;</span><span class="delimiter">&quot;</span></span>);

            request.logout();
            out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">After Logout...</span><span class="delimiter">&quot;</span></span>+<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;br&gt;&lt;br&gt;</span><span class="delimiter">&quot;</span></span>);
            out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">IsUserInRole?..</span><span class="delimiter">&quot;</span></span>
                        + request.isUserInRole(<span class="string"><span class="delimiter">&quot;</span><span class="content">jakartaeeuser</span><span class="delimiter">&quot;</span></span>)+<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;br&gt;</span><span class="delimiter">&quot;</span></span>);
            out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">getRemoteUser?..</span><span class="delimiter">&quot;</span></span> + request.getRemoteUser()+<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;br&gt;</span><span class="delimiter">&quot;</span></span>);
            out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">getUserPrincipal?..</span><span class="delimiter">&quot;</span></span>
                        + request.getUserPrincipal()+<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;br&gt;</span><span class="delimiter">&quot;</span></span>);
            out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">getAuthType?..</span><span class="delimiter">&quot;</span></span> + request.getAuthType()+<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;br&gt;</span><span class="delimiter">&quot;</span></span>);
        } <span class="keyword">finally</span> {
            out.close();
        }
    }
    ...
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="declaring-and-linking-role-references"><a class="anchor" href="#declaring-and-linking-role-references"></a>Declaring and Linking Role References</h4>
<div class="paragraph">
<p>A security role reference is a mapping between the name of a role that is called from a web component using <code>isUserInRole(String role)</code> and the name of a security role that has been defined for the application.
If no <code>security-role-ref</code> element is declared in a deployment descriptor and the <code>isUserInRole</code> method is called, the container defaults to checking the provided role name against the list of all security roles defined for the web application.
Using the default method instead of using the <code>security-role-ref</code> element limits your flexibility to change role names in an application without also recompiling the servlet making the call.</p>
</div>
<div class="paragraph">
<p>The <code>security-role-ref</code> element is used when an application uses the <code>HttpServletRequest.isUserInRole(String role)</code>.
The value passed to the <code>isUserInRole</code> method is a <code>String</code> representing the role name of the user.
The value of the <code>role-name</code> element must be the <code>String</code> used as the parameter to the <code>HttpServletRequest.isUserInRole(String role)</code>.
The <code>role-link</code> must contain the name of one of the security roles defined in the <code>security-role</code> elements.
The container uses the mapping of <code>security-role-ref</code> to <code>security-role</code> when determining the return value of the call.</p>
</div>
<div class="paragraph">
<p>For example, to map the security role reference <code>cust</code> to the security role with role name <code>bankCustomer</code>, the elements would look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;servlet&gt;</span>
...
    <span class="tag">&lt;security-role-ref&gt;</span>
        <span class="tag">&lt;role-name&gt;</span>cust<span class="tag">&lt;/role-name&gt;</span>
        <span class="tag">&lt;role-link&gt;</span>bankCustomer<span class="tag">&lt;/role-link&gt;</span>
    <span class="tag">&lt;/security-role-ref&gt;</span>
...
<span class="tag">&lt;/servlet&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If the servlet method is called by a user in the <code>bankCustomer</code> security role, <code>isUserInRole("cust")</code> returns <code>true</code>.</p>
</div>
<div class="paragraph">
<p>The <code>role-link</code> element in the <code>security-role-ref</code> element must match a <code>role-name</code> defined in the <code>security-role</code> element of the same <code>web.xml</code> deployment descriptor, as shown here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;security-role&gt;</span>
    <span class="tag">&lt;role-name&gt;</span>bankCustomer<span class="tag">&lt;/role-name&gt;</span>
<span class="tag">&lt;/security-role&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A security role reference, including the name defined by the reference, is scoped to the component whose deployment descriptor contains the <code>security-role-ref</code> deployment descriptor element.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="examples-securing-web-applications"><a class="anchor" href="#examples-securing-web-applications"></a>Examples: Securing Web Applications</h3>
<div class="paragraph">
<p>Some basic setup is required before any of the example applications will run correctly.</p>
</div>
<div class="sect3">
<h4 id="overview-of-examples-of-securing-web-applications"><a class="anchor" href="#overview-of-examples-of-securing-web-applications"></a>Overview of Examples of Securing Web Applications</h4>
<div class="paragraph">
<p>The examples use annotations, programmatic security, and/or declarative security to demonstrate adding security to existing web applications.</p>
</div>
<div class="paragraph">
<p>Here are some other locations where you will find examples of securing various types of applications:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#the-cart-secure-example-securing-an-enterprise-bean-with-declarative-security">The cart-secure Example: Securing an Enterprise Bean with Declarative Security</a></p>
</li>
<li>
<p><a href="#the-converter-secure-example-securing-an-enterprise-bean-with-programmatic-security">The converter-secure Example: Securing an Enterprise Bean with Programmatic Security</a></p>
</li>
<li>
<p>Eclipse GlassFish samples for Jakarta EE 9: <a href="https://github.com/eclipse-ee4j/glassfish-samples" class="bare" target="_blank" rel="noopener">https://github.com/eclipse-ee4j/glassfish-samples</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="to-set-up-your-system-for-running-the-security-examples"><a class="anchor" href="#to-set-up-your-system-for-running-the-security-examples"></a>To Set Up Your System for Running the Security Examples</h4>
<div class="paragraph">
<p>To set up your system for running the security examples, you need to configure a user database that the application can use for authenticating users.
Before continuing, follow these steps.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>Add an authorized user to GlassFish Server.
For the examples in this chapter and in <a href="#getting-started-securing-enterprise-applications">Getting Started Securing Enterprise Applications</a>, add a user to the <code>file</code> realm of GlassFish Server, and assign the user to the group <code>TutorialUser</code>.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>From the Administration Console, expand the Configurations node, then expand the server-config node.</p>
</li>
<li>
<p>Expand the Security node.</p>
</li>
<li>
<p>Expand the Realms node.</p>
</li>
<li>
<p>Select the File node.</p>
</li>
<li>
<p>On the Edit Realm page, click Manage Users.</p>
</li>
<li>
<p>On the File Users page, click New.</p>
</li>
<li>
<p>In the User ID field, enter a user ID.</p>
</li>
<li>
<p>In the Group List field, enter <code>TutorialUser</code>.</p>
</li>
<li>
<p>In the New Password and Confirm New Password fields, enter a password.</p>
</li>
<li>
<p>Click OK.</p>
<div class="paragraph">
<p>Be sure to write down the user name and password for the user you create so that you can use it for testing the example applications.
Authentication is case sensitive for both the user name and password, so write down the user name and password exactly.
This topic is discussed more in <a href="#managing-users-and-groups-in-glassfish-server">Managing Users and Groups in GlassFish Server</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Jakarta Security requires that group principal names are mapped to roles of the same name by default.
Therefore, the <strong>Default Principal To Role Mapping</strong> setting is enabled by default on the Security page of the console.
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="the-hello2-basicauth-example-basic-authentication-with-a-servlet"><a class="anchor" href="#the-hello2-basicauth-example-basic-authentication-with-a-servlet"></a>The hello2-basicauth Example: Basic Authentication with a Servlet</h4>
<div class="paragraph">
<p>This example explains how to use basic authentication with a servlet.
With basic authentication of a servlet, the web browser presents a standard login dialog box that is not customizable.
When a user submits his or her name and password, the server determines whether the user name and password are those of an authorized user and sends the requested web resource if the user is authorized to view it.</p>
</div>
<div class="paragraph">
<p>In general, the following steps are necessary for adding basic authentication to an unsecured servlet, such as the ones described in <a href="#getting-started-with-web-applications">Chapter 6, <em>Getting Started with Web Applications</em></a>.
In the example application included with this tutorial, many of these steps have been completed for you and are listed here simply to show what needs to be done should you wish to create a similar application.
This application can be found in the <code><em>tut-install</em>/examples/security/hello2-basicauth/</code> directory.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Follow the steps in <a href="#to-set-up-your-system-for-running-the-security-examples">To Set Up Your System for Running the Security Examples</a>.</p>
</li>
<li>
<p>Create a web module for the servlet example, <code>hello2</code>, as described in <a href="#getting-started-with-web-applications">Chapter 6, <em>Getting Started with Web Applications</em></a>.</p>
</li>
<li>
<p>Add the appropriate security annotations to the servlet. The security annotations are described in <a href="#specifying-security-for-basic-authentication-using-annotations">Specifying Security for Basic Authentication Using Annotations</a>.</p>
</li>
<li>
<p>Build, package, and deploy the web application by following the steps in <a href="#to-build-package-and-deploy-the-hello2-basicauth-example-using-netbeans-ide">To Build, Package, and Deploy the hello2-basicauth Example Using NetBeans IDE</a> or <a href="#to-build-package-and-deploy-the-hello2-basicauth-example-using-maven">To Build, Package, and Deploy the hello2-basicauth Example Using Maven</a>.</p>
</li>
<li>
<p>Run the web application by following the steps described in <a href="#to-run-the-hello2-basicauth-example">To Run the hello2-basicauth Example</a>.</p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="specifying-security-for-basic-authentication-using-annotations"><a class="anchor" href="#specifying-security-for-basic-authentication-using-annotations"></a>Specifying Security for Basic Authentication Using Annotations</h5>
<div class="paragraph">
<p>The default authentication mechanism used by GlassFish Server is basic authentication.
With basic authentication, GlassFish Server spawns a standard login dialog box to collect user name and password data for a protected resource.
Once the user is authenticated, access to the protected resource is permitted.</p>
</div>
<div class="paragraph">
<p>To specify security for a servlet, use the <code>@ServletSecurity</code> annotation.
This annotation allows you to specify both specific constraints on HTTP methods and more general constraints that apply to all HTTP methods for which no specific constraint is specified.
Within the <code>@ServletSecurity</code> annotation, you can specify the following annotations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>@HttpMethodConstraint</code> annotation, which applies to a specific HTTP method</p>
</li>
<li>
<p>The more general <code>@HttpConstraint</code> annotation, which applies to all HTTP methods for which there is no corresponding <code>@HttpMethodConstraint</code> annotation</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Both the <code>@HttpMethodConstraint</code> and <code>@HttpConstraint</code> annotations within the <code>@ServletSecurity</code> annotation can specify the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <code>transportGuarantee</code> element that specifies the data protection requirements (that is, whether or not SSL/TLS is required) that must be satisfied by the connections on which requests arrive.
Valid values for this element are <code>NONE</code> and <code>CONFIDENTIAL</code>.</p>
</li>
<li>
<p>A <code>rolesAllowed</code> element that specifies the names of the authorized roles.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For the <code>hello2-basicauth</code> application, the <code>GreetingServlet</code> has the following annotations:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@WebServlet</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">GreetingServlet</span><span class="delimiter">&quot;</span></span>, urlPatterns = {<span class="string"><span class="delimiter">&quot;</span><span class="content">/greeting</span><span class="delimiter">&quot;</span></span>})
<span class="annotation">@ServletSecurity</span>(
<span class="annotation">@HttpConstraint</span>(transportGuarantee = TransportGuarantee.CONFIDENTIAL,
    rolesAllowed = {<span class="string"><span class="delimiter">&quot;</span><span class="content">TutorialUser</span><span class="delimiter">&quot;</span></span>}))</code></pre>
</div>
</div>
<div class="paragraph">
<p>These annotations specify that the request URI <code>/greeting</code> can be accessed only by users who have been authorized to access this URL because they have been verified to be in the role <code>TutorialUser</code>.
The data will be sent over a protected transport in order to keep the user name and password data from being read in transit.</p>
</div>
<div class="paragraph">
<p>If you use the <code>@ServletSecurity</code> annotation, you do not need to specify security settings in the deployment descriptor.
Use the deployment descriptor to specify settings for nondefault authentication mechanisms, for which you cannot use the <code>@ServletSecurity</code> annotation.</p>
</div>
</div>
<div class="sect4">
<h5 id="to-build-package-and-deploy-the-hello2-basicauth-example-using-netbeans-ide"><a class="anchor" href="#to-build-package-and-deploy-the-hello2-basicauth-example-using-netbeans-ide"></a>To Build, Package, and Deploy the hello2-basicauth Example Using NetBeans IDE</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Follow the steps in <a href="#to-set-up-your-system-for-running-the-security-examples">To Set Up Your System for Running the Security Examples</a>.</p>
</li>
<li>
<p>From the File menu, choose Open Project.</p>
</li>
<li>
<p>In the Open Project dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/security</pre>
</div>
</div>
</li>
<li>
<p>Select the <code>hello2-basicauth</code> folder.</p>
</li>
<li>
<p>Click Open Project.</p>
</li>
<li>
<p>In the Projects tab, right-click the <code>hello2-basicauth</code> project and select Build.</p>
<div class="paragraph">
<p>This command builds and deploys the example application to your GlassFish Server instance.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-build-package-and-deploy-the-hello2-basicauth-example-using-maven"><a class="anchor" href="#to-build-package-and-deploy-the-hello2-basicauth-example-using-maven"></a>To Build, Package, and Deploy the hello2-basicauth Example Using Maven</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Follow the steps in <a href="#to-set-up-your-system-for-running-the-security-examples">To Set Up Your System for Running the Security Examples</a>.</p>
</li>
<li>
<p>In a terminal window, go to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/security/hello2-basicauth/</pre>
</div>
</div>
</li>
<li>
<p>Enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">mvn install</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command builds and packages the application into a WAR file, <code>hello2-basicauth.war</code>, that is located in the <code>target</code> directory, then deploys the WAR file.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-run-the-hello2-basicauth-example"><a class="anchor" href="#to-run-the-hello2-basicauth-example"></a>To Run the hello2-basicauth Example</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In a web browser, enter the following URL:</p>
<div class="listingblock">
<div class="content">
<pre>https://localhost:8181/hello2-basicauth/greeting</pre>
</div>
</div>
<div class="paragraph">
<p>You may be prompted to accept the security certificate for the server.
If so, accept the security certificate.
If the browser warns that the certificate is invalid because it is self-signed, add a security exception for the application.</p>
</div>
<div class="paragraph">
<p>An Authentication Required dialog box appears.
Its appearance varies, depending on the browser you use.</p>
</div>
</li>
<li>
<p>Enter a user name and password combination that corresponds to a user who has already been created in the <code>file</code> realm of GlassFish Server and has been assigned to the group <code>TutorialUser</code>; then click OK.</p>
<div class="paragraph">
<p>Basic authentication is case sensitive for both the user name and password, so enter the user name and password exactly as defined for GlassFish Server.</p>
</div>
<div class="paragraph">
<p>The server returns the requested resource if all the following conditions are met:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A user with the user name you entered is defined for GlassFish Server.</p>
</li>
<li>
<p>The user with the user name you entered has the password you entered.</p>
</li>
<li>
<p>The user name and password combination you entered is assigned to the group <code>TutorialUser</code> in GlassFish Server.</p>
</li>
<li>
<p>The role of <code>TutorialUser</code>, as defined for the application, is mapped to the group <code>TutorialUser</code>, as defined for GlassFish Server.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Enter a name in the field and click Submit.</p>
<div class="paragraph">
<p>Because you have already been authorized, the name you enter in this step does not have any limitations.
You have unlimited access to the application now.</p>
</div>
<div class="paragraph">
<p>The application responds by saying "Hello" to the name you entered.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="the-hello1-formauth-example-form-based-authentication-with-a-jakarta-faces-application"><a class="anchor" href="#the-hello1-formauth-example-form-based-authentication-with-a-jakarta-faces-application"></a>The hello1-formauth Example: Form-Based Authentication with a Jakarta Faces Application</h4>
<div class="paragraph">
<p>This example explains how to use form-based authentication with a Jakarta Faces application.
With form-based authentication, you can customize the login screen and error pages that are presented to the web client for authentication of the user name and password.
When a user submits his or her name and password, the server determines whether the user name and password are those of an authorized user and, if authorized, sends the requested web resource.</p>
</div>
<div class="paragraph">
<p>This example, <code>hello1-formauth</code>, adds security to the basic Jakarta Faces application shown in <a href="#a-web-module-that-uses-jakarta-faces-technology-the-hello1-example">A Web Module That Uses Jakarta Faces Technology: The hello1 Example</a>.</p>
</div>
<div class="paragraph">
<p>In general, the steps necessary for adding form-based authentication to an unsecured Jakarta Faces application are similar to those described in <a href="#the-hello2-basicauth-example-basic-authentication-with-a-servlet">The hello2-basicauth Example: Basic Authentication with a Servlet</a>.
The major difference is that you must use a deployment descriptor to specify the use of form-based authentication, as described in <a href="#specifying-security-for-the-form-based-authentication-example">Specifying Security for the Form-Based Authentication Example</a>.
In addition, you must create a login form page and a login error page, as described in <a href="#creating-the-login-form-and-the-error-page">Creating the Login Form and the Error Page</a>.</p>
</div>
<div class="paragraph">
<p>This application can be found in the <code><em>tut-install</em>/examples/security/hello1-formauth/</code> directory.</p>
</div>
<div class="sect4">
<h5 id="creating-the-login-form-and-the-error-page"><a class="anchor" href="#creating-the-login-form-and-the-error-page"></a>Creating the Login Form and the Error Page</h5>
<div class="paragraph">
<p>When using form-based login mechanisms, you must specify a page that contains the form you want to use to obtain the user name and password, as well as a page to display if login authentication fails.
This section discusses the login form and the error page used in this example.
<a href="#specifying-security-for-the-form-based-authentication-example">Specifying Security for the Form-Based Authentication Example</a> shows how you specify these pages in the deployment descriptor.</p>
</div>
<div class="paragraph">
<p>The login page can be an HTML page or a servlet, and it must return an HTML page containing a form that conforms to specific naming conventions (see the Jakarta Servlet 5.0 specification for more information on these requirements).
To do this, include the elements that accept user name and password information between <code>&lt;form&gt;&lt;/form&gt;</code> tags in your login page.
The content of an HTML page or servlet for a login page should be coded as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><span class="tag">&lt;form</span> <span class="attribute-name">method</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">post</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">j_security_check</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">j_username</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>= <span class="string"><span class="delimiter">&quot;</span><span class="content">j_password</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="tag">&lt;/form&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The full code for the login page used in this example can be found at <code><em>tut-install</em>/examples/security/hello1-formauth/src/main/webapp/login.html</code>.
Here is the code for this page:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><span class="tag">&lt;html</span> <span class="attribute-name">lang</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;head&gt;</span>
        <span class="tag">&lt;title&gt;</span>Login Form<span class="tag">&lt;/title&gt;</span>
    <span class="tag">&lt;/head&gt;</span>
    <span class="tag">&lt;body&gt;</span>
        <span class="tag">&lt;h2&gt;</span>Hello, please log in:<span class="tag">&lt;/h2&gt;</span>
        <span class="tag">&lt;form</span> <span class="attribute-name">method</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">post</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">j_security_check</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;table</span> <span class="attribute-name">role</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">presentation</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;tr&gt;</span>
                    <span class="tag">&lt;td&gt;</span>Please type your user name: <span class="tag">&lt;/td&gt;</span>
                    <span class="tag">&lt;td&gt;</span><span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">j_username</span><span class="delimiter">&quot;</span></span>
                               <span class="attribute-name">size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">20</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span><span class="tag">&lt;/td&gt;</span>
                <span class="tag">&lt;/tr&gt;</span>
                <span class="tag">&lt;tr&gt;</span>
                    <span class="tag">&lt;td&gt;</span>Please type your password: <span class="tag">&lt;/td&gt;</span>
                    <span class="tag">&lt;td&gt;</span><span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">j_password</span><span class="delimiter">&quot;</span></span>
                               <span class="attribute-name">size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">20</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span><span class="tag">&lt;/td&gt;</span>
                <span class="tag">&lt;/tr&gt;</span>
            <span class="tag">&lt;/table&gt;</span>
            <span class="tag">&lt;p&gt;</span><span class="tag">&lt;/p&gt;</span>
            <span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">submit</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Submit</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="entity">&amp;nbsp;</span>
            <span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">reset</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Reset</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/form&gt;</span>
    <span class="tag">&lt;/body&gt;</span>
<span class="tag">&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The login error page is displayed if the user enters a user name and password combination that is not authorized to access the protected URI.
For this example, the login error page can be found at <code><em>tut-install</em>/examples/security/hello1-formauth/src/main/webapp/error.html</code>.
For this example, the login error page explains the reason for receiving the error page and provides a link that will allow the user to try again.
Here is the code for this page:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><span class="tag">&lt;html</span> <span class="attribute-name">lang</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;head&gt;</span>
        <span class="tag">&lt;title&gt;</span>Login Error<span class="tag">&lt;/title&gt;</span>
    <span class="tag">&lt;/head&gt;</span>
    <span class="tag">&lt;body&gt;</span>
        <span class="tag">&lt;h2&gt;</span>Invalid user name or password.<span class="tag">&lt;/h2&gt;</span>

        <span class="tag">&lt;p&gt;</span>Please enter a user name or password that is authorized to access
           this application. For this application, this means a user that
           has been created in the <span class="tag">&lt;code&gt;</span>file<span class="tag">&lt;/code&gt;</span> realm and has been
           assigned to the <span class="tag">&lt;em&gt;</span>group<span class="tag">&lt;/em&gt;</span> of <span class="tag">&lt;code&gt;</span>TutorialUser<span class="tag">&lt;/code&gt;</span>.<span class="tag">&lt;/p&gt;</span>
        <span class="tag">&lt;p&gt;</span><span class="tag">&lt;a</span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">login.html</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>Return to login page<span class="tag">&lt;/a&gt;</span><span class="tag">&lt;/p&gt;</span>
    <span class="tag">&lt;/body&gt;</span>
<span class="tag">&lt;/html&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="specifying-security-for-the-form-based-authentication-example"><a class="anchor" href="#specifying-security-for-the-form-based-authentication-example"></a>Specifying Security for the Form-Based Authentication Example</h5>
<div class="paragraph">
<p>This example takes a very simple servlet-based web application and adds form-based security.
To specify form-based instead of basic authentication for a Jakarta Faces example, you must use the deployment descriptor.</p>
</div>
<div class="paragraph">
<p>The following sample code shows the security elements added to the deployment descriptor for this example, which can be found in <code><em>tut-install</em>/examples/security/hello1-formauth/src/main/webapp/WEB-INF/web.xml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">    <span class="tag">&lt;security-constraint&gt;</span>
        <span class="tag">&lt;display-name&gt;</span>Constraint1<span class="tag">&lt;/display-name&gt;</span>
        <span class="tag">&lt;web-resource-collection&gt;</span>
            <span class="tag">&lt;web-resource-name&gt;</span>wrcoll<span class="tag">&lt;/web-resource-name&gt;</span>
            <span class="tag">&lt;description</span><span class="tag">/&gt;</span>
            <span class="tag">&lt;url-pattern&gt;</span>/*<span class="tag">&lt;/url-pattern&gt;</span>
        <span class="tag">&lt;/web-resource-collection&gt;</span>
        <span class="tag">&lt;auth-constraint&gt;</span>
            <span class="tag">&lt;description</span><span class="tag">/&gt;</span>
            <span class="tag">&lt;role-name&gt;</span>TutorialUser<span class="tag">&lt;/role-name&gt;</span>
        <span class="tag">&lt;/auth-constraint&gt;</span>
    <span class="tag">&lt;/security-constraint&gt;</span>

    <span class="tag">&lt;login-config&gt;</span>
        <span class="tag">&lt;auth-method&gt;</span>FORM<span class="tag">&lt;/auth-method&gt;</span>
        <span class="tag">&lt;realm-name&gt;</span>file<span class="tag">&lt;/realm-name&gt;</span>
        <span class="tag">&lt;form-login-config&gt;</span>
            <span class="tag">&lt;form-login-page&gt;</span>/login.xhtml<span class="tag">&lt;/form-login-page&gt;</span>
            <span class="tag">&lt;form-error-page&gt;</span>/error.xhtml<span class="tag">&lt;/form-error-page&gt;</span>
        <span class="tag">&lt;/form-login-config&gt;</span>
    <span class="tag">&lt;/login-config&gt;</span>

    <span class="tag">&lt;security-role&gt;</span>
        <span class="tag">&lt;description</span><span class="tag">/&gt;</span>
        <span class="tag">&lt;role-name&gt;</span>TutorialUser<span class="tag">&lt;/role-name&gt;</span>
    <span class="tag">&lt;/security-role&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="to-build-package-and-deploy-the-hello1-formauth-example-using-netbeans-ide"><a class="anchor" href="#to-build-package-and-deploy-the-hello1-formauth-example-using-netbeans-ide"></a>To Build, Package, and Deploy the hello1-formauth Example Using NetBeans IDE</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Follow the steps in <a href="#to-set-up-your-system-for-running-the-security-examples">To Set Up Your System for Running the Security Examples</a>.</p>
</li>
<li>
<p>From the File menu, choose Open Project.</p>
</li>
<li>
<p>In the Open Project dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/security</pre>
</div>
</div>
</li>
<li>
<p>Select the <code>hello1-formauth</code> folder.</p>
</li>
<li>
<p>Click Open Project.</p>
</li>
<li>
<p>In the Projects tab, right-click the <code>hello1-formauth</code> project and select Run.</p>
<div class="paragraph">
<p>This command builds and deploys the example application to your GlassFish Server instance, then opens it in a browser.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-build-package-and-deploy-the-hello1-formauth-example-using-maven-and-the-asadmin-command"><a class="anchor" href="#to-build-package-and-deploy-the-hello1-formauth-example-using-maven-and-the-asadmin-command"></a>To Build, Package, and Deploy the hello1-formauth Example Using Maven and the asadmin Command</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Follow the steps in <a href="#to-set-up-your-system-for-running-the-security-examples">To Set Up Your System for Running the Security Examples</a>.</p>
</li>
<li>
<p>In a terminal window, go to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/security/hello1-formauth/</pre>
</div>
</div>
</li>
<li>
<p>Enter the following command at the terminal window or command prompt:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">mvn install</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command builds and packages the application into a WAR file, <code>hello1-formauth.war</code>, that is located in the <code>target</code> directory, then deploys the WAR file to GlassFish Server.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-run-the-hello1-formauth-example"><a class="anchor" href="#to-run-the-hello1-formauth-example"></a>To Run the hello1-formauth Example</h5>
<div class="paragraph">
<p>To run the web client for <code>hello1-formauth</code>, follow these steps.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open a web browser to the following URL:</p>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080/hello1-formauth/</pre>
</div>
</div>
</li>
<li>
<p>In the login form, enter a user name and password combination that corresponds to a user who has already been created in the <code>file</code> realm of GlassFish Server and has been assigned to the group <code>TutorialUser</code>.</p>
<div class="paragraph">
<p>Form-based authentication is case sensitive for both the user name and password, so enter the user name and password exactly as defined for GlassFish Server.</p>
</div>
</li>
<li>
<p>Click Submit.</p>
<div class="paragraph">
<p>If you entered <code>My_Name</code> as the name and <code>My_Pwd</code> for the password, the server returns the requested resource if all the following conditions are met.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A user with the user name <code>My_Name</code> is defined for GlassFish Server.</p>
</li>
<li>
<p>The user with the user name <code>My_Name</code> has a password <code>My_Pwd</code> defined for GlassFish Server.</p>
</li>
<li>
<p>The user <code>My_Name</code> with the password <code>My_Pwd</code> is assigned to the group <code>TutorialUser</code> on GlassFish Server.</p>
</li>
<li>
<p>The role <code>TutorialUser</code>, as defined for the application, is mapped to the group <code>TutorialUser</code>, as defined for GlassFish Server.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When these conditions are met and the server has authenticated the user, the application appears.</p>
</div>
</li>
<li>
<p>Enter your name and click Submit.</p>
<div class="paragraph">
<p>Because you have already been authorized, the name you enter in this step does not have any limitations.
You have unlimited access to the application now.</p>
</div>
<div class="paragraph">
<p>The application responds by saying "Hello" to you.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="next-steps"><a class="anchor" href="#next-steps"></a>Next Steps</h5>
<div class="paragraph">
<p>For additional testing and to see the login error page generated, close and reopen your browser, enter the application URL, and enter a user name and password that are not authorized.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="getting-started-securing-enterprise-applications"><a class="anchor" href="#getting-started-securing-enterprise-applications"></a>Chapter 52. Getting Started Securing Enterprise Applications</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter describes how to administer security for enterprise applications.</p>
</div>
<div class="sect2">
<h3 id="basic-security-tasks-for-enterprise-applications"><a class="anchor" href="#basic-security-tasks-for-enterprise-applications"></a>Basic Security Tasks for Enterprise Applications</h3>
<div class="paragraph">
<p>System administrators, application developers, bean providers, and deployers are responsible for administering security for enterprise applications.
The basic security tasks are as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Setting up a database of users and assigning them to the proper group</p>
</li>
<li>
<p>Setting up identity propagation</p>
</li>
<li>
<p>Setting GlassFish Server properties that enable the applications to run properly.
Note that the the <strong>Default Principal To Role Mapping</strong> setting is enabled by default in the GlassFish Server Administration Console.</p>
</li>
<li>
<p>Annotating the classes and methods of an enterprise application to provide information about which methods need to have restricted access</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The sections on the security examples in this chapter and the previous chapter explain how to perform these tasks.</p>
</div>
</div>
<div class="sect2">
<h3 id="securing-enterprise-beans"><a class="anchor" href="#securing-enterprise-beans"></a>Securing Enterprise Beans</h3>
<div class="paragraph">
<p>Enterprise beans are Jakarta EE components that implement enterprise bean technology.
Enterprise beans run in the enterprise bean container, a runtime environment within GlassFish Server.
Although transparent to the application developer, the enterprise bean container provides system-level services, such as transactions and security to its enterprise beans, which form the core of transactional Jakarta EE applications.</p>
</div>
<div class="paragraph">
<p>Enterprise bean methods can be secured in either of the following ways.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Declarative security (preferred): Expresses an application component&#8217;s security requirements using either deployment descriptors or annotations.
The presence of an annotation in the business method of an enterprise bean class that specifies method permissions is all that is needed for method protection and authentication in some situations.
This section discusses this simple and efficient method of securing enterprise beans.</p>
<div class="paragraph">
<p>Because of some limitations to the simplified method of securing enterprise beans, you would want to continue to use the deployment descriptor to specify security information in some instances.
An authentication mechanism must be configured on the server for the simple solution to work.
Basic authentication is GlassFish Server&#8217;s default authentication method.</p>
</div>
<div class="paragraph">
<p>This tutorial explains how to invoke user name/password authentication of authorized users by decorating the enterprise application&#8217;s business methods with annotations that specify method permissions.</p>
</div>
<div class="paragraph">
<p>To make the deployer&#8217;s task easier, the application developer can define security roles.
A security role is a grouping of permissions that a given type of application users must have in order to successfully use the application.
For example, in a payroll application, some users will want to view their own payroll information (employee), some will need to view others' payroll information (manager), and some will need to be able to change others' payroll information (payrollDept).
The application developer would determine the potential users of the application and which methods would be accessible to which users.
The application developer would then decorate classes or methods of the enterprise bean with annotations that specify the types of users authorized to access those methods.
Using annotations to specify authorized users is described in <a href="#specifying-authorized-users-by-declaring-security-roles">Specifying Authorized Users by Declaring Security Roles</a>.</p>
</div>
<div class="paragraph">
<p>When one of the annotations is used to define method permissions, the deployment system will automatically require user name/password authentication.
In this type of authentication, a user is prompted to enter a user name and password, which will be compared against a database of known users.
If the user is found and the password matches, the roles that the user is assigned will be compared against the roles that are authorized to access the method.
If the user is authenticated and found to have a role that is authorized to access that method, the data will be returned to the user.</p>
</div>
<div class="paragraph">
<p>Using declarative security is discussed in <a href="#securing-an-enterprise-bean-using-declarative-security">Securing an Enterprise Bean Using Declarative Security</a>.</p>
</div>
</li>
<li>
<p>Programmatic security: For an enterprise bean, code embedded in a business method that is used to access a caller&#8217;s identity programmatically and that uses this information to make security decisions.
Programmatic security is useful when declarative security alone is not sufficient to express the security model of an application.</p>
<div class="paragraph">
<p>In general, security management should be enforced by the container in a manner that is transparent to the enterprise beans' business methods.
The programmatic security APIs described in this chapter should be used only in the less frequent situations in which the enterprise bean business methods need to access the security-context information, such as when you want to grant access based on the time of day or other nontrivial condition checks for a particular role.</p>
</div>
<div class="paragraph">
<p>Programmatic security is discussed in <a href="#securing-an-enterprise-bean-programmatically">Securing an Enterprise Bean Programmatically</a>.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Some of the material in this chapter assumes that you have already read <a href="#enterprise-beans-2">Chapter 35, <em>Enterprise Beans</em></a>, <a href="#getting-started-with-enterprise-beans">Chapter 36, <em>Getting Started with Enterprise Beans</em></a>, and <a href="#introduction-to-security-in-the-jakarta-ee-platform">Chapter 50, <em>Introduction to Security in the Jakarta EE Platform</em></a>.</p>
</div>
<div class="paragraph">
<p>This section discusses securing a Jakarta EE application where one or more modules, such as enterprise bean JAR files, are packaged into an EAR file, the archive file that holds the application.
Security annotations will be used in the Java programming class files to specify authorized users and basic, or user name/password, authentication.</p>
</div>
<div class="paragraph">
<p>Enterprise beans often provide the business logic of a web application.
In these cases, packaging the enterprise bean within the web application&#8217;s WAR module simplifies deployment and application organization.
Enterprise beans may be packaged within a WAR module as Java class files or within a JAR file that is bundled within the WAR module.
When a servlet or Jakarta Faces page handles the web front end and the application is packaged into a WAR module as a Java class file, security for the application can be handled in the application&#8217;s <code>web.xml</code> file.
The enterprise bean in the WAR file can have its own deployment descriptor, <code>ejb-jar.xml</code>, if required.
Securing web applications using <code>web.xml</code> is discussed in <a href="#getting-started-securing-web-applications">Getting Started Securing Web Applications</a>.</p>
</div>
<div class="paragraph">
<p>The following sections describe declarative and programmatic security mechanisms that can be used to protect enterprise bean resources.
The protected resources include enterprise bean methods that are called from application clients, web components, or other enterprise beans.</p>
</div>
<div class="paragraph">
<p>For more information on this topic, read the Jakarta Enterprise Beans 4.0 specification.
This document can be downloaded from <a href="https://jakarta.ee/specifications/enterprise-beans/4.0/" class="bare" target="_blank" rel="noopener">https://jakarta.ee/specifications/enterprise-beans/4.0/</a>.
Chapter 11 of this specification, "Security Management", discusses security management for enterprise beans.</p>
</div>
<div class="sect3">
<h4 id="securing-an-enterprise-bean-using-declarative-security"><a class="anchor" href="#securing-an-enterprise-bean-using-declarative-security"></a>Securing an Enterprise Bean Using Declarative Security</h4>
<div class="paragraph">
<p>Declarative security enables the application developer to specify which users are authorized to access which methods of the enterprise beans and to authenticate these users with basic, or user name/password, authentication.
Frequently, the person who is developing an enterprise application is not the same person who is responsible for deploying the application.
An application developer who uses declarative security to define method permissions and authentication mechanisms is passing along to the deployer a security view of the enterprise beans contained in the enterprise bean JAR.
When a security view is passed on to the deployer, he or she uses this information to define method permissions for security roles.
If you don&#8217;t define a security view, the deployer will have to determine what each business method does to determine which users are authorized to call each method.</p>
</div>
<div class="paragraph">
<p>A security view consists of a set of security roles, a semantic grouping of permissions that a given type of users of an application must have to successfully access the application.
Security roles are meant to be logical roles, representing a type of user.
You can define method permissions for each security role.
A method permission is a permission to invoke a specified group of methods of an enterprise bean&#8217;s business interface, home interface, component interface, and/or web service endpoints.
After method permissions are defined, user name/password authentication will be used to verify the identity of the user.</p>
</div>
<div class="paragraph">
<p>It is important to keep in mind that security roles are used to define the logical security view of an application.
They should not be confused with the user groups, users, principals, and other concepts that exist in GlassFish Server.
Note that the Jakarta Security requires that group principal names be mapped to roles of the same name by default, but that implementations of the standard may allow configuration of a different default.
In GlassFish Server, you do not need to perform any additional steps to map the roles defined in the application to users, groups, and principals that are the components of the user database in the <code>file</code> realm.
This mapping is set by default in the GlassFish Server Administration Console as described in <a href="#mapping-roles-to-users-and-groups-2">Mapping Roles to Users and Groups</a>.</p>
</div>
<div class="paragraph">
<p>The following sections show how an application developer uses declarative security to either secure an application or to create a security view to pass along to the deployer.</p>
</div>
<div class="sect4">
<h5 id="specifying-authorized-users-by-declaring-security-roles"><a class="anchor" href="#specifying-authorized-users-by-declaring-security-roles"></a>Specifying Authorized Users by Declaring Security Roles</h5>
<div class="paragraph">
<p>This section discusses how to use annotations to specify the method permissions for the methods of a bean class.
For more information on these annotations, refer to Jakarta Annotations specification at <a href="https://jakarta.ee/specifications/annotations/2.0/" class="bare" target="_blank" rel="noopener">https://jakarta.ee/specifications/annotations/2.0/</a>.</p>
</div>
<div class="paragraph">
<p>Method permissions can be specified on the class, the business methods of the class, or both.
Method permissions can be specified on a method of the bean class to override the method permissions value specified on the entire bean class.
The following annotations are used to specify method permissions.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>@DeclareRoles</code>: Specifies all the roles that the application will use, including roles not specifically named in a <code>@RolesAllowed</code> annotation.
The set of security roles the application uses is the total of the security roles defined in the <code>@DeclareRoles</code> and <code>@RolesAllowed</code> annotations.</p>
<div class="paragraph">
<p>The <code>@DeclareRoles</code> annotation is specified on a bean class, where it serves to declare roles that can be tested (for example, by calling <code>isCallerInRole</code>) from within the methods of the annotated class.
When declaring the name of a role used as a parameter to the <code>isCallerInRole(String roleName)</code> method, the declared name must be the same as the parameter value.</p>
</div>
<div class="paragraph">
<p>The following example code demonstrates the use of the <code>@DeclareRoles</code> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DeclareRoles</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">BusinessAdmin</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">Calculator</span> {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The syntax for declaring more than one role is as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DeclareRoles</span>({<span class="string"><span class="delimiter">&quot;</span><span class="content">Administrator</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Manager</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Employee</span><span class="delimiter">&quot;</span></span>})</code></pre>
</div>
</div>
</li>
<li>
<p><code>@RolesAllowed("<em>list-of-roles</em>")</code>: Specifies the security roles permitted to access methods in an application.
This annotation can be specified on a class or on one or more methods.
When specified at the class level, the annotation applies to all methods in the class.
When specified on a method, the annotation applies to that method only and overrides any values specified at the class level.</p>
<div class="paragraph">
<p>To specify that no roles are authorized to access methods in an application, use the <code>@DenyAll</code> annotation.
To specify that a user in any role is authorized to access the application, use the <code>@PermitAll</code> annotation.</p>
</div>
<div class="paragraph">
<p>When used in conjunction with the <code>@DeclareRoles</code> annotation, the combined set of security roles is used by the application.</p>
</div>
<div class="paragraph">
<p>The following example code demonstrates the use of the <code>@RolesAllowed</code> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DeclareRoles</span>({<span class="string"><span class="delimiter">&quot;</span><span class="content">Administrator</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Manager</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Employee</span><span class="delimiter">&quot;</span></span>})
<span class="directive">public</span> <span class="type">class</span> <span class="class">Calculator</span> {

    <span class="annotation">@RolesAllowed</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">Administrator</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> setNewRate(<span class="type">int</span> rate) {
        ...
    }
}</code></pre>
</div>
</div>
</li>
<li>
<p><code>@PermitAll</code>: Specifies that all security roles are permitted to execute the specified method or methods.
The user is not checked against a database to ensure that he or she is authorized to access this application.</p>
<div class="paragraph">
<p>This annotation can be specified on a class or on one or more methods.
Specifying this annotation on the class means that it applies to all methods of the class.
Specifying it at the method level means that it applies to only that method.</p>
</div>
<div class="paragraph">
<p>The following example code demonstrates the use of the <code>@PermitAll</code> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">jakarta.annotation.security</span>.*;
<span class="annotation">@RolesAllowed</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">RestrictedUsers</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">Calculator</span> {

    <span class="annotation">@RolesAllowed</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">Administrator</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> setNewRate(<span class="type">int</span> rate) {
        <span class="comment">//...</span>
    }
    <span class="annotation">@PermitAll</span>
    <span class="directive">public</span> <span class="type">long</span> convertCurrency(<span class="type">long</span> amount) {
        <span class="comment">//...</span>
    }
}</code></pre>
</div>
</div>
</li>
<li>
<p><code>@DenyAll</code>: Specifies that no security roles are permitted to execute the specified method or methods.
This means that these methods are excluded from execution in the Jakarta EE container.</p>
<div class="paragraph">
<p>The following example code demonstrates the use of the <code>@DenyAll</code> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">jakarta.annotation.security</span>.*;
<span class="annotation">@RolesAllowed</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">Users</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">Calculator</span> {
    <span class="annotation">@RolesAllowed</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">Administrator</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> setNewRate(<span class="type">int</span> rate) {
        <span class="comment">//...</span>
    }
    <span class="annotation">@DenyAll</span>
    <span class="directive">public</span> <span class="type">long</span> convertCurrency(<span class="type">long</span> amount) {
        <span class="comment">//...</span>
    }
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following code snippet demonstrates the use of the <code>@DeclareRoles</code> annotation with the <code>isCallerInRole</code> method.
In this example, the <code>@DeclareRoles</code> annotation declares a role that the enterprise bean <code>PayrollBean</code> uses to make the security check by using <code>isCallerInRole("payroll")</code> to verify that the caller is authorized to change salary data:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DeclareRoles</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">payroll</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@Stateless</span> <span class="directive">public</span> <span class="type">class</span> <span class="class">PayrollBean</span> <span class="directive">implements</span> Payroll {
    <span class="annotation">@Resource</span> SessionContext ctx;

    <span class="directive">public</span> <span class="type">void</span> updateEmployeeInfo(EmplInfo info) {

        oldInfo = ... read from database;

        <span class="comment">// The salary field can be changed only by callers</span>
        <span class="comment">// who have the security role &quot;payroll&quot;</span>
        <span class="predefined-type">Principal</span> callerPrincipal = ctx.getCallerPrincipal();
        <span class="keyword">if</span> (info.salary != oldInfo.salary &amp;&amp; !ctx.isCallerInRole(<span class="string"><span class="delimiter">&quot;</span><span class="content">payroll</span><span class="delimiter">&quot;</span></span>)) {
            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">SecurityException</span>(...);
        }
        ...
    }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example code illustrates the use of the <code>@RolesAllowed</code> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RolesAllowed</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">admin</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">SomeClass</span> {
    <span class="directive">public</span> <span class="type">void</span> aMethod () {...}
    <span class="directive">public</span> <span class="type">void</span> bMethod () {...}
    ...
}

<span class="annotation">@Stateless</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyBean</span> <span class="directive">extends</span> SomeClass <span class="directive">implements</span> A  {

    <span class="annotation">@RolesAllowed</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">HR</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> aMethod () {...}

    <span class="directive">public</span> <span class="type">void</span> cMethod () {...}
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, assuming that <code>aMethod</code>, <code>bMethod</code>, and <code>cMethod</code> are methods of business interface <code>A</code>, the method permissions values of methods <code>aMethod</code> and <code>bMethod</code> are <code>@RolesAllowed("HR")</code> and <code>@RolesAllowed("admin")</code>, respectively.
The method permissions for method <code>cMethod</code> have not been specified.</p>
</div>
<div class="paragraph">
<p>To clarify, the annotations are not inherited by the subclass itself.
Instead, the annotations apply to methods of the superclass that are inherited by the subclass.</p>
</div>
</div>
<div class="sect4">
<h5 id="specifying-an-authentication-mechanism-and-secure-connection"><a class="anchor" href="#specifying-an-authentication-mechanism-and-secure-connection"></a>Specifying an Authentication Mechanism and Secure Connection</h5>
<div class="paragraph">
<p>When method permissions are specified, basic user name/password authentication will be invoked by GlassFish Server.</p>
</div>
<div class="paragraph">
<p>To use a different type of authentication or to require a secure connection using SSL, specify this information in an application deployment descriptor.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="securing-an-enterprise-bean-programmatically"><a class="anchor" href="#securing-an-enterprise-bean-programmatically"></a>Securing an Enterprise Bean Programmatically</h4>
<div class="paragraph">
<p>Programmatic security, code that is embedded in a business method, is used to access a caller&#8217;s identity programmatically and uses this information to make security decisions within the method itself.</p>
</div>
<div class="paragraph">
<p>In general, security management should be enforced by the container in a manner that is transparent to the enterprise bean&#8217;s business methods.
This section describes the <code>SecurityContext</code> API and security-related methods of the <code>EJBContext</code> API.
The newer <code>SecurityContext</code> API duplicates some functions of the <code>EJBContext</code> API because it is intended to provide a consistent API across containers.
These security APIs should be used only in the less frequent situations in which the enterprise bean business methods need to access the security context information.</p>
</div>
<div class="paragraph">
<p>The <code>SecurityContext</code> interface, as specified in the Jakarta Security specification, defines three methods that allow the bean provider to access security information about the enterprise bean&#8217;s caller:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>getCallerPrincipal()</code> retrieves the <code>Principal</code> that represents the name of the authenticated caller.
This is the container-specific representation of the caller principal, and the type may differ from the type of the caller principal originally established by an <code>HttpAuthenticationMechanism</code>.
This method returns null for an unauthenticated caller.
Note that this behavior differs from the behavior of the <code>EJBContext.getCallerPrincipal()</code> method, which returns a (vendor-specific) special principal to represent an anonymous caller.</p>
</li>
<li>
<p><code>getPrincipalsByType()</code> retrieves all principals of the given type from the authenticated caller&#8217;s Subject.
This method returns an empty <code>Set</code> if the caller is unauthenticated, or if the requested type is not found.</p>
<div class="paragraph">
<p>Where both a container caller principal and an application caller principal are present, the value returned by <code>getName()</code> is the same for both principals.</p>
</div>
</li>
<li>
<p><code>isCallerInRole()</code> takes a String argument that represents the role to be tested.
The specification does not define how the role determination is made, but the result must be the same as if the corresponding container-specific call had been made (for example <code>EJBContext.isCallerInRole()</code>), and must be consistent with the result implied by specifications that prescribe role-mapping behavior.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>jakarta.ejb.EJBContext</code> interface provides two methods that allow the bean provider to access security information about the enterprise bean&#8217;s caller.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>getCallerPrincipal</code> allows the enterprise bean methods to obtain the current caller principal&#8217;s name.
The methods might, for example, use the name as a key to information in a database.
This method never returns null.
Instead, it returns a (vendor-specific) principal with a special username to indicate an anonymous/unauthenticated caller.
Note that this behavior differs from the behavior of the <code>SecurityContext.getCallerPrincipal()</code> method, which returns null for an unauthenticated caller.</p>
<div class="paragraph">
<p>The following code sample illustrates the use of the <code>getCallerPrincipal</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Stateless</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">EmployeeServiceBean</span> <span class="directive">implements</span> EmployeeService {
    <span class="annotation">@Resource</span>
    SessionContext ctx;

    <span class="annotation">@PersistenceContext</span>
    EntityManager em;

    <span class="directive">public</span> <span class="type">void</span> changePhoneNumber(...) {
        ...
        <span class="comment">// obtain the caller principal</span>
        callerPrincipal = ctx.getCallerPrincipal();

        <span class="comment">// obtain the caller principal's name</span>
        callerKey = callerPrincipal.getName();

        <span class="comment">// use callerKey as primary key to find EmployeeRecord</span>
        EmployeeRecord myEmployeeRecord =
            em.find(EmployeeRecord.class, callerKey);

        <span class="comment">// update phone number</span>
        myEmployeeRecord.setPhoneNumber(...);

        ...
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the enterprise bean obtains the principal name of the current caller and uses it as the primary key to locate an <code>EmployeeRecord</code> entity.
This example assumes that application has been deployed such that the current caller principal contains the primary key used for the identification of employees (for example, employee number).</p>
</div>
</li>
<li>
<p><code>isCallerInRole</code> allows the developer to code the security checks that cannot be easily defined using method permissions.
Such a check might impose a role-based limit on a request, or it might depend on information stored in the database.</p>
<div class="paragraph">
<p>The enterprise bean code can use the <code>isCallerInRole</code> method to test whether the current caller has been assigned to a given security role.
Security roles are defined by the bean provider or the application assembler and are assigned by the deployer to principals or principal groups that exist in the operational environment.</p>
</div>
<div class="paragraph">
<p>The following code sample illustrates the use of the <code>isCallerInRole</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Stateless</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">PayrollBean</span> <span class="directive">implements</span> Payroll {
    <span class="annotation">@Resource</span>
    SessionContext ctx;

    <span class="directive">public</span> <span class="type">void</span> updateEmployeeInfo(EmplInfo info) {

        oldInfo = ... read from database;

        <span class="comment">// The salary field can be changed only by callers</span>
        <span class="comment">// who have the security role &quot;payroll&quot;</span>
        <span class="keyword">if</span> (info.salary != oldInfo.salary &amp;&amp;
            !ctx.isCallerInRole(<span class="string"><span class="delimiter">&quot;</span><span class="content">payroll</span><span class="delimiter">&quot;</span></span>)) {
                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">SecurityException</span>(...);
        }
        ...
    }
    ...
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>You would use programmatic security in this way to dynamically control access to a method, for example, when you want to deny access except during a particular time of day.
An example application that uses the <code>getCallerPrincipal</code> and <code>isCallerInRole</code> methods is described in <a href="#the-converter-secure-example-securing-an-enterprise-bean-with-programmatic-security">The converter-secure Example: Securing an Enterprise Bean with Programmatic Security</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="propagating-a-security-identity-run-as"><a class="anchor" href="#propagating-a-security-identity-run-as"></a>Propagating a Security Identity (Run-As)</h4>
<div class="paragraph">
<p>You can specify whether a caller&#8217;s security identity should be used for the execution of specified methods of an enterprise bean or whether a specific run-as identity should be used.
<a href="#security-identity-propagation">Figure 52-1</a> illustrates this concept.</p>
</div>
<div id="security-identity-propagation" class="imageblock">
<div class="content">
<img src="images/jakartaeett_dt_047.svg" alt="Diagram of security identity propagation from client to intermediate container to target container">
</div>
<div class="title">Figure 52-1 Security Identity Propagation</div>
</div>
<div class="paragraph">
<p>In this illustration, an application client is making a call to an enterprise bean method in one enterprise bean container.
This enterprise bean method, in turn, makes a call to an enterprise bean method in another container.
The security identity during the first call is the identity of the caller.
The security identity during the second call can be any of the following options.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>By default, the identity of the caller of the intermediate component is propagated to the target enterprise bean.
This technique is used when the target container trusts the intermediate container.</p>
</li>
<li>
<p>A specific identity is propagated to the target enterprise bean.
This technique is used when the target container expects access using a specific identity.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To propagate an identity to the target enterprise bean, configure a run-as identity for the bean, as described in <a href="#configuring-a-components-propagated-security-identity">Configuring a Component&#8217;s Propagated Security Identity</a>.
Establishing a run-as identity for an enterprise bean does not affect the identities of its callers, which are the identities tested for permission to access the methods of the enterprise bean.
The run-as identity establishes the identity that the enterprise bean will use when it makes calls.</p>
</div>
<div class="paragraph">
<p>The run-as identity applies to the enterprise bean as a whole, including all the methods of the enterprise bean&#8217;s business interface, local and remote interfaces, component interface, and web service endpoint interfaces, the message listener methods of a message-driven bean, the timeout method of an enterprise bean, and all internal methods of the bean that might be called in turn.</p>
</div>
<div class="sect4">
<h5 id="configuring-a-components-propagated-security-identity"><a class="anchor" href="#configuring-a-components-propagated-security-identity"></a>Configuring a Component&#8217;s Propagated Security Identity</h5>
<div class="paragraph">
<p>You can configure an enterprise bean&#8217;s run-as, or propagated, security identity by using the <code>@RunAs</code> annotation, which defines the role of the application during execution in a Jakarta EE container.
The annotation can be specified on a class, allowing developers to execute an application under a particular role.
The role must map to the user/group information in the container&#8217;s security realm.
The <code>@RunAs</code> annotation specifies the name of a security role as its parameter.</p>
</div>
<div class="paragraph">
<p>The following code demonstrates the use of the <code>@RunAs</code> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RunAs</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">Admin</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">Calculator</span> {
    <span class="comment">//....</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You will have to map the run-as role name to a given principal defined in GlassFish Server if the given roles are associated with more than one user principal.</p>
</div>
</div>
<div class="sect4">
<h5 id="trust-between-containers"><a class="anchor" href="#trust-between-containers"></a>Trust between Containers</h5>
<div class="paragraph">
<p>When an enterprise bean is designed so that either the original caller identity or a designated identity is used to call a target bean, the target bean will receive the propagated identity only.
The target bean will not receive any authentication data.</p>
</div>
<div class="paragraph">
<p>There is no way for the target container to authenticate the propagated security identity.
However, because the security identity is used in authorization checks (for example, method permissions or with the <code>isCallerInRole</code> method), it is vitally important that the security identity be authentic.
Because no authentication data is available to authenticate the propagated identity, the target must trust that the calling container has propagated an authenticated security identity.</p>
</div>
<div class="paragraph">
<p>By default, GlassFish Server is configured to trust identities that are propagated from different containers.
Therefore, you do not need to take any special steps to set up a trust relationship.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="deploying-secure-enterprise-beans"><a class="anchor" href="#deploying-secure-enterprise-beans"></a>Deploying Secure Enterprise Beans</h4>
<div class="paragraph">
<p>The deployer is responsible for ensuring that an assembled application is secure after it has been deployed in the target operational environment.
If a security view has been provided to the deployer through the use of security annotations and/or a deployment descriptor, the security view is mapped to the mechanisms and policies used by the security domain in the target operational environment, which in this case is GlassFish Server.
If no security view is provided, the deployer must set up the appropriate security policy for the enterprise bean application.</p>
</div>
<div class="paragraph">
<p>Deployment information is specific to a web or application server.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="examples-securing-enterprise-beans"><a class="anchor" href="#examples-securing-enterprise-beans"></a>Examples: Securing Enterprise Beans</h3>
<div class="paragraph">
<p>The following examples show how to secure enterprise beans using declarative and programmatic security.</p>
</div>
<div class="sect3">
<h4 id="the-cart-secure-example-securing-an-enterprise-bean-with-declarative-security"><a class="anchor" href="#the-cart-secure-example-securing-an-enterprise-bean-with-declarative-security"></a>The cart-secure Example: Securing an Enterprise Bean with Declarative Security</h4>
<div class="paragraph">
<p>This section discusses how to configure an enterprise bean for basic user name/password authentication.
When a bean that is constrained in this way is requested, the server requests a user name and password from the client and verifies that the user name and password are valid by comparing them against a database of authorized users in GlassFish Server.</p>
</div>
<div class="paragraph">
<p>If the topic of authentication is new to you, see <a href="#specifying-authentication-mechanisms">Specifying Authentication Mechanisms</a>.</p>
</div>
<div class="paragraph">
<p>This example demonstrates security by starting with the unsecured enterprise bean application, <code>cart</code>, which is found in the <code><em>tut-install</em>/examples/ejb/cart/</code> directory and is discussed in <a href="#the-cart-example">The cart Example</a>.</p>
</div>
<div class="paragraph">
<p>In general, the following steps are necessary to add user name/password authentication to an existing application that contains an enterprise bean.
In the example application included with this tutorial, these steps have been completed for you and are listed here simply to show what needs to be done should you wish to create a similar application.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create an application like the one in <a href="#the-cart-example">The cart Example</a>.
The example in this tutorial starts with this example and demonstrates adding basic authentication of the client to this application.
The example application discussed in this section can be found at <code><em>tut-install</em>/examples/security/cart-secure/</code>.</p>
</li>
<li>
<p>If you have not already done so, complete the steps in <a href="#to-set-up-your-system-for-running-the-security-examples">To Set Up Your System for Running the Security Examples</a> to configure your system for running the tutorial applications.</p>
</li>
<li>
<p>Modify the source code for the enterprise bean, <code>CartBean.java</code>, to specify which roles are authorized to access which protected methods.
This step is discussed in <a href="#annotating-the-bean">Annotating the Bean</a>.</p>
</li>
<li>
<p>Build, package, and deploy the enterprise bean; then build and run the client application by following the steps in <a href="#to-run-the-cart-secure-example-using-netbeans-ide">To Run the cart-secure Example Using NetBeans IDE</a> or <a href="#to-run-the-cart-secure-example-using-maven">To Run the cart-secure Example Using Maven</a>.</p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="annotating-the-bean"><a class="anchor" href="#annotating-the-bean"></a>Annotating the Bean</h5>
<div class="paragraph">
<p>The source code for the original <code>cart</code> application was modified as shown in the following code snippet (modifications in bold).
The resulting file can be found in the file <code><em>tut-install</em>/examples/security/cart-secure/cart-secure-ejb/src/main/java/ee/jakarta/tutorial/cart/ejb/CartBean.java</code>.</p>
</div>
<div class="paragraph">
<p>The code snippet is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">ee.jakarta.tutorial.cartsecure.ejb</span>;

<span class="keyword">import</span> <span class="include">java.io.Serializable</span>;
<span class="keyword">import</span> <span class="include">java.util.ArrayList</span>;
<span class="keyword">import</span> <span class="include">java.util.List</span>;
<span class="keyword">import</span> <span class="include">ee.jakarta.tutorial.cart.util.BookException</span>;
<span class="keyword">import</span> <span class="include">ee.jakarta.tutorial.cart.util.IdVerifier</span>;
<span class="keyword">import</span> <span class="include">jakarta.ejb.Remove</span>;
<span class="keyword">import</span> <span class="include">jakarta.ejb.Stateful</span>;
<span class="keyword">import</span> <span class="include">jakarta.annotation.security.DeclareRoles</span>;
<span class="keyword">import</span> <span class="include">jakarta.annotation.security.RolesAllowed</span>;

<span class="annotation">@Stateful</span>
<span class="annotation">@DeclareRoles</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">TutorialUser</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">CartBean</span> <span class="directive">implements</span> Cart, <span class="predefined-type">Serializable</span> {
    <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; contents;
    <span class="predefined-type">String</span> customerId;
    <span class="predefined-type">String</span> customerName;

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> initialize(<span class="predefined-type">String</span> person) <span class="directive">throws</span> BookException {
        <span class="keyword">if</span> (person == <span class="predefined-constant">null</span>) {
            <span class="keyword">throw</span> <span class="keyword">new</span> BookException(<span class="string"><span class="delimiter">&quot;</span><span class="content">Null person not allowed.</span><span class="delimiter">&quot;</span></span>);
        } <span class="keyword">else</span> {
            customerName = person;
        }

        customerId = <span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span>;
        contents = <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;&gt;();
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> initialize(<span class="predefined-type">String</span> person, <span class="predefined-type">String</span> id) <span class="directive">throws</span> BookException {
        <span class="keyword">if</span> (person == <span class="predefined-constant">null</span>) {
            <span class="keyword">throw</span> <span class="keyword">new</span> BookException(<span class="string"><span class="delimiter">&quot;</span><span class="content">Null person not allowed.</span><span class="delimiter">&quot;</span></span>);
        } <span class="keyword">else</span> {
            customerName = person;
        }

        IdVerifier idChecker = <span class="keyword">new</span> IdVerifier();

        <span class="keyword">if</span> (idChecker.validate(id)) {
            customerId = id;
        } <span class="keyword">else</span> {
            <span class="keyword">throw</span> <span class="keyword">new</span> BookException(<span class="string"><span class="delimiter">&quot;</span><span class="content">Invalid id: </span><span class="delimiter">&quot;</span></span> + id);
        }

        contents = <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;&gt;();
    }

    <span class="annotation">@Override</span>
    <span class="annotation">@RolesAllowed</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">TutorialUser</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> addBook(<span class="predefined-type">String</span> title) {
        contents.add(title);
    }

    <span class="annotation">@Override</span>
    <span class="annotation">@RolesAllowed</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">TutorialUser</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> removeBook(<span class="predefined-type">String</span> title) <span class="directive">throws</span> BookException {
        <span class="type">boolean</span> result = contents.remove(title);

        <span class="keyword">if</span> (result == <span class="predefined-constant">false</span>) {
            <span class="keyword">throw</span> <span class="keyword">new</span> BookException(<span class="string"><span class="delimiter">&quot;</span><span class="char">\&quot;</span><span class="delimiter">&quot;</span></span> + title + <span class="string"><span class="delimiter">&quot;</span><span class="char">\&quot;</span><span class="content"> not in cart.</span><span class="delimiter">&quot;</span></span>);
        }
    }

    <span class="annotation">@Override</span>
    <span class="annotation">@RolesAllowed</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">TutorialUser</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; getContents() {
        <span class="keyword">return</span> contents;
    }

    <span class="annotation">@Override</span>
    <span class="annotation">@Remove</span>()
    <span class="annotation">@RolesAllowed</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">TutorialUser</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> remove() {
        contents = <span class="predefined-constant">null</span>;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>@RolesAllowed</code> annotation is specified on methods for which you want to restrict access.
In this example, only users in the role of <code>TutorialUser</code> will be allowed to add and remove books from the cart and to list the contents of the cart.
A <code>@RolesAllowed</code> annotation implicitly declares a role that will be referenced in the application; therefore, no <code>@DeclareRoles</code> annotation is required.
The presence of the <code>@RolesAllowed</code> annotation also implicitly declares that authentication will be required for a user to access these methods.
If no authentication method is specified in the deployment descriptor, the type of authentication will be user name/password authentication.</p>
</div>
</div>
<div class="sect4">
<h5 id="to-run-the-cart-secure-example-using-netbeans-ide"><a class="anchor" href="#to-run-the-cart-secure-example-using-netbeans-ide"></a>To Run the cart-secure Example Using NetBeans IDE</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Follow the steps in <a href="#to-set-up-your-system-for-running-the-security-examples">To Set Up Your System for Running the Security Examples</a>.</p>
</li>
<li>
<p>From the File menu, choose Open Project.</p>
</li>
<li>
<p>In the Open Project dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/security</pre>
</div>
</div>
</li>
<li>
<p>Select the <code>cart-secure</code> folder.</p>
</li>
<li>
<p>Select the Open Required Projects check box.</p>
</li>
<li>
<p>Click Open Project.</p>
</li>
<li>
<p>In the Projects tab, right-click the <code>cart-secure</code> project and select Build.</p>
<div class="paragraph">
<p>This step builds and packages the application into <code>cart-secure.ear</code>, located in the <code>cart-secure-ear/target/</code> directory, and deploys this EAR file to your GlassFish Server instance, retrieves the client stubs, and runs the client.</p>
</div>
</li>
<li>
<p>In the Login for user: dialog box, enter the user name and password of a <code>file</code> realm user created in GlassFish Server and assigned to the group <code>TutorialUser</code>; then click OK.</p>
<div class="paragraph">
<p>If the user name and password you enter are authenticated, the output of the application client appears in the Output tab:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>...
Retrieving book title from cart: Infinite Jest
Retrieving book title from cart: Bel Canto
Retrieving book title from cart: Kafka on the Shore
Removing "Gravity's Rainbow" from cart.
Caught a BookException: "Gravity's Rainbow" not in cart.
Java Result: 1
...</pre>
</div>
</div>
<div class="paragraph">
<p>If the user name and password are not authenticated, the dialog box reappears until you enter correct values.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-run-the-cart-secure-example-using-maven"><a class="anchor" href="#to-run-the-cart-secure-example-using-maven"></a>To Run the cart-secure Example Using Maven</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Follow the steps in <a href="#to-set-up-your-system-for-running-the-security-examples">To Set Up Your System for Running the Security Examples</a>.</p>
</li>
<li>
<p>In a terminal window, go to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/security/cart-secure/</pre>
</div>
</div>
</li>
<li>
<p>To build the application, package it into an EAR file in the <code>cart-secure-ear/target</code> subdirectory, deploy it, and run it, enter the following command at the terminal window or command prompt:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">mvn install</code></pre>
</div>
</div>
</li>
<li>
<p>In the Login for user: dialog box, enter the user name and password of a <code>file</code> realm user created in GlassFish Server and assigned to the group <code>TutorialUser</code>; then click OK.</p>
<div class="paragraph">
<p>If the user name and password you enter are authenticated, the output of the application client appears in the Output tab:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>...
Retrieving book title from cart: Infinite Jest
Retrieving book title from cart: Bel Canto
Retrieving book title from cart: Kafka on the Shore
Removing "Gravity's Rainbow" from cart.
Caught a BookException: "Gravity's Rainbow" not in cart.
Java Result: 1
...</pre>
</div>
</div>
<div class="paragraph">
<p>If the user name and password are not authenticated, the dialog box reappears until you enter correct values.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="the-converter-secure-example-securing-an-enterprise-bean-with-programmatic-security"><a class="anchor" href="#the-converter-secure-example-securing-an-enterprise-bean-with-programmatic-security"></a>The converter-secure Example: Securing an Enterprise Bean with Programmatic Security</h4>
<div class="paragraph">
<p>This example demonstrates how to use the <code>getCallerPrincipal</code> and <code>isCallerInRole</code> methods with an enterprise bean.
This example starts with a very simple enterprise bean application, <code>converter</code>, and modifies the methods of the <code>ConverterBean</code> so that currency conversion will occur only when the requester is in the role of <code>TutorialUser</code>.</p>
</div>
<div class="paragraph">
<p>This example can be found in the <code><em>tut-install</em>/examples/security/converter-secure</code> directory.
This example is based on the unsecured enterprise bean application, <code>converter</code>, which is discussed in <a href="#getting-started-with-enterprise-beans">Chapter 36, <em>Getting Started with Enterprise Beans</em></a> and is found in the <code><em>tut-install</em>/examples/ejb/converter/</code> directory.
This section builds on the example by adding the necessary elements to secure the application by using the <code>getCallerPrincipal</code> and <code>isCallerInRole</code> methods, which are discussed in more detail in <a href="#securing-an-enterprise-bean-programmatically">Securing an Enterprise Bean Programmatically</a>.</p>
</div>
<div class="paragraph">
<p>In general, the following steps are necessary when using the <code>getCallerPrincipal</code> and <code>isCallerInRole</code> methods with an enterprise bean.
In the example application included with this tutorial, many of these steps have been completed for you and are listed here simply to show what needs to be done should you wish to create a similar application.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a simple enterprise bean application.</p>
</li>
<li>
<p>Set up a user on GlassFish Server in the <code>file</code> realm, in the group <code>TutorialUser</code>, and set up default principal to role mapping.
To do this, follow the steps in <a href="#to-set-up-your-system-for-running-the-security-examples">To Set Up Your System for Running the Security Examples</a>.</p>
</li>
<li>
<p>Modify the bean to add the <code>getCallerPrincipal</code> and <code>isCallerInRole</code> methods.</p>
</li>
<li>
<p>If the application contains a web client that is a servlet, specify security for the servlet, as described in <a href="#specifying-security-for-basic-authentication-using-annotations">Specifying Security for Basic Authentication Using Annotations</a>.</p>
</li>
<li>
<p>Build, package, deploy, and run the application.</p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="modifying-converterbean"><a class="anchor" href="#modifying-converterbean"></a>Modifying ConverterBean</h5>
<div class="paragraph">
<p>The source code for the original <code>ConverterBean</code> class was modified to add the <code>if..else</code> clause that tests whether the caller is in the role of <code>TutorialUser</code>.
If the user is in the correct role, the currency conversion is computed and displayed.
If the user is not in the correct role, the computation is not performed, and the application displays the result as <code>0</code>.
The code example can be found in <code><em>tut-install</em>/examples/security/converter-secure/converter-secure-ejb/src/main/java/ee/jakarta/tutorial/converter/ejb/ConverterBean.java</code>.</p>
</div>
<div class="paragraph">
<p>The code snippet (with modifications shown in <strong>bold</strong>) is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">ee.jakarta.tutorial.convertersecure.ejb</span>;

<span class="keyword">import</span> <span class="include">java.math.BigDecimal</span>;
<strong><span class="keyword">import</span> <span class="include">java.security.Principal</span>;</strong>

<strong><span class="keyword">import</span> <span class="include">jakarta.annotation.Resource</span>;
<span class="keyword">import</span> <span class="include">jakarta.annotation.security.DeclareRoles</span>;
<span class="keyword">import</span> <span class="include">jakarta.annotation.security.RolesAllowed</span>;
<span class="keyword">import</span> <span class="include">jakarta.ejb.SessionContext</span>;</strong>
<span class="keyword">import</span> <span class="include">jakarta.ejb.Stateless</span>;

<span class="annotation">@Stateless</span>()
<strong><span class="annotation">@DeclareRoles</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">TutorialUser</span><span class="delimiter">&quot;</span></span>)</strong>
<span class="directive">public</span> <span class="type">class</span> <span class="class">ConverterBean</span>{

    <strong><span class="annotation">@Resource</span> SessionContext ctx;</strong>
    <span class="directive">private</span> <span class="directive">final</span> <span class="predefined-type">BigDecimal</span> yenRate = <span class="keyword">new</span> <span class="predefined-type">BigDecimal</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">104.34</span><span class="delimiter">&quot;</span></span>);
    <span class="directive">private</span> <span class="directive">final</span> <span class="predefined-type">BigDecimal</span> euroRate = <span class="keyword">new</span> <span class="predefined-type">BigDecimal</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">0.007</span><span class="delimiter">&quot;</span></span>);

    <strong><span class="annotation">@RolesAllowed</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">TutorialUser</span><span class="delimiter">&quot;</span></span>)</strong>
     <span class="directive">public</span> <span class="predefined-type">BigDecimal</span> dollarToYen(<span class="predefined-type">BigDecimal</span> dollars) {
        <strong><span class="predefined-type">BigDecimal</span> result = <span class="keyword">new</span> <span class="predefined-type">BigDecimal</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">0.0</span><span class="delimiter">&quot;</span></span>);
        <span class="predefined-type">Principal</span> callerPrincipal = ctx.getCallerPrincipal();
        <span class="keyword">if</span> (ctx.isCallerInRole(<span class="string"><span class="delimiter">&quot;</span><span class="content">TutorialUser</span><span class="delimiter">&quot;</span></span>)) {</strong>
            result = dollars.multiply(yenRate);
            <span class="keyword">return</span> result.setScale(<span class="integer">2</span>, <span class="predefined-type">BigDecimal</span>.ROUND_UP);
        <strong>} <span class="keyword">else</span> {
            <span class="keyword">return</span> result.setScale(<span class="integer">2</span>, <span class="predefined-type">BigDecimal</span>.ROUND_UP);
        }</strong>
    }

    <strong><span class="annotation">@RolesAllowed</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">TutorialUser</span><span class="delimiter">&quot;</span></span>)</strong>
    <span class="directive">public</span> <span class="predefined-type">BigDecimal</span> yenToEuro(<span class="predefined-type">BigDecimal</span> yen) {
        <strong><span class="predefined-type">BigDecimal</span> result = <span class="keyword">new</span> <span class="predefined-type">BigDecimal</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">0.0</span><span class="delimiter">&quot;</span></span>);
        <span class="predefined-type">Principal</span> callerPrincipal = ctx.getCallerPrincipal();
        <span class="keyword">if</span> (ctx.isCallerInRole(<span class="string"><span class="delimiter">&quot;</span><span class="content">TutorialUser</span><span class="delimiter">&quot;</span></span>)) {</strong>
             result = yen.multiply(euroRate);
             <span class="keyword">return</span> result.setScale(<span class="integer">2</span>, <span class="predefined-type">BigDecimal</span>.ROUND_UP);
        <strong>} <span class="keyword">else</span> {
             <span class="keyword">return</span> result.setScale(<span class="integer">2</span>, <span class="predefined-type">BigDecimal</span>.ROUND_UP);
        }</strong>
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="modifying-converterservlet"><a class="anchor" href="#modifying-converterservlet"></a>Modifying ConverterServlet</h5>
<div class="paragraph">
<p>The following annotations specify security for the <code>converter</code> web client, <code>ConverterServlet</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@WebServlet</span>(urlPatterns = {<span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="delimiter">&quot;</span></span>})
<span class="annotation">@ServletSecurity</span>(
<span class="annotation">@HttpConstraint</span>(transportGuarantee = TransportGuarantee.CONFIDENTIAL,
    rolesAllowed = {<span class="string"><span class="delimiter">&quot;</span><span class="content">TutorialUser</span><span class="delimiter">&quot;</span></span>}))</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="to-run-the-converter-secure-example-using-netbeans-ide"><a class="anchor" href="#to-run-the-converter-secure-example-using-netbeans-ide"></a>To Run the converter-secure Example Using NetBeans IDE</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Follow the steps in <a href="#to-set-up-your-system-for-running-the-security-examples">To Set Up Your System for Running the Security Examples</a>.</p>
</li>
<li>
<p>From the File menu, choose Open Project.</p>
</li>
<li>
<p>In the Open Project dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/security</pre>
</div>
</div>
</li>
<li>
<p>Select the <code>converter-secure</code> folder.</p>
</li>
<li>
<p>Click Open Project.</p>
</li>
<li>
<p>Right-click the <code>converter-secure</code> project and select Build.</p>
<div class="paragraph">
<p>This command builds and deploys the example application to your GlassFish Server instance.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-run-the-converter-secure-example-using-maven"><a class="anchor" href="#to-run-the-converter-secure-example-using-maven"></a>To Run the converter-secure Example Using Maven</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Follow the steps in <a href="#to-set-up-your-system-for-running-the-security-examples">To Set Up Your System for Running the Security Examples</a>.</p>
</li>
<li>
<p>In a terminal window, go to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/security/converter-secure/</pre>
</div>
</div>
</li>
<li>
<p>Enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">mvn install</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command builds and packages the application into a WAR file, <code>converter-secure.war</code>, that is located in the <code>target</code> directory, and deploys the WAR file.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-run-the-converter-secure-example"><a class="anchor" href="#to-run-the-converter-secure-example"></a>To Run the converter-secure Example</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open a web browser to the following URL:</p>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080/converter-secure</pre>
</div>
</div>
<div class="paragraph">
<p>An Authentication Required dialog box appears.</p>
</div>
</li>
<li>
<p>Enter a user name and password combination that corresponds to a user who has already been created in the <code>file</code> realm of GlassFish Server and has been assigned to the group <code>TutorialUser</code>; then click OK.</p>
</li>
<li>
<p>Enter <code>100</code> in the input field and click Submit.</p>
<div class="paragraph">
<p>A second page appears, showing the converted values.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using-jakarta-security"><a class="anchor" href="#using-jakarta-security"></a>Chapter 53. Using Jakarta Security</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter describes the authentication and credential validation functionality provided by Jakarta Security.
The API also defines a <code>SecurityContext</code> access point for programmatic security.</p>
</div>
<div class="sect2">
<h3 id="about-jakarta-security"><a class="anchor" href="#about-jakarta-security"></a>About Jakarta Security</h3>
<div class="paragraph">
<p>Jakarta EE includes support for Jakarta Security, which defines portable, plug-in interfaces for authentication and identity stores, and a new injectable-type SecurityContext interface that provides an access point for programmatic security.
You can use the built-in implementations of these APIs, or define custom implementations.</p>
</div>
<div class="paragraph">
<p>Jakarta Security contains the following packages:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>jakarta.security.enterprise</code> package is the main Jakarta Security package and contains classes and interfaces that span authentication, authorization, and identity concerns.
<a href="#main-classes-and-interfaces-in-enterprise">Table 53-1</a> lists the main class and interfaces in this package.</p>
</li>
<li>
<p>The <code>jakarta.security.enterprise.authentication.mechanism.http</code> package contains classes and interfaces associated with HTTP-based authentication mechanisms that can interact with a caller or third-parties as part of an authentication protocol.
<a href="#main-classes-and-interfaces-in-authentication">Table 53-2</a> lists the main classes and interfaces in this package.</p>
</li>
<li>
<p>The <code>jakarta.security.enterprise.credential</code> package contains classes and interfaces for representing user credentials.
<a href="#main-classes-and-interfaces-in-credential">Table 53-3</a> lists the main classes and interfaces in this package.</p>
</li>
<li>
<p>The <code>jakarta.security.enterprise.identitystore</code> package contains classes and interfaces associated with identity stores that validate a caller&#8217;s credentials and lookup caller groups.
<a href="#main-classes-and-interfaces-in-identitystore">Table 53-4</a> lists the main classes and interfaces in this package.</p>
</li>
</ul>
</div>
<table id="main-classes-and-interfaces-in-enterprise" class="tableblock frame-all grid-all" style="width: 99%;">
<caption class="title">Table 53-1 Main Classes and Interfaces in <code>jakarta.security.enterprise</code></caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Class or Interface</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SecurityContext</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Injectable-type interface that provides an access point for programmatic security intended to be used by application code to query and interact with the Jakarta Security.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CallerPrincipal</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Principal type that can represent the identity of the application caller.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AuthenticationStatus</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enum used to indicate the return value from an authentication mechanism.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AuthenticationException</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates that a problem occurred during the authentication process.</p></td>
</tr>
</tbody>
</table>
<table id="main-classes-and-interfaces-in-authentication" class="tableblock frame-all grid-all" style="width: 99%;">
<caption class="title">Table 53-2 Main Classes and Interfaces in <code>jakarta.security.enterprise.authentication.mechanism.http</code></caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Class or Interface</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>HttpAuthenticationMechanism</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interface representing an HTTP authentication mechanism.
Developers can provide their own implementation of this interface, or use one of several built-in HTTP authentication mechanisms.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>HttpMessageContext</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interface representing the parameters passed to/from methods of an <code>HttpAuthenticationMechanism</code> at runtime.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AuthenticationParameters</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Class that carries parameters passed to the <code>SecurityContext.authenticate()</code> method.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>HttpMessageContextWrapper</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Abstract class developers can extend to customize <code>HttpMessageContext</code> behavior.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>jakarta.security.enterprise.authentication.mechanism.http</code> package also includes a number of annotation classes that are used to configure/enable the built-in authentication mechanisms or to modify the behavior of an authentication mechanism.
</td>
</tr>
</table>
</div>
<table id="main-classes-and-interfaces-in-credential" class="tableblock frame-all grid-all" style="width: 99%;">
<caption class="title">Table 53-3 Main Classes and Interfaces in <code>jakarta.security.enterprise.credential</code></caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Class or Interface</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Credential</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interface that represents a generic credential and defines several methods to operate on credentials.
All other classes in this package are implementations of the Credential interface.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AbstractClearableCredential</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Abstract class implementing behavior common to Credentials that can be meaningfully cleared.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BasicAuthenticationCredential</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Class that extends <code>UsernamePasswordCredential</code> to represent credentials used by HTTP Basic Authentication.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CallerOnlyCredential</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Credential that contains a caller name only; can be used to assert an identity, but not to authenticate a user, due to the lack of any secret or other credential that can be validated.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Password</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Class that represents a text-based password.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RememberMeCredential</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Class that represents a credential presented as a token, for the explicit usage with the Jakarta Security remember me function.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>UsernamePasswordCredential</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Class that represents the credentials typically used by standard caller name/password authentication.</p></td>
</tr>
</tbody>
</table>
<table id="main-classes-and-interfaces-in-identitystore" class="tableblock frame-all grid-all" style="width: 99%;">
<caption class="title">Table 53-4 Main Classes and Interfaces in <code>jakarta.security.enterprise.identitystore</code></caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Class or Interface</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IdentityStore</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interface representing an Identity Store.
Developers can provide their own implementation of this interface, or use one of the built-in Identity Stores.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IdentityStoreHandler</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interface that defines the method applications use to interact with Identity Stores.
Applications can use the built-in IdentityStoreHandler, or supply their own implementation if custom behavior is desired.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PasswordHash</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interface defining methods for generating and validating password hashes, needed to securely validate passwords when using the built-in Database Identity Store.
Developers can implement this interface to generate/validate password hashes using any desired algorithm.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Pbkdf2PasswordHash</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Marker interface implemented by the built-in PBKDF2 PasswordHash implementation.
Developers can use this interface to select the built-in PBKDF2 algorithm when configuring the Database Identity Store.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RememberMeIdentityStore</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interface defining a special type of Identity Store, used in conjunction with the RememberMe annotation to provide RememberMe behavior for an application.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CredentialValidationResult</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Class that represents the result from an attempt to validate a Credential.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IdentityStorePermission</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Permission required to invoke the <code>getGroups</code> method of an IdentityStore, when a SecurityManager is configured.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="overview-of-the-http-authentication-mechanism-interface"><a class="anchor" href="#overview-of-the-http-authentication-mechanism-interface"></a>Overview of the HTTP Authentication Mechanism Interface</h3>
<div class="paragraph">
<p>The <code>HttpAuthenticationMechanism</code> interface defines an SPI for writing authentication mechanisms that can be provided with an application and deployed using CDI.
Developers can write their own implementations of <code>HttpAuthenticationMechanism</code> to support specific authentication token types or protocols.
There are also several built-in authentication mechanisms that perform BASIC, FORM, and Custom FORM authentication.</p>
</div>
<div class="paragraph">
<p>The built-in authentication mechanisms are enabled and configured through the use of one of the following annotations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>BasicAuthenticationMechanismDefinition</code>&#8201;&#8212;&#8201;implements BASIC authentication that conforms to the behavior of the servlet container when BASIC &lt;auth-method&gt; is declared in web.xml.</p>
</li>
<li>
<p><code>FormAuthenticationMechanismDefinition</code>&#8201;&#8212;&#8201;implements FORM authentication that conforms to the behavior of the servlet container when the FORM &lt;auth-method&gt; is declared in web.xml.</p>
</li>
<li>
<p><code>CustomFormAuthenticationMechanismDefinition</code>&#8201;&#8212;&#8201;implements a modified version of FORM authentication in which custom handling replaces the POST to j_security_check.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An implementation of HttpAuthenticationMechanism must be a CDI bean to be recognized and deployed at runtime, and is assumed to be normal scoped.
During bean discovery, the servlet container looks for a bean that implements <code>HttpAuthenticationMechanism</code>&#8201;&#8212;&#8201;there should be only one per application&#8201;&#8212;&#8201;and, if found, arranges for it to be deployed to authenticate the application&#8217;s callers.</p>
</div>
<div class="paragraph">
<p>The servlet container leverages Jakarta Authentication to deploy authentication mechanisms.
The container provides a Jakarta Authentication Server Auth Module (SAM) that can delegate to an <code>HttpAuthenticationMechanism</code>, and arranges for that "bridge" SAM to be registered with the Jakarta Authentication <code>AuthConfigFactory</code>.
At runtime, normal Jakarta Authentication processing invokes the bridge SAM, which then delegates to the <code>HttpAuthenticationMechanism</code> to perform the authentication and drive any necessary dialog with the caller, or with third parties involved in the authentication protocol flow.</p>
</div>
<div class="paragraph">
<p>The HttpAuthenticationMechanism interface defines the following three methods, which correspond to the three methods defined by the Jakarta Authentication ServerAuth interface.
When one of the Jakarta Authentication methods is invoked on the bridge SAM, it delegates to the corresponding method of the <code>HttpAuthenticationMechanism</code>.
Although the method names are identical, the method signatures are not; the bridge SAM maps back and forth between the parameters passed to it by the Jakarta Authentication framework, and the parameters expected by an <code>HttpAuthenticationMechanism</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>validateRequest()</code>&#8201;&#8212;&#8201;validate an incoming request and authenticates the caller.</p>
</li>
<li>
<p><code>secureResponse()</code>&#8201;&#8212;&#8201;(optional if default is sufficient) secure a response message.</p>
</li>
<li>
<p><code>cleanSubject()</code>&#8201;&#8212;&#8201;(optional if default is sufficient) clear the provided Subject of principals and credentials.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Only the <code>validateRequest()</code> method must be implemented by an <code>HttpAuthenticationMechanism</code>; the interface includes default implementations for <code>secureResponse()</code> and <code>cleanSubject()</code> that will often be sufficient.</p>
</div>
<div class="paragraph">
<p>The following annotations can be used to add additional behaviors to an <code>HttpAuthenticationMechanism</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>AutoApplySession</code>&#8201;&#8212;&#8201;indicates that the Jakarta Authentication <code>registerSession</code> functionality should be enabled such that the the caller&#8217;s authenticated identity is persisted in the caller&#8217;s servlet session.</p>
</li>
<li>
<p><code>LoginToContinue</code>&#8201;&#8212;&#8201;mechanism to specify properties for FORM login&#8201;&#8212;&#8201;login page, error page, etc.
The built-in FORM authentication mechanisms use LoginToContinue to configure the necessary parameters.</p>
</li>
<li>
<p><code>RememberMe</code>&#8201;&#8212;&#8201;specifies that a <code>RememberMe</code> identity store should be used to enable <code>RememberMe</code> functionality for the authentication mechanism.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="overview-of-the-identity-store-interfaces"><a class="anchor" href="#overview-of-the-identity-store-interfaces"></a>Overview of the Identity Store Interfaces</h3>
<div class="paragraph">
<p>The Identity Store Interfaces are described in the following sections:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#the-identitystore-interface">The IdentityStore Interface</a></p>
</li>
<li>
<p><a href="#the-remembermeidentitystore-interface">The RememberMeIdentityStore Interface</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="the-identitystore-interface"><a class="anchor" href="#the-identitystore-interface"></a>The IdentityStore Interface</h4>
<div class="paragraph">
<p>The <code>IdentityStore</code> interface defines an SPI for interacting with identity stores, which are directories or databases containing user account information.
An implementation of the <code>IdentityStore</code> interface can validate users' credentials, provide information about the groups they belong to, or both.
Most often, an <code>IdentityStore</code> implementation will interact with an external identity store&#8201;&#8212;&#8201;an LDAP server, for example&#8201;&#8212;&#8201;to perform the actual credential validation and group lookups, but an <code>IdentityStore</code> may also manage user account data itself.</p>
</div>
<div class="paragraph">
<p>There are two built-in implementations of <code>IdentityStore</code>: an LDAP identity store, and a Database identity store.
These identity stores delegate to external stores that must already exist; the IdentityStore implementations do not provide or manage the external store.
They are configured with the parameters necessary to communicate with an external store using the following annotations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>LdapIdentityStoreDefinition</code>&#8201;&#8212;&#8201;configures an identity store with the parameters necessary to communicate with an external LDAP server, validate user credentials, and/or lookup user groups.</p>
</li>
<li>
<p><code>DatabaseIdentityStoreDefinition</code>&#8201;&#8212;&#8201;configures an identity store with the parameters necessary to connect to an external database, validate user credentials, and/or lookup user groups.
You must supply a PasswordHash implementation when configuring a Database Identity Store.
See <a href="#the-passwordhash-interface">The PasswordHash Interface</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An application can provide its own custom identity store, or use the built-in LDAP or database identity stores.
For examples of both types, see:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#running-the-built-in-database-identity-store-example">Running the Built-In Database Identity Store Example</a></p>
</li>
<li>
<p><a href="#running-the-custom-identity-store-example">Running the Custom Identity Store Example</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An implementation of <code>IdentityStore</code> must be a CDI bean to be recognized and deployed at runtime, and is assumed to be normal scoped.
IdentityStores are primarily intended for use by implementations of <code>HttpAuthenticationMechanisms</code>, but this is not a requirement.
They can be used by other types of authentication mechanisms as well, or by containers.</p>
</div>
<div class="paragraph">
<p>Multiple implementations of <code>IdentityStore</code> may be present.
If so, they are invoked under the control of an <code>IdentityStoreHandler</code>.</p>
</div>
<div class="sect4">
<h5 id="identitystorehandler"><a class="anchor" href="#identitystorehandler"></a>IdentityStoreHandler</h5>
<div class="paragraph">
<p>Authentication mechanisms do not interact with <code>IdentityStore</code> directly; instead, they call an <code>IdentityStoreHandler</code>.
An implementation of the <code>IdentityStoreHandler</code> interface provides a single method, <code>validate(Credential)</code>, which, when invoked, iterates over the available IdentityStores and returns an aggregated result.
An <code>IdentityStoreHandler</code> must also be a CDI bean, and is assumed to be normal scoped.
At runtime, an authentication mechanism injects the <code>IdentityStoreHandler</code> and invokes on it.
The <code>IdentityStoreHandler</code>, in turn, looks up the available IdentityStores and invokes on them to determine the aggregate result.</p>
</div>
<div class="paragraph">
<p>There is a built-in <code>IdentityStoreHandler</code> that implements a standard algorithm defined by Jakarta Security.
The Jakarta Security specification provides a full description of the algorithm, but it can be roughly summarized as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Iterate over the available validating IdentityStores, in priority order, until the provided Credential is validated or there are no more IdentityStores.</p>
</li>
<li>
<p>If the Credential was validated, iterate over the available group-providing IdentityStores, in priority order, aggregating the groups returned by each store.</p>
</li>
<li>
<p>Return the validated caller and group information.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An application may also supply its own <code>IdentityStoreHandler</code>, which can use any desired algorithm to select and invoke on IdentityStores, and return an aggregated (or non-aggregated) result.</p>
</div>
</div>
<div class="sect4">
<h5 id="identitystore-interface-methods"><a class="anchor" href="#identitystore-interface-methods"></a>IdentityStore Interface Methods</h5>
<div class="paragraph">
<p>The IdentityStore interface itself has four methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>validate(Credential)</code>&#8201;&#8212;&#8201;validate a Credential, and return the result of that validation.</p>
</li>
<li>
<p><code>getCallerGroups(CredentialValidationResult)</code>&#8201;&#8212;&#8201;return the groups associated with the caller indicated by the supplied <code>CredentialValidationResult</code>, which represents the result of a previous, successful validation.</p>
</li>
<li>
<p><code>validationTypes()</code>&#8201;&#8212;&#8201;returns a Set of validation types (one or more of <code>VALIDATE</code>, <code>PROVIDE_GROUPS</code>) that indicate the operations supported by this instance of the <code>IdentityStore</code>.</p>
</li>
<li>
<p><code>priority()</code>&#8201;&#8212;&#8201;returns a positive integer representing the self-declared priority of this IdentityStore.
Lower values represent higher priority.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Because <code>getCallerGroups()</code> is a sensitive operation&#8201;&#8212;&#8201;it can return information about arbitrary users, and does not require that the caller provide the user&#8217;s credential or proof of identity&#8201;&#8212;&#8201;the caller should have the <code>IdentityStorePermission("getGroups")</code> permission.
Enforcement of this check is incumbent on the implementation of the <code>getCallerGroups()</code> method; the built-in IdentityStores do check for this permission, if a SecurityManager is configured, and the built-in IdentityStoreHandler invokes the <code>getCallerGroups()</code> method in the context of a <code>PrivilegedAction</code> block.</p>
</div>
</div>
<div class="sect4">
<h5 id="the-passwordhash-interface"><a class="anchor" href="#the-passwordhash-interface"></a>The PasswordHash Interface</h5>
<div class="paragraph">
<p>Unlike some types of identity stores, for example LDAP directories, databases can store and retrieve user passwords, but can&#8217;t verify them natively.
Therefore, the built-in Database identity store must verify user passwords itself.
Most often, this involves generating a hash of the user&#8217;s password for comparison with a hash value stored in the database.</p>
</div>
<div class="paragraph">
<p>In order to provide maximum flexibility and interoperability, the Database identity store does not implement any specific password hashing algorithms.
Instead, it defines the <code>PasswordHash</code> interface, and expects the application to provide an implementation of <code>PasswordHash</code> that can verify passwords from the specific store the application will use.
The <code>PasswordHash</code> implementation must be made available as a dependent-scoped bean, and is configured by providing the fully-qualified name of the desired type as the <code>hashAlgorithm</code> value on a <code>DatabaseIdentityStoreDefinition</code>.</p>
</div>
<div class="paragraph">
<p>The <code>PasswordHash</code> algorithm defines three methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>initialize(Map&lt;String,String&gt; parameters)</code>&#8201;&#8212;&#8201;initialize the PasswordHash with the supplied Map of parameters.
The Database identity store calls this method when initializing, passing the <code>hashAlgorithmParameters</code> value of the <code>DatabaseIdentityStoreDefinition</code> annotation (after conversion to a Map).</p>
</li>
<li>
<p><code>verify(char[] password, String hashedPassword)</code>&#8201;&#8212;&#8201;verify a caller-supplied password against the caller&#8217;s stored password hash as retrieved from the database.
The <code>hashedPassword</code> value should be provided exactly as it was returned from the database.</p>
</li>
<li>
<p><code>generate(char[] password)</code>&#8201;&#8212;&#8201;generate a password hash from the supplied password.
The value returned should be formatted and encoded exactly it would be stored in the database.
While it is useful to generate the hash of a caller-supplied password during <code>verify()</code>, this method is intended primarily for use by applications or <code>IdentityStore</code> implementations that want to support password management/reset capability without having to duplicate the code used to verify passwords.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that, while the interface is oriented toward hashing passwords, it can also support alternative approaches, such as two-way encryption of stored passwords.</p>
</div>
<div class="paragraph">
<p>There is a built-in <code>Pbkdf2PasswordHash</code> implementation that supports, as it&#8217;s name suggests, PBKDF2 password hashing.
It supports several parameters that control the generation of hash values (key size, iterations, and so on&#8201;&#8212;&#8201;see the Javadoc), and those parameters are encoded into the resulting hash value, so that hashes can be verified even if the currently configured parameters are different from the parameters in effect when a stored hash was generated.</p>
</div>
<div class="paragraph">
<p>While it is necessary to write a custom <code>PasswordHash</code> to enable interoperability with a legacy identity store that stores password hashes in a format other than the <code>Pbkdf2PasswordHash</code> format, developers should consider carefully whether <code>Pbkdf2PasswordHash</code> is sufficient for new identity stores, and avoid writing a new PasswordHash implementation without a solid understanding of the cryptographic and other security considerations involved.
Some of the considerations specific to password hashing are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The requirements for hashing passwords differ considerably from the requirements for hashing in other contexts.
In particular, speed is normally a virtue when generating hashes, but when generating password hashes, slower is better&#8201;&#8212;&#8201;to slow down brute force attacks against hashed values.</p>
</li>
<li>
<p>The comparison of a generated hash with a stored hash should take constant time, whether it succeeds or fails, in order to avoid giving an attacker clues about the password value based on the timing of failed attempts.</p>
</li>
<li>
<p>A new random salt should be used each time a new password hash value is generated.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="the-remembermeidentitystore-interface"><a class="anchor" href="#the-remembermeidentitystore-interface"></a>The RememberMeIdentityStore Interface</h4>
<div class="paragraph">
<p>The <code>RememberMeIdentityStore</code> interface represents a special type of identity store.
It is not directly related to the <code>IdentityStore</code> interface; that is, it does not implement or extend it.
It does, however, perform a similar, albeit specialized, function.</p>
</div>
<div class="paragraph">
<p>In some cases, an application wants to "remember" a user&#8217;s authenticated session for an extended period.
For example, a web site may remember you when you visit, and prompt for your password only periodically, perhaps once every two weeks, as long as you don&#8217;t explicitly log out.</p>
</div>
<div class="paragraph">
<p>RememberMe works as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When a request from an unauthenicated user is received, the user is authenticated using an <code>HttpAuthenticationMechanism</code> that is provided by the application (this is required&#8201;&#8212;&#8201;<code>RememberMeIdentityStore</code> can only be used in conjunction with an application-supplied <code>HttpAuthenticationMechanism</code>).</p>
</li>
<li>
<p>After authentication, the configured <code>RememberMeIdentityStore</code> saves information about the user&#8217;s authenticated identity, so that it be restored later, and generates a long-lived "remember me" login token that is sent back to the client, perhaps as a cookie.</p>
</li>
<li>
<p>On a subsequent visit to the application, the client presents the login token.
The <code>RememberMeIdentityStore</code> then validates the token and returns the stored user identity, which is then established as the user&#8217;s authenticated identity.
If the token is invalid or expired, it is discarded, the user is authenticated normally again, and a new login token is generated.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>RememberMeIdentityStore</code> interface defines the following methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>generateLoginToken(CallerPrincipal caller, Set&lt;String&gt; groups)</code>&#8201;&#8212;&#8201;generate a login token for a newly authenticated user, and associate it with the provided caller/group information.</p>
</li>
<li>
<p><code>removeLoginToken(String token)</code>&#8201;&#8212;&#8201;remove the (presumably expired or invalid) login token and any associated caller/group information.</p>
</li>
<li>
<p><code>validate(RememberMeCredential credential)</code>&#8201;&#8212;&#8201;validate the supplied credential, and, if valid, return the associated caller/group information.
(<code>RememberMeCredential</code> is essentially just a holder for a login token).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An implementation of <code>RememberMeIdentityStore</code> must be a CDI bean, and is assumed to be normal scoped.
It is configured by adding a <code>RememberMe</code> annotation to an application&#8217;s <code>HttpAuthenticationMechanism</code>, which indicates that a <code>RememberMeIdentityStore</code> is in use, and provides related configuration parameters.
A container-supplied interceptor then intercepts calls to the <code>HttpAuthenticationMechanism</code>, invokes the <code>RememberMeIdentityStore</code> as necessary before and after calls to the authentication mechanism, and ensures that the user&#8217;s identity is correctly set for the session.
The Jakarta Security specification provides a detailed description of the required interceptor behavior.</p>
</div>
<div class="paragraph">
<p>Implementations of <code>RememberMeIdentityStore</code> should take care to manage tokens and user identity information securely.
For example, login tokens should not contain sensitive user information, like credentials or sensitive attributes, to avoid exposing that information if an attacker were able to gain access to the token&#8201;&#8212;&#8201;even an encrypted token is potentially vulnerable to an attacker with sufficient time/resources.
Similarly, tokens should be encrypted/signed wherever possible, and sent only over secure channels (HTTPS).
User identity information managed by a <code>RememberMeIdentityStore</code> should be stored as securely as possible (but does not necessarily need to be reliably persisted&#8201;&#8212;&#8201;the only impact of a "forgotten" session is that the user will be prompted to log in again).</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="running-the-built-in-database-identity-store-example"><a class="anchor" href="#running-the-built-in-database-identity-store-example"></a>Running the Built-In Database Identity Store Example</h3>
<div class="paragraph">
<p>The example described in this section demonstrates how to use the built-in database identity store for credential validation.</p>
</div>
<div class="paragraph">
<p>Topics include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#overview-of-the-built-in-database-identity-store-example">Overview of the Built-In Database Identity Store Example</a></p>
</li>
<li>
<p><a href="#running-the-built-in-db-identity-store-example">Running the built-in-db-identity-store Example</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="overview-of-the-built-in-database-identity-store-example"><a class="anchor" href="#overview-of-the-built-in-database-identity-store-example"></a>Overview of the Built-In Database Identity Store Example</h4>
<div class="paragraph">
<p>Jakarta Security mandates that a Jakarta EE container MUST support a built-in <code>IdentityStore</code> backed by a database.
To support this mandatory requirement, <code>DatabaseIdentityStore</code> is bundled with GlassFish.</p>
</div>
<div class="paragraph">
<p>This example demonstrates how you can configure a <code>DatabaseIdentityStore</code> to point to a backend database and then use it as an IdentityStore.
The authentication mechanism used is <code>BasicAuthenticationMechanism</code>.</p>
</div>
<div class="paragraph">
<p>The source code for this example is in the <code><em>tut-install</em>/examples/security/security-api/built-in-db-identity-store</code> directory.</p>
</div>
<div class="paragraph">
<p>The following sections describe the high-level process for configuring the <code>DatabaseIdentityStore</code>.
Note that the configuration described in these sections has already been completed in the application files, but is provided here to illustrate what you need to do to use the built-in database identity store.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#define-the-users-and-groups-in-the-identity-store">Define the Users and Groups in the Identity Store</a></p>
</li>
<li>
<p><a href="#map-the-databaseidentitystore-to-the-default-data-source">Map the DatabaseIdentityStore to the Default Data source</a></p>
</li>
<li>
<p><a href="#specify-the-authentication-mechanism">Specify the Authentication Mechanism</a></p>
</li>
<li>
<p><a href="#declare-roles-in-the-servlet-container">Declare Roles in the Servlet Container</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When a request that includes credentials is sent to the application, it triggers the configured authentication mechanism and authentication is performed against the <code>DatabaseIdentityStore</code> as defined in the application.</p>
</div>
<div class="paragraph">
<p>Post authentication, the application also verifies the roles the caller is in and sends the details as part of the response.</p>
</div>
<div class="paragraph">
<p>Note that in GlassFish, if the user provides the wrong credentials when using <code>BasicAuthenticationMechanism</code>, then the <code>realmName</code> is presented to user, as a hint.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">curl -I -u Joe http://localhost:8080/built-in-db-identity-store/servlet
Enter host password for user 'Joe':
HTTP/1.1 401 Unauthorized
Server: Eclipse GlassFish  6.0.0
X-Powered-By: Servlet/5.0 JSP/3.0(Eclipse GlassFish  6.0.0  Java/AdoptOpenJDK/1.8)
WWW-Authenticate: Basic realm=&quot;file&quot;
Content-Length: 1056
Content-Language:
Content-Type: text/html</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="define-the-users-and-groups-in-the-identity-store"><a class="anchor" href="#define-the-users-and-groups-in-the-identity-store"></a>Define the Users and Groups in the Identity Store</h5>
<div class="paragraph">
<p>The following table shows the users, passwords, and groups used in this example.</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 40%;">
<colgroup>
<col style="width: 30%;">
<col style="width: 40%;">
<col style="width: 30%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">User</th>
<th class="tableblock halign-left valign-top">Password</th>
<th class="tableblock halign-left valign-top">Group</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Joe</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">secret1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">foo, bar</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sam</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">secret2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">foo, bar</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tom</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">secret2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">foo</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sue</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">secret2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">foo</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The following code shows how to define credentials and the roles assigned to users in the <code>DatabaseSetup.java</code> file.</p>
</div>
<div class="paragraph">
<p>With <code>@Startup</code> annotation, this singleton enterprise bean is initialized during application startup and the credentials are set in the underlying database.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">java.sql.Connection</span>;
<span class="keyword">import</span> <span class="include">java.sql.PreparedStatement</span>;
<span class="keyword">import</span> <span class="include">java.sql.SQLException</span>;

<span class="keyword">import</span> <span class="include">jakarta.annotation.PostConstruct</span>;
<span class="keyword">import</span> <span class="include">jakarta.annotation.PreDestroy</span>;
<span class="keyword">import</span> <span class="include">jakarta.annotation.Resource</span>;
<span class="keyword">import</span> <span class="include">jakarta.annotation.sql.DataSourceDefinition</span>;
<span class="keyword">import</span> <span class="include">jakarta.ejb.Singleton</span>;
<span class="keyword">import</span> <span class="include">jakarta.ejb.Startup</span>;
<span class="keyword">import</span> <span class="include">jakarta.sql.DataSource</span>;

<span class="annotation">@Singleton</span>
<span class="annotation">@Startup</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">DatabaseSetup</span> {

    <span class="comment">// The default datasource that is bundled with GlassFish is used to store // credentials.</span>
    <span class="annotation">@Resource</span>(lookup=<span class="string"><span class="delimiter">&quot;</span><span class="content">java:comp/DefaultDataSource</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">private</span> <span class="predefined-type">DataSource</span> dataSource;

    <span class="annotation">@PostConstruct</span>
    <span class="directive">public</span> <span class="type">void</span> init() {

        <span class="comment">// ...</span>
        executeUpdate(dataSource, <span class="string"><span class="delimiter">&quot;</span><span class="content">INSERT INTO caller VALUES('Joe', '</span><span class="delimiter">&quot;</span></span> + passwordHash.generate(<span class="string"><span class="delimiter">&quot;</span><span class="content">secret1</span><span class="delimiter">&quot;</span></span>.toCharArray()) + <span class="string"><span class="delimiter">&quot;</span><span class="content">')</span><span class="delimiter">&quot;</span></span>);
        <span class="comment">// ...</span>
        executeUpdate(dataSource, <span class="string"><span class="delimiter">&quot;</span><span class="content">INSERT INTO caller_groups VALUES('Joe', 'foo')</span><span class="delimiter">&quot;</span></span>);
        executeUpdate(dataSource, <span class="string"><span class="delimiter">&quot;</span><span class="content">INSERT INTO caller_groups VALUES('Joe', 'bar')</span><span class="delimiter">&quot;</span></span>);
        <span class="comment">// ...</span>
    }

    <span class="annotation">@PreDestroy</span>
    <span class="directive">public</span> <span class="type">void</span> destroy() {
            <span class="comment">// ...</span>
    }

    <span class="directive">private</span> <span class="type">void</span> executeUpdate(<span class="predefined-type">DataSource</span> dataSource, <span class="predefined-type">String</span> query) {
        <span class="comment">// ...</span>
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="map-the-databaseidentitystore-to-the-default-data-source"><a class="anchor" href="#map-the-databaseidentitystore-to-the-default-data-source"></a>Map the DatabaseIdentityStore to the Default Data source</h5>
<div class="paragraph">
<p>Use the <code>@DatabaseIdentityStoreDefinition</code> annotation to map the built-in <code>DatabaseIdentityStore</code> to the <code>DefaultDataSource</code> in the <code>ApplicationConfig.java</code> file.
This example also demonstrates the use of the <code>Pbkdf2PasswordHash</code> interface.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// Database Definition for built-in DatabaseIdentityStore</span>
<span class="annotation">@DatabaseIdentityStoreDefinition</span>(
    callerQuery = <span class="string"><span class="delimiter">&quot;</span><span class="content">#{'select password from caller where name = ?'}</span><span class="delimiter">&quot;</span></span>,
    groupsQuery = <span class="string"><span class="delimiter">&quot;</span><span class="content">select group_name from caller_groups where caller_name = ?</span><span class="delimiter">&quot;</span></span>,
    hashAlgorithm = Pbkdf2PasswordHash.class,
    priorityExpression = <span class="string"><span class="delimiter">&quot;</span><span class="content">#{100}</span><span class="delimiter">&quot;</span></span>,
    hashAlgorithmParameters = {
        <span class="string"><span class="delimiter">&quot;</span><span class="content">Pbkdf2PasswordHash.Iterations=3072</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">${applicationConfig.dyna}</span><span class="delimiter">&quot;</span></span>
    }
)

<span class="annotation">@ApplicationScoped</span>
<span class="annotation">@Named</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">ApplicationConfig</span> {

  <span class="directive">public</span> <span class="predefined-type">String</span><span class="type">[]</span> getDyna() {
       <span class="keyword">return</span> <span class="keyword">new</span> <span class="predefined-type">String</span><span class="type">[]</span>{<span class="string"><span class="delimiter">&quot;</span><span class="content">Pbkdf2PasswordHash.Algorithm=PBKDF2WithHmacSHA512</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Pbkdf2PasswordHash.SaltSizeBytes=64</span><span class="delimiter">&quot;</span></span>};
   }

}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="specify-the-authentication-mechanism"><a class="anchor" href="#specify-the-authentication-mechanism"></a>Specify the Authentication Mechanism</h5>
<div class="paragraph">
<p>In this application, credentials are validated using the BASIC authentication mechanism.
Specify the <code>@BasicAuthenticationMechanismDefinition</code> annotation in the <code>ApplicationConfig.java</code> to ensure that the <code>BasicAuthenticationMechanism</code> is used to perform credential validation.</p>
</div>
<div class="paragraph">
<p>When a request is made to the servlet in question, the container delegates the request to <code>org.glassfish.soteria.mechanisms.jaspic.HttpBridgeServerAuthModule</code>, which then invokes the <code>BasicAuthenticationMechanism#validateRequest</code> method, and gets the credential from the request.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@BasicAuthenticationMechanismDefinition</span>(
        realmName = <span class="string"><span class="delimiter">&quot;</span><span class="content">file</span><span class="delimiter">&quot;</span></span>
)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="declare-roles-in-the-servlet-container"><a class="anchor" href="#declare-roles-in-the-servlet-container"></a>Declare Roles in the Servlet Container</h5>
<div class="paragraph">
<p>When a request is made to the application, the roles the user is in are returned as part of the response.
Note that the container needs to be made aware of the supported roles, which are defined using the <code>@DeclareRoles({ "foo", "bar", "kaz" })</code> annotation as shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@WebServlet</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/servlet</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@DeclareRoles</span>({ <span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">kaz</span><span class="delimiter">&quot;</span></span> })
<span class="annotation">@ServletSecurity</span>(<span class="annotation">@HttpConstraint</span>(rolesAllowed = <span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>))
<span class="directive">public</span> <span class="type">class</span> <span class="class">Servlet</span> <span class="directive">extends</span> HttpServlet {

    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="type">long</span> serialVersionUID = <span class="integer">1L</span>;

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> doGet(HttpServletRequest request, HttpServletResponse response) <span class="directive">throws</span> ServletException, <span class="exception">IOException</span> {

        <span class="predefined-type">String</span> webName = <span class="predefined-constant">null</span>;
        <span class="keyword">if</span> (request.getUserPrincipal() != <span class="predefined-constant">null</span>) {
            webName = request.getUserPrincipal().getName();
        }

        response.getWriter().write(<span class="string"><span class="delimiter">&quot;</span><span class="content">web username: </span><span class="delimiter">&quot;</span></span> + webName + <span class="string"><span class="delimiter">&quot;</span><span class="char">\n</span><span class="delimiter">&quot;</span></span>);

        response.getWriter().write(<span class="string"><span class="delimiter">&quot;</span><span class="content">web user has role </span><span class="char">\&quot;</span><span class="content">foo</span><span class="char">\&quot;</span><span class="content">: </span><span class="delimiter">&quot;</span></span> + request.isUserInRole(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>) + <span class="string"><span class="delimiter">&quot;</span><span class="char">\n</span><span class="delimiter">&quot;</span></span>);
        response.getWriter().write(<span class="string"><span class="delimiter">&quot;</span><span class="content">web user has role </span><span class="char">\&quot;</span><span class="content">bar</span><span class="char">\&quot;</span><span class="content">: </span><span class="delimiter">&quot;</span></span> + request.isUserInRole(<span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>) + <span class="string"><span class="delimiter">&quot;</span><span class="char">\n</span><span class="delimiter">&quot;</span></span>);
        response.getWriter().write(<span class="string"><span class="delimiter">&quot;</span><span class="content">web user has role </span><span class="char">\&quot;</span><span class="content">kaz</span><span class="char">\&quot;</span><span class="content">: </span><span class="delimiter">&quot;</span></span> + request.isUserInRole(<span class="string"><span class="delimiter">&quot;</span><span class="content">kaz</span><span class="delimiter">&quot;</span></span>) + <span class="string"><span class="delimiter">&quot;</span><span class="char">\n</span><span class="delimiter">&quot;</span></span>);
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In GlassFish 6.0, group to role mapping is enabled by default.
Therefore, you do not need to bundle web.xml with the application to provide mapping between roles and groups.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="running-the-built-in-db-identity-store-example"><a class="anchor" href="#running-the-built-in-db-identity-store-example"></a>Running the built-in-db-identity-store Example</h4>
<div class="paragraph">
<p>You can use either NetBeans IDE or Maven to build, package, deploy, and run the <code>built-in-db-identity-store</code> application as described in the following topics:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#to-build-package-and-deploy-the-built-in-db-identity-store-example-using-netbeans-ide">To Build, Package, and Deploy the built-in-db-identity-store Example Using NetBeans IDE</a></p>
</li>
<li>
<p><a href="#to-build-package-and-deploy-the-built-in-db-identity-store-example-using-maven">To Build, Package, and Deploy the built-in-db-identity-store Example Using Maven</a></p>
</li>
<li>
<p><a href="#to-run-the-built-in-db-identity-store-example">To Run the built-in-db-identity-store Example</a></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="to-build-package-and-deploy-the-built-in-db-identity-store-example-using-netbeans-ide"><a class="anchor" href="#to-build-package-and-deploy-the-built-in-db-identity-store-example-using-netbeans-ide"></a>To Build, Package, and Deploy the built-in-db-identity-store Example Using NetBeans IDE</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If you have not already done so, start the default database.
This is necessary because we are using the DefaultDataSource bundled with GlassFish for <code>DatabaseIdentityStore</code>.
See <a href="#starting-and-stopping-apache-derby">Starting and Stopping Apache Derby</a>.</p>
</li>
<li>
<p>If you have not already done so, start the GlassFish server.
See <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>.</p>
</li>
<li>
<p>From the File menu, choose Open Project.</p>
</li>
<li>
<p>In the Open Project dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/security/security-api</pre>
</div>
</div>
</li>
<li>
<p>Select the <code>built-in-db-identity-store</code> folder.</p>
</li>
<li>
<p>Click Open Project.</p>
</li>
<li>
<p>In the Projects tab, right-click the <code>built-in-db-identity-store</code> project and select Build.</p>
<div class="paragraph">
<p>This command builds and deploys the example application to your GlassFish Server instance.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-build-package-and-deploy-the-built-in-db-identity-store-example-using-maven"><a class="anchor" href="#to-build-package-and-deploy-the-built-in-db-identity-store-example-using-maven"></a>To Build, Package, and Deploy the built-in-db-identity-store Example Using Maven</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If you have not already done so, start the default database.
This is necessary because we are using the DefaultDataSource bundled with GlassFish for <code>DatabaseIdentityStore</code>.
See <a href="#starting-and-stopping-apache-derby">Starting and Stopping Apache Derby</a>.</p>
</li>
<li>
<p>If you have not already done so, start the GlassFish server. See
<a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>.</p>
</li>
<li>
<p>In a terminal window, go to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/security/security-api/built-in-db-identity-store</pre>
</div>
</div>
</li>
<li>
<p>Enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">mvn install</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command builds and packages the application into a WAR file, <code>built-in-db-identity-store.war</code>, that is located in the <code>target</code> directory, then deploys the WAR file.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-run-the-built-in-db-identity-store-example"><a class="anchor" href="#to-run-the-built-in-db-identity-store-example"></a>To Run the built-in-db-identity-store Example</h5>
<div class="paragraph">
<p>In this example, use the credentials of user Joe to make a request and to validate the response according to the credentials/roles defined in <code>DatabaseSetup.java</code>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make a request to the deployed application by entering the following request URL in your web browser:</p>
<div class="paragraph">
<p>Request URL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080/built-in-db-identity-store/servlet</pre>
</div>
</div>
<div class="paragraph">
<p>Because BASIC authentication is being used here, the container responds back prompting for username and password.</p>
</div>
</li>
<li>
<p>Enter the username <code>Joe</code>, and the password <code>secret1</code> at the prompt.</p>
<div class="paragraph">
<p>Once you provide the credentials, the following process occurs:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The client presents the request to the container with base64 encoded string and with the <code>Authorization</code> header using the value in the format expected for basic authentication.</p>
</li>
<li>
<p>With the username and password available to the container, validation is performed against <code>DatabaseIdentityStore</code>.</p>
</li>
<li>
<p>The corresponding <code>UsernamePasswordCredential</code> object is passed as a parameter to the <code>DatabaseIdentityStore#validate()</code> method.</p>
</li>
<li>
<p>The password is fetched from the database for user Joe.</p>
</li>
<li>
<p>The password stored in the database is hashed using the <code>PBKDF2</code> algorithm and verified by the built-in <code>Pbkdf2PasswordHash</code> implementation.</p>
</li>
<li>
<p>On successful verification, the request gets delegated to the servlet in question and the following response is returned to the end user.</p>
<div class="paragraph">
<p>Response:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>web username: Joe
web user has role "foo": true
web user has role "bar": true
web user has role "kaz": false</pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Test the authentication using invalid credentials.
Make a request to the deployed application by entering the following request URL in your web browser:</p>
<div class="paragraph">
<p>Request URL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080/built-in-db-identity-store/servlet</pre>
</div>
</div>
<div class="paragraph">
<p>Again, because BASIC authentication is being used here, the container responds back prompting for username and password.</p>
</div>
</li>
<li>
<p>Enter an invalid username and password.
You are promted to enter the credentials again, but you are not authenticated.</p>
<div class="paragraph">
<p>When you click Cancel in the Authentication required window, the following response is returned:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>HTTP Status 401 - Unauthorized

type Status report

message Unauthorized

description This request requires HTTP authentication.

Eclipse GlassFish 6.0.0</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="running-the-custom-identity-store-example"><a class="anchor" href="#running-the-custom-identity-store-example"></a>Running the Custom Identity Store Example</h3>
<div class="paragraph">
<p>The example described in this section demonstrates how to bundle and use a custom identity store in your application for credential validation.</p>
</div>
<div class="paragraph">
<p>Topics include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#overview-of-the-custom-identity-store-example">Overview of the Custom Identity Store Example</a></p>
</li>
<li>
<p><a href="#running-the-custom-identity-store-example-2">Running the custom-identity-store Example</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="overview-of-the-custom-identity-store-example"><a class="anchor" href="#overview-of-the-custom-identity-store-example"></a>Overview of the Custom Identity Store Example</h4>
<div class="paragraph">
<p>As an alternative to using a built-in identity store, an application can provide its own IdentityStore.
When bundled with the application, this custom identity store can then be used for authentication and authorization.</p>
</div>
<div class="paragraph">
<p>This example demonstrates how to define a custom identity store, <code>TestIdentityStore</code>, and provide it as part of the application being deployed.
The authentication mechanism used is <code>BasicAuthenticationMechanism</code>.</p>
</div>
<div class="paragraph">
<p>The source code for this example is in the <code><em>tut-install</em>/examples/security/security-api/custom-identity-store</code> directory.</p>
</div>
<div class="paragraph">
<p>The following sections describe the high-level process for defining the <code>TestIdentityStore</code>.
Note that the configuration described in these sections has already been completed in the application files, but is provided here to illustrate what you need to do to use a custom identity store.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#define-the-users-and-groups-in-the-identity-store">Define the Users and Groups in the Identity Store</a></p>
</li>
<li>
<p><a href="#specify-the-authentication-mechanism">Specify the Authentication Mechanism</a></p>
</li>
<li>
<p><a href="#declare-roles-in-the-servlet-container">Declare Roles in the Servlet Container</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When a request that includes credentials is sent to the application, the configured authentication mechanism comes into effect and authentication is performed against the <code>TestIdentityStore</code> as defined in the application.</p>
</div>
<div class="paragraph">
<p>Post authentication, the application also verifies the roles the caller is in and sends the details as part of the response.</p>
</div>
<div class="paragraph">
<p>Note that in GlassFish, if the user provides the wrong credentials when using <code>BasicAuthenticationMechanism</code>, then the <code>realmName</code> is presented to user, as a hint.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>curl -I -u Joe http://localhost:8080/custom-identity-store/servlet
Enter host password for user 'Joe':
HTTP/1.1 401 Unauthorized
Server: Eclipse GlassFish  6.0.0
X-Powered-By: Servlet/5.0 JSP/3.0(Eclipse GlassFish  6.0.0  Java/AdoptOpenJDK/1.8)
WWW-Authenticate: Basic realm="file"
Content-Length: 1056
Content-Language:
Content-Type: text/html</pre>
</div>
</div>
<div class="sect4">
<h5 id="define-the-users-and-groups-in-the-identity-store-2"><a class="anchor" href="#define-the-users-and-groups-in-the-identity-store-2"></a>Define the Users and Groups in the Identity Store</h5>
<div class="paragraph">
<p>The following table shows the user, password, and group used in this example.</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 40%;">
<colgroup>
<col style="width: 30%;">
<col style="width: 40%;">
<col style="width: 30%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">User</th>
<th class="tableblock halign-left valign-top">Password</th>
<th class="tableblock halign-left valign-top">Group</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Joe</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">secret1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">foo, bar</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The following code snippet shows how you define the credentials and the roles assigned to users in the <code>TestIdentityStore.java</code> file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">if</span> (usernamePasswordCredential.compareTo(<span class="string"><span class="delimiter">&quot;</span><span class="content">Joe</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">secret1</span><span class="delimiter">&quot;</span></span>)) {
    <span class="keyword">return</span> <span class="keyword">new</span> CredentialValidationResult(<span class="string"><span class="delimiter">&quot;</span><span class="content">Joe</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> <span class="predefined-type">HashSet</span>&lt;&gt;(asList(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>)));
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="specify-the-authentication-mechanism-2"><a class="anchor" href="#specify-the-authentication-mechanism-2"></a>Specify the Authentication Mechanism</h5>
<div class="paragraph">
<p>In this application, credentials are validated using the BASIC authentication mechanism.
Specify the <code>@BasicAuthenticationMechanismDefinition</code> annotation in the <code>ApplicationConfig.java</code> to ensure that the <code>BasicAuthenticationMechanism</code> is used to perform credential validation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@BasicAuthenticationMechanismDefinition</span>(
        realmName = <span class="string"><span class="delimiter">&quot;</span><span class="content">file</span><span class="delimiter">&quot;</span></span>
)

<span class="annotation">@ApplicationScoped</span>
<span class="annotation">@Named</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">ApplicationConfig</span> {

}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="declare-roles-in-the-servlet-container-2"><a class="anchor" href="#declare-roles-in-the-servlet-container-2"></a>Declare Roles in the Servlet Container</h5>
<div class="paragraph">
<p>When a request is made to the application, the roles the user is in are returned as part of the response.
Note that the container needs to be made aware of the supported roles, which are defined using the <code>@Declareroles({ "foo", "bar", "kaz" })</code> annotation as shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DeclareRoles</span>({ <span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">kaz</span><span class="delimiter">&quot;</span></span> })
<span class="annotation">@WebServlet</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/servlet</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">Servlet</span> <span class="directive">extends</span> HttpServlet {

    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="type">long</span> serialVersionUID = <span class="integer">1L</span>;

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> doGet(HttpServletRequest request, HttpServletResponse response) <span class="directive">throws</span> ServletException, <span class="exception">IOException</span> {

        <span class="predefined-type">String</span> webName = <span class="predefined-constant">null</span>;
        <span class="keyword">if</span> (request.getUserPrincipal() != <span class="predefined-constant">null</span>) {
            webName = request.getUserPrincipal().getName();
        }

        response.getWriter().write(<span class="string"><span class="delimiter">&quot;</span><span class="content">web username: </span><span class="delimiter">&quot;</span></span> + webName + <span class="string"><span class="delimiter">&quot;</span><span class="char">\n</span><span class="delimiter">&quot;</span></span>);

        response.getWriter().write(<span class="string"><span class="delimiter">&quot;</span><span class="content">web user has role </span><span class="char">\&quot;</span><span class="content">foo</span><span class="char">\&quot;</span><span class="content">: </span><span class="delimiter">&quot;</span></span> + request.isUserInRole(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>) + <span class="string"><span class="delimiter">&quot;</span><span class="char">\n</span><span class="delimiter">&quot;</span></span>);
        response.getWriter().write(<span class="string"><span class="delimiter">&quot;</span><span class="content">web user has role </span><span class="char">\&quot;</span><span class="content">bar</span><span class="char">\&quot;</span><span class="content">: </span><span class="delimiter">&quot;</span></span> + request.isUserInRole(<span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>) + <span class="string"><span class="delimiter">&quot;</span><span class="char">\n</span><span class="delimiter">&quot;</span></span>);
        response.getWriter().write(<span class="string"><span class="delimiter">&quot;</span><span class="content">web user has role </span><span class="char">\&quot;</span><span class="content">kaz</span><span class="char">\&quot;</span><span class="content">: </span><span class="delimiter">&quot;</span></span> + request.isUserInRole(<span class="string"><span class="delimiter">&quot;</span><span class="content">kaz</span><span class="delimiter">&quot;</span></span>) + <span class="string"><span class="delimiter">&quot;</span><span class="char">\n</span><span class="delimiter">&quot;</span></span>);
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In GlassFish 6.0, group to role mapping is enabled by default.
Therefore, you do not need to bundle <code>web.xml</code> with the application to provide mapping between roles and groups.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="running-the-custom-identity-store-example-2"><a class="anchor" href="#running-the-custom-identity-store-example-2"></a>Running the custom-identity-store Example</h4>
<div class="paragraph">
<p>You can use either NetBeans IDE or Maven to build, package, deploy, and run the <code>custom-identity-store</code> application as described in the following topics:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#to-build-package-and-deploy-the-custom-identity-store-example-using-netbeans-ide">To Build, Package, and Deploy the custom-identity-store Example Using NetBeans IDE</a></p>
</li>
<li>
<p><a href="#to-build-package-and-deploy-the-custom-identity-store-example-using-maven">To Build, Package, and Deploy the custom-identity-store Example Using Maven</a></p>
</li>
<li>
<p><a href="#to-run-the-custom-identity-store-example">To Run the custom-identity-store Example</a></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="to-build-package-and-deploy-the-custom-identity-store-example-using-netbeans-ide"><a class="anchor" href="#to-build-package-and-deploy-the-custom-identity-store-example-using-netbeans-ide"></a>To Build, Package, and Deploy the custom-identity-store Example Using NetBeans IDE</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If you have not already done so, start the GlassFish server.
See <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>.</p>
</li>
<li>
<p>From the File menu, choose Open Project.</p>
</li>
<li>
<p>In the Open Project dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/security/security-api</pre>
</div>
</div>
</li>
<li>
<p>Select the <code>custom-identity-store</code> folder.</p>
</li>
<li>
<p>Click Open Project.</p>
</li>
<li>
<p>In the Projects tab, right-click the <code>custom-identity-store</code> project and select Build.</p>
<div class="paragraph">
<p>This command builds and deploys the example application to your GlassFish Server instance.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-build-package-and-deploy-the-custom-identity-store-example-using-maven"><a class="anchor" href="#to-build-package-and-deploy-the-custom-identity-store-example-using-maven"></a>To Build, Package, and Deploy the custom-identity-store Example Using Maven</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If you have not already done so, start the GlassFish server.
See <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>.</p>
</li>
<li>
<p>In a terminal window, go to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/security/security-api/custom-identity-store</pre>
</div>
</div>
</li>
<li>
<p>Enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">mvn install</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command builds and packages the application into a WAR file, <code>custom-identity-store.war</code>, that is located in the <code>target</code> directory, then deploys the WAR file.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-run-the-custom-identity-store-example"><a class="anchor" href="#to-run-the-custom-identity-store-example"></a>To Run the custom-identity-store Example</h5>
<div class="paragraph">
<p>In this example, use the credentials of user <code>Joe</code> to make a request and to validate the response according to the credentials defined in <code>TestIdentityStore</code>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make a request to the deployed application using valid credentials by entering the following request URL in your web browser:</p>
<div class="paragraph">
<p>Request URL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080/custom-identity-store/servlet?name=Joe&amp;password=secret1</pre>
</div>
</div>
<div class="paragraph">
<p>Response:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>web username: Joe
web user has role "foo": true
web user has role "bar": true
web user has role "kaz": false</pre>
</div>
</div>
</li>
<li>
<p>Test the authentication using invalid credentials.
Make a request to the deployed application by entering the following request URL in your web browser:</p>
<div class="paragraph">
<p>Request URL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080/custom-identity-store/servlet?name=Joe&amp;password=secret3</pre>
</div>
</div>
<div class="paragraph">
<p>Response:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>HTTP Status 401 - Unauthorized

type Status report

message Unauthorized

description This request requires HTTP authentication.

Eclipse GlassFish 6.0.0</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="jakarta-ee-security-advanced-topics"><a class="anchor" href="#jakarta-ee-security-advanced-topics"></a>Chapter 54. Jakarta EE Security: Advanced Topics</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter provides advanced information on securing Jakarta EE applications.</p>
</div>
<div class="sect2">
<h3 id="working-with-digital-certificates"><a class="anchor" href="#working-with-digital-certificates"></a>Working with Digital Certificates</h3>
<div class="paragraph">
<p>Digital certificates for GlassFish Server have already been generated and can be found in the directory <code><em>domain-dir</em>/config/</code>.
These digital certificates are self-signed and are intended for use in a development environment; they are not intended for production purposes.
For production purposes, generate your own certificates and have them signed by a Certificate Authority (CA).</p>
</div>
<div class="paragraph">
<p>To use the Secure Sockets Layer (SSL), an application or web server must have an associated certificate for each external interface, or IP address, that accepts secure connections.
The theory behind this design is that a server should provide some kind of reasonable assurance that its owner is who you think it is, particularly before receiving any sensitive information.
It may be useful to think of a certificate as a "digital driver&#8217;s license" for an Internet address.
The certificate states which company the site is associated with, along with some basic contact information about the site owner or administrator.</p>
</div>
<div class="paragraph">
<p>The digital certificate is cryptographically signed by its owner and is difficult for anyone else to forge.
For sites involved in e-commerce or in any other business transaction in which authentication of identity is important, a certificate can be purchased from a well-known CA such as VeriSign or Thawte.
If your server certificate is self-signed, you must install it in the GlassFish Server keystore file (<code>keystore.jks</code>).
If your client certificate is self-signed, you should install it in the GlassFish Server truststore file (<code>cacerts.jks</code>).</p>
</div>
<div class="paragraph">
<p>Sometimes, authentication is not really a concern.
For example, an administrator might simply want to ensure that data being transmitted and received by the server is private and cannot be snooped by anyone eavesdropping on the connection.
In such cases, you can save the time and expense involved in obtaining a CA certificate and simply use a self-signed certificate.</p>
</div>
<div class="paragraph">
<p>SSL uses public-key cryptography, which is based on key pairs.
Key pairs contain one public key and one private key.
Data encrypted with one key can be decrypted only with the other key of the pair.
This property is fundamental to establishing trust and privacy in transactions.
For example, using SSL, the server computes a value and encrypts it by using its private key.
The encrypted value is called a digital signature.
The client decrypts the encrypted value by using the server&#8217;s public key and compares the value to its own computed value.
If the two values match, the client can trust that the signature is authentic, because only the private key could have been used to produce such a signature.</p>
</div>
<div class="paragraph">
<p>Digital certificates are used with HTTPS to authenticate web clients.
The HTTPS service of most web servers will not run unless a digital certificate has been installed.
Use the procedure outlined in the next section, <a href="#creating-a-server-certificate">Creating a Server Certificate</a>, to set up a digital certificate that can be used by your application or web server to enable SSL.</p>
</div>
<div class="paragraph">
<p>One tool that can be used to set up a digital certificate is <code>keytool</code>, a key and certificate management utility that ships with the JDK.
This tool enables users to administer their own public/private key pairs and associated certificates for use in self-authentication, whereby the user authenticates himself or herself to other users or services, or data integrity and authentication services, using digital signatures.
The tool also allows users to cache the public keys, in the form of certificates, of their communicating peers.</p>
</div>
<div class="paragraph">
<p>For a better understanding of <code>keytool</code> and public-key cryptography, see <a href="#further-information-about-advanced-security-topics">Further Information about Advanced Security Topics</a> for a link to the <code>keytool</code> documentation.</p>
</div>
<div class="sect3">
<h4 id="creating-a-server-certificate"><a class="anchor" href="#creating-a-server-certificate"></a>Creating a Server Certificate</h4>
<div class="paragraph">
<p>A server certificate has already been created for GlassFish Server and can be found in the <code><em>domain-dir</em>/config/</code> directory.
The server certificate is in <code>keystore.jks</code>.
The <code>cacerts.jks</code> file contains all the trusted certificates, including client certificates.</p>
</div>
<div class="paragraph">
<p>If necessary, you can use <code>keytool</code> to generate certificates.
The <code>keytool</code> utility stores the keys and certificates in a file termed a keystore, a repository of certificates used for identifying a client or a server.
Typically, a keystore is a file that contains one client&#8217;s or one server&#8217;s identity.
The keystore protects private keys by using a password.</p>
</div>
<div class="paragraph">
<p>If you don&#8217;t specify a directory when specifying the keystore file name, the keystores are created in the directory from which the <code>keytool</code> command is run.
This can be the directory where the application resides, or it can be a directory common to many applications.</p>
</div>
<div class="paragraph">
<p>The general steps for creating a server certificate are as follows.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create the keystore.</p>
</li>
<li>
<p>Export the certificate from the keystore.</p>
</li>
<li>
<p>Sign the certificate.</p>
</li>
<li>
<p>Import the certificate into a truststore: a repository of certificates used for verifying the certificates.
A truststore typically contains more than one certificate.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The next section provides specific information on using the <code>keytool</code> utility to perform these steps.</p>
</div>
<div class="sect4">
<h5 id="to-use-keytool-to-create-a-server-certificate"><a class="anchor" href="#to-use-keytool-to-create-a-server-certificate"></a>To Use keytool to Create a Server Certificate</h5>
<div class="paragraph">
<p>Run <code>keytool</code> to generate a new key pair in the default development keystore file, <code>keystore.jks</code>.
This example uses the alias <code>server-alias</code> to generate a new public/private key pair and wrap the public key into a self-signed certificate inside <code>keystore.jks</code>.
The key pair is generated by using an algorithm of type RSA, with a default password of <code>changeit</code>.
For more information and other examples of creating and managing keystore files, read the <code>keytool</code> documentation.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
RSA is public-key encryption technology developed by RSA Data Security, Inc.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>From the directory in which you want to create the key pair, run <code>keytool</code> as shown in the following steps.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Generate the server certificate.</p>
<div class="paragraph">
<p>Enter the <code>keytool</code> command all on one line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">java-home/bin/keytool -genkey -alias server-alias -keyalg RSA
-keypass changeit -storepass changeit -keystore keystore.jks</code></pre>
</div>
</div>
<div class="paragraph">
<p>When you press Enter, <code>keytool</code> prompts you to enter the server name, organizational unit, organization, locality, state, and country code.</p>
</div>
<div class="paragraph">
<p>You must enter the server name in response to <code>keytool</code>'s first prompt, in which it asks for first and last names. For testing purposes, this can be <code>localhost</code>.</p>
</div>
</li>
<li>
<p>Export the generated server certificate in <code>keystore.jks</code> into the file <code>server.cer</code>.</p>
<div class="paragraph">
<p>Enter the <code>keytool</code> command all on one line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">java-home/bin/keytool -export -alias server-alias -storepass changeit
-file server.cer -keystore keystore.jks</code></pre>
</div>
</div>
</li>
<li>
<p>If you want to have the certificate signed by a CA, read the example in the <code>keytool</code> documentation.</p>
</li>
<li>
<p>To add the server certificate to the truststore file, <code>cacerts.jks</code>, run <code>keytool</code> from the directory where you created the keystore and server certificate.</p>
<div class="paragraph">
<p>Use the following parameters:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">java-home/bin/keytool -import -v -trustcacerts -alias server-alias
-file server.cer -keystore cacerts.jks -keypass changeit
-storepass changeit</code></pre>
</div>
</div>
<div class="paragraph">
<p>Information on the certificate, such as that shown next, will appear:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Owner: CN=localhost, OU=My Company, O=Software, L=Santa Clara, ST=CA, C=US
Issuer: CN=localhost, OU=My Company, O=Software, L=Santa Clara, ST=CA, C=US
Serial number: 3e932169
Valid from: Mon Nov 26 18:15:47 EST 2012 until: Sun Feb 24 18:15:47 EST 2013
Certificate fingerprints:
         MD5: 52:9F:49:68:ED:78:6F:39:87:F3:98:B3:6A:6B:0F:90
         SHA1: EE:2E:2A:A6:9E:03:9A:3A:1C:17:4A:28:5E:97:20:78:3F:
         SHA256: 80:05:EC:7E:50:50:5D:AA:A3:53:F1:11:9B:19:EB:0D:20:67:C1:12:
AF:42:EC:CD:66:8C:BD:99:AD:D9:76:95
         Signature algorithm name: SHA256withRSA         Version: 3
         ...
Trust this certificate? [no]:</pre>
</div>
</div>
</li>
<li>
<p>Enter <code>yes</code>, then press the Enter or Return key.</p>
<div class="paragraph">
<p>The following information appears:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Certificate was added to keystore
[Storing cacerts.jks]</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="adding-users-to-the-certificate-realm"><a class="anchor" href="#adding-users-to-the-certificate-realm"></a>Adding Users to the Certificate Realm</h4>
<div class="paragraph">
<p>In the <code>certificate</code> realm, user identity is set up in the GlassFish Server security context and populated with user data obtained from cryptographically verified client certificates.
For step-by-step instructions for creating this type of certificate, see <a href="#working-with-digital-certificates">Working with Digital Certificates</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="using-a-different-server-certificate-with-glassfish-server"><a class="anchor" href="#using-a-different-server-certificate-with-glassfish-server"></a>Using a Different Server Certificate with GlassFish Server</h4>
<div class="paragraph">
<p>Follow the steps in <a href="#creating-a-server-certificate">Creating a Server Certificate</a> to create your own server certificate, have it signed by a CA, and import the certificate into <code>keystore.jks</code>.</p>
</div>
<div class="paragraph">
<p>Make sure that when you create the certificate, you follow these rules.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When you create the server certificate, <code>keytool</code> prompts you to enter your first and last name.
In response to this prompt, you must enter the name of your server.
For testing purposes, this can be <code>localhost</code>.</p>
</li>
<li>
<p>If you want to replace the existing <code>keystore.jks</code>, you must either change your keystore&#8217;s password to the default password (<code>changeit</code>) or change the default password to your keystore&#8217;s password.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="to-specify-a-different-server-certificate"><a class="anchor" href="#to-specify-a-different-server-certificate"></a>To Specify a Different Server Certificate</h5>
<div class="paragraph">
<p>To specify that GlassFish Server should use the new keystore for authentication and authorization decisions, you must set the JVM options for GlassFish Server so that they recognize the new keystore.
To use a different keystore from the one provided for development purposes, follow these steps.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Start GlassFish Server if you haven&#8217;t already done so.
Information on starting the GlassFish Server can be found in <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>.</p>
</li>
<li>
<p>Open the GlassFish Server Administration Console in a web browser at <a href="http://localhost:4848" class="bare" target="_blank" rel="noopener">http://localhost:4848</a>.</p>
</li>
<li>
<p>Expand Configurations, then expand server-config, then click JVM Settings.</p>
</li>
<li>
<p>Click the JVM Options tab.</p>
</li>
<li>
<p>Change the following JVM options so that they point to the location and name of the new keystore.
The current settings are shown below:</p>
<div class="listingblock">
<div class="content">
<pre>-Djavax.net.ssl.keyStore=${com.sun.aas.instanceRoot}/config/keystore.jks
-Djavax.net.ssl.trustStore=${com.sun.aas.instanceRoot}/config/cacerts.jks</pre>
</div>
</div>
</li>
<li>
<p>If you&#8217;ve changed the keystore password from its default value, you need to add the password option as well:</p>
<div class="listingblock">
<div class="content">
<pre>-Djavax.net.ssl.keyStorePassword=your-new-password</pre>
</div>
</div>
</li>
<li>
<p>Click Save, then restart GlassFish Server.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="authentication-mechanisms"><a class="anchor" href="#authentication-mechanisms"></a>Authentication Mechanisms</h3>
<div class="paragraph">
<p>This section discusses the client authentication and mutual authentication mechanisms.</p>
</div>
<div class="sect3">
<h4 id="client-authentication"><a class="anchor" href="#client-authentication"></a>Client Authentication</h4>
<div class="paragraph">
<p>With client authentication, the web server authenticates the client by using the client&#8217;s public key certificate.
Client authentication is a more secure method of authentication than either basic or form-based authentication.
It uses HTTP over SSL (HTTPS), in which the server authenticates the client using the client&#8217;s public key certificate.
SSL technology provides data encryption, server authentication, message integrity, and optional client authentication for a TCP/IP connection.
You can think of a public key certificate as the digital equivalent of a passport.
The certificate is issued by a trusted organization, a certificate authority (CA), and provides identification for the bearer.</p>
</div>
<div class="paragraph">
<p>Before using client authentication, make sure that the client has a valid public key certificate.
For more information on creating and using public key certificates, read <a href="#working-with-digital-certificates">Working with Digital Certificates</a>.</p>
</div>
<div class="paragraph">
<p>The following example shows how to declare client authentication in your deployment descriptor:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;login-config&gt;</span>
    <span class="tag">&lt;auth-method&gt;</span>CLIENT-CERT<span class="tag">&lt;/auth-method&gt;</span>
<span class="tag">&lt;/login-config&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Jakarta Security provides an alternative means to configure client authentication using the <code>HttpAuthenticationMechanism</code> interface.
This interface defines an SPI for writing authentication mechanisms that can be provided with an application and deployed using CDI.
See <a href="#overview-of-the-http-authentication-mechanism-interface">Overview of the HTTP Authentication Mechanism Interface</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="mutual-authentication"><a class="anchor" href="#mutual-authentication"></a>Mutual Authentication</h4>
<div class="paragraph">
<p>With mutual authentication, the server and the client authenticate each other.
Mutual authentication is of two types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Certificate-based (see <a href="#certificate-based-mutual-authentication">Figure 54-1</a>)</p>
</li>
<li>
<p>User name/password-based (see <a href="#username-password-based-mutual-authentication">Figure 54-2</a>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When using certificate-based mutual authentication, the following actions occur.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A client requests access to a protected resource.</p>
</li>
<li>
<p>The web server presents its certificate to the client.</p>
</li>
<li>
<p>The client verifies the server&#8217;s certificate.</p>
</li>
<li>
<p>If successful, the client sends its certificate to the server.</p>
</li>
<li>
<p>The server verifies the client&#8217;s credentials.</p>
</li>
<li>
<p>If successful, the server grants access to the protected resource requested by the client.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><a href="#certificate-based-mutual-authentication">Figure 54-1</a> shows what occurs during certificate-based mutual authentication.</p>
</div>
<div id="certificate-based-mutual-authentication" class="imageblock">
<div class="content">
<img src="images/jakartaeett_dt_048.svg" alt="Diagram of six steps in mutual authentication with certificates">
</div>
<div class="title">Figure 54-1 Certificate-Based Mutual Authentication</div>
</div>
<div class="paragraph">
<p>In user name/password-based mutual authentication, the following actions occur.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A client requests access to a protected resource.</p>
</li>
<li>
<p>The web server presents its certificate to the client.</p>
</li>
<li>
<p>The client verifies the server&#8217;s certificate.</p>
</li>
<li>
<p>If successful, the client sends its user name and password to the server.</p>
</li>
<li>
<p>The server verifies the client&#8217;s credentials</p>
</li>
<li>
<p>If the verification is successful, the server grants access to the protected resource requested by the client.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><a href="#username-password-based-mutual-authentication">Figure 54-2</a> shows what occurs during user name/password-based mutual authentication.</p>
</div>
<div id="username-password-based-mutual-authentication" class="imageblock">
<div class="content">
<img src="images/jakartaeett_dt_049.svg" alt="Diagram of five steps in mutual authentication with user name and password">
</div>
<div class="title">Figure 54-2 User Name/Password-Based Mutual Authentication</div>
</div>
<div class="sect4">
<h5 id="enabling-mutual-authentication-over-ssl"><a class="anchor" href="#enabling-mutual-authentication-over-ssl"></a>Enabling Mutual Authentication over SSL</h5>
<div class="paragraph">
<p>This section discusses setting up client-side authentication.
Enabling both server-side and client-side authentication is called mutual, or two-way, authentication.
In client authentication, clients are required to submit certificates issued by a certificate authority that you choose to accept.</p>
</div>
<div class="paragraph">
<p>There are at least two ways to enable mutual authentication over SSL.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The preferred method is to set the method of authentication in the <code>web.xml</code> application deployment descriptor to <code>CLIENT-CERT</code>.
This enforces mutual authentication by modifying the deployment descriptor of the given application.
In this way, client authentication is enabled only for a specific resource controlled by the security constraint, and the check is performed only when the application requires client authentication.</p>
</li>
<li>
<p>A less commonly used method is to set the <code>clientAuth</code> property in the <code>certificate</code> realm to <code>true</code> if you want the SSL stack to require a valid certificate chain from the client before accepting a connection.
A <code>false</code> value (which is the default) will not require a certificate chain unless the client requests a resource protected by a security constraint that uses <code>CLIENT-CERT</code> authentication.
When you enable client authentication by setting the <code>clientAuth</code> property to <code>true</code>, client authentication will be required for all the requests going through the specified SSL port.
If you turn <code>clientAuth</code> on, it is on all of the time, which can severely degrade performance.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When client authentication is enabled in both of these ways, client authentication will be performed twice.</p>
</div>
</div>
<div class="sect4">
<h5 id="creating-a-client-certificate-for-mutual-authentication"><a class="anchor" href="#creating-a-client-certificate-for-mutual-authentication"></a>Creating a Client Certificate for Mutual Authentication</h5>
<div class="paragraph">
<p>If you have a certificate signed by a trusted Certificate Authority (CA) such as Verisign, and the GlassFish Server <code>cacerts.jks</code> file already contains a certificate verified by that CA, you do not need to complete this step.
You need to install your certificate in the GlassFish Server certificate file only when your certificate is self-signed.</p>
</div>
<div class="paragraph">
<p>From the directory where you want to create the client certificate, run <code>keytool</code> as outlined here.
When you press Enter, <code>keytool</code> prompts you to enter the server name, organizational unit, organization, locality, state, and country code.</p>
</div>
<div class="paragraph">
<p>You must enter the server name in response to <code>keytool</code>'s first prompt, in which it asks for first and last names.
For testing purposes, this can be <code>localhost</code>.
If this example is to verify mutual authentication and you receive a runtime error stating that the HTTPS host name is wrong, re-create the client certificate, being sure to use the same host name you will use when running the example.
For example, if your machine name is <code>duke</code>, then enter <code>duke</code> as the certificate CN or when prompted for first and last names.
When accessing the application, enter a URL that points to the same location (for example, <code>https://duke:8181/mutualauth/hello</code>).
This is necessary because during SSL handshake, the server verifies the client certificate by comparing the certificate name to the host name from which it originates.</p>
</div>
<div class="paragraph">
<p>To create a keystore named <code>client_keystore.jks</code> that contains a client certificate named <code>client.cer</code>, follow these steps.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a backup copy of the server truststore file.
To do this,</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Change to the directory containing the server&#8217;s keystore and truststore files, <code><em>domain-dir</em>\config</code>.</p>
</li>
<li>
<p>Copy <code>cacerts.jks</code> to <code>cacerts.backup.jks</code>.</p>
</li>
<li>
<p>Copy <code>keystore.jks</code> to <code>keystore.backup.jks</code>.</p>
<div class="paragraph">
<p>Do not put client certificates in the <code>cacerts.jks</code> file.
Any certificate you add to the <code>cacerts</code> file effectively can be a trusted root for any and all certificate chains.
After you have completed development, delete the development version of the <code>cacerts</code> file and replace it with the original copy.</p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Generate the client certificate.
Enter the following command from the directory where you want to generate the client certificate:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">java-home/bin/keytool -genkey -alias client-alias -keyalg RSA -keypass changeit -storepass changeit -keystore client_keystore.jks</code></pre>
</div>
</div>
</li>
<li>
<p>Export the generated client certificate into the file <code>client.cer</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">java-home/bin/keytool -export -alias client-alias -storepass changeit -file client.cer -keystore client_keystore.jks</code></pre>
</div>
</div>
</li>
<li>
<p>Add the certificate to the truststore file <code><em>domain-dir</em>/config/cacerts.jks</code>.
Run <code>keytool</code> from the directory where you created the keystore and client certificate.
Use the following parameters:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">java-home/bin/keytool -import -v -trustcacerts -alias client-alias
-file client.cer -keystore domain-dir/config/cacerts.jks
-keypass changeit -storepass changeit</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>keytool</code> utility returns a message like this one:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Owner: CN=localhost, OU=My Company, O=Software, L=Santa Clara, ST=CA, C=US
Issuer: CN=localhost, OU=My Company, O=Software, L=Santa Clara, ST=CA, C=US
Serial number: 3e39e66a
Valid from: Tue Nov 27 12:22:47 EST 2012 until: Mon Feb 25 12:22:47 EST 2013
Certificate fingerprints:
    MD5: 5A:B0:4C:88:4E:F8:EF:E9:E5:8B:53:BD:D0:AA:8E:5A
    SHA1:90:00:36:5B:E0:A7:A2:BD:67:DB:EA:37:B9:61:3E:26:B3:89:46:32
    Signature algorithm name: SHA1withRSA
    Version: 3
Trust this certificate? [no]: yes
Certificate was added to keystore
[Storing cacerts.jks]</pre>
</div>
</div>
</li>
<li>
<p>Restart GlassFish Server.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-the-jdbc-realm-for-user-authentication"><a class="anchor" href="#using-the-jdbc-realm-for-user-authentication"></a>Using the JDBC Realm for User Authentication</h3>
<div class="paragraph">
<p>An authentication realm, sometimes called a security policy domain or security domain, is a scope over which an application server defines and enforces a common security policy.
A realm contains a collection of users, who may or may not be assigned to a group.
GlassFish Server comes preconfigured with the file, certificate, and administration realms.
An administrator can also set up LDAP, JDBC, digest, or custom realms.</p>
</div>
<div class="paragraph">
<p>An application can specify in its deployment descriptor which realm to use.
If the application does not specify a realm, GlassFish Server uses its default realm, the <code>file</code> realm.
If an application specifies that a JDBC realm is to be used for user authentication, GlassFish Server will retrieve user credentials from a database.
The application server uses the database information and the enabled JDBC realm option in the configuration file.</p>
</div>
<div class="paragraph">
<p>A database provides an easy way to add, edit, or delete users at runtime and enables users to create their own accounts without any administrative assistance.
Using a database has an additional benefit: providing a place to securely store any extra user information.
A realm can be thought of as a database of user names and passwords that identify valid users of a web application or set of web applications with an enumeration of the list of roles associated with each valid user.
Access to specific web application resources is granted to all users in a particular role, instead of enumerating a list of associated users.
A user name can have any number of roles associated with it.</p>
</div>
<div class="paragraph">
<p>Two of the tutorial case studies, <a href="#dukes-tutoring-case-study-example">Chapter 62, <em>Duke&#8217;s Tutoring Case Study Example</em></a> and <a href="#dukes-forest-case-study-example">Chapter 63, <em>Duke&#8217;s Forest Case Study Example</em></a> use a JDBC realm for user authentication.</p>
</div>
<div class="sect3">
<h4 id="to-configure-a-jdbc-authentication-realm"><a class="anchor" href="#to-configure-a-jdbc-authentication-realm"></a>To Configure a JDBC Authentication Realm</h4>
<div class="paragraph">
<p>GlassFish Server enables administrators to specify a user&#8217;s credentials (user name and password) in the JDBC realm instead of in the connection pool.
This prevents other applications from browsing the database tables for user credentials.
By default, storing passwords as clear text is not supported in the JDBC realm.
Under normal circumstances, passwords should not be stored as clear text.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create the database tables in which user credentials for the realm will be stored.</p>
</li>
<li>
<p>Add user credentials to the database tables you created.</p>
</li>
<li>
<p>Create a JDBC connection pool for the database.</p>
<div class="paragraph">
<p>You can use the Administration Console or the command line to create a connection pool.</p>
</div>
</li>
<li>
<p>Create a JDBC resource for the database.</p>
<div class="paragraph">
<p>You can use the Administration Console or the command line to create a JDBC resource.</p>
</div>
</li>
<li>
<p>Create a realm.</p>
<div class="paragraph">
<p>This step needs to associate the resource with the realm, define the tables and columns for users and groups used for authentication, and define the digest algorithm that will be used for storing passwords in the database.</p>
</div>
<div class="paragraph">
<p>You can use the Administration Console or the command line to create a realm.</p>
</div>
</li>
<li>
<p>Modify the deployment descriptor for your application to specify the
JDBC realm.</p>
<div class="ulist">
<ul>
<li>
<p>For an enterprise application in an EAR file, modify the <code>glassfish-application.xml</code> file.</p>
</li>
<li>
<p>For a web application in a WAR file, modify the <code>web.xml</code> file.</p>
</li>
<li>
<p>For an enterprise bean in an EJB JAR file, modify the <code>glassfish-ejb-jar.xml</code> file.</p>
<div class="paragraph">
<p>For example, for a hypothetical application, the <code>web.xml</code> file could specify the <code>jdbcRealm</code> realm, as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;login-config&gt;</span>
    <span class="tag">&lt;auth-method&gt;</span>FORM<span class="tag">&lt;/auth-method&gt;</span>
    <span class="tag">&lt;realm-name&gt;</span>jdbcRealm<span class="tag">&lt;/realm-name&gt;</span>
    <span class="tag">&lt;form-login-config&gt;</span>
        <span class="tag">&lt;form-login-page&gt;</span>/login.xhtml<span class="tag">&lt;/form-login-page&gt;</span>
        <span class="tag">&lt;form-error-page&gt;</span>/login.xhtml<span class="tag">&lt;/form-error-page&gt;</span>
    <span class="tag">&lt;/form-login-config&gt;</span>
<span class="tag">&lt;/login-config&gt;</span>
<span class="tag">&lt;security-constraint&gt;</span>
    <span class="tag">&lt;web-resource-collection&gt;</span>
        <span class="tag">&lt;web-resource-name&gt;</span>Secure Pages<span class="tag">&lt;/web-resource-name&gt;</span>
        <span class="tag">&lt;description</span><span class="tag">/&gt;</span>
        <span class="tag">&lt;url-pattern&gt;</span>/admin/*<span class="tag">&lt;/url-pattern&gt;</span>
    <span class="tag">&lt;/web-resource-collection&gt;</span>
    <span class="tag">&lt;auth-constraint&gt;</span>
        <span class="tag">&lt;role-name&gt;</span>ADMINS<span class="tag">&lt;/role-name&gt;</span>
    <span class="tag">&lt;/auth-constraint&gt;</span>
<span class="tag">&lt;/security-constraint&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Form-based login is specified for all web pages under <code>/admin</code>.
Access to those pages will be allowed only to users in the <code>ADMINS</code> role.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Assign security roles to users or groups of users in the realm.</p>
<div class="paragraph">
<p>To assign a security role to a group or to a user, add a <code>security-role-mapping</code> element to the application server-specific deployment descriptor, in this case <code>glassfish-web.xml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;security-role-mapping&gt;</span>
    <span class="tag">&lt;role-name&gt;</span>USERS<span class="tag">&lt;/role-name&gt;</span>
    <span class="tag">&lt;group-name&gt;</span>USERS<span class="tag">&lt;/group-name&gt;</span>
<span class="tag">&lt;/security-role-mapping&gt;</span>
<span class="tag">&lt;security-role-mapping&gt;</span>
    <span class="tag">&lt;role-name&gt;</span>ADMINS<span class="tag">&lt;/role-name&gt;</span>
    <span class="tag">&lt;group-name&gt;</span>ADMINS<span class="tag">&lt;/group-name&gt;</span>
<span class="tag">&lt;/security-role-mapping&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Since GlassFish Server users are assigned to groups during the user creation process, this is more efficient than mapping security roles to individual users.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="securing-http-resources"><a class="anchor" href="#securing-http-resources"></a>Securing HTTP Resources</h3>
<div class="paragraph">
<p>When a request URI is matched by multiple constrained URL patterns, the constraints that apply to the request are those that are associated with the best matching URL pattern.
The servlet matching rules defined in Chapter 12, "Mapping Requests To Servlets" in the Jakarta Servlet 5.0 Specification, are used to determine the best matching URL pattern to the request URI.
No protection requirements apply to a request URI that is not matched by a constrained URL pattern.
The HTTP method of the request plays no role in selecting the best matching URL pattern for a request.</p>
</div>
<div class="paragraph">
<p>When HTTP methods are listed within a constraint definition, the protections defined by the constraint are applied to the listed methods only.</p>
</div>
<div class="paragraph">
<p>When HTTP methods are not listed within a constraint definition, the protections defined by the constraint apply to the complete set of HTTP methods, including HTTP extension methods.</p>
</div>
<div class="paragraph">
<p>When constraints with different protection requirements apply to the same combination of URL patterns and HTTP methods, the rules for combining the protection requirements are as defined in Section 13.8.1, "Combining Constraints" in the Jakarta Servlet 5.0 Specification.</p>
</div>
<div class="paragraph">
<p>Follow these guidelines to properly secure a web application.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Do not list HTTP methods within constraint definitions.
This is the simplest way to ensure that you are not leaving HTTP methods unprotected.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="comment">&lt;!-- SECURITY CONSTRAINT #1 --&gt;</span>
<span class="tag">&lt;security-constraint&gt;</span>
    <span class="tag">&lt;display-name&gt;</span>Do not enumerate Http Methods<span class="tag">&lt;/display-name&gt;</span>
    <span class="tag">&lt;web-resource-collection&gt;</span>
        <span class="tag">&lt;url-pattern&gt;</span>/company/*<span class="tag">&lt;/url-pattern&gt;</span>
    <span class="tag">&lt;/web-resource-collection&gt;</span>
    <span class="tag">&lt;auth-constraint&gt;</span>
        <span class="tag">&lt;role-name&gt;</span>sales<span class="tag">&lt;/role-name&gt;</span>
    <span class="tag">&lt;/auth-constraint&gt;</span>
<span class="tag">&lt;/security-constraint&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you list methods in a constraint, all non-listed methods of the effectively infinite set of possible HTTP methods, including extension methods, will be unprotected.
Use such a constraint only if you are certain that this is the protection scheme you intend to define.
The following example shows a constraint that lists the GET method and thus defines no protection on any of the other possible HTTP methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="comment">&lt;!-- SECURITY CONSTRAINT #2 --&gt;</span>
<span class="tag">&lt;security-constraint&gt;</span>
    <span class="tag">&lt;display-name&gt;</span>
        Protect GET only, leave all other methods unprotected
    <span class="tag">&lt;/display-name&gt;</span>
    <span class="tag">&lt;web-resource-collection&gt;</span>
        <span class="tag">&lt;url-pattern&gt;</span>/company/*<span class="tag">&lt;/url-pattern&gt;</span>
        <span class="tag">&lt;http-method&gt;</span>GET<span class="tag">&lt;/http-method&gt;</span>
    <span class="tag">&lt;/web-resource-collection&gt;</span>
    <span class="tag">&lt;auth-constraint&gt;</span>
        <span class="tag">&lt;role-name&gt;</span>sales<span class="tag">&lt;/role-name&gt;</span>
    <span class="tag">&lt;/auth-constraint&gt;</span>
<span class="tag">&lt;/security-constraint&gt;</span></code></pre>
</div>
</div>
</li>
<li>
<p>If you need to apply specific types of protection to specific HTTP methods, make sure that you define constraints to cover every method that you want to permit, with or without constraint, at the corresponding URL patterns.
If there are any methods that you do not want to permit, you must also create a constraint that denies access to those methods at the same patterns; for an example, see security constraint #5 in the next bullet.</p>
<div class="paragraph">
<p>For example, to permit GET and POST, where POST requires authentication and GET is permitted without constraint, you could define the following constraints:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="comment">&lt;!-- SECURITY CONSTRAINT #3 --&gt;</span>
<span class="tag">&lt;security-constraint&gt;</span>
    <span class="tag">&lt;display-name&gt;</span>Allow unprotected GET<span class="tag">&lt;/display-name&gt;</span>
    <span class="tag">&lt;web-resource-collection&gt;</span>
        <span class="tag">&lt;url-pattern&gt;</span>/company/*<span class="tag">&lt;/url-pattern&gt;</span>
        <span class="tag">&lt;http-method&gt;</span>GET<span class="tag">&lt;/http-method&gt;</span>
    <span class="tag">&lt;/web-resource-collection&gt;</span>
<span class="tag">&lt;/security-constraint&gt;</span>

<span class="comment">&lt;!-- SECURITY CONSTRAINT #4 --&gt;</span>
<span class="tag">&lt;security-constraint&gt;</span>
    <span class="tag">&lt;display-name&gt;</span>Require authentication for POST<span class="tag">&lt;/display-name&gt;</span>
    <span class="tag">&lt;web-resource-collection&gt;</span>
        <span class="tag">&lt;url-pattern&gt;</span>/company/*<span class="tag">&lt;/url-pattern&gt;</span>
        <span class="tag">&lt;http-method&gt;</span>POST<span class="tag">&lt;/http-method&gt;</span>
    <span class="tag">&lt;/web-resource-collection&gt;</span>
    <span class="tag">&lt;auth-constraint&gt;</span>
        <span class="tag">&lt;role-name&gt;</span>sales<span class="tag">&lt;/role-name&gt;</span>
    <span class="tag">&lt;/auth-constraint&gt;</span>
<span class="tag">&lt;/security-constraint&gt;</span></code></pre>
</div>
</div>
</li>
<li>
<p>The simplest way to ensure that you deny all HTTP methods except those that you want to be permitted is to use <code>http-method-omission</code> elements to omit those HTTP methods from the security constraint, and also to define an <code>auth-constraint</code> that names no roles.
The security constraint will apply to all methods except those that were named in the omissions, and the constraint will apply only to the resources matched by the patterns in the constraint.</p>
<div class="paragraph">
<p>For example, the following constraint excludes access to all methods except GET and POST at the resources matched by the pattern <code>/company/*</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="comment">&lt;!-- SECURITY CONSTRAINT #5 --&gt;</span>
<span class="tag">&lt;security-constraint&gt;</span>
    <span class="tag">&lt;display-name&gt;</span>Deny all HTTP methods except GET and POST<span class="tag">&lt;/display-name&gt;</span>
    <span class="tag">&lt;web-resource-collection&gt;</span>
        <span class="tag">&lt;url-pattern&gt;</span>/company/*<span class="tag">&lt;/url-pattern&gt;</span>
        <span class="tag">&lt;http-method-omission&gt;</span>GET<span class="tag">&lt;/http-method-omission&gt;</span>
        <span class="tag">&lt;http-method-omission&gt;</span>POST<span class="tag">&lt;/http-method-omission&gt;</span>
    <span class="tag">&lt;/web-resource-collection&gt;</span>
    <span class="tag">&lt;auth-constraint</span><span class="tag">/&gt;</span>
<span class="tag">&lt;/security-constraint&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want to extend these exclusions to the unconstrained parts of your application, also include the URL pattern <code>/</code> (forward slash):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="comment">&lt;!-- SECURITY CONSTRAINT #6 --&gt;</span>
<span class="tag">&lt;security-constraint&gt;</span>
    <span class="tag">&lt;display-name&gt;</span>Deny all HTTP methods except GET and POST<span class="tag">&lt;/display-name&gt;</span>
    <span class="tag">&lt;web-resource-collection&gt;</span>
        <span class="tag">&lt;url-pattern&gt;</span>/company/*<span class="tag">&lt;/url-pattern&gt;</span>
        <span class="tag">&lt;url-pattern&gt;</span>/<span class="tag">&lt;/url-pattern&gt;</span>
        <span class="tag">&lt;http-method-omission&gt;</span>GET<span class="tag">&lt;/http-method-omission&gt;</span>
        <span class="tag">&lt;http-method-omission&gt;</span>POST<span class="tag">&lt;/http-method-omission&gt;</span>
    <span class="tag">&lt;/web-resource-collection&gt;</span>
    <span class="tag">&lt;auth-constraint</span><span class="tag">/&gt;</span>
<span class="tag">&lt;/security-constraint&gt;</span></code></pre>
</div>
</div>
</li>
<li>
<p>If, for your web application, you do not want any resource to be accessible unless you explicitly define a constraint that permits access to it, you can define an <code>auth-constraint</code> that names no roles and associate it with the URL pattern <code>/</code>.
The URL pattern <code>/</code> is the weakest matching pattern.
Do not list any HTTP methods in this constraint:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="comment">&lt;!-- SECURITY CONSTRAINT #7 --&gt;</span>
<span class="tag">&lt;security-constraint&gt;</span>
    <span class="tag">&lt;display-name&gt;</span>
        Switch from Constraint to Permission model
        (where everything is denied by default)
    <span class="tag">&lt;/display-name&gt;</span>
    <span class="tag">&lt;web-resource-collection&gt;</span>
        <span class="tag">&lt;url-pattern&gt;</span>/<span class="tag">&lt;/url-pattern&gt;</span>
    <span class="tag">&lt;/web-resource-collection&gt;</span>
    <span class="tag">&lt;auth-constraint</span><span class="tag">/&gt;</span>
<span class="tag">&lt;/security-constraint&gt;</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="securing-application-clients"><a class="anchor" href="#securing-application-clients"></a>Securing Application Clients</h3>
<div class="paragraph">
<p>The Jakarta EE authentication requirements for application clients are the same as for other Jakarta EE components, and the same authentication techniques can be used as for other Jakarta EE application components.
No authentication is necessary when accessing unprotected web resources.</p>
</div>
<div class="paragraph">
<p>When accessing protected web resources, the usual varieties of authentication can be used: HTTP basic authentication, HTTP login-form authentication, or SSL client authentication.
<a href="#specifying-an-authentication-mechanism-in-the-deployment-descriptor">Specifying an Authentication Mechanism in the Deployment Descriptor</a> describes how to specify HTTP basic authentication and HTTP login-form authentication.
<a href="#client-authentication">Client Authentication</a> describes how to specify SSL client authentication.</p>
</div>
<div class="paragraph">
<p>Authentication is required when accessing protected enterprise beans.
The authentication mechanisms for enterprise beans are discussed in <a href="#securing-enterprise-beans">Securing Enterprise Beans</a>.</p>
</div>
<div class="paragraph">
<p>An application client makes use of an authentication service provided by the application client container for authenticating its users.
The container&#8217;s service can be integrated with the native platform&#8217;s authentication system so that a single sign-on capability is used.
The container can authenticate the user either when the application is started or when a protected resource is accessed.</p>
</div>
<div class="paragraph">
<p>An application client can provide a class, called a login module, to gather authentication data.
If so, the <code>jakarta.security.auth.callback.CallbackHandler</code> interface must be implemented, and the class name must be specified in its deployment descriptor.
The application&#8217;s callback handler must fully support <code>Callback</code> objects specified in the <code>jakarta.security.auth.callback</code> package.</p>
</div>
<div class="sect3">
<h4 id="using-login-modules"><a class="anchor" href="#using-login-modules"></a>Using Login Modules</h4>
<div class="paragraph">
<p>An application client can use the Java Authentication and Authorization Service (JAAS) to create login modules for authentication.
A JAAS-based application implements the <code>jakarta.security.auth.callback.CallbackHandler</code> interface so that it can interact with users to enter specific authentication data, such as user names or passwords, or to display error and warning messages.</p>
</div>
<div class="paragraph">
<p>Applications implement the <code>CallbackHandler</code> interface and pass it to the login context, which forwards it directly to the underlying login modules.
A login module uses the callback handler both to gather input, such as a password or smart card PIN, from users and to supply information, such as status information, to users.
Because the application specifies the callback handler, an underlying login module can remain independent of the various ways applications interact with users.</p>
</div>
<div class="paragraph">
<p>For example, the implementation of a callback handler for a GUI application might display a window to solicit user input, or the implementation of a callback handler for a command-line tool might simply prompt the user for input directly from the command line.</p>
</div>
<div class="paragraph">
<p>The login module passes an array of appropriate callbacks to the callback handler&#8217;s <code>handle</code> method, such as a <code>NameCallback</code> for the user name and a <code>PasswordCallback</code> for the password; the callback handler performs the requested user interaction and sets appropriate values in the callbacks.
For example, to process a <code>NameCallback</code>, the <code>CallbackHandler</code> might prompt for a name, retrieve the value from the user, and call the <code>setName</code> method of the <code>NameCallback</code> to store the name.</p>
</div>
<div class="paragraph">
<p>For more information on using JAAS for authentication in login modules, refer to the documentation listed in <a href="#further-information-about-advanced-security-topics">Further Information about Advanced Security Topics</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="using-programmatic-login"><a class="anchor" href="#using-programmatic-login"></a>Using Programmatic Login</h4>
<div class="paragraph">
<p>Programmatic login enables the client code to supply user credentials.
If you are using an enterprise bean client, you can use the <code>com.sun.appserv.security.ProgrammaticLogin</code> class with its convenient <code>login</code> and <code>logout</code> methods.
Programmatic login is specific to a server.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="securing-enterprise-information-systems-applications"><a class="anchor" href="#securing-enterprise-information-systems-applications"></a>Securing Enterprise Information Systems Applications</h3>
<div class="paragraph">
<p>In Enterprise Information Systems (EIS) applications, components request a connection to an EIS resource.</p>
</div>
<div class="sect3">
<h4 id="overview-of-securing-enterprise-information-systems-applications"><a class="anchor" href="#overview-of-securing-enterprise-information-systems-applications"></a>Overview of Securing Enterprise Information Systems Applications</h4>
<div class="paragraph">
<p>As part of this connection, the EIS can require a sign-on for the requester to access the resource.
The application component provider has two choices for the design of the EIS sign-on.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Container-managed sign-on: The application component lets the container take the responsibility of configuring and managing the EIS sign-on.
The container determines the user name and password for establishing a connection to an EIS instance.</p>
</li>
<li>
<p>Component-managed sign-on: The application component code manages EIS sign-on by including code that performs the sign-on process to an EIS.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can also configure security for resource adapters.
See <a href="#configuring-resource-adapter-security">Configuring Resource Adapter Security</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="container-managed-sign-on"><a class="anchor" href="#container-managed-sign-on"></a>Container-Managed Sign-On</h4>
<div class="paragraph">
<p>In container-managed sign-on, an application component does not have to pass any sign-on security information to the <code>getConnection()</code> method.
The security information is supplied by the container, as shown in the following example (the method call is highlighted in bold):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// Business method in an application component</span>
<span class="predefined-type">Context</span> initctx = <span class="keyword">new</span> <span class="predefined-type">InitialContext</span>();
<span class="comment">// Perform JNDI lookup to obtain a connection factory</span>
jakarta.resource.cci.ConnectionFactory cxf =
    (jakarta.resource.cci.ConnectionFactory)initctx.lookup(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">java:comp/env/eis/MainframeCxFactory</span><span class="delimiter">&quot;</span></span>);
<span class="comment">// Invoke factory to obtain a connection. The security</span>
<span class="comment">// information is not passed in the getConnection method</span>
jakarta.resource.cci.Connection cx = cxf.getConnection();
...</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="component-managed-sign-on"><a class="anchor" href="#component-managed-sign-on"></a>Component-Managed Sign-On</h4>
<div class="paragraph">
<p>In component-managed sign-on, an application component is responsible for passing the needed sign-on security information for the resource to the <code>getConnection</code> method.
For example, security information might be a user name and password, as shown here (the method call is highlighted in bold):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// Method in an application component</span>
<span class="predefined-type">Context</span> initctx = <span class="keyword">new</span> <span class="predefined-type">InitialContext</span>();

<span class="comment">// Perform JNDI lookup to obtain a connection factory</span>
jakarta.resource.cci.ConnectionFactory cxf =
    (jakarta.resource.cci.ConnectionFactory)initctx.lookup(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">java:comp/env/eis/MainframeCxFactory</span><span class="delimiter">&quot;</span></span>);

<span class="comment">// Get a new ConnectionSpec</span>
com.myeis.ConnectionSpecImpl properties = <span class="comment">//..</span>

<span class="comment">// Invoke factory to obtain a connection</span>
properties.setUserName(<span class="string"><span class="delimiter">&quot;</span><span class="content">...</span><span class="delimiter">&quot;</span></span>);
properties.setPassword(<span class="string"><span class="delimiter">&quot;</span><span class="content">...</span><span class="delimiter">&quot;</span></span>);
jakarta.resource.cci.Connection cx =
    cxf.getConnection(properties);
...</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configuring-resource-adapter-security"><a class="anchor" href="#configuring-resource-adapter-security"></a>Configuring Resource Adapter Security</h4>
<div class="paragraph">
<p>A resource adapter is a system-level software component that typically implements network connectivity to an external resource manager.
A resource adapter can extend the functionality of the Jakarta EE platform either by implementing one of the Jakarta EE standard service APIs, such as a JDBC driver, or by defining and implementing a resource adapter for a connector to an external application system.
Resource adapters can also provide services that are entirely local, perhaps interacting with native resources.
Resource adapters interface with the Jakarta EE platform through the Jakarta EE service provider interfaces (Jakarta EE SPI).
A resource adapter that uses the Jakarta EE SPIs to attach to the Jakarta EE platform will be able to work with all Jakarta EE products.</p>
</div>
<div class="paragraph">
<p>To configure the security settings for a resource adapter, you need to edit the resource adapter descriptor file, <code>ra.xml</code>.
Here is an example of the part of an <code>ra.xml</code> file that configures security properties for a resource adapter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;authentication-mechanism&gt;</span>
    <span class="tag">&lt;authentication-mechanism-type&gt;</span>
        BasicPassword
    <span class="tag">&lt;/authentication-mechanism-type&gt;</span>
    <span class="tag">&lt;credential-interface&gt;</span>
        jakarta.resource.spi.security.PasswordCredential
    <span class="tag">&lt;/credential-interface&gt;</span>
<span class="tag">&lt;/authentication-mechanism&gt;</span>
<span class="tag">&lt;reauthentication-support&gt;</span>false<span class="tag">&lt;/reauthentication-support&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can find out more about the options for configuring resource adapter security by reviewing <code><em>as-install</em>/lib/schemas/connector_2_0.xsd</code>.
You can configure the following elements in the resource adapter deployment descriptor file.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Authentication mechanisms: Use the <code>authentication-mechanism</code> element to specify an authentication mechanism supported by the resource adapter.
This support is for the resource adapter, not for the underlying EIS instance.</p>
<div class="paragraph">
<p>There are two supported mechanism types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>BasicPassword</code>, which supports the following interface:</p>
<div class="listingblock">
<div class="content">
<pre>jakarta.resource.spi.security.PasswordCredential</pre>
</div>
</div>
</li>
<li>
<p><code>Kerbv5</code>, which supports the following interface:</p>
<div class="listingblock">
<div class="content">
<pre>jakarta.resource.spi.security.GenericCredential</pre>
</div>
</div>
<div class="paragraph">
<p>GlassFish Server does not currently support this mechanism type.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Reauthentication support: Use the <code>reauthentication-support</code> element to specify whether the resource adapter implementation supports reauthentication of existing <code>Managed-Connection</code> instances.
Options are <code>true</code> or <code>false</code>.</p>
</li>
<li>
<p>Security permissions: Use the <code>security-permission</code> element to specify a security permission that is required by the resource adapter code.
Support for security permissions is optional and is not supported in the current release of GlassFish Server.
You can, however, manually update the <code>server.policy</code> file to add the relevant permissions for the resource adapter.</p>
<div class="paragraph">
<p>The security permissions listed in the deployment descriptor are different from those required by the default permission set as specified in the connector specification.</p>
</div>
<div class="paragraph">
<p>For more information on the implementation of the security permission specification, see the security policy file documentation listed in <a href="#further-information-about-advanced-security-topics">Further Information about Advanced Security Topics</a>.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>In addition to specifying resource adapter security in the <code>ra.xml</code> file, you can create a security map for a connector connection pool to map an application principal or a user group to a back-end EIS principal.
The security map is usually used if one or more EIS back-end principals are used to execute operations (on the EIS) initiated by various principals or user groups in the application.</p>
</div>
</div>
<div class="sect3">
<h4 id="mapping-an-application-principal-to-eis-principals"><a class="anchor" href="#mapping-an-application-principal-to-eis-principals"></a>Mapping an Application Principal to EIS Principals</h4>
<div class="paragraph">
<p>When using GlassFish Server, you can use security maps to map the caller identity of the application (principal or user group) to a suitable EIS principal in container-managed transaction-based scenarios.
When an application principal initiates a request to an EIS, GlassFish Server first checks for an exact principal by using the security map defined for the connector connection pool to determine the mapped back-end EIS principal.
If there is no exact match, GlassFish Server uses the wildcard character specification, if any, to determine the mapped back-end EIS principal.
Security maps are used when an application user needs to execute an EIS operation that requires execution as a specific identity in the EIS.</p>
</div>
<div class="paragraph">
<p>To work with security maps, use the Administration Console.
From the Administration Console, follow these steps to get to the security maps page.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the navigation tree, expand the Resources node.</p>
</li>
<li>
<p>Expand the Connectors node.</p>
</li>
<li>
<p>Select the Connector Connection Pools node.</p>
</li>
<li>
<p>On the Connector Connection Pools page, click the name of the connection pool for which you want to create a security map.</p>
</li>
<li>
<p>Click the Security Maps tab.</p>
</li>
<li>
<p>Click New to create a new security map for the connection pool.</p>
</li>
<li>
<p>Enter a name by which you will refer to the security map, as well as the other required information.</p>
<div class="paragraph">
<p>Click Help for more information on the individual options.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-security-using-deployment-descriptors"><a class="anchor" href="#configuring-security-using-deployment-descriptors"></a>Configuring Security Using Deployment Descriptors</h3>
<div class="paragraph">
<p>The recommended way to configure security in the Jakarta EE 8 platform is with annotations.
If you wish to override the security settings at deployment time, you can use security elements in the <code>web.xml</code> deployment descriptor to do so.
This section describes how to use the deployment descriptor to specify basic authentication and to override default principal-to-role mapping.</p>
</div>
<div class="sect3">
<h4 id="specifying-security-for-basic-authentication-in-the-deployment-descriptor"><a class="anchor" href="#specifying-security-for-basic-authentication-in-the-deployment-descriptor"></a>Specifying Security for Basic Authentication in the Deployment Descriptor</h4>
<div class="paragraph">
<p>The elements of the deployment descriptor that add basic authentication to an example tell the server or browser to perform the following tasks.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Send a standard login dialog box to collect user name and password data.</p>
</li>
<li>
<p>Verify that the user is authorized to access the application.</p>
</li>
<li>
<p>If authorized, display the servlet to the user.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following sample code shows the security elements for a deployment descriptor that could be used in the example of basic authentication found in the <code><em>tut-install</em>/examples/security/hello2_basicauth/</code> directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">    <span class="tag">&lt;security-constraint&gt;</span>
        <span class="tag">&lt;display-name&gt;</span>SecurityConstraint<span class="tag">&lt;/display-name&gt;</span>
        <span class="tag">&lt;web-resource-collection&gt;</span>
             <span class="tag">&lt;web-resource-name&gt;</span>WRCollection<span class="tag">&lt;/web-resource-name&gt;</span>
            <span class="tag">&lt;url-pattern&gt;</span>/greeting<span class="tag">&lt;/url-pattern&gt;</span>
        <span class="tag">&lt;/web-resource-collection&gt;</span>
        <span class="tag">&lt;auth-constraint&gt;</span>
            <span class="tag">&lt;role-name&gt;</span>TutorialUser<span class="tag">&lt;/role-name&gt;</span>
        <span class="tag">&lt;/auth-constraint&gt;</span>
        <span class="tag">&lt;user-data-constraint&gt;</span>
             <span class="tag">&lt;transport-guarantee&gt;</span>CONFIDENTIAL<span class="tag">&lt;/transport-guarantee&gt;</span>
        <span class="tag">&lt;/user-data-constraint&gt;</span>
    <span class="tag">&lt;/security-constraint&gt;</span>
    <span class="tag">&lt;login-config&gt;</span>
        <span class="tag">&lt;auth-method&gt;</span>BASIC<span class="tag">&lt;/auth-method&gt;</span>
        <span class="tag">&lt;realm-name&gt;</span>file<span class="tag">&lt;/realm-name&gt;</span>
    <span class="tag">&lt;/login-config&gt;</span>
    <span class="tag">&lt;security-role&gt;</span>
        <span class="tag">&lt;role-name&gt;</span>TutorialUser<span class="tag">&lt;/role-name&gt;</span>
    <span class="tag">&lt;/security-role&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This deployment descriptor specifies that the request URI <code>/greeting</code> can be accessed only by users who have entered their user names and passwords and have been authorized to access this URL because they have been verified to be in the role <code>TutorialUser</code>.
The user name and password data will be sent over a protected transport in order to keep it from being read in transit.</p>
</div>
</div>
<div class="sect3">
<h4 id="specifying-non-default-principal-to-role-mapping-in-the-deployment-descriptor"><a class="anchor" href="#specifying-non-default-principal-to-role-mapping-in-the-deployment-descriptor"></a>Specifying Non-Default Principal-to-Role Mapping in the Deployment Descriptor</h4>
<div class="paragraph">
<p>Jakarta Security requires that group principal names be mapped to roles of the same name by default.
GlassFish adheres to this standard, by default, and provides group principal to role mapping.
Implementations of the standard can, however, provide mechanisms to configure a different default.</p>
</div>
<div class="paragraph">
<p>To map a role name permitted by the application or module to principals (users) and groups defined on the server, use the <code>security-role-mapping</code> element in the runtime deployment descriptor file (<code>glassfish-application.xml</code>, <code>glassfish-web.xml</code>, or <code>glassfish-ejb-jar.xml</code>).
The entry needs to declare a mapping between a security role used in the application and one or more groups or principals defined for the applicable realm of GlassFish Server.
An example for the <code>glassfish-web.xml</code> file is shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;glassfish-web-app&gt;</span>
    <span class="tag">&lt;security-role-mapping&gt;</span>
        <span class="tag">&lt;role-name&gt;</span>DIRECTOR<span class="tag">&lt;/role-name&gt;</span>
        <span class="tag">&lt;principal-name&gt;</span>schwartz<span class="tag">&lt;/principal-name&gt;</span>
    <span class="tag">&lt;/security-role-mapping&gt;</span>
    <span class="tag">&lt;security-role-mapping&gt;</span>
        <span class="tag">&lt;role-name&gt;</span>DEPT-ADMIN<span class="tag">&lt;/role-name&gt;</span>
        <span class="tag">&lt;group-name&gt;</span>dept-admins<span class="tag">&lt;/group-name&gt;</span>
    <span class="tag">&lt;/security-role-mapping&gt;</span>
<span class="tag">&lt;/glassfish-web-app&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The role name can be mapped to either a specific principal (user), a group, or both.
The principal or group names referenced must be valid principals or groups in the current default realm of GlassFish Server.
The <code>role-name</code> in this example must exactly match the <code>role-name</code> in the <code>security-role</code> element of the corresponding <code>web.xml</code> file or the role name defined in the <code>@DeclareRoles</code> and/or <code>@RolesAllowed</code> annotations.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="further-information-about-advanced-security-topics"><a class="anchor" href="#further-information-about-advanced-security-topics"></a>Further Information about Advanced Security Topics</h3>
<div class="paragraph">
<p>For more information about the security topics covered in this chapter, see</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Documentation on the <code>keytool</code> command:<br>
<a href="https://docs.oracle.com/javase/8/docs/technotes/tools/unix/keytool.html" class="bare" target="_blank" rel="noopener">https://docs.oracle.com/javase/8/docs/technotes/tools/unix/keytool.html</a></p>
</li>
<li>
<p>Java Authentication and Authorization Service (JAAS) Reference Guide:<br>
<a href="https://docs.oracle.com/javase/8/docs/technotes/guides/security/jaas/JAASRefGuide.html" class="bare" target="_blank" rel="noopener">https://docs.oracle.com/javase/8/docs/technotes/guides/security/jaas/JAASRefGuide.html</a></p>
</li>
<li>
<p>Java Authentication and Authorization Service (JAAS): LoginModule Developer&#8217;s Guide:<br>
<a href="https://docs.oracle.com/javase/8/docs/technotes/guides/security/jaas/JAASLMDevGuide.html" class="bare" target="_blank" rel="noopener">https://docs.oracle.com/javase/8/docs/technotes/guides/security/jaas/JAASLMDevGuide.html</a></p>
</li>
<li>
<p>Documentation on security policy file syntax:<br>
<a href="https://docs.oracle.com/javase/8/docs/technotes/guides/security/PolicyFiles.html#FileSyntax" class="bare" target="_blank" rel="noopener">https://docs.oracle.com/javase/8/docs/technotes/guides/security/PolicyFiles.html#FileSyntax</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<h1 id="jakarta-ee-supporting-technologies" class="sect0"><a class="anchor" href="#jakarta-ee-supporting-technologies"></a>Part XI: Jakarta EE Supporting Technologies</h1>
<div class="openblock partintro">
<div class="content">
Part XI explores several technologies that support the Jakarta EE
platform.
</div>
</div>
<div class="sect1">
<h2 id="transactions"><a class="anchor" href="#transactions"></a>Chapter 55. Transactions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter describes types of transactions and how they are managed in different applications.</p>
</div>
<div class="sect2">
<h3 id="overview-of-transactions"><a class="anchor" href="#overview-of-transactions"></a>Overview of Transactions</h3>
<div class="paragraph">
<p>A typical enterprise application accesses and stores information in one or more databases.
Because this information is critical for business operations, it must be accurate, current, and reliable.
Data integrity would be lost if multiple programs were allowed to update the same information simultaneously or if a system that failed while processing a business transaction were to leave the affected data only partially updated.
By preventing both of these scenarios, software transactions ensure data integrity.
Transactions control the concurrent access of data by multiple programs.
In the event of a system failure, transactions make sure that after recovery, the data will be in a consistent state.</p>
</div>
</div>
<div class="sect2">
<h3 id="transactions-in-jakarta-ee-applications"><a class="anchor" href="#transactions-in-jakarta-ee-applications"></a>Transactions in Jakarta EE Applications</h3>
<div class="paragraph">
<p>In a Jakarta EE application, a transaction is a series of actions that must all complete successfully, or else all the changes in each action are backed out.
Transactions end in either a commit or a rollback.</p>
</div>
<div class="paragraph">
<p>Jakarta Transactions allows applications to access transactions in a manner that is independent of specific implementations.
Jakarta Transactions specifies standard Java interfaces between a transaction manager and the parties involved in a distributed transaction system: the transactional application, the Jakarta EE server, and the manager that controls access to the shared resources affected by the transactions.</p>
</div>
<div class="paragraph">
<p>Jakarta Transactions defines the <code>UserTransaction</code> interface that applications use to start, commit, or roll back transactions.
Application components get a <code>UserTransaction</code> object through a JNDI lookup by using the name <code>java:comp/UserTransaction</code> or by requesting injection of a <code>UserTransaction</code> object.
An application server uses a number of Jakarta Transactions defined interfaces to communicate with a transaction manager; a transaction manager uses Jakarta Transactions defined interfaces to interact with a resource manager.</p>
</div>
<div class="paragraph">
<p>The Jakarta Transactions 2.0 specification is available at <a href="https://jakarta.ee/specifications/transactions/2.0/" class="bare" target="_blank" rel="noopener">https://jakarta.ee/specifications/transactions/2.0/</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="what-is-a-transaction"><a class="anchor" href="#what-is-a-transaction"></a>What Is a Transaction?</h3>
<div class="paragraph">
<p>To emulate a business transaction, a program may need to perform several steps.
A financial program, for example, might transfer funds from a checking account to a savings account by using the steps listed in the following pseudocode:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>begin transaction
    debit checking account
    credit savings account
    update history log
commit transaction</pre>
</div>
</div>
<div class="paragraph">
<p>Either all or none of the three steps must complete.
Otherwise, data integrity is lost.
Because the steps within a transaction are a unified whole, a transaction is often defined as an indivisible unit of work.</p>
</div>
<div class="paragraph">
<p>A transaction can end in two ways: with a commit or with a rollback.
When a transaction commits, the data modifications made by its statements are saved.
If a statement within a transaction fails, the transaction rolls back, undoing the effects of all statements in the transaction.
In the pseudocode, for example, if a disk drive were to crash during the <code>credit</code> step, the transaction would roll back and undo the data modifications made by the <code>debit</code> statement.
Although the transaction fails, data integrity would be intact because the accounts still balance.</p>
</div>
<div class="paragraph">
<p>In the preceding pseudocode, the <code>begin</code> and <code>commit</code> statements mark the boundaries of the transaction.
When designing an enterprise bean, you determine how the boundaries are set by specifying either container-managed or bean-managed transactions.</p>
</div>
</div>
<div class="sect2">
<h3 id="container-managed-transactions"><a class="anchor" href="#container-managed-transactions"></a>Container-Managed Transactions</h3>
<div class="paragraph">
<p>In an enterprise bean with container-managed transaction demarcation, the enterprise bean container sets the boundaries of the transactions.
You can use container-managed transactions with any type of enterprise bean: session or message-driven.
Container-managed transactions simplify development because the enterprise bean code does not explicitly mark the transaction&#8217;s boundaries.
The code does not include statements that begin and end the transaction.
By default, if no transaction demarcation is specified, enterprise beans use container-managed transaction demarcation.</p>
</div>
<div class="paragraph">
<p>Typically, the container begins a transaction immediately before an enterprise bean method starts and commits the transaction just before the method exits.
Each method can be associated with a single transaction.
Nested or multiple transactions are not allowed within a method.</p>
</div>
<div class="paragraph">
<p>Container-managed transactions do not require all methods to be associated with transactions.
When developing a bean, you can set the transaction attributes to specify which of the bean&#8217;s methods are associated with transactions.</p>
</div>
<div class="paragraph">
<p>Enterprise beans that use container-managed transaction demarcation must not use any transaction-management methods that interfere with the container&#8217;s transaction demarcation boundaries.
Examples of such methods are the <code>commit</code>, <code>setAutoCommit</code>, and <code>rollback</code> methods of <code>java.sql.Connection</code> or the <code>commit</code> and <code>rollback</code> methods of <code>jakarta.jms.Session</code>.
If you require control over the transaction demarcation, you must use application-managed transaction demarcation.</p>
</div>
<div class="paragraph">
<p>Enterprise beans that use container-managed transaction demarcation also must not use the <code>jakarta.transaction.UserTransaction</code> interface.</p>
</div>
<div class="sect3">
<h4 id="transaction-attributes"><a class="anchor" href="#transaction-attributes"></a>Transaction Attributes</h4>
<div class="paragraph">
<p>A transaction attribute controls the scope of a transaction.
<a href="#transaction-scope">Figure 55-1</a> illustrates why controlling the scope is important.
In the diagram, <code>method-A</code> begins a transaction and then invokes <code>method-B</code> of <code>Bean-2</code>.
When <code>method-B</code> executes, does it run within the scope of the transaction started by <code>method-A</code>, or does it execute with a new transaction? The answer depends on the transaction attribute of <code>method-B</code>.</p>
</div>
<div id="transaction-scope" class="imageblock">
<div class="content">
<img src="images/jakartaeett_dt_050.svg" alt="A diagram showing a transaction between two beans.">
</div>
<div class="title">Figure 55-1 Transaction Scope</div>
</div>
<div class="paragraph">
<p>A transaction attribute can have one of the following values:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Required</code></p>
</li>
<li>
<p><code>RequiresNew</code></p>
</li>
<li>
<p><code>Mandatory</code></p>
</li>
<li>
<p><code>NotSupported</code></p>
</li>
<li>
<p><code>Supports</code></p>
</li>
<li>
<p><code>Never</code></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="required-attribute"><a class="anchor" href="#required-attribute"></a>Required Attribute</h5>
<div class="paragraph">
<p>If the client is running within a transaction and invokes the enterprise bean&#8217;s method, the method executes within the client&#8217;s transaction.
If the client is not associated with a transaction, the container starts a new transaction before running the method.</p>
</div>
<div class="paragraph">
<p>The <code>Required</code> attribute is the implicit transaction attribute for all enterprise bean methods running with container-managed transaction demarcation.
You typically do not set the <code>Required</code> attribute unless you need to override another transaction attribute.
Because transaction attributes are declarative, you can easily change them later.</p>
</div>
</div>
<div class="sect4">
<h5 id="requiresnew-attribute"><a class="anchor" href="#requiresnew-attribute"></a>RequiresNew Attribute</h5>
<div class="paragraph">
<p>If the client is running within a transaction and invokes the enterprise bean&#8217;s method, the container takes the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Suspends the client&#8217;s transaction</p>
</li>
<li>
<p>Starts a new transaction</p>
</li>
<li>
<p>Delegates the call to the method</p>
</li>
<li>
<p>Resumes the client&#8217;s transaction after the method completes</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If the client is not associated with a transaction, the container starts a new transaction before running the method.</p>
</div>
<div class="paragraph">
<p>You should use the <code>RequiresNew</code> attribute when you want to ensure that the method always runs within a new transaction.</p>
</div>
</div>
<div class="sect4">
<h5 id="mandatory-attribute"><a class="anchor" href="#mandatory-attribute"></a>Mandatory Attribute</h5>
<div class="paragraph">
<p>If the client is running within a transaction and invokes the enterprise bean&#8217;s method, the method executes within the client&#8217;s transaction.
If the client is not associated with a transaction, the container throws a <code>TransactionRequiredException</code>.</p>
</div>
<div class="paragraph">
<p>Use the <code>Mandatory</code> attribute if the enterprise bean&#8217;s method must use the transaction of the client.</p>
</div>
</div>
<div class="sect4">
<h5 id="notsupported-attribute"><a class="anchor" href="#notsupported-attribute"></a>NotSupported Attribute</h5>
<div class="paragraph">
<p>If the client is running within a transaction and invokes the enterprise bean&#8217;s method, the container suspends the client&#8217;s transaction before invoking the method.
After the method has completed, the container resumes the client&#8217;s transaction.</p>
</div>
<div class="paragraph">
<p>If the client is not associated with a transaction, the container does not start a new transaction before running the method.</p>
</div>
<div class="paragraph">
<p>Use the <code>NotSupported</code> attribute for methods that don&#8217;t need transactions.
Because transactions involve overhead, this attribute may improve performance.</p>
</div>
</div>
<div class="sect4">
<h5 id="supports-attribute"><a class="anchor" href="#supports-attribute"></a>Supports Attribute</h5>
<div class="paragraph">
<p>If the client is running within a transaction and invokes the enterprise bean&#8217;s method, the method executes within the client&#8217;s transaction.
If the client is not associated with a transaction, the container does not start a new transaction before running the method.</p>
</div>
<div class="paragraph">
<p>Because the transactional behavior of the method may vary, you should use the <code>Supports</code> attribute with caution.</p>
</div>
</div>
<div class="sect4">
<h5 id="never-attribute"><a class="anchor" href="#never-attribute"></a>Never Attribute</h5>
<div class="paragraph">
<p>If the client is running within a transaction and invokes the enterprise bean&#8217;s method, the container throws a <code>RemoteException</code>.
If the client is not associated with a transaction, the container does not start a new transaction before running the method.</p>
</div>
</div>
<div class="sect4">
<h5 id="summary-of-transaction-attributes"><a class="anchor" href="#summary-of-transaction-attributes"></a>Summary of Transaction Attributes</h5>
<div class="paragraph">
<p><a href="#transaction-attributes-and-scope">Table 55-1</a> summarizes the effects of the transaction attributes.
Both the <code>T1</code> and the <code>T2</code> transactions are controlled by the container.
A <code>T1</code> transaction is associated with the client that calls a method in the enterprise bean.
In most cases, the client is another enterprise bean.
A <code>T2</code> transaction is started by the container just before the method executes.</p>
</div>
<div class="paragraph">
<p>In the last column of <a href="#transaction-attributes-and-scope">Table 55-1</a>, the word "None" means that the business method does not execute within a transaction controlled by the container.
However, the database calls in such a business method might be controlled by the transaction manager of the database management system.</p>
</div>
<table id="transaction-attributes-and-scope" class="tableblock frame-all grid-all" style="width: 60%;">
<caption class="title">Table 55-1 Transaction Attributes and Scope</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Transaction Attribute</th>
<th class="tableblock halign-left valign-top">Client&#8217;s Transaction</th>
<th class="tableblock halign-left valign-top">Business Method&#8217;s Transaction</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Required</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Required</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RequiresNew</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RequiresNew</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Mandatory</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Error</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Mandatory</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NotSupported</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NotSupported</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Supports</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Supports</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Never</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Never</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Error</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="setting-transaction-attributes"><a class="anchor" href="#setting-transaction-attributes"></a>Setting Transaction Attributes</h5>
<div class="paragraph">
<p>Transaction attributes are specified by decorating the enterprise bean class or method with a <code>jakarta.ejb.TransactionAttribute</code> annotation and setting it to one of the <code>jakarta.ejb.TransactionAttributeType</code> constants.</p>
</div>
<div class="paragraph">
<p>If you decorate the enterprise bean class with <code>@TransactionAttribute</code>, the specified <code>TransactionAttributeType</code> is applied to all the business methods in the class.
Decorating a business method with <code>@TransactionAttribute</code> applies the <code>TransactionAttributeType</code> only to that method.
If a <code>@TransactionAttribute</code> annotation decorates both the class and the method, the method <code>TransactionAttributeType</code> overrides the class <code>TransactionAttributeType</code>.</p>
</div>
<div class="paragraph">
<p>The <code>TransactionAttributeType</code> constants shown in <a href="#transactionattributetype-constants">Table 55-2</a> encapsulate the transaction attributes described earlier in this section.</p>
</div>
<table id="transactionattributetype-constants" class="tableblock frame-all grid-all" style="width: 34%;">
<caption class="title">Table 55-2 TransactionAttributeType Constants</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Transaction Attribute</th>
<th class="tableblock halign-left valign-top">TransactionAttributeType Constant</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Required</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TransactionAttributeType.REQUIRED</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RequiresNew</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TransactionAttributeType.REQUIRES_NEW</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Mandatory</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TransactionAttributeType.MANDATORY</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NotSupported</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TransactionAttributeType.NOT_SUPPORTED</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Supports</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TransactionAttributeType.SUPPORTS</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Never</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TransactionAttributeType.NEVER</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The following code snippet demonstrates how to use the <code>@TransactionAttribute</code> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@TransactionAttribute</span>(NOT_SUPPORTED)
<span class="annotation">@Stateful</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">TransactionBean</span> <span class="directive">implements</span> Transaction {
...
    <span class="annotation">@TransactionAttribute</span>(REQUIRES_NEW)
    <span class="directive">public</span> <span class="type">void</span> firstMethod() {...}

    <span class="annotation">@TransactionAttribute</span>(REQUIRED)
    <span class="directive">public</span> <span class="type">void</span> secondMethod() {...}

    <span class="directive">public</span> <span class="type">void</span> thirdMethod() {...}

    <span class="directive">public</span> <span class="type">void</span> fourthMethod() {...}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the <code>TransactionBean</code> class&#8217;s transaction attribute has been set to <code>NotSupported</code>, <code>firstMethod</code> has been set to <code>RequiresNew</code>, and <code>secondMethod</code> has been set to <code>Required</code>.
Because a <code>@TransactionAttribute</code> set on a method overrides the class <code>@TransactionAttribute</code>, calls to <code>firstMethod</code> will create a new transaction, and calls to <code>secondMethod</code> will either run in the current transaction or start a new transaction.
Calls to <code>thirdMethod</code> or <code>fourthMethod</code> do not take place within a transaction.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="rolling-back-a-container-managed-transaction"><a class="anchor" href="#rolling-back-a-container-managed-transaction"></a>Rolling Back a Container-Managed Transaction</h4>
<div class="paragraph">
<p>There are two ways to roll back a container-managed transaction.
First, if a system exception is thrown, the container will automatically roll back the transaction.
Second, by invoking the <code>setRollbackOnly</code> method of the <code>EJBContext</code> interface, the bean method instructs the container to roll back the transaction.
If the bean throws an application exception, the rollback is not automatic but can be initiated by a call to <code>setRollbackOnly</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="synchronizing-a-session-beans-instance-variables"><a class="anchor" href="#synchronizing-a-session-beans-instance-variables"></a>Synchronizing a Session Bean&#8217;s Instance Variables</h4>
<div class="paragraph">
<p>The <code>SessionSynchronization</code> interface, which is optional, allows stateful session bean instances to receive transaction synchronization notifications.
For example, you could synchronize the instance variables of an enterprise bean with their corresponding values in the database.
The container invokes the <code>SessionSynchronization</code> methods (<code>afterBegin</code>, <code>beforeCompletion</code>, and <code>afterCompletion</code>) at each of the main stages of a transaction.</p>
</div>
<div class="paragraph">
<p>The <code>afterBegin</code> method informs the instance that a new transaction has begun.
The container invokes <code>afterBegin</code> immediately before it invokes the business method.</p>
</div>
<div class="paragraph">
<p>The container invokes the <code>beforeCompletion</code> method after the business method has finished but just before the transaction commits.
The <code>beforeCompletion</code> method is the last opportunity for the session bean to roll back the transaction (by calling <code>setRollbackOnly</code>).</p>
</div>
<div class="paragraph">
<p>The <code>afterCompletion</code> method indicates that the transaction has completed.
This method has a single <code>boolean</code> parameter whose value is <code>true</code> if the transaction was committed and <code>false</code> if it was rolled back.</p>
</div>
</div>
<div class="sect3">
<h4 id="methods-not-allowed-in-container-managed-transactions"><a class="anchor" href="#methods-not-allowed-in-container-managed-transactions"></a>Methods Not Allowed in Container-Managed Transactions</h4>
<div class="paragraph">
<p>You should not invoke any method that might interfere with the transaction boundaries set by the container.
The following methods are prohibited:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>commit</code>, <code>setAutoCommit</code>, and <code>rollback</code> methods of <code>java.sql.Connection</code></p>
</li>
<li>
<p>The <code>getUserTransaction</code> method of <code>jakarta.ejb.EJBContext</code></p>
</li>
<li>
<p>Any method of <code>jakarta.transaction.UserTransaction</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can, however, use these methods to set boundaries in application-managed transactions.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="bean-managed-transactions"><a class="anchor" href="#bean-managed-transactions"></a>Bean-Managed Transactions</h3>
<div class="paragraph">
<p>In bean-managed transaction demarcation, the code in the session or message-driven bean explicitly marks the boundaries of the transaction.
Although beans with container-managed transactions require less coding, they have one limitation: When a method is executing, it can be associated with either a single transaction or no transaction at all.
If this limitation will make coding your bean difficult, you should consider using bean-managed transactions.</p>
</div>
<div class="paragraph">
<p>The following pseudocode illustrates the kind of fine-grained control you can obtain with application-managed transactions.
By checking various conditions, the pseudocode decides whether to start or stop certain transactions within the business method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>begin transaction
...
    update table-a
...
if (condition-x)
   commit transaction
else if (condition-y)
   update table-b
   commit transaction
else
   rollback transaction
   begin transaction
   update table-c
   commit transaction</pre>
</div>
</div>
<div class="paragraph">
<p>When coding an application-managed transaction for session or message-driven beans, you must decide whether to use Java Database Connectivity or Jakarta transactions.
The sections that follow discuss both types of transactions.</p>
</div>
<div class="sect3">
<h4 id="jakarta-transactions-2"><a class="anchor" href="#jakarta-transactions-2"></a>Jakarta Transactions</h4>
<div class="paragraph">
<p>Jakarta Transactions allows you to demarcate transactions in a manner that is independent of the transaction manager implementation.
GlassFish Server implements the transaction manager with the Java Transaction Service (JTS).
However, your code doesn&#8217;t call the JTS methods directly but instead invokes the Jakarta Transactions methods, which then call the lower-level JTS routines.</p>
</div>
<div class="paragraph">
<p>A Jakarta transaction is controlled by the Jakarta EE transaction manager.
You may want to use a Jakarta transaction because it can span updates to multiple databases from different vendors.
A particular DBMS&#8217;s transaction manager may not work with heterogeneous databases.
However, the Jakarta EE transaction manager does have one limitation: It does not support nested transactions.
In other words, it cannot start a transaction for an instance until the preceding transaction has ended.</p>
</div>
<div class="paragraph">
<p>To demarcate a Jakarta transaction, you invoke the <code>begin</code>, <code>commit</code>, and <code>rollback</code> methods of the <code>jakarta.transaction.UserTransaction</code> interface.</p>
</div>
</div>
<div class="sect3">
<h4 id="returning-without-committing"><a class="anchor" href="#returning-without-committing"></a>Returning without Committing</h4>
<div class="paragraph">
<p>In a stateless session bean with bean-managed transactions, a business method must commit or roll back a transaction before returning.
However, a stateful session bean does not have this restriction.</p>
</div>
<div class="paragraph">
<p>In a stateful session bean with a Jakarta transaction, the association between the bean instance and the transaction is retained across multiple client calls.
Even if each business method called by the client opens and closes the database connection, the association is retained until the instance completes the transaction.</p>
</div>
<div class="paragraph">
<p>In a stateful session bean with a JDBC transaction, the JDBC connection retains the association between the bean instance and the transaction across multiple calls.
If the connection is closed, the association is not retained.</p>
</div>
</div>
<div class="sect3">
<h4 id="methods-not-allowed-in-bean-managed-transactions"><a class="anchor" href="#methods-not-allowed-in-bean-managed-transactions"></a>Methods Not Allowed in Bean-Managed Transactions</h4>
<div class="paragraph">
<p>Do not invoke the <code>getRollbackOnly</code> and <code>setRollbackOnly</code> methods of the <code>EJBContext</code> interface in bean-managed transactions.
These methods should be used only in container-managed transactions.
For bean-managed transactions, invoke the <code>getStatus</code> and <code>rollback</code> methods of the <code>UserTransaction</code> interface.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="transaction-timeouts"><a class="anchor" href="#transaction-timeouts"></a>Transaction Timeouts</h3>
<div class="paragraph">
<p>For container-managed transactions, you can use the Administration Console to configure the transaction timeout interval.
See <a href="#starting-the-administration-console">Starting the Administration Console</a>.</p>
</div>
<div class="paragraph">
<p>For enterprise beans with bean-managed Jakarta transactions, you invoke the <code>setTransactionTimeout</code> method of the <code>UserTransaction</code> interface.</p>
</div>
<div class="sect3">
<h4 id="to-set-a-transaction-timeout"><a class="anchor" href="#to-set-a-transaction-timeout"></a>To Set a Transaction Timeout</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the Administration Console, expand the Configurations node, then expand the server-config node and select Transaction Service.</p>
</li>
<li>
<p>On the Transaction Service page, set the value of the Transaction Timeout field to the value of your choice (for example, 5).</p>
<div class="paragraph">
<p>With this setting, if the transaction has not completed within 5 seconds, the enterprise bean container rolls it back.</p>
</div>
<div class="paragraph">
<p>The default value is 0, meaning that the transaction will not time out.</p>
</div>
</li>
<li>
<p>Click Save.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="updating-multiple-databases"><a class="anchor" href="#updating-multiple-databases"></a>Updating Multiple Databases</h3>
<div class="paragraph">
<p>The Jakarta EE transaction manager controls all enterprise bean transactions except for bean-managed JDBC transactions.
The Jakarta EE transaction manager allows an enterprise bean to update multiple databases within a transaction.
<a href="#updating-multiple-databases-2">Figure 55-2</a> and <a href="#updating-multiple-databases-across-jakarta-ee-servers">Figure 55-3</a> show two scenarios for updating multiple databases in a single transaction.</p>
</div>
<div class="paragraph">
<p>In <a href="#updating-multiple-databases-2">Figure 55-2</a>, the client invokes a business method in <code>Bean-A</code>.
The business method begins a transaction, updates Database X, updates Database Y, and invokes a business method in <code>Bean-B</code>.
The second business method updates Database Z and returns control to the business method in <code>Bean-A</code>, which commits the transaction.
All three database updates occur in the same transaction.</p>
</div>
<div class="paragraph">
<p>In <a href="#updating-multiple-databases-across-jakarta-ee-servers">Figure 55-3</a>, the client calls a business method in <code>Bean-A</code>, which begins a transaction and updates Database X.
Then <code>Bean-A</code> invokes a method in <code>Bean-B</code>, which resides in a remote Jakarta EE server.
The method in <code>Bean-B</code> updates Database Y.
The transaction managers of the Jakarta EE servers ensure that both databases are updated in the same transaction.</p>
</div>
<div id="updating-multiple-databases-2" class="imageblock">
<div class="content">
<img src="images/jakartaeett_dt_051.svg" alt="A diagram showing Bean-A updating databases X and Y, and Bean-B updating database Z.">
</div>
<div class="title">Figure 55-2 Updating Multiple Databases</div>
</div>
<div id="updating-multiple-databases-across-jakarta-ee-servers" class="imageblock">
<div class="content">
<img src="images/jakartaeett_dt_052.svg" alt="A diagram showing Bean-A on one Jakarta EE server updating database X, and Bean-B on another Jakarta EE server updating database Y.">
</div>
<div class="title">Figure 55-3 Updating Multiple Databases Across Jakarta EE Servers</div>
</div>
</div>
<div class="sect2">
<h3 id="transactions-in-web-components"><a class="anchor" href="#transactions-in-web-components"></a>Transactions in Web Components</h3>
<div class="paragraph">
<p>You can demarcate a transaction in a web component by using either the <code>java.sql.Connection</code> or the <code>jakarta.transaction.UserTransaction</code> interface.
These are the same interfaces that a session bean with bean-managed transactions can use.
Transactions demarcated with the <code>UserTransaction</code> interface are discussed in <a href="#jakarta-transactions-2">Jakarta Transactions</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="further-information-about-transactions"><a class="anchor" href="#further-information-about-transactions"></a>Further Information about Transactions</h3>
<div class="paragraph">
<p>For more information about transactions, see the Jakarta Transactions 2.0 specification at <a href="https://jakarta.ee/specifications/transactions/2.0/" class="bare" target="_blank" rel="noopener">https://jakarta.ee/specifications/transactions/2.0/</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="resource-adapters-and-contracts"><a class="anchor" href="#resource-adapters-and-contracts"></a>Chapter 56. Resource Adapters and Contracts</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter examines resource adapters and explains how communications between Jakarta EE servers and EIS systems are mediated by them.</p>
</div>
<div class="sect2">
<h3 id="what-is-a-resource-adapter"><a class="anchor" href="#what-is-a-resource-adapter"></a>What Is a Resource Adapter?</h3>
<div class="paragraph">
<p>A resource adapter is a Jakarta EE component that implements the Jakarta Connectors API for a specific EIS.
Examples of EISs include enterprise resource planning, mainframe transaction processing, and database systems.
In a Jakarta EE server, Jakarta Messaging and Jakarta Mail also act as EISs that you access using resource adapters.
As illustrated in <a href="#resource-adapters">Figure 56-1</a>, the resource adapter facilitates communication between a Jakarta EE application and an EIS.</p>
</div>
<div id="resource-adapters" class="imageblock">
<div class="content">
<img src="images/jakartaeett_dt_053.svg" alt="Resource Adapter Contracts">
</div>
<div class="title">Figure 56-1 Resource Adapters</div>
</div>
<div class="paragraph">
<p>Stored in a Resource Adapter Archive (RAR) file, a resource adapter can be deployed on any Jakarta EE server, much like a Jakarta EE application.
A RAR file may be contained in an Enterprise Archive (EAR) file, or it may exist as a separate file.</p>
</div>
<div class="paragraph">
<p>A resource adapter is analogous to a JDBC driver.
Both provide a standard API through which an application can access a resource that is outside the Jakarta EE server.
For a resource adapter, the target system is an EIS; for a JDBC driver, it is a DBMS.
Resource adapters and JDBC drivers are rarely created by application developers.
In most cases, both types of software are built by vendors that sell tools, servers, or integration software.</p>
</div>
<div class="paragraph">
<p>The resource adapter mediates communication between the Jakarta EE server and the EIS by means of contracts.
The application contract defines the API through which a Jakarta EE component, such as an enterprise bean, accesses the EIS.
This API is the only view that the component has of the EIS.
The system contracts link the resource adapter to important services that are managed by the Jakarta EE server.
The resource adapter itself and its system contracts are transparent to the Jakarta EE component.</p>
</div>
<div class="sect3">
<h4 id="management-contracts"><a class="anchor" href="#management-contracts"></a>Management Contracts</h4>
<div class="paragraph">
<p>Jakarta Connectors defines system contracts that enable resource adapter lifecycle and thread management.</p>
</div>
<div class="sect4">
<h5 id="lifecycle-management"><a class="anchor" href="#lifecycle-management"></a>Lifecycle Management</h5>
<div class="paragraph">
<p>Jakarta Connectors specifies a lifecycle management contract that allows an application server to manage the lifecycle of a resource adapter.
This contract provides a mechanism for the application server to bootstrap a resource adapter instance during the deployment or application server startup.
This contract also provides a means for the application server to notify the resource adapter instance when it is undeployed or when an orderly shutdown of the application server takes place.</p>
</div>
</div>
<div class="sect4">
<h5 id="work-management-contract"><a class="anchor" href="#work-management-contract"></a>Work Management Contract</h5>
<div class="paragraph">
<p>Jakarta Connectors work management contract ensures that resource adapters use threads in the proper, recommended manner.
This contract also enables an application server to manage threads for resource adapters.</p>
</div>
<div class="paragraph">
<p>Resource adapters that improperly use threads can jeopardize the entire application server environment.
For example, a resource adapter might create too many threads or might not properly release threads it has created.
Poor thread handling inhibits application server shutdown and impacts the application server&#8217;s performance because creating and destroying threads are expensive operations.</p>
</div>
<div class="paragraph">
<p>The work management contract establishes a means for the application server to pool and reuse threads, similar to pooling and reusing connections.
By adhering to this contract, the resource adapter does not have to manage threads itself.
Instead, the resource adapter has the application server create and provide needed threads.
When it is finished with a given thread, the resource adapter returns the thread to the application server.
The application server manages the thread, either returning it to a pool for later reuse or destroying it.
Handling threads in this manner results in increased application server performance and more efficient use of resources.</p>
</div>
<div class="paragraph">
<p>In addition to moving thread management to the application server, the Connector Architecture provides a flexible model for a resource adapter that uses threads.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The requesting thread can choose to block (stop its own execution) until the work thread completes.</p>
</li>
<li>
<p>The requesting thread can block while it waits to get the work thread.
When the application server provides a work thread, the requesting thread and the work thread execute in parallel.</p>
</li>
<li>
<p>The resource adapter can opt to submit the work for the thread to a queue.
The thread executes the work from the queue at some later point.
The resource adapter continues its own execution from the point it submitted the work to the queue, no matter when the thread executes it.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>With the latter two approaches, the submitting thread and the work thread may execute simultaneously or independently.
For these approaches, the contract specifies a listener mechanism to notify the resource adapter that the thread has completed its operation.
The resource adapter can also specify the execution context for the thread, and the work management contract controls the context in which the thread executes.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="generic-work-context-contract"><a class="anchor" href="#generic-work-context-contract"></a>Generic Work Context Contract</h4>
<div class="paragraph">
<p>The work management contract between the application server and a resource adapter enables a resource adapter to do a task, such as communicating with the EIS or delivering messages, by delivering <code>Work</code> instances for execution.</p>
</div>
<div class="paragraph">
<p>A generic work context contract enables a resource adapter to control the contexts in which the <code>Work</code> instances that it submits are executed by the application server&#8217;s <code>WorkManager</code>.
A generic work context mechanism also enables an application server to support message inflow and delivery schemes.
It also provides a richer contextual <code>Work</code> execution environment to the resource adapter while still maintaining control over concurrent behavior in a managed environment.</p>
</div>
<div class="paragraph">
<p>The generic work context contract standardizes the transaction context and the security context.</p>
</div>
</div>
<div class="sect3">
<h4 id="outbound-and-inbound-contracts"><a class="anchor" href="#outbound-and-inbound-contracts"></a>Outbound and Inbound Contracts</h4>
<div class="paragraph">
<p>The Connector Architecture defines the following outbound contracts, system-level contracts between an application server and an EIS that enable outbound connectivity to an EIS.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The connection management contract supports connection pooling, a technique that enhances application performance and scalability.
Connection pooling is transparent to the application, which simply obtains a connection to the EIS.</p>
</li>
<li>
<p>The transaction management contract extends the connection management contract and provides support for management of both local and XA transactions.</p>
<div class="paragraph">
<p>A local transaction is limited in scope to a single EIS system, and the EIS resource manager itself manages such a transaction.
An XA transaction or global transaction can span multiple resource managers.
This form of transaction requires transaction coordination by an external transaction manager, typically bundled with an application server.
A transaction manager uses a two-phase commit protocol to manage a transaction that spans multiple resource managers or EISs, and uses one-phase commit optimization if only one resource manager is participating in an XA transaction.</p>
</div>
</li>
<li>
<p>The security management contract provides mechanisms for authentication, authorization, and secure communication between a Jakarta EE server and an EIS to protect the information in the EIS.</p>
<div class="paragraph">
<p>A work security map matches EIS identities to the application server domain&#8217;s identities.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Inbound contracts are system contracts between a Jakarta EE server and an EIS that enable inbound connectivity from the EIS: pluggability contracts for message providers and contracts for importing transactions.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="metadata-annotations"><a class="anchor" href="#metadata-annotations"></a>Metadata Annotations</h3>
<div class="paragraph">
<p>Jakarta Connectors provides a set of annotations to minimize the need for deployment descriptors.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>@Connector</code> annotation can be used by the resource adapter developer to specify that the JavaBeans component is a resource adapter JavaBeans component.
This annotation is used for providing metadata about the capabilities of the resource adapter.
Optionally, you can provide a JavaBeans component implementing the <code>ResourceAdapter</code> interface, as in the following example:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Connector</span>(
    displayName = <span class="string"><span class="delimiter">&quot;</span><span class="content">TrafficRA</span><span class="delimiter">&quot;</span></span>,
    vendorName = <span class="string"><span class="delimiter">&quot;</span><span class="content">Jakarta EE Tutorial</span><span class="delimiter">&quot;</span></span>,
    version = <span class="string"><span class="delimiter">&quot;</span><span class="content">9.0</span><span class="delimiter">&quot;</span></span>
)
<span class="directive">public</span> <span class="type">class</span> <span class="class">TrafficResourceAdapter</span> <span class="directive">implements</span> ResourceAdapter,
                                               <span class="predefined-type">Serializable</span> {
    ...
}</code></pre>
</div>
</div>
</li>
<li>
<p>The <code>@ConnectionDefinition</code> annotation defines a set of connection interfaces and classes pertaining to a particular connection type, as in the following example:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ConnectionDefinition</span>(
    connectionFactory = TradeConnectionFactory.class,
    connectionFactoryImpl = TradeConnectionFactoryImpl.class,
    connection = TradeConnection.class,
    connectionImpl = TradeConnectionImpl.class
)
<span class="directive">public</span> <span class="type">class</span> <span class="class">TradeManagedConnectionFactory</span> ... {
    ...
}</code></pre>
</div>
</div>
</li>
<li>
<p>The <code>@AdministeredObject</code> annotation designates a JavaBeans component as an administered object.</p>
</li>
<li>
<p>The <code>@Activation</code> annotation contains configuration information pertaining to inbound connectivity from an EIS instance, as in the following example:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Activation</span>(
        messageListeners = { TrafficListener.class }
)
<span class="directive">public</span> <span class="type">class</span> <span class="class">TrafficActivationSpec</span> <span class="directive">implements</span> ActivationSpec,
                                              <span class="predefined-type">Serializable</span> {
    ...
    <span class="annotation">@ConfigProperty</span>()
    <span class="comment">/* port to listen to requests from the EIS */</span>
    <span class="directive">private</span> <span class="predefined-type">String</span> port;
    ...
}</code></pre>
</div>
</div>
</li>
<li>
<p>The <code>@ConfigProperty</code> annotation can be used on JavaBeans components to provide additional configuration information that may be used by the deployer and resource adapter provider.
The preceding example code shows several <code>@ConfigProperty</code> annotations.</p>
</li>
<li>
<p>The <code>@ConnectionFactoryDefinition</code> annotation is a resource definition annotation that is used to define a connector connection factory and register it in JNDI under the name specified in the mandatory <code>name</code> annotation element.
The mandatory <code>interfaceName</code> annotation element specifies the fully qualified name of the connection factory interface class.
The <code>transactionSupport</code> annotation element specifies the level of transaction support the connection factory needs to support.
The <code>minPoolSize</code> and <code>maxPoolSize</code> annotation elements specify the minimum or maximum number of connections that should be allocated for a connection pool that backs this connection factory resource.
Additional properties associated with the connection factory being defined can be specified through the <code>properties</code> element.</p>
<div class="paragraph">
<p>Since repeated annotations are not allowed, the <code>@ConnectionFactoryDefinitions</code> annotation acts as a container for multiple connector connection factory definitions.
The <code>value</code> annotation element contains the multiple connector connection factory definitions.</p>
</div>
</li>
<li>
<p>The <code>@AdministeredObjectDefinition</code> annotation is a resource definition annotation that is used to define an administered object and register it in JNDI under the name specified in the mandatory <code>name</code> annotation element.
The mandatory fully qualified name of the administered object&#8217;s class must be indicated by the <code>className</code> element.
Additional properties that must be configured in the administered object can be specified through the <code>properties</code> element.</p>
<div class="paragraph">
<p>Since repeated annotations are not allowed, the <code>@AdministeredObjectDefinitions</code> annotation acts as a container for multiple administered object definitions.
The <code>value</code> annotation element contains the multiple administered object definitions.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The specification allows a resource adapter to be developed in mixed-mode form, that is the ability for a resource adapter developer to use both metadata annotations and deployment descriptors in applications.
An application assembler or deployer may use the deployment descriptor to override the metadata annotations specified by the resource adapter developer.</p>
</div>
<div class="paragraph">
<p>The deployment descriptor for a resource adapter, if present, is named <code>ra.xml</code>.
The <code>metadata-complete</code> attribute defines whether the deployment descriptor for the resource adapter module is complete or whether the class files available to the module and packaged with the resource adapter need to be examined for annotations that specify deployment information.</p>
</div>
<div class="paragraph">
<p>For the complete list of annotations and JavaBeans components provided in the Jakarta EE platform, see the Jakarta Connectors 2.0 specification.</p>
</div>
</div>
<div class="sect2">
<h3 id="common-client-interface"><a class="anchor" href="#common-client-interface"></a>Common Client Interface</h3>
<div class="paragraph">
<p>This section explains how components use the Jakarta Connectors Common Client Interface (CCI) API and a resource adapter to access data from an EIS.
The CCI API defines a set of interfaces and classes whose methods allow a client to perform typical data access operations.
The CCI interfaces and classes are as follows.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ConnectionFactory</code>: Provides an application component with a <code>Connection</code> instance to an EIS.</p>
</li>
<li>
<p><code>Connection</code>: Represents the connection to the underlying EIS.</p>
</li>
<li>
<p><code>ConnectionSpec</code>: Provides a means for an application component to pass connection-request-specific properties to the <code>ConnectionFactory</code> when making a connection request.</p>
</li>
<li>
<p><code>Interaction</code>: Provides a means for an application component to execute EIS functions, such as database stored procedures.</p>
</li>
<li>
<p><code>InteractionSpec</code>: Holds properties pertaining to an application component&#8217;s interaction with an EIS.</p>
</li>
<li>
<p><code>Record</code>: The superinterface for the various kinds of record instances.
Record instances can be <code>MappedRecord</code>, <code>IndexedRecord</code>, or <code>ResultSet</code> instances, all of which inherit from the <code>Record</code> interface.</p>
</li>
<li>
<p><code>RecordFactory</code>: Provides an application component with a <code>Record</code> instance.</p>
</li>
<li>
<p><code>IndexedRecord</code>: Represents an ordered collection of <code>Record</code> instances based on the <code>java.util.List</code> interface.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A client or application component that uses the CCI to interact with an underlying EIS does so in a prescribed manner.
The component must establish a connection to the EIS&#8217;s resource manager, and it does so using the <code>ConnectionFactory</code>.
The <code>Connection</code> object represents the connection to the EIS and is used for subsequent interactions with the EIS.</p>
</div>
<div class="paragraph">
<p>The component performs its interactions with the EIS, such as accessing data from a specific table, using an <code>Interaction</code> object.
The application component defines the Interaction object by using an <code>InteractionSpec</code> object.
When it reads data from the EIS, such as from database tables, or writes to those tables, the application component does so by using a particular type of <code>Record</code> instance: a <code>MappedRecord</code>, an <code>IndexedRecord</code>, or a <code>ResultSet</code> instance.</p>
</div>
<div class="paragraph">
<p>Note, too, that a client application that relies on a CCI resource adapter is very much like any other Jakarta EE client that uses enterprise bean methods.</p>
</div>
</div>
<div class="sect2">
<h3 id="using-resource-adapters-with-jakarta-contexts-and-dependency-injection-cdi"><a class="anchor" href="#using-resource-adapters-with-jakarta-contexts-and-dependency-injection-cdi"></a>Using Resource Adapters with Jakarta Contexts and Dependency Injection (CDI)</h3>
<div class="paragraph">
<p>For details about CDI, see <a href="#introduction-to-jakarta-contexts-and-dependency-injection">Chapter 25, <em>Introduction to Jakarta Contexts and Dependency Injection</em></a> and <a href="#jakarta-contexts-and-dependency-injection-advanced-topics">Chapter 27, <em>Jakarta Contexts and Dependency Injection: Advanced Topics</em></a>.</p>
</div>
<div class="paragraph">
<p>Do not specify the following classes in the resource adapter as CDI managed beans (that is, do not inject them), because the behavior of these classes as CDI managed beans has not been portably defined.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Resource adapter beans: These beans are classes that are annotated with the <code>jakarta.resource.spi.Connector</code> annotation or are declared as corresponding elements in the resource adapter deployment descriptor, <code>ra.xml</code>.</p>
</li>
<li>
<p>Managed connection factory beans: These beans are classes that are annotated with the <code>jakarta.resource.spi.ConnectorDefinition</code> annotation or the <code>jakarta.resource.spi.ConnectorDefinitions</code> annotation or are declared as corresponding elements in <code>ra.xml</code>.</p>
</li>
<li>
<p>Activation specification beans: These beans are classes that are annotated with the <code>jakarta.resource.spi.Activation</code> annotation or are declared as corresponding elements in <code>ra.xml</code>.</p>
</li>
<li>
<p>Administered object beans: These beans are classes that are annotated with the <code>jakarta.resource.spi.AdministeredObject</code> annotation or are declared as corresponding elements in <code>ra.xml</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Other types of classes in the resource adapter can be CDI managed beans and will behave in a portable manner.</p>
</div>
</div>
<div class="sect2">
<h3 id="further-information-about-resource-adapters"><a class="anchor" href="#further-information-about-resource-adapters"></a>Further Information about Resource Adapters</h3>
<div class="paragraph">
<p>For more information about resource adapters and annotations, see</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Jakarta EE 9 Platform Specification:<br>
<a href="https://jakarta.ee/specifications/platform/" class="bare" target="_blank" rel="noopener">https://jakarta.ee/specifications/platform/</a></p>
</li>
<li>
<p>Jakarta Connectors 2.0 specification:<br>
<a href="https://jakarta.ee/specifications/connectors/2.0/" class="bare" target="_blank" rel="noopener">https://jakarta.ee/specifications/connectors/2.0/</a></p>
</li>
<li>
<p>Jakarta Enterprise Beans specification:<br>
<a href="https://jakarta.ee/specifications/enterprise-beans/4.0/" class="bare" target="_blank" rel="noopener">https://jakarta.ee/specifications/enterprise-beans/4.0/</a></p>
</li>
<li>
<p>Jakarta Annotations:<br>
<a href="https://jakarta.ee/specifications/annotations/2.0/" class="bare" target="_blank" rel="noopener">https://jakarta.ee/specifications/annotations/2.0/</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="the-resource-adapter-examples"><a class="anchor" href="#the-resource-adapter-examples"></a>Chapter 57. The Resource Adapter Examples</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter describes two examples that demonstrate how to use resource adapters in Jakarta EE applications and how to implement simple resource adapters.</p>
</div>
<div class="sect2">
<h3 id="overview-of-the-resource-adapter-examples"><a class="anchor" href="#overview-of-the-resource-adapter-examples"></a>Overview of the Resource Adapter Examples</h3>
<div class="paragraph">
<p>The <code>trading</code> example shows how to use a simple custom client interface to connect to an EIS from a web application.
The resource adapter in this example implements the outbound contract and the custom client interface.
The <code>traffic</code> example shows how to use a message-driven bean (MDB) to process traffic information updates from an EIS.
The resource adapter in this example implements the inbound and work management contracts.</p>
</div>
</div>
<div class="sect2">
<h3 id="the-trading-example"><a class="anchor" href="#the-trading-example"></a>The trading Example</h3>
<div class="paragraph">
<p>The <code>trading</code> example demonstrates how to implement and use a simple outbound resource adapter that submits requests to a legacy EIS using a TCP socket.
The example demonstrates the scenario in <a href="#the-trading-example-2">Figure 57-1</a> and consists of the following modules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>trading-eis</code>: A Java SE program that simulates a legacy EIS</p>
</li>
<li>
<p><code>trading-rar</code>: The outbound resource adapter implementation</p>
</li>
<li>
<p><code>trading-war</code>: A web application that uses the resource adapter</p>
</li>
<li>
<p><code>trading-ear</code>: An enterprise archive that contains the resource adapter and the web application</p>
</li>
</ul>
</div>
<div id="the-trading-example-2" class="imageblock">
<div class="content">
<img src="images/jakartaeett_dt_054.svg" alt="This figure shows the trading example components: a deployed WAR and RAR that communicate with the EIS over a TCP socket.">
</div>
<div class="title">Figure 57-1 The trading Example</div>
</div>
<div class="paragraph">
<p>The <code>trading-eis</code> module is an auxiliary project that resembles a legacy stock trading execution platform.
It contains a Java SE program that listens for trading requests in plain text on a TCP socket.
The program replies to trading requests with a status value, a confirmation number, and the dollar amounts for the requested shares and fees.
For example, a request-response pair would look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&gt;&gt; BUY 1000 ZZZZ MARKET
&lt;&lt; EXECUTED #1234567 TOTAL 50400.00 FEE 252.00</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>trading-rar</code> module implements the outbound contract of the Jakarta Connectors to submit requests and obtain responses from the legacy stock trading execution platform.
The <code>trading-rar</code> module provides and implements a custom client interface for Jakarta EE applications to use.
This interface is simpler than the Common Client Interface (CCI).</p>
</div>
<div class="paragraph">
<p>The <code>trading-war</code> module is a web application with a Jakarta Faces interface and a managed bean.
This application enables clients to submit trades to the EIS using the resource adapter provided by the <code>trading-rar</code> module.
The <code>trading-war</code> module uses the custom client interface provided by the resource adapter to obtain connections to the EIS.</p>
</div>
<div class="sect3">
<h4 id="using-the-outbound-resource-adapter"><a class="anchor" href="#using-the-outbound-resource-adapter"></a>Using the Outbound Resource Adapter</h4>
<div class="paragraph">
<p>In most cases, Jakarta EE application developers use outbound resource adapters developed by a third party.
Outbound resource adapters either implement the Common Client Interface (CCI) or provide a custom interface for applications to interact with the EIS.
Outbound resource adapters provide Jakarta EE applications with the following elements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Connection factories</p>
</li>
<li>
<p>Connection handles</p>
</li>
<li>
<p>Other interfaces and objects specific to the EIS domain</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Jakarta EE applications obtain an instance of the connection factory via resource injection and then use the factory object to obtain connection handles to the EIS.
The connection handles enable the application to make requests and obtain information from the EIS.</p>
</div>
<div class="paragraph">
<p>The <code>trading-rar</code> module provides a custom client interface that consists of the classes listed in <a href="#classes-and-interfaces-in-the-trading-rar-module">Table 57-1</a>.</p>
</div>
<table id="classes-and-interfaces-in-the-trading-rar-module" class="tableblock frame-all grid-all" style="width: 80%;">
<caption class="title">Table 57-1 Classes and Interfaces in the trading-rar module</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">API Component</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TradeOrder</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Represents a trade order for the EIS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TradeResponse</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Represents a response from the EIS to a trade request</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TradeConnection</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Represents a connection handle to the EIS</p>
</div>
<div class="paragraph">
<p>Provides a method for applications to submit trades to the EIS</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TradeConnectionFactory</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables applications to obtain connection handles to the EIS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TradeProcessingException</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates that a problem occurred processing a trade request</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <code>ResourceAccessBean</code> managed bean in the <code>trading-war</code> module configures a connection factory for the <code>trading-rar</code> resource adapter by using the <code>@ConnectionFactoryDefinition</code> annotation as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Named</span>
<span class="annotation">@SessionScoped</span>
<span class="annotation">@ConnectionFactoryDefinition</span>(
    name = <span class="string"><span class="delimiter">&quot;</span><span class="content">java:comp/env/eis/TradeConnectionFactory</span><span class="delimiter">&quot;</span></span>,
    interfaceName = <span class="string"><span class="delimiter">&quot;</span><span class="content">ee.jakarta.tutorial.trading.rar.api.TradeConnectionFactory</span><span class="delimiter">&quot;</span></span>,
    resourceAdapter = <span class="string"><span class="delimiter">&quot;</span><span class="content">#trading-rar</span><span class="delimiter">&quot;</span></span>,
    minPoolSize = <span class="integer">5</span>,
    transactionSupport =
            TransactionSupport.TransactionSupportLevel.NoTransaction
)
<span class="directive">public</span> <span class="type">class</span> <span class="class">ResourceAccessBean</span> <span class="directive">implements</span> <span class="predefined-type">Serializable</span> { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>name</code> parameter specifies the JNDI name for the connection factory.
This example registers the connection factory in the <code>java:comp</code> scope.
You can use the <code>ConnectionFactoryDefinition</code> annotation to specify a different scope, such as <code>java:global</code>, <code>java:app</code>, or <code>java:module</code>.
The <code>AdministeredObjectDefinition</code> annotation also enables you to register administered connector objects in the JNDI namespace.</p>
</div>
<div class="paragraph">
<p>The <code>interfaceName</code> parameter specifies the interface implemented by the connection factory included in the resource adapter.
In this example, this is a custom interface.</p>
</div>
<div class="paragraph">
<p>The <code>resourceAdapter</code> parameter specifies the name of the resource adapter that contains the connection factory implementation.
The <code>#</code> prefix in <code>#trading-rar</code> indicates that <code>trading-rar</code> is an embedded resource adapter that is bundled in the same EAR as this web application.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can also configure a connection factory for a previously deployed outbound resource adapter using the administration commands from your application server.
However, this is a vendor-specific procedure.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The managed bean obtains a connection factory object using resource injection as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">...
public <span class="type">class</span> <span class="class">ResourceAccessBean</span> <span class="directive">implements</span> <span class="predefined-type">Serializable</span> {
    <span class="annotation">@Resource</span>(lookup = <span class="string"><span class="delimiter">&quot;</span><span class="content">java:comp/env/eis/TradeConnectionFactory</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">private</span> TradeConnectionFactory connectionFactory;
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The managed bean uses the connection factory to obtain connection handles as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">TradeConnection connection = connectionFactory.getConnection();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The resource adapter returns a connection handle associated with a physical connection to the EIS.
Once a connection handle is available, the managed bean submits a trade and obtains the response as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">TradeOrder order = <span class="keyword">new</span> TradeOrder();
order.setNShares(<span class="integer">1000</span>);
order.setTicker(TradeOrder.Ticker.YYYY);
order.setOrderType(TradeOrder.OrderType.BUY);
order.setOrderClass(TradeOrder.OrderClass.MARKET);
...
try {
    TradeResponse response = connection.submitOrder(order);
    ...
} <span class="keyword">catch</span> (TradeProcessingException ex) { ... }</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="implementing-the-outbound-resource-adapter"><a class="anchor" href="#implementing-the-outbound-resource-adapter"></a>Implementing the Outbound Resource Adapter</h4>
<div class="paragraph">
<p>The <code>trading-rar</code> module implements the outbound contract and a custom client interface for the simple legacy stock trading platform EIS used in this example.
The architecture of the outbound resource adapter is shown in <a href="#architecture-of-the-trading-example">Figure 57-2</a>.</p>
</div>
<div id="architecture-of-the-trading-example" class="imageblock">
<div class="content">
<img src="images/jakartaeett_dt_055.svg" alt="This figure shows the classes in each of the modules of the trading example.">
</div>
<div class="title">Figure 57-2 Architecture of the trading Example</div>
</div>
<div class="paragraph">
<p>The <code>trading-rar</code> module implements the interfaces listed in <a href="#interfaces-implemented-in-the-trading-rar-module">Table 57-2</a>.</p>
</div>
<table id="interfaces-implemented-in-the-trading-rar-module" class="tableblock frame-all grid-all" style="width: 99%;">
<caption class="title">Table 57-2 Interfaces Implemented in the trading-rar Module</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Package</th>
<th class="tableblock halign-left valign-top">Interface</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jakarta.resource.spi</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ResourceAdapter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the lifecycle methods of the resource adapter</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jakarta.resource.spi</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ManagedConnectionFactory</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines a connection factory that the connection manager from the application server uses to obtain physical connections to the EIS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jakarta.resource.spi</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ManagedConnection</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines a physical connection to the EIS that can be managed by the connection manager</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>trading.rar.api</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TradeConnectionFactory</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines a connection factory that applications use to obtain connection handles</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>trading.rar.api</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TradeConnection</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines a connection handle that applications use to interact with the EIS</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>When the <code>trading-ear</code> archive is deployed and a connection pool resource is configured as described in <a href="#using-the-outbound-resource-adapter">Using the Outbound Resource Adapter</a>, the application server creates <code>TradeConnectionFactory</code> objects that applications can obtain using resource injection.
The <code>TradeConnectionFactory</code> implementation delegates creating connections to the connection manager provided by the application server.</p>
</div>
<div class="paragraph">
<p>The connection manager uses the <code>ManagedConnectionFactory</code> implementation to obtain physical connections to the EIS and maintains a pool of active physical connections.
When an application requests a connection handle, the connection manager associates a connection from the pool with a new connection handle that the application can use.
Connection pooling improves application performance and simplifies resource adapter development.</p>
</div>
<div class="paragraph">
<p>For more details, see the code and the comments in the <code>trading-rar</code> module.</p>
</div>
</div>
<div class="sect3">
<h4 id="running-the-trading-example"><a class="anchor" href="#running-the-trading-example"></a>Running the trading Example</h4>
<div class="paragraph">
<p>You can use either NetBeans IDE or Maven to build, package, deploy, and run the <code>trading</code> example.</p>
</div>
<div class="sect4">
<h5 id="to-run-the-trading-example-using-netbeans-ide"><a class="anchor" href="#to-run-the-trading-example-using-netbeans-ide"></a>To Run the trading Example Using NetBeans IDE</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>From the File menu, choose Open Project.</p>
</li>
<li>
<p>In the Open Project dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/connectors</pre>
</div>
</div>
</li>
<li>
<p>Select the <code>trading</code> folder.</p>
</li>
<li>
<p>Click Open Project.</p>
</li>
<li>
<p>In the Projects tab, expand the <code>trading</code> node.</p>
</li>
<li>
<p>Right-click the <code>trading-eis</code> module and select Open Project.</p>
</li>
<li>
<p>Right-click the <code>trading-eis</code> project and select Run.</p>
<div class="paragraph">
<p>The messages from the EIS appear in the Output tab:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Trade execution server listening on port 4004.</pre>
</div>
</div>
</li>
<li>
<p>Right-click the <code>trading-ear</code> project and select Build.</p>
<div class="paragraph">
<p>This command packages the resource adapter and the web application in an EAR file and deploys it to GlassFish Server.</p>
</div>
</li>
<li>
<p>Open the following URL in a web browser:</p>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080/trading/</pre>
</div>
</div>
<div class="paragraph">
<p>The web interface enables you to connect to the EIS and submit trades.
The server log shows the requests from the web application and the call sequence that provides connection handles from the resource adapter.</p>
</div>
</li>
<li>
<p>Before undeploying the <code>trading-ear</code> application, close the <code>trading-eis</code> application from the status bar.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-run-the-trading-example-using-maven"><a class="anchor" href="#to-run-the-trading-example-using-maven"></a>To Run the trading Example Using Maven</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>In a terminal window, go to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/connectors/trading/</pre>
</div>
</div>
</li>
<li>
<p>Enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">mvn install</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command builds and packages the resource adapter and the web application into an EAR archive and deploys it to GlassFish Server.</p>
</div>
</li>
<li>
<p>In the same terminal window, go to the <code>trading-eis</code> directory:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">cd trading-eis</code></pre>
</div>
</div>
</li>
<li>
<p>Enter the following command to run the trade execution platform:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">mvn exec:java</code></pre>
</div>
</div>
<div class="paragraph">
<p>The messages from the EIS appear in the terminal window:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Trade execution server listening on port 4004.</pre>
</div>
</div>
</li>
<li>
<p>Open the following URL in a web browser:</p>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080/trading/</pre>
</div>
</div>
<div class="paragraph">
<p>The web interface enables you to connect to the EIS and submit trades.
The server log shows the requests from the web application and the call sequence that provides connection handles from the resource adapter.</p>
</div>
</li>
<li>
<p>Before undeploying the <code>trading-ear</code> application, press Ctrl+C on the terminal window to close the <code>trading-eis</code> application.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="the-traffic-example"><a class="anchor" href="#the-traffic-example"></a>The traffic Example</h3>
<div class="paragraph">
<p>The <code>traffic</code> example demonstrates how to implement and use a simple inbound resource adapter that receives data from a legacy EIS using a TCP socket.</p>
</div>
<div class="paragraph">
<p>The example is in the <code><em>tut-install</em>/examples/connectors/traffic</code> directory.
See <a href="#using-the-tutorial-examples">Chapter 2, <em>Using the Tutorial Examples</em></a> for basic information on building and running sample applications.</p>
</div>
<div class="paragraph">
<p>The example demonstrates the scenario in <a href="#the-traffic-example-2">Figure 57-3</a> and consists of the following modules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>traffic-eis</code>: A Java SE program that simulates an EIS</p>
</li>
<li>
<p><code>traffic-rar</code>: The inbound resource adapter implementation</p>
</li>
<li>
<p><code>traffic-ejb</code>: A message-driven bean that is the endpoint for incoming messages</p>
</li>
<li>
<p><code>traffic-war</code>: A web application that displays information from the message-driven bean</p>
</li>
<li>
<p><code>traffic-ear</code>: An enterprise archive that contains the resource adapter, the message-driven bean, and the web application</p>
</li>
</ul>
</div>
<div id="the-traffic-example-2" class="imageblock">
<div class="content">
<img src="images/jakartaeett_dt_056.svg" alt="This figure shows the components of the traffic example: a WAR communicating with an enterprise bean using a JMS topic, and a RAR communicating with an EIS over a TCP socket.">
</div>
<div class="title">Figure 57-3 The traffic Example</div>
</div>
<div class="paragraph">
<p>The <code>traffic-eis</code> module is an auxiliary project that resembles a legacy traffic information system.
It contains a Java SE program that sends traffic status updates for several cities to any subscribed client.
The program sends the updates in JSON format over a TCP socket.
For example, a traffic update looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{<span class="key"><span class="delimiter">&quot;</span><span class="content">report</span><span class="delimiter">&quot;</span></span>:[
    {<span class="key"><span class="delimiter">&quot;</span><span class="content">city</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">City1</span><span class="delimiter">&quot;</span></span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">access</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">AccessA</span><span class="delimiter">&quot;</span></span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">status</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">GOOD</span><span class="delimiter">&quot;</span></span>},
    {<span class="key"><span class="delimiter">&quot;</span><span class="content">city</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">City1</span><span class="delimiter">&quot;</span></span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">access</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">AccessB</span><span class="delimiter">&quot;</span></span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">status</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">CONGESTED</span><span class="delimiter">&quot;</span></span>},
    <span class="error">.</span><span class="error">.</span><span class="error">.</span>
    {<span class="key"><span class="delimiter">&quot;</span><span class="content">city</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">City5</span><span class="delimiter">&quot;</span></span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">access</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">AccessE</span><span class="delimiter">&quot;</span></span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">status</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">SLOW</span><span class="delimiter">&quot;</span></span>}
 ]}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>traffic-rar</code> module implements the inbound contract of the Jakarta Connectors specification.
This module subscribes to the traffic information system using the TCP port indicated by the configuration provided by the MDB and invokes the methods of the MDB to process traffic information updates.</p>
</div>
<div class="paragraph">
<p>The <code>traffic-ejb</code> module contains a message-driven bean that activates the resource adapter with a configuration parameter (the TCP port to subscribe to the traffic information system).
The MDB contains a method to process the traffic information updates.
This method filters the updates for a particular city and publishes the results to a Jakarta Messaging topic.</p>
</div>
<div class="paragraph">
<p>The <code>traffic-war</code> module contains a message-driven bean that receives filtered traffic information updates from the Jakarta Messaging topic asynchronously and sends them to the clients using a WebSocket endpoint.</p>
</div>
<div class="sect3">
<h4 id="using-the-inbound-resource-adapter"><a class="anchor" href="#using-the-inbound-resource-adapter"></a>Using the Inbound Resource Adapter</h4>
<div class="paragraph">
<p>In most cases, Jakarta EE application developers use inbound resource adapters developed by a third party.
To use an inbound resource adapter, a Jakarta EE application includes a message-driven bean with the following characteristics.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The MDB implements the business interface defined by the resource adapter.</p>
</li>
<li>
<p>The MDB specifies configuration parameters to activate the resource adapter.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The business interface defined by the resource adapter is not specified in the Jakarta Connectors specification; it is specific to the EIS.</p>
</div>
<div class="paragraph">
<p>The MDB in this example is defined as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@MessageDriven</span>(
    activationConfig = {
      <span class="annotation">@ActivationConfigProperty</span>(propertyName = <span class="string"><span class="delimiter">&quot;</span><span class="content">port</span><span class="delimiter">&quot;</span></span>,
                                propertyValue = <span class="string"><span class="delimiter">&quot;</span><span class="content">4008</span><span class="delimiter">&quot;</span></span>)
    }
)
<span class="directive">public</span> <span class="type">class</span> <span class="class">TrafficMdb</span> <span class="directive">implements</span> TrafficListener { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>TrafficListener</code> interface is defined in the API package of the resource adapter.
The resource adapter requires the MDB to provide the <code>port</code> property.</p>
</div>
<div class="paragraph">
<p>When the MDB is deployed, it activates the <code>traffic-rar</code> resource adapter, which invokes the methods of the MDB to process traffic information updates.
Then the MDB filters the updates for a particular city and publishes the results to a Jakarta Messaging topic.</p>
</div>
<div class="paragraph">
<p>In this particular example, the <code>TrafficListener</code> interface is empty.
In addition to this interface, the resource adapter provides the <code>TrafficCommand</code> annotation and uses reflection to discover which methods in the MDB are decorated with this annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@MessageDriven</span>(...)
<span class="directive">public</span> <span class="type">class</span> <span class="class">TrafficMdb</span> <span class="directive">implements</span> TrafficListener {

    <span class="annotation">@TrafficCommand</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">report</span><span class="delimiter">&quot;</span></span>, info=<span class="string"><span class="delimiter">&quot;</span><span class="content">Process report</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> processReport(<span class="predefined-type">String</span> jsonReport) { ... }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This approach enables you to adapt the MDB to support new features in the EIS without having to modify the <code>TrafficListener</code> interface or the resource adapter module.</p>
</div>
</div>
<div class="sect3">
<h4 id="implementing-the-inbound-resource-adapter"><a class="anchor" href="#implementing-the-inbound-resource-adapter"></a>Implementing the Inbound Resource Adapter</h4>
<div class="paragraph">
<p>The <code>traffic-rar</code> module implements the Jakarta Connectors inbound resource adapter contract for the simple traffic information system (EIS) used in this example.
The architecture of the inbound resource adapter is shown in <a href="#architecture-of-the-traffic-example">Figure 57-4</a>.</p>
</div>
<div id="architecture-of-the-traffic-example" class="imageblock">
<div class="content">
<img src="images/jakartaeett_dt_057.svg" alt="This figure shows the classes in each of the components of the traffic example.">
</div>
<div class="title">Figure 57-4 Architecture of the traffic Example</div>
</div>
<div class="paragraph">
<p>The <code>traffic-rar</code> module implements the interfaces listed in <a href="#interfaces-implemented-in-the-traffic-rar-module">Table 57-3</a>.</p>
</div>
<table id="interfaces-implemented-in-the-traffic-rar-module" class="tableblock frame-all grid-all" style="width: 99%;">
<caption class="title">Table 57-3 Interfaces Implemented in the traffic-rar Module</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Package</th>
<th class="tableblock halign-left valign-top">Interface</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jakarta.resource.spi</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ResourceAdapter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the lifecycle methods of the resource adapter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jakarta.resource.spi</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ActivationSpec</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the configuration parameters that the MDB provides to activate the inbound resource adapter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jakarta.resource.spi</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Work</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The traffic service subscriber implements this interface from the work management contract to wait for traffic updates on a separate thread.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>When an MDB activates the inbound resource adapter, the container invokes the <code>endpointActivation</code> method in the <code>TrafficResourceAdapter</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Connector</span>(...)
<span class="directive">public</span> <span class="type">class</span> <span class="class">TrafficResourceAdapter</span> <span class="directive">implements</span> ResourceAdapter, <span class="predefined-type">Serializable</span> {
    ...
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> endpointActivation(MessageEndpointFactory endpointFactory,
                                   ActivationSpec spec)
                                   <span class="directive">throws</span> ResourceException {
        <span class="predefined-type">Class</span> endpointClass = endpointFactory.getEndpointClass();
        <span class="comment">/* this method is called from a new thread in the example:
        MessageEndpoint endpoint = endpointFactory.createEndpoint(null); */</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>getEndpointClass</code> method returns the <code>Class</code> type of the MDB performing the activation, which enables the resource adapter to use reflection to find methods annotated with <code>@TrafficCommand</code> in the MDB.</p>
</div>
<div class="paragraph">
<p>The <code>createEndpoint</code> method returns an instance of the MDB.
The resource adapter uses this instance to invoke the methods of the MDB when it receives requests from the EIS.</p>
</div>
<div class="paragraph">
<p>After obtaining the message endpoint instance (MDB), the resource adapter uses the work management contract to create the traffic service subscriber thread that receives traffic updates from the EIS.
The resource adapter obtains the <code>WorkManager</code> instance from the bootstrap context as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">WorkManager workManager;
...
<span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> start(BootstrapContext ctx) ... {
    workManager = ctx.getWorkManager();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The resource adapter schedules the traffic service subscriber thread using the work manager:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">tSubscriber = <span class="keyword">new</span> TrafficServiceSubscriber(tSpec, endpoint);
workManager.scheduleWork(tSubscriber);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>TrafficServiceSubscriber</code> class implements the <code>jakarta.resource.spi.Work</code> interface from the work management contract.</p>
</div>
<div class="paragraph">
<p>The traffic service subscriber thread uses reflection to invoke the methods in the MDB:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">private</span> <span class="predefined-type">String</span> callMdb(MessageEndpoint mdb, <span class="predefined-type">Method</span> command,
                       <span class="predefined-type">String</span>... params) ... {
    <span class="predefined-type">String</span> resp;
    <span class="comment">/* this code contains proper exception handling in the sources */</span>
    mdb.beforeDelivery(command);
    <span class="predefined-type">Object</span> ret = command.invoke(mdb, (<span class="predefined-type">Object</span><span class="type">[]</span>) params);
    resp = (<span class="predefined-type">String</span>) ret;
    mdb.afterDelivery();
    <span class="keyword">return</span> resp;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more details, see the code and the comments in the traffic-rar module.</p>
</div>
</div>
<div class="sect3">
<h4 id="running-the-traffic-example"><a class="anchor" href="#running-the-traffic-example"></a>Running the traffic Example</h4>
<div class="paragraph">
<p>You can use either NetBeans IDE or Maven to build, package, deploy, and run the <code>traffic</code> example.</p>
</div>
<div class="sect4">
<h5 id="to-run-the-traffic-example-using-netbeans-ide"><a class="anchor" href="#to-run-the-traffic-example-using-netbeans-ide"></a>To Run the traffic Example Using NetBeans IDE</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>From the File menu, choose Open Project.</p>
</li>
<li>
<p>In the Open Project dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/connectors</pre>
</div>
</div>
</li>
<li>
<p>Select the <code>traffic</code> folder.</p>
</li>
<li>
<p>Click Open Project.</p>
</li>
<li>
<p>In the Projects tab, expand the <code>traffic</code> node.</p>
</li>
<li>
<p>Right-click the <code>traffic-eis</code> module and select Open Project.</p>
</li>
<li>
<p>Right-click the <code>traffic-eis</code> project and select Run.</p>
<div class="paragraph">
<p>The messages from the EIS appear on the Output tab:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Traffic EIS accepting connections on port 4008</pre>
</div>
</div>
</li>
<li>
<p>In the Projects tab, right-click the <code>traffic</code> project and select Clean and Build.</p>
<div class="paragraph">
<p>This command builds and packages the resource adapter, the MDB, and the web application into an EAR archive and deploys it.
The server log shows the call sequence that activates the resource adapter and the filtered traffic updates for City1.</p>
</div>
</li>
<li>
<p>Open the following URL in a web browser:</p>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080/traffic/</pre>
</div>
</div>
<div class="paragraph">
<p>The web interface shows filtered traffic updates for City1 every few seconds.</p>
</div>
</li>
<li>
<p>After undeploying the <code>traffic-ear</code> application, close the <code>traffic-eis</code> application from the status bar.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-run-the-traffic-example-using-maven"><a class="anchor" href="#to-run-the-traffic-example-using-maven"></a>To Run the traffic Example Using Maven</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>In a terminal window, go to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/connectors/traffic/traffic-eis/</pre>
</div>
</div>
</li>
<li>
<p>Enter the following command in the terminal window:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">mvn install</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command builds and packages the traffic EIS.</p>
</div>
</li>
<li>
<p>Enter the following command in the terminal window:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">mvn exec:java</code></pre>
</div>
</div>
<div class="paragraph">
<p>The messages from the EIS appear in the terminal window:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Traffic EIS accepting connections on port 4008</pre>
</div>
</div>
<div class="paragraph">
<p>Leave this terminal window open.</p>
</div>
</li>
<li>
<p>Open a new terminal window and go to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/connectors/traffic/</pre>
</div>
</div>
</li>
<li>
<p>Enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">mvn install</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command builds and packages the resource adapter, the MDB, and the web application into an EAR archive and deploys it.
The server log shows the call sequence that activates the resource adapter and the filtered traffic updates for City1.</p>
</div>
</li>
<li>
<p>Open the following URL in a web browser:</p>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080/traffic/</pre>
</div>
</div>
<div class="paragraph">
<p>The web interface shows the filtered traffic updates for City1 every few seconds.</p>
</div>
</li>
<li>
<p>After undeploying the <code>traffic-ear</code> application, press Ctrl+C in the first terminal window to close the <code>traffic-eis</code> application.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using-jakarta-ee-interceptors"><a class="anchor" href="#using-jakarta-ee-interceptors"></a>Chapter 58. Using Jakarta EE Interceptors</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter discusses how to create interceptor classes and methods that interpose on method invocations or lifecycle events on a target class.</p>
</div>
<div class="sect2">
<h3 id="overview-of-interceptors"><a class="anchor" href="#overview-of-interceptors"></a>Overview of Interceptors</h3>
<div class="paragraph">
<p>Interceptors are used in conjunction with Jakarta EE managed classes to allow developers to invoke interceptor methods on an associated target class, in conjunction with method invocations or lifecycle events.
Common uses of interceptors are logging, auditing, and profiling.</p>
</div>
<div class="paragraph">
<p>You can use interceptors with session beans, message-driven beans, and CDI managed beans.
In all of these cases, the interceptor target class is the bean class.</p>
</div>
<div class="paragraph">
<p>An interceptor can be defined within a target class as an interceptor method, or in an associated class called an interceptor class.
Interceptor classes contain methods that are invoked in conjunction with the methods or lifecycle events of the target class.</p>
</div>
<div class="paragraph">
<p>Interceptor classes and methods are defined using metadata annotations, or in the deployment descriptor of the application that contains the interceptors and target classes.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Applications that use the deployment descriptor to define interceptors are not portable across Jakarta EE servers.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Interceptor methods within the target class or in an interceptor class are annotated with one of the metadata annotations defined in <a href="#interceptor-metadata-annotations">Table 58-1</a>.</p>
</div>
<table id="interceptor-metadata-annotations" class="tableblock frame-all grid-all" style="width: 80%;">
<caption class="title">Table 58-1 Interceptor Metadata Annotations</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Interceptor Metadata Annotation</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jakarta.interceptor.AroundConstruct</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Designates the method as an interceptor method that receives a callback after the target class is constructed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jakarta.interceptor.AroundInvoke</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Designates the method as an interceptor method</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jakarta.interceptor.AroundTimeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Designates the method as a timeout interceptor for interposing on timeout methods for enterprise bean timers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jakarta.annotation.PostConstruct</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Designates the method as an interceptor method for post-construct lifecycle events</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jakarta.annotation.PreDestroy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Designates the method as an interceptor method for pre-destroy lifecycle events</p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="interceptor-classes"><a class="anchor" href="#interceptor-classes"></a>Interceptor Classes</h4>
<div class="paragraph">
<p>Interceptor classes may be designated with the optional <code>jakarta.interceptor.Interceptor</code> annotation, but interceptor classes are not required to be so annotated.
An interceptor class must have a public, no-argument constructor.</p>
</div>
<div class="paragraph">
<p>The target class can have any number of interceptor classes associated with it.
The order in which the interceptor classes are invoked is determined by the order in which the interceptor classes are defined in the <code>jakarta.interceptor.Interceptors</code> annotation.
However, this order can be overridden in the deployment descriptor.</p>
</div>
<div class="paragraph">
<p>Interceptor classes may be targets of dependency injection.
Dependency injection occurs when the interceptor class instance is created, using the naming context of the associated target class, and before any <code>@PostConstruct</code> callbacks are invoked.</p>
</div>
</div>
<div class="sect3">
<h4 id="interceptor-lifecycle"><a class="anchor" href="#interceptor-lifecycle"></a>Interceptor Lifecycle</h4>
<div class="paragraph">
<p>Interceptor classes have the same lifecycle as their associated target class.
When a target class instance is created, an interceptor class instance is also created for each declared interceptor class in the target class.
That is, if the target class declares multiple interceptor classes, an instance of each class is created when the target class instance is created.
The target class instance and all interceptor class instances are fully instantiated before any <code>@PostConstruct</code> callbacks are invoked, and any <code>@PreDestroy</code> callbacks are invoked before the target class and interceptor class instances are destroyed.</p>
</div>
</div>
<div class="sect3">
<h4 id="interceptors-and-cdi"><a class="anchor" href="#interceptors-and-cdi"></a>Interceptors and CDI</h4>
<div class="paragraph">
<p>Jakarta Contexts and Dependency Injection (CDI) builds on the basic functionality of Jakarta EE interceptors.
For information on CDI interceptors, including a discussion of interceptor binding types, see <a href="#using-interceptors-in-cdi-applications">Using Interceptors in CDI Applications</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-interceptors"><a class="anchor" href="#using-interceptors"></a>Using Interceptors</h3>
<div class="paragraph">
<p>To define an interceptor, use one of the interceptor metadata annotations listed in <a href="#interceptor-metadata-annotations">Table 58-1</a> within the target class, or in a separate interceptor class.
The following code declares an <code>@AroundTimeout</code> interceptor method within a target class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Stateless</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">TimerBean</span> {
    ...
    <span class="annotation">@Schedule</span>(minute=<span class="string"><span class="delimiter">&quot;</span><span class="content">*/1</span><span class="delimiter">&quot;</span></span>, hour=<span class="string"><span class="delimiter">&quot;</span><span class="content">*</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> automaticTimerMethod() { ... }

    <span class="annotation">@AroundTimeout</span>
    <span class="directive">public</span> <span class="type">void</span> timeoutInterceptorMethod(InvocationContext ctx) { ... }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you are using interceptor classes, use the <code>jakarta.interceptor.Interceptors</code> annotation to declare one or more interceptors at the class or method level of the target class.
The following code declares interceptors at the class level:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Stateless</span>
<span class="annotation">@Interceptors</span>({PrimaryInterceptor.class, SecondaryInterceptor.class})
<span class="directive">public</span> <span class="type">class</span> <span class="class">OrderBean</span> { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following code declares a method-level interceptor class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Stateless</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">OrderBean</span> {
    ...
    <span class="annotation">@Interceptors</span>(OrderInterceptor.class)
    <span class="directive">public</span> <span class="type">void</span> placeOrder(Order order) { ... }
    ...
}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="intercepting-method-invocations"><a class="anchor" href="#intercepting-method-invocations"></a>Intercepting Method Invocations</h4>
<div class="paragraph">
<p>Use the <code>@AroundInvoke</code> annotation to designate interceptor methods for managed object methods.
Only one around-invoke interceptor method per class is allowed.
Around-invoke interceptor methods have the following form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@AroundInvoke</span>
visibility <span class="predefined-type">Object</span> method-name(InvocationContext) <span class="directive">throws</span> <span class="exception">Exception</span> { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@AroundInvoke</span>
<span class="directive">public</span> <span class="type">void</span> interceptOrder(InvocationContext ctx) { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Around-invoke interceptor methods can have public, private, protected, or package-level access, and must not be declared static or final.</p>
</div>
<div class="paragraph">
<p>An around-invoke interceptor can call any component or resource that is callable by the target method on which it interposes, can have the same security and transaction context as the target method, and can run in the same Java virtual machine call stack as the target method.</p>
</div>
<div class="paragraph">
<p>Around-invoke interceptors can throw runtime exceptions and any exception allowed by the <code>throws</code> clause of the target method.
They may catch and suppress exceptions, and then recover by calling the <code>InvocationContext.proceed</code> method.</p>
</div>
<div class="sect4">
<h5 id="using-multiple-method-interceptors"><a class="anchor" href="#using-multiple-method-interceptors"></a>Using Multiple Method Interceptors</h5>
<div class="paragraph">
<p>Use the <code>@Interceptors</code> annotation to declare multiple interceptors for a target method or class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Interceptors</span>({PrimaryInterceptor.class, SecondaryInterceptor.class,
        LastInterceptor.class})
<span class="directive">public</span> <span class="type">void</span> updateInfo(<span class="predefined-type">String</span> info) { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The order of the interceptors in the <code>@Interceptors</code> annotation is the order in which the interceptors are invoked.</p>
</div>
<div class="paragraph">
<p>You can also define multiple interceptors in the deployment descriptor.
The order of the interceptors in the deployment descriptor is the order in which the interceptors will be invoked:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">...
<span class="tag">&lt;interceptor-binding&gt;</span>
    <span class="tag">&lt;target-name&gt;</span>myapp.OrderBean<span class="tag">&lt;/target-name&gt;</span>
    <span class="tag">&lt;interceptor-class&gt;</span>myapp.PrimaryInterceptor.class<span class="tag">&lt;/interceptor-class&gt;</span>
    <span class="tag">&lt;interceptor-class&gt;</span>myapp.SecondaryInterceptor.class<span class="tag">&lt;/interceptor-class&gt;</span>
    <span class="tag">&lt;interceptor-class&gt;</span>myapp.LastInterceptor.class<span class="tag">&lt;/interceptor-class&gt;</span>
    <span class="tag">&lt;method-name&gt;</span>updateInfo<span class="tag">&lt;/method-name&gt;</span>
<span class="tag">&lt;/interceptor-binding&gt;</span>
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>To explicitly pass control to the next interceptor in the chain, call the <code>InvocationContext.proceed</code> method.</p>
</div>
<div class="paragraph">
<p>Data can be shared across interceptors.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The same <code>InvocationContext</code> instance is passed as an input parameter to each interceptor method in the interceptor chain for a particular target method.
The <code>InvocationContext</code> instance&#8217;s <code>contextData</code> property is used to pass data across interceptor methods.
The <code>contextData</code> property is a <code>java.util.Map&lt;String, Object&gt;</code> object.
Data stored in <code>contextData</code> is accessible to interceptor methods further down the interceptor chain.</p>
</li>
<li>
<p>The data stored in <code>contextData</code> is not sharable across separate target class method invocations.
That is, a different <code>InvocationContext</code> object is created for each invocation of the method in the target class.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="accessing-target-method-parameters-from-an-interceptor-class"><a class="anchor" href="#accessing-target-method-parameters-from-an-interceptor-class"></a>Accessing Target Method Parameters from an Interceptor Class</h5>
<div class="paragraph">
<p>You can use the <code>InvocationContext</code> instance passed to each around-invoke method to access and modify the parameters of the target method.
The <code>parameters</code> property of <code>InvocationContext</code> is an array of <code>Object</code> instances that corresponds to the parameter order of the target method.
For example, for the following target method, the <code>parameters</code> property, in the <code>InvocationContext</code> instance passed to the around-invoke interceptor method in <code>PrimaryInterceptor</code>, is an <code>Object</code> array containing two <code>String</code> objects (<code>firstName</code> and <code>lastName</code>) and a <code>Date</code> object (<code>date</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Interceptors</span>(PrimaryInterceptor.class)
<span class="directive">public</span> <span class="type">void</span> updateInfo(<span class="predefined-type">String</span> firstName, <span class="predefined-type">String</span> lastName, <span class="predefined-type">Date</span> date) { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can access and modify the parameters by using the <code>InvocationContext.getParameters</code> and <code>InvocationContext.setParameters</code> methods, respectively.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="intercepting-lifecycle-callback-events"><a class="anchor" href="#intercepting-lifecycle-callback-events"></a>Intercepting Lifecycle Callback Events</h4>
<div class="paragraph">
<p>Interceptors for lifecycle callback events (around-construct, post-construct, and pre-destroy) may be defined in the target class or in interceptor classes.
The <code>jakarta.interceptor.AroundConstruct</code> annotation designates the method as an interceptor method that interposes on the invocation of the target class&#8217;s constructor.
The <code>jakarta.annotation.PostConstruct</code> annotation is used to designate a method as a post-construct lifecycle event interceptor.
The <code>jakarta.annotation.PreDestroy</code> annotation is used to designate a method as a pre-destroy lifecycle event interceptor.</p>
</div>
<div class="paragraph">
<p>Lifecycle event interceptors defined within the target class have the following form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">void</span> method-name() { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@PostConstruct</span>
<span class="type">void</span> initialize() { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Lifecycle event interceptors defined in an interceptor class have the following form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">void</span> method-name(InvocationContext) { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@PreDestroy</span>
<span class="type">void</span> cleanup(InvocationContext ctx) { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Lifecycle interceptor methods can have public, private, protected, or package-level access, and must not be declared static or final.
Lifecycle interceptors may throw runtime exceptions but cannot throw checked exceptions.</p>
</div>
<div class="paragraph">
<p>Lifecycle interceptor methods are called in an unspecified security and transaction context.
That is, portable Jakarta EE applications should not assume the lifecycle event interceptor method has access to a security or transaction context.
Only one interceptor method for each lifecycle event (post-create and pre-destroy) is allowed per class.</p>
</div>
<div class="sect4">
<h5 id="using-aroundconstruct-interceptor-methods"><a class="anchor" href="#using-aroundconstruct-interceptor-methods"></a>Using AroundConstruct Interceptor Methods</h5>
<div class="paragraph">
<p><code>@AroundConstruct</code> methods are interposed on the invocation of the target class&#8217;s constructor.
Methods decorated with <code>@AroundConstruct</code> may only be defined within interceptor classes or superclasses of interceptor classes.
You may not use <code>@AroundConstruct</code> methods within the target class.</p>
</div>
<div class="paragraph">
<p>The <code>@AroundConstruct</code> method is called after dependency injection has been completed for all interceptors associated with the target class.
The target class is created and the target class&#8217;s constructor injection is performed after all associated <code>@AroundConstruct</code> methods have called the <code>Invocation.proceed</code> method.
At that point, dependency injection for the target class is completed, and then any <code>@PostConstruct</code> callback methods are invoked.</p>
</div>
<div class="paragraph">
<p><code>@AroundConstruct</code> methods can access the constructed target instance after calling <code>Invocation.proceed</code> by calling the <code>InvocationContext.getTarget</code> method.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
Calling methods on the target instance from an <code>@AroundConstruct</code> method is dangerous because dependency injection may not have completed on the target instance.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>@AroundConstruct</code> methods must call <code>Invocation.proceed</code> in order to create the target instance.
If an <code>@AroundConstruct</code> method does not call <code>Invocation.proceed</code>, the target instance will not be created.</p>
</div>
</div>
<div class="sect4">
<h5 id="using-multiple-lifecycle-callback-interceptors"><a class="anchor" href="#using-multiple-lifecycle-callback-interceptors"></a>Using Multiple Lifecycle Callback Interceptors</h5>
<div class="paragraph">
<p>You can define multiple lifecycle interceptors for a target class by specifying the interceptor classes in the <code>@Interceptors</code> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Interceptors</span>({PrimaryInterceptor.class, SecondaryInterceptor.class,
        LastInterceptor.class})
<span class="annotation">@Stateless</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">OrderBean</span> { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Data stored in the <code>contextData</code> property of <code>InvocationContext</code> is not sharable across different lifecycle events.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="intercepting-timeout-events"><a class="anchor" href="#intercepting-timeout-events"></a>Intercepting Timeout Events</h4>
<div class="paragraph">
<p>You can define interceptors for Enterprise Bean timer service timeout methods by using the <code>@AroundTimeout</code> annotation on methods in the target class or in an interceptor class.
Only one <code>@AroundTimeout</code> method per class is allowed.</p>
</div>
<div class="paragraph">
<p>Timeout interceptors have the following form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Object</span> method-name(InvocationContext) <span class="directive">throws</span> <span class="exception">Exception</span> { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@AroundTimeout</span>
<span class="directive">protected</span> <span class="type">void</span> timeoutInterceptorMethod(InvocationContext ctx) { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Timeout interceptor methods can have public, private, protected, or package-level access, and must not be declared static or final.</p>
</div>
<div class="paragraph">
<p>Timeout interceptors can call any component or resource callable by the target timeout method, and are invoked in the same transaction and security context as the target method.</p>
</div>
<div class="paragraph">
<p>Timeout interceptors may access the timer object associated with the target timeout method through the <code>InvocationContext</code> instance&#8217;s <code>getTimer</code> method.</p>
</div>
<div class="sect4">
<h5 id="using-multiple-timeout-interceptors"><a class="anchor" href="#using-multiple-timeout-interceptors"></a>Using Multiple Timeout Interceptors</h5>
<div class="paragraph">
<p>You can define multiple timeout interceptors for a given target class by specifying the interceptor classes containing <code>@AroundTimeout</code> interceptor methods in an <code>@Interceptors</code> annotation at the class level.</p>
</div>
<div class="paragraph">
<p>If a target class specifies timeout interceptors in an interceptor class, and also has an <code>@AroundTimeout</code> interceptor method within the target class itself, the timeout interceptors in the interceptor classes are called first, followed by the timeout interceptors defined in the target class.
For example, in the following example, assume that both the <code>PrimaryInterceptor</code> and <code>SecondaryInterceptor</code> classes have timeout interceptor methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Interceptors</span>({PrimaryInterceptor.class, SecondaryInterceptor.class})
<span class="annotation">@Stateful</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">OrderBean</span> {
    ...
    <span class="annotation">@AroundTimeout</span>
    <span class="directive">private</span> <span class="type">void</span> last(InvocationContext ctx) { ... }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The timeout interceptor in <code>PrimaryInterceptor</code> will be called first, followed by the timeout interceptor in <code>SecondaryInterceptor</code>, and finally the <code>last</code> method defined in the target class.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="binding-interceptors-to-components"><a class="anchor" href="#binding-interceptors-to-components"></a>Binding Interceptors to Components</h4>
<div class="paragraph">
<p>Interceptor binding types are annotations that may be applied to components to associate them with a particular interceptor.
Interceptor binding types are typically custom runtime annotation types that specify the interceptor target.
Use the <code>jakarta.interceptor.InterceptorBinding</code> annotation on the custom annotation definition and specify the target by using <code>@Target</code>, setting one or more of <code>TYPE</code> (class-level interceptors), <code>METHOD</code> (method-level interceptors), <code>CONSTRUCTOR</code> (around-construct interceptors), or any other valid target:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@InterceptorBinding</span>
<span class="annotation">@Target</span>({TYPE, METHOD})
<span class="annotation">@Retention</span>(RUNTIME)
<span class="annotation">@Inherited</span>
pubic <span class="annotation">@interface</span> Logged { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Interceptor binding types may also be applied to other interceptor binding types:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Logged</span>
<span class="annotation">@InterceptorBinding</span>
<span class="annotation">@Target</span>({TYPE, METHOD})
<span class="annotation">@Retention</span>(RUNTIME)
<span class="annotation">@Inherited</span>
<span class="directive">public</span> <span class="annotation">@interface</span> Secured { ... }</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="declaring-the-interceptor-bindings-on-an-interceptor-class"><a class="anchor" href="#declaring-the-interceptor-bindings-on-an-interceptor-class"></a>Declaring the Interceptor Bindings on an Interceptor Class</h5>
<div class="paragraph">
<p>Annotate the interceptor class with the interceptor binding type and <code>@Interceptor</code> to associate the interceptor binding with the interceptor class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Logged</span>
<span class="annotation">@Interceptor</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">LoggingInterceptor</span> {
    <span class="annotation">@AroundInvoke</span>
    <span class="directive">public</span> <span class="predefined-type">Object</span> logInvocation(InvocationContext ctx) <span class="directive">throws</span> <span class="exception">Exception</span> { ... }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>An interceptor class may declare multiple interceptor binding types, and more than one interceptor class may declare an interceptor binding type.</p>
</div>
<div class="paragraph">
<p>If the interceptor class intercepts lifecycle callbacks, it can only declare interceptor binding types with <code>Target(TYPE)</code>, or in the case of <code>@AroundConstruct</code> lifecycle callbacks, <code>Target(CONSTRUCTOR)</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="binding-a-component-to-an-interceptor"><a class="anchor" href="#binding-a-component-to-an-interceptor"></a>Binding a Component to an Interceptor</h5>
<div class="paragraph">
<p>Add the interceptor binding type annotation to the target component&#8217;s class, method, or constructor.
Interceptor binding types are applied using the same rules as <code>@Interceptor</code> annotations:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Logged</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Message</span> {
    ...
    <span class="annotation">@Secured</span>
    <span class="directive">public</span> <span class="type">void</span> getConfidentialMessage() { ... }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the component has a class-level interceptor binding, it must not be <code>final</code> or have any non-<code>static</code>, non-<code>private</code> <code>final</code> methods.
If a non-<code>static</code>, non-<code>private</code> method has an interceptor binding applied to it, it must not be <code>final</code>, and the component class cannot be <code>final</code>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ordering-interceptors"><a class="anchor" href="#ordering-interceptors"></a>Ordering Interceptors</h4>
<div class="paragraph">
<p>The order in which multiple interceptors are invoked is determined by the following rules.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Default interceptors are defined in a deployment descriptor, and are invoked first.
They may specify the invocation order or override the order specified using annotations.
Default interceptors are invoked in the order in which they are defined in the deployment descriptor.</p>
</li>
<li>
<p>The order in which the interceptor classes are listed in the <code>@Interceptors</code> annotation defines the order in which the interceptors are invoked.
Any <code>@Priority</code> settings for interceptors listed within an <code>@Interceptors</code> annotation are ignored.</p>
</li>
<li>
<p>If the interceptor class has superclasses, the interceptors defined on the superclasses are invoked first, starting with the most general superclass.</p>
</li>
<li>
<p>Interceptor classes may set the priority of the interceptor methods by setting a value within a <code>jakarta.annotation.Priority</code> annotation.</p>
</li>
<li>
<p>After the interceptors defined within interceptor classes have been invoked, the target class&#8217;s constructor, around-invoke, or around-timeout interceptors are invoked in the same order as the interceptors within the <code>@Interceptors</code> annotation.</p>
</li>
<li>
<p>If the target class has superclasses, any interceptors defined on the superclasses are invoked first, starting with the most general superclass.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>@Priority</code> annotation requires an <code>int</code> value as an element.
The lower the number, the higher the priority of the associated interceptor.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The invocation order of interceptors with the same priority value is implementation-specific.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>jakarta.interceptor.Interceptor.Priority</code> class defines the priority constants listed in <a href="#interceptor-priority-constants">Table 58-2</a>.</p>
</div>
<table id="interceptor-priority-constants" class="tableblock frame-all grid-all" style="width: 99%;">
<caption class="title">Table 58-2 Interceptor Priority Constants</caption>
<colgroup>
<col style="width: 15%;">
<col style="width: 15%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Priority Constant</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PLATFORM_BEFORE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interceptors defined by the Jakarta EE Platform and intended to be invoked early in the invocation chain should use the range between <code>PLATFORM_BEFORE</code> and <code>LIBRARY_BEFORE</code>.
These interceptors have the highest priority.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LIBRARY_BEFORE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interceptors defined by extension libraries that should be invoked early in the interceptor chain should use the range between <code>LIBRARY_BEFORE</code> and <code>APPLICATION</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>APPLICATION</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interceptors defined by applications should use the range between <code>APPLICATION</code> and <code>LIBRARY_AFTER</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LIBRARY_AFTER</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Low priority interceptors defined by extension libraries should use the range between <code>LIBRARY_AFTER</code> and <code>PLATFORM_AFTER</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PLATFORM_AFTER</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Low priority interceptors defined by the Jakarta EE Platform should have values higher than <code>PLATFORM_AFTER</code>.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Negative priority values are reserved by the Interceptors specification for future use, and should not be used.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following code snippet shows how to use the priority constants in an application-defined interceptor:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Interceptor</span>
<span class="annotation">@Priority</span>(Interceptor.Priority.APPLICATION+<span class="integer">200</span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyInterceptor</span> { ... }</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="the-interceptor-example-application"><a class="anchor" href="#the-interceptor-example-application"></a>The interceptor Example Application</h3>
<div class="paragraph">
<p>The <code>interceptor</code> example demonstrates how to use an interceptor class, containing an <code>@AroundInvoke</code> interceptor method, with a stateless session bean.</p>
</div>
<div class="paragraph">
<p>The <code>HelloBean</code> stateless session bean is a simple enterprise bean with two business methods, <code>getName</code> and <code>setName</code>, to retrieve and modify a string.
The <code>setName</code> business method has an <code>@Interceptors</code> annotation that specifies an interceptor class, <code>HelloInterceptor</code>, for that method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Interceptors</span>(HelloInterceptor.class)
<span class="directive">public</span> <span class="type">void</span> setName(<span class="predefined-type">String</span> name) {
    <span class="local-variable">this</span>.name = name;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>HelloInterceptor</code> class defines an <code>@AroundInvoke</code> interceptor method, <code>modifyGreeting</code>, that converts the string passed to <code>HelloBean.setName</code> to lowercase:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@AroundInvoke</span>
<span class="directive">public</span> <span class="predefined-type">Object</span> modifyGreeting(InvocationContext ctx) <span class="directive">throws</span> <span class="exception">Exception</span> {
    <span class="predefined-type">Object</span><span class="type">[]</span> parameters = ctx.getParameters();
    <span class="predefined-type">String</span> param = (<span class="predefined-type">String</span>) parameters[<span class="integer">0</span>];
    param = param.toLowerCase();
    parameters[<span class="integer">0</span>] = param;
    ctx.setParameters(parameters);
    <span class="keyword">try</span> {
        <span class="keyword">return</span> ctx.proceed();
    } <span class="keyword">catch</span> (<span class="exception">Exception</span> e) {
        logger.warning(<span class="string"><span class="delimiter">&quot;</span><span class="content">Error calling ctx.proceed in modifyGreeting()</span><span class="delimiter">&quot;</span></span>);
        <span class="keyword">return</span> <span class="predefined-constant">null</span>;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The parameters to <code>HelloBean.setName</code> are retrieved and stored in an <code>Object</code> array by calling the <code>InvocationContext.getParameters</code> method.
Because <code>setName</code> only has one parameter, it is the first and only element in the array.
The string is set to lowercase and stored in the <code>parameters</code> array, then passed to <code>InvocationContext.setParameters</code>.
To return control to the session bean, <code>InvocationContext.proceed</code> is called.</p>
</div>
<div class="paragraph">
<p>The user interface of <code>interceptor</code> is a JavaServer Faces web application that consists of two Facelets views: <code>index.xhtml</code>, which contains a form for entering the name, and <code>response.xhtml</code>, which displays the final name.</p>
</div>
<div class="sect3">
<h4 id="running-the-interceptor-example"><a class="anchor" href="#running-the-interceptor-example"></a>Running the interceptor Example</h4>
<div class="paragraph">
<p>You can use either NetBeans IDE or Maven to build, package, deploy, and run the <code>interceptor</code> example.</p>
</div>
<div class="sect4">
<h5 id="to-run-the-interceptor-example-using-netbeans-ide"><a class="anchor" href="#to-run-the-interceptor-example-using-netbeans-ide"></a>To Run the interceptor Example Using NetBeans IDE</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>From the File menu, choose Open Project.</p>
</li>
<li>
<p>In the Open Project dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/ejb</pre>
</div>
</div>
</li>
<li>
<p>Select the <code>interceptor</code> folder and click Open Project.</p>
</li>
<li>
<p>In the Projects tab, right-click the <code>interceptor</code> project and select Run.</p>
<div class="paragraph">
<p>This will compile, deploy, and run the <code>interceptor</code> example, opening a web browser to the following URL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080/interceptor/</pre>
</div>
</div>
</li>
<li>
<p>Enter a name into the form and click Submit.</p>
<div class="paragraph">
<p>The name will be converted to lowercase by the method interceptor defined in the <code>HelloInterceptor</code> class.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-run-the-interceptor-example-using-maven"><a class="anchor" href="#to-run-the-interceptor-example-using-maven"></a>To Run the interceptor Example Using Maven</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>Go to the following directory:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/ejb/interceptor/</pre>
</div>
</div>
</li>
<li>
<p>To compile the source files and package the application, use the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">mvn install</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command builds and packages the application into a WAR file, <code>interceptor.war</code>, located in the <code>target</code> directory.
The WAR file is then deployed to GlassFish Server.</p>
</div>
</li>
<li>
<p>Open the following URL in a web browser:</p>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080/interceptor/</pre>
</div>
</div>
</li>
<li>
<p>Enter a name into the form and click Submit.</p>
<div class="paragraph">
<p>The name will be converted to lowercase by the method interceptor defined in the <code>HelloInterceptor</code> class.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="batch-processing"><a class="anchor" href="#batch-processing"></a>Chapter 59. Batch Processing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter describes Jakarta Batch, which provides support for defining, implementing, and running batch jobs.
Batch jobs are tasks that can be executed without user interaction.
The batch framework is composed of a job specification language based on XML, a Java API, and a batch runtime.</p>
</div>
<div class="sect2">
<h3 id="introduction-to-batch-processing"><a class="anchor" href="#introduction-to-batch-processing"></a>Introduction to Batch Processing</h3>
<div class="paragraph">
<p>Some enterprise applications contain tasks that can be executed without user interaction.
These tasks are executed periodically or when resource usage is low, and they often process large amounts of information such as log files, database records, or images.
Examples include billing, report generation, data format conversion, and image processing.
These tasks are called batch jobs.</p>
</div>
<div class="paragraph">
<p>Batch processing refers to running batch jobs on a computer system.
Jakarta EE includes a batch processing framework that provides the batch execution infrastructure common to all batch applications, enabling developers to concentrate on the business logic of their batch applications.
The batch framework consists of a job specification language based on XML, a set of batch annotations and interfaces for application classes that implement the business logic, a batch container that manages the execution of batch jobs, and supporting classes and interfaces to interact with the batch container.</p>
</div>
<div class="paragraph">
<p>A batch job can be completed without user intervention.
For example, consider a telephone billing application that reads phone call records from the enterprise information systems and generates a monthly bill for each account.
Since this application does not require any user interaction, it can run as a batch job.</p>
</div>
<div class="paragraph">
<p>The phone billing application consists of two phases: The first phase associates each call from the registry with a monthly bill, and the second phase calculates the tax and total amount due for each bill.
Each of these phases is a step of the batch job.</p>
</div>
<div class="paragraph">
<p>Batch applications specify a set of steps and their execution order.
Different batch frameworks may specify additional elements, like decision elements or groups of steps that run in parallel.
The following sections describe steps in more detail and provide information about other common characteristics of batch frameworks.</p>
</div>
<div class="sect3">
<h4 id="steps-in-batch-jobs"><a class="anchor" href="#steps-in-batch-jobs"></a>Steps in Batch Jobs</h4>
<div class="paragraph">
<p>A step is an independent and sequential phase of a batch job.
Batch jobs contain chunk-oriented steps and task-oriented steps.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Chunk-oriented steps (chunk steps) process data by reading items from a data source, applying some business logic to each item, and storing the results.
Chunk steps read and process one item at a time and group the results into a chunk.
The results are stored when the chunk reaches a configurable size.
Chunk-oriented processing makes storing results more efficient and facilitates transaction demarcation.</p>
<div class="paragraph">
<p>Chunk steps have three parts.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The input retrieval part reads one item at a time from a data source, such as entries on a database, files in a directory, or entries in a log file.</p>
</li>
<li>
<p>The business processing part manipulates one item at a time using the business logic defined by the application.
Examples include filtering, formatting, and accessing data from the item for computing a result.</p>
</li>
<li>
<p>The output writing part stores a chunk of processed items at a time.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Chunk steps are often long-running because they process large amounts of data.
Batch frameworks enable chunk steps to bookmark their progress using checkpoints.
A chunk step that is interrupted can be restarted from the last checkpoint.
The input retrieval and output writing parts of a chunk step save their current position after the processing of each chunk, and can recover it when the step is restarted.</p>
</div>
<div class="paragraph">
<p><a href="#chunk-steps-in-a-batch-job">Figure 59-1</a> shows the three parts of two steps in a batch job.</p>
</div>
<div id="chunk-steps-in-a-batch-job" class="imageblock">
<div class="content">
<img src="images/jakartaeett_dt_058.svg" alt="This figure shows a batch job that contains two chunk steps: step A and step B. Step A has the three parts of a chunk-oriented step: input retrieval A, business processing A, and output writing A. Step B also has the three parts of a chunk-oriented step: input retrieval B, business processing B, and output writing B.">
</div>
<div class="title">Figure 59-1 Chunk Steps in a Batch Job</div>
</div>
<div class="paragraph">
<p>For example, the phone billing application consists of two chunk steps.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In the first step, the input retrieval part reads call records from the registry; the business processing part associates each call with a bill and creates a bill if one does not exist for an account; and the output writing part stores each bill in a database.</p>
</li>
<li>
<p>In the second step, the input retrieval part reads bills from the database; the business processing part calculates the tax and total amount due for each bill; and the output writing part updates the database records and generates printable versions of each bill.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This application could also contain a task step that cleaned up the files from the bills generated for the previous month.</p>
</div>
</div>
<div class="sect3">
<h4 id="parallel-processing"><a class="anchor" href="#parallel-processing"></a>Parallel Processing</h4>
<div class="paragraph">
<p>Batch jobs often process large amounts of data or perform computationally expensive operations.
Batch applications can benefit from parallel processing in two scenarios.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Steps that do not depend on each other can run on different threads.</p>
</li>
<li>
<p>Chunk-oriented steps where the processing of each item does not depend on the results of processing previous items can run on more than one thread.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Batch frameworks provide mechanisms for developers to define groups of independent steps and to split chunk-oriented steps in parts that can run in parallel.</p>
</div>
</div>
<div class="sect3">
<h4 id="status-and-decision-elements"><a class="anchor" href="#status-and-decision-elements"></a>Status and Decision Elements</h4>
<div class="paragraph">
<p>Batch frameworks keep track of a status for every step in a job.
The status indicates if a step is running or if it has completed.
If the step has completed, the status indicates one of the following.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The execution of the step was successful.</p>
</li>
<li>
<p>The step was interrupted.</p>
</li>
<li>
<p>An error occurred in the execution of the step.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In addition to steps, batch jobs can also contain decision elements.
Decision elements use the exit status of the previous step to determine the next step or to terminate the batch job.
Decision elements set the status of the batch job when terminating it.
Like a step, a batch job can terminate successfully, be interrupted, or fail.</p>
</div>
<div class="paragraph">
<p><a href="#steps-and-decision-elements-in-a-job">Figure 59-2</a> shows an example of a job that contains chunk steps, task steps and a decision element.</p>
</div>
<div id="steps-and-decision-elements-in-a-job" class="imageblock">
<div class="content">
<img src="images/jakartaeett_dt_059.svg" alt="This figure shows a batch job that contains two chunk steps, a task step and a decision element. The job starts with chunk step A, continues with chunk step B, and then decision element D evaluates condition 1. The condition is based on the status of step B. If condition 1 is true, the job terminates; otherwise the job continues with step C and then the job ends.">
</div>
<div class="title">Figure 59-2 Steps and Decision Elements in a Job</div>
</div>
</div>
<div class="sect3">
<h4 id="batch-framework-functionality"><a class="anchor" href="#batch-framework-functionality"></a>Batch Framework Functionality</h4>
<div class="paragraph">
<p>Batch applications have the following common requirements.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Define jobs, steps, decision elements, and the relationships between them.</p>
</li>
<li>
<p>Execute some groups of steps or parts of a step in parallel.</p>
</li>
<li>
<p>Maintain state information for jobs and steps.</p>
</li>
<li>
<p>Launch jobs and resume interrupted jobs.</p>
</li>
<li>
<p>Handle errors.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Batch frameworks provide the batch execution infrastructure that addresses the common requirements of all batch applications, enabling developers to concentrate on the business logic of their applications.
Batch frameworks consist of a format to specify jobs and steps, an application programming interface (API), and a service available at runtime that manages the execution of batch jobs.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="batch-processing-in-jakarta-ee"><a class="anchor" href="#batch-processing-in-jakarta-ee"></a>Batch Processing in Jakarta EE</h3>
<div class="paragraph">
<p>This section lists the components of the batch processing framework in Jakarta EE and provides an overview of the steps you have to follow to create a batch application.</p>
</div>
<div class="sect3">
<h4 id="the-batch-processing-framework"><a class="anchor" href="#the-batch-processing-framework"></a>The Batch Processing Framework</h4>
<div class="paragraph">
<p>Jakarta EE includes a batch processing framework that consists of the following elements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A batch runtime that manages the execution of jobs</p>
</li>
<li>
<p>A job specification language based on XML</p>
</li>
<li>
<p>A Java API to interact with the batch runtime</p>
</li>
<li>
<p>A Java API to implement steps, decision elements, and other batch artifacts</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Batch applications in Jakarta EE contain XML files and Java classes.
The XML files define the structure of a job in terms of batch artifacts and the relationships between them.
(A batch artifact is a part of a chunk-oriented step, a task-oriented step, a decision element, or another component of a batch application).
The Java classes implement the application logic of the batch artifacts defined in the XML files.
The batch runtime parses the XML files and loads the batch artifacts as Java classes to run the jobs in a batch application.</p>
</div>
</div>
<div class="sect3">
<h4 id="creating-batch-applications"><a class="anchor" href="#creating-batch-applications"></a>Creating Batch Applications</h4>
<div class="paragraph">
<p>The process for creating a batch application in Jakarta EE is the
following.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Design the batch application.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Identify the input sources, the format of the input data, the desired final result, and the required processing phases.</p>
</li>
<li>
<p>Organize the application as a job with chunk-oriented steps, task-oriented steps, and decision elements.
Determine the dependencies between them.</p>
</li>
<li>
<p>Determine the order of execution in terms of transitions between steps.</p>
</li>
<li>
<p>Identify steps that can run in parallel and steps that can run in more than one thread.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Create the batch artifacts as Java classes by implementing the interfaces specified by the framework for steps, decision elements, and so on.
These Java classes contain the code to read data from input sources, format items, process items, and store results.
Batch artifacts can access context objects from the batch runtime using dependency injection.</p>
</li>
<li>
<p>Define jobs, steps, and their execution flow in XML files using the Job Specification Language.
The elements in the XML files reference batch artifacts implemented as Java classes.
The batch artifacts can access properties declared in the XML files, such as names of files and databases.</p>
</li>
<li>
<p>Use the Java API provided by the batch runtime to launch the batch application.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The following sections describe in detail how to use the components of the batch processing framework in Jakarta EE to create batch applications.</p>
</div>
</div>
<div class="sect3">
<h4 id="elements-of-a-batch-job"><a class="anchor" href="#elements-of-a-batch-job"></a>Elements of a Batch Job</h4>
<div class="paragraph">
<p>A batch job can contain one or more of the following elements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Steps</p>
</li>
<li>
<p>Flows</p>
</li>
<li>
<p>Splits</p>
</li>
<li>
<p>Decision elements</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Steps are described in <a href="#introduction-to-batch-processing">Introduction to Batch Processing</a>, and can be chunk-oriented or task-oriented.
Chunk-oriented steps can be partitioned steps.
In a partitioned chunk step, the processing of one item does not depend on other items, so these steps can run in more than one thread.</p>
</div>
<div class="paragraph">
<p>A flow is a sequence of steps that execute as a unit.
A sequence of related steps can be grouped together into a flow.
The steps in a flow cannot transition to steps outside the flow.
The flow transitions to the next element when its last step completes.</p>
</div>
<div class="paragraph">
<p>A split is a set of flows that execute in parallel; each flow runs on a separate thread.
The split transitions to the next element when all its flows complete.</p>
</div>
<div class="paragraph">
<p>Decision elements use the exit status of the previous step to determine the next step or to terminate the batch job.</p>
</div>
</div>
<div class="sect3">
<h4 id="properties-and-parameters"><a class="anchor" href="#properties-and-parameters"></a>Properties and Parameters</h4>
<div class="paragraph">
<p>Jobs and steps can have a number of properties associated with them.
You define properties in the job definition file, and batch artifacts access these properties using context objects from the batch runtime.
Using properties in this manner enables you to decouple static parameters of the job from the business logic and to reuse batch artifacts in different job definition files.</p>
</div>
<div class="paragraph">
<p>Specifying properties is described in <a href="#using-the-job-specification-language">Using the Job Specification Language</a>, and accessing properties in batch artifacts is described in <a href="#creating-batch-artifacts">Creating Batch Artifacts</a>.</p>
</div>
<div class="paragraph">
<p>Jakarta EE applications can also pass parameters to a job when they submit it to the batch runtime.
This enables you to specify dynamic parameters that are only known at runtime.
Parameters are also necessary for partitioned steps, since each partition needs to know, for example, what range of items to process.</p>
</div>
<div class="paragraph">
<p>Specifying parameters when submitting jobs is described in <a href="#submitting-jobs-to-the-batch-runtime">Submitting Jobs to the Batch Runtime</a>.
Specifying parameters for partitioned steps and accessing them in batch artifacts is demonstrated in <a href="#the-phonebilling-example-application">The phonebilling Example Application</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="job-instances-and-job-executions"><a class="anchor" href="#job-instances-and-job-executions"></a>Job Instances and Job Executions</h4>
<div class="paragraph">
<p>A job definition can have multiple instances, each with different parameters.
A job execution is an attempt to run a job instance.
The batch runtime maintains information about job instances and job executions, as described in <a href="#checking-the-status-of-a-job">Checking the Status of a Job</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="batch-and-exit-status"><a class="anchor" href="#batch-and-exit-status"></a>Batch and Exit Status</h4>
<div class="paragraph">
<p>The state of jobs, steps, splits, and flows is represented in the batch runtime as a batch status value.
Batch status values are listed <a href="#batch-status-values">Table 59-1</a>.
They are represented as strings.</p>
</div>
<table id="batch-status-values" class="tableblock frame-all grid-all" style="width: 50%;">
<caption class="title">Table 59-1 Batch Status Values</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>STARTING</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The job has been submitted to the batch runtime.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>STARTED</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The job is running.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>STOPPING</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The job has been requested to stop.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>STOPPED</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The job has stopped.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FAILED</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The job finished executing because of an error.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>COMPLETED</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The job finished executing successfully.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ABANDONED</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The job was marked abandoned.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Jakarta EE applications can submit jobs and access the batch status of a job using the <code>JobOperator</code> interface, as described in <a href="#submitting-jobs-to-the-batch-runtime">Submitting Jobs to the Batch Runtime</a>.
Job definition files can refer to batch status values using the Job Specification Language (JSL), as described in <a href="#using-the-job-specification-language">Using the Job Specification Language</a>.
Batch artifacts can access batch status values using context objects, as described in <a href="#using-the-context-objects-from-the-batch-runtime">Using the Context Objects from the Batch Runtime</a>.</p>
</div>
<div class="paragraph">
<p>For flows, the batch status is that of its last step.
For splits, the batch status is the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>COMPLETED</code>: If all its flows have a batch status of <code>COMPLETED</code></p>
</li>
<li>
<p><code>FAILED</code>: If any flow has a batch status of <code>FAILED</code></p>
</li>
<li>
<p><code>STOPPED</code>: If any flow has a batch status of <code>STOPPED</code>, and no flows have a batch status of <code>FAILED</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The batch status for jobs, steps, splits, and flows is set by the batch runtime.
Jobs, steps, splits, and flows also have an exit status, which is a user-defined value based on the batch status.
You can set the exit status inside batch artifacts or in the job definition file.
You can access the exit status in the same manner as the batch status, described above.
The default value for the exit status is the same as the batch status.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="simple-use-case"><a class="anchor" href="#simple-use-case"></a>Simple Use Case</h3>
<div class="paragraph">
<p>This section demonstrates how to define a simple job using the Job Specification Language (JSL) and how to implement the corresponding batch artifacts.
Refer to the rest of the sections in this chapter for detailed descriptions of the elements in the batch framework.</p>
</div>
<div class="paragraph">
<p>The following job definition specifies a chunk step and a task step as
follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;job</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">simplejob</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">https://jakarta.ee/xml/ns/jakartaee</span><span class="delimiter">&quot;</span></span>
                    <span class="attribute-name">version</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2.0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;properties&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">input_file</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">input.txt</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">output_file</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">output.txt</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/properties&gt;</span>
  <span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mychunk</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">next</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mytask</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;chunk&gt;</span>
      <span class="tag">&lt;reader</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MyReader</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/reader&gt;</span>
      <span class="tag">&lt;processor</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MyProcessor</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/processor&gt;</span>
      <span class="tag">&lt;writer</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MyWriter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/writer&gt;</span>
    <span class="tag">&lt;/chunk&gt;</span>
  <span class="tag">&lt;/step&gt;</span>
  <span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mytask</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;batchlet</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MyBatchlet</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/batchlet&gt;</span>
    <span class="tag">&lt;end</span> <span class="attribute-name">on</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">COMPLETED</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/step&gt;</span>
<span class="tag">&lt;/job&gt;</span></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="chunk-step"><a class="anchor" href="#chunk-step"></a>Chunk Step</h4>
<div class="paragraph">
<p>In most cases, you have to implement a checkpoint class for chunk-oriented steps.
The following class just keeps track of the line number in a text file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">MyCheckpoint</span> <span class="directive">implements</span> <span class="predefined-type">Serializable</span> {
    <span class="directive">private</span> <span class="type">long</span> lineNum = <span class="integer">0</span>;
    <span class="directive">public</span> <span class="type">void</span> increase() { lineNum++; }
    <span class="directive">public</span> <span class="type">long</span> getLineNum() { <span class="keyword">return</span> lineNum; }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following item reader implementation continues reading the input file from the provided checkpoint if the job was restarted.
The items consist of each line in the text file (in more complex scenarios, the items are custom Java types and the input source can be a database):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Dependent</span>
<span class="annotation">@Named</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">MyReader</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyReader</span> <span class="directive">implements</span> jakarta.batch.api.chunk.ItemReader {
    <span class="directive">private</span> MyCheckpoint checkpoint;
    <span class="directive">private</span> <span class="predefined-type">BufferedReader</span> breader;
    <span class="annotation">@Inject</span>
    JobContext jobCtx;

    <span class="directive">public</span> MyReader() {}

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> open(<span class="predefined-type">Serializable</span> ckpt) <span class="directive">throws</span> <span class="exception">Exception</span> {
        <span class="keyword">if</span> (ckpt == <span class="predefined-constant">null</span>)
            checkpoint = <span class="keyword">new</span> MyCheckpoint();
        <span class="keyword">else</span>
            checkpoint = (MyCheckpoint) ckpt;
        <span class="predefined-type">String</span> fileName = jobCtx.getProperties()
                                .getProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">input_file</span><span class="delimiter">&quot;</span></span>);
        breader = <span class="keyword">new</span> <span class="predefined-type">BufferedReader</span>(<span class="keyword">new</span> <span class="predefined-type">FileReader</span>(fileName));
        <span class="keyword">for</span> (<span class="type">long</span> i = <span class="integer">0</span>; i &lt; checkpoint.getLineNum(); i++)
            breader.readLine();
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> close() <span class="directive">throws</span> <span class="exception">Exception</span> {
        breader.close();
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">Object</span> readItem() <span class="directive">throws</span> <span class="exception">Exception</span> {
        <span class="predefined-type">String</span> line = breader.readLine();
        <span class="keyword">return</span> line;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the following case, the item processor only converts the line to uppercase.
More complex examples can process items in different ways or transform them into custom output Java types:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Dependent</span>
<span class="annotation">@Named</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">MyProcessor</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyProcessor</span> <span class="directive">implements</span> jakarta.batch.api.chunk.ItemProcessor {
    <span class="directive">public</span> MyProcessor() {}

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">Object</span> processItem(<span class="predefined-type">Object</span> obj) <span class="directive">throws</span> <span class="exception">Exception</span> {
        <span class="predefined-type">String</span> line = (<span class="predefined-type">String</span>) obj;
        <span class="keyword">return</span> line.toUpperCase();
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The batch processing API does not support generics.
In most cases, you need to cast items to their specific type before processing them.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The item writer writes the processed items to the output file.
It overwrites the output file if no checkpoint is provided; otherwise, it resumes writing at the end of the file.
Items are written in chunks:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Dependent</span>
<span class="annotation">@Named</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">MyWriter</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyWriter</span> <span class="directive">implements</span> jakarta.batch.api.chunk.ItemWriter {
    <span class="directive">private</span> <span class="predefined-type">BufferedWriter</span> bwriter;
    <span class="annotation">@Inject</span>
    <span class="directive">private</span> JobContext jobCtx;

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> open(<span class="predefined-type">Serializable</span> ckpt) <span class="directive">throws</span> <span class="exception">Exception</span> {
        <span class="predefined-type">String</span> fileName = jobCtx.getProperties()
                                .getProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">output_file</span><span class="delimiter">&quot;</span></span>);
        bwriter = <span class="keyword">new</span> <span class="predefined-type">BufferedWriter</span>(<span class="keyword">new</span> <span class="predefined-type">FileWriter</span>(fileName,
                                                    (ckpt != <span class="predefined-constant">null</span>)));
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> writeItems(<span class="predefined-type">List</span>&lt;<span class="predefined-type">Object</span>&gt; items) <span class="directive">throws</span> <span class="exception">Exception</span> {
        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="integer">0</span>; i &lt; items.size(); i++) {
            <span class="predefined-type">String</span> line = (<span class="predefined-type">String</span>) items.get(i);
            bwriter.write(line);
            bwriter.newLine();
        }
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">Serializable</span> checkpointInfo() <span class="directive">throws</span> <span class="exception">Exception</span> {
        <span class="keyword">return</span> <span class="keyword">new</span> MyCheckpoint();
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="task-step"><a class="anchor" href="#task-step"></a>Task Step</h4>
<div class="paragraph">
<p>The task step displays the length of the output file.
In more complex scenarios, task steps perform any task that does not fit the chunk processing programming model:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Dependent</span>
<span class="annotation">@Named</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">MyBatchlet</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyBatchlet</span> <span class="directive">implements</span> jakarta.batch.api.chunk.Batchlet {
    <span class="annotation">@Inject</span>
    <span class="directive">private</span> JobContext jobCtx;

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> process() <span class="directive">throws</span> <span class="exception">Exception</span> {
        <span class="predefined-type">String</span> fileName = jobCtx.getProperties()
                                .getProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">output_file</span><span class="delimiter">&quot;</span></span>);
        <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>+(<span class="keyword">new</span> <span class="predefined-type">File</span>(fileName)).length());
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">COMPLETED</span><span class="delimiter">&quot;</span></span>;
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-the-job-specification-language"><a class="anchor" href="#using-the-job-specification-language"></a>Using the Job Specification Language</h3>
<div class="paragraph">
<p>The Job Specification Language (JSL) enables you to define the steps in a job and their execution order using an XML file.
The following example shows how to define a simple job that contains one chunk step and one task step:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;job</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">loganalysis</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">https://jakarta.ee/xml/ns/jakartaee</span><span class="delimiter">&quot;</span></span>
                      <span class="attribute-name">version</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2.0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;properties&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">input_file</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">input1.txt</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">output_file</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">output2.txt</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/properties&gt;</span>

  <span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">logprocessor</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">next</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">cleanup</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;chunk</span> <span class="attribute-name">checkpoint-policy</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">item</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">item-count</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;reader</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.example.pkg.LogItemReader</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/reader&gt;</span>
      <span class="tag">&lt;processor</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.example.pkg.LogItemProcessor</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/processor&gt;</span>
      <span class="tag">&lt;writer</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.example.pkg.LogItemWriter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/writer&gt;</span>
    <span class="tag">&lt;/chunk&gt;</span>
  <span class="tag">&lt;/step&gt;</span>

  <span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">cleanup</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;batchlet</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.example.pkg.CleanUp</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/batchlet&gt;</span>
    <span class="tag">&lt;end</span> <span class="attribute-name">on</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">COMPLETED</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/step&gt;</span>
<span class="tag">&lt;/job&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This example defines the <code>loganalysis</code> batch job, which consists of the <code>logprocessor</code> chunk step and the <code>cleanup</code> task step.
The <code>logprocessor</code> step transitions to the <code>cleanup</code> step, which terminates the job when completed.</p>
</div>
<div class="paragraph">
<p>The <code>job</code> element defines two properties, <code>input_file</code> and <code>output_file</code>.
Specifying properties in this manner enables you to run a batch job with different configuration parameters without having to recompile its Java batch artifacts.
The batch artifacts can access these properties using the context objects from the batch runtime.</p>
</div>
<div class="paragraph">
<p>The <code>logprocessor</code> step is a chunk step that specifies batch artifacts for the reader (<code>LogItemReader</code>), the processor (<code>LogItemProcessor</code>), and the writer (<code>LogItemWriter</code>).
This step creates a checkpoint for every ten items processed.</p>
</div>
<div class="paragraph">
<p>The <code>cleanup</code> step is a task step that specifies the <code>CleanUp</code> class as its batch artifact.
The job terminates when this step completes.</p>
</div>
<div class="paragraph">
<p>The following sections describe the elements of the Job Specification Language (JSL) in more detail and show the most common attributes and child elements.</p>
</div>
<div class="sect3">
<h4 id="the-job-element"><a class="anchor" href="#the-job-element"></a>The job Element</h4>
<div class="paragraph">
<p>The <code>job</code> element is always the top-level element in a job definition file.
Its main attributes are <code>id</code> and <code>restartable</code>.
The <code>job</code> element can contain one <code>properties</code> element and zero or more of each of the following elements: <code>listener</code>, <code>step</code>, <code>flow</code>, and <code>split</code>.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;job</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jobname</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">restartable</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;listeners&gt;</span>
    <span class="tag">&lt;listener</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.example.pkg.ListenerBatchArtifact</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/listeners&gt;</span>
  <span class="tag">&lt;properties&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">propertyName1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">propertyValue1</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">propertyName2</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">propertyValue2</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/properties&gt;</span>
  <span class="tag">&lt;step</span> <span class="attribute-name">...</span><span class="tag">&gt;</span> ... <span class="tag">&lt;/step&gt;</span>
  <span class="tag">&lt;step</span> <span class="attribute-name">...</span><span class="tag">&gt;</span> ... <span class="tag">&lt;/step&gt;</span>
  <span class="tag">&lt;decision</span> <span class="attribute-name">...</span><span class="tag">&gt;</span> ... <span class="tag">&lt;/decision&gt;</span>
  <span class="tag">&lt;flow</span> <span class="attribute-name">...</span><span class="tag">&gt;</span> ... <span class="tag">&lt;/flow&gt;</span>
  <span class="tag">&lt;split</span> <span class="attribute-name">...</span><span class="tag">&gt;</span> ... <span class="tag">&lt;/split&gt;</span>
<span class="tag">&lt;/job&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>listener</code> element specifies a batch artifact whose methods are invoked before and after the execution of the job.
The batch artifact is an implementation of the <code>jakarta.batch.api.listener.JobListener</code> interface.
See <a href="#the-listener-batch-artifacts">The Listener Batch Artifacts</a> for an example of a job listener implementation.</p>
</div>
<div class="paragraph">
<p>The first <code>step</code>, <code>flow</code>, or <code>split</code> element inside the <code>job</code> element executes first.</p>
</div>
</div>
<div class="sect3">
<h4 id="the-step-element"><a class="anchor" href="#the-step-element"></a>The step Element</h4>
<div class="paragraph">
<p>The <code>step</code> element can be a child of the <code>job</code> and <code>flow</code> elements. Its main attributes are <code>id</code> and <code>next</code>. The <code>step</code> element can contain the following elements.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>One <code>chunk</code> element for chunk-oriented steps or one <code>batchlet</code> element for task-oriented steps.</p>
</li>
<li>
<p>One <code>properties</code> element (optional).</p>
<div class="paragraph">
<p>This element specifies a set of properties that batch artifacts can access using batch context objects.</p>
</div>
</li>
<li>
<p>One <code>listener</code> element (optional); one <code>listeners</code> element if more than one listener is specified.</p>
<div class="paragraph">
<p>This element specifies listener artifacts that intercept various phases of step execution.</p>
</div>
<div class="paragraph">
<p>For chunk steps, the batch artifacts for these listeners can be implementations of the following interfaces: <code>StepListener</code>, <code>ItemReadListener</code>, <code>ItemProcessListener</code>, <code>ItemWriteListener</code>, <code>ChunkListener</code>, <code>RetryReadListener</code>, <code>RetryProcessListener</code>, <code>RetryWriteListener</code>, <code>SkipReadListener</code>, <code>SkipProcessListener</code>, and <code>SkipWriteListener</code>.</p>
</div>
<div class="paragraph">
<p>For task steps, the batch artifact for these listeners must be an implementation of the <code>StepListener</code> interface.</p>
</div>
<div class="paragraph">
<p>See <a href="#the-listener-batch-artifacts">The Listener Batch Artifacts</a> for an example of an item processor listener implementation.</p>
</div>
</li>
<li>
<p>One <code>partition</code> element (optional).</p>
<div class="paragraph">
<p>This element is used in partitioned steps which execute in more than one thread.</p>
</div>
</li>
<li>
<p>One <code>end</code> element if this is the last step in a job.</p>
<div class="paragraph">
<p>This element sets the batch status to <code>COMPLETED</code>.</p>
</div>
</li>
<li>
<p>One <code>stop</code> element (optional) to stop a job at this step.</p>
<div class="paragraph">
<p>This element sets the batch status to <code>STOPPED</code>.</p>
</div>
</li>
<li>
<p>One <code>fail</code> element (optional) to terminate a job at this step.</p>
<div class="paragraph">
<p>This element sets the batch status to <code>FAILED</code>.</p>
</div>
</li>
<li>
<p>One or more <code>next</code> elements if the <code>next</code> attribute is not specified.</p>
<div class="paragraph">
<p>This element is associated with an exit status and refers to another step, a flow, a split, or a decision element.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following is an example of a chunk step:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">stepA</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">next</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">stepB</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;properties&gt;</span> ... <span class="tag">&lt;/properties&gt;</span>
  <span class="tag">&lt;listeners&gt;</span>
    <span class="tag">&lt;listener</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MyItemReadListenerImpl</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    ...
  <span class="tag">&lt;/listeners&gt;</span>
  <span class="tag">&lt;chunk</span> <span class="attribute-name">...</span><span class="tag">&gt;</span> ... <span class="tag">&lt;/chunk&gt;</span>
  <span class="tag">&lt;partition&gt;</span> ... <span class="tag">&lt;/partition&gt;</span>
  <span class="tag">&lt;end</span> <span class="attribute-name">on</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">COMPLETED</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">exit-status</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MY_COMPLETED_EXIT_STATUS</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;stop</span> <span class="attribute-name">on</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MY_TEMP_ISSUE_EXIST_STATUS</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">restart</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">step0</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;fail</span> <span class="attribute-name">on</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MY_ERROR_EXIT_STATUS</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">exit-status</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MY_ERROR_EXIT_STATUS</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/step&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following is an example of a task step:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">stepB</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">next</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">stepC</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;batchlet</span> <span class="attribute-name">...</span><span class="tag">&gt;</span> ... <span class="tag">&lt;/batchlet&gt;</span>
  <span class="tag">&lt;properties&gt;</span> ... <span class="tag">&lt;/properties&gt;</span>
  <span class="tag">&lt;listener</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MyStepListenerImpl</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/step&gt;</span></code></pre>
</div>
</div>
<div class="sect4">
<h5 id="the-chunk-element"><a class="anchor" href="#the-chunk-element"></a>The chunk Element</h5>
<div class="paragraph">
<p>The <code>chunk</code> element is a child of the <code>step</code> element for chunk-oriented steps.
The attributes of this element are listed in <a href="#attributes-of-the-chunk-element">Table 59-2</a>.</p>
</div>
<table id="attributes-of-the-chunk-element" class="tableblock frame-all grid-all" style="width: 99%;">
<caption class="title">Table 59-2 Attributes of the chunk Element</caption>
<colgroup>
<col style="width: 15%;">
<col style="width: 75%;">
<col style="width: 10%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>checkpoint-policy</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Specifies how to commit the results of processing each chunk:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>"item"</code>: the chunk is committed after processing <code>item-count</code> items</p>
</li>
<li>
<p><code>"custom"</code>: the chunk is committed according to a checkpoint algorithm specified with the <code>checkpoint-algorithm</code> element</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The checkpoint is updated when the results of a chunk are committed.</p>
</div>
<div class="paragraph">
<p>Every chunk is processed in a global Jakarta EE transaction.
If the processing of one item in the chunk fails, the transaction is rolled back and no processed items from this chunk are stored.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"item"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>item-count</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the number of items to process before committing the chunk and taking a checkpoint.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>time-limit</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Specifies the number of seconds before committing the chunk and taking a checkpoint when <code>checkpoint-policy="item"</code>.</p>
</div>
<div class="paragraph">
<p>If <code>item-count</code> items have not been processed by <code>time-limit</code> seconds, the chunk is committed and a checkpoint is taken.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0 (no limit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>buffer-items</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies if processed items are buffered until it is time to take a checkpoint.
If true, a single call to the item writer is made with a list of the buffered items before committing the chunk and taking a checkpoint.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>skip-limit</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the number of skippable exceptions to skip in this step during chunk processing.
Skippable exception classes are specified with the <code>skippable-exception-classes</code> element.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No limit</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>retry-limit</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the number of attempts to execute this step if retryable exceptions occur.
Retryable exception classes are specified with the <code>retryable-exception-classes</code> element.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No limit</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <code>chunk</code> element can contain the following elements.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>One <code>reader</code> element.</p>
<div class="paragraph">
<p>This element specifies a batch artifact that implements the <code>ItemReader</code> interface.</p>
</div>
</li>
<li>
<p>One <code>processor</code> element.</p>
<div class="paragraph">
<p>This element specifies a batch artifact that implements the <code>ItemProcessor</code> interface.</p>
</div>
</li>
<li>
<p>One <code>writer</code> element.</p>
<div class="paragraph">
<p>This element specifies a batch artifact that implements the <code>ItemWriter</code> interface.</p>
</div>
</li>
<li>
<p>One <code>checkpoint-algorithm</code> element (optional).</p>
<div class="paragraph">
<p>This element specifies a batch artifact that implements the <code>CheckpointAlgorithm</code> interface and provides a custom checkpoint policy.</p>
</div>
</li>
<li>
<p>One <code>skippable-exception-classes</code> element (optional).</p>
<div class="paragraph">
<p>This element specifies a set of exceptions thrown from the reader, writer, and processor batch artifacts that chunk processing should skip.
The <code>skip-limit</code> attribute from the <code>chunk</code> element specifies the maximum number of skipped exceptions.</p>
</div>
</li>
<li>
<p>One <code>retryable-exception-classes</code> element (optional).</p>
<div class="paragraph">
<p>This element specifies a set of exceptions thrown from the reader, writer, and processor batch artifacts that chunk processing will retry.
The <code>retry-limit</code> attribute from the <code>chunk</code> element specifies the maximum number of attempts.</p>
</div>
</li>
<li>
<p>One <code>no-rollback-exception-classes</code> element (optional).</p>
<div class="paragraph">
<p>This element specifies a set of exceptions thrown from the reader, writer, and processor batch artifacts that should not cause the batch runtime to roll back the current chunk, but to retry the current operation without a rollback instead.</p>
</div>
<div class="paragraph">
<p>For exception types not specified in this element, the current chunk is rolled back by default when an exception occurs.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following is an example of a chunk-oriented step:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">stepC</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">next</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">stepD</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;chunk</span> <span class="attribute-name">checkpoint-policy</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">item</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">item-count</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">5</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">time-limit</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">180</span><span class="delimiter">&quot;</span></span>
         <span class="attribute-name">buffer-items</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">skip-limit</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">retry-limit</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">3</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;reader</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pkg.MyItemReaderImpl</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/reader&gt;</span>
    <span class="tag">&lt;processor</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pkg.MyItemProcessorImpl</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/processor&gt;</span>
    <span class="tag">&lt;writer</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pkg.MyItemWriterImpl</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/writer&gt;</span>
    <span class="tag">&lt;skippable-exception-classes&gt;</span>
      <span class="tag">&lt;include</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pkg.MyItemException</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;exclude</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pkg.MyItemSeriousSubException</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/skippable-exception-classes&gt;</span>
    <span class="tag">&lt;retryable-exception-classes&gt;</span>
      <span class="tag">&lt;include</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pkg.MyResourceTempUnavailable</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/retryable-exception-classes&gt;</span>
  <span class="tag">&lt;/chunk&gt;</span>
<span class="tag">&lt;/step&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This example defines a chunk step and specifies its reader, processor, and writer artifacts.
The step updates a checkpoint and commits each chunk after processing five items.
It skips all <code>MyItemException</code> exceptions and all its subtypes, except for <code>MyItemSeriousSubException</code>, up to a maximum of ten skipped exceptions.
The step retries a chunk when a <code>MyResourceTempUnavailable</code> exception occurs, up to a maximum of three attempts.</p>
</div>
</div>
<div class="sect4">
<h5 id="the-batchlet-element"><a class="anchor" href="#the-batchlet-element"></a>The batchlet Element</h5>
<div class="paragraph">
<p>The <code>batchlet</code> element is a child of the <code>step</code> element for task-oriented steps.
This element only has the <code>ref</code> attribute, which specifies a batch artifact that implements the <code>Batchlet</code> interface.
The <code>batch</code> element can contain a <code>properties</code> element.</p>
</div>
<div class="paragraph">
<p>The following is an example of a task-oriented step:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">stepD</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">next</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">stepE</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;batchlet</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pkg.MyBatchletImpl</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;properties&gt;</span>
      <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pname</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pvalue</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/properties&gt;</span>
  <span class="tag">&lt;/batchlet&gt;</span>
<span class="tag">&lt;/step&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This example defines a batch step and specifies its batch artifact.</p>
</div>
</div>
<div class="sect4">
<h5 id="the-partition-element"><a class="anchor" href="#the-partition-element"></a>The partition Element</h5>
<div class="paragraph">
<p>The <code>partition</code> element is a child of the <code>step</code> element.
It indicates that a step is partitioned.
Most partitioned steps are chunk steps where the processing of each item does not depend on the results of processing previous items.
You specify the number of partitions in a step and provide each partition with specific information on which items to process, such as the following.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A range of items.
For example, partition 1 processes items 1 through 500, and partition 2 processes items 501 through 1000.</p>
</li>
<li>
<p>An input source.
For example, partition 1 processes the items in <code>input1.txt</code> and partition 2 processes the items in <code>input2.txt</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When the number of partitions, the number of items, and the input sources for a partitioned step are known at development or deployment time, you can use partition properties in the job definition file to specify partition-specific information and access these properties from the step batch artifacts.
The runtime creates as many instances of the step batch artifacts (reader, processor, and writer) as partitions, and each artifact instance receives the properties specific to its partition.</p>
</div>
<div class="paragraph">
<p>In most cases, the number of partitions, the number of items, or the input sources for a partitioned step can only be determined at runtime.
Instead of specifying partition-specific properties statically in the job definition file, you provide a batch artifact that can access your data sources at runtime and determine how many partitions are needed and what range of items each partition should process.
This batch artifact is an implementation of the <code>PartitionMapper</code> interface.
The batch runtime invokes this artifact and then uses the information it provides to instantiate the step batch artifacts (reader, writer, and processor) for each partition and to pass them partition-specific data as parameters.</p>
</div>
<div class="paragraph">
<p>The rest of this section describes the <code>partition</code> element in detail and shows two examples of job definition files: one that uses partition properties to specify a range of items for each partition, and one that relies on a <code>PartitionMapper</code> implementation to determine partition-specific information.</p>
</div>
<div class="paragraph">
<p>See <a href="#the-phone-billing-chunk-step">The Phone Billing Chunk Step</a> in <a href="#the-phonebilling-example-application">The phonebilling Example Application</a> for a complete example of a partitioned chunk step.</p>
</div>
<div class="paragraph">
<p>The <code>partition</code> element can contain the following elements.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>One <code>plan</code> element, if the <code>mapper</code> element is not specified.</p>
<div class="paragraph">
<p>This element defines the number of partitions, the number of threads, and the properties for each partition in the job definition file.
The <code>plan</code> element is useful when this information is known at development or deployment time.</p>
</div>
</li>
<li>
<p>One <code>mapper</code> element, if the <code>plan</code> element is not specified.</p>
<div class="paragraph">
<p>This element specifies a batch artifact that provides the number of partitions, the number of threads, and the properties for each partition.
The batch artifact is an implementation of the <code>PartitionMapper</code> interface.
You use this option when the information required for each partition is only known at runtime.</p>
</div>
</li>
<li>
<p>One <code>reducer</code> element (optional).</p>
<div class="paragraph">
<p>This element specifies a batch artifact that receives control when a partitioned step begins, ends, or rolls back.
The batch artifact enables you to merge results from different partitions and perform other related operations.
The batch artifact is an implementation of the <code>PartitionReducer</code> interface.</p>
</div>
</li>
<li>
<p>One <code>collector</code> element (optional).</p>
<div class="paragraph">
<p>This element specifies a batch artifact that sends intermediary results from each partition to a partition analyzer.
The batch artifact sends the intermediary results after each checkpoint for chunk steps and at the end of the step for task steps.
The batch artifact is an implementation of the <code>PartitionCollector</code> interface.</p>
</div>
</li>
<li>
<p>One <code>analyzer</code> element (optional).</p>
<div class="paragraph">
<p>This element specifies a batch artifact that analyzes the intermediary results from the partition collector instances.
The batch artifact is an implementation of the <code>PartitionAnalyzer</code> interface.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following is an example of a partitioned step using the <code>plan</code> element:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">stepE</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">next</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">stepF</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;chunk&gt;</span>
    <span class="tag">&lt;reader</span> <span class="attribute-name">...</span><span class="tag">&gt;</span><span class="tag">&lt;/reader&gt;</span>
    <span class="tag">&lt;processor</span> <span class="attribute-name">...</span><span class="tag">&gt;</span><span class="tag">&lt;/processor&gt;</span>
    <span class="tag">&lt;writer</span> <span class="attribute-name">...</span><span class="tag">&gt;</span><span class="tag">&lt;/writer&gt;</span>
  <span class="tag">&lt;/chunk&gt;</span>
  <span class="tag">&lt;partition&gt;</span>
    <span class="tag">&lt;plan</span> <span class="attribute-name">partitions</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">threads</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;properties</span> <span class="attribute-name">partition</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">firstItem</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">lastItem</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">500</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/properties&gt;</span>
      <span class="tag">&lt;properties</span> <span class="attribute-name">partition</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">firstItem</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">501</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">lastItem</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">999</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/properties&gt;</span>
    <span class="tag">&lt;/plan&gt;</span>
  <span class="tag">&lt;/partition&gt;</span>
  <span class="tag">&lt;reducer</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MyPartitionReducerImpl</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;collector</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MyPartitionCollectorImpl</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;analyzer</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MyPartitionAnalyzerImpl</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/step&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the <code>plan</code> element specifies the properties for each partition in the job definition file.</p>
</div>
<div class="paragraph">
<p>The following example uses a <code>mapper</code> element instead of a <code>plan</code> element.
The <code>PartitionMapper</code> implementation dynamically provides the same information as the <code>plan</code> element provides in the job definition file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">stepE</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">next</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">stepF</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;chunk&gt;</span>
    <span class="tag">&lt;reader</span> <span class="attribute-name">...</span><span class="tag">&gt;</span><span class="tag">&lt;/reader&gt;</span>
    <span class="tag">&lt;processor</span> <span class="attribute-name">...</span><span class="tag">&gt;</span><span class="tag">&lt;/processor&gt;</span>
    <span class="tag">&lt;writer</span> <span class="attribute-name">...</span><span class="tag">&gt;</span><span class="tag">&lt;/writer&gt;</span>
  <span class="tag">&lt;/chunk&gt;</span>
  <span class="tag">&lt;partition&gt;</span>
    <span class="tag">&lt;mapper</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MyPartitionMapperImpl</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;reducer</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MyPartitionReducerImpl</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;collector</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MyPartitionCollectorImpl</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;analyzer</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MyPartitionAnalyzerImpl</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/partition&gt;</span>
<span class="tag">&lt;/step&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Refer to <a href="#the-phonebilling-example-application">The phonebilling Example Application</a> for an example implementation of the <code>PartitionMapper</code> interface.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="the-flow-element"><a class="anchor" href="#the-flow-element"></a>The flow Element</h4>
<div class="paragraph">
<p>The <code>flow</code> element can be a child of the <code>job</code>, <code>flow</code>, and <code>split</code> elements.
Its attributes are <code>id</code> and <code>next</code>.
Flows can transition to flows, steps, splits, and decision elements.
The <code>flow</code> element can contain the following elements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>One or more <code>step</code> elements</p>
</li>
<li>
<p>One or more <code>flow</code> elements (optional)</p>
</li>
<li>
<p>One or more <code>split</code> elements (optional)</p>
</li>
<li>
<p>One or more <code>decision</code> elements (optional)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The last <code>step</code> in a flow is the one with no <code>next</code> attribute or <code>next</code> element.
Steps and other elements in a flow cannot transition to elements outside the flow.</p>
</div>
<div class="paragraph">
<p>The following is an example of the <code>flow</code> element:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;flow</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">flowA</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">next</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">stepE</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">flowAstepA</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">next</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">flowAstepB</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>...<span class="tag">&lt;/step&gt;</span>
  <span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">flowAstepB</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">next</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">flowAflowC</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>...<span class="tag">&lt;/step&gt;</span>
  <span class="tag">&lt;flow</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">flowAflowC</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">next</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">flowAsplitD</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>...<span class="tag">&lt;/flow&gt;</span>
  <span class="tag">&lt;split</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">flowAsplitD</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">next</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">flowAstepE</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>...<span class="tag">&lt;/split&gt;</span>
  <span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">flowAstepE</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>...<span class="tag">&lt;/step&gt;</span>
<span class="tag">&lt;/flow&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This example flow contains three steps, one flow, and one split.
The last step does not have the <code>next</code> attribute.
The flow transitions to <code>stepE</code> when its last step completes.</p>
</div>
</div>
<div class="sect3">
<h4 id="the-split-element"><a class="anchor" href="#the-split-element"></a>The split Element</h4>
<div class="paragraph">
<p>The <code>split</code> element can be a child of the <code>job</code> and <code>flow</code> elements.
Its attributes are <code>id</code> and <code>next</code>.
Splits can transition to splits, steps, flows, and decision elements.
The <code>split</code> element can only contain one or more <code>flow</code> elements that can only transition to other <code>flow</code> elements in the split.</p>
</div>
<div class="paragraph">
<p>The following is an example of a split with three flows that execute concurrently:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;split</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">splitA</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">next</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">stepB</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;flow</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">splitAflowA</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>...<span class="tag">&lt;/flow&gt;</span>
  <span class="tag">&lt;flow</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">splitAflowB</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>...<span class="tag">&lt;/flow&gt;</span>
  <span class="tag">&lt;flow</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">splitAflowC</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>...<span class="tag">&lt;/flow&gt;</span>
<span class="tag">&lt;/split&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="the-decision-element"><a class="anchor" href="#the-decision-element"></a>The decision Element</h4>
<div class="paragraph">
<p>The <code>decision</code> element can be a child of the <code>job</code> and <code>flow</code> elements.
Its attributes are <code>id</code> and <code>next</code>.
Steps, flows, and splits can transition to a <code>decision</code> element.
This element specifies a batch artifact that decides the next step, flow, or split to execute based on information from the execution of the previous step, flow, or split.
The batch artifact implements the <code>Decider</code> interface.
The <code>decision</code> element can contain the following elements.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>One or more <code>end</code> elements (optional).</p>
<div class="paragraph">
<p>This element sets the batch status to <code>COMPLETED</code>.</p>
</div>
</li>
<li>
<p>One or more <code>stop</code> elements (optional).</p>
<div class="paragraph">
<p>This element sets the batch status to <code>STOPPED</code>.</p>
</div>
</li>
<li>
<p>One or more <code>fail</code> elements (optional).</p>
<div class="paragraph">
<p>This element sets the batch status to <code>FAILED</code>.</p>
</div>
</li>
<li>
<p>One or more <code>next</code> elements (optional).</p>
</li>
<li>
<p>One <code>properties</code> element (optional).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following is an example of the <code>decider</code> element:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;decision</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">decisionA</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MyDeciderImpl</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;fail</span> <span class="attribute-name">on</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">FAILED</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">exit-status</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">FAILED_AT_DECIDER</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;end</span> <span class="attribute-name">on</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">COMPLETED</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">exit-status</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">COMPLETED_AT_DECIDER</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;stop</span> <span class="attribute-name">on</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MY_TEMP_ISSUE_EXIST_STATUS</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">restart</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">step2</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/decision&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="creating-batch-artifacts"><a class="anchor" href="#creating-batch-artifacts"></a>Creating Batch Artifacts</h3>
<div class="paragraph">
<p>After you define a job in terms of its batch artifacts using the Job Specification Language (JSL), you create these artifacts as Java classes that implement the interfaces in the <code>jakarta.batch.api</code> package and its subpackages.</p>
</div>
<div class="paragraph">
<p>This section lists the main batch artifact interfaces, demonstrates how to access context objects from the batch runtime, and provides some examples.</p>
</div>
<div class="sect3">
<h4 id="batch-artifact-interfaces"><a class="anchor" href="#batch-artifact-interfaces"></a>Batch Artifact Interfaces</h4>
<div class="paragraph">
<p>The following tables list the interfaces that you implement to create batch artifacts.
The interface implementations are referenced from the elements described in <a href="#using-the-job-specification-language">Using the Job Specification Language</a>.</p>
</div>
<div class="paragraph">
<p><a href="#main-batch-artifact-interfaces">Table 59-3</a> lists the interfaces to implement batch artifacts for chunk steps, task steps, and decision elements.</p>
</div>
<div class="paragraph">
<p><a href="#partition-batch-artifact-interfaces">Table 59-4</a> lists the interfaces to implement batch artifacts for partitioned steps.</p>
</div>
<div class="paragraph">
<p><a href="#listener-batch-artifact-interfaces">Table 59-5</a> lists the interfaces to implement batch artifacts for job and step listeners.</p>
</div>
<table id="main-batch-artifact-interfaces" class="tableblock frame-all grid-all" style="width: 99%;">
<caption class="title">Table 59-3 Main Batch Artifact Interfaces</caption>
<colgroup>
<col style="width: 15%;">
<col style="width: 15%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Package</th>
<th class="tableblock halign-left valign-top">Interface</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jakarta.batch.api</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Batchlet</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implements the business logic of a task-oriented step.
It is referenced from the <code>batchlet</code> element.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jakarta.batch.api</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Decider</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Decides the next step, flow, or split to execute based on information from the execution of the previous step, flow, or split.
It is referenced from the <code>decision</code> element.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jakarta.batch.api.chunk</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CheckPointAlgorithm</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implements a custom checkpoint policy for chunk steps.
It is referenced from the <code>checkpoint-algorithm</code> element inside the <code>chunk</code> element.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jakarta.batch.api.chunk</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ItemReader</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reads items from an input source in a chunk step.
It is referenced from the <code>reader</code> element inside the <code>chunk</code> element.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jakarta.batch.api.chunk</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ItemProcessor</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Processes input items to obtain output items in chunk steps.
It is referenced from the <code>processor</code> element inside the <code>chunk</code> element.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jakarta.batch.api.chunk</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ItemWriter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Writes output items in chunk steps.
It is referenced from the <code>writer</code> element inside the <code>chunk</code> element.</p></td>
</tr>
</tbody>
</table>
<table id="partition-batch-artifact-interfaces" class="tableblock frame-all grid-all" style="width: 99%;">
<caption class="title">Table 59-4 Partition Batch Artifact Interfaces</caption>
<colgroup>
<col style="width: 15%;">
<col style="width: 15%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Package</th>
<th class="tableblock halign-left valign-top">Interface</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jakarta.batch.api.partition</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PartitionPlan</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provides details on how to execute a partitioned step, such as the number of partitions, the number of threads, and the parameters for each partition.
This artifact is not referenced directly from the job definition file.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jakarta.batch.api.partition</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PartitionMapper</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provides a <code>PartitionPlan</code> object.
It is referenced from the <code>mapper</code> element inside the <code>partition</code> element.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jakarta.batch.api.partition</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PartitionReducer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Receives control when a partitioned step begins, ends, or rolls back.
It is referenced from the <code>reducer</code> element inside the <code>partition</code> element.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jakarta.batch.api.partition</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PartitionCollector</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sends intermediary results from each partition to a partition analyzer.
It is referenced from the <code>collector</code> element inside the <code>partition</code> element.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jakarta.batch.api.partition</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PartitionAnalyzer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Processes data and final results from each partition.
It is referenced from the <code>analyzer</code> element inside the <code>partition</code> element.</p></td>
</tr>
</tbody>
</table>
<table id="listener-batch-artifact-interfaces" class="tableblock frame-all grid-all" style="width: 99%;">
<caption class="title">Table 59-5 Listener Batch Artifact Interfaces</caption>
<colgroup>
<col style="width: 15%;">
<col style="width: 15%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Package</th>
<th class="tableblock halign-left valign-top">Interface</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jakarta.batch.api.listener</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JobListener</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Intercepts job execution before and after running a job.
It is referenced from the <code>listener</code> element inside the <code>job</code> element.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jakarta.batch.api.listener</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>StepListener</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Intercepts step execution before and after running a step.
It is referenced from the <code>listener</code> element inside the <code>step</code> element</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jakarta.batch.api.chunk.listener</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ChunkListener</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Intercepts chunk processing in chunk steps before and after processing each chunk, and on errors.
It is referenced from the <code>listener</code> element inside the <code>step</code> element.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jakarta.batch.api.chunk.listener</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ItemReadListener</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Intercepts item reading in chunk steps before and after reading each item, and on errors.
It is referenced from the <code>listener</code> element inside the <code>step</code> element.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jakarta.batch.api.chunk.listener</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ItemProcessListener</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Intercepts item processing in chunk steps before and after processing each item, and on errors.
It is referenced from the <code>listener</code> element inside the <code>step</code> element.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jakarta.batch.api.chunk.listener</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ItemWriteListener</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Intercepts item writing in chunk steps before and after writing each item, and on errors.
It is referenced from the <code>listener</code> element inside the <code>step</code> element.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jakarta.batch.api.chunk.listener</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RetryReadListener</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Intercepts retry item reading in chunk steps when an exception occurs.
It is referenced from the <code>listener</code> element inside the <code>step</code> element.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jakarta.batch.api.chunk.listener</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RetryProcessListener</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Intercepts retry item processing in chunk steps when an exception occurs.
It is referenced from the <code>listener</code> element inside the <code>step</code> element.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jakarta.batch.api.chunk.listener</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RetryWriteListener</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Intercepts retry item writing in chunk steps when an exception occurs.
It is referenced from the <code>listener</code> element inside the <code>step</code> element.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jakarta.batch.api.chunk.listener</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SkipReadListener</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Intercepts skippable exception handling for item readers in chunk steps.
It is referenced from the <code>listener</code> element inside the <code>step</code> element.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jakarta.batch.api.chunk.listener</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SkipProcessListener</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Intercepts skippable exception handling for item processors in chunk steps.
It is referenced from the <code>listener</code> element inside the <code>step</code> element.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jakarta.batch.api.chunk.listener</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SkipWriteListener</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Intercepts skippable exception handling for item writers in chunk steps.
It is referenced from the <code>listener</code> element inside the <code>step</code> element.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="dependency-injection-in-batch-artifacts"><a class="anchor" href="#dependency-injection-in-batch-artifacts"></a>Dependency Injection in Batch Artifacts</h4>
<div class="paragraph">
<p>To ensure that Jakarta Contexts and Dependency Injection (CDI) works in your batch artifacts, follow these steps.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Define your batch artifact implementations as CDI named beans using the <code>Named</code> annotation.</p>
<div class="paragraph">
<p>For example, define an item reader implementation in a chunk step as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Named</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">MyItemReaderImpl</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyItemReaderImpl</span> <span class="directive">implements</span> ItemReader {
    <span class="comment">/* ... Override the ItemReader interface methods ... */</span>
}</code></pre>
</div>
</div>
</li>
<li>
<p>Provide a public, empty, no-argument constructor for your batch artifacts.</p>
<div class="paragraph">
<p>For example, provide the following constructor for the artifact above:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> MyItemReaderImpl() {}</code></pre>
</div>
</div>
</li>
<li>
<p>Specify the CDI name for the batch artifacts in the job definition file, instead of using the fully qualified name of the class.</p>
<div class="paragraph">
<p>For example, define the step for the artifact above as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">stepA</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">next</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">stepB</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;chunk&gt;</span>
    <span class="tag">&lt;reader</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MyItemReaderImpl</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/reader&gt;</span>
    ...
  <span class="tag">&lt;/chunk&gt;</span>
<span class="tag">&lt;/step&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This example uses the CDI name (<code>MyItemReaderImpl</code>) instead of the fully qualified name of the class (<code>com.example.pkg.MyItemReaderImpl</code>) to specify a batch artifact.</p>
</div>
</li>
<li>
<p>Ensure that your module is a CDI bean archive by annotating your batch artifacts with the <code>jakarta.enterprise.context.Dependent</code> annotation or by including an empty <code>beans.xml</code> deployment description with your application.
For example, the following batch artifact is annotated with <code>@Dependent</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Dependent</span>
<span class="annotation">@Named</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">MyItemReaderImpl</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyItemReaderImpl</span> <span class="directive">implements</span> ItemReader { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information on bean archives, see <a href="#packaging-cdi-applications">Packaging CDI Applications</a> in <a href="#jakarta-contexts-and-dependency-injection-advanced-topics">Chapter 27, <em>Jakarta Contexts and Dependency Injection: Advanced Topics</em></a>.</p>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Jakarta Contexts and Dependency Injection (CDI) is required in order to access context objects from the batch runtime in batch artifacts.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You may encounter the following errors if you do not follow this procedure.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The batch runtime cannot locate some batch artifacts.</p>
</li>
<li>
<p>The batch artifacts throw null pointer exceptions when accessing injected objects.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="using-the-context-objects-from-the-batch-runtime"><a class="anchor" href="#using-the-context-objects-from-the-batch-runtime"></a>Using the Context Objects from the Batch Runtime</h4>
<div class="paragraph">
<p>The batch runtime provides context objects that implement the <code>JobContext</code> and <code>StepContext</code> interfaces in the <code>jakarta.batch.runtime.context</code> package.
These objects are associated with the current job and step, respectively, and enable you to do the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Get information from the current job or step, such as its name, instance ID, execution ID, batch status, and exit status</p>
</li>
<li>
<p>Set the user-defined exit status</p>
</li>
<li>
<p>Store user data</p>
</li>
<li>
<p>Get property values from the job or step definition</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can inject context objects from the batch runtime inside batch artifact implementations like item readers, item processors, item writers, batchlets, listeners, and so on.
The following example demonstrates how to access property values from the job definition file in an item reader implementation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Dependent</span>
<span class="annotation">@Named</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">MyItemReaderImpl</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyItemReaderImpl</span> <span class="directive">implements</span> ItemReader {
    <span class="annotation">@Inject</span>
    JobContext jobCtx;

    <span class="directive">public</span> MyItemReaderImpl() {}

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> open(<span class="predefined-type">Serializable</span> checkpoint) <span class="directive">throws</span> <span class="exception">Exception</span> {
        <span class="predefined-type">String</span> fileName = jobCtx.getProperties()
                                .getProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">log_file_name</span><span class="delimiter">&quot;</span></span>);
        ...
    }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>See <a href="#dependency-injection-in-batch-artifacts">Dependency Injection in Batch Artifacts</a> for instructions on how to define your batch artifacts to use dependency injection.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Do not access batch context objects inside artifact constructors.</p>
</div>
<div class="paragraph">
<p>Because the job does not run until you submit it to the batch runtime, the batch context objects are not available when CDI instantiates your artifacts upon loading your application.
The instantiation of these beans fails and the batch runtime cannot find your batch artifacts when your application submits the job.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="submitting-jobs-to-the-batch-runtime"><a class="anchor" href="#submitting-jobs-to-the-batch-runtime"></a>Submitting Jobs to the Batch Runtime</h3>
<div class="paragraph">
<p>The <code>JobOperator</code> interface in the <code>jakarta.batch.operations</code> package enables you to submit jobs to the batch runtime and obtain information about existing jobs.
This interface provides the following functionality.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Obtain the names of all known jobs.</p>
</li>
<li>
<p>Start, stop, restart, and abandon jobs.</p>
</li>
<li>
<p>Obtain job instances and job executions.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>BatchRuntime</code> class in the <code>jakarta.batch.runtime</code> package provides the <code>getJobOperator</code> factory method to obtain <code>JobOperator</code> objects.</p>
</div>
<div class="sect3">
<h4 id="starting-a-job"><a class="anchor" href="#starting-a-job"></a>Starting a Job</h4>
<div class="paragraph">
<p>The following example code demonstrates how to obtain a <code>JobOperator</code> object and submit a batch job:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">JobOperator jobOperator = BatchRuntime.getJobOperator();
<span class="predefined-type">Properties</span> props = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();
props.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">parameter1</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">value1</span><span class="delimiter">&quot;</span></span>);
...
long execID = jobOperator.start(<span class="string"><span class="delimiter">&quot;</span><span class="content">simplejob</span><span class="delimiter">&quot;</span></span>, props);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first argument of the <code>JobOperator.start</code> method is the name of the job as specified in its job definition file.
The second parameter is a <code>Properties</code> object that represents the parameters for this job execution.
You can use job parameters to pass to a job information that is only known at runtime.</p>
</div>
</div>
<div class="sect3">
<h4 id="checking-the-status-of-a-job"><a class="anchor" href="#checking-the-status-of-a-job"></a>Checking the Status of a Job</h4>
<div class="paragraph">
<p>The <code>JobExecution</code> interface in the <code>jakarta.batch.runtime</code> package provides methods to obtain information about submitted jobs.
This interface provides the following functionality.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Obtain the batch and exit status of a job execution.</p>
</li>
<li>
<p>Obtain the time the execution was started, updated, or ended.</p>
</li>
<li>
<p>Obtain the job name.</p>
</li>
<li>
<p>Obtain the execution ID.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following example code demonstrates how to obtain the batch status of a job using its execution ID:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">JobExecution jobExec = jobOperator.getJobExecution(execID);
<span class="predefined-type">String</span> status = jobExec.getBatchStatus().toString();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="invoking-the-batch-runtime-in-your-application"><a class="anchor" href="#invoking-the-batch-runtime-in-your-application"></a>Invoking the Batch Runtime in Your Application</h4>
<div class="paragraph">
<p>The component from which you invoke the batch runtime depends on the architecture of your particular application.
For example, you can invoke the batch runtime from an enterprise bean, a servlet, a managed bean, and so on.</p>
</div>
<div class="paragraph">
<p>See <a href="#the-webserverlog-example-application">The webserverlog Example Application</a> and <a href="#the-phonebilling-example-application">The phonebilling Example Application</a> for details on how to invoke the batch runtime from a managed bean driven by a Jakarta Faces user interface.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="packaging-batch-applications"><a class="anchor" href="#packaging-batch-applications"></a>Packaging Batch Applications</h3>
<div class="paragraph">
<p>Job definition files and batch artifacts do not require separate packaging and can be included in any Jakarta EE application.</p>
</div>
<div class="paragraph">
<p>Package the batch artifact classes with the rest of the classes of your application, and include the job definition files in one of the following directories:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>META-INF/batch-jobs/</code> for <code>jar</code> packages</p>
</li>
<li>
<p><code>WEB-INF/classes/META-INF/batch-jobs/</code> for <code>war</code> packages</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The name of each job definition file must match its job ID.
For example, if you define a job as follows, and you are packaging your application as a WAR file, include the job definition file in <code>WEB-INF/classes/META-INF/batch-jobs/simplejob.xml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;job</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">simplejob</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">https://jakarta.ee/xml/ns/jakartaee</span><span class="delimiter">&quot;</span></span>
                    <span class="attribute-name">version</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2.0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  ...
<span class="tag">&lt;/job&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="the-webserverlog-example-application"><a class="anchor" href="#the-webserverlog-example-application"></a>The webserverlog Example Application</h3>
<div class="paragraph">
<p>The <code>webserverlog</code> example application, located in the <code><em>tut-install</em>/examples/batch/webserverlog/</code> directory, demonstrates how to use the batch framework in Jakarta EE to analyze the log file from a web server.
This example application reads a log file and finds what percentage of page views from tablet devices are product sales.</p>
</div>
<div class="sect3">
<h4 id="architecture-of-the-webserverlog-example-application"><a class="anchor" href="#architecture-of-the-webserverlog-example-application"></a>Architecture of the webserverlog Example Application</h4>
<div class="paragraph">
<p>The <code>webserverlog</code> example application consists of the following elements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A job definition file (<code>webserverlog.xml</code>) that uses the Job Specification Language (JSL) to define a batch job with a chunk step and a task step.
The chunk step acts as a filter, and the task step calculates statistics on the remaining entries.</p>
</li>
<li>
<p>A log file (<code>log1.txt</code>) that serves as input data to the batch job.</p>
</li>
<li>
<p>Two Java classes (<code>LogLine</code> and <code>LogFilteredLine</code>) that represent input items and output items for the chunk step.</p>
</li>
<li>
<p>Three batch artifacts (<code>LogLineReader</code>, <code>LogLineProcessor</code>, and <code>LogFilteredLineWriter</code>) that implement the chunk step of the application.
This step reads items from the web server log file, filters them by the web browser used by the client, and writes the results to a text file.</p>
</li>
<li>
<p>Two batch artifacts (<code>InfoJobListener</code> and <code>InfoItemProcessListener</code>) that implement two simple listeners.</p>
</li>
<li>
<p>A batch artifact (<code>MobileBatchlet.java</code>) that calculates statistics on the filtered items.</p>
</li>
<li>
<p>Two Facelets pages (<code>index.xhtml</code> and <code>jobstarted.xhtml</code>) that provide the front end of the batch application.
The first page shows the log file that will be processed by the batch job, and the second page enables the user to check on the status of the job and shows the results.</p>
</li>
<li>
<p>A managed bean (<code>JsfBean</code>) that is accessed from the Facelets pages.
The bean submits the job to the batch runtime, checks on the status of the job, and reads the results from a text file.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="the-job-definition-file"><a class="anchor" href="#the-job-definition-file"></a>The Job Definition File</h5>
<div class="paragraph">
<p>The <code>webserverlog.xml</code> job definition file is located in the <code>WEB-INF/classes/META-INF/batch-jobs/</code> directory.
The file specifies seven job-level properties and two steps:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;job</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">webserverlog</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">https://jakarta.ee/xml/ns/jakartaee</span><span class="delimiter">&quot;</span></span>
     <span class="attribute-name">version</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2.0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;properties&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">log_file_name</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">log1.txt</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">filtered_file_name</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">filtered1.txt</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">num_browsers</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">browser_1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Tablet Browser D</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">browser_2</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Tablet Browser E</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">buy_page</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/auth/buy.html</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">out_file_name</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">result1.txt</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/properties&gt;</span>
    <span class="tag">&lt;listeners&gt;</span>
        <span class="tag">&lt;listener</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">InfoJobListener</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/listeners&gt;</span>
    <span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mobilefilter</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">next</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mobileanalyzer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span> ... <span class="tag">&lt;/step&gt;</span>
    <span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mobileanalyzer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span> ... <span class="tag">&lt;/step&gt;</span>
<span class="tag">&lt;/job&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The first step is defined as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mobilefilter</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">next</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mobileanalyzer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;listeners&gt;</span>
        <span class="tag">&lt;listener</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">InfoItemProcessListeners</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/listeners&gt;</span>
    <span class="tag">&lt;chunk</span> <span class="attribute-name">checkpoint-policy</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">item</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">item-count</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;reader</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">LogLineReader</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/reader&gt;</span>
        <span class="tag">&lt;processor</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">LogLineProcessor</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/processor&gt;</span>
        <span class="tag">&lt;writer</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">LogFilteredLineWriter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/writer&gt;</span>
    <span class="tag">&lt;/chunk&gt;</span>
<span class="tag">&lt;/step&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This step is a normal chunk step that specifies the batch artifacts that implement each phase of the step.
The batch artifact names are not fully qualified class names, so the batch artifacts are CDI beans annotated with <code>@Named</code>.</p>
</div>
<div class="paragraph">
<p>The second step is defined as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mobileanalyzer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;batchlet</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MobileBatchlet</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/batchlet&gt;</span>
    <span class="tag">&lt;end</span> <span class="attribute-name">on</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">COMPLETED</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/step&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This step is a task step that specifies the batch artifact that implements it.
This is the last step of the job.</p>
</div>
</div>
<div class="sect4">
<h5 id="the-logline-and-logfilteredline-items"><a class="anchor" href="#the-logline-and-logfilteredline-items"></a>The LogLine and LogFilteredLine Items</h5>
<div class="paragraph">
<p>The <code>LogLine</code> class represents entries in the web server log file and it is defined as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">LogLine</span> {
    <span class="directive">private</span> <span class="directive">final</span> <span class="predefined-type">String</span> datetime;
    <span class="directive">private</span> <span class="directive">final</span> <span class="predefined-type">String</span> ipaddr;
    <span class="directive">private</span> <span class="directive">final</span> <span class="predefined-type">String</span> browser;
    <span class="directive">private</span> <span class="directive">final</span> <span class="predefined-type">String</span> url;

    <span class="comment">/* ... Constructor, getters, and setters ... */</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>LogFileteredLine</code> class is similar to this class but only has two fields: the IP address of the client and the URL.</p>
</div>
</div>
<div class="sect4">
<h5 id="the-chunk-step-batch-artifacts"><a class="anchor" href="#the-chunk-step-batch-artifacts"></a>The Chunk Step Batch Artifacts</h5>
<div class="paragraph">
<p>The first step is composed of the <code>LogLineReader</code>, <code>LogLineProcessor</code>, and <code>LogFilteredLineWriter</code> batch artifacts.</p>
</div>
<div class="paragraph">
<p>The <code>LogLineReader</code> artifact reads records from the web server log file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Dependent</span>
<span class="annotation">@Named</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">LogLineReader</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">LogLineReader</span> <span class="directive">implements</span> ItemReader {
    <span class="directive">private</span> ItemNumberCheckpoint checkpoint;
    <span class="directive">private</span> <span class="predefined-type">String</span> fileName;
    <span class="directive">private</span> <span class="predefined-type">BufferedReader</span> breader;
    <span class="annotation">@Inject</span>
    <span class="directive">private</span> JobContext jobCtx;

    <span class="directive">public</span> LogLineReader() { }

    <span class="comment">/* ... Override the open, close, readItem, and
     *     checkpointInfo methods ... */</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>open</code> method reads the <code>log_file_name</code> property and opens the log file with a buffered reader.
In this example, the log file has been included with the application under <code>webserverlog/WEB-INF/classes/log1.txt</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">fileName = jobCtx.getProperties().getProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">log_file_name</span><span class="delimiter">&quot;</span></span>);
<span class="predefined-type">ClassLoader</span> classLoader = <span class="predefined-type">Thread</span>.currentThread().getContextClassLoader();
<span class="predefined-type">InputStream</span> iStream = classLoader.getResourceAsStream(fileName);
breader = <span class="keyword">new</span> <span class="predefined-type">BufferedReader</span>(<span class="keyword">new</span> <span class="predefined-type">InputStreamReader</span>(iStream));</code></pre>
</div>
</div>
<div class="paragraph">
<p>If a checkpoint object is provided, the <code>open</code> method advances the reader up to the last checkpoint.
Otherwise, this method creates a new checkpoint object.
The checkpoint object keeps track of the line number from the last committed chunk.</p>
</div>
<div class="paragraph">
<p>The <code>readItem</code> method returns a new <code>LogLine</code> object or null at the end of the log file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Override</span>
<span class="directive">public</span> <span class="predefined-type">Object</span> readItem() <span class="directive">throws</span> <span class="exception">Exception</span> {
    <span class="predefined-type">String</span> entry = breader.readLine();
    <span class="keyword">if</span> (entry != <span class="predefined-constant">null</span>) {
        checkpoint.nextLine();
        <span class="keyword">return</span> <span class="keyword">new</span> LogLine(entry);
    } <span class="keyword">else</span> {
        <span class="keyword">return</span> <span class="predefined-constant">null</span>;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>LogLineProcessor</code> artifact obtains a list of browsers from the job properties and filters the log entries according to the list:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Override</span>
<span class="directive">public</span> <span class="predefined-type">Object</span> processItem(<span class="predefined-type">Object</span> item) {
    <span class="comment">/* Obtain a list of browsers we are interested in */</span>
    <span class="keyword">if</span> (nbrowsers == <span class="integer">0</span>) {
        <span class="predefined-type">Properties</span> props = jobCtx.getProperties();
        nbrowsers = <span class="predefined-type">Integer</span>.parseInt(props.getProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">num_browsers</span><span class="delimiter">&quot;</span></span>));
        browsers = <span class="keyword">new</span> <span class="predefined-type">String</span>[nbrowsers];
        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="integer">1</span>; i &lt; nbrowsers + <span class="integer">1</span>; i++)
            browsers[i - <span class="integer">1</span>] = props.getProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">browser_</span><span class="delimiter">&quot;</span></span> + i);
    }

    LogLine logline = (LogLine) item;
    <span class="comment">/* Filter for only the mobile/tablet browsers as specified */</span>
    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="integer">0</span>; i &lt; nbrowsers; i++) {
        <span class="keyword">if</span> (logline.getBrowser().equals(browsers[i])) {
            <span class="keyword">return</span> <span class="keyword">new</span> LogFilteredLine(logline);
        }
    }
    <span class="keyword">return</span> <span class="predefined-constant">null</span>;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>LogFilteredLineWriter</code> artifact reads the name of the output file from the job properties.
The <code>open</code> method opens the file for writing.
If a checkpoint object is provided, the artifact continues writing at the end of the file; otherwise, it overwrites the file if it exists.
The <code>writeItems</code> method writes filtered items to the output file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> writeItems(<span class="predefined-type">List</span>&lt;<span class="predefined-type">Object</span>&gt; items) <span class="directive">throws</span> <span class="exception">Exception</span> {
    <span class="comment">/* Write the filtered lines to the output file */</span>
    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="integer">0</span>; i &lt; items.size(); i++) {
        LogFilteredLine filtLine = (LogFilteredLine) items.get(i);
        bwriter.write(filtLine.toString());
        bwriter.newLine();
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="the-listener-batch-artifacts"><a class="anchor" href="#the-listener-batch-artifacts"></a>The Listener Batch Artifacts</h5>
<div class="paragraph">
<p>The <code>InfoJobListener</code> batch artifact implements a simple listener that writes log messages when the job starts and when it ends:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Dependent</span>
<span class="annotation">@Named</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">InfoJobListener</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">InfoJobListener</span> <span class="directive">implements</span> JobListener {
    ...
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> beforeJob() <span class="directive">throws</span> <span class="exception">Exception</span> {
        logger.log(<span class="predefined-type">Level</span>.INFO, <span class="string"><span class="delimiter">&quot;</span><span class="content">The job is starting</span><span class="delimiter">&quot;</span></span>);
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> afterJob() <span class="directive">throws</span> <span class="exception">Exception</span> { ... }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>InfoItemProcessListener</code> batch artifact implements the <code>ItemProcessListener</code> interface for chunk steps:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Dependent</span>
<span class="annotation">@Named</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">InfoItemProcessListener</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">InfoItemProcessListener</span> <span class="directive">implements</span> ItemProcessListener {
    ...
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> beforeProcess(<span class="predefined-type">Object</span> o) <span class="directive">throws</span> <span class="exception">Exception</span> {
        LogLine logline = (LogLine) o;
        llogger.log(<span class="predefined-type">Level</span>.INFO, <span class="string"><span class="delimiter">&quot;</span><span class="content">Processing entry {0}</span><span class="delimiter">&quot;</span></span>, logline);
    }
    ...
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="the-task-step-batch-artifact"><a class="anchor" href="#the-task-step-batch-artifact"></a>The Task Step Batch Artifact</h5>
<div class="paragraph">
<p>The task step is implemented by the <code>MobileBatchlet</code> artifact, which computes what percentage of the filtered log entries are purchases:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Override</span>
<span class="directive">public</span> <span class="predefined-type">String</span> process() <span class="directive">throws</span> <span class="exception">Exception</span> {
    <span class="comment">/* Get properties from the job definition file */</span>
    ...
    <span class="comment">/* Count from the output of the previous chunk step */</span>
    breader = <span class="keyword">new</span> <span class="predefined-type">BufferedReader</span>(<span class="keyword">new</span> <span class="predefined-type">FileReader</span>(fileName));
    <span class="predefined-type">String</span> line = breader.readLine();
    <span class="keyword">while</span> (line != <span class="predefined-constant">null</span>) {
        <span class="predefined-type">String</span><span class="type">[]</span> lineSplit = line.split(<span class="string"><span class="delimiter">&quot;</span><span class="content">, </span><span class="delimiter">&quot;</span></span>);
        <span class="keyword">if</span> (buyPage.compareTo(lineSplit[<span class="integer">1</span>]) == <span class="integer">0</span>)
            pageVisits++;
        totalVisits++;
        line = breader.readLine();
    }
    breader.close();
    <span class="comment">/* Write the result */</span>
    ...
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="the-jakarta-faces-pages"><a class="anchor" href="#the-jakarta-faces-pages"></a>The Jakarta Faces Pages</h5>
<div class="paragraph">
<p>The <code>index.xhtml</code> page contains a text area that shows the web server log.
The page provides a button for the user to submit the batch job and navigate to the next page:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;body&gt;</span>
    ...
    <span class="tag">&lt;textarea</span> <span class="attribute-name">cols</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">90</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">rows</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">25</span><span class="delimiter">&quot;</span></span>
              <span class="attribute-name">readonly</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>#{jsfBean.getInputLog()}<span class="tag">&lt;/textarea&gt;</span>
    <span class="tag">&lt;p&gt;</span> <span class="tag">&lt;/p&gt;</span>
    <span class="tag">&lt;h:form&gt;</span>
        <span class="tag">&lt;h:commandButton</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Start Batch Job</span><span class="delimiter">&quot;</span></span>
                         <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{jsfBean.startBatchJob()}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;/h:form&gt;</span>
<span class="tag">&lt;/body&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This page calls the methods of the managed bean to show the log file and submit the batch job.</p>
</div>
<div class="paragraph">
<p>The <code>jobstarted.xhtml</code> page provides a button to check the current status of the batch job and displays the results when the job finishes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;p&gt;</span>Current Status of the Job: <span class="tag">&lt;b&gt;</span>#{jsfBean.jobStatus}<span class="tag">&lt;/b&gt;</span><span class="tag">&lt;/p&gt;</span>
<span class="tag">&lt;p&gt;</span>#{jsfBean.showResults()}<span class="tag">&lt;/p&gt;</span>
<span class="tag">&lt;h:form&gt;</span>
    <span class="tag">&lt;h:commandButton</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Check Status</span><span class="delimiter">&quot;</span></span>
                     <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jobstarted</span><span class="delimiter">&quot;</span></span>
                     <span class="attribute-name">rendered</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{jsfBean.completed==false}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/h:form&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="the-managed-bean-2"><a class="anchor" href="#the-managed-bean-2"></a>The Managed Bean</h5>
<div class="paragraph">
<p>The <code>JsfBean</code> managed bean submits the job to the batch runtime, checks on the status of the job, and reads the results from a text file.</p>
</div>
<div class="paragraph">
<p>The <code>startBatchJob</code> method submits the job to the batch runtime:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">/* Submit the batch job to the batch runtime.
 * JSF Navigation method (return the name of the next page) */</span>
<span class="directive">public</span> <span class="predefined-type">String</span> startBatchJob() {
    jobOperator = BatchRuntime.getJobOperator();
    execID = jobOperator.start(<span class="string"><span class="delimiter">&quot;</span><span class="content">webserverlog</span><span class="delimiter">&quot;</span></span>, <span class="predefined-constant">null</span>);
    <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">jobstarted</span><span class="delimiter">&quot;</span></span>;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>getJobStatus</code> method checks the status of the job:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">/* Get the status of the job from the batch runtime */</span>
<span class="directive">public</span> <span class="predefined-type">String</span> getJobStatus() {
    <span class="keyword">return</span> jobOperator.getJobExecution(execID).getBatchStatus().toString();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>showResults</code> method reads the results from a text file.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="running-the-webserverlog-example-application"><a class="anchor" href="#running-the-webserverlog-example-application"></a>Running the webserverlog Example Application</h4>
<div class="paragraph">
<p>You can use either NetBeans IDE or Maven to build, package, deploy, and run the <code>webserverlog</code> example application.</p>
</div>
<div class="sect4">
<h5 id="to-run-the-webserverlog-example-application-using-netbeans-ide"><a class="anchor" href="#to-run-the-webserverlog-example-application-using-netbeans-ide"></a>To Run the webserverlog Example Application Using NetBeans IDE</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>From the File menu, choose Open Project.</p>
</li>
<li>
<p>In the Open Project dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/batch</pre>
</div>
</div>
</li>
<li>
<p>Select the <code>webserverlog</code> folder.</p>
</li>
<li>
<p>Click Open Project.</p>
</li>
<li>
<p>In the Projects tab, right-click the <code>webserverlog</code> project and select Run.</p>
<div class="paragraph">
<p>This command builds and packages the application into a WAR file, <code>webserverlog.war</code>, located in the <code>target/</code> directory; deploys it to the server; and launches a web browser window at the following URL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080/webserverlog/</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-run-the-webserverlog-example-application-using-maven"><a class="anchor" href="#to-run-the-webserverlog-example-application-using-maven"></a>To Run the webserverlog Example Application Using Maven</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>In a terminal window, go to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/batch/webserverlog/</pre>
</div>
</div>
</li>
<li>
<p>Enter the following command to deploy the application:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">mvn install</code></pre>
</div>
</div>
</li>
<li>
<p>Open a web browser window at the following URL:</p>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080/webserverlog/</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="the-phonebilling-example-application"><a class="anchor" href="#the-phonebilling-example-application"></a>The phonebilling Example Application</h3>
<div class="paragraph">
<p>The <code>phonebilling</code> example application, located in the <code><em>tut-install</em>/examples/batch/phonebilling/</code> directory, demonstrates how to use the batch framework in Jakarta EE to implement a phone billing system.
This example application processes a log file of phone calls and creates a bill for each customer.</p>
</div>
<div class="sect3">
<h4 id="architecture-of-the-phonebilling-example-application"><a class="anchor" href="#architecture-of-the-phonebilling-example-application"></a>Architecture of the phonebilling Example Application</h4>
<div class="paragraph">
<p>The <code>phonebilling</code> example application consists of the following elements.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A job definition file (<code>phonebilling.xml</code>) that uses the Job Specification Language (JSL) to define a batch job with two chunk steps.
The first step reads call records from a log file and associates them with a bill.
The second step computes the amount due and writes each bill to a text file.</p>
</li>
<li>
<p>A Java class (<code>CallRecordLogCreator</code>) that creates the log file for the batch job.
This is an auxiliary component that does not demonstrate any key functionality in this example.</p>
</li>
<li>
<p>Two Jakarta Persistence entities (<code>CallRecord</code> and <code>PhoneBill</code>) that represent call records and customer bills.
The application uses a Jakarta Persistence entity manager to store instances of these entities in a database.</p>
</li>
<li>
<p>Three batch artifacts (<code>CallRecordReader</code>, <code>CallRecordProcessor</code>, and <code>CallRecordWriter</code>) that implement the first step of the application.
This step reads call records from the log file, associates them with a bill, and stores them in a database.</p>
</li>
<li>
<p>Four batch artifacts (<code>BillReader</code>, <code>BillProcessor</code>, <code>BillWriter</code>, and <code>BillPartitionMapper</code>) that implement the second step of the application.
This step is a partitioned step that gets each bill from the database, calculates the amount due, and writes it to a text file.</p>
</li>
<li>
<p>Two Facelets pages (<code>index.xhtml</code> and <code>jobstarted.xhtml</code>) that provide the front end of the batch application.
The first page shows the log file that will be processed by the batch job, and the second page enables the user to check on the status of the job and shows the resulting bill for each customer.</p>
</li>
<li>
<p>A managed bean (<code>JsfBean</code>) that is accessed from the Facelets pages.
The bean submits the job to the batch runtime, checks on the status of the job, and reads the text files for each bill.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="the-job-definition-file-2"><a class="anchor" href="#the-job-definition-file-2"></a>The Job Definition File</h5>
<div class="paragraph">
<p>The <code>phonebilling.xml</code> job definition file is located in the <code>WEB-INF/classes/META-INF/batch-jobs/</code> directory.
The file specifies three job-level properties and two steps:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;job</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">phonebilling</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">https://jakarta.ee/xml/ns/jakartaee</span><span class="delimiter">&quot;</span></span>
     <span class="attribute-name">version</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2.0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;properties&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">log_file_name</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">log1.txt</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">airtime_price</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0.08</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">tax_rate</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0.07</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/properties&gt;</span>
    <span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">callrecords</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">next</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bills</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span> ... <span class="tag">&lt;/step&gt;</span>
    <span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bills</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span> ... <span class="tag">&lt;/step&gt;</span>
<span class="tag">&lt;/job&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The first step is defined as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">callrecords</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">next</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bills</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;chunk</span> <span class="attribute-name">checkpoint-policy</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">item</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">item-count</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;reader</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">CallRecordReader</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/reader&gt;</span>
        <span class="tag">&lt;processor</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">CallRecordProcessor</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/processor&gt;</span>
        <span class="tag">&lt;writer</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">CallRecordWriter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/writer&gt;</span>
    <span class="tag">&lt;/chunk&gt;</span>
<span class="tag">&lt;/step&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This step is a normal chunk step that specifies the batch artifacts that implement each phase of the step.
The batch artifact names are not fully qualified class names, so the batch artifacts are CDI beans annotated with <code>@Named</code>.</p>
</div>
<div class="paragraph">
<p>The second step is defined as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;step</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bills</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;chunk</span> <span class="attribute-name">checkpoint-policy</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">item</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">item-count</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;reader</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">BillReader</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;properties&gt;</span>
                <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">firstItem</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{partitionPlan['firstItem']}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">numItems</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{partitionPlan['numItems']}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/properties&gt;</span>
        <span class="tag">&lt;/reader&gt;</span>
        <span class="tag">&lt;processor</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">BillProcessor</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/processor&gt;</span>
        <span class="tag">&lt;writer</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">BillWriter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/writer&gt;</span>
    <span class="tag">&lt;/chunk&gt;</span>
    <span class="tag">&lt;partition&gt;</span>
        <span class="tag">&lt;mapper</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">BillPartitionMapper</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/partition&gt;</span>
    <span class="tag">&lt;end</span> <span class="attribute-name">on</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">COMPLETED</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/step&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This step is a partitioned chunk step.
The partition plan is specified through the <code>BillPartitionMapper</code> artifact instead of using the <code>plan</code> element.</p>
</div>
</div>
<div class="sect4">
<h5 id="the-callrecord-and-phonebill-entities"><a class="anchor" href="#the-callrecord-and-phonebill-entities"></a>The CallRecord and PhoneBill Entities</h5>
<div class="paragraph">
<p>The <code>CallRecord</code> entity is defined as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Entity</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">CallRecord</span> <span class="directive">implements</span> <span class="predefined-type">Serializable</span> {
    <span class="annotation">@Id</span> <span class="annotation">@GeneratedValue</span>
    <span class="directive">private</span> <span class="predefined-type">Long</span> id;
    <span class="annotation">@Temporal</span>(TemporalType.DATE)
    <span class="directive">private</span> <span class="predefined-type">Date</span> datetime;
    <span class="directive">private</span> <span class="predefined-type">String</span> fromNumber;
    <span class="directive">private</span> <span class="predefined-type">String</span> toNumber;
    <span class="directive">private</span> <span class="type">int</span> minutes;
    <span class="directive">private</span> <span class="type">int</span> seconds;
    <span class="directive">private</span> <span class="predefined-type">BigDecimal</span> price;

    <span class="directive">public</span> CallRecord() { }

    <span class="directive">public</span> CallRecord(<span class="predefined-type">String</span> datetime, <span class="predefined-type">String</span> from,
            <span class="predefined-type">String</span> to, <span class="type">int</span> min, <span class="type">int</span> sec)             <span class="directive">throws</span> <span class="exception">ParseException</span> { ... }

    <span class="directive">public</span> CallRecord(<span class="predefined-type">String</span> jsonData) <span class="directive">throws</span> <span class="exception">ParseException</span> { ... }

    <span class="comment">/* ... Getters and setters ... */</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>id</code> field is generated automatically by the Jakarta Persistence implementation to store and retrieve <code>CallRecord</code> objects to and from a database.</p>
</div>
<div class="paragraph">
<p>The second constructor creates a <code>CallRecord</code> object from an entry of JSON data in the log file using Jakarta JSON Processing.
Log entries look as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">{<span class="string"><span class="delimiter">&quot;</span><span class="content">datetime</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">03/01/2013 04:03</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">from</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">555-0101</span><span class="delimiter">&quot;</span></span>,
<span class="string"><span class="delimiter">&quot;</span><span class="content">to</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">555-0114</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">length</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">03:39</span><span class="delimiter">&quot;</span></span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>PhoneBill</code> entity is defined as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Entity</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">PhoneBill</span> <span class="directive">implements</span> <span class="predefined-type">Serializable</span> {
    <span class="annotation">@Id</span>
    <span class="directive">private</span> <span class="predefined-type">String</span> phoneNumber;
    <span class="annotation">@OneToMany</span>(fetch = FetchType.EAGER, cascade = CascadeType.PERSIST)
    <span class="annotation">@OrderBy</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">datetime ASC</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">private</span> <span class="predefined-type">List</span>&lt;CallRecord&gt; calls;
    <span class="directive">private</span> <span class="predefined-type">BigDecimal</span> amountBase;
    <span class="directive">private</span> <span class="predefined-type">BigDecimal</span> taxRate;
    <span class="directive">private</span> <span class="predefined-type">BigDecimal</span> tax;
    <span class="directive">private</span> <span class="predefined-type">BigDecimal</span> amountTotal;

    <span class="directive">public</span> PhoneBill() { }

    <span class="directive">public</span> PhoneBill(<span class="predefined-type">String</span> number) {
        <span class="local-variable">this</span>.phoneNumber = number;
        calls = <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;&gt;();
    }

    <span class="directive">public</span> <span class="type">void</span> addCall(CallRecord call) {
        calls.add(call);
    }

    <span class="directive">public</span> <span class="type">void</span> calculate(<span class="predefined-type">BigDecimal</span> taxRate) { ... }

    <span class="comment">/* ... Getters and setters ... */</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>OneToMany</code> annotation defines the relationship between a bill and its call records.
The <code>FetchType.EAGER</code> attribute specifies that the collection should be retrieved eagerly.
The <code>CascadeType.PERSIST</code> attribute indicates that the elements in the call list should be automatically persisted when the phone bill is persisted.
The <code>OrderBy</code> annotation defines an order for retrieving the elements of the call list from the database.</p>
</div>
<div class="paragraph">
<p>The batch artifacts use instances of these two entities as items to read, process, and write.</p>
</div>
<div class="paragraph">
<p>For more information on Jakarta Persistence, see <a href="#introduction-to-jakarta-persistence">Introduction to Jakarta Persistence</a>.
For more information on Jakarta JSON Processing, see <a href="#json-processing">JSON Processing</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="the-call-records-chunk-step"><a class="anchor" href="#the-call-records-chunk-step"></a>The Call Records Chunk Step</h5>
<div class="paragraph">
<p>The first step is composed of the <code>CallRecordReader</code>, <code>CallRecordProcessor</code>, and <code>CallRecordWriter</code> batch artifacts.</p>
</div>
<div class="paragraph">
<p>The <code>CallRecordReader</code> artifact reads call records from the log file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Dependent</span>
<span class="annotation">@Named</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">CallRecordReader</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">CallRecordReader</span> <span class="directive">implements</span> ItemReader {
    <span class="directive">private</span> ItemNumberCheckpoint checkpoint;
    <span class="directive">private</span> <span class="predefined-type">String</span> fileName;
    <span class="directive">private</span> <span class="predefined-type">BufferedReader</span> breader;
    <span class="annotation">@Inject</span>
    JobContext jobCtx;

    <span class="comment">/* ... Override the open, close, readItem,
     *     and checkpointInfo methods ... */</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>open</code> method reads the <code>log_filename</code> property and opens the log file with a buffered reader:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">fileName = jobCtx.getProperties().getProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">log_file_name</span><span class="delimiter">&quot;</span></span>);
breader = <span class="keyword">new</span> <span class="predefined-type">BufferedReader</span>(<span class="keyword">new</span> <span class="predefined-type">FileReader</span>(fileName));</code></pre>
</div>
</div>
<div class="paragraph">
<p>If a checkpoint object is provided, the <code>open</code> method advances the reader up to the last checkpoint.
Otherwise, this method creates a new checkpoint object.
The checkpoint object keeps track of the line number from the last committed chunk.</p>
</div>
<div class="paragraph">
<p>The <code>readItem</code> method returns a new <code>CallRecord</code> object or null at the end of the log file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Override</span>
<span class="directive">public</span> <span class="predefined-type">Object</span> readItem() <span class="directive">throws</span> <span class="exception">Exception</span> {
    <span class="comment">/* Read a line from the log file and
     * create a CallRecord from JSON */</span>
    <span class="predefined-type">String</span> callEntryJson = breader.readLine();
    <span class="keyword">if</span> (callEntryJson != <span class="predefined-constant">null</span>) {
        checkpoint.nextItem();
        <span class="keyword">return</span> <span class="keyword">new</span> CallRecord(callEntryJson);
    } <span class="keyword">else</span>
        <span class="keyword">return</span> <span class="predefined-constant">null</span>;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>CallRecordProcessor</code> artifact obtains the airtime price from the job properties, calculates the price of each call, and returns the call object.
This artifact overrides only the <code>processItem</code> method.</p>
</div>
<div class="paragraph">
<p>The <code>CallRecordWriter</code> artifact associates each call record with a bill and stores the bill in the database.
This artifact overrides the <code>open</code>, <code>close</code>, <code>writeItems</code>, and <code>checkpointInfo</code> methods.
The <code>writeItems</code> method looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> writeItems(<span class="predefined-type">List</span>&lt;<span class="predefined-type">Object</span>&gt; callList) <span class="directive">throws</span> <span class="exception">Exception</span> {

    <span class="keyword">for</span> (<span class="predefined-type">Object</span> callObject : callList) {
        CallRecord call = (CallRecord) callObject;
        PhoneBill bill = em.find(PhoneBill.class, call.getFromNumber());
        <span class="keyword">if</span> (bill == <span class="predefined-constant">null</span>) {
            <span class="comment">/* No bill for this customer yet, create one */</span>
            bill = <span class="keyword">new</span> PhoneBill(call.getFromNumber());
            bill.addCall(call);
            em.persist(bill);
        } <span class="keyword">else</span> {
            <span class="comment">/* Add call to existing bill */</span>
            bill.addCall(call);
        }
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="the-phone-billing-chunk-step"><a class="anchor" href="#the-phone-billing-chunk-step"></a>The Phone Billing Chunk Step</h5>
<div class="paragraph">
<p>The second step is composed of the <code>BillReader</code>, <code>BillProcessor</code>, <code>BillWriter</code>, and <code>BillPartitionMapper</code> batch artifacts.
This step gets the phone bills from the database, computes the tax and total amount due, and writes each bill to a text file.
Since the processing of each bill is independent of the others, this step can be partitioned and run in more than one thread.</p>
</div>
<div class="paragraph">
<p>The <code>BillPartitionMapper</code> artifact specifies the number of partitions and the parameters for each partition.
In this example, the parameters represent the range of items each partition should process.
The artifact obtains the number of bills in the database to calculate these ranges.
It provides a partition plan object that overrides the <code>getPartitions</code> and <code>getPartitionProperties</code> methods of the <code>PartitionPlan</code> interface.
The <code>getPartitions</code> method looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Override</span>
<span class="directive">public</span> <span class="predefined-type">Properties</span><span class="type">[]</span> getPartitionProperties() {
    <span class="comment">/* Assign an (approximately) equal number of elements
     * to each partition. */</span>
    <span class="type">long</span> totalItems = getBillCount();
    <span class="type">long</span> partItems = (<span class="type">long</span>) totalItems / getPartitions();
    <span class="type">long</span> remItems = totalItems % getPartitions();

    <span class="comment">/* Populate a Properties array. Each Properties element
     * in the array corresponds to a partition. */</span>
    <span class="predefined-type">Properties</span><span class="type">[]</span> props = <span class="keyword">new</span> <span class="predefined-type">Properties</span>[getPartitions()];

    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="integer">0</span>; i &lt; getPartitions(); i++) {
        props[i] = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();
        props[i].setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">firstItem</span><span class="delimiter">&quot;</span></span>,
                <span class="predefined-type">String</span>.valueOf(i * partItems));
        <span class="comment">/* Last partition gets the remainder elements */</span>
        <span class="keyword">if</span> (i == getPartitions() - <span class="integer">1</span>) {
            props[i].setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">numItems</span><span class="delimiter">&quot;</span></span>,
                    <span class="predefined-type">String</span>.valueOf(partItems + remItems));
        } <span class="keyword">else</span> {
            props[i].setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">numItems</span><span class="delimiter">&quot;</span></span>,
                    <span class="predefined-type">String</span>.valueOf(partItems));
        }
    }
    <span class="keyword">return</span> props;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>BillReader</code> artifact obtains the partition parameters as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Dependent</span>
<span class="annotation">@Named</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">BillReader</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">BillReader</span> <span class="directive">implements</span> ItemReader {

    <span class="annotation">@Inject</span> <span class="annotation">@BatchProperty</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">firstItem</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">private</span> <span class="predefined-type">String</span> firstItemValue;
    <span class="annotation">@Inject</span> <span class="annotation">@BatchProperty</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">numItems</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">private</span> <span class="predefined-type">String</span> numItemsValue;
    <span class="directive">private</span> ItemNumberCheckpoint checkpoint;
    <span class="annotation">@PersistenceContext</span>
    <span class="directive">private</span> EntityManager em;
    <span class="directive">private</span> <span class="predefined-type">Iterator</span> iterator;

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> open(<span class="predefined-type">Serializable</span> ckpt) <span class="directive">throws</span> <span class="exception">Exception</span> {
        <span class="comment">/* Get the range of items to work on in this partition */</span>
        <span class="type">long</span> firstItem0 = <span class="predefined-type">Long</span>.parseLong(firstItemValue);
        <span class="type">long</span> numItems0 = <span class="predefined-type">Long</span>.parseLong(numItemsValue);

        <span class="keyword">if</span> (ckpt == <span class="predefined-constant">null</span>) {
            <span class="comment">/* Create a checkpoint object for this partition */</span>
            checkpoint = <span class="keyword">new</span> ItemNumberCheckpoint();
            checkpoint.setItemNumber(firstItem0);
            checkpoint.setNumItems(numItems0);
        } <span class="keyword">else</span> {
            checkpoint = (ItemNumberCheckpoint) ckpt;
        }

        <span class="comment">/* Adjust range for this partition from the checkpoint */</span>
        <span class="type">long</span> firstItem = checkpoint.getItemNumber();
        <span class="type">long</span> numItems = numItems0 - (firstItem - firstItem0);
        ...
    }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This artifact also obtains an iterator to read items from the Jakarta Persistence entity manager:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">/* Obtain an iterator for the bills in this partition */</span>
<span class="predefined-type">String</span> query = <span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT b FROM PhoneBill b ORDER BY b.phoneNumber</span><span class="delimiter">&quot;</span></span>;
<span class="predefined-type">Query</span> q = em.createQuery(query).setFirstResult((<span class="type">int</span>) firstItem)
        .setMaxResults((<span class="type">int</span>) numItems);
iterator = q.getResultList().iterator();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>BillProcessor</code> artifact iterates over the list of call records in a bill and calculates the tax and total amount due for each bill.</p>
</div>
<div class="paragraph">
<p>The <code>BillWriter</code> artifact writes each bill to a plain text file.</p>
</div>
</div>
<div class="sect4">
<h5 id="the-jakarta-faces-pages-2"><a class="anchor" href="#the-jakarta-faces-pages-2"></a>The Jakarta Faces Pages</h5>
<div class="paragraph">
<p>The <code>index.xhtml</code> page contains a text area that shows the log file of call records.
The page provides a button for the user to submit the batch job and navigate to the next page:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;body&gt;</span>
    <span class="tag">&lt;h1&gt;</span>The Phone Billing Example Application<span class="tag">&lt;/h1&gt;</span>
    <span class="tag">&lt;h2&gt;</span>Log file<span class="tag">&lt;/h2&gt;</span>
    <span class="tag">&lt;p&gt;</span>The batch job analyzes the following log file:<span class="tag">&lt;/p&gt;</span>
    <span class="tag">&lt;textarea</span> <span class="attribute-name">cols</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">90</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">rows</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">25</span><span class="delimiter">&quot;</span></span>
              <span class="attribute-name">readonly</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>#{jsfBean.createAndShowLog()}<span class="tag">&lt;/textarea&gt;</span>
    <span class="tag">&lt;p&gt;</span> <span class="tag">&lt;/p&gt;</span>
    <span class="tag">&lt;h:form&gt;</span>
        <span class="tag">&lt;h:commandButton</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Start Batch Job</span><span class="delimiter">&quot;</span></span>
                         <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{jsfBean.startBatchJob()}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;/h:form&gt;</span>
<span class="tag">&lt;/body&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This page calls the methods of the managed bean to show the log file and submit the batch job.</p>
</div>
<div class="paragraph">
<p>The <code>jobstarted.xhtml</code> page provides a button to check the current status of the batch job and displays the bills when the job finishes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;p&gt;</span>Current Status of the Job: <span class="tag">&lt;b&gt;</span>#{jsfBean.jobStatus}<span class="tag">&lt;/b&gt;</span><span class="tag">&lt;/p&gt;</span>
<span class="tag">&lt;h:dataTable</span> <span class="attribute-name">var</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">_row</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{jsfBean.rowList}</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">border</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">rendered</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{jsfBean.completed}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="comment">&lt;!-- ... show results from jsfBean.rowList ... --&gt;</span>
<span class="tag">&lt;/h:dataTable&gt;</span>
<span class="comment">&lt;!-- Render the check status button if the job has not finished --&gt;</span>
<span class="tag">&lt;h:form&gt;</span>
    <span class="tag">&lt;h:commandButton</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Check Status</span><span class="delimiter">&quot;</span></span>
                     <span class="attribute-name">rendered</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{jsfBean.completed==false}</span><span class="delimiter">&quot;</span></span>
                     <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jobstarted</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/h:form&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="the-managed-bean-3"><a class="anchor" href="#the-managed-bean-3"></a>The Managed Bean</h5>
<div class="paragraph">
<p>The <code>JsfBean</code> managed bean submits the job to the batch runtime, checks on the status of the job, and reads the text files for each bill.</p>
</div>
<div class="paragraph">
<p>The <code>startBatchJob</code> method of the bean submits the job to the batch runtime:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">/* Submit the batch job to the batch runtime.
 * JSF Navigation method (return the name of the next page) */</span>
<span class="directive">public</span> <span class="predefined-type">String</span> startBatchJob() {
    jobOperator = BatchRuntime.getJobOperator();
    execID = jobOperator.start(<span class="string"><span class="delimiter">&quot;</span><span class="content">phonebilling</span><span class="delimiter">&quot;</span></span>, <span class="predefined-constant">null</span>);
    <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">jobstarted</span><span class="delimiter">&quot;</span></span>;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>getJobStatus</code> method of the bean checks the status of the job:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">/* Get the status of the job from the batch runtime */</span>
<span class="directive">public</span> <span class="predefined-type">String</span> getJobStatus() {
    <span class="keyword">return</span> jobOperator.getJobExecution(execID).getBatchStatus().toString();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>getRowList</code> method of the bean creates a list of bills to be displayed on the <code>jobstarted.xhtml</code> faces page using a table.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="running-the-phonebilling-example-application"><a class="anchor" href="#running-the-phonebilling-example-application"></a>Running the phonebilling Example Application</h4>
<div class="paragraph">
<p>You can use either NetBeans IDE or Maven to build, package, deploy, and run the <code>phonebilling</code> example application.</p>
</div>
<div class="sect4">
<h5 id="to-run-the-phonebilling-example-application-using-netbeans-ide"><a class="anchor" href="#to-run-the-phonebilling-example-application-using-netbeans-ide"></a>To Run the phonebilling Example Application Using NetBeans IDE</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see
<a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>From the File menu, choose Open Project.</p>
</li>
<li>
<p>In the Open Project dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/batch</pre>
</div>
</div>
</li>
<li>
<p>Select the <code>phonebilling</code> folder.</p>
</li>
<li>
<p>Click Open Project.</p>
</li>
<li>
<p>In the Projects tab, right-click the <code>phonebilling</code> project and select Run.</p>
<div class="paragraph">
<p>This command builds and packages the application into a WAR file, <code>phonebilling.war</code>, located in the <code>target/</code> directory; deploys it to the server; and launches a web browser window at the following URL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080/phonebilling/</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-run-the-phonebilling-example-application-using-maven"><a class="anchor" href="#to-run-the-phonebilling-example-application-using-maven"></a>To Run the phonebilling Example Application Using Maven</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>In a terminal window, go to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/batch/phonebilling/</pre>
</div>
</div>
</li>
<li>
<p>Enter the following command to deploy the application:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">mvn install</code></pre>
</div>
</div>
</li>
<li>
<p>Open a web browser window at the following URL:</p>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080/phonebilling/</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="further-information-about-batch-processing"><a class="anchor" href="#further-information-about-batch-processing"></a>Further Information about Batch Processing</h3>
<div class="paragraph">
<p>For more information on batch processing in Jakarta EE, see Jakarta Batch:<br>
<a href="https://jakarta.ee/specifications/batch/2.0/" class="bare" target="_blank" rel="noopener">https://jakarta.ee/specifications/batch/2.0/</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="jakarta-concurrency-2"><a class="anchor" href="#jakarta-concurrency-2"></a>Chapter 60. Jakarta Concurrency</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter describes Jakarta Concurrency spec.</p>
</div>
<div class="sect2">
<h3 id="concurrency-basics"><a class="anchor" href="#concurrency-basics"></a>Concurrency Basics</h3>
<div class="paragraph">
<p>Concurrency is the concept of executing two or more tasks at the same time (in parallel).
Tasks may include methods (functions), parts of a program, or even other programs.
With current computer architectures, support for multiple cores and multiple processors in a single CPU is very common.</p>
</div>
<div class="paragraph">
<p>The Java Platform has always offered support for concurrent programming, which was the basis for implementing many of the services offered by Jakarta EE containers.
Since Java SE 5, additional high-level API support for concurrency was provided by the <code>java.util.concurrent</code> package.</p>
</div>
<div class="sect3">
<h4 id="threads-and-processes"><a class="anchor" href="#threads-and-processes"></a>Threads and Processes</h4>
<div class="paragraph">
<p>The two main concurrency concepts are processes and threads.</p>
</div>
<div class="paragraph">
<p>Processes are primarily associated with applications running on the operating system (OS).
A process has specific runtime resources to interact with the underlying OS and allocate other resources, such as its own memory, just as the JVM process does.
A JVM is in fact a process.</p>
</div>
<div class="paragraph">
<p>The Java programming language and platform are primarily concerned with threads.</p>
</div>
<div class="paragraph">
<p>Threads share some features with processes, since both consume resources from the OS or the execution environment.
But threads are easier to create and consume many fewer resources than a process.</p>
</div>
<div class="paragraph">
<p>Because threads are so lightweight, any modern CPU that has a couple of cores and a few gigabytes of RAM can handle thousands of threads in a single JVM process.
The precise number of threads will depend on the combined output of the CPU, OS, and RAM available, as well as on correct configuration (tuning) of the JVM.</p>
</div>
<div class="paragraph">
<p>Although concurrent programming solves many problems and can improve performance for most applications, there are a number of situations where multiple execution lines (threads or processes) can cause major problems.
These situations include the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Deadlocks</p>
</li>
<li>
<p>Thread starvation</p>
</li>
<li>
<p>Concurrent accessing of shared resources</p>
</li>
<li>
<p>Situations when the program generates incorrect data</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="main-components-of-the-concurrency-utilities"><a class="anchor" href="#main-components-of-the-concurrency-utilities"></a>Main Components of the Concurrency Utilities</h3>
<div class="paragraph">
<p>Concurrent resources are managed objects that provide concurrency capabilities to Jakarta EE applications.
In GlassFish Server, you configure concurrent resources and then make them available for use by application components such as servlets and enterprise beans.
Concurrent resources are accessed through JNDI lookup or resource injection.</p>
</div>
<div class="paragraph">
<p>The primary components of the concurrency utilities are as follows.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ManagedExecutorService</code>: A managed executor service is used by applications to execute submitted tasks asynchronously.
Tasks are executed on threads that are started and managed by the container.
The context of the container is propagated to the thread executing the task.</p>
<div class="paragraph">
<p>For example, by using an <code>ManagedExecutorService.submit()</code> call, a task, such as the GenerateReportTask, could be submitted to execute at a later time and then, by using the <code>Future</code> object callback, retrieve the result when it becomes available.</p>
</div>
</li>
<li>
<p><code>ManagedScheduledExecutorService</code>: A managed scheduled executor service is used by applications to execute submitted tasks asynchronously at specific times.
Tasks are executed on threads that are started and managed by the container.
The context of the container is propagated to the thread executing the task.
The API provides the scheduling functionality that allows users to set a specific date/time for the Task execution programmatically in the application.</p>
</li>
<li>
<p><code>ContextService</code>: A context service is used to create dynamic proxy objects that capture the context of a container and enable applications to run within that context at a later time or be submitted to a Managed Executor Service.
The context of the container is propagated to the thread executing the task.</p>
</li>
<li>
<p><code>ManagedThreadFactory</code>: A managed thread factory is used by applications to create managed threads.
The threads are started and managed by the container.
The context of the container is propagated to the thread executing the task.
This object can also be used to provide custom factories for specific use cases (with custom Threads) and, for example, set specific/proprietary properties to these objects.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="concurrency-and-transactions"><a class="anchor" href="#concurrency-and-transactions"></a>Concurrency and Transactions</h3>
<div class="paragraph">
<p>The most basic operations for transactions are commit and rollback, but, in a distributed environment with concurrent processing, it can be difficult to guarantee that commit or rollback operations will be successfully processed, and the transaction can be spread among different threads, CPU cores, physical machines, and networks.</p>
</div>
<div class="paragraph">
<p>Ensuring that a rollback operation will successfully execute in such a scenario is crucial.
Concurrency Utilities relies on Jakarta Transactions to implement and support transactions on its components through <code>jakarta.transaction.UserTransaction</code>, allowing application developers to explicitly manage transaction boundaries.
More information is available in the Jakarta Transactions specification.</p>
</div>
<div class="paragraph">
<p>Optionally, context objects can begin, commit, or roll back transactions, but these objects cannot enlist in parent component transactions.</p>
</div>
<div class="paragraph">
<p>The following code snippet illustrates a <code>Runnable</code> task that obtains a <code>UserTransaction</code> and then starts and commits a transaction while interacting with other transactional components, such as an enterprise bean and a database:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">MyTransactionalTask</span> <span class="directive">implements</span> <span class="predefined-type">Runnable</span> {

   UserTransaction ut = ... <span class="comment">// obtained through JNDI or injection</span>

   public <span class="type">void</span> run() {

       <span class="comment">// Start a transaction</span>
       ut.begin();

       <span class="comment">// Invoke a Service or an EJB</span>
       myEJB.businessMethod();

       <span class="comment">// Update a database entity using an XA JDBC driver</span>
       myEJB.updateCustomer(customer);

       <span class="comment">// Commit the transaction</span>
       ut.commit();

   }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="concurrency-and-security"><a class="anchor" href="#concurrency-and-security"></a>Concurrency and Security</h3>
<div class="paragraph">
<p>Jakarta Concurrency defers most security decisions to the application server implementation.
If, however, the container supports a security context, that context can be propagated to the thread of execution.
The <code>ContextService</code> can support several runtime behaviors, and the <code>security</code> attribute, if enabled, will propagate the container security principal.</p>
</div>
</div>
<div class="sect2">
<h3 id="the-jobs-concurrency-example"><a class="anchor" href="#the-jobs-concurrency-example"></a>The jobs Concurrency Example</h3>
<div class="paragraph">
<p>This section describes a very basic example that shows how to use some of the basic concurrency features in an enterprise application.
Specifically, this example uses one of the main components of Jakarta Concurrency, a Managed Executor Service.</p>
</div>
<div class="paragraph">
<p>The example demonstrates a scenario where a RESTful web service, exposed as a public API, is used to submit generic jobs for execution.
These jobs are processed in the background.
Each job prints a "Starting" and a "Finished" message at the beginning and end of the execution.
Also, to simulate background processing, each job takes 10 seconds to execute.</p>
</div>
<div class="paragraph">
<p>The RESTful service exposes two methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>/token</code>: Exposed as a GET method that registers and returns valid API tokens</p>
</li>
<li>
<p><code>/process</code>: Exposed as a POST method that receives a <code>jobID</code> query parameter, which is the identifier for the job to be executed, and a custom HTTP header named <code>X-REST-API-Key,</code> which will be used internally to validate requests with tokens</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The token is used to differentiate the Quality of Service (QoS) offered by the API.
Users that provide a token in a service request can process multiple concurrent jobs.
However, users that do not provide a token can process only one job at a time.
Since every job takes 10 seconds to execute, users that provide no token will be able to execute only one call to the service every 10 seconds.
For users that provide a token, processing will be much faster.</p>
</div>
<div class="paragraph">
<p>This differentiation is made possible by the use of two different Managed Executor Services, one for each type of request.</p>
</div>
<div class="sect3">
<h4 id="running-the-jobs-example"><a class="anchor" href="#running-the-jobs-example"></a>Running the jobs Example</h4>
<div class="paragraph">
<p>After configuring GlassFish Server by adding two Managed Executor Services, you can use either NetBeans IDE or Maven to build, package, deploy, and run the <code>jobs</code> example.</p>
</div>
<div class="sect4">
<h5 id="to-configure-glassfish-server-for-the-basic-concurrency-example"><a class="anchor" href="#to-configure-glassfish-server-for-the-basic-concurrency-example"></a>To Configure GlassFish Server for the Basic Concurrency Example</h5>
<div class="paragraph">
<p>To configure GlassFish Server, follow these steps.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open the Administration Console at <a href="http://localhost:4848" class="bare" target="_blank" rel="noopener">http://localhost:4848</a>.</p>
</li>
<li>
<p>Expand the Resources node.</p>
</li>
<li>
<p>Expand the Concurrent Resources node.</p>
</li>
<li>
<p>Click Managed Executor Services.</p>
</li>
<li>
<p>On the Managed Executor Services page, click New to open the New Managed Executor Services page.</p>
</li>
<li>
<p>In the JNDI Name field, enter <code>MES_High</code> to create the high-priority Managed Executor Service.
Use the following settings (keep the default values for other settings):</p>
<div class="ulist">
<ul>
<li>
<p>Thread Priority: 10</p>
</li>
<li>
<p>Core Size: 2</p>
</li>
<li>
<p>Maximum Pool Size: 5</p>
</li>
<li>
<p>Task Queue Capacity: 2</p>
</li>
</ul>
</div>
</li>
<li>
<p>Click OK.</p>
</li>
<li>
<p>On the On the Managed Executor Services page, click New again.</p>
</li>
<li>
<p>In the JNDI Name field, enter <code>MES_Low</code> to create the low-priority Managed Executor Service.
Use the following settings (keep the default values for other settings):</p>
<div class="ulist">
<ul>
<li>
<p>Thread Priority: 1</p>
</li>
<li>
<p>Core Size: 1</p>
</li>
<li>
<p>Maximum Pool Size: 1</p>
</li>
<li>
<p>Task Queue Capacity: 0</p>
</li>
</ul>
</div>
</li>
<li>
<p>Click OK.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-build-package-and-deploy-the-jobs-example-using-netbeans-ide"><a class="anchor" href="#to-build-package-and-deploy-the-jobs-example-using-netbeans-ide"></a>To Build, Package, and Deploy the jobs Example Using NetBeans IDE</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>From the File menu, choose Open Project.</p>
</li>
<li>
<p>In the Open Project dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/concurrency</pre>
</div>
</div>
</li>
<li>
<p>Select the <code>jobs</code> folder.</p>
</li>
<li>
<p>Click Open Project.</p>
</li>
<li>
<p>In the Projects tab, right-click the <code>jobs</code> project and select Build.</p>
<div class="paragraph">
<p>This command builds and deploys the application.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-build-package-and-deploy-the-jobs-example-using-maven"><a class="anchor" href="#to-build-package-and-deploy-the-jobs-example-using-maven"></a>To Build, Package, and Deploy the jobs Example Using Maven</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>In a terminal window, go to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/concurrency/jobs</pre>
</div>
</div>
</li>
<li>
<p>Enter the following command to build and deploy the application:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">mvn install</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-run-the-jobs-example-and-submit-jobs-with-low-priority"><a class="anchor" href="#to-run-the-jobs-example-and-submit-jobs-with-low-priority"></a>To Run the jobs Example and Submit Jobs with Low Priority</h5>
<div class="paragraph">
<p>To run the example as a user who submits jobs with low priority, follow
these steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In a web browser, enter the following URL:</p>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080/jobs</pre>
</div>
</div>
</li>
<li>
<p>In the Jobs Client page, enter the value 1 in the Enter a JobID field, enter nothing in the Enter a Token field, then click Submit Job.</p>
<div class="paragraph">
<p>The following message should be displayed at the bottom of the page:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Job 1 successfully submitted</pre>
</div>
</div>
<div class="paragraph">
<p>The server log includes the following messages:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>INFO:   Invalid or missing token!
INFO:   Task started LOW-1
INFO:   Job 1 successfully submitted
INFO:   Task finished LOW-1</pre>
</div>
</div>
<div class="paragraph">
<p>You submitted a job with low priority.
This means that you cannot submit another job for 10 seconds.
If you try to do so, the RESTful API will return a service unavailable (HTTP 503) response and the following message will be displayed at the bottom of the page:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Job 2 was NOT submitted</pre>
</div>
</div>
<div class="paragraph">
<p>The server log will include the following messages:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>INFO:   Invalid or missing token!
INFO:   Job 1 successfully submitted
INFO:   Task started LOW-1
INFO:   Invalid or missing token!
INFO:   Job 2 was NOT submitted
INFO:   Task finished LOW-1</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-run-the-jobs-example-and-submit-jobs-with-high-priority"><a class="anchor" href="#to-run-the-jobs-example-and-submit-jobs-with-high-priority"></a>To Run the jobs Example and Submit Jobs with High Priority</h5>
<div class="paragraph">
<p>To run the example as a user who submits jobs with high priority, follow these steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In a web browser, enter the following URL:</p>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080/jobs</pre>
</div>
</div>
</li>
<li>
<p>In the Jobs Client page, enter a value of one to ten digits in the Enter a JobID field.</p>
</li>
<li>
<p>Click the here link on the line "Get a token here" to get a token.
The page that displays the token will open in a new tab.</p>
</li>
<li>
<p>Copy the token and return to the Jobs Client page.</p>
</li>
<li>
<p>Paste the token in the Enter a Token field, then click Submit Job.</p>
<div class="paragraph">
<p>A message like the following should be displayed at the bottom of the page:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Job 11 successfully submitted</pre>
</div>
</div>
<div class="paragraph">
<p>The server log includes the following messages:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>INFO:   Token accepted. Execution with high priority.
INFO:   Task started HIGH-11
INFO:   Job 11 successfully submitted
INFO:   Task finished HIGH-11</pre>
</div>
</div>
<div class="paragraph">
<p>You submitted a job with high priority.
This means that you can submit multiple jobs, each with a token, and not face the 10 second per job restriction that the low priority submitters face.
If you submit 3 jobs with tokens in rapid succession, messages like the following will be displayed at the bottom of the page:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Job 1 was submitted
Job 2 was submitted
Job 3 was submitted</pre>
</div>
</div>
<div class="paragraph">
<p>The server log will include the following messages:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>INFO:   Token accepted. Execution with high priority.
INFO:   Task started HIGH-1
INFO:   Job 1 successfully submitted
INFO:   Token accepted. Execution with high priority.
INFO:   Task started HIGH-2
INFO:   Job 2 successfully submitted
INFO:   Task finished HIGH-1
INFO:   Token accepted. Execution with high priority.
INFO:   Task started HIGH-3
INFO:   Job 3 successfully submitted
INFO:   Task finished HIGH-2
INFO:   Task finished HIGH-3</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="the-taskcreator-concurrency-example"><a class="anchor" href="#the-taskcreator-concurrency-example"></a>The taskcreator Concurrency Example</h3>
<div class="paragraph">
<p>The <code>taskcreator</code> example demonstrates how to use Jakarta Concurrency to run tasks immediately, periodically, or after a fixed delay.
This example provides a Jakarta Faces interface that enables users to submit tasks to be executed and displays information messages for each task.
The example uses the Managed Executor Service to run tasks immediately and the Managed Scheduled Executor Service to run tasks periodically or after a fixed delay.
(See <a href="#main-components-of-the-concurrency-utilities">Main Components of the Concurrency Utilities</a> for information about these services.)</p>
</div>
<div class="paragraph">
<p>The <code>taskcreator</code> example consists of the following components.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A Jakarta Faces page (<code>index.xhtml</code>) that contains three elements: a form to submit tasks, a task execution log, and a form to cancel periodic tasks.
This page submits Ajax requests to create and cancel tasks.
This page also receives WebSocket messages, using JavaScript code to update the task execution log.</p>
</li>
<li>
<p>A CDI managed bean (<code>TaskCreatorBean</code>) that processes the requests from the Jakarta Faces page.
This bean invokes the methods in <code>TaskEJB</code> to submit new tasks and to cancel periodic tasks.</p>
</li>
<li>
<p>An enterprise bean (<code>TaskEJB</code>) that obtains executor service instances using resource injection and submits tasks for execution.
This bean is also a Jakarta RESTful web service endpoint.
The tasks send information messages to this endpoint.</p>
</li>
<li>
<p>A WebSocket endpoint (<code>InfoEndpoint</code>) that the enterprise bean uses to send information messages to the clients.</p>
</li>
<li>
<p>A task class (<code>Task</code>) that implements the <code>Runnable</code> interface.
The <code>run</code> method in this class sends information messages to the web service endpoint in <code>TaskEJB</code> and sleeps for 1.5 seconds.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a href="#architecture-of-the-taskcreator-example">Figure 60-1</a> shows the architecture of the <code>taskcreator</code> example.</p>
</div>
<div id="architecture-of-the-taskcreator-example" class="imageblock">
<div class="content">
<img src="images/jakartaeett_dt_060.svg" alt="The figure shows the architecture of the taskcreator example. The Jakarta Faces page invokes methods on a CDI-managed bean, which submits task initiation requests to an enterprise bean. The enterprise bean uses a WebSocket endpoint to indicate to clients that an updated task execution log is available.">
</div>
<div class="title">Figure 60-1 Architecture of the taskcreator Example</div>
</div>
<div class="paragraph">
<p>The <code>TaskEJB</code> class obtains the default executor service objects from the application server as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Resource</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">java:comp/DefaultManagedExecutorService</span><span class="delimiter">&quot;</span></span>)
ManagedExecutorService mExecService;

<span class="annotation">@Resource</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">java:comp/DefaultManagedScheduledExecutorService</span><span class="delimiter">&quot;</span></span>)
ManagedScheduledExecutorService sExecService;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>submitTask</code> method in <code>TaskEJB</code> uses these objects to submit tasks for execution as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">void</span> submitTask(Task task, <span class="predefined-type">String</span> type) {
    <span class="comment">/* Use the managed executor objects from the app server */</span>
    <span class="keyword">switch</span> (type) {
        <span class="keyword">case</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">IMMEDIATE</span><span class="delimiter">&quot;</span></span>:
            mExecService.submit(task);
            <span class="keyword">break</span>;
        <span class="keyword">case</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">DELAYED</span><span class="delimiter">&quot;</span></span>:
            sExecService.schedule(task, <span class="integer">3</span>, <span class="predefined-type">TimeUnit</span>.SECONDS);
            <span class="keyword">break</span>;
        <span class="keyword">case</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">PERIODIC</span><span class="delimiter">&quot;</span></span>:
            <span class="predefined-type">ScheduledFuture</span>&lt;?&gt; fut;
            fut = sExecService.scheduleAtFixedRate(task, <span class="integer">0</span>, <span class="integer">8</span>,
                    <span class="predefined-type">TimeUnit</span>.SECONDS);
            periodicTasks.put(task.getName(), fut);
            <span class="keyword">break</span>;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For periodic tasks, <code>TaskEJB</code> keeps a reference to the <code>ScheduledFuture</code> object, so that the user can cancel the task at any time.</p>
</div>
<div class="sect3">
<h4 id="running-the-taskcreator-example"><a class="anchor" href="#running-the-taskcreator-example"></a>Running the taskcreator Example</h4>
<div class="paragraph">
<p>This section describes how to build, package, deploy, and run the <code>taskcreator</code> example using NetBeans IDE or Maven.</p>
</div>
<div class="sect4">
<h5 id="to-build-package-and-deploy-the-taskcreator-example-using-netbeans-ide"><a class="anchor" href="#to-build-package-and-deploy-the-taskcreator-example-using-netbeans-ide"></a>To Build, Package, and Deploy the taskcreator Example Using NetBeans IDE</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>From the File menu, choose Open Project.</p>
</li>
<li>
<p>In the Open Project dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/concurrency</pre>
</div>
</div>
</li>
<li>
<p>Select the <code>taskcreator</code> folder.</p>
</li>
<li>
<p>Click Open Project.</p>
</li>
<li>
<p>In the Projects tab, right-click the <code>taskcreator</code> project and select Build.</p>
<div class="paragraph">
<p>This command builds and deploys the application.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-build-package-and-deploy-the-taskcreator-example-using-maven"><a class="anchor" href="#to-build-package-and-deploy-the-taskcreator-example-using-maven"></a>To Build, Package, and Deploy the taskcreator Example Using Maven</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>In a terminal window, go to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/concurrency/taskcreator</pre>
</div>
</div>
</li>
<li>
<p>Enter the following command to build and deploy the application:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">mvn install</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="to-run-the-taskcreator-example"><a class="anchor" href="#to-run-the-taskcreator-example"></a>To Run the taskcreator Example</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open the following URL in a web browser:</p>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080/taskcreator/</pre>
</div>
</div>
<div class="paragraph">
<p>The page contains a form to submit tasks, a task execution log, and a form to cancel periodic tasks.</p>
</div>
</li>
<li>
<p>Select the Immediate task type, enter a task name, and click the Submit button.
Messages like the following appear in the task execution log:</p>
<div class="listingblock">
<div class="content">
<pre>12:40:47 - IMMEDIATE Task TaskA finished
12:40:45 - IMMEDIATE Task TaskA started</pre>
</div>
</div>
</li>
<li>
<p>Select the Delayed (3 sec) task type, enter a task name, and click the Submit button.
Messages like the following appear in the task execution log:</p>
<div class="listingblock">
<div class="content">
<pre>12:43:26 - DELAYED Task TaskB finished
12:43:25 - DELAYED Task TaskB started
12:43:22 - DELAYED Task TaskB submitted</pre>
</div>
</div>
</li>
<li>
<p>Select the Periodic (8 sec) task type, enter a task name, and click the Submit button.
Messages like the following appear in the task execution log:</p>
<div class="listingblock">
<div class="content">
<pre>12:45:25 - PERIODIC Task TaskC finished run #2
12:45:23 - PERIODIC Task TaskC started run #2
12:45:17 - PERIODIC Task TaskC finished run #1
12:45:15 - PERIODIC Task TaskC started run #1</pre>
</div>
</div>
<div class="paragraph">
<p>You can add more than one periodic task.
To cancel a periodic task, select it from the form and click Cancel Task.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="further-information-about-jakarta-concurrency"><a class="anchor" href="#further-information-about-jakarta-concurrency"></a>Further Information about Jakarta Concurrency</h3>
<div class="paragraph">
<p>For more information about concurrency, see</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Jakarta Concurrency 2.0 specification:<br>
<a href="https://jakarta.ee/specifications/concurrency/2.0/" class="bare" target="_blank" rel="noopener">https://jakarta.ee/specifications/concurrency/2.0/</a></p>
</li>
<li>
<p>Concurrency Lesson in The Java Tutorials:<br>
<a href="https://docs.oracle.com/javase/tutorial/essential/concurrency/" class="bare" target="_blank" rel="noopener">https://docs.oracle.com/javase/tutorial/essential/concurrency/</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<h1 id="case-studies" class="sect0"><a class="anchor" href="#case-studies"></a>Part XII: Case Studies</h1>
<div class="openblock partintro">
<div class="content">
Part XII presents case studies that use a variety of Jakarta EE technologies.
</div>
</div>
<div class="sect1">
<h2 id="dukes-bookstore-case-study-example"><a class="anchor" href="#dukes-bookstore-case-study-example"></a>Chapter 61. Duke&#8217;s Bookstore Case Study Example</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Duke&#8217;s Bookstore example is a simple e-commerce application that illustrates some of the more advanced features of Jakarta Faces technology in combination with Jakarta Contexts and Dependency Injection (CDI), enterprise beans, and the Jakarta Persistence.
Users can select books from an image map, view the bookstore catalog, and purchase books.
No security is used in this application.</p>
</div>
<div class="sect2">
<h3 id="design-and-architecture-of-dukes-bookstore"><a class="anchor" href="#design-and-architecture-of-dukes-bookstore"></a>Design and Architecture of Duke&#8217;s Bookstore</h3>
<div class="paragraph">
<p>Duke&#8217;s Bookstore is a simple web application that uses many features of Jakarta Faces technology, in addition to other Jakarta EE features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Jakarta Faces technology, as well as Jakarta Contexts and Dependency Injection (CDI)</p>
<div class="ulist">
<ul>
<li>
<p>A set of Facelets pages, along with a template, provides the user interface to the application.</p>
</li>
<li>
<p>CDI managed beans are associated with each of the Facelets pages.</p>
</li>
<li>
<p>A custom image map component on the front page allows you to select a book to enter the store.
Each area of the map is represented by a Jakarta Faces managed bean.
Text hyperlinks are also provided for accessibility.</p>
</li>
<li>
<p>Action listeners are registered on the image map and the text links.
These listeners retrieve the ID value for the selected book and store it in the session map so it can be retrieved by the managed bean for the next page.</p>
</li>
<li>
<p>The <code>h:dataTable</code> tag is used to render the book catalog and shopping cart contents dynamically.</p>
</li>
<li>
<p>A custom converter is registered on the credit card field on the checkout page, <code>bookcashier.xhtml</code>, which also uses an <code>f:validateRegEx</code> tag to ensure that the input is correctly formatted.</p>
</li>
<li>
<p>A value-change listener is registered on the name field on <code>bookcashier.xhtml</code>.
This listener saves the name in a parameter so the following page, <code>bookreceipt.xhtml</code>, can access it.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Enterprise beans: Local, no-interface-view stateless session bean and singleton bean</p>
</li>
<li>
<p>A Jakarta Persistence entity</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The packages of the Duke&#8217;s Bookstore application, located in the <code><em>tut-install</em>/examples/case-studies/dukes-bookstore/src/main/java/ee/jakarta/tutorial/dukesbookstore/</code> directory, are as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>components</code>: Includes the custom UI component classes, <code>MapComponent</code> and <code>AreaComponent</code></p>
</li>
<li>
<p><code>converters</code>: Includes the custom converter class, <code>CreditCardConverter</code></p>
</li>
<li>
<p><code>ejb</code>: Includes two enterprise beans:</p>
<div class="ulist">
<ul>
<li>
<p>A singleton bean, <code>ConfigBean</code>, that initializes the data in the database</p>
</li>
<li>
<p>A stateless session bean, <code>BookRequestBean</code>, that contains the business logic to manage the entity</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>entity</code>: Includes the <code>Book</code> entity class</p>
</li>
<li>
<p><code>exceptions</code>: Includes three exception classes</p>
</li>
<li>
<p><code>listeners</code>: Includes the event handler and event listener classes</p>
</li>
<li>
<p><code>model</code>: Includes a model JavaBeans class</p>
</li>
<li>
<p><code>renderers</code>: Includes the custom renderers for the custom UI component classes</p>
</li>
<li>
<p><code>web.managedbeans</code>: Includes the managed beans for the Facelets pages</p>
</li>
<li>
<p><code>web.messages</code>: Includes the resource bundle files for localized messages</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="the-dukes-bookstore-interface"><a class="anchor" href="#the-dukes-bookstore-interface"></a>The Duke&#8217;s Bookstore Interface</h3>
<div class="paragraph">
<p>This section provides additional detail regarding the components of the Duke&#8217;s Bookstore example and how they interact.</p>
</div>
<div class="sect3">
<h4 id="the-book-persistence-entity"><a class="anchor" href="#the-book-persistence-entity"></a>The Book Persistence Entity</h4>
<div class="paragraph">
<p>The <code>Book</code> entity, located in the <code>dukesbookstore.entity</code> package, encapsulates the book data stored by Duke&#8217;s Bookstore.</p>
</div>
<div class="paragraph">
<p>The <code>Book</code> entity defines attributes used in the example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A book ID</p>
</li>
<li>
<p>The author&#8217;s first name</p>
</li>
<li>
<p>The author&#8217;s surname</p>
</li>
<li>
<p>The title</p>
</li>
<li>
<p>The price</p>
</li>
<li>
<p>Whether the book is on sale</p>
</li>
<li>
<p>The publication year</p>
</li>
<li>
<p>A description of the book</p>
</li>
<li>
<p>The number of copies in the inventory</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>Book</code> entity also defines a simple named query, <code>findBooks</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="enterprise-beans-used-in-dukes-bookstore"><a class="anchor" href="#enterprise-beans-used-in-dukes-bookstore"></a>Enterprise Beans Used in Duke&#8217;s Bookstore</h4>
<div class="paragraph">
<p>Two enterprise beans located in the <code>dukesbookstore.ejb</code> package provide the business logic for Duke&#8217;s Bookstore.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>BookRequestBean</code> is a stateful session bean that contains the business methods for the application.
The methods create, retrieve, and purchase books, and update the inventory for a book.
To retrieve the books, the <code>getBooks</code> method calls the <code>findBooks</code> named query defined in the <code>Book</code> entity.</p>
</li>
<li>
<p><code>ConfigBean</code> is a singleton session bean used to create the books in the catalog when the application is initially deployed.
It calls the <code>createBook</code> method defined in <code>BookRequestBean</code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="facelets-pages-and-managed-beans-used-in-dukes-bookstore"><a class="anchor" href="#facelets-pages-and-managed-beans-used-in-dukes-bookstore"></a>Facelets Pages and Managed Beans Used in Duke&#8217;s Bookstore</h4>
<div class="paragraph">
<p>The Duke&#8217;s Bookstore application uses Facelets and its templating features to display the user interface.
The Facelets pages interact with a set of CDI managed beans that act as backing beans, providing the underlying properties and methods for the user interface.
The front page also interacts with the custom components used by the application.</p>
</div>
<div class="paragraph">
<p>The application uses the following Facelets pages, which are located in the <code><em>tut-install</em>/examples/case-studies/dukes-bookstore/src/main/webapp/</code> directory.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>bookstoreTemplate.xhtml</code>: The template file, which specifies a header used on every page as well as the style sheet used by all the pages.
The template also retrieves the language set in the web browser.</p>
<div class="paragraph">
<p>Uses the <code>LocaleBean</code> managed bean.</p>
</div>
</li>
<li>
<p><code>index.xhtml</code>: Landing page, which lays out the custom map and area components using managed beans configured in the <code>faces-config.xml</code> file and allows the user to select a book and advance to the <code>bookstore.xhtml</code> page.</p>
</li>
<li>
<p><code>bookstore.xhtml</code>: Page that allows the user to obtain details on the selected book or the featured book, to add either book to the shopping cart, and to advance to the <code>bookcatalog.xhtml</code> page.</p>
<div class="paragraph">
<p>Uses the <code>BookstoreBean</code> managed bean.</p>
</div>
</li>
<li>
<p><code>bookdetails.xhtml</code>: Page that shows details on a book selected from <code>bookstore.xhtml</code> or other pages and allows the user to add the book to the cart and/or advance to the <code>bookcatalog.xhtml</code> page.</p>
<div class="paragraph">
<p>Uses the <code>BookDetailsBean</code> managed bean.</p>
</div>
</li>
<li>
<p><code>bookcatalog.xhtml</code>: Page that displays the books in the catalog and allows the user to add books to the shopping cart, view the details for any book, view the shopping cart, empty the shopping cart, or purchase the books in the shopping cart.</p>
<div class="paragraph">
<p>Uses the <code>BookstoreBean</code>, <code>CatalogBean</code>, and <code>ShoppingCart</code> managed beans.</p>
</div>
</li>
<li>
<p><code>bookshowcart.xhtml</code>: Page that displays the contents of the shopping cart and allows the user to remove items, view the details for an item, empty the shopping cart, purchase the books in the shopping cart, or return to the catalog.</p>
<div class="paragraph">
<p>Uses the <code>ShowCartBean</code> and <code>ShoppingCart</code> managed beans.</p>
</div>
</li>
<li>
<p><code>bookcashier.xhtml</code>: Page that allows the user to purchase books, specify a shipping option, subscribe to newsletters, or join the Duke Fan Club with a purchase over a certain amount.</p>
<div class="paragraph">
<p>Uses the <code>CashierBean</code> and <code>ShoppingCart</code> managed beans.</p>
</div>
</li>
<li>
<p><code>bookreceipt.xhtml</code>: Page that confirms the user&#8217;s purchase and allows the user to return to the catalog page to continue shopping.</p>
<div class="paragraph">
<p>Uses the <code>CashierBean</code> managed bean.</p>
</div>
</li>
<li>
<p><code>bookordererror.xhtml</code>: Page rendered by <code>CashierBean</code> if the bookstore has no more copies of a book that was ordered.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The application uses the following managed beans, which are located in the <code><em>tut-install</em>/examples/case-studies/dukes-bookstore/src/main/java/ee/jakarta/tutorial/dukesbookstore/web/managedbeans/</code> directory.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>AbstractBean</code>: Contains utility methods called by other managed beans.</p>
</li>
<li>
<p><code>BookDetailsBean</code>: Backing bean for the <code>bookdetails.xhtml</code> page.
Specifies the name <code>details</code>.</p>
</li>
<li>
<p><code>BookstoreBean</code>: Backing bean for the <code>bookstore.xhtml</code> page.
Specifies the name <code>store</code>.</p>
</li>
<li>
<p><code>CashierBean</code>: Backing bean for the <code>bookcashier.xhtml</code> and <code>bookreceipt.xhtml</code> pages.</p>
</li>
<li>
<p><code>CatalogBean</code>: Backing bean for the <code>bookcatalog.xhtml</code> page.
Specifies the name <code>catalog</code>.</p>
</li>
<li>
<p><code>LocaleBean</code>: Managed bean that retrieves the current locale; used on each page.</p>
</li>
<li>
<p><code>ShoppingCart</code>: Backing bean used by the <code>bookcashier.xhtml</code>, <code>bookcatalog.xhtml</code>, and <code>bookshowcart.xhtml</code> pages.
Specifies the name <code>cart</code>.</p>
</li>
<li>
<p><code>ShoppingCartItem</code>: Contains methods called by <code>ShoppingCart</code>, <code>CatalogBean</code>, and <code>ShowCartBean</code>.</p>
</li>
<li>
<p><code>ShowCartBean</code>: Backing bean for the <code>bookshowcart.xhtml</code> page.
Specifies the name <code>showcart</code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="custom-components-and-other-custom-objects-used-in-dukes-bookstore"><a class="anchor" href="#custom-components-and-other-custom-objects-used-in-dukes-bookstore"></a>Custom Components and Other Custom Objects Used in Duke&#8217;s Bookstore</h4>
<div class="paragraph">
<p>The map and area custom components for Duke&#8217;s Bookstore, along with associated renderer, listener, and model classes, are defined in the following packages in the <code><em>tut-install</em>/examples/case-studies/dukes-bookstore/src/main/java/ee/jakarta/tutorial/dukesbookstore/</code> directory.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>components</code>: Contains the <code>MapComponent</code> and <code>AreaComponent</code> classes.
See <a href="#creating-custom-component-classes">Creating Custom Component Classes</a>.</p>
</li>
<li>
<p><code>listeners</code>: Contains the <code>AreaSelectedEvent</code> class, along with other listener classes.
See <a href="#handling-events-for-custom-components">Handling Events for Custom Components</a>.</p>
</li>
<li>
<p><code>model</code>: Contains the <code>ImageArea</code> class.
See <a href="#configuring-model-data">Configuring Model Data</a> for more information.</p>
</li>
<li>
<p><code>renderers</code>: Contains the <code>MapRenderer</code> and <code>AreaRenderer</code> classes.
See <a href="#delegating-rendering-to-a-renderer">Delegating Rendering to a Renderer</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code><em>tut-install</em>/examples/case-studies/dukes-bookstore/src/java/dukesbookstore/</code> directory also contains a custom converter and other custom listeners not specifically tied to the custom components.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>converters</code>: Contains the <code>CreditCardConverter</code> class.
See <a href="#creating-and-using-a-custom-converter">Creating and Using a Custom Converter</a>.</p>
</li>
<li>
<p><code>listeners</code>: Contains the <code>LinkBookChangeListener</code>, <code>MapBookChangeListener</code>, and <code>NameChanged</code> classes.
See <a href="#implementing-an-event-listener">Implementing an Event Listener</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="properties-files-used-in-dukes-bookstore"><a class="anchor" href="#properties-files-used-in-dukes-bookstore"></a>Properties Files Used in Duke&#8217;s Bookstore</h4>
<div class="paragraph">
<p>The strings used in the Duke&#8217;s Bookstore application are encapsulated into resource bundles to allow the display of localized strings in multiple locales.
The properties files, located in the <code><em>tut-install</em>/examples/case-studies/dukes-bookstore/src/main/java/ee/jakarta/tutorial/dukesbookstore/web/messages/</code> directory, consist of a default file containing English strings and three additional files for other locales.
The files are as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Messages.properties</code>: Default file, containing English strings</p>
</li>
<li>
<p><code>Messages_de.properties</code>: File containing German strings</p>
</li>
<li>
<p><code>Messages_es.properties</code>: File containing Spanish strings</p>
</li>
<li>
<p><code>Messages_fr.properties</code>: File containing French strings</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The language setting in the user&#8217;s web browser determines which locale is used.
The <code>html</code> tag in <code>bookstoreTemplate.xhtml</code> retrieves the language setting from the <code>language</code> property of <code>LocaleBean</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;html</span> <span class="attribute-name">lang</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{localeBean.language}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information about resource bundles, see <a href="#internationalizing-and-localizing-web-applications">Chapter 22, <em>Internationalizing and Localizing Web Applications</em></a>.</p>
</div>
<div class="paragraph">
<p>The resource bundle is configured as follows in the <code>faces-config.xml</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;application&gt;</span>
    <span class="tag">&lt;resource-bundle&gt;</span>
        <span class="tag">&lt;base-name&gt;</span>
            ee.jakarta.tutorial.dukesbookstore.web.messages.Messages
        <span class="tag">&lt;/base-name&gt;</span>
        <span class="tag">&lt;var&gt;</span>bundle<span class="tag">&lt;/var&gt;</span>
    <span class="tag">&lt;/resource-bundle&gt;</span>
    <span class="tag">&lt;locale-config&gt;</span>
        <span class="tag">&lt;default-locale&gt;</span>en<span class="tag">&lt;/default-locale&gt;</span>
        <span class="tag">&lt;supported-locale&gt;</span>de<span class="tag">&lt;/supported-locale&gt;</span>
        <span class="tag">&lt;supported-locale&gt;</span>es<span class="tag">&lt;/supported-locale&gt;</span>
        <span class="tag">&lt;supported-locale&gt;</span>fr<span class="tag">&lt;/supported-locale&gt;</span>
    <span class="tag">&lt;/locale-config&gt;</span>
<span class="tag">&lt;/application&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This configuration means that in the Facelets pages, messages are retrieved using the prefix <code>bundle</code> with the key found in the <code>Messages_'locale'.properties</code> file, as in the following example from the <code>index.xhtml</code> page:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:outputText</span> <span class="attribute-name">style</span>=<span class="string"><span class="delimiter">&quot;</span><span class="key">font-weight</span>:<span class="value">bold</span><span class="delimiter">&quot;</span></span>
              <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">#{bundle.ChooseBook}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In <code>Messages.properties</code>, the key string is defined as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ChooseBook=Choose a <span class="predefined-type">Book</span> from our Catalog</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="deployment-descriptors-used-in-dukes-bookstore"><a class="anchor" href="#deployment-descriptors-used-in-dukes-bookstore"></a>Deployment Descriptors Used in Duke&#8217;s Bookstore</h4>
<div class="paragraph">
<p>The following deployment descriptors are used in Duke&#8217;s Bookstore:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>src/main/resources/META-INF/persistence.xml</code>: The Jakarta Persistence configuration file</p>
</li>
<li>
<p><code>src/main/webapp/WEB-INF/bookstore.taglib.xml</code>: The tag library descriptor file for the custom components</p>
</li>
<li>
<p><code>src/main/webapp/WEB-INF/faces-config.xml</code>: The Jakarta Faces configuration file, which configures the managed beans for the map component as well as the resource bundles for the application</p>
</li>
<li>
<p><code>src/main/webapp/WEB-INF/web.xml</code>: The web application configuration file</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="running-the-dukes-bookstore-case-study-application"><a class="anchor" href="#running-the-dukes-bookstore-case-study-application"></a>Running the Duke&#8217;s Bookstore Case Study Application</h3>
<div class="paragraph">
<p>You can use either NetBeans IDE or Maven to build, package, deploy, and run the Duke&#8217;s Bookstore application.</p>
</div>
<div class="sect3">
<h4 id="to-build-and-deploy-dukes-bookstore-using-netbeans-ide"><a class="anchor" href="#to-build-and-deploy-dukes-bookstore-using-netbeans-ide"></a>To Build and Deploy Duke&#8217;s Bookstore Using NetBeans IDE</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>From the File menu, choose Open Project.</p>
</li>
<li>
<p>In the Open Project dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/case-studies</pre>
</div>
</div>
</li>
<li>
<p>Select the <code>dukes-bookstore</code> folder.</p>
</li>
<li>
<p>Click Open Project.</p>
</li>
<li>
<p>In the Projects tab, right-click the <code>dukes-bookstore</code> project and select Build.</p>
<div class="paragraph">
<p>This will build, package, and deploy Duke&#8217;s Bookstore to GlassFish Server.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="to-build-and-deploy-dukes-bookstore-using-maven"><a class="anchor" href="#to-build-and-deploy-dukes-bookstore-using-maven"></a>To Build and Deploy Duke&#8217;s Bookstore Using Maven</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>), as well as the database server (see <a href="#starting-and-stopping-apache-derby">Starting and Stopping Apache Derby</a>).</p>
</li>
<li>
<p>In a terminal window, go to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/case-studies/dukes-bookstore/</pre>
</div>
</div>
</li>
<li>
<p>Enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">mvn install</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command builds the application and packages it in a WAR file in the <code><em>tut-install</em>/examples/case-studies/dukes-bookstore/target/</code> directory.
It then deploys the application to GlassFish Server.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="to-run-dukes-bookstore"><a class="anchor" href="#to-run-dukes-bookstore"></a>To Run Duke&#8217;s Bookstore</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In a web browser, enter the following URL:</p>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080/dukes-bookstore/</pre>
</div>
</div>
</li>
<li>
<p>On the Duke&#8217;s Bookstore main page, click a book in the graphic, or click one of the links at the bottom of the page.</p>
</li>
<li>
<p>Use the pages in the application to view and purchase books.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="dukes-tutoring-case-study-example"><a class="anchor" href="#dukes-tutoring-case-study-example"></a>Chapter 62. Duke&#8217;s Tutoring Case Study Example</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Duke&#8217;s Tutoring example application is a tracking system for a tutoring center for students.
Students can be checked in and out and can visit the park.
The tutoring center can track attendance and status updates and can store contact information for guardians and students.
Administrators can maintain the tutoring center system.</p>
</div>
<div class="sect2">
<h3 id="design-and-architecture-of-dukes-tutoring"><a class="anchor" href="#design-and-architecture-of-dukes-tutoring"></a>Design and Architecture of Duke&#8217;s Tutoring</h3>
<div class="paragraph">
<p>Duke&#8217;s Tutoring is a web application that incorporates several Jakarta EE technologies.
It exposes both a main interface (for students, guardians, and tutoring center staff) and an administration interface (for staff to maintain the system).
The business logic for both interfaces is provided by enterprise beans.
The enterprise beans use the Jakarta Persistence to create and store the application&#8217;s data in the database.
<a href="#architecture-of-the-dukes-tutoring-example-application">Figure 62-1</a> illustrates the architecture of the application.</p>
</div>
<div id="architecture-of-the-dukes-tutoring-example-application" class="imageblock">
<div class="content">
<img src="images/jakartaeett_dt_061.svg" alt="Architecture diagram of the Duke&#8217;s Tutoring example application. Two clients access the main interface and the admin interface deployed in the web container. These interfaces communicate with enterprise beans deployed in the Jakarta Enterprise Beans container. The enterprise beans communicate with the database.">
</div>
<div class="title">Figure 62-1 Architecture of the Duke&#8217;s Tutoring Example Application</div>
</div>
<div class="paragraph">
<p>The Duke&#8217;s Tutoring application is organized into two main projects: the <code>dukes-tutoring-common</code> library and the <code>dukes-tutoring-war</code> web application.
The <code>dukes-tutoring-common</code> library project contains the entity classes and helper classes used by the <code>dukes-tutoring-war</code> web application, and <code>dukes-tutoring-common</code> is packaged and deployed with <code>dukes-tutoring-war</code>.
The library JAR file is useful for allowing the entity classes and helper classes to be reused by other applications, such as a JavaFX client application.</p>
</div>
<div class="paragraph">
<p>Duke&#8217;s Tutoring uses the following Jakarta EE platform features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Jakarta Persistence entities</p>
<div class="ulist">
<ul>
<li>
<p>A custom Jakarta Bean Validation annotation, <code>@Email</code>, for validating email addresses</p>
</li>
<li>
<p>A standard <code>jta-data-source</code> definition that will create the JDBC resource on deployment</p>
</li>
<li>
<p>A standard property in the <code>persistence.xml</code> deployment descriptor to automatically and portably create and delete the tables in the <code>jta-data-source</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Enterprise beans</p>
<div class="ulist">
<ul>
<li>
<p>Local, no-interface view session and singleton beans</p>
</li>
<li>
<p>Jakarta RESTful Web Services resources in a session bean</p>
</li>
<li>
<p>Jakarta EE security constraints on the administrative interface business methods</p>
</li>
<li>
<p>All enterprise beans packaged within the WAR</p>
</li>
</ul>
</div>
</li>
<li>
<p>WebSocket</p>
<div class="ulist">
<ul>
<li>
<p>A WebSocket server endpoint that automatically publishes the status of students to client endpoints</p>
</li>
</ul>
</div>
</li>
<li>
<p>Jakarta Contexts and Dependency Injection</p>
<div class="ulist">
<ul>
<li>
<p>A CDI event that is fired when the status of a student changes</p>
</li>
<li>
<p>Handler methods for updating the application once the status event is fired</p>
</li>
<li>
<p>CDI managed beans for Facelets pages</p>
</li>
<li>
<p>Bean Validation annotations in the CDI managed beans</p>
</li>
</ul>
</div>
</li>
<li>
<p>Jakarta Faces technology, using Facelets for the web front end</p>
<div class="ulist">
<ul>
<li>
<p>Templating</p>
</li>
<li>
<p>Composite components</p>
</li>
<li>
<p>A custom formatter, <code>PhoneNumberFormatter</code></p>
</li>
<li>
<p>Security constraints on the administrative interface</p>
</li>
<li>
<p>Ajax-enabled Facelets components</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Duke&#8217;s Tutoring application has two main user interfaces, both packaged within a single WAR file:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The main interface, for students, guardians, and staff</p>
</li>
<li>
<p>The administrative interface used by the staff to manage the students and guardians, and to generate attendance reports</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="main-interface"><a class="anchor" href="#main-interface"></a>Main Interface</h3>
<div class="paragraph">
<p>The main interface allows students and staff to check students in and out, and record when students are outside at the playground.</p>
</div>
<div class="sect3">
<h4 id="jakarta-persistence-entities-used-in-the-main-interface"><a class="anchor" href="#jakarta-persistence-entities-used-in-the-main-interface"></a>Jakarta Persistence Entities Used in the Main Interface</h4>
<div class="paragraph">
<p>The following entities used in the main interface encapsulate data stored and manipulated by Duke&#8217;s Tutoring, and are located in the <code>dukestutoring.entity</code> package in the <code>dukes-tutoring-common</code> project.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Person</code>: The <code>Person</code> entity defines attributes common to students and guardians tracked by the application.
These attributes are the person&#8217;s name and contact information, including phone numbers and email address.
This entity has two subclasses, <code>Student</code> and <code>Guardian</code>.</p>
</li>
<li>
<p><code>PersonDetails</code>: The <code>PersonDetails</code> entity is used to store additional data common to all people, such as attributes like pictures and the person&#8217;s birthday, which aren&#8217;t included in the <code>Person</code> entity for performance reasons.</p>
</li>
<li>
<p><code>Student</code> and <code>Guardian</code>: The <code>Student</code> entity stores attributes specific to the students who come to tutoring.
This includes information like the student&#8217;s grade level and school.
The <code>Guardian</code> entity&#8217;s attributes are specific to the parents or guardians of a <code>Student</code>.
Students and guardians have a many-to-many relationship.
That is, a student may have one or more guardians, and a guardian may have one or more students.</p>
</li>
<li>
<p><code>Address</code>: The <code>Address</code> entity represents a mailing address and is associated with <code>Person</code> entities.
Addresses and people have a many-to-one relationship.
That is, one person may have many addresses.</p>
</li>
<li>
<p><code>TutoringSession</code>: The <code>TutoringSession</code> entity represents a particular day at the tutoring center.
A particular tutoring session tracks which students attended that day, and which students went to the park.</p>
</li>
<li>
<p><code>StatusEntry</code>: The <code>StatusEntry</code> entity, which logs when a student&#8217;s status changes, is associated with the <code>TutoringSession</code> entity.
Students' statuses change when they check in to a tutoring session, when they go to the park, and when they check out.
The status entry allows the tutoring center staff to track exactly which students attended a tutoring session, when they checked in and out, which students went to the park while they were at the tutoring center, and when they went to and came back from the park.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For information on creating Jakarta Persistence entities, see <a href="#introduction-to-jakarta-persistence">Chapter 40, <em>Introduction to Jakarta Persistence</em></a>.
For information on validating entity data, see <a href="#validating-persistent-fields-and-properties">Validating Persistent Fields and Properties</a> and <a href="#bean-validation-advanced-topics">Chapter 24, <em>Bean Validation: Advanced Topics</em></a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="enterprise-beans-used-in-the-main-interface"><a class="anchor" href="#enterprise-beans-used-in-the-main-interface"></a>Enterprise Beans Used in the Main Interface</h4>
<div class="paragraph">
<p>The following enterprise beans used in the main interface provide the business logic for Duke&#8217;s Tutoring, and are located in the <code>dukestutoring.ejb</code> package in the <code>dukes-tutoring-war</code> project:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ConfigBean</code> is a singleton session bean used to create the default students when the application is initially deployed, and to create an automatic enterprise bean timer that creates tutoring session entities every weekday.</p>
</li>
<li>
<p><code>RequestBean</code> is a stateless session bean containing the business methods for the main interface.
The bean also has business methods for retrieving lists of students.
These business methods use strongly typed Criteria API queries to retrieve data from the database.
<code>RequestBean</code> also injects a CDI event instance, <code>StatusEvent</code>.
This event is fired from the business methods when the status of a student changes.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For information on creating and using enterprise beans, see <a href="#enterprise-beans">Part VII, &#8220;Enterprise Beans&#8221;</a>.
For information on creating strongly typed Criteria API queries, see <a href="#using-the-criteria-api-to-create-queries">Chapter 43, <em>Using the Criteria API to Create Queries</em></a>.
For information on CDI events, see <a href="#using-events-in-cdi-applications">Using Events in CDI Applications</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="websocket-endpoint-used-in-the-main-interface"><a class="anchor" href="#websocket-endpoint-used-in-the-main-interface"></a>WebSocket Endpoint Used in the Main Interface</h4>
<div class="paragraph">
<p>The <code>ee.jakarta.tutorial.dukestutoring.web.websocket.StatusEndpoint</code> class is a WebSocket server endpoint that returns students and their status to client endpoints.
The <code>StatusEndpoint.updateStatus</code> method is a CDI observer method for the <code>StatusEvent</code> event.
When a student&#8217;s status changes in the main interface, a <code>StatusEvent</code> is fired.
The <code>updateStatus</code> observer method is called by the container, and pushes out the status change to all the client endpoints registered with <code>StatusEndpoint</code>.</p>
</div>
<div class="paragraph">
<p>The <code>index.xhtml</code> Jakarta Faces page contains JavaScript code to connect to the WebSocket endpoint.
The <code>onMessage</code> method on this page clicks a Jakarta Faces button, which makes an Ajax request to refresh the table that shows the current status of the students.</p>
</div>
<div class="paragraph">
<p>For more information on WebSocket endpoints, see <a href="#jakarta-websocket-2">Chapter 19, <em>Jakarta WebSocket</em></a>.
For information on CDI events, see <a href="#using-events-in-cdi-applications">Using Events in CDI Applications</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="facelets-files-used-in-the-main-interface"><a class="anchor" href="#facelets-files-used-in-the-main-interface"></a>Facelets Files Used in the Main Interface</h4>
<div class="paragraph">
<p>The Duke&#8217;s Tutoring application uses Facelets to display the user interface, making extensive use of the templating features of Facelets.
Facelets, the default display technology for Jakarta Faces technology, consists of XHTML files located in the <code><em>tut-install</em>/examples/case-studies/dukes-tutoring-war/src/main/webapp/</code> directory.</p>
</div>
<div class="paragraph">
<p>The following Facelets files are used in the main interface:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>template.xhtml</code>: Template file for the main interface</p>
</li>
<li>
<p><code>error.xhtml</code>: Error file if something goes wrong</p>
</li>
<li>
<p><code>index.xhtml</code>: Landing page for the main interface</p>
</li>
<li>
<p><code>park.xhtml</code>: Page showing who is currently at the park</p>
</li>
<li>
<p><code>current.xhtml</code>: Page showing who is currently in today&#8217;s tutoring session</p>
</li>
<li>
<p><code>statusEntries.xhtml</code>: Page showing the detailed status entry log for today&#8217;s session</p>
</li>
<li>
<p><code>resources/components/allStudentsTable.xhtml</code>: A composite component for a table displaying all active students</p>
</li>
<li>
<p><code>resources/components/allInactiveStudentsTable.xhtml</code>: A composite component for a table displaying all inactive students</p>
</li>
<li>
<p><code>resources/components/currentSessionTable.xhtml</code>: A composite component for a table displaying all students in today&#8217;s session</p>
</li>
<li>
<p><code>resources/components/parkTable.xhtml</code>: A composite component for a table displaying all students currently at the park</p>
</li>
<li>
<p><code>WEB-INF/includes/mainNav.xhtml</code>: XHTML fragment for the main interface&#8217;s navigation bar</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For information on using Facelets, see <a href="#introduction-to-facelets">Chapter 8, <em>Introduction to Facelets</em></a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="helper-classes-used-in-the-main-interface"><a class="anchor" href="#helper-classes-used-in-the-main-interface"></a>Helper Classes Used in the Main Interface</h4>
<div class="paragraph">
<p>The following helper classes, found in the <code>dukes-tutoring-common</code> project&#8217;s <code>dukestutoring.util</code> package, are used in the main interface.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>CalendarUtil</code>: A class that provides a method to strip the unnecessary time data from <code>java.util.Calendar</code> instances.</p>
</li>
<li>
<p><code>Email</code>: A custom Bean Validation annotation class for validating email addresses in the <code>Person</code> entity.</p>
</li>
<li>
<p><code>StatusType</code>: An enumerated type defining the different statuses that a student can have.
Possible values are <code>IN</code>, <code>OUT</code>, and <code>PARK</code>.
<code>StatusType</code> is used throughout the application, including in the <code>StatusEntry</code> entity, and throughout the main interface.
<code>StatusType</code> also defines a <code>toString</code> method that returns a localized translation of the status based on the locale.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="properties-files"><a class="anchor" href="#properties-files"></a>Properties Files</h4>
<div class="paragraph">
<p>The strings used in the main interface are encapsulated into resource bundles to allow the display of localized strings in multiple locales.
Each of the properties files has locale-specific files appended with locale codes, containing the translated strings for each locale.
For example, <code>Messages_es.properties</code> contains the localized strings for Spanish locales.</p>
</div>
<div class="paragraph">
<p>The <code>dukes-tutoring-common</code> project has the following resource bundle under <code>src/main/resources/</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ee.jakarta.tutorial/dukestutoring/util/StatusMessages.properties</code>: Strings for each of the status types defined in the <code>StatusType</code> enumerated type for the default locale.
Each supported locale has a property file of the form <code>StatusMessages<em>_locale prefix</em>.properties</code> containing the localized strings.
For example, the strings for Spanish-speaking locales are located in <code>StatusMessages_es.properties</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>dukes-tutoring-war</code> project has the following resource bundles under <code>src/main/resources/</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ValidationMessages.properties</code>: Strings for the default locale used by the Bean Validation runtime to display validation messages.
This file must be named <code>ValidationMessages.properties</code> and located in the default package as required by the Bean Validation specification.
Each supported locale has a property file of the form <code>ValidationMessages<em>_locale prefix</em>.properties</code> containing the localized strings.
For example, the strings for German-speaking locales are located in <code>ValidationMessages_de.properties</code>.</p>
</li>
<li>
<p><code>ee.jakarta.tutorial/dukestutoring/web/messages/Messages.properties</code>: Strings for the default locale for the main and administration Facelets interface.
Each supported locale has a property file of the form <code>Messages<em>_locale prefix</em>.properties</code> containing the localized strings.
For example, the strings for simplified Chinese-speaking locales are located in <code>Messages_zh.properties</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For information on localizing web applications, see <a href="#registering-application-messages">Registering Application Messages</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="deployment-descriptors-used-in-dukes-tutoring"><a class="anchor" href="#deployment-descriptors-used-in-dukes-tutoring"></a>Deployment Descriptors Used in Duke&#8217;s Tutoring</h4>
<div class="paragraph">
<p>Duke&#8217;s Tutoring uses these deployment descriptors in the <code>src/main/webapp/WEB-INF</code> directory of the <code>dukes-tutoring-war</code> project:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>faces-config.xml</code>: The Jakarta Faces configuration file</p>
</li>
<li>
<p><code>glassfish-web.xml</code>: The configuration file specific to GlassFish Server, which defines security role mapping</p>
</li>
<li>
<p><code>web.xml</code>: The web application configuration file</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Duke&#8217;s Tutoring also uses the following deployment descriptor in the <code>src/main/resources/META-INF</code> directory of the <code>dukes-tutoring-common</code> project:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>persistence.xml</code>: The Jakarta Persistence configuration file</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>No enterprise bean deployment descriptor is used in Duke&#8217;s Tutoring.
Annotations in the enterprise bean class files are used for the configuration of enterprise beans in this application.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="administration-interface"><a class="anchor" href="#administration-interface"></a>Administration Interface</h3>
<div class="paragraph">
<p>The administration interface of Duke&#8217;s Tutoring is used by the tutoring center staff to manage the data employed by the main interface: the students, the students' guardians, and the addresses.
The administration interface uses many of the same components as the main interface.
Additional components that are only used in the administration interface are described here.</p>
</div>
<div class="sect3">
<h4 id="enterprise-beans-used-in-the-administration-interface"><a class="anchor" href="#enterprise-beans-used-in-the-administration-interface"></a>Enterprise Beans Used in the Administration Interface</h4>
<div class="paragraph">
<p>The following enterprise bean, in the <code>dukestutoring.ejb</code> package of the <code>dukes-tutoring-war</code> project, is used in the administration interface.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>AdminBean</code>: A stateless session bean for all the business logic used in the administration interface.
Calls security methods to allow invocation of the business methods only by authorized users.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="facelets-files-used-in-the-administration-interface"><a class="anchor" href="#facelets-files-used-in-the-administration-interface"></a>Facelets Files Used in the Administration Interface</h4>
<div class="paragraph">
<p>The following Facelets files, under <code>src/main/webapp/</code>, are used in the administration interface:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>admin/adminTemplate.xhtml</code>: Template for the administration interface</p>
</li>
<li>
<p><code>admin/index.xhtml</code>: Landing page for the administration interface</p>
</li>
<li>
<p><code>login.xhtml</code>: Login page for the security-constrained administration interface</p>
</li>
<li>
<p><code>loginError.xhtml</code>: Page displayed if there are errors authenticating the administration user</p>
</li>
<li>
<p><code>admin/address</code> directory: Pages that allow you to create, edit, and delete <code>Address</code> entities</p>
</li>
<li>
<p><code>admin/guardian</code> directory: Pages that allow you to create, edit, and delete <code>Guardian</code> entities</p>
</li>
<li>
<p><code>admin/student</code> directory: Pages that allow you to create, edit, and delete <code>Student</code> entities</p>
</li>
<li>
<p><code>resources/components/formLogin.xhtml</code>: Composite component for a login form using Jakarta Security</p>
</li>
<li>
<p><code>WEB-INF/includes/adminNav.xhtml</code>: XHTML fragment for the administration interface&#8217;s navigation bar</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="cdi-managed-beans-used-in-the-administration-interface"><a class="anchor" href="#cdi-managed-beans-used-in-the-administration-interface"></a>CDI Managed Beans Used in the Administration Interface</h4>
<div class="paragraph">
<p>The CDI managed beans used in the administration interface are located in the <code>dukestutoring.web</code> package in the <code>dukes-tutoring-war</code> project.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>StudentBean.java</code>: A managed bean for the Facelets pages used to create and edit students.
The first and last names have Bean Validation annotations that require the fields to be filled in.
The phone numbers have Bean Validation annotations to ensure that the submitted data is well-formed.</p>
</li>
<li>
<p><code>GuardianBean.java</code>: A managed bean for the Facelets pages used to create guardians for and assign guardians to students.
The first and last names have Bean Validation annotations that require the fields to be filled in.
The phone numbers have Bean Validation annotations to ensure that the submitted data is well-formed.</p>
</li>
<li>
<p><code>AddressBean.java</code>: A managed bean for the Facelets pages used to create addresses for students.
The street, city, province, and postal code attributes have Bean Validation annotations that require the fields to be filled in, and the postal code attribute has an additional annotation to ensure that the data is properly formed.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="helper-classes-used-in-the-administration-interface"><a class="anchor" href="#helper-classes-used-in-the-administration-interface"></a>Helper Classes Used in the Administration Interface</h4>
<div class="paragraph">
<p>The following helper classes, found in the <code>dukes-tutoring-war</code> project&#8217;s <code>dukestutoring.web.util</code> package, are used in the administration interface.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>EntityConverter</code>: A parent class to <code>StudentConverter</code> and <code>GuardianConverter</code> that defines a cache to store the entity classes when converting the entities for use in Jakarta Faces user interface components.
The cache helps increase performance.
The cache is stored in the Jakarta Faces context.</p>
</li>
<li>
<p><code>StudentConverter</code>: A Jakarta Faces converter for the <code>Student</code> entity class.
This class contains methods to convert <code>Student</code> instances to strings and back again, so they can be used in the user interface components of the application.</p>
</li>
<li>
<p><code>GuardianConverter</code>: Similar to <code>StudentConverter</code>, this class is a converter for the <code>Guardian</code> entity class.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="running-the-dukes-tutoring-case-study-application"><a class="anchor" href="#running-the-dukes-tutoring-case-study-application"></a>Running the Duke&#8217;s Tutoring Case Study Application</h3>
<div class="paragraph">
<p>This section describes how to build, package, deploy, and run the Duke&#8217;s Tutoring application.</p>
</div>
<div class="sect3">
<h4 id="running-dukes-tutoring"><a class="anchor" href="#running-dukes-tutoring"></a>Running Duke&#8217;s Tutoring</h4>
<div class="paragraph">
<p>You can use either NetBeans IDE or Maven to build, package, deploy, and run Duke&#8217;s Tutoring.</p>
</div>
<div class="sect4">
<h5 id="to-build-and-deploy-dukes-tutoring-using-netbeans-ide"><a class="anchor" href="#to-build-and-deploy-dukes-tutoring-using-netbeans-ide"></a>To Build and Deploy Duke&#8217;s Tutoring Using NetBeans IDE</h5>
<div class="sect5">
<h6 id="before-you-begin"><a class="anchor" href="#before-you-begin"></a>Before You Begin</h6>
<div class="paragraph">
<p>You must have already configured GlassFish Server as a Jakarta EE server in NetBeans IDE, as described in <a href="#to-add-glassfish-server-as-a-server-using-netbeans-ide">To Add GlassFish Server as a Server Using NetBeans IDE</a>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>If the database server is not already running, start it as described in <a href="#starting-and-stopping-apache-derby">Starting and Stopping Apache Derby</a>.</p>
</li>
<li>
<p>From the File menu, choose Open Project.</p>
</li>
<li>
<p>In the Open Project dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/case-studies</pre>
</div>
</div>
</li>
<li>
<p>Select the <code>dukes-tutoring</code> folder.</p>
</li>
<li>
<p>Select the Open Required Projects check box and click Open Project.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The first time you open Duke&#8217;s Tutoring in NetBeans, you will see error glyphs in the Projects tab.
This is expected, as the metamodel files used by the enterprise beans for Criteria API queries have not yet been generated.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>In the Projects tab, right-click the <code>dukes-tutoring</code> project and select Build.</p>
<div class="paragraph">
<p>This command creates a JDBC security realm named tutoringRealm, builds and packages the <code>dukes-tutoring-common</code> and <code>dukes-tutoring-war</code> projects, and deploys <code>dukes-tutoring-war</code> to GlassFish Server, starting Derby and GlassFish Server if they have not already been started.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect4">
<h5 id="to-build-and-deploy-dukes-tutoring-using-maven"><a class="anchor" href="#to-build-and-deploy-dukes-tutoring-using-maven"></a>To Build and Deploy Duke&#8217;s Tutoring Using Maven</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>).</p>
</li>
<li>
<p>If the database server is not already running, start it as described in <a href="#starting-and-stopping-apache-derby">Starting and Stopping Apache Derby</a>.</p>
</li>
<li>
<p>In a terminal window, go to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/case-studies/dukes-tutoring/</pre>
</div>
</div>
</li>
<li>
<p>Enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">mvn install</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command creates a JDBC security realm named <code>tutoringRealm</code>, builds and packages the <code>dukes-tutoring-common</code> and <code>dukes-tutoring-war</code> projects, and deploys <code>dukes-tutoring-war</code> to GlassFish Server.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="using-dukes-tutoring"><a class="anchor" href="#using-dukes-tutoring"></a>Using Duke&#8217;s Tutoring</h5>
<div class="paragraph">
<p>Once Duke&#8217;s Tutoring is running on GlassFish Server, use the main interface to experiment with checking students in and out or sending them to the park.</p>
</div>
<div class="sect5">
<h6 id="to-use-the-main-interface-of-dukes-tutoring"><a class="anchor" href="#to-use-the-main-interface-of-dukes-tutoring"></a>To Use the Main Interface of Duke&#8217;s Tutoring</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In a web browser, open the main interface at the following URL:</p>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080/dukes-tutoring-war/</pre>
</div>
</div>
</li>
<li>
<p>Use the main interface to check students in and out, and to log when the students go to the park.</p>
</li>
</ol>
</div>
</div>
<div class="sect5">
<h6 id="to-use-the-administration-interface-of-dukes-tutoring"><a class="anchor" href="#to-use-the-administration-interface-of-dukes-tutoring"></a>To Use the Administration Interface of Duke&#8217;s Tutoring</h6>
<div class="paragraph">
<p>Follow these instructions to log in to the administration interface of Duke&#8217;s Tutoring and add new students, guardians, and addresses.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>From the main interface, open the administration interface by clicking Administration main page in the left menu.</p>
<div class="paragraph">
<p>This redirects you to the login page at the following URL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080/dukes-tutoring-war/admin/index.xhtml</pre>
</div>
</div>
</li>
<li>
<p>On the login page, enter <code>admin@example.com</code> in the User name field, and enter <code>jakartaee</code> in the Password field.</p>
</li>
<li>
<p>Use the administration interface to add or modify students, add guardians, or add addresses.</p>
<div class="ulist">
<ul>
<li>
<p>To add a new student, click Create new student in the left menu, fill in the fields (two are required) in the form that opens, and click Submit.
The Email, Home phone, and Mobile phone fields have formatting requirements enforced by HTML5 pass-through or by Bean Validation constraints.</p>
</li>
<li>
<p>To modify a student, click Edit next to the student&#8217;s name, modify the fields in the form that opens, and click Submit.
To edit another student, choose the student from the drop-down menu at the top of the page and click Change student.</p>
</li>
<li>
<p>To remove a student, click Remove next to the student&#8217;s name, then click Confirm in the page that appears.
This action removes the student from the tutoring session but does not remove the student from the database.
To add the student to the tutoring session again, click Activate student in the left menu, then click Activate next to the student&#8217;s name in the page that appears.</p>
</li>
<li>
<p>To add a guardian for a student, click Add guardian next to the student&#8217;s name.
The page that appears shows the student&#8217;s name, the available guardians, and the current guardians for the student, if any.
To add an existing guardian for that student, select the guardian from the list and click Add guardian.
To create a new guardian for the student, fill in the fields and click Submit.
To remove a guardian from a student, select one of the student&#8217;s current guardians from the list and click Remove guardian.</p>
</li>
<li>
<p>To add an address for a student, click Add address next to the student&#8217;s name.
In the page that appears, fill in the appropriate fields in the form that appears, and click Submit.
Four fields are required.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The administration interface is not fully implemented.
It is not possible to edit a guardian or to view or edit an address, although Facelets pages exist for these features.
The application also makes no use of the properties in the <code>PersonDetails</code> entity.
Feel free to modify the application to add these features.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="dukes-forest-case-study-example"><a class="anchor" href="#dukes-forest-case-study-example"></a>Chapter 63. Duke&#8217;s Forest Case Study Example</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter describes Duke&#8217;s Forest, a simple e-commerce application that contains several web applications and illustrates the use of multiple Jakarta EE APIs.</p>
</div>
<div class="sect2">
<h3 id="overview-of-the-dukes-forest-case-study-example"><a class="anchor" href="#overview-of-the-dukes-forest-case-study-example"></a>Overview of the Duke&#8217;s Forest Case Study Example</h3>
<div class="paragraph">
<p>Duke&#8217;s Forest is a simple e-commerce application that contains several web applications and illustrates the use of the following Jakarta EE APIs:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Jakarta Faces technology, including Ajax</p>
</li>
<li>
<p>Jakarta Contexts and Dependency Injection (CDI)</p>
</li>
<li>
<p>Jakarta RESTful Web Services</p>
</li>
<li>
<p>Jakarta Persistence</p>
</li>
<li>
<p>Jakarta Bean Validation</p>
</li>
<li>
<p>Jakarta Enterprise Beans technology</p>
</li>
<li>
<p>Jakarta Messaging</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The application consists of the following projects.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Duke&#8217;s Store: A web application that has a product catalog, customer self-registration, and a shopping cart.
It also has an administration interface for product, category, and user management.
The project name is <code>dukes-store</code>.</p>
</li>
<li>
<p>Duke&#8217;s Shipment: A web application that provides an interface for order shipment management.
The project name is <code>dukes-shipment</code>.</p>
</li>
<li>
<p>Duke&#8217;s Payment: A web service application that has a RESTful web service for order payment.
The project name is <code>dukes-payment</code>.</p>
</li>
<li>
<p>Duke&#8217;s Resources: A simple Java archive project that contains all resources used by the web projects.
It includes messages, CSS style sheets, images, JavaScript files, and Jakarta Faces composite components.
The project name is <code>dukes-resources</code>.</p>
</li>
<li>
<p>Entities: A simple Java archive project that contains all Jakarta Persistence entities.
This project is shared among other projects that use the entities.
The project name is <code>entities</code>.</p>
</li>
<li>
<p>Events: A simple Java archive project that contains a POJO class that is used as a CDI event.
The project name is <code>events</code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="design-and-architecture-of-dukes-forest"><a class="anchor" href="#design-and-architecture-of-dukes-forest"></a>Design and Architecture of Duke&#8217;s Forest</h3>
<div class="paragraph">
<p>Duke&#8217;s Forest is a complex application consisting of three main projects and three subprojects.
<a href="#architecture-of-the-dukes-forest-example-application">Figure 63-1</a> shows the architecture of the three main projects that you will deploy: Duke&#8217;s Store, Duke&#8217;s Shipment, and Duke&#8217;s Payment.
It also shows how Duke&#8217;s Store makes use of the Events and Entities projects.</p>
</div>
<div id="architecture-of-the-dukes-forest-example-application" class="imageblock">
<div class="content">
<img src="images/jakartaeett_dt_062.svg" alt="This figure shows the architecture of the main Duke&#8217;s Forest projects and how they use the Events and Entities projects.">
</div>
<div class="title">Figure 63-1 Architecture of the Duke&#8217;s Forest Example Application</div>
</div>
<div class="paragraph">
<p>Duke&#8217;s Forest uses the following Jakarta EE platform features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Jakarta Persistence entities</p>
<div class="ulist">
<ul>
<li>
<p>Bean Validation annotations on the entities for verifying data</p>
</li>
<li>
<p>XML annotations for Jakarta XML binding serialization</p>
</li>
</ul>
</div>
</li>
<li>
<p>Web services</p>
<div class="ulist">
<ul>
<li>
<p>A Jakarta REST web service for payment, with security constraints</p>
</li>
<li>
<p>A Jakarta REST web service based on Jakarta Enterprise Beans</p>
</li>
</ul>
</div>
</li>
<li>
<p>Enterprise beans</p>
<div class="ulist">
<ul>
<li>
<p>Local session beans</p>
</li>
<li>
<p>All enterprise beans packaged within the WAR</p>
</li>
</ul>
</div>
</li>
<li>
<p>Jakarta Contexts and Dependency Injection (CDI)</p>
<div class="ulist">
<ul>
<li>
<p>CDI annotations for Jakarta Faces components</p>
</li>
<li>
<p>A CDI managed bean used as a shopping cart, with conversation scoping</p>
</li>
<li>
<p>Qualifiers</p>
</li>
<li>
<p>Events and event handlers</p>
</li>
</ul>
</div>
</li>
<li>
<p>Servlets</p>
<div class="ulist">
<ul>
<li>
<p>A servlet for dynamic image presentation</p>
</li>
</ul>
</div>
</li>
<li>
<p>Jakarta Faces technology, using Facelets for the web front end</p>
<div class="ulist">
<ul>
<li>
<p>Templating</p>
</li>
<li>
<p>Composite components</p>
</li>
<li>
<p>File upload</p>
</li>
<li>
<p>Resources packaged in a JAR file so they can be found in the classpath</p>
</li>
</ul>
</div>
</li>
<li>
<p>Security</p>
<div class="ulist">
<ul>
<li>
<p>Security constraints on the administrative interface business methods (enterprise beans)</p>
</li>
<li>
<p>Security constraints for customers and administrators (web components)</p>
</li>
<li>
<p>Single Sign-On (SSO) to propagate an authenticated user identity from Duke&#8217;s Store to Duke&#8217;s Shipment</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Duke&#8217;s Forest application has two main user interfaces, both packaged within the Duke&#8217;s Store WAR file:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The main interface, for customers and guests</p>
</li>
<li>
<p>The administrative interface used to perform back office operations, such as adding new items to the catalog</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Duke&#8217;s Shipment application also has a user interface, accessible to administrators.</p>
</div>
<div class="paragraph">
<p><a href="#interactions-between-dukes-forest-components">Figure 63-2</a> shows how the web applications and the web service interact.</p>
</div>
<div id="interactions-between-dukes-forest-components" class="imageblock">
<div class="content">
<img src="images/jakartaeett_dt_063.svg" alt="This figure shows the interactions between the Duke&#8217;s Store and Duke&#8217;s Shipment projects (using REST and HTTP), and between the Duke&#8217;s Store and Duke&#8217;s Payment projects (using REST and HTTP).">
</div>
<div class="title">Figure 63-2 Interactions between Duke&#8217;s Forest Components</div>
</div>
<div class="paragraph">
<p>As illustrated in <a href="#interactions-between-dukes-forest-components">Figure 63-2</a>, the customer interacts with the main interface of Duke&#8217;s Store, while the administrator interacts with the administration interface.
Both interfaces access a faade consisting of managed beans and stateless session beans, which in turn interact with the entities that represent database tables.
The faade also interacts with web services APIs that access the Duke&#8217;s Payment web service.
When the payment for an order is approved, Duke&#8217;s Store sends the order to a Jakarta Messaging queue.
The administrator also interacts with the interface of Duke&#8217;s Shipment, which can be accessed either directly through Duke&#8217;s Shipment or from the administration interface of Duke&#8217;s Store by means of a web service.
When the administrator approves an order for shipping, Duke&#8217;s Shipment consumes the order from the Jakarta Messaging queue.</p>
</div>
<div class="paragraph">
<p>The most fundamental building blocks of the application are the Events and Entities projects, which are bundled into Duke&#8217;s Store and Duke&#8217;s Shipment along with the Duke&#8217;s Resources project.</p>
</div>
<div class="sect3">
<h4 id="the-events-project"><a class="anchor" href="#the-events-project"></a>The events Project</h4>
<div class="paragraph">
<p>Events are one of the core components of Duke&#8217;s Forest.
The <code>events</code> project, included in all three of the main projects, is the most simple project of the application.
It has only one class, <code>OrderEvent</code>, but this class is responsible for most of the messages between objects in the application.</p>
</div>
<div class="paragraph">
<p>The application can send messages based on events to different components and react to them based on the qualification of the event.
The application supports the following qualifiers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>@LoggedIn</code>: For authenticated users</p>
</li>
<li>
<p><code>@New</code>: When a new order is created by the shopping cart</p>
</li>
<li>
<p><code>@Paid</code>: When an order is paid for and ready for shipment</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following code snippet from the <code>PaymentHandler</code> class of Duke&#8217;s Store shows how the <code>@Paid</code> event is handled:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span> <span class="annotation">@Paid</span> <span class="predefined-type">Event</span>&lt;OrderEvent&gt; eventManager;

...
public <span class="type">void</span> onNewOrder(<span class="annotation">@Observes</span> <span class="annotation">@New</span> OrderEvent event) {

    <span class="keyword">if</span> (processPayment(event)) {
        orderBean.setOrderStatus(event.getOrderID(),
                <span class="predefined-type">String</span>.valueOf(OrderBean.Status.PENDING_PAYMENT.getStatus()));
        logger.info(<span class="string"><span class="delimiter">&quot;</span><span class="content">Payment Approved</span><span class="delimiter">&quot;</span></span>);
        eventManager.fire(event);
    } <span class="keyword">else</span> {
        orderBean.setOrderStatus(event.getOrderID(),
                <span class="predefined-type">String</span>.valueOf(OrderBean.Status.CANCELLED_PAYMENT.getStatus()));
        logger.info(<span class="string"><span class="delimiter">&quot;</span><span class="content">Payment Denied</span><span class="delimiter">&quot;</span></span>);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To enable users to add more events to the project easily or update an event class with more fields for a new client, this component is a separate project within the application.</p>
</div>
</div>
<div class="sect3">
<h4 id="the-entities-project"><a class="anchor" href="#the-entities-project"></a>The entities Project</h4>
<div class="paragraph">
<p>The <code>entities</code> project is a Jakarta Persistence project used by both Duke&#8217;s Store and Duke&#8217;s Shipment.
It is generated from the database schema shown in <a href="#dukes-forest-database-table-and-their-relationships">Duke&#8217;s Forest Database Tables and Their Relationships</a> and is also used as a base for the entities consumed and produced by the web services through Jakarta XML Binding.
Each entity has validation rules based on business requirements, specified using Jakarta Bean Validation.</p>
</div>
<div id="dukes-forest-database-table-and-their-relationships" class="paragraph">
<div class="title">Duke&#8217;s Forest Database Tables and Their Relationships</div>
<p><span class="image"><img src="images/jakartaeett_dt_064.svg" alt="This figure shows the database tables in Duke&#8217;s Forest and their relationships."></span></p>
</div>
<div class="paragraph">
<p>The database schema contains eight tables:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>PERSON</code>, which has a one-to-many relationship with <code>PERSON_GROUPS</code> and <code>CUSTOMER_ORDER</code></p>
</li>
<li>
<p><code>GROUPS</code>, which has a one-to-many relationship with <code>PERSON_GROUPS</code></p>
</li>
<li>
<p><code>PERSON_GROUPS</code>, which has a many-to-one relationship with <code>PERSON</code> and <code>GROUPS</code> (it is the join table between those two tables)</p>
</li>
<li>
<p><code>PRODUCT</code>, which has a many-to-one relationship with <code>CATEGORY</code> and a one-to-many relationship with <code>ORDER_DETAIL</code></p>
</li>
<li>
<p><code>CATEGORY</code>, which has a one-to-many relationship with <code>PRODUCT</code></p>
</li>
<li>
<p><code>CUSTOMER_ORDER</code>, which has a one-to-many relationship with <code>ORDER_DETAIL</code> and a many-to-one relationship with <code>PERSON</code> and <code>ORDER_STATUS</code></p>
</li>
<li>
<p><code>ORDER_DETAIL</code>, which has a many-to-one relationship with <code>PRODUCT</code> and <code>CUSTOMER_ORDER</code> (it is the join table between those two tables)</p>
</li>
<li>
<p><code>ORDER_STATUS</code>, which has a one-to-many relationship with <code>CUSTOMER_ORDER</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The entity classes that correspond to these tables are as follows.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Person</code>, which defines attributes common to customers and administrators.
These attributes are the person&#8217;s name and contact information, including street and email addresses.
The email address has a Bean Validation annotation to ensure that the submitted data is well-formed.
The generated table for the <code>Person</code> entity also has a <code>DTYPE</code> field that represents the discriminator column.
Its value identifies the subclass (<code>Customer</code> or <code>Administrator</code>) to which the person belongs.</p>
</li>
<li>
<p><code>Customer</code>, a specialization of <code>Person</code> with a specific field for <code>CustomerOrder</code> objects.</p>
</li>
<li>
<p><code>Administrator</code>, a specialization of <code>Person</code> with fields for administration privileges.</p>
</li>
<li>
<p><code>Groups</code>, which represents the group (<code>USERS</code> or <code>ADMINS</code>) to which the user belongs.</p>
</li>
<li>
<p><code>Product</code>, which defines attributes for products.
These attributes include name, price, description, associated image, and category.</p>
</li>
<li>
<p><code>Category</code>, which defines attributes for product categories.
These attributes include a name and a set of tags.</p>
</li>
<li>
<p><code>CustomerOrder</code>, which defines attributes for orders placed by customers.
These attributes include an amount and a date, along with id values for the customer and the order detail.</p>
</li>
<li>
<p><code>OrderDetail</code>, which defines attributes for the order detail.
These attributes include a quantity and id values for the product and the customer.</p>
</li>
<li>
<p><code>OrderStatus</code>, which defines a status attribute for each order.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="the-dukes-payment-project"><a class="anchor" href="#the-dukes-payment-project"></a>The dukes-payment Project</h4>
<div class="paragraph">
<p>The <code>dukes-payment</code> project is a web project that holds a simple Payment web service.
Since this is an example application, it does not obtain any real credit information or even customer status to validate the payment.
For now, the only rule imposed by the payment system is to deny all orders above $1,000.
This application illustrates a common scenario where a third-party payment service is used to validate credit cards or bank payments.</p>
</div>
<div class="paragraph">
<p>The project uses HTTP Basic Authentication and JAAS (Java Authentication and Authorization Service) to authenticate a customer to a Jakarta REST web service.
The implementation itself exposes a simple method, <code>processPayment</code>, which receives an <code>OrderEvent</code> to evaluate and approve or deny the order payment.
The method is called from the checkout process of Duke&#8217;s Store.</p>
</div>
</div>
<div class="sect3">
<h4 id="the-dukes-resources-project"><a class="anchor" href="#the-dukes-resources-project"></a>The dukes-resources Project</h4>
<div class="paragraph">
<p>The <code>dukes-resources</code> project contains a number of files used by both Duke&#8217;s Store and Duke&#8217;s Shipment, bundled into a JAR file placed in the classpath.
The resources are in the <code>src/main/resources</code> directory:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>META-INF/resources/css</code>: Two style sheets, <code>default.css</code> and <code>jsfcrud.css</code></p>
</li>
<li>
<p><code>META-INF/resources/img</code>: Images used by the projects</p>
</li>
<li>
<p><code>META-INF/resources/js</code>: A JavaScript file, <code>util.js</code></p>
</li>
<li>
<p><code>META-INF/resources/util</code>: Composite components used by the projects</p>
</li>
<li>
<p><code>bundles/Bundle.properties</code>: Application messages in English</p>
</li>
<li>
<p><code>bundles/Bundle_es.properties</code>: Application messages in Spanish</p>
</li>
<li>
<p><code>ValidationMessages.properties</code>: Bean Validation messages in English</p>
</li>
<li>
<p><code>ValidationMessages_es.properties</code>: Bean Validation messages in Spanish</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="the-dukes-store-project"><a class="anchor" href="#the-dukes-store-project"></a>The Duke&#8217;s Store Project</h4>
<div class="paragraph">
<p>Duke&#8217;s Store, a web application, is the core application of Duke&#8217;s Forest.
It is responsible for the main store interface for customers as well as the administration interface.</p>
</div>
<div class="paragraph">
<p>The main interface of Duke&#8217;s Store allows the user to perform the following tasks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Browsing the product catalog</p>
</li>
<li>
<p>Signing up as a new customer</p>
</li>
<li>
<p>Adding products to the shopping cart</p>
</li>
<li>
<p>Checking out</p>
</li>
<li>
<p>Viewing order status</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The administration interface of Duke&#8217;s Store allows administrators to perform the following tasks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Product maintenance (create, edit, update, delete)</p>
</li>
<li>
<p>Category maintenance (create, edit, update, delete)</p>
</li>
<li>
<p>Customer maintenance (create, edit, update, delete)</p>
</li>
<li>
<p>Group maintenance (create, edit, update, delete)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The project also uses stateless session beans as faades for interactions with the Jakarta Persistence entities described in <a href="#the-entities-project">The entities Project</a>, and CDI managed beans as controllers for interactions with Facelets pages.
The project thus follows the MVC (Model-View-Controller) pattern and applies the same pattern to all entities and pages, as in the following example.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>AbstractFacade</code> is an abstract class that receives a <code>Type&lt;T&gt;</code> and implements the common operations (CRUD) for this type, where <code>&lt;T&gt;</code> is a Persistence entity.</p>
</li>
<li>
<p><code>ProductBean</code> is a stateless session bean that extends <code>AbstractFacade</code>, applying <code>Product</code> as <code>Type&lt;T&gt;</code>, and injects the <code>PersistenceContext</code> for the <code>EntityManager</code>.
This bean implements any custom methods needed to interact with the <code>Product</code> entity or to call a custom query.</p>
</li>
<li>
<p><code>ProductController</code> is a CDI managed bean that interacts with the necessary enterprise beans and Facelets pages to control the way the data will be displayed.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>ProductBean</code> begins as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Stateless</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">ProductBean</span> <span class="directive">extends</span> AbstractFacade&lt;Product&gt; {
    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">Logger</span> logger =
        <span class="predefined-type">Logger</span>.getLogger(ProductBean.class.getCanonicalName());

    <span class="annotation">@PersistenceContext</span>(unitName=<span class="string"><span class="delimiter">&quot;</span><span class="content">forestPU</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">private</span> EntityManager em;

    <span class="annotation">@Override</span>
    <span class="directive">protected</span> EntityManager getEntityManager() {
        <span class="keyword">return</span> em;
    }
    ...
}</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="enterprise-beans-used-in-dukes-store"><a class="anchor" href="#enterprise-beans-used-in-dukes-store"></a>Enterprise Beans Used in Duke&#8217;s Store</h5>
<div class="paragraph">
<p>The enterprise beans used in Duke&#8217;s Store provide the business logic for the application and are located in the <code>com.forest.ejb</code> package.
All are stateless session beans.</p>
</div>
<div class="paragraph">
<p><code>AbstractFacade</code> is not an enterprise bean but an abstract class that implements common operations for <code>Type&lt;T&gt;</code>, where <code>&lt;T&gt;</code> is a Persistence entity.</p>
</div>
<div class="paragraph">
<p>Most of the other beans extend <code>AbstractFacade</code>, inject the <code>PersistenceContext</code>, and implement any needed custom methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>AdministratorBean</code></p>
</li>
<li>
<p><code>CategoryBean</code></p>
</li>
<li>
<p><code>EventDispatcherBean</code></p>
</li>
<li>
<p><code>GroupsBean</code></p>
</li>
<li>
<p><code>OrderBean</code></p>
</li>
<li>
<p><code>OrderDetailBean</code></p>
</li>
<li>
<p><code>OrderJMSManager</code></p>
</li>
<li>
<p><code>OrderStatusBean</code></p>
</li>
<li>
<p><code>ProductBean</code></p>
</li>
<li>
<p><code>ShoppingCart</code></p>
</li>
<li>
<p><code>UserBean</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>ShoppingCart</code> class, although it is in the <code>ejb</code> package, is a CDI managed bean with conversation scope, which means that the request information will persist across multiple requests.
Also, <code>ShoppingCart</code> is responsible for starting the event chain for customer orders, which invokes the RESTful web service in <code>dukes-payment</code> and publishes an order to the Jakarta Messaging queue for shipping approval if the payment is successful.</p>
</div>
</div>
<div class="sect4">
<h5 id="facelets-files-used-in-the-main-interface-of-dukes-store"><a class="anchor" href="#facelets-files-used-in-the-main-interface-of-dukes-store"></a>Facelets Files Used in the Main Interface of Duke&#8217;s Store</h5>
<div class="paragraph">
<p>Like the other case study examples, Duke&#8217;s Store uses Facelets to display the user interface.
The main interface uses a large number of Facelets pages to display different areas.
The pages are grouped into directories based on which module they handle.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>template.xhtml</code>: Template file, used for both main and administration interfaces.
It first performs a browser check to verify that the user&#8217;s browser supports HTML 5, which is required for Duke&#8217;s Forest.
It divides the screen into several areas and specifies the client page for each area.</p>
</li>
<li>
<p><code>topbar.xhtml</code>: Page for the login area at the top of the screen.</p>
</li>
<li>
<p><code>top.xhtml</code>: Page for the title area.</p>
</li>
<li>
<p><code>left.xhtml</code>: Page for the left sidebar.</p>
</li>
<li>
<p><code>index.xhtml</code>: Page for the main screen content.</p>
</li>
<li>
<p><code>login.xhtml</code>: Login page specified in <code>web.xml</code>.
The main login interface is provided in <code>topbar.xhtml</code>, but this page appears if there is a login error.</p>
</li>
<li>
<p><code>admin</code> directory: Pages related to the administration interface, described in <a href="#facelets-files-used-in-the-administration-interface-of-dukes-store">Facelets Files Used in the Administration Interface of Duke&#8217;s Store</a>.</p>
</li>
<li>
<p><code>customer</code> directory: Pages related to customers (<code>Create.xhtml</code>, <code>Edit.xhtml</code>, <code>List.xhtml</code>, <code>Profile.xhtml</code>, <code>View.xhtml</code>).</p>
</li>
<li>
<p><code>order</code> directory: Pages related to orders (<code>Create.xhtml</code>, <code>List.xhtml</code>, <code>MyOrders.xhtml</code>, <code>View.xhtml</code>).</p>
</li>
<li>
<p><code>orderDetail</code> directory: Popup page allowing users to view details of an order (<code>View_popup.xhtml</code>).</p>
</li>
<li>
<p><code>product</code> directory: Pages related to products (<code>List.xhtml</code>, <code>ListCategory.xhtml</code>, <code>View.xhtml</code>).</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="facelets-files-used-in-the-administration-interface-of-dukes-store"><a class="anchor" href="#facelets-files-used-in-the-administration-interface-of-dukes-store"></a>Facelets Files Used in the Administration Interface of Duke&#8217;s Store</h5>
<div class="paragraph">
<p>The Facelets pages for the administration interface of Duke&#8217;s Store are found in the <code>web/admin</code> directory:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>administrator</code> directory: Pages related to administrator management (<code>Create.xhtml</code>, <code>Edit.xhtml</code>, <code>List.xhtml</code>, <code>View.xhtml</code>)</p>
</li>
<li>
<p><code>category</code> directory: Pages related to product category management (<code>Create.xhtml</code>, <code>Edit.xhtml</code>, <code>List.xhtml</code>, <code>View.xhtml</code>)</p>
</li>
<li>
<p><code>customer</code> directory: Pages related to customer management (<code>Create.xhtml</code>, <code>Edit.xhtml</code>, <code>List.xhtml</code>, <code>Profile.xhtml</code>, <code>View.xhtml</code>)</p>
</li>
<li>
<p><code>groups</code> directory: Pages related to group management (<code>Create.xhtml</code>, <code>Edit.xhtml</code>, <code>List.xhtml</code>, <code>View.xhtml</code>)</p>
</li>
<li>
<p><code>order</code> directory: Pages related to order management (<code>Create.xhtml</code>, <code>Edit.xhtml</code>, <code>List.xhtml</code>, <code>View.xhtml</code>)</p>
</li>
<li>
<p><code>orderDetail</code> directory: Popup page allowing the administrator to view details of an order (<code>View_popup.xhtml</code>)</p>
</li>
<li>
<p><code>product</code> directory: Pages related to product management (<code>Confirm.xhtml</code>, <code>Create.xhtml</code>, <code>Edit.xhtml</code>, <code>List.xhtml</code>, <code>View.xhtml</code>)</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="managed-beans-used-in-dukes-store"><a class="anchor" href="#managed-beans-used-in-dukes-store"></a>Managed Beans Used in Duke&#8217;s Store</h5>
<div class="paragraph">
<p>Duke&#8217;s Store uses the following CDI managed beans, which correspond to the enterprise beans.
The beans are in the <code>com.forest.web</code> package:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>AdministratorController</code></p>
</li>
<li>
<p><code>CategoryController</code></p>
</li>
<li>
<p><code>CustomerController</code></p>
</li>
<li>
<p><code>CustomerOrderController</code></p>
</li>
<li>
<p><code>GroupsController</code></p>
</li>
<li>
<p><code>OrderDetailController</code></p>
</li>
<li>
<p><code>OrderStatusController</code></p>
</li>
<li>
<p><code>ProductController</code></p>
</li>
<li>
<p><code>UserController</code></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="helper-classes-used-in-dukes-store"><a class="anchor" href="#helper-classes-used-in-dukes-store"></a>Helper Classes Used in Duke&#8217;s Store</h5>
<div class="paragraph">
<p>The CDI managed beans in the main interface of Duke&#8217;s Store use the following helper classes, found in the <code>com.forest.web.util</code> package:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>AbstractPaginationHelper</code>: An abstract class with methods used by the managed beans</p>
</li>
<li>
<p><code>ImageServlet</code>: A servlet class that retrieves the image content from the database and displays it</p>
</li>
<li>
<p><code>JsfUtil</code>: Class used for Jakarta Faces operations, such as queuing messages on a <code>FacesContext</code> instance</p>
</li>
<li>
<p><code>MD5Util</code>: Class used by the <code>CustomerController</code> managed bean to generate an encrypted password for a user</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="qualifiers-used-in-dukes-store"><a class="anchor" href="#qualifiers-used-in-dukes-store"></a>Qualifiers Used in Duke&#8217;s Store</h5>
<div class="paragraph">
<p>Duke&#8217;s Store defines the following qualifiers in the <code>com.forest.qualifiers</code> package:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>@LoggedIn</code>: Qualifies a user as having logged in</p>
</li>
<li>
<p><code>@New</code>: Qualifies an order as new</p>
</li>
<li>
<p><code>@Paid</code>: Qualifies an order as paid</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="event-handlers-used-in-dukes-store"><a class="anchor" href="#event-handlers-used-in-dukes-store"></a>Event Handlers Used in Duke&#8217;s Store</h5>
<div class="paragraph">
<p>Duke&#8217;s Store defines event handlers related to the <code>OrderEvent</code> class packaged in the <code>events</code> project (see <a href="#the-events-project">The events Project</a>).
The event handlers are in the <code>com.forest.handlers</code> package.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>IOrderHandler</code>: The <code>IOrderHandler</code> interface defines a method, <code>onNewOrder</code>, implemented by the two handler classes.</p>
</li>
<li>
<p><code>PaymentHandler</code>: The <code>ShoppingCart</code> bean fires an <code>OrderEvent</code> qualified as <code>@New</code>.
The <code>onNewOrder</code> method of <code>PaymentHandler</code> observes these events and, when it intercepts them, processes the payment using the Duke&#8217;s Payment web service.
After a successful response from the web service, <code>PaymentHandler</code> fires the <code>OrderEvent</code> again, this time qualified as <code>@Paid</code>.</p>
</li>
<li>
<p><code>DeliveryHandler</code>: The <code>onNewOrder</code> method of <code>DeliveryHandler</code> observes <code>OrderEvent</code> objects qualified as <code>@Paid</code> (orders paid and ready for delivery) and modifies the order status to <code>PENDING_SHIPMENT</code>.
When an administrator accesses Duke&#8217;s Shipment, it will call the Order Service, a RESTful web service, and ask for all orders in the database that are ready for delivery.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="deployment-descriptors-used-in-dukes-store"><a class="anchor" href="#deployment-descriptors-used-in-dukes-store"></a>Deployment Descriptors Used in Duke&#8217;s Store</h5>
<div class="paragraph">
<p>Duke&#8217;s Store uses the following deployment descriptors, located in the <code>web/WEB-INF</code> directory:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>faces-config.xml</code>: The Jakarta Faces configuration file</p>
</li>
<li>
<p><code>glassfish-web.xml</code>: The configuration file specific to GlassFish Server</p>
</li>
<li>
<p><code>web.xml</code>: The web application configuration file</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="the-dukes-shipment-project"><a class="anchor" href="#the-dukes-shipment-project"></a>The Duke&#8217;s Shipment Project</h4>
<div class="paragraph">
<p>Duke&#8217;s Shipment is a web application with a login page, a main Facelets page, and some other objects.
This application, which is accessible only to administrators, consumes orders from a Jakarta Messaging queue and calls the RESTful web service exposed by Duke&#8217;s Store to update the order status.
The main page of Duke&#8217;s Shipment shows a list of orders pending shipping approval and a list of shipped orders.
The administrator can approve or deny orders for shipping.
If approved, the order is shipped, and it appears under the Shipped heading.
If denied, the order disappears from the page, and on the customer&#8217;s Orders list it appears as cancelled.</p>
</div>
<div class="paragraph">
<p>There is also a gear icon on the Pending list that makes an Ajax call to the Order Service to refresh the list without refreshing the page.
The code looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;h:commandLink&gt;</span>
    <span class="tag">&lt;h:graphicImage</span> <span class="attribute-name">library</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">img</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">title</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Check for new orders</span><span class="delimiter">&quot;</span></span>
                    <span class="attribute-name">style</span>=<span class="string"><span class="delimiter">&quot;</span><span class="key">border</span>:<span class="float">0px</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">refresh.png</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;f:ajax</span> <span class="attribute-name">execute</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">@form</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">render</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">@form</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/h:commandLink&gt;</span></code></pre>
</div>
</div>
<div class="sect4">
<h5 id="enterprise-beans-used-in-dukes-shipment"><a class="anchor" href="#enterprise-beans-used-in-dukes-shipment"></a>Enterprise Beans Used in Duke&#8217;s Shipment</h5>
<div class="paragraph">
<p>The <code>UserBean</code> stateless session bean used in Duke&#8217;s Shipment provides the business logic for the application and is located in the <code>com.forest.shipment.session</code> package.</p>
</div>
<div class="paragraph">
<p>Like Duke&#8217;s Store, Duke&#8217;s Shipment uses the <code>AbstractFacade</code> class.
This class is not an enterprise bean but an abstract class that implements common operations for <code>Type&lt;T&gt;</code>, where <code>&lt;T&gt;</code> is a Jakarta Persistence entity.</p>
</div>
<div class="paragraph">
<p>The <code>OrderBrowser</code> stateless session bean, located in the <code>com.forest.shipment.ejb</code> package, has one method that browses the Jakarta Messaging order queue and another that consumes an order message after the administrator approves or denies the order for shipment.</p>
</div>
</div>
<div class="sect4">
<h5 id="facelets-files-used-in-dukes-shipment"><a class="anchor" href="#facelets-files-used-in-dukes-shipment"></a>Facelets Files Used in Duke&#8217;s Shipment</h5>
<div class="paragraph">
<p>Duke&#8217;s Shipment has only one page, so it has many fewer Facelets files than Duke&#8217;s Store.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>template.xhtml</code>: The template file, like the one in Duke&#8217;s Store, first performs a browser check to verify that the user&#8217;s browser supports HTML 5, which is required for Duke&#8217;s Forest.
It divides the screen into areas and specifies the client page for each area.</p>
</li>
<li>
<p><code>topbar.xhtml</code>: Page for the login area at the top of the screen.</p>
</li>
<li>
<p><code>top.xhtml</code>: Page for the title area.</p>
</li>
<li>
<p><code>index.xhtml</code>: Page for the initial main screen content.</p>
</li>
<li>
<p><code>login.xhtml</code>: Login page specified in <code>web.xml</code>.
The main login interface is provided in <code>topbar.xhtml</code>, but this page appears if there is a login error.</p>
</li>
<li>
<p><code>admin/index.xhtml</code>: Page for the main screen content after authentication.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="managed-beans-used-in-dukes-shipment"><a class="anchor" href="#managed-beans-used-in-dukes-shipment"></a>Managed Beans Used in Duke&#8217;s Shipment</h5>
<div class="paragraph">
<p>Duke&#8217;s Shipment uses the following CDI managed beans, in the <code>com.forest.shipment</code> package:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>web.ShippingBean</code>: Managed bean that acts as a client to the Order Service</p>
</li>
<li>
<p><code>web.UserController</code>: Managed bean that corresponds to the <code>UserBean</code> session bean</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="helper-class-used-in-dukes-shipment"><a class="anchor" href="#helper-class-used-in-dukes-shipment"></a>Helper Class Used in Duke&#8217;s Shipment</h5>
<div class="paragraph">
<p>The Duke&#8217;s Shipment managed beans use only one helper class, found in the <code>com.forest.shipment.web.util</code> package:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>JsfUtil</code>: Class used for Jakarta Faces operations, such as queuing messages on a <code>FacesContext</code> instance</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="qualifier-used-in-dukes-shipment"><a class="anchor" href="#qualifier-used-in-dukes-shipment"></a>Qualifier Used in Duke&#8217;s Shipment</h5>
<div class="paragraph">
<p>Duke&#8217;s Shipment includes the <code>@LoggedIn</code> qualifier described in <a href="#qualifiers-used-in-dukes-store">Qualifiers Used in Duke&#8217;s Store</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="deployment-descriptors-used-in-dukes-shipment"><a class="anchor" href="#deployment-descriptors-used-in-dukes-shipment"></a>Deployment Descriptors Used in Duke&#8217;s Shipment</h5>
<div class="paragraph">
<p>Duke&#8217;s Shipment uses the following deployment descriptors:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>faces-config.xml</code>: The Jakarta Faces configuration file</p>
</li>
<li>
<p><code>glassfish-web.xml</code>: The configuration file specific to GlassFish Server</p>
</li>
<li>
<p><code>web.xml</code>: The web application configuration file</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="building-and-deploying-the-dukes-forest-case-study-application"><a class="anchor" href="#building-and-deploying-the-dukes-forest-case-study-application"></a>Building and Deploying the Duke&#8217;s Forest Case Study Application</h3>
<div class="paragraph">
<p>You can use NetBeans IDE or Maven to build and deploy Duke&#8217;s Forest.</p>
</div>
<div class="sect3">
<h4 id="to-build-and-deploy-the-dukes-forest-application-using-netbeans-ide"><a class="anchor" href="#to-build-and-deploy-the-dukes-forest-application-using-netbeans-ide"></a>To Build and Deploy the Duke&#8217;s Forest Application Using NetBeans IDE</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>), as well as the database server (see <a href="#starting-and-stopping-apache-derby">Starting and Stopping Apache Derby</a>).</p>
</li>
<li>
<p>From the File menu, choose Open Project.</p>
</li>
<li>
<p>In the Open Project dialog box, navigate to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/case-studies</pre>
</div>
</div>
</li>
<li>
<p>Select the <code>dukes-forest</code> folder.</p>
</li>
<li>
<p>Select the Open Required Projects check box and click Open Project.</p>
</li>
<li>
<p>Right-click the <code>dukes-forest</code> folder and select Build.</p>
<div class="paragraph">
<p>This task configures the server, creates and populates the database, builds all the subprojects, assembles them into JAR and WAR files, and deploys the <code>dukes-payment</code>, <code>dukes-store,</code> and <code>dukes-shipment</code> applications.</p>
</div>
<div class="paragraph">
<p>To configure the server, this task creates a JDBC security realm named <code>jdbcRealm</code>, enables default principal-to-role mapping, and enables single sign-on (SSO) for the HTTP Service.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="to-build-and-deploy-the-dukes-forest-application-using-maven"><a class="anchor" href="#to-build-and-deploy-the-dukes-forest-application-using-maven"></a>To Build and Deploy the Duke&#8217;s Forest Application Using Maven</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure that GlassFish Server has been started (see <a href="#starting-and-stopping-glassfish-server">Starting and Stopping GlassFish Server</a>), as well as the database server (see <a href="#starting-and-stopping-apache-derby">Starting and Stopping Apache Derby</a>).</p>
</li>
<li>
<p>In a terminal window, go to:</p>
<div class="listingblock">
<div class="content">
<pre>tut-install/examples/case-studies/dukes-forest/</pre>
</div>
</div>
</li>
<li>
<p>Enter the following command to configure the server, create and populate the database, build all the subprojects, assemble them into JAR and WAR files, and deploy the <code>dukes-payment</code>, <code>dukes-store,</code> and <code>dukes-shipment</code> applications:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">mvn install</code></pre>
</div>
</div>
<div class="paragraph">
<p>To configure the server, this task creates a JDBC security realm named <code>jdbcRealm</code>, enables default principal-to-role mapping, and enables single sign-on (SSO) for the HTTP Service.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="running-the-dukes-forest-application"><a class="anchor" href="#running-the-dukes-forest-application"></a>Running the Duke&#8217;s Forest Application</h3>
<div class="paragraph">
<p>Running the Duke&#8217;s Forest application involves several tasks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Registering as a customer of Duke&#8217;s Store</p>
</li>
<li>
<p>As a customer, purchasing products</p>
</li>
<li>
<p>As an administrator, approving or denying shipment of a product</p>
</li>
<li>
<p>As an administrator, creating a new product, customer, group, or category</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="to-register-as-a-dukes-store-customer"><a class="anchor" href="#to-register-as-a-dukes-store-customer"></a>To Register as a Duke&#8217;s Store Customer</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In a web browser, enter the following URL:</p>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080/dukes-store</pre>
</div>
</div>
<div class="paragraph">
<p>The Duke&#8217;s Forest - Store page opens.</p>
</div>
</li>
<li>
<p>Click Sign Up at the top of the page.</p>
</li>
<li>
<p>Fill in the form fields, then click Save.</p>
<div class="paragraph">
<p>All fields are required, and the Password value must be at least 7 characters in length.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="to-purchase-products"><a class="anchor" href="#to-purchase-products"></a>To Purchase Products</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>To log in as the user you created, or as one of two users already in the database, enter the user name and password and click Log In.</p>
<div class="paragraph">
<p>The preexisting users have the user names <code>jack@example.com</code> and <code>robert@example.com</code>, and they both have the same password, <code>1234</code>.</p>
</div>
</li>
<li>
<p>Click Products in the left sidebar.</p>
</li>
<li>
<p>On the page that appears, click one of the categories (Plants, Food, Services, or Tools).</p>
</li>
<li>
<p>Choose a product and click Add to Cart.</p>
<div class="paragraph">
<p>You can order only one of any one product, but you can order multiple different products in multiple categories.
The products and a running total appear in the Shopping Cart in the left sidebar.</p>
</div>
</li>
<li>
<p>When you have finished choosing products, click Checkout.</p>
<div class="paragraph">
<p>A message appears: "Your order is being processed. Check the Orders page to see the status of your order."</p>
</div>
</li>
<li>
<p>Click Orders in the left sidebar to verify your order.</p>
<div class="paragraph">
<p>If the total of the order exceeds $1,000, the status of the order is "Order cancelled," because the Payment web service denies orders over that limit.
Otherwise, the status is "Ready to ship."</p>
</div>
</li>
<li>
<p>When you have finished placing orders, click Logout at the top of the page.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="to-approve-shipment-of-a-product"><a class="anchor" href="#to-approve-shipment-of-a-product"></a>To Approve Shipment of a Product</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Log in to Duke&#8217;s Store as an administrator.</p>
<div class="paragraph">
<p>Your user name is <code>admin@example.com</code>, and your password is <code>1234</code>.</p>
</div>
<div class="paragraph">
<p>The main administration page allows you to view categories, customers, administrators, groups, products, and orders, and to create new objects of all types except orders.</p>
</div>
</li>
<li>
<p>At the bottom of the page, click Approve Shipment.</p>
<div class="paragraph">
<p>This action takes you to Duke&#8217;s Shipment, retaining your administrator login.</p>
</div>
</li>
<li>
<p>On the Pending list, click Approve to approve an order and move it to the Shipped area of the page.</p>
<div class="paragraph">
<p>If you click Deny, the order disappears from the page.
If you log in to Duke&#8217;s Store again as the customer, it will appear in the Orders list as "Order cancelled."</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>To return to Duke&#8217;s Store from Duke&#8217;s Shipment, click Return to Duke&#8217;s Store.</p>
</div>
</div>
<div class="sect3">
<h4 id="to-create-a-new-product"><a class="anchor" href="#to-create-a-new-product"></a>To Create a New Product</h4>
<div class="paragraph">
<p>You can create other kinds of objects as well as products.
Creating products is more complex than the other creation processes, so it is described here.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Log in to Duke&#8217;s Store as an administrator.</p>
</li>
<li>
<p>On the main administration page, click Create New Product.</p>
</li>
<li>
<p>Enter values in the Name, Price, and Description fields.</p>
</li>
<li>
<p>Select a category, then click Next.</p>
</li>
<li>
<p>On the Upload the Product Image page, click Browse to locate an image on your file system using a file chooser.</p>
</li>
<li>
<p>Click Next.</p>
</li>
<li>
<p>On the next page, view the product fields, then click Done.</p>
</li>
<li>
<p>Click Products in the left sidebar, then click the category to verify that the product has been added.</p>
</li>
<li>
<p>Click Administration at the top of the page to return to the main administration page, or click Logout to log out.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
 Release 9<br>
 : 2021-07-06 17:07:54 UTC
</div>
</div>
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
pre.CodeRay{background:#f7f7f8}
.CodeRay .line-numbers{border-right:1px solid currentColor;opacity:.35;padding:0 .5em 0 0}
.CodeRay span.line-numbers{display:inline-block;margin-right:.75em}
.CodeRay .line-numbers strong{color:#000}
table.CodeRay{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.CodeRay td{vertical-align:top;line-height:inherit}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.code{padding:0 0 0 .75em}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</body>
</html>